parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"cPXi":[function(require,module,exports) {
"use strict";var e,a,t,r,o,i,n,l,s;Object.defineProperty(exports,"__esModule",{value:!0}),exports.SEIType=exports.CorePlayerType=exports.ExternalEventType=exports.ApiErrorCode=exports.P2PType=exports.EQuality=exports.CodecType=exports.FormatType=exports.ProtocolType=void 0,function(e){e.HTTP_HLS="http_hls",e.HTTP_STREAM="http_stream"}(e=exports.ProtocolType||(exports.ProtocolType={})),function(e){e.FLV="flv",e.TS="ts",e.FMP4="fmp4"}(a=exports.FormatType||(exports.FormatType={})),function(e){e.AVC="avc",e.HEVC="hevc"}(t=exports.CodecType||(exports.CodecType={})),function(e){e[e.Origin=1e4]="Origin",e[e.K4=2e4]="K4",e[e.Dolby=3e4]="Dolby"}(r=exports.EQuality||(exports.EQuality={})),function(e){e[e.HLS_NOT_P2P=-1]="HLS_NOT_P2P",e[e.NONE=0]="NONE",e[e.HLS_BILI=1]="HLS_BILI",e[e.FLV_QVB=8]="FLV_QVB"}(o=exports.P2PType||(exports.P2PType={})),function(e){e[e.AreaBlock=6005]="AreaBlock"}(i=exports.ApiErrorCode||(exports.ApiErrorCode={})),function(e){e.Initialized="initialized",e.LiveStateChange="liveStateChange",e.StartPlayRound="startPlayRound",e.VideoStateChange="videoStateChange",e.FullscreenChange="fullscreenChange",e.Playing="playing",e.Paused="paused",e.SwitchLine="switchLine",e.SwitchQuality="switchQuality",e.WebFullscreen="webFullscreen",e.FeedBackClick="feedBackClick",e.BlockSettingClick="blockSettingClick",e.Set="set",e.Reload="reload",e.GuidChange="guidChange",e.InitDanmaku="initDanmaku",e.AddDanmaku="addDanmaku",e.SendDanmaku="sendDanmaku",e.ReceiveOnlineCount="receiveOnlineCount",e.ReceiveMessage="receiveMessage",e.UserLogin="userLogin",e.SendGift="sendGift",e.FirstLoadedAPIPlayer="firstLoadedAPIPlayer",e.FirstLoadedAPIPlayurl="firstLoadedAPIPlayurl",e.FirstLoadStart="firstLoadStart",e.FirstLoadedMetaData="firstLoadedMetaData",e.FirstPlaying="firstPlaying",e.EnterTheRoom="enterTheRoom",e.OperableElementsChange="operableElementsChange",e.AutoPlay="autoPlay",e.SwitchQualityNotLogin="switchQualityNotLogin",e.Recommend="recommend",e.DanmakuMaskChange="danmakuMaskChange",e.DanmakuMaskStatusChange="danmakuMaskStatusChange",e.CtrlVisibleChange="ctrlVisibleChange",e.WebPlayerCreated="webPlayerCreated",e.FirstFrame="FirstFrame",e.VideoDestroyed="VideoDestroyed",e.SEIData="SEIData",e.VolumeChange="VolumeChange",e.VideoDirectionChange="VideoDirectionChange",e.UserClickPlayIcon="UserClickPlayIcon",e.MergeStream="MergeStream",e.SEIParseData="SEIParseData",e.OrientationChange="OrientationChange",e.UserRedirect="UserRedirect",e.MutePlay="MutePlay",e.NotAutoPlay="NotAutoPlay",e.WaitStart="WaitStart",e.WaitEnd="WaitEnd",e.VideoError="VideoError",e.MetaDataChange="MetaDataChange",e.PlayFaild="PlayFailed",e.ScreenStateChange="ScreenStateChange",e.UserOperation="UserOperation"}(n=exports.ExternalEventType||(exports.ExternalEventType={})),function(e){e.fMp4Player="fMp4Player",e.Hls7Player="Hls7Player",e.NativePlayer="NativePlayer"}(l=exports.CorePlayerType||(exports.CorePlayerType={})),function(e){e.LIVE_SEI_CHANNEL="LIVE_SEI_CHANNEL",e.BILIMASK__SVGBIN="BILIMASK__SVGBIN",e.B_LIVE_VIBRATION="B_LIVE_VIBRATION",e.LIVE_SEI_PC_LINK="LIVE_SEI_PC_LINK",e.BVC_KUAWAN____TS="BVC_KUAWAN____TS",e.BILILIVESUBTITLE="BILILIVESUBTITLE",e.BVCLIVESTREAMHOP="BVCLIVESTREAMHOP",e.BVC__CANVAS_DATA="BVC__CANVAS_DATA"}(s=exports.SEIType||(exports.SEIType={}));
},{}],"MFFc":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function u(e){try{c(n.next(e))}catch(t){i(t)}}function a(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(c){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(u=0)),u;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(c){a=[6,c],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,c])}}};function n(t){return t instanceof Error?String(t):"object"===e(t)?JSON.stringify(t,function(e,t){return t instanceof Error?String(t):t}):String(t)}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function i(e){var t=e.buffered;return null==t||0===t.length?0:t.end(t.length-1)-e.currentTime}function u(e){var t,r,n=document.cookie;return null==n?"":null!==(r=null===(t=n.split(";").filter(function(e){return e.trim().length>0}).map(function(e){return e.split("=")}).map(function(e){var t=e[0],r=e[1];return[t.trim(),r.trim()]}).find(function(t){return t[0]===e}))||void 0===t?void 0:t[1])&&void 0!==r?r:""}function a(e,t){var r;if(null!=e){var n=t.querySelector(".".concat("web-player-video-cover-img"));if(null==n){var o=document.createElement("div");o.classList.add("web-player-video-cover-img-wrap"),o.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ";var i=document.createElement("img");i.classList.add("web-player-video-cover-img"),i.style.cssText="\n    max-width: 100%;\n    max-height: 100%;\n  ",i.src=e,o.appendChild(i),t.appendChild(o)}else n.src=e}else null===(r=t.querySelector(".".concat("web-player-video-cover-img-wrap")))||void 0===r||r.remove()}function c(e,t){var r=new Set;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];r.has(e)||(r.add(e),t.apply(void 0,n))}}function l(e,t){return"number"!=typeof e?0:Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function s(e,t){var r;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(null==r||Date.now()-r>t)return r=Date.now(),e.apply(this,n)}}function p(e,t){var r;return function(){for(var n=this,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];void 0!==r&&window.clearTimeout(r),r=window.setTimeout(function(){e.apply(n,o)},t)}}function f(e){return t(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){setTimeout(t,e)})];case 1:return[2,t.sent()]}})})}function x(e,t){if(16!==e.length||16!==t.length)return!1;for(var r=0;r<16;++r)if(e[r]!==t[r])return!1;return!0}function d(e){for(var t=new Uint8Array(16),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return function(e){if(16!==t.length||16!==e.length)return!1;for(var r=0;r<16;++r)if(t[r]!==e[r])return!1;return!0}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.minusObject=exports.loadScript=exports.formatTime=exports.isSupportDolby=exports.isWebPSupported=exports.disperseAction=exports.uint8ArrayToString=exports.seiKeyComparator=exports.equalsUuid=exports.sleep=exports.debounce=exports.throttle=exports.roundNumber=exports.runOnlyOnce=exports.coverImg=exports.getCookie=exports.remainBufferLength=exports.uuid=exports.any2Str=void 0,exports.any2Str=n,exports.uuid=o,exports.remainBufferLength=i,exports.getCookie=u,exports.coverImg=a,exports.runOnlyOnce=c,exports.roundNumber=l,exports.throttle=s,exports.debounce=p,exports.sleep=f,exports.equalsUuid=x,exports.seiKeyComparator=d;var m="TextDecoder"in window?new TextDecoder:null;function y(e){return null==m?"":m.decode(e)}function h(e,t){var r=setTimeout(function(){t()},Math.floor(Math.random()*e));return function(){clearTimeout(r)}}exports.uint8ArrayToString=y,exports.disperseAction=h;var v=function(){var e=!1;try{var t=document.createElement("canvas");t.width=1,t.height=1,e=t.toDataURL("image/webp").startsWith("data:image/webp")}catch(r){}return e};exports.isWebPSupported=v;var b=function(){var e=document.createElement("video");return"probably"===e.canPlayType('video/mp4;codecs="ec-3"')&&"probably"===e.canPlayType('video/mp4;codecs="ac-3"')};exports.isSupportDolby=b;var g=function(e){var t=Math.floor(e/3600),r="0".concat(Math.floor((e-3600*t)/60)).slice(-2),n="0".concat(Math.floor(e%60)).slice(-2);return"".concat(0!==t?t.toFixed(0)+":":"").concat(r,":").concat(n)};function w(e){return t(this,void 0,Promise,function(){var t,n,o;return r(this,function(r){return t=document.createElement("script"),n=document.getElementsByTagName("head")[0],o=new Promise(function(e,r){t.onload=function(){e()},t.onerror=r}),t.src=e,null!=n&&n.appendChild(t),[2,o]})})}function S(e,t){var r={};return Object.keys(t).forEach(function(n){var o=e[n],i=t[n];"number"==typeof i?r[n]=i-(null!=o?o:0):Object.getPrototypeOf(i)===Object.prototype?r[n]=S(o,i):r[n]=i}),r}exports.formatTime=g,exports.loadScript=w,exports.minusObject=S;
},{}],"GlyE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=navigator.userAgent,e={chrome:/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9.]+)/,edg:/Edg\/([0-9._]+)/,safari:/Version\/([0-9._]+).*Safari/},n=i.includes("Windows NT"),r=i.includes("Mac OS X"),t=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod","iOS"].includes(navigator.platform)||i.includes("Mac")&&"ontouchend"in document,o=e.safari.test(i),u=e.chrome.test(i),a=e.edg.test(i),s=function(){function n(e){var n;return Number(null===(n=e.exec(i))||void 0===n?void 0:n[1].split(".")[0])}return u?n(e.chrome):a?n(e.edg):o?n(e.safari):0}();exports.default={isWin:function(){return n},isMac:function(){return r},isIOS:function(){return t},isSafari:function(){return o},isChrome:function(){return u},isEdg:function(){return a},version:function(){return s}};
},{}],"fk22":[function(require,module,exports) {
"use strict";function t(t,e){void 0===e&&(e={});var s=document.createElement(t),r=Object.assign({classname:"",attributes:[],text:"",textAsHtml:!1},e);return s.className=r.classname,s[r.textAsHtml?"innerHTML":"textContent"]=r.text,r.attributes.forEach(function(t){var e=t[0],r=t[1];s.setAttribute(e,r)}),s}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createElement=void 0,exports.createElement=t;
},{}],"Klvu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unloading=exports.loading=void 0;var e='\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; background: rgba(0, 0, 0, 0.5); border-radius: 10px; display: block; shape-rendering: auto;" width="50px" height="50px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n<g transform="rotate(0 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.8888888888888888s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(40 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.7777777777777778s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(80 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(120 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.5555555555555556s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(160 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.4444444444444444s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(200 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(240 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.2222222222222222s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(280 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.1111111111111111s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(320 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animate>\n  </rect>\n</g>\n</svg>\n';function t(t){t.querySelectorAll(".web-player-loading").forEach(function(e){return e.remove()});var n=document.createElement("div");n.classList.add("web-player-loading"),n.innerHTML=e,n.style.cssText="\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 10;\n    display: none;\n    pointer-events: none;\n  ",t.appendChild(n);var i=setTimeout(function(){n.style.display="flex"},500);return function(){clearTimeout(i),n.remove()}}function n(){document.querySelectorAll(".web-player-loading").forEach(function(e){return e.remove()})}exports.loading=t,exports.unloading=n;
},{}],"PFwM":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(a,o){function c(e){try{s(r.next(e))}catch(t){o(t)}}function i(e){try{s(r.throw(e))}catch(t){o(t)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(c,i)}s((r=r.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var n,r,a,o,c={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(c=0)),c;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return c.label++,{value:i[1],done:!1};case 5:c.label++,r=i[1],i=[0];continue;case 7:i=c.ops.pop(),c.trys.pop();continue;default:if(!(a=(a=c.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){c=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){c.label=i[1];break}if(6===i[0]&&c.label<a[1]){c.label=a[1],a=i;break}if(a&&c.label<a[2]){c.label=a[2],c.ops.push(i);break}a[2]&&c.ops.pop(),c.trys.pop();continue}i=t.call(e,c)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ajax=void 0;var r=require("./common-utils"),a="//api.live.bilibili.com",o=new Map,c=new Set;function i(i,s){var u;return t(this,void 0,Promise,function(){var t,l,f,p,h,d,w,b,v,y,m,g,E,x,_,j;return n(this,function(n){switch(n.label){case 0:return t=performance.now(),l=i,/^(https?:)?\/\//.test(i)||(l="".concat(a,"/").concat(i.replace(/^\//,""))),f=new URL(l,location.href),null==(p=o.get(f.host+f.pathname))?[3,2]:p.expiresTime>performance.now()?(h=Math.random()*p.scope,[4,(0,r.sleep)(h)]):[3,2];case 1:n.sent(),n.label=2;case 2:""!==(d=(0,r.getCookie)("bili_jct"))&&"POST"===(null==s?void 0:s.method)&&null!=(null==s?void 0:s.data)&&(w=new FormData,b=e(e({},null!==(u=s.data)&&void 0!==u?u:{}),{csrf:d,csrf_token:d}),Object.keys(b).forEach(function(e){w.append(e,b[e])}),s.body=w),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,fetch(l,e({credentials:"include"},null!=s?s:{}))];case 4:return v=n.sent(),[3,6];case 5:throw y=n.sent(),m=String(y),c.forEach(function(e){return e("requestErr",{errMsg:m,apiUrl:f.pathname})}),new Error(m);case 6:if(!v.ok)throw g="url: ".concat(i,", status: ").concat(v.status),c.forEach(function(e){return e("responseErr",{errMsg:"status: ".concat(v.status),apiUrl:f.pathname})}),new Error(g);return[4,v.json()];case 7:if(E=n.sent(),c.forEach(function(e){return e("perf",{duration:performance.now()-t,apiUrl:f.pathname})}),"function"==typeof(null==s?void 0:s.handleRes))return s.handleRes(E),[2,E.data];if(x=E.code,_=E.data,j=E.message,0!==x)throw c.forEach(function(e){return e("apiBizErr",{errMsg:j,apiUrl:f.pathname})}),new Error(j);return[2,_]}})})}exports.ajax=i,i.watch=function(e){return c.add(e),function(){c.delete(e)}},i.disperse=function(e,t){var n=/^(https?:)?\/\//.test(e)?e:"".concat(a,"/").concat(e.replace(/^\//,""));o.set(n.replace(/^(https?:)?\/\//,""),t)};
},{"./common-utils":"MFFc"}],"hSGw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.monitorFPS=void 0;var e=[],n=new Set,t=0,r=0,i=[],o=!1,a=0,u=function u(){t++;var c=performance.now(),f=c-r;if(f>=1e3){var l=Math.round(1e3*t/f);if(r=c,t=0,i.push(l),10===(i=i.slice(-10)).length)for(var s=Math.max.apply(Math,i),d=0,v=e;d<v.length;d++){var h=v[d],m=h[0],p=h[1];s<m&&p.forEach(function(e){return e()})}var y=i.reduce(function(e,n){return e+n},0)/i.length;n.forEach(function(e){return e(y)})}o&&(a=requestAnimationFrame(u))};function c(){r=performance.now(),i=[],t=0,cancelAnimationFrame(a),a=requestAnimationFrame(u)}function f(t,r){if("alert"===t.type){var i=e.find(function(e){var n=e[0];return t.threshold===n});null==i&&(i=[t.threshold,new Set],e.push(i),e.sort(function(e,n){return e[0]-n[0]})),i[1].add(r)}else"avg"===t.type&&n.add(r);return o||(o=!0,c()),function(){var i;"alert"===t.type?null===(i=e.find(function(e){return e[0]===t.threshold}))||void 0===i||i[1].delete(r):"avg"===t.type&&n.delete(r),e.map(function(e){return e[1]}).every(function(e){return 0===e.size})&&0===n.size&&(o=!1,cancelAnimationFrame(a))}}document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&c()}),exports.monitorFPS=f;
},{}],"KaYZ":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.isHardSupportHEVC=void 0;var t=e(require("./ua"));function r(e,t){var r;void 0===t&&(t="video/mp4");var o=document.createElement("video");if("function"!=typeof o.canPlayType||"function"!=typeof(null===(r=window.MediaSource)||void 0===r?void 0:r.isTypeSupported))return!1;var n="".concat(t,'; codecs="').concat(e,'"'),a=o.canPlayType(n).toLowerCase();return!("maybe"!==a&&"probably"!==a||!window.MediaSource.isTypeSupported(n))}function o(){var e,t=document.createElement("canvas"),r=!1;try{var o=null!==(e=t.getContext("webgl"))&&void 0!==e?e:t.getContext("experimental-webgl");if(null==o)return r;var n=o.getExtension("WEBGL_debug_renderer_info");if(null==n)return r;-1===o.getParameter(n.UNMASKED_RENDERER_WEBGL).toString().toLowerCase().indexOf("swiftshader")&&(r=!0)}catch(a){}return r}function n(){return t.default.isIOS()||r("hvc1.1.6.L123")&&(t.default.isSafari()||o()&&(t.default.isChrome()||t.default.isEdg()&&t.default.version()>99))}exports.isHardSupportHEVC=n;
},{"./ua":"GlyE"}],"JKnM":[function(require,module,exports) {
"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(t)}var t=this&&this.__assign||function(){return(t=Object.assign||function(n){for(var t,o=1,e=arguments.length;o<e;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Level=void 0;var o,e=require("./common");!function(n){n[n.Debug=0]="Debug",n[n.Info=1]="Info",n[n.Warn=2]="Warn",n[n.Error=3]="Error"}(o=exports.Level||(exports.Level={}));var r={printToConsole:!1,debug:f,info:s,warn:a,error:l,dump:y,history:p,watch:b,stringify:v,clear:g},c=[],i=new Set;function u(e,u){var f={content:"object"===n(e)?JSON.stringify(e,function(n,t){return t instanceof Error?t.toString():t}):e,level:u,ts:Date.now()};if(c.push(f),r.printToConsole){var s=o[u].toLowerCase();console[s](e)}setTimeout(function(){i.forEach(function(n){return n(t({},f))})},1)}function f(n){u(n,o.Debug)}function s(n){u(n,o.Info)}function a(n){u(n,o.Warn)}function l(n){e.wpd.Log2Console&&console.error(n),u(n,o.Error)}function p(){return c.slice(0)}function y(){return c.map(function(n){return v(n)}).join("\n")}function g(){c=[]}function b(n){return i.add(n),function(){i.delete(n)}}function v(n,t){var e=Object.assign({tag:!0,time:!0},t),r=new Date(n.ts),c="".concat(o[n.level]," "),i="".concat(r.getHours(),":").concat(r.getMinutes(),":").concat(r.getSeconds(),".").concat(r.getMilliseconds());return"".concat(e.tag?c:"").concat(e.time?i:"","> ").concat(n.content)}exports.default=r;
},{"./common":"KGHo"}],"JkDX":[function(require,module,exports) {
"use strict";var t,e=this&&this.__classPrivateFieldGet||function(t,e,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(t):n?n.value:e.get(t)},r=this&&this.__classPrivateFieldSet||function(t,e,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(t,r):o?o.value=r:e.set(t,r),r},n=this&&this.__spreadArray||function(t,e,r){if(r||2===arguments.length)for(var n,o=0,i=e.length;o<i;o++)!n&&o in e||(n||(n=Array.prototype.slice.call(e,0,o)),n[o]=e[o]);return t.concat(n||Array.prototype.slice.call(e))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventBus=void 0;var o=function(){function o(){var r=this;t.set(this,new Map),this.on=function(n,o){var i,a=null!==(i=e(r,t,"f").get(n))&&void 0!==i?i:new Set;return a.add(o),e(r,t,"f").has(n)||e(r,t,"f").set(n,a),function(){a.delete(o),0===a.size&&e(r,t,"f").delete(n)}},this.emit=function(n){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var a=e(r,t,"f").get(n);null!=a&&a.forEach(function(t){return t.apply(void 0,o)})}}return o.forwardEvent=function(t,e,r){var o=r.map(function(r){var o=Array.isArray(r)?r:[r,r],i=o[0],a=o[1];return t.on(i,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return e.emit.apply(e,n([a],t,!1))})});return function(){o.forEach(function(t){return t()})}},o.prototype.getHandlers=function(r){var n;return null!==(n=e(this,t,"f").get(r))&&void 0!==n?n:new Set},o.prototype.once=function(t,e){var r=this.on(t,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];r(),e.apply(void 0,t)});return r},o.prototype.destroy=function(){r(this,t,new Map,"f")},o}();exports.EventBus=o,t=new WeakMap;
},{}],"BEmL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DebugUrlParamKeys=void 0;var e,o=new URL(location.href).searchParams;!function(e){e.P2PType="wpdP2PType",e.SupportHEVC="wpdSupportHEVC",e.Log2Console="wpdLog2Console",e.SocketMsg2Console="wpdSocketMsg2Console",e.DMRenderType="wpdDMRenderType"}(e=exports.DebugUrlParamKeys||(exports.DebugUrlParamKeys={}));var r=o.get(e.P2PType),p=o.get(e.Log2Console),l=o.get(e.SupportHEVC),s=o.get(e.SocketMsg2Console);exports.default={P2PType:null==r?null:Number(r),Log2Console:null!=p&&"0"!==p,SupportHEVC:null!=l&&"0"!==l,SocketMsg2Console:null!=s&&"0"!==s,DMRenderType:o.get(e.DMRenderType)};
},{}],"wHWR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.setToastCssText=void 0;var t=null,e=function(e){t=e};function n(e,n){document.querySelectorAll(".web-player-toast").forEach(function(t){return t.remove()});var o=document.createElement("div");o.classList.add("web-player-toast"),o.textContent=e,o.style.cssText=null!=t?t:"\n      font-size: 14px;\n      color: #fff;\n      background-color: rgba(0, 0, 0, 0.6);\n      position: absolute;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 11;\n      padding: 6px 12px;\n      border-radius: 6px;\n      transition: opacity 1s;\n    ",n.appendChild(o),setTimeout(function(){o.style.opacity="0"},1500),setTimeout(function(){o.remove()},2500)}exports.setToastCssText=e,exports.default=n;
},{}],"U3yD":[function(require,module,exports) {
"use strict";var t=this&&this.__assign||function(){return(t=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},e=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});var n=e(require("./logger")),a="web-player-ui-config",r=0;function o(){var t,e=localStorage.getItem("".concat(a,":").concat(r)),o={volume:{value:90,disabled:!1},danmaku:{display:!0,opacity:100,fontScale:100,density:100,area:4,showMaskOption:!1,enableMask:!0},subtitle:{pos:null,visible:!1,draggable:!1}};if(null===e)return o;try{t=JSON.parse(e)}catch(i){return n.default.error(i),o}return t=Object.assign({},o,t)}function i(t){r=t}function u(){return o().danmaku}function c(){return o().volume}function s(e){var n=o();localStorage.setItem("".concat(a,":").concat(r),JSON.stringify(t(t({},n),{volume:e})))}function l(e){var n=o();localStorage.setItem("".concat(a,":").concat(r),JSON.stringify(t(t({},n),{danmaku:e})))}function f(t){return o()[t]}function g(e,n){var i,u=o();localStorage.setItem("".concat(a,":").concat(r),JSON.stringify(t(t({},u),((i={})[e]=Object.assign({},u[e],n),i))))}exports.default={getDanmaku:u,getVolume:c,init:i,setDanmaku:l,setVolume:s,get:f,set:g};
},{"./logger":"JKnM"}],"Qw13":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./event-bus"),n=new e.EventBus;function t(e,t){return n.on(e,t)}function i(){n.destroy(),n=new e.EventBus}null!=navigator.mediaSession&&(navigator.mediaSession.setActionHandler("pause",function(){n.emit("pause")}),navigator.mediaSession.setActionHandler("play",function(){n.emit("play")})),exports.default={on:t,destroy:i};
},{"./event-bus":"JkDX"}],"KGHo":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,t,r,o){void 0===o&&(o=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,o,n)}:function(e,t,r,o){void 0===o&&(o=r),e[o]=t[r]}),t=this&&this.__exportStar||function(t,r){for(var o in t)"default"===o||Object.prototype.hasOwnProperty.call(r,o)||e(r,t,o)},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mediaAction=exports.userSetting=exports.setToastCssText=exports.toast=exports.wpd=exports.LogLevel=exports.LogItem=exports.logger=exports.ua=void 0,t(require("./interface"),exports),t(require("./common-utils"),exports);var o=require("./ua");Object.defineProperty(exports,"ua",{enumerable:!0,get:function(){return r(o).default}}),t(require("./create-element"),exports),t(require("./loading"),exports),t(require("./ajax"),exports),t(require("./fps-monitor"),exports),t(require("./compatibility-check"),exports);var n=require("./logger");Object.defineProperty(exports,"logger",{enumerable:!0,get:function(){return r(n).default}}),Object.defineProperty(exports,"LogItem",{enumerable:!0,get:function(){return n.LogItem}}),Object.defineProperty(exports,"LogLevel",{enumerable:!0,get:function(){return n.Level}}),t(require("./event-bus"),exports);var i=require("./player-debug");Object.defineProperty(exports,"wpd",{enumerable:!0,get:function(){return r(i).default}});var u=require("./toast");Object.defineProperty(exports,"toast",{enumerable:!0,get:function(){return r(u).default}}),Object.defineProperty(exports,"setToastCssText",{enumerable:!0,get:function(){return u.setToastCssText}});var s=require("./user-setting");Object.defineProperty(exports,"userSetting",{enumerable:!0,get:function(){return r(s).default}});var a=require("./media-action");Object.defineProperty(exports,"mediaAction",{enumerable:!0,get:function(){return r(a).default}});
},{"./interface":"cPXi","./common-utils":"MFFc","./ua":"GlyE","./create-element":"fk22","./loading":"Klvu","./ajax":"PFwM","./fps-monitor":"hSGw","./compatibility-check":"KaYZ","./logger":"JKnM","./event-bus":"JkDX","./player-debug":"BEmL","./toast":"wHWR","./user-setting":"U3yD","./media-action":"Qw13"}],"lV3a":[function(require,module,exports) {
var define;
var t;!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof t&&t.amd?t([],r):"object"==typeof exports?exports.fmp4=r():e.fmp4=r()}(self,()=>{return t={958:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}function a(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=r(754),u=r(954),l=r(380),h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],c=[44100,48e3,32e3,-1],f=function(t,e){return 1===e&&(e=2),"mp4a."+t.toString(16)+(e?"."+e.toString():"")},d=a(function t(e,r,i,n,a){o(this,t),this.profile=r,this.rate=i,this.channel=n,this.frame=a,this.codecs=f(e,r)}),_=a(function t(e,r,i,n){o(this,t),this.width=e,this.height=r,this.nalu=i,this.codecs=n});t.exports={audioTypeAAC:64,audioTypeMP3:107,getAacCodec:f,parseAudioInfo:function(t,e){if(64===e){if(t.length<2)return null;var r=t[0]>>>3&31,i=(7&t[0])<<1|t[1]>>>7&1,n=t[1]>>3&15;return new d(e,r,h[i],n,1024)}if(107===e){if(t.length<4)return null;var a=t[1]>>>3&3,o=t[1]>>>1&3;if(o<1||o>3)return null;var s,u,l=t[2]>>>2&3,f=3==(t[3]>>>6&3)?1:2;switch(a){case 3:s=c[l];break;case 2:s=c[l]>>>1;break;default:s=c[l]>>>2}switch(o){case 3:u=3===a?1152:576;break;case 2:u=1152;break;default:u=384}return new d(e,0,s,f,u)}return null},parseVideoInfo:function(t,e){var r;if(-7===e)r=new u.AvcParser;else if(-12===e)r=new l.HevcParser;else{if(-14!==e)return null;r=new s.Av1Parser}if(0!==r.parse(t))return null;var i=r.displaySize;return new _(i.width,i.height,r.nalu,r.codecs)}}},754:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var s=r(757),u=r(819).BitStream,l=function(){function t(){n(this,t),this.max_frame_width_minus_1=0,this.max_frame_height_minus_1=0}return o(t,[{key:"parse",value:function(t){var e,r,i,n,a=[],o=0,s=0,u=0,l=0,h=[],c=[],f=[],d=[],_=[],y=[],p=[],v=[],m=function(t,e){var r=s+1;d[e]=t.readBits(r),_[e]=t.readBits(r),y[e]=t.readBits(1)};if(n=t.readBits(3),t.readBits(1),0!=(e=t.readBits(1)))a[0]=t.readBits(5);else{0!=t.readBits(1)?(function(t){t.readBits(32),t.readBits(32),0!=t.readBits(1)&&function(t){for(var e=0;1!=t.readBits(1);)e++;if(e>=32)return 4294967295;var r=(1<<e)-1;r<0&&(r+=4294967296),e>0&&t.readBits(e)}(t)}(t),0!=(o=t.readBits(1))&&function(t){s=t.readBits(5),t.readBits(32),t.readBits(5),t.readBits(5)}(t)):o=0,u=t.readBits(1),l=t.readBits(5);for(var b=0;b<=l;b++)h[b]=t.readBits(12),a[b]=t.readBits(5),a[b]>7?c[b]=t.readBits(1):c[b]=0,0!=o?(f[b]=t.readBits(1),0!=f[b]&&m(t,b)):f[b]=0,0!=u&&(p[b]=t.readBits(1),0!=p[b]&&(v[b]=t.readBits(4)))}r=t.readBits(4),i=t.readBits(4),this.max_frame_width_minus_1=t.readBits(r+1),this.max_frame_height_minus_1=t.readBits(i+1),0!=(0!=e?0:t.readBits(1))&&(t.readBits(4),t.readBits(3)),t.readBits(1),t.readBits(1),t.readBits(1);var g=0;return 0!=e?g=0:(t.readBits(1),t.readBits(1),t.readBits(1),t.readBits(1),0!=(g=t.readBits(1))&&(t.readBits(1),t.readBits(1)),(0!=t.readBits(1)?0:t.readBits(1))>0&&(0!=t.readBits(1)||t.readBits(1)),0!=g&&t.readBits(3)),t.readBits(1),t.readBits(1),t.readBits(1),function(t){var e,r=t.readBits(1),i=0;2==n&&0!=r?i=t.readBits(1)?12:10:n<=2&&(i=r?10:8),e=1==n?0:t.readBits(1);var a=0,o=0,s=0;0!=t.readBits(1)?(a=t.readBits(8),o=t.readBits(8),s=t.readBits(8)):(a=2,o=2,s=2);var u=0,l=0;if(e)return t.readBits(1),u=1,void(l=1);1==a&&13==o&&0==s?(u=0,l=0):(t.readBits(1),0==n?(u=1,l=1):1==n?(u=0,l=0):12==i?l=(u=t.readBits(1))?t.readBits(1):0:(u=1,l=0),u&&l&&t.readBits(2)),t.readBits(1)}(t),t.readBits(1),t.getOffset()}},{key:"displaySize",get:function(){return{width:this.max_frame_width_minus_1+1,height:this.max_frame_height_minus_1+1}}}]),t}(),h=function(){function t(){n(this,t),this.seq_profile=0,this.seq_level_idx_0=0,this.seq_tier_0=0,this.high_bitdepth=0,this.twelve_bit=0,this.nalu=1,this.config_obus=[],this.onCustomData=void 0}return o(t,[{key:"onMetadataUserData",value:function(e){for(var r=new u(e);r.getOffset().bytes<e.length&&!(r.getOffset().bytes+1>=e.length);){var i=t.parseLeb128(r),n=r.getOffset().bytes,a=e.subarray(n,n+i);a.length>=16&&this.onCustomData&&this.onCustomData(a.slice(0,16),a.slice(16)),r.setOffset(n+i,0)}}},{key:"parse",value:function(t){this.seq_profile=t[1]>>>5,this.seq_level_idx_0=31&t[1],this.seq_tier_0=t[2]>>>7,this.high_bitdepth=t[2]>>>6&1,this.twelve_bit=t[2]>>>5&1;var e=t.subarray(4,t.length);return this.parseObus(e),0}},{key:"parseObus",value:function(e){for(var r=new u(e);r.getOffset().bytes<e.length;){var i=t.parseObuHeader(r),n=void 0;0!==i.obu_has_size_field&&(n=t.parseLeb128(r));var a=r.getOffset().bytes,o=8*r.getOffset().bytes+r.getOffset().bits;switch(0===i.obu_has_size_field&&(n=e.length-a),i.obu_type){case 1:var s=new l;s.parse(r),this.config_obus.push(s);break;case 5:var h=t.parseLeb128(r),c=r.getOffset().bytes,f=e.subarray(c,a+n);7==h&&this.onMetadataUserData(f)}var d=8*r.getOffset().bytes+r.getOffset().bits-o;n>0&&4!=i.obu_type&&8!=i.obu_type&&6!=i.obu_type&&t.trailingBits(r,8*n-d),r.setOffset(a+n,0)}}},{key:"codecs",get:function(){var t;return t=2===this.seq_profile&&this.high_bitdepth?this.twelve_bit?12:10:this.high_bitdepth?10:8,"av01."+this.seq_profile+"."+s.to02uString(this.seq_level_idx_0)+(this.seq_tier_0?"H":"M")+"."+s.to02uString(t)}},{key:"displaySize",get:function(){var t=this.config_obus.length?this.config_obus[0].displaySize:null;return t||(t={width:1280,height:720}),t}}],[{key:"parseLeb128",value:function(t){for(var e=0,r=0;r<8;r++){var i=t.readBits(8);if(e|=(127&i)<<7*r,!(128&i))break}return e<0&&(e+=4294967296),e}},{key:"obuExtensionHeader",value:function(t){var e={};return e.temporal_id=t.readBits(3),e.spatial_id=t.readBits(2),e.extension_header_reserved_3bits=t.readBits(3),e}},{key:"parseObuHeader",value:function(e){var r={};return r.obu_forbidden_bit=e.readBits(1),r.obu_type=e.readBits(4),r.obu_extension_flag=e.readBits(1),r.obu_has_size_field=e.readBits(1),r.obu_reserved_1bit=e.readBits(1),1==r.obu_extension_flag&&(r.obu_ext_header=t.obuExtensionHeader(e)),r}},{key:"trailingBits",value:function(t,e){for(t.readBit(),e--;e>0;)t.readBit(),e--}}]),t}();t.exports={Av1Parser:h}},954:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var s=r(819).BitStream,u=r(757),l=function(){function t(){n(this,t),this.width=0,this.height=0}return o(t,[{key:"parse",value:function(t){var e=new s(t),r=1,i=this.profile_idc=e.readBits(8),n=e.readBits(8),a=(this.compatibility=n,this.level_idc=e.readBits(8),e.readUe(),0);if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||139===i||134===i||135===i)&&(3===(r=e.readUe())&&(a=e.readBit()),e.readUe(),e.readUe(),e.readBit(),0!==e.readBit()))for(var o=0;o<(3!==r?8:12);o++)e.readBit();e.readUe();var u=e.readUe();if(0===u)e.readUe();else if(1===u){e.readBit(),e.readSe(),e.readSe();var l=e.readUe();for(o=0;o<l;o++)e.readSe()}e.readUe(),e.readBit();var h=e.readUe(),c=e.readUe(),f=e.readBit();0===f&&e.readBit(),e.readBit();var d=e.readBit(),_=0,y=0,p=0,v=0;0!==d&&(_=e.readUe(),y=e.readUe(),p=e.readUe(),v=e.readUe()),e.readBit();var m,b=h+1,g=(c+1)*(2-(0!==f?1:0)),k=0!==f?1:0,w=0!==a?0:r;m=w>3?null:0===w?{dx:1,dy:2-k}:{dx:[0,2,2,1][w],dy:[0,2,1,1][w]*(2-k)};var S=0!==d,B=S?_*m.dx:0,P=S?p*m.dy:0,T=S?y*m.dx:0,M=S?v*m.dy:0;this.width=16*b-T-B,this.height=16*g-M-P}},{key:"displaySize",get:function(){return{width:this.width,height:this.height}}}]),t}(),h=function(){function t(){n(this,t),this.verison=0,this.profile=0,this.compatibility=0,this.level=0,this.nalu=4,this.sps=[]}return o(t,[{key:"parse",value:function(t){var e=t.length;if(e<7)return-1;this.version=t[0],this.profile=t[1],this.compatibility=t[2],this.level=t[3],this.nalu=1+(3&t[4]);var r=31&t[5];if(0===r)return-1;for(var i=6,n=0;n<r&&i+2<e;++n){var a=t[i]<<8|t[i+1];if(a+i+2+1>=e)return-1;try{var o=t.subarray(i+2+1,i+2+a-1),s=new l;s.parse(o),this.sps.push(s),0===n&&(this.profile=s.profile_idc,this.compatibility=-4&s.compatibility,this.level=s.level_idc)}catch(t){console.warn("parse avc-sps error")}i+=a+2}return 0}},{key:"codecs",get:function(){return"avc1."+u.to02xString(this.profile)+u.to02xString(this.compatibility)+u.to02xString(this.level)}},{key:"displaySize",get:function(){var t=this.sps.length?this.sps[0].displaySize:null;return t||(t={width:1280,height:720}),t}}]),t}();t.exports.AvcParser=h},819:t=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,r){for(var i=0;i<r.length;i++){var n=r[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,r){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===e(a)?a:String(a)),n)}var a}var i=[0,16,1,2,4,8,32,3,5,10,12,15,47,7,11,13,14,6,9,31,35,37,42,44,33,34,36,40,39,43,45,46,17,18,20,24,19,21,26,28,23,27,29,30,22,25,38,41],n=[47,31,15,0,23,27,29,30,7,11,13,14,39,43,45,46,16,3,5,10,12,19,21,26,28,35,37,42,44,1,2,4,8,17,18,20,24,6,9,22,25,32,33,34,36,40,38,41],a=[15,0,7,11,13,14,3,5,10,12,1,2,4,8,6,9],o=[0,1,2,4,8,3,5,10,12,15,7,11,13,14,6,9],s=function(t){!1===t&&console.warn(t)},u=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._data=e,this._bytes=e.length,this._offsetBits=0,this._offsetBytes=0}var e,u;return e=t,(u=[{key:"moveNextBit",value:function(){++this._offsetBits,this._offsetBits>=8&&(this._offsetBits%=8,this._offsetBytes+1<=this._bytes&&(++this._offsetBytes,this._offsetBytes<this._bytes&&3===this._data[this._offsetBytes]&&this._offsetBytes>1&&0===this._data[this._offsetBytes-1]&&0===this._data[this._offsetBytes-2]&&++this._offsetBytes))}},{key:"getOffset",value:function(){return{bytes:this._offsetBytes,bits:this._offsetBits}}},{key:"setOffset",value:function(t,e){return t>this._bytes||e>8?-1:(this._offsetBits=e,this._offsetBytes=t,0)}},{key:"nextBit",value:function(){return s(this._data&&this._bytes>0),this._offsetBytes>=this._bytes?-1:this._data[this._offsetBytes]>>>7-this._offsetBits&1}},{key:"nextBits",value:function(e){var r=new t(this._data);return r._offsetBits=this._offsetBits,r._offsetBytes=this._offsetBytes,r.readBits(e)}},{key:"readBit",value:function(){if(s(this._data&&this._bytes>0),this._offsetBytes>=this._bytes)return-1;var t=this._data[this._offsetBytes]>>>7-this._offsetBits&1;return this.moveNextBit(),s(0===t||1===t),t}},{key:"readBits",value:function(t){s(t>0&&t<=32);for(var e=0,r=0,i=0;r<t&&-1!==i;r++)i=this.readBit(),s(0===i||1===i),e=e<<1|i;return e}},{key:"readBool",value:function(){return 1===this.readBit()}},{key:"readUe",value:function(){var t,e=-1;for(t=0;!t&&-1!==t;++e)t=this.readBit(),s(0===t||1===t);return t=0,e>0&&(s(e<32),t=this.readBits(e)),(1<<e)-1+t}},{key:"readSe",value:function(){var t=this.readUe();return(t+1)/2*(0==t%2?-1:1)}},{key:"readMe",value:function(t,e){var r=this.readUe();return t?(s(r>=0&&r<48),0!==e?i[r]:n[r]):(s(r>=0&&r<16),0!==e?a[r]:o[r])}},{key:"readTe",value:function(){var t=this.readUe();return 1!==t?t:0!==this.readBit()?0:1}}])&&r(e.prototype,u),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports.BitStream=u},380:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var s=r(819).BitStream,u=function(){function t(){n(this,t),this.pic_width_in_luma_samples=0,this.pic_height_in_luma_samples=0}return o(t,[{key:"parse",value:function(t){var e=new s(t);e.readBits(16),e.readBits(4);var r=e.readBits(3);e.readBool(),this.general_profile_space=e.readBits(2),this.general_tier_flag=e.readBool(),this.general_profile_idc=e.readBits(5),this.general_profile_compatibility_flags=e.readBits(32),e.readBool(),e.readBool(),e.readBool(),e.readBool(),e.readBits(32),e.readBits(12),this.general_level_idc=e.readBits(8);for(var i=[],n=[],a=0;a<r;++a)i.push(e.readBool()),n.push(e.readBool());if(r>0)for(a=r;a<8;++a)e.readBits(2);for(a=0;a<r;++a)i[a]&&e.readBits(88),n[a]&&e.readBits(8);e.readUe(),3===e.readUe()&&e.readBool(),this.pic_width_in_luma_samples=e.readUe(),this.pic_height_in_luma_samples=e.readUe()}},{key:"displaySize",get:function(){return{width:this.pic_width_in_luma_samples,height:this.pic_height_in_luma_samples}}}]),t}(),l=function(){function t(){n(this,t),this.general_profile_space=0,this.general_profile_idc=0,this.general_level_idc=0,this.general_tier_flag=0,this.general_profile_compatibility_flags=0,this.nalu=4,this.sps=[]}return o(t,[{key:"parse",value:function(t){var e=t.length;if(e<23)return-1;if(1!==t[0])return-1;this.general_profile_space=t[1]>>6&3,this.general_tier_flag=t[1]>>5&1,this.general_profile_idc=31&t[1],this.general_profile_compatibility_flags=t[2]<<24|t[3]<<16|t[4]<<8|t[5];var r=t[6]<<24|t[7]<<16|t[8]<<8|t[9];r=r<<16|t[10]<<8|t[11],this.general_level_idc=t[12],this.nalu=1+(3&t[21]);for(var i=t[22],n=23,a=0;a<i;a++){if(n+3>t+e)return-1;var o=t[n],s=t[n+1]<<8|t[n+2];n+=3;for(var l=0;l<s;l++){if(n+2>e)return-1;var h=t[n]<<8|t[n+1];if(n+2+h>e)return-1;if(33==(63&o))try{var c=t.subarray(n+2,n+2+h),f=new u;f.parse(c),this.sps.push(f),0==l&&(this.general_profile_compatibility_flags=f.general_profile_compatibility_flags,this.general_profile_space=f.general_profile_space,this.general_profile_idc=f.general_profile_idc,this.general_tier_flag=f.general_tier_flag?1:0,this.general_level_idc=f.general_level_idc)}catch(t){console.warn("parse hevc-sps error")}n+=2+h}}return 0}},{key:"codecs",get:function(){var t=this.general_profile_compatibility_flags;return t=(t=(t=(t=(t=t>>1&1431655765|(1431655765&t)<<1)>>2&858993459|(858993459&t)<<2)>>4&252645135|(252645135&t)<<4)>>8&16711935|(16711935&t)<<8)>>16|t<<16,"hvc1."+["","A","B","C"][this.general_profile_space%4]+this.general_profile_idc.toString()+"."+t.toString(16).toLowerCase()+"."+["L","H"][this.general_tier_flag%2]+this.general_level_idc.toString()}},{key:"displaySize",get:function(){var t=this.sps.length?this.sps[0].displaySize:null;return t||(t={width:1280,height:720}),t}}]),t}();t.exports.HevcParser=l},757:t=>{var e=[[0,200,0,128,35,128],[33,0,73,144,2,25,0,35,128],[0,200,0,128,32,132,1,38,64,8,100,0,142],[0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56],[0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56],[0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]],r=[[1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90],[1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10],[1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10]],i=[90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94];function n(t,e,r){for(;e<r;)if(3!==t[e]&&0!==t[e])e+=3;else{if(0===t[e-2]&&0===t[e-1]&&3===t[e])return e-2;e+=1}return null}t.exports={getSilentFrame:function(t,n){if(2===t){if(n>=1&&n<=6)return new Uint8Array(e[n-1])}else if(n>=1&&n<=3)return new Uint8Array(r[n-1].concat(i));return null},ebsp2rbsp:function(t){for(var e=t,r=e.byteLength,i=new Uint8Array(r),a=0,o=0;;){var s=n(e,o,r);if(null===s)break;i.set(e.subarray(o,s+2),a),a+=s-o+2,o=s+3}return i.set(e.subarray(o,e.length),a),a+=e.length-o,i.subarray(0,a)},to02uString:function(t){var e=t.toString(10);return e.length<2&&(e="0"+e),e},to02xString:function(t){var e=t.toString(16);return e.length<2&&(e="0"+e),e},equalsUuid:function(t,e){if(16!==t.length||16!==e.length)return!1;for(var r=0;r<16;++r)if(t[r]!==e[r])return!1;return!0}}},319:t=>{t.exports={SomeError:function(t,e){this.name=t,this.message=e,this.stack=(new Error).stack},errorAudioInfo:10001,errorVideoInfo:10002,errorAudioTrack:10003,errorVideoTrack:10004,errorUnknownCodec:10005,errorFlvPacket:10006,errorFlvDts:10007,errorNetworkTimeout:11e3,errorNetworkFetch:11001,errorNetworkRead:11002,errorMseOpen:11003,errorMseAppend:11004,errorM3u8Data:11010,errorMp4Data:11011,errorMp4Dts:11012,errorM3u8NotUpdate:11013,errorSwitchCrash:11020,errorSwitchTimeNotMatch:11021,errorSwitchCancel:11022}},809:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(){return(n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(arguments.length<3?t:r):n.value}}).apply(this,arguments)}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=r(319),l=r(690),h=r(118),c=r(15).e,f=r(97).StreamFetcher,d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(y,t);var e,r,l,d,_=(l=y,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,e=s(l);if(d){var r=s(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)}(this,t)});function y(t,e){var r;return function(t,e){if(!(t instanceof y))throw new TypeError("Cannot call a class as a function")}(this),r=_.call(this,t,e),console.log("fMp4Player ".concat(r.version)),r.maxDuration=30,r.minDuration=10,r.startTime=0,r._contentLength=void 0,r._loader=null,r._readDone=!1,r._readPaused=!1,r._readPosition=0,r._fmp4Muxer=null,r._checkBufferInterval=void 0,r._onCheckBufferBinder=r._onCheckBuffer.bind(o(r)),r._onResponseBinder=r._onResponse.bind(o(r)),r._onDataFetchedBinder=r._onDataFetched.bind(o(r)),r._onDataConvertedBinder=r._onDataConverted.bind(o(r)),r._onMetaDataBinder=r._onMetaDataParsed.bind(o(r)),r._onConvertErrorBinder=r._onConvertError.bind(o(r)),r._onReadErrorBinder=r._onReadError.bind(o(r)),r}return e=y,(r=[{key:"version",get:function(){return"v1.42"}},{key:"destroy",value:function(){n(s(y.prototype),"destroy",this).call(this),void 0!==this._checkBufferInterval&&(window.clearInterval(this._checkBufferInterval),this._checkBufferInterval=void 0),this._firstPacketNotified=!1,this._readPaused=!1,this._readDone=!0,this._loader&&(this._loader.destroy(),this._loader=null),this._fmp4Muxer&&(this._fmp4Muxer.destroy(),this._fmp4Muxer=null),this._contentLength=void 0}},{key:"src",set:function(t){this.destroy(),this._setup(t),this._fetchUrl()}},{key:"createFetcher",value:function(t,e,r){return new f(t,e,r)}},{key:"_fetchUrl",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._contentLength=void 0,this._receivedBytes=0,this._readDone=!1,this._readPaused=!1,this._readPosition=t,this._loader=this.createFetcher(this._onResponseBinder,this._onDataFetchedBinder,this._onReadErrorBinder),this._loader.fetchAsStream(this._url,!1,t,-1,this._timeout)}},{key:"_onDataConverted",value:function(t){this._ensureMse(this._mimeType),this._pushBuffer(t)}},{key:"_onMetaDataParsed",value:function(t){var e=this;if(this._mimeType=this._fmp4Muxer.mimeType,this.onMetaData&&this.onMetaData(t),this._contentLength&&this.startTime>0){var r=t.keyframes;if(r&&r.times&&r.filepositions){var i=c(r.times,this.startTime);if(i>=0&&i<r.filepositions.length){var n=r.filepositions[i];r.times[i]>this.startTime&&i>0&&(n=r.filepositions[--i]),this._fmp4Muxer&&this._fmp4Muxer.reset(),console.log("seek to: ".concat(r.times[i],"/").concat(t.duration,"s, pos=").concat(n));var a=function(){e._seekToPosition(n)};window.Promise?Promise.resolve().then(a):window.setTimeout(a,0)}else console.warn("seek failed: ".concat(this.startTime,"/").concat(t.duration,"s"))}this.startTime=0}}},{key:"_onConvertError",value:function(t,e){this._notifyParserError(t,{url:this._url,info:e})}},{key:"_onReadError",value:function(t,e){this._notifyNetworkError(t,{url:this._url,info:e})}},{key:"_processFetchedData",value:function(t){this._fmp4Muxer?this._fmp4Muxer.input(t):this._onDataConverted(t)}},{key:"_seekToPosition",value:function(t){this._fmp4Muxer&&this._fmp4Muxer.reset(),this._loader&&(this._loader.destroy(),this._loader=null),this._fetchUrl(t)}},{key:"_onDataFetched",value:function(t){return!(this._isDestroied||(!this._firstPacketNotified&&this.onFirstPacket&&(this._firstPacketNotified=!0,this.onFirstPacket()),t?(this._removeOutdated(),this._processFetchedData(t),this._receivedBytes+=t.length,this._readPosition+=t.length):t||(this._readDone=void 0===this._contentLength||this._receivedBytes>=this._contentLength,this._readDone&&this._pushEnd()),this._readDone||this._readPaused))}},{key:"_onResponse",value:function(t){if(this._isDestroied)return!1;if(!t.ok)return this._notifyNetworkError(u.errorNetworkFetch,{url:this._url,status:t.status}),!1;!this._firstResponseNotified&&this.onFirstResponse&&(this._firstResponseNotified=!0,this.onFirstResponse(t));var e=t.headers.get("Content-Length"),r=e?parseInt(e):void 0;void 0===this._contentLength&&(this._contentLength=r),this._contentLength&&void 0===this._checkBufferInterval&&(this._checkBufferInterval=window.setInterval(this._onCheckBufferBinder,500));var i=t.headers.get("Content-Type");return i&&-1!==i.indexOf("video/mp4")?(this._mimeType=i,this._fmp4Muxer=null):null===this._fmp4Muxer&&(this._mimeType=null,this._fmp4Muxer=new h.fMp4Muxer(250,this._onDataConvertedBinder,this._onMetaDataBinder,this.onSeiData,this._onConvertErrorBinder)),!0}},{key:"_onCheckBuffer",value:function(){var t=this.buffered;t<=this.minDuration&&this._readPaused&&this._receivedBytes<this._contentLength?(this._readPaused=!1,this._loader.fetchAsStream(this._url,!1,this._readPosition,-1,this._timeout)):t>=this.maxDuration&&!this._readPaused&&(this._readPaused=!0)}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),y}(l.LivePlayer);t.exports.R=d},521:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(){return(n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=s(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(arguments.length<3?t:r):n.value}}).apply(this,arguments)}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function o(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function s(t){return(s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var u=r(319),l=r(690),h=r(97).Fetcher,c=r(909).t,f=r(615),d=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(y,t);var e,r,l,d,_=(l=y,d=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,e=s(l);if(d){var r=s(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return o(t)}(this,t)});function y(t,e){var r;return function(t,e){if(!(t instanceof y))throw new TypeError("Cannot call a class as a function")}(this),r=_.call(this,t,e),console.log("Hls7Player ".concat(r.version)),r._playlist=null,r._updateMasterPlaylistHandler=null,r._fetchM3u8Timer=void 0,r._fetchM3u8Binder=r._fetchM3u8.bind(o(r)),r._onM3u8ResponsedBinder=r._onM3u8Responsed.bind(o(r)),r._onM3u8FetchedBinder=r._onM3u8Fetched.bind(o(r)),r._onM3u8FetchErrorBinder=r._onM3u8FetchError.bind(o(r)),r._fetchedM4sCount=0,r._lastFetchM4sBegin=null,r._lastFetchM4sEnd=null,r._lastFetchM4sUrl=null,r._lastFetchInitM4sBegin=null,r._lastFetchM3u8Begin=null,r._lastFetchM3u8End=null,r._lastFetchMasterM3u8Begin=null,r._lastFetchM3u8=0,r._lastM3u8Sequence=0,r._lastM3u8Updated=0,r._initDone=!1,r._lastDuration=0,r._totalDuration=0,r._tryM3u8Times=0,r._pendingBuffers=[],r._onM4sResponsedBinder=r._onM4sResponsed.bind(o(r)),r._onM4sFetchedBinder=r._onM4sFetched.bind(o(r)),r._onM4sFetchErrorBinder=r._onM4sFetchError.bind(o(r)),r._mp4Parser=null,r._onM4sParsedBinder=r._onM4sParsed.bind(o(r)),r._m3u8Fetcher=new h(r._onM3u8ResponsedBinder,r._onM3u8FetchedBinder,r._onM3u8FetchErrorBinder),r._m4sFetcher=new h(r._onM4sResponsedBinder,r._onM4sFetchedBinder,r._onM4sFetchErrorBinder),r._savedFetchAsStream=r._m4sFetcher.fetchAsStream,r._minBufferLength=0,r._onPlaylistUpdate=function(t,e){},r._masterPlaylistProcessor=r._defaultMasterPlaylistProcessor.bind(o(r)),r._fetchSwitchPlaylistTimer=void 0,r._paddingSwitchPlaylistResolve=null,r._targetSwitchPlaylistUrl=null,r._trySwitchPlaylistCount=0,r._trySwitchPlaylistMaxCount=5,r._trimStartKeepTimeMs=0,r}return e=y,(r=[{key:"version",get:function(){return"v1.91"}},{key:"destroy",value:function(){n(s(y.prototype),"destroy",this).call(this),void 0!==this._fetchM3u8Timer&&(window.clearTimeout(this._fetchM3u8Timer),this._fetchM3u8Timer=void 0),this._fetchedM4sCount=0,this._mp4Parser=null,this._playlist=null,this._initDone=!1,this._lastDuration=0,this._lastM3u8Sequence=0,this._totalDuration=0,this._tryM3u8Times=0,this._pendingBuffers=[],this.cancelSwitchPlaylistUrl()}},{key:"setP2PContext",value:function(t){this._isDestroied||(t?(null!=t.P2PBufferLength&&(this._minBufferLength=t.P2PBufferLength),null!=t.P2PFetchAsStream&&(this._m4sFetcher.fetchAsStream=t.P2PFetchAsStream),null!=t.onPlaylistUpdate&&(this._onPlaylistUpdate=t.onPlaylistUpdate)):(this._minBufferLength=0,this._m4sFetcher.fetchAsStream=this._savedFetchAsStream,this._onPlaylistUpdate=function(t,e){}),this._playlist&&(this._playlist.onPlaylistUpdate=this._onPlaylistUpdate))}},{key:"getAudioTracks",value:function(){return this._mp4Parser?this._mp4Parser.getAudioTracks():[]}},{key:"switchAudioTrack",value:function(t){return!!this._mp4Parser&&this._mp4Parser.switchAudioTrack(t)}},{key:"cancelSwitchPlaylistUrl",value:function(){void 0!==this._fetchSwitchPlaylistTimer&&(window.clearTimeout(this._fetchSwitchPlaylistTimer),this._fetchSwitchPlaylistTimer=void 0),this._notifySwitchPlaylistResolve(u.errorSwitchCancel),this._targetSwitchPlaylistUrl=null,this._trySwitchPlaylistCount=0}},{key:"switchPlaylistUrl",value:function(t){var e=this;return new Promise(function(r){e.cancelSwitchPlaylistUrl(),e._paddingSwitchPlaylistResolve=r,e._targetSwitchPlaylistUrl=t})}},{key:"setMasterPlaylistProcessor",value:function(t){return"function"==typeof t?(this._masterPlaylistProcessor=t.bind(this),!0):(this._masterPlaylistProcessor=this._defaultMasterPlaylistProcessor.bind(this),!1)}},{key:"getHLSNetworkState",value:function(){var t=performance.now();return{m3u8LastUpdated:Math.round(t-this._lastM3u8Updated),m3u8LastSeq:this._lastM3u8Sequence,m3u8LastEnd:null==this._lastFetchM3u8End?null:Math.round(t-this._lastFetchM3u8End),m3u8LastStarted:null==this._lastFetchM3u8Begin?null:Math.round(t-this._lastFetchM3u8Begin),m4sLastStarted:null==this._lastFetchM4sBegin?null:Math.round(t-this._lastFetchM4sBegin),m4sLastEnd:null==this._lastFetchM4sEnd?null:Math.round(t-this._lastFetchM4sEnd),m4sPath:this._lastFetchM4sUrl}}},{key:"_defaultMasterPlaylistProcessor",value:function(t,e){return t[0]}},{key:"_notifySwitchPlaylistResolve",value:function(t){this._paddingSwitchPlaylistResolve&&(this._paddingSwitchPlaylistResolve(t),this._paddingSwitchPlaylistResolve=null)}},{key:"_updateTargetPlaylist",value:function(t){var e=this;this._prefetchM3u8(t,function(t,r,i){var n=e._playlist;r&&n&&n.switchToNewPlaylist(t,r)},function(t,e,r){console.warn("prefetch error: ".concat(r," (").concat(e,", ").concat(t,")"))},2e3,3)}},{key:"fetchedM4sCount",get:function(){return this._fetchedM4sCount}},{key:"minBufferLength",get:function(){return this._minBufferLength},set:function(t){this._minBufferLength=t}},{key:"trimStartKeepTimeMs",set:function(t){this._trimStartKeepTimeMs=t}},{key:"src",set:function(t){this.destroy(),this._setup(t),this._playlist=new f.M3u8Context(this._trimStartKeepTimeMs),this._playlist.onSwitchToNextPlaylist=this._onSwitchToNextPlaylist.bind(this),this._playlist.setUrl(this._url),this._playlist.onPlaylistUpdate=this._onPlaylistUpdate,this._mp4Parser=new c(this._onM4sParsedBinder,this.onSeiData),this._fetchM3u8()}},{key:"_onSwitchToNextPlaylist",value:function(t){t?(this._url=this._targetSwitchPlaylistUrl,this._paddingSwitchPlaylistResolve(0)):this._paddingSwitchPlaylistResolve(u.errorSwitchCrash),this.cancelSwitchPlaylistUrl()}},{key:"_initMasterPlaylistUpdater",value:function(t){var e=this;null!==this._updateMasterPlaylistHandler&&clearTimeout(this._updateMasterPlaylistHandler);var r=function(t,r,i){var n=performance.now()-e._lastFetchMasterM3u8Begin;e._lastFetchMasterM3u8Begin=null;var a=e._playlist;if(r&&a&&!e._isDestroied&&e.onMasterPlaylistUpdate){var o=new f.BasicM3u8Parser;o.parse(r)===f.parsedOk&&o.streams.length>0&&e.onMasterPlaylistUpdate(o.streams,o.streamInfMaps,o.steering),e._onUrlFetchDone(t,n)}},i=function(t,e,r){console.warn("update msater prefetch error: ".concat(r," (").concat(e,", ").concat(t,")"))};!function n(){e._updateMasterPlaylistHandler=setTimeout(function(){e._isDestroied||(e._lastFetchMasterM3u8Begin=performance.now(),e._prefetchM3u8(t,r,i,2e3,3),n())},e._masterPlaylistUpdateInterval)}()}},{key:"_doNextFetch",value:function(){var t=this,e=this._playlist,r=e.count,i=e.endOfStream;if(0===r&&i)this._pushEnd();else if(r>0&&(i||this._totalDuration<4e3||e.remainDuration>this._minBufferLength))this._fetchNextM4s();else{void 0!==this._fetchM3u8Timer&&(window.clearTimeout(this._fetchM3u8Timer),this._fetchM3u8Timer=void 0);var n=performance.now()-this._lastFetchM3u8,a=Math.round(this._lastDuration-n);this._tryM3u8Times=0,(a<0||a<100)&&(a=0),this._fetchM3u8Timer=window.setTimeout(this._fetchM3u8Binder,a),this._targetSwitchPlaylistUrl&&(this._trySwitchPlaylistCount<this._trySwitchPlaylistMaxCount?(this._trySwitchPlaylistCount++,void 0!==this._fetchSwitchPlaylistTimer&&window.clearTimeout(this._fetchSwitchPlaylistTimer),this._fetchSwitchPlaylistTimer=window.setTimeout(function(){t._fetchSwitchPlaylistTimer=void 0,t._updateTargetPlaylist(t._targetSwitchPlaylistUrl)},a/2)):(this._targetSwitchPlaylistUrl=null,this._paddingSwitchPlaylistResolve(u.errorSwitchTimeNotMatch)))}}},{key:"_prefetchM3u8",value:function(t,e,r,i,n){var a=this,o=0,s=new h(function(t,e){return!a._isDestroied&&!!e.ok},e,function(t,e,i){e===u.errorNetworkTimeout&&!a._isDestroied&&++o<n?(console.warn("prefetch ".concat(o,": ").concat(t," after 2s timeout")),l()):r(t,e,i)}),l=function(){try{s.fetchAsText(t,!1,i)}catch(e){r(t,u.errorNetworkFetch,e)}};l()}},{key:"_fetchM3u8",value:function(){try{this._lastFetchM3u8Begin=this._lastFetchM3u8=performance.now(),this._lastFetchM3u8End=null,this._m3u8Fetcher.fetchAsText(this._url,!1,2e3)}catch(t){this._notifyNetworkError(u.errorNetworkFetch,{url:this._url,info:t})}}},{key:"_fetchNextM4s",value:function(){var t=null;try{var e=this._playlist.shift();e&&(t=e.uri,this._lastDuration=Math.floor(1e3*e.duration),this._lastFetchM4sUrl=t,this._lastFetchM4sBegin=performance.now(),this._lastFetchM4sEnd=null,this._m4sFetcher.fetchAsStream(t,!1,this._timeout))}catch(e){this._notifyNetworkError(u.errorNetworkFetch,{url:t,info:e})}this._removeOutdated()}},{key:"_onM3u8Responsed",value:function(t,e){return!(this._isDestroied||(304===e.status?(this._isDestroied||this._doNextFetch(),1):e.ok?(!this._firstResponseNotified&&this.onFirstResponse&&(this._firstResponseNotified=!0,this.onFirstResponse(e)),0):(this._playlist&&(this._playlist.endOfStream=!0),this._notifyNetworkError(u.errorNetworkFetch,{url:t,status:e.status}),1)))}},{key:"_onM3u8Fetched",value:function(t,e,r){var i=performance.now(),n=i-this._lastFetchM3u8Begin;this._lastFetchM3u8Begin=null,this._lastFetchM3u8End=i;var a=this._playlist;if(e&&a){if(t!=this._url)return void this._fetchM3u8();var o=a.parse(e);if(o==f.parsedAsMaster)return this._url=this._masterPlaylistProcessor(a.streamUrls,a.streamInfMaps,a.steering),console.log("stream url: ".concat(this._url)),a.setUrl(this._url),this._fetchM3u8(),void this._initMasterPlaylistUpdater(t);if(o<0&&0===a.count)return void this._notifyParserError(u.errorM3u8Data,{url:t,info:o});if(this._lastM3u8Sequence!==a.lastSequence)this._lastM3u8Sequence=a.lastSequence,this._lastM3u8Updated=i;else if(i>=this._lastM3u8Updated+this._timeout)return void this._notifyParserError(u.errorM3u8NotUpdate,{url:t,info:Math.round(i-this._lastM3u8Updated)})}if(a&&a.count>0&&!this._initDone){var s=a.shift();try{this._lastFetchInitM4sBegin=performance.now(),new h(this._onM4sResponsedBinder,this._onInitM4sFetched.bind(this),this._onM4sFetchErrorBinder).fetchAsBuffer(s.uri)}catch(t){this._notifyNetworkError(u.errorNetworkFetch,{url:s?s.uri:null,info:t})}}this._isDestroied||(this._doNextFetch(),this._onUrlFetchDone(t,n))}},{key:"_onM3u8FetchError",value:function(t,e,r){e===u.errorNetworkTimeout&&!this._isDestroied&&++this._tryM3u8Times<3?(console.warn("fetch ".concat(this._tryM3u8Times,": ").concat(t," after 1s timeout")),this._fetchM3u8()):this._notifyNetworkError(e,{url:t,info:r})}},{key:"_onM4sResponsed",value:function(t,e){return!(this._isDestroied||!e.ok&&(this._notifyNetworkError(u.errorNetworkFetch,{url:t,status:e.status}),1))}},{key:"_onInitM4sFetched",value:function(t,e,r){var i=performance.now()-this._lastFetchInitM4sBegin;this._lastFetchInitM4sBegin=null,e&&(this._parseM4s(t,e,r),this._receivedBytes+=e.byteLength),r&&(this._initDone=!0,this._fetchedM4sCount++,this._onUrlFetchDone(t,i))}},{key:"_onM4sFetched",value:function(t,e,r){if(!this._isDestroied){!this._firstPacketNotified&&this.onFirstPacket&&(this._firstPacketNotified=!0,this.onFirstPacket());var i=performance.now(),n=i-this._lastFetchM4sBegin;if(r&&(this._lastFetchM4sBegin=null,this._lastFetchM4sEnd=i,this._totalDuration+=this._lastDuration,this._doNextFetch()),e){var a=this._pendingBuffers;if(this._initDone){for(;a.length>0;){var o=a.shift();this._parseM4s(o.url,o.buffer,o.done)}this._parseM4s(t,e,r)}else a.push({url:t,buffer:e,done:r});this._receivedBytes+=e.byteLength}r&&(this._fetchedM4sCount++,this._onUrlFetchDone(t,n,this._lastDuration))}}},{key:"_onM4sFetchError",value:function(t,e,r){this._notifyNetworkError(e,{url:t,info:r})}},{key:"_onM4sParsed",value:function(t,e){var r=this._mp4Parser;1836019574===e&&r&&r.metaData&&(this._mimeType=r.mimeType,this.onMetaData&&this.onMetaData(r.metaData)),r&&this._ensureMse(r.mimeType),this._pushBuffer(t)}},{key:"_onUrlFetchDone",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.onFileFetched&&this.onFileFetched(t,{used:Math.round(e),duration:r})}},{key:"_parseM4s",value:function(t,e,r){try{this._mp4Parser&&this._mp4Parser.parse(e,r)}catch(e){var i="DtsError"===e.name?u.errorMp4Dts:u.errorMp4Data;this._notifyParserError(i,{url:t,info:e.message})}}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),y}(l.LivePlayer);t.exports.m=d},690:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=r(483).E,a=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._mediaSource=e,this._player=r,this._url=null,this._isOpened=!1,this._isDestroied=!1,this._mimeType=null,this._mseController=null,this._keepUsedBuffer=10,this._timeout=0,this._masterPlaylistUpdateInterval=1e4,this._lastRemovedPos=0,this._firstResponseNotified=!1,this._firstPacketNotified=!1,this._receivedBytes=0,this.startTime=0,this.onFirstResponse=null,this.onFirstPacket=null,this.onMetaData=null,this.onSeiData=null,this.onEndOfStream=null,this.onFileFetched=null,this.onNetworkError=null,this.onParserError=null,this.onMasterPlaylistUpdate=null}var e,r;return e=t,(r=[{key:"destroy",value:function(){this._isDestroied||(this._isDestroied=!0,this._player.src&&URL.revokeObjectURL(this._player.src)),this._mseController&&(this._mseController.destroy(),this._mseController=null),this._isOpened=!1,this._lastRemovedPos=0,this._mimeType=null,this._firstResponseNotified=!1,this._firstPacketNotified=!1,this._receivedBytes=0}},{key:"version",get:function(){}},{key:"buffered",get:function(){var t=this._player.buffered;return t&&t.length>0?t.end(t.length-1)-this._player.currentTime:0}},{key:"mimeType",get:function(){return this._mimeType}},{key:"receivedBytes",get:function(){return this._receivedBytes}},{key:"keepUsedBuffer",set:function(t){this._keepUsedBuffer=t}},{key:"timeout",set:function(t){this._timeout=t}},{key:"masterPlaylistUpdateInterval",set:function(t){this._masterPlaylistUpdateInterval=t}},{key:"_notifyNetworkError",value:function(t,e){this.onNetworkError&&!this._isDestroied&&this.onNetworkError(t,e)}},{key:"_notifyParserError",value:function(t,e){this.onParserError&&!this._isDestroied&&this.onParserError(t,e)}},{key:"_onMseError",value:function(t,e){this._notifyParserError(t,{url:this._url,info:e})}},{key:"_setup",value:function(t){this._mseController&&this._mseController.destroy(),this._mseController=new n(this._mediaSource,this.onEndOfStream,this._onMseError.bind(this)),this._lastRemovedPos=0,this._receivedBytes=0,this._isDestroied=!1,this._url=t,this._mediaSource&&(this._mediaSource.createObjectURL?this._player.src=this._mediaSource.createObjectURL(this._player):this._player.src=URL.createObjectURL(this._mediaSource))}},{key:"_ensureMse",value:function(t){this._mimeType=t,t&&!this._isOpened&&this._mseController&&(this._isOpened=this._mseController.addSource(t))}},{key:"_pushBuffer",value:function(t){this._mseController&&this._mseController.pushBuffer(t)}},{key:"_pushEnd",value:function(){this._mseController&&this._mseController.pushEnd()}},{key:"_removeOutdated",value:function(){var t=this._player.currentTime;if(t>this._lastRemovedPos+this._keepUsedBuffer+10){var e=this._lastRemovedPos>10?this._lastRemovedPos-10:0,r=Math.floor(t-this._keepUsedBuffer);this._mseController&&this._mseController.removeBuffer(e,r)&&(this._lastRemovedPos=r)}}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports.LivePlayer=a},35:(t,e,r)=>{var i=r(221).checkChromeVer,n=r(704)._,a=r(809).R,o=r(521).m,s=r(313).V;t.exports={checkChromeVer:i,BufferDetector:n,fMp4Player:a,Hls7Player:o,NativePlayer:s}},118:(t,e,r)=>{function i(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var r=0;r<e.length;r++){var i=e[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,(n=function(t,e){if("object"!==a(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var i=r.call(t,"string");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(i.key),"symbol"===a(n)?n:String(n)),i)}var n}function u(t,e,r){return e&&s(t.prototype,e),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var l=r(958),h=r(319),c=r(541),f=r(274),d=r(221),_=r(757),y=r(497).$,p=r(754).Av1Parser,v=function(){function t(e,r,i){o(this,t),this.type=e,this.id=r,this.tag=i,this.baseMediaDecodeTime=0,this.extraData=null,this.dataOffset=0,this.duration=0,this.samples=[],this.sequenceDts=null,this.timestampOffset=0,this.totalDuration=0,this.totalSampleCount=0,this.audioInfo=null,this.objectType=0,this.defaultDuration=0,this.maxGapDuration=0,this.videoInfo=null,this.averageDuration=0}return u(t,[{key:"timeScale",get:function(){return null!==this.audioInfo?this.audioInfo.rate:9e4}},{key:"channelCount",get:function(){return null!==this.audioInfo?this.audioInfo.channel:null}},{key:"sampleRate",get:function(){return null!==this.audioInfo?this.audioInfo.rate:null}},{key:"sampleBits",get:function(){return 16}},{key:"width",get:function(){return null!==this.videoInfo?this.videoInfo.width:null}},{key:"height",get:function(){return null!==this.videoInfo?this.videoInfo.height:null}}]),t}(),m=function(){function t(e,r,i,n,a){o(this,t);var s=d.checkChromeVer();this._chrome4x=s>0&&s<=49,this._audioTrackIndex=-1,this._videoTrackIndex=-1,this._lastSegmentDts=0,this._mdatSize=0,this._metaChanged=0,this._metaData={},this._nextTrackId=1,this._onMetaData=i,this._onSegment=r,this._onSeiData=n,this._onError=a,this._parser=new c.FlvParser(this._onSampleReceived.bind(this),this._onMetaDataReceived.bind(this)),this._segmentIsGop=!0,this._segmentDuration=e,this._sequenceNumber=1,this._tracks=[],this._unknownTypes=new Set}return u(t,[{key:"destroy",value:function(){}},{key:"reset",value:function(){this._parser.clear(),this._lastSegmentDts=0,this._mdatSize=0,this._segmentIsGop=!0;var t,e=i(this._tracks);try{for(e.s();!(t=e.n()).done;){var r=t.value;r.samples.length=0,r.dataOffset=0,r.sequenceDts=null,r.timestampOffset=0,r.totalDuration=0,r.totalSampleCount=0}}catch(t){e.e(t)}finally{e.f()}}},{key:"input",value:function(t){try{this._parser.input(t)}catch(t){if(this._onError){var e="DtsError"===t.name?h.errorFlvDts:h.errorFlvPacket;this._onError(e,t.message)}}}},{key:"mimeType",get:function(){var t,e="",r=i(this._tracks);try{for(r.s();!(t=r.n()).done;){var n=t.value;null!==n.audioInfo?e+=n.audioInfo.codecs+",":null!==n.videoInfo&&(e+=n.videoInfo.codecs+",")}}catch(t){r.e(t)}finally{r.f()}for(;e.length>1&&","===e[e.length-1];)e=e.substring(0,e.length-1);return'video/mp4; codecs="'+e+'"'}},{key:"_addSample",value:function(t,e){t.samples.push(e),t.totalSampleCount++,this._mdatSize+=e.size}},{key:"_onAudioSample",value:function(e){var r=e.dts;if(-1===this._videoTrackIndex&&this._timeToOutput(!1,r)&&this._outputDataSegment(r),this._audioTrackIndex>=0&&this._audioTrackIndex<this._tracks.length){var i=this._tracks[this._audioTrackIndex];if(null===i.sequenceDts&&(i.sequenceDts=r),i.objectType===l.audioTypeAAC){var n=i.audioInfo.rate,a=t._millisecToAudioTs(r,i)-i.totalDuration;if(a>=i.maxGapDuration){var o=a/n;if(o>=30)throw new h.SomeError("DtsError","too large ".concat(o," underflow"));var s=Math.floor(a/i.defaultDuration);for(console.log("insert ".concat(s," frames due to ").concat(o," underflow"));s--;){var u=t._getSilentAacFrame(i,e.data);u.duration=i.defaultDuration,i.totalDuration+=u.duration,this._addSample(i,u)}}else if(a<=-i.maxGapDuration)return void console.log("skip 1 frame due to ".concat(-a/n," overflow"))}e.dts=i.totalDuration,e.duration=i.defaultDuration,i.totalDuration+=e.duration,this._addSample(i,e)}else console.warn("invalid audio track: ".concat(this._audioTrackIndex))}},{key:"_onVideoSample",value:function(e){var r=this,i=e.dts,n=1===e.flags;if(this._timeToOutput(n,i)&&(this._outputDataSegment(i),this._segmentIsGop=n),this._videoTrackIndex>=0&&this._videoTrackIndex<this._tracks.length){var a=this._tracks[this._videoTrackIndex];if(null===a.sequenceDts&&(a.sequenceDts=i,0===a.totalSampleCount&&(e.cts=0),e.flags=1),e.cts=Math.floor(90*e.cts),e.dts=t._millisecToVideoTs(i,a),a.samples.length>0){var o=a.samples[a.samples.length-1];o.duration=e.dts>o.dts?e.dts-o.dts:0}a.totalDuration=e.dts,a.totalSampleCount>0&&(a.averageDuration=Math.floor(a.totalDuration/a.totalSampleCount));var s=e.dts/9e4,u=e.cts/9e4;if(e.type===c.typeVideoH264||e.type===c.typeVideoH265)this._parseSeiData(e.data,e.size,s,u,a.videoInfo.nalu,e.type===c.typeVideoH265);else if(e.type===c.typeVideoAv1){var l=new p;l.onCustomData=function(t,e){r._onSeiData&&r._onSeiData(s,s+u,t,e)},l.parseObus(e.data)}this._addSample(a,e)}else console.warn("invalid video track: ".concat(this._videoTrackIndex))}},{key:"_onAudioTrack",value:function(e){var r=e.type===c.trackAudioAAC,i=r?l.audioTypeAAC:l.audioTypeMP3,n=l.parseAudioInfo(e.data,i);if(n){if(this._audioTrackIndex>=0&&this._audioTrackIndex<this._tracks.length){var a=this._tracks[this._audioTrackIndex];if(t._same_array(a.extraData,e.data))return;this._outputNow(),a.extraData=e.data,a.audioInfo=n,a.objectType=i,a.defaultDuration=n.frame,a.maxGapDuration=2*a.defaultDuration,t._resetTrackTimestamps(a)}else{var o=f.types.mp4a,s=new v("audio",this._nextTrackId++,o);s.extraData=r?e.data:null,s.audioInfo=n,s.objectType=i,s.defaultDuration=n.frame,s.maxGapDuration=2*s.defaultDuration,this._audioTrackIndex=this._tracks.length,this._tracks.push(s),this._outputNow()}this._metaData.audiosamplerate=n.rate,this._metaData.audiochannel=n.channel,this._metaChanged|=1}else this._onError&&this._onError(h.errorAudioInfo,"parse audio track failed")}},{key:"_onVideoTrack",value:function(e){var r=l.parseVideoInfo(e.data,e.type);if(r){if(this._videoTrackIndex>=0&&this._videoTrackIndex<this._tracks.length){var i=this._tracks[this._videoTrackIndex];if(t._same_array(i.extraData,e.data))return;this._outputNow(),i.extraData=e.data,i.videoInfo=r,t._fixLastVideoDuration(i,0),t._resetTrackTimestamps(i)}else{var n=void 0;switch(e.type){case c.trackVideoH264:n=f.types.avc1;break;case c.trackVideoH265:n=f.types.hvc1;break;case c.trackVideoAv1:n=f.types.av01}var a=new v("video",this._nextTrackId++,n);a.extraData=e.data,a.videoInfo=r,this._videoTrackIndex=this._tracks.length,this._tracks.push(a),this._outputNow()}this._metaData.width=r.width,this._metaData.height=r.height,this._metaData.fps||(this._metaData.fps=this._metaData.framerate),this._metaChanged|=2}else this._onError&&this._onError(h.errorVideoInfo,"parse video track failed")}},{key:"_onMetaDataReceived",value:function(t){if(t)for(var e in t)this._metaData[e]=t[e]}},{key:"_onSampleReceived",value:function(t){switch(t.type){case c.typeAudioAAC:this._onAudioSample(t);break;case c.typeVideoH264:case c.typeVideoH265:case c.typeVideoAv1:this._onVideoSample(t);break;case c.trackAudioAAC:case c.trackAudioMP3:this._onAudioTrack(t);break;case c.trackVideoH264:case c.trackVideoH265:case c.trackVideoAv1:this._onVideoTrack(t);break;default:this._unknownTypes.has(t.type)||(this._unknownTypes.add(t.type),this._onError&&this._onError(h.errorUnknownCodec,"unknown codec: ".concat(t.type)))}return!0}},{key:"_outputDataSegment",value:function(e){if(this._mdatSize&&this._metaChanged){this._onMetaData&&this._onMetaData(this._metaData),this._metaChanged=0;var r=f.initSegment(this._tracks);this._onSegment(r)}var n=this._tracks;if(this._mdatSize){var a=f.moofSize(n),o=8+this._mdatSize,s=new Uint8Array(a+o);s[a+0]=o>>>24&255,s[a+1]=o>>>16&255,s[a+2]=o>>>8&255,s[a+3]=255&o,s.set(f.types.mdat,a+4);var u,l=a+8,h=i(n);try{for(h.s();!(u=h.n()).done;){var c=u.value;c.samples.length>0&&("video"===c.type&&t._fixLastVideoDuration(c,e),this._chrome4x&&(c.samples[0].flags=1),c.baseMediaDecodeTime=c.samples[0].dts),c.dataOffset=l,l=t._concatenateSamplesData(c,s,l)}}catch(t){h.e(t)}finally{h.f()}var d=f.moof(this._sequenceNumber++,n);s.set(d),this._onSegment(s)}this._lastSegmentDts=e,this._mdatSize=0;var _,y=i(n);try{for(y.s();!(_=y.n()).done;){var p=_.value;p.samples.length=0,p.dataOffset=0}}catch(t){y.e(t)}finally{y.f()}}},{key:"_outputNow",value:function(){this._mdatSize>0&&this._outputDataSegment(this._lastSegmentDts)}},{key:"_parseSeiData",value:function(t,e,r,i,n,a){this._onSeiData&&y.parse(t,0,e,r,r+i,n,a,this._onSeiData)}},{key:"_timeToOutput",value:function(t,e){return!(!t||this._segmentIsGop)||e<this._lastSegmentDts||e>=this._lastSegmentDts+this._segmentDuration}}],[{key:"_same_array",value:function(t,e){var r=t?t.length:0;if(r!==(e?e.length:0))return!1;for(var i=0;i<r;i++)if(t[i]!==e[i])return!1;return!0}},{key:"_concatenateSamplesData",value:function(t,e,r){var n,a=i(t.samples);try{for(a.s();!(n=a.n()).done;){var o=n.value;e.set(o.data,r),r+=o.size}}catch(t){a.e(t)}finally{a.f()}return r}},{key:"_fixLastVideoDuration",value:function(e,r){if(e.samples.length>0){var i=e.samples[e.samples.length-1];0===i.duration&&(r=t._millisecToVideoTs(r,e),i.duration=r>i.dts?r-i.dts:e.averageDuration>0?e.averageDuration:1500,e.totalDuration+=i.duration)}}},{key:"_getSilentAacFrame",value:function(t,e){var r=_.getSilentFrame(t.audioInfo.profile,t.audioInfo.channel),i=t.totalDuration;return new c.Sample(c.typeAudioAAC,r||e,0,i,0)}},{key:"_millisecToAudioTs",value:function(t,e){return Math.floor((t-e.sequenceDts)*e.audioInfo.rate/1e3)+e.timestampOffset}},{key:"_millisecToVideoTs",value:function(t,e){return 90*(t-e.sequenceDts)+e.timestampOffset}},{key:"_resetTrackTimestamps",value:function(t){t.timestampOffset=t.totalDuration,t.sequenceDts=null}}]),t}();t.exports={fMp4Muxer:m}},274:t=>{function e(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(u)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}var i,n,a,o,s,u,l,h,c,f,d,_,y,p,v,m,b,g,k,w,S,B,P,T,M,x,D,U,E,A,O,I,C,F,j,R,N,L,q,V,H,z=Math.pow(2,32)-1;!function(){for(var t in S={avc1:[97,118,99,49],avcC:[97,118,99,67],av01:[97,118,48,49],av1C:[97,118,49,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],hvc1:[104,118,99,49],hvcC:[104,118,99,67],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],smhd:[115,109,104,100],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stss:[115,116,115,115],stsz:[115,116,115,122],stts:[115,116,116,115],styp:[115,116,121,112],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100]})S[t]=new Uint8Array(S[t]);B=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),M=new Uint8Array([109,112,52,50]),x=new Uint8Array([100,97,115,104]),P=new Uint8Array([0,0,0,1]),D=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),U=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),E={video:D,audio:U},I=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),O=new Uint8Array([0,0,0,0,0,0,0,0]),C=new Uint8Array([0,0,0,0,0,0,0,0]),F=C,j=C,R=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),N=C,A=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}(),i=function(t){var e,r,i=Array.prototype.slice.call(arguments,1),n=0;for(e=0;e<i.length;e++)n+=i[e].byteLength;for((r=new Uint8Array(n+8))[0]=r.byteLength>>>24&255,r[1]=r.byteLength>>>16&255,r[2]=r.byteLength>>>8&255,r[3]=255&r.byteLength,r.set(t,4),e=0,n=8;e<i.length;e++)r.set(i[e],n),n+=i[e].byteLength;return r},n=function(){return i(S.dinf,i(S.dref,I))},a=function(t){var e=t.extraData?t.extraData.length:0,r=13+(e>0?e+5:0),n=8+r+5+1,a=new Uint8Array([0,0,0,0,3,128|n>>>21,128|n>>>14,128|n>>>7,127&n,0,1,0,4,128|r>>>21,128|r>>>14,128|r>>>7,127&r,t.objectType,21,0,0,0,0,1,89,40,0,1,89,40]),o=0===e?null:new Uint8Array([5,128|e>>>21,128|e>>>14,128|e>>>7,127&e]),s=new Uint8Array([6,128,128,128,1,2]);return e>0?i(S.esds,a,o,t.extraData,s):i(S.esds,a,s)},o=function(){return i(S.ftyp,B,P,B,M,T,x)},v=function(t){return i(S.hdlr,E[t])},p=function(t){var e=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,t.duration>>>24&255,t.duration>>>16&255,t.duration>>>8&255,255&t.duration,85,196,0,0]);return t.sampleRate&&(e[12]=t.sampleRate>>>24&255,e[13]=t.sampleRate>>>16&255,e[14]=t.sampleRate>>>8&255,e[15]=255&t.sampleRate),i(S.mdhd,e)},y=function(t){return i(S.mdia,p(t),v(t.type),u(t))},s=function(t){return i(S.mfhd,new Uint8Array([0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]))},u=function(t){return i(S.minf,"video"===t.type?i(S.vmhd,A):i(S.smhd,O),n(),m(t))},q=function(t){var r=8;r+=16;var i,n=e(t);try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.samples.length;o>0&&(r+=8,r+=8+(a.defaultDuration?4:0)+16,r+=20,r+=24+o*(a.defaultDuration?4:12))}}catch(t){n.e(t)}finally{n.f()}return r},l=function(t,r){var n=[S.moof];n.push(s(t));var a,o=e(r);try{for(o.s();!(a=o.n()).done;){var u=a.value;u.samples.length>0&&n.push(g(u,0))}}catch(t){o.e(t)}finally{o.f()}return i.apply(null,n)},h=function(t){var r=[S.moov];r.push(f(t.length+1,0));var n,a=e(t);try{for(a.s();!(n=a.n()).done;){var o=n.value;r.push(d(o))}}catch(t){a.e(t)}finally{a.f()}return r.push(c(t)),i.apply(null,r)},c=function(t){var r,n=[S.mvex],a=e(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;n.push(k(o))}}catch(t){a.e(t)}finally{a.f()}return i.apply(null,n)},f=function(t,e){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t]);return i(S.mvhd,r)},m=function(t){return"video"===t.type?i(S.stbl,b(t),i(S.stts,N),i(S.stss,j),i(S.stsc,F),i(S.stsz,R),i(S.stco,C)):i(S.stbl,b(t),i(S.stts,N),i(S.stsc,F),i(S.stsz,R),i(S.stco,C))},b=function(t){return i(S.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===t.type?V(t):H(t))},V=function(t){var e=S.avcC;switch(t.tag){case S.avc1:e=S.avcC;break;case S.hvc1:e=S.hvcC;break;case S.av01:e=S.av1C}var r=[t.tag,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&t.width)>>8,255&t.width,(65280&t.height)>>8,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),i(e,t.extraData)];if(t.sarRatio){var n=t.sarRatio[0],a=t.sarRatio[1];r.push(i(S.pasp,new Uint8Array([(4278190080&n)>>24,(16711680&n)>>16,(65280&n)>>8,255&n,(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a])))}return i.apply(null,r)},H=function(t){return i(t.tag,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&t.channelCount)>>8,255&t.channelCount,(65280&t.sampleBits)>>8,255&t.sampleBits,0,0,0,0,(65280&t.sampleRate)>>8,255&t.sampleRate,0,0]),a(t))},_=function(t){var e=new Uint8Array([0,0,0,3,0,0,0,0,0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,0,(4278190080&t.duration)>>24,(16711680&t.duration)>>16,(65280&t.duration)>>8,255&t.duration,0,0,0,0,0,0,0,0,0,0,0,0,"audio"===t.type?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&t.width)>>8,255&t.width,0,0,(65280&t.height)>>8,255&t.height,0,0]);return i(S.tkhd,e)},g=function(t,e){var r,n,a,o,s,u=t.defaultDuration,l=u?131114:131106,h="audio"===t.type?33554432:16842752;return r=i(S.tfhd,new Uint8Array(u?[0,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u,h>>>24&255,h>>>16&255,h>>>8&255,255&h]:[0,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,h>>>24&255,h>>>16&255,h>>>8&255,255&h])),o=Math.floor(t.baseMediaDecodeTime/(z+1)),s=Math.floor(t.baseMediaDecodeTime%(z+1)),n=i(S.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),a=w(t,e),i(S.traf,r,n,a)},d=function(t){return i(S.trak,_(t),y(t))},k=function(t){var e=new Uint8Array([0,0,0,0,(4278190080&t.id)>>24,(16711680&t.id)>>16,(65280&t.id)>>8,255&t.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]);return i(S.trex,e)},w=function(t,e){var r=e+t.dataOffset,n=t.samples,a=n.length,o=t.defaultDuration,s=a>0&&1===n[0].flags,u=new Uint8Array(16+a*(o?4:12)),l=517;o||(l|=2304),u.set([1,(16711680&l)>>16,(65280&l)>>8,255&l,(4278190080&a)>>>24,(16711680&a)>>>16,(65280&a)>>>8,255&a,(4278190080&r)>>>24,(16711680&r)>>>16,(65280&r)>>>8,255&r],0);var h=12;if(u.set(s?[2,0,0,0]:[1,1,0,0],h),h+=4,o)for(var c=0;c<a;c++){var f=n[c].size;u.set([(4278190080&f)>>>24,(16711680&f)>>>16,(65280&f)>>>8,255&f],h),h+=4}else for(c=0;c<a;c++){var d=n[c],_=d.duration,y=d.size,p=d.cts;u.set([(4278190080&_)>>>24,(16711680&_)>>>16,(65280&_)>>>8,255&_,(4278190080&y)>>>24,(16711680&y)>>>16,(65280&y)>>>8,255&y,(4278190080&p)>>>24,(16711680&p)>>>16,(65280&p)>>>8,255&p],h),h+=12}return i(S.trun,u)},L=function(t){var e,r=o(),i=h(t);return(e=new Uint8Array(r.byteLength+i.byteLength)).set(r),e.set(i,r.byteLength),e},t.exports={moof:l,moov:h,types:S,initSegment:L,moofSize:q}},313:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(){return(n="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(arguments.length<3?t:r):n.value}}).apply(this,arguments)}function a(t,e){return(a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var s=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&a(t,e)}(h,t);var e,r,s,u,l=(s=h,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}(),function(){var t,e=o(s);if(u){var r=o(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return function(t,e){if(e&&("object"===i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(this,t)});function h(t,e){var r;return function(t,e){if(!(t instanceof h))throw new TypeError("Cannot call a class as a function")}(this),r=l.call(this,t,e),console.log("NativePlayer ".concat(r.version)),r}return e=h,(r=[{key:"version",get:function(){return"v1.0"}},{key:"destroy",value:function(){n(o(h.prototype),"destroy",this).call(this)}},{key:"src",set:function(t){this.destroy(),this._player.src=t,0!==this.startTime&&(this._player.currentTime=this.startTime)}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),h}(r(690).LivePlayer);t.exports.V=s},443:t=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,r){for(var i=0;i<r.length;i++){var n=r[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,r){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===e(a)?a:String(a)),n)}var a}function i(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=i(function t(e,r,i,a){n(this,t),this.name=e,this.value=r,this.offset=i,this.end=a}),o=function(){function t(){n(this,t);try{this._textDecoder=new TextDecoder}catch(t){this._textDecoder=null,this._fromChar=String.fromCodePoint?String.fromCodePoint:String.fromCharCode}}return i(t,[{key:"decodeUtf8",value:function(t){if(this._textDecoder){var e=t.indexOf(0);return-1!==e&&(t=t.subarray(0,e)),this._textDecoder.decode(t)}for(var r=t.length,i="",n=0;n<r;){var a=t[n++];if(0===a)break;var o=0;switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o=a;break;case 12:case 13:o=(31&a)<<6|63&t[n++];break;case 14:o=(15&a)<<12|(63&t[n++])<<6|(63&t[n++])<<0;break;case 15:o=(7&a)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++]}0!==o&&(i+=this._fromChar(o))}return i}},{key:"parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(r||(r=t.byteLength-1);e<r;)try{var i=this._parseValue(t,null,e),n=this._parseValue(t,i,i.offset);if(e=n.offset,"onMetaData"===i.value)return n.value}catch(t){console.warn("parse failed",t);break}return null}},{key:"_parseValue",value:function(t,e,r){var i,n=t.getUint8(r++),o=!1;switch(n){case 0:i=t.getFloat64(r),r+=8;break;case 1:i=!!t.getUint8(r),r+=1;break;case 2:case 12:var s=this._parseArray(t,r,12===n);r+=2+s.length,i=this.decodeUtf8(s);break;case 3:i={},r=this._parseObjects(t,r,65535,i);break;case 8:var u=t.getUint32(r);r+=4,i={},r=this._parseObjects(t,r,u,i);break;case 9:i=null,o=!0;break;case 10:var l=t.byteLength-1,h=t.getUint32(r);for(r+=4,i=[];h-- >0&&r<l;){var c=this._parseValue(t,null,r);r=c.offset,i.push(c.value)}break;case 11:i=this._parseDate(t,r),r+=10}return new a(e,i,r,o)}},{key:"_parseArray",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=r?t.getUint32(e):t.getUint16(e);return new Uint8Array(t.buffer,t.byteOffset+e+(r?4:2),i)}},{key:"_parseDate",value:function(t,e){var r=t.getFloat64(e),i=t.getInt16(e+8);return new Date(r+=60*i*1e3)}},{key:"_parseObject",value:function(t,e){var r=this._parseArray(t,e);e+=2+r.length;var i=this.decodeUtf8(r);return this._parseValue(t,i,e)}},{key:"_parseObjects",value:function(t,e,r,i){for(var n=t.byteLength-1;r-- >0&&e<n;){var a=this._parseObject(t,e);if(e=a.offset,a.end)break;i[a.name]=a.value}return e}}]),t}();t.exports.l=o},541:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}function a(t,e,r){return e&&n(t.prototype,e),r&&n(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=r(443).l,u=a(function t(e,r,i,n,a){o(this,t),this.type=e,this.data=r,this.cts=i,this.dts=n,this.duration=0,this.size=r.length,this.flags=a}),l=function(){function t(e,r){o(this,t),this._buffer=new Uint8Array(2097152),this._readPos=0,this._writePos=0,this._onSampleParsed=e,this._onMetaDataParsed=r}return a(t,[{key:"clear",value:function(){this._readPos=0,this._writePos=0}},{key:"input",value:function(t){for(this._writeToBuffer(t);this._parsePacket(););}},{key:"_parseHeader",value:function(){var e=this._writePos-this._readPos;if(e<9)return!1;var r=t._readUint32(this._buffer,this._readPos+5)+4;return!(e<r||(this._readPos+=r,0))}},{key:"_parsePacket",value:function(){var t=this._readPos,e=this._writePos-t;if(e<11)return!1;var r=this._buffer,i=r[t],n=r[t+1]<<16|r[t+2]<<8|r[t+3];if(5002753===n&&70===i)return this._parseHeader();if(n<=0||n>=12582912)throw new RangeError("invalid data size: ".concat(n));var a=11+n+4;if(e<a)return!1;this._readPos+=a;var o=r[t+4]<<16|r[t+5]<<8|r[t+6]|r[t+7]<<24,s=t+11,u=!0;switch(31&i){case 8:u=this._parseAudio(s,n,o);break;case 9:u=this._parseVideo(s,n,o);break;case 18:u=this._parseScript(s,n)}return u}},{key:"_parseAudio",value:function(t,e,r){var i=this._buffer,n=(240&i[t])>>>4;if(10===n){var a=0===i[t+1]?-n:n,o=new u(a,i.subarray(t+2,t+e),0,r,0);return this._onSampleParsed(o)}var s=new u(n,i.subarray(t+1,t+e),0,r,0);return this._onSampleParsed(s)}},{key:"_parseVideo",value:function(t,e,r){var i=this._buffer,n=(240&i[t])>>>4,a=15&i[t];if(7===a||12===a||14===a){var o=0===i[t+1]?-a:a,s=i[t+2]<<16|i[t+3]<<8|i[t+4];s=s<<8>>8;var l=new u(o,i.subarray(t+5,t+e),s,r,n);return this._onSampleParsed(l)}var h=new u(a,i.subarray(t+1,t+e),0,r,n);return this._onSampleParsed(h)}},{key:"_parseScript",value:function(t,e){var r=new DataView(this._buffer.buffer,t,e),i=(new s).parse(r);return this._onMetaDataParsed(i),!0}},{key:"_writeToBuffer",value:function(t){var e=t.length;if(this._writePos+e>this._buffer.length){var r=this._writePos-this._readPos,i=Math.max(this._buffer.length,r+2*e),n=new Uint8Array(i);n.set(this._buffer.subarray(this._readPos,this._writePos)),this._buffer=n,this._readPos=0,this._writePos=r}this._buffer.set(t,this._writePos),this._writePos+=e}}],[{key:"_readUint32",value:function(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}}]),t}();t.exports={typeAudioAAC:10,typeAudioMP3:2,typeVideoH264:7,typeVideoH265:12,typeVideoAv1:14,trackAudioAAC:-10,trackAudioMP3:-2,trackVideoH264:-7,trackVideoH265:-12,trackVideoAv1:-14},t.exports.Sample=u,t.exports.FlvParser=l},909:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}var o=r(443).l,s=r(958),u=r(319),l=r(221),h=r(757),c=r(497).$,f=r(754).Av1Parser,d=r(41),_=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var i=l.checkChromeVer();this._chrome4x=i>0&&i<=49,this.uint32_max=Math.pow(2,32),this.mimeType=null,this.metaData={},this._audioChannel=void 0,this._audioRate=void 0,this._audioCodec=null,this._videoWidth=void 0,this._videoHeight=void 0,this._videoCodec=null,this._videoTag=0,this._videoBaseDts=0,this._videoCtsFixed=!1,this._videoTrackId=void 0,this._videoFrames=[],this._lastMoofSize=void 0,this._lastTrackId=void 0,this._findingStartDts=!1,this._minStartDts=void 0,this._timeScaleMap=new Map,this._buffer=null,this._bytesInBuffer=0,this._onParsed=e,this._onSeiParsed=r,this._parseMoofBoxsBinder=this._parseMoofBoxs.bind(this),this._parseMoovBoxsBinder=this._parseMoovBoxs.bind(this),this._lastFmp4Track=null,this._lastFmp4TrackFragment=null,this._tracks=new Map,this._trackInfos=new Map,this._trackFragments=new Map,this._selectedAudioTrackId=void 0,this._defaultAudioTrackId=void 0,this._segContext=void 0,this._prevSegContext=void 0}var e,r,i;return e=t,i=[{key:"parseEncoder",value:function(t,e){var r=e,i=e+32;t.getUint8(e)<32&&(r++,i--);var n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength).subarray(r,i);return(new o).decodeUtf8(n)}},{key:"parseH264Codec",value:function(t,e){e+=8;var r=t.getUint8(e+1),i=t.getUint8(e+2),n=t.getUint8(e+3);return"avc1."+h.to02xString(r)+h.to02xString(i)+h.to02xString(n)}},{key:"parseH265Codec",value:function(t,e){e+=8;var r=t.getUint8(e+1),i=r>>6&3,n=r>>5&1,a=31&r,o=t.getUint32(e+2),s=t.getUint8(e+12),u=o;return u=(u=(u=(u=(u=u>>>1&1431655765|(1431655765&u)<<1)>>>2&858993459|(858993459&u)<<2)>>>4&252645135|(252645135&u)<<4)>>>8&16711935|(16711935&u)<<8)>>>16|u<<16,"hvc1."+["","A","B","C"][i%4]+a.toString()+"."+u.toString(16).toLowerCase()+"."+["L","H"][n%2]+s.toString()}},{key:"parseAV1Codec",value:function(t,e){e+=8;var r,i=t.getUint8(e+1),n=t.getUint8(e+2),a=i>>>5,o=31&i,s=n>>>7,u=n>>>6&1;return r=2===a&&u?n>>>5&1?12:10:u?10:8,"av01."+a+"."+h.to02uString(o)+(s?"H":"M")+"."+h.to02uString(r)}}],(r=[{key:"getAudioTracks",value:function(){var t=this,e=[];return this._tracks.forEach(function(r,i){"soun"===r.handler&&e.push({enabled:t._selectedAudioTrackId===r.trackId,id:r.trackId,kind:r.isDefault?"main":"",label:r.label,language:r.language,default:t._defaultAudioTrackId===r.trackId})}),e}},{key:"switchAudioTrack",value:function(t){var e;return"soun"===(null===(e=this._tracks.get(t))||void 0===e?void 0:e.handler)&&(this._selectedAudioTrackId=t,!0)}},{key:"clear",value:function(){this._buffer=null,this._bytesInBuffer=0}},{key:"parse",value:function(t,e){var r=this,i=0!==this._bytesInBuffer;i&&(this._appendBuffer(new Uint8Array(t)),t=this._buffer.subarray(0,this._bytesInBuffer));for(var n=new Uint8Array(t),a=new DataView(n.buffer),o=n.byteLength,s=0;s+8<=o;){var u=a.getUint32(s),l=s+u;if(l>o)break;var h=a.getUint32(s+4),c=n.subarray(s,l);switch(h){case 1836019558:if(this._prevSegContext=this._segContext,this._segContext={},this._lastMoofSize=u,void 0===this._minStartDts&&(this._findingStartDts=!0,this._parseBox(a,s,l,this._parseMoofBoxsBinder),this._findingStartDts=!1),this._lastTrackId=void 0,this._videoFrames.length=0,i)this._parseBox(a,s,l,this._parseMoofBoxsBinder);else{var f=new Uint8Array(c);this._parseBox(new DataView(f.buffer),0,u,this._parseMoofBoxsBinder),c=f}break;case 1836019574:if(this.metaData={},this._lastTrackId=void 0,this._parseBox(a,s,l,this._parseMoovBoxsBinder)){var d=void 0,_=void 0;this._tracks.forEach(function(t,e){"soun"===t.handler&&(void 0===d&&(d=t.trackId),void 0===_&&!0===t.isDefault&&(_=t.trackId))});var y=d;void 0!==_&&(y=_),this._defaultAudioTrackId=y,this._selectedAudioTrackId=y,this._tracks.forEach(function(t,e){"soun"===t.handler&&r._defaultAudioTrackId!==t.trackId&&r._changeBoxTag(a,t.trakBoxOffset,1718773093)}),this._updateMediaInfo(),this._updateMimeType()}break;case 1835295092:this._videoFrames.length&&(this._parseMdatBox(c,u),this._videoFrames.length=0)}this._onParsed(c,h),s=l}i&&0===s||(s>=o?this._bytesInBuffer=0:(this._bytesInBuffer=0,!e&&s<o&&this._appendBuffer(n.subarray(s))))}},{key:"_changeBoxTag",value:function(t,e,r){t.setUint32(e+4,r)}},{key:"_appendBuffer",value:function(t){var e=this._bytesInBuffer+t.length,r=new Uint8Array(e);this._buffer&&this._bytesInBuffer&&r.set(this._buffer.subarray(0,this._bytesInBuffer),0),this._buffer=r,this._buffer.set(t,this._bytesInBuffer),this._bytesInBuffer=e}},{key:"_parseMoovBoxs",value:function(t,e,r,i){switch(r){case 1836019574:case 1953653099:case 1835297121:case 1835626086:case 1937007212:return 1953653099===r&&(this._lastFmp4Track=new d.fMp4Track(e)),this._parseBox(t,e+8,e+i,this._parseMoovBoxsBinder);case 1937011556:this._parseStsdBox(t,e,i);break;case 1835296868:this._parseMdhdBox(t,e,i);break;case 1751411826:this._parseHdlrBox(t,e,i);break;case 1953196132:this._parseTkhdBox(t,e,i);break;case 1970628964:this._parseUuidBox(t,e,i)}return!0}},{key:"_parseMoofBoxs",value:function(t,e,r,i){switch(r){case 1836019558:case 1953653094:return 1953653094===r&&(this._lastFmp4TrackFragment=new d.fMp4TrackFragment(e)),this._parseBox(t,e+8,e+i,this._parseMoofBoxsBinder);case 1952868452:var n,a=16777215&t.getUint32(e+8),o=e+8+4;this._lastTrackId=t.getUint32(o);var s={default_sample_duration:null,default_sample_size:null};e=o+4,1&a&&(e+=8),2&a&&(e+=4),8&a&&(s.default_sample_duration=t.getUint32(e),e+=4),16&a&&(s.default_sample_size=t.getUint32(e),e+=4),this._lastFmp4TrackFragment.trackId=this._lastTrackId,this._trackFragments.set(this._lastTrackId,this._lastFmp4TrackFragment),this._trackInfos.set(this._lastTrackId,s),"soun"===(null===(n=this._tracks.get(this._lastTrackId))||void 0===n?void 0:n.handler)&&(this._selectedAudioTrackId!==this._lastTrackId?this._changeBoxTag(t,this._lastFmp4TrackFragment.trafBoxOffset,1718773093):t.setUint32(o,this._defaultAudioTrackId));break;case 1952867444:this._parseTfdtBox(t,e,i);break;case 1953658222:this._parseTrunBox(t,e,i)}return!0}},{key:"_parseMdhdBox",value:function(t,e,r){e+=12,e+=8,this._timeScaleMap[this._lastTrackId]=t.getUint32(e),e+=8;var i=t.getUint16(e),n=String.fromCharCode(96+(i>>10),96+(i>>5&31),96+(31&i));this._lastFmp4Track.language=n}},{key:"_parseHdlrBox",value:function(t,e,r){var i=12;i+=4;var n=new Uint8Array(t.buffer,e+i,4),a=(new o).decodeUtf8(n),s="";if(r-(i+=16)>0){var u=new Uint8Array(t.buffer,e+i,r-i);s=(new o).decodeUtf8(u)}this._lastFmp4Track.handler=a,this._lastFmp4Track.label=s,this._tracks.has(this._lastTrackId)&&(this._tracks.clear(),this._defaultAudioTrackId=void 0,this._selectedAudioTrackId=void 0),this._tracks.set(this._lastFmp4Track.trackId,this._lastFmp4Track)}},{key:"_parseTkhdBox",value:function(t,e,r){var i=8,n=t.getUint32(e+i);this._lastFmp4Track.isDefault=0!=(1&n),i+=4,i+=8,this._lastTrackId=t.getUint32(e+i),this._lastFmp4Track.trackId=this._lastTrackId}},{key:"_parseUuidBox",value:function(t,e,r){var i=8,n=new Uint8Array(t.buffer,e+i,16),a=r-(i+=16),s=new Uint8Array(t.buffer,e+i,a),u=new Uint8Array([255,204,130,99,248,85,74,147,136,20,88,122,2,82,31,221]);if(h.equalsUuid(n,u)){var l=(new o).decodeUtf8(s);this.metaData.googlesphericalvideodata=l}}},{key:"_parseStsdBox",value:function(e,r,i){r+=12;var n=e.getUint32(r);if(r+=4,0!==n){e.getUint32(r),r+=4;var a=e.getUint32(r);r+=4;var o=0;switch(a){case 1635148593:case 1752589105:case 1635135537:this.metaData.fps=e.getUint32(r+16)/100,this.metaData.videodatarate=e.getUint32(r+20)/1e3,this._videoWidth=e.getUint16(r+24),this._videoHeight=e.getUint16(r+26),this.metaData.encoder=t.parseEncoder(e,r+42),r+=78,(o=e.getUint32(r))>=12?1635148593===a?this._videoCodec=t.parseH264Codec(e,r):1752589105===a?this._videoCodec=t.parseH265Codec(e,r):1635135537===a&&(this._videoCodec=t.parseAV1Codec(e,r)):1635148593===a?this._videoCodec="avc1.64002a":1752589105===a?this._videoCodec="hvc1.1.6.L93.90":1635135537===a&&(this._videoCodec="av01.0.09M.08"),this._videoTag=a,this._videoTrackId=this._lastTrackId;break;case 1836069985:this._audioChannel=e.getUint16(r+16),this._audioRate=e.getUint32(r+24)>>>16,r+=28,o=e.getUint32(r),this._audioCodec=o>=10?this._parseAudioCodec(e,r):"mp4a.40.2";break;case 1700998451:this._audioChannel=e.getUint16(r+16),this._audioRate=e.getUint32(r+24)>>>16,this._audioCodec="ec-3"}}}},{key:"_parseTfdtBox",value:function(t,e,r){e+=8;var i=t.getUint8(e);e+=4;var n=1===i?this.getUint64(t,e):t.getUint32(e);if(void 0!==this._lastTrackId){var a=this._timeScaleMap[this._lastTrackId];if(this._findingStartDts){var o=n/this._timeScaleMap[this._lastTrackId];return void((this._minStartDts>o||void 0===this._minStartDts)&&(this._minStartDts=o,console.log("track ".concat(this._lastTrackId," start dts: ").concat(o))))}var s=Math.floor(this._minStartDts*a),l=n-s;if(l<0)throw new u.SomeError("DtsError","wrong dts: ".concat(n,"<").concat(s," in track ").concat(this._lastTrackId));1===i?this.setUint64(t,e,l):t.setUint32(e,l),this._lastTrackId===this._videoTrackId&&(this._videoBaseDts=l)}}},{key:"_parseTrunBox",value:function(t,e,r){if(this._lastTrackId===this._videoTrackId){e+=8;var i=16777215&t.getUint32(e);this._chrome4x&&4&i&&t.setUint32(e+12,33554432),e+=4;var n=t.getUint32(e);if(e+=4,0!==n){if(!this._videoCtsFixed&&2048&i){var a=e;1&i&&(e+=4),4&i&&(e+=4),256&i&&(e+=4),512&i&&(e+=4),1024&i&&(e+=4),0!==t.getInt32(e)&&t.setInt32(e,0),this._videoCtsFixed=!0,e=a}if(this._onSeiParsed){var o=this._trackInfos.get(this._lastTrackId),s=0;if(1&i){s=t.getUint32(e)-this._lastMoofSize,e+=4,4&i&&(e+=4);for(var u=this._videoBaseDts,l=0;l<n;l++){var h=null!=o&&null!=o.default_sample_duration?o.default_sample_duration:null;256&i&&(h=t.getUint32(e),e+=4);var c=null!=o&&null!=o.default_sample_size?o.default_sample_size:null;if(512&i&&(c=t.getUint32(e),e+=4),null==h||null==c)break;1024&i&&(e+=4);var f=u;2048&i&&(f=t.getInt32(e),e+=4),this._videoFrames.push({duration:h,dts:u,cts:f,offset:s,size:c}),u+=h,s+=c}}}}}}},{key:"_parseMdatBox",value:function(t,e){var r,i=this,a=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return n(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t))){r&&(t=r);var i=0,a=function(){};return{s:a,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}(this._videoFrames);try{var o=function(){if(s=r.value,!i._onSeiParsed||s.offset+s.size>e)return"break";u=1/((u=i._timeScaleMap[i._videoTrackId])||9e4);var n=s.dts*u,a=n+s.cts*u;if(1635135537===i._videoTag){var o=new f;o.onCustomData=function(t,e){i._onSeiParsed&&i._onSeiParsed(n,a,t,e)},o.parseObus(t.subarray(s.offset,s.offset+s.size))}else c.parse(t,s.offset,s.size,n,a,4,1752589105===i._videoTag,i._onSeiParsed)};for(a.s();!(r=a.n()).done;){var s,u;if("break"===o())break}}catch(t){a.e(t)}finally{a.f()}}},{key:"_parseAudioCodec",value:function(t,e){e+=8,e+=4,e+=8,e+=5;var r=t.getUint8(e);if(107==r||105==r)return"mp3";e+=9,this.metaData.audiodatarate=t.getUint32(e)/1e3,e+=4,e+=5;var i=t.getUint8(e)>>>3&31;return s.getAacCodec(r,i)}},{key:"_parseBox",value:function(t,e,r,i){for(;e+8<=r;){var n=t.getUint32(e),a=t.getUint32(e+4);if(e+n>r||!i(t,e,a,n))return!1;e+=n}return e<=r}},{key:"_updateMediaInfo",value:function(){void 0!==this._audioRate&&(this.metaData.audiosamplerate=this._audioRate),void 0!==this._audioChannel&&(this.metaData.audiochannel=this._audioChannel),void 0!==this._videoWidth&&(this.metaData.width=this._videoWidth),void 0!==this._videoHeight&&(this.metaData.height=this._videoHeight)}},{key:"_updateMimeType",value:function(){var t='video/mp4; codecs="';if(this._audioCodec&&this._videoCodec)t+=this._videoCodec+","+this._audioCodec;else if(this._audioCodec)t+=this._audioCodec;else{if(!this._videoCodec)return;t+=this._videoCodec}this.mimeType=t+'"'}},{key:"getUint64",value:function(t,e){var r=t.getUint32(e),i=t.getUint32(e+4);return r*this.uint32_max+i}},{key:"setUint64",value:function(t,e,r){t.setUint32(e,r>=this.uint32_max?Math.floor(r/this.uint32_max):0),t.setUint32(e+4,4294967295&r)}}])&&a(e.prototype,r),i&&a(e,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports.t=_},615:t=>{function e(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return r(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?r(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0,a=function(){};return{s:a,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==i.return||i.return()}finally{if(u)throw o}}}}function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var s=function(){function t(){n(this,t),this.version=void 0,this.sequence=void 0,this.nextSequence=void 0,this.endOfStream=void 0,this.steering=null,this.files=[],this.streams=[],this.streamInfMaps=[]}return o(t,[{key:"parse",value:function(t,e){for(var r=null,i=null,n=0,a=null,o=null,s=null,u=t.length,l=0;l<u;){var h=t.indexOf("\n",l);-1===h&&(h=u);var c=t.substring(l,h);if(l=h+1,0!==c.length)if("#"===c[0]){var f=c.indexOf(":");if(f>0){var d=c.substring(0,f),_=c.substring(f+1);if("#EXTINF"===d){var y=_.lastIndexOf(",");r=-1!==y?_.substring(0,y):_.substring(0),i=-1!==y?_.substring(y+1,_.length):null,n=1}else if("#EXT-BILI-AUX"===d)a=this._parseBiliAux(_);else if("#EXT-X-VERSION"===d)this.version=parseInt(_.trim());else if("#EXT-X-MEDIA-SEQUENCE"===d)this.sequence=parseInt(_.trim()),this.nextSequence=this.sequence;else if("#EXT-X-MAP"===d){var p=_.trim();if(p.length<=5||'URI="'!==p.substring(0,5))return console.warn("wrong #EXT-X-MAP: ".concat(_)),-2;var v=(p=p.substring(5)).lastIndexOf('"');p=-1!==v?p.substring(0,v):p.substring(0),this.files.push({uri:p,duration:void 0,title:"",biliAux:void 0,seq:void 0,src:e})}else"#EXT-X-STREAM-INF"===d?(o=this._parseMultiKV(_),n=2):"#EXT-X-CONTENT-STEERING"===d&&(s=this._parseMultiKV(_))}else"#EXT-X-ENDLIST"===c&&(this.endOfStream=!0)}else 1===n?(this._lastSeq=this.nextSequence++,this._lastUri=c.trim(),this.files.push({uri:this._lastUri,duration:r.trim(),title:i,biliAux:a,seq:this._lastSeq,src:e}),r=null,i=null,n=0,a=null):2===n&&(this.streams.push(c),this.streamInfMaps.push(o),this.steering=s,n=0,o=null)}return 0}},{key:"trimStart",value:function(t){if(this.files.length>0)for(var e=t/1e3,r=0,i=null,n=null,a=this.files.length-1;a>=0;a--){var o=this.files[a];if(void 0!==o.seq)r+=parseFloat(o.duration),null===n&&o.biliAux&&r>=e&&"K"===o.biliAux.firstFrameType&&(n=a);else if(null===i&&null!==n){i=o;var s=this.files.slice(n,this.files.length);s.unshift(i),this.files=s;break}}}},{key:"_parseMultiKV",value:function(t){for(var e,r=new Map,i=new RegExp('(\\w+?)\\=(([^"]|("[^"]+"))+?)(,|$)',"gm");null!==(e=i.exec(t));)if(e.index===i.lastIndex&&i.lastIndex++,e.length>=3){var n=e[1],a=e[2];a.startsWith('"')&&a.endsWith('"')&&(a=a.substring(1,a.length-1)),r.set(n,a)}return r}},{key:"_parseBiliAux",value:function(t){var e=t.split("|");return{pts:e.length>0?Number.parseInt(e[0],16):void 0,firstFrameType:e.length>1?e[1]:void 0,size:e.length>2?Number.parseInt(e[2],16):void 0,crc:e.length>3?Number.parseInt(e[3],16):void 0}}}]),t}(),u=function(){function t(e){n(this,t),this.onPlaylistUpdate=function(t,e){},this.endOfStream=!1,this.mimeType=null,this.steering=null,this.streamUrls=[],this.streamInfMaps=[],this._initUris=new Set,this._lastSeq=0,this._lastUri=null,this._nextSequence=void 0,this._remainDuration=0,this._totalCount=0,this._totalDuration=0,this._dataUrls=[],this._url=null,this._trimStartKeepTimeMs=e,this._needTrimStart=e>0,this._nextPlaylist=null,this.onSwitchToNextPlaylist=null}return o(t,[{key:"setUrl",value:function(t){var e=t.lastIndexOf("/"),r=t.lastIndexOf("?");this._relativePath=t.substring(0,e+1),this._queryParams=r>0?t.substring(r):null,this._url=t,this._initUris.clear(),this._lastSeq=0,this._lastUri=null,this._nextSequence=void 0,this._nextPlaylist=null}},{key:"switchToNewPlaylist",value:function(t,e){if(t){if(!e)return!1;var r=new s;return 0==r.parse(e,t)&&(this._nextPlaylist={url:t,parser:r},!0)}return this._nextPlaylist=null,!0}},{key:"count",get:function(){return this._dataUrls.length}},{key:"averageDuration",get:function(){return this._totalCount>0?this._totalDuration/this._totalCount:0}},{key:"lastSequence",get:function(){return this._nextSequence>0?this._nextSequence-1:0}},{key:"remainDuration",get:function(){return this._remainDuration}},{key:"parse",value:function(t){var e=new s,r=e.parse(t,this._url);if(0!=r)return r;if(this.streamUrls=e.streams,this.streamInfMaps=e.streamInfMaps,this.steering=e.steering,this.streamUrls.length>0)return 1;if(void 0===e.version||e.version<6)return console.warn("wrong #EXT-X-VERSION: ".concat(e.version)),-1;this._needTrimStart&&(this._needTrimStart=!1,e.trimStart(this._trimStartKeepTimeMs));var i=this._mergeNextList(e);return 0!=i||this._doPlaylistSwitch(),i}},{key:"_mergeNextList",value:function(t){void 0!==t.endOfStream&&(this.endOfStream=t.endOfStream);var r,i=!1,n=!1,a=e(t.files);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(void 0===o.seq&&(i=!0,!this._initUris.has(o.uri))){n=!0;break}}}catch(t){a.e(t)}finally{a.f()}if(0==i&&!t.endOfStream)return console.warn("missing #EXT-X-MAP URI"),-2;if(this._nextSequence!==t.nextSequence||n){if(void 0===this._nextSequence&&(this._nextSequence=t.sequence),this._nextSequence<t.sequence&&this._nextSequence+30>=t.sequence&&this._lastUri){console.warn("lost sequence: ".concat(this._nextSequence," -> ").concat(t.sequence));for(var s=this.averageDuration,u=this._lastSeq.toString(),l=t.sequence-1;l>=this._nextSequence;l--){var h=this._lastUri.replace(u,l.toString());t.files.unshift({uri:h,duration:s})}}var c,f=e(t.files);try{for(f.s();!(c=f.n()).done;){var d=c.value;if(d.seq>=this._nextSequence||void 0===d.seq){if(void 0===d.seq){if(this._initUris.has(d.uri))continue;this._initUris.add(d.uri)}d.duration=parseFloat(d.duration),isNaN(d.duration)&&(d.duration=this.averageDuration),this._appendEntry(d)}}}catch(t){f.e(t)}finally{f.f()}this._nextSequence<t.nextSequence&&(this._nextSequence=t.nextSequence)}return 0}},{key:"_doPlaylistSwitch",value:function(){if(this._nextPlaylist){var t=this._nextPlaylist.parser,e=this._nextPlaylist.url,r=this.onSwitchToNextPlaylist,i=0,n=0;for(i=0;i<t.files.length;++i){var a=t.files[i];if(null!=a.seq&&null!=a.biliAux&&"K"==a.biliAux.firstFrameType&&null!=a.biliAux.pts){for(n=0;n<this._dataUrls.length;++n){var o=this._dataUrls[n];if(null!=o.biliAux&&null!=o.biliAux.pts&&o.biliAux.pts==a.biliAux.pts)break}if(n<this._dataUrls.length)break}}if(i==t.files.length)return!1;this._removeEntries(n),this.setUrl(e),this._nextSequence=t.files[i].seq,r(0==this._mergeNextList(t)),this._nextPlaylist=null}return!0}},{key:"shift",value:function(){var t=this._dataUrls.length>0?this._dataUrls.shift():null;return t&&(this._remainDuration-=t.duration),t}},{key:"_appendEntry",value:function(t){t.uri=this._buildM4sUrl(t.uri),this._dataUrls.push(t),this.onPlaylistUpdate(!1,t),this._remainDuration+=t.duration,this._totalCount++,this._totalDuration+=t.duration}},{key:"_removeEntries",value:function(t){if(t>this._dataUrls.length)return!1;for(var e=this._dataUrls.length,r=e-t,i=t;i<e;++i){var n=this._dataUrls[i];this._remainDuration-=n.duration,this._totalCount--,this._totalDuration-=n.duration}this._nextSequence-=r,this._lastSeq-=r,this._dataUrls.splice(t,r)}},{key:"_buildM4sUrl",value:function(t){var e=-1!==t.indexOf("://")?t:this._relativePath+t;return null!==this._queryParams&&(-1!==t.indexOf("?")?e+="&"+this._queryParams.substring(1):e+=this._queryParams),e}}]),t}();t.exports={M3u8Context:u,BasicM3u8Parser:s,parsedOk:0,parsedAsMaster:1,parsedErrorVer:-1,parsedErrorInit:-2}},497:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return a(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var i=0,n=function(){};return{s:n,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return s=t.done,t},e:function(t){u=!0,o=t},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,i=new Array(e);r<e;r++)i[r]=t[r];return i}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}var s=r(757),u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,(r=[{key:"_readSeiNumber",value:function(t,e){for(var r=0;e.offset<t.byteLength;){var i=t[e.offset];if(e.offset+=1,255!==i)return r+i;r+=255}return null}},{key:"_isEndOfSei",value:function(t,e){return e.offset>=t.byteLength||128===t[e.offset]&&(e.offset+=1,!0)}},{key:"_readSeiMessage",value:function(t,e){var r=this._readSeiNumber(t,e),i=this._readSeiNumber(t,e);if(null!==r&&null!==i){var n=e.offset+i;if(n<t.byteLength){var a={payloadType:r,payloadData:t.subarray(e.offset,n)};return e.offset+=i,a}}return null}},{key:"readSeiMessages",value:function(t){for(var e=[],r={offset:0};!this._isEndOfSei(t,r);){var i=this._readSeiMessage(t,r);if(null===i)break;e.push(i)}return e}},{key:"parse",value:function(e,r,i,a,o,u,l,h){for(var c=r+i,f=r;f+u<c;){for(var d=0,_=0;_<u;_++)d=d<<8|e[f++];var y=f+d;if(y>c||y<=f)break;if((l?e[f++]>>1:31&e[f])==(l?39:6)){var p,v=s.ebsp2rbsp(e.subarray(f+1,y)),m=n(t.readSeiMessages(v));try{for(m.s();!(p=m.n()).done;){var b=p.value;5===b.payloadType&&b.payloadData.length>=16&&h(a,o,b.payloadData.slice(0,16),b.payloadData.slice(16))}}catch(t){m.e(t)}finally{m.f()}}f=y}}}])&&o(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports.$=u},41:t=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,r){for(var i=0;i<r.length;i++){var n=r[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,r){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===e(a)?a:String(a)),n)}var a}function i(t,e,i){return e&&r(t.prototype,e),i&&r(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var a=i(function t(e){n(this,t),this.trakBoxOffset=e,this.handler=void 0,this.trackId=void 0,this.language=void 0,this.isDefault=void 0,this.label=void 0}),o=i(function t(e){n(this,t),this.trafBoxOffset=e,this.trackId=void 0});t.exports={fMp4Track:a,fMp4TrackFragment:o}},15:t=>{t.exports.e=function(t,e){for(var r=0,i=t.length;0!=i;){var n=i>>1,a=r+n;t[a]<e?(r=++a,i-=n+1):i=n}return r}},221:t=>{var e=void 0;t.exports.checkChromeVer=function(){if(void 0!==e)return e;try{var t=navigator.userAgent,r=t.indexOf("Chrome/");if(r>0){r+=7;var i=t.indexOf(".",r);return-1===i&&(i=t.length),e=parseInt(t.substring(r,i)),console.log("Chrome verion: ".concat(e)),e}}catch(t){console.warn("parse Chrome version failed",t)}return e=0}},704:t=>{function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t,r){for(var i=0;i<r.length;i++){var n=r[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,r){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,"string");if("object"!==e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===e(a)?a:String(a)),n)}var a}var i=function(){function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._player=e,this._minBufferMs=r,this._loaded=!1,this._waitCount=0,this._waitDuration=0,this._waiting=!1,this._beginWaitTime=0,this._savedPaused=void 0,this._timer=void 0,this.minWaitMs=100,this._onLoadedDataBinder=this._onLoadedData.bind(this),this._onPlayingBinder=this._onPlaying.bind(this),this._onWaitingBinder=this._onWaiting.bind(this),e.addEventListener("loadeddata",this._onLoadedDataBinder),e.addEventListener("playing",this._onPlayingBinder),e.addEventListener("waiting",this._onWaitingBinder)}var e,i;return e=t,(i=[{key:"destroy",value:function(){this._clearTimer(),this._player.removeEventListener("waiting",this._onWaitingBinder),this._player.removeEventListener("playing",this._onPlayingBinder),this._player.removeEventListener("loadeddata",this._onLoadedDataBinder),this._waitCount=0,this._waitDuration=0}},{key:"buffered",get:function(){var t=this._player.buffered;return t&&t.length>0?t.end(t.length-1)-this._player.currentTime:0}},{key:"waitedCount",get:function(){return this._waitCount}},{key:"waitedDuration",get:function(){return Math.round(this._waitDuration)}},{key:"_onLoadedData",value:function(t){this._loaded=!0}},{key:"_onPlaying",value:function(t){if(this._waiting){var e=performance.now()-this._beginWaitTime;e>this.minWaitMs&&(this._waitCount++,this._waitDuration+=e),this._waiting=!1}}},{key:"_onWaiting",value:function(t){var e=this;if(this._loaded&&!this._player.seeking){var r=this._player.readyState;if(!(r===HTMLMediaElement.HAVE_ENOUGH_DATA||r===HTMLMediaElement.HAVE_CURRENT_DATA&&this.buffered>=2)&&(this._waiting=!0,this._beginWaitTime=performance.now(),this._savedPaused=void 0,this._clearTimer(),this._minBufferMs>this.minWaitMs)){var i=this._minBufferMs/1e3,n=this._beginWaitTime+this._minBufferMs+1e3;this._timer=window.setInterval(function(){!e._waiting||e.buffered>=i||performance.now()>=n?(e._clearTimer(),!e._savedPaused&&e._player.paused&&e._player.play().then(function(){}).catch(function(t){})):void 0===e._savedPaused&&(e._savedPaused=!!e._player.paused,e._player.pause())},2*this.minWaitMs)}}}},{key:"_clearTimer",value:function(){void 0!==this._timer&&(window.clearInterval(this._timer),this._timer=void 0)}}])&&r(e.prototype,i),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports._=i},97:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}function o(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var s=r(319),u=!!window.fetch,l=!!window.ReadableStream,h=function(){function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n(this,t),this._callbackMap=new Map,this._onResponse=e,this._onResult=r,this._onError=i}return o(t,[{key:"fetchAsBuffer",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(t,r);u?this._doFetch(t,e,"arrayBuffer",i):this._doRequest(t,"arraybuffer",i)}},{key:"fetchAsJson",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(t,r);u?this._doFetch(t,e,"json",i):this._doRequest(t,"json",i)}},{key:"fetchAsText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(t,r);u?this._doFetch(t,e,"text",i):this._doRequest(t,"text",i)}},{key:"fetchAsStream",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(l){var n=this._setTimeout(t,i);fetch(t,r?{}:{cache:"no-store"}).then(function(r){if(void 0===n||e._clearTimeout(n))if(e._onResponse(t,r)&&r.ok){var i=r.body.getReader(),a=[],o=function(r){!r.done&&a[0]?a[0]():a[0]=null,e._onResult(t,r.value,r.done)};a[0]=function(){i.read().then(o).catch(function(r){e._onError(t,s.errorNetworkRead,r)})},a[0]()}else r.body.getReader().cancel()}).catch(function(r){(void 0===n||e._clearTimeout(n))&&e._onError(t,s.errorNetworkFetch,r)})}else this.fetchAsBuffer(t,r,i)}},{key:"_doFetch",value:function(t,e,r,i){var n=this;fetch(t,e?{}:{cache:"no-store"}).then(function(e){(void 0===i||n._clearTimeout(i))&&(n._onResponse(t,e)&&e.ok?e[r]().then(function(e){n._onResult(t,e,!0)}).catch(function(e){n._onError(t,s.errorNetworkRead,e)}):e.body.getReader().cancel())}).catch(function(e){(void 0===i||n._clearTimeout(i))&&n._onError(t,s.errorNetworkFetch,e)})}},{key:"_doRequest",value:function(t,e,r){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(e){(void 0===r||i._clearTimeout(r))&&2===n.readyState&&(n.ok=n.status>=200&&n.status<=299,i._onResponse(t,n))},n.onload=function(e){n.status>=200&&n.status<=299&&i._onResult(t,n.response,!0)},n.onerror=function(e){(void 0===r||i._clearTimeout(r))&&i._onError(t,n.readyState>2?s.errorNetworkRead:s.errorNetworkFetch,e)},n.open("GET",t),n.responseType=e,n.send()}},{key:"_clearTimeout",value:function(t){return void 0!==t&&(window.clearTimeout(t),this._callbackMap.delete(t))}},{key:"_setTimeout",value:function(t,e){var r=this;if(e>0){var i=[];return i[0]=window.setTimeout(function(){r._callbackMap.delete(i[0]),r._onError(t,s.errorNetworkTimeout,e)},e),this._callbackMap.set(i[0],1),i[0]}}}]),t}(),c=function(){function t(e,r){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n(this,t),this._readDone=!1,this._reader=null,this._onResponse=e,this._onData=r,this._onError=i,this._onDataFetchedBinder=this._onDataFetched.bind(this),this._onReadErrorBinder=this._onReadError.bind(this)}return o(t,[{key:"destroy",value:function(){this._readDone=!0,this._onData=null}},{key:"fetchAsStream",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o={};if(0!=i){var u={};u.Range="bytes=".concat(i,"-")+(n>0?(n-1).toString():""),o.headers=u}r||(o.cache="no-store");var l=a>0?window.setTimeout(function(){e._onError(s.errorNetworkTimeout,a)},a):void 0;fetch(t,o).then(function(t){e._clearTimeout(l),e._reader&&(e._reader.cancel(),e._reader=null),e._onResponse(t)&&t.ok?(e._readDone=!1,e._reader=t.body.getReader(),e._reader.read().then(e._onDataFetchedBinder).catch(e._onReadErrorBinder)):t.body.getReader().cancel()}).catch(function(t){e._clearTimeout(l),e._onError(s.errorNetworkFetch,t)})}},{key:"_onDataFetched",value:function(t){t.done&&(this._reader=null,this._readDone=!0),this._reader&&(this._readDone?(this._reader.cancel(),this._reader=null):this._reader.read().then(this._onDataFetchedBinder).catch(this._onReadErrorBinder)),this._onData&&!this._onData(t.value)&&(this._readDone=!0,this._reader&&(this._reader.cancel(),this._reader=null))}},{key:"_onReadError",value:function(t){this._onError(s.errorNetworkRead,t)}},{key:"_clearTimeout",value:function(t){void 0!==t&&window.clearTimeout(t)}}]),t}();t.exports={Fetcher:h,StreamFetcher:c}},483:(t,e,r)=>{function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var n=r(319),a=function(){function t(e,r,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._mediaSource=e,this._onEnded=r,this._onError=i,this._dataList=[],this._mimeType=null,this._sourceOpened=!1,this._sourceBuffer=null,this._eosBuffer=new Uint8Array,this._onSourceOpenBinder=this._onSourceOpen.bind(this),this._onUpdateEndBinder=this._onUpdateEnd.bind(this),e&&e.addEventListener("sourceopen",this._onSourceOpenBinder)}var e,r;return e=t,(r=[{key:"destroy",value:function(){this.removeSource(),this._dataList.length=0,this._mediaSource=null,this._mimeType=null,this._sourceOpened=!1}},{key:"addSource",value:function(t){if(this._mimeType=t,t&&this._sourceOpened&&!this._sourceBuffer)try{this._sourceBuffer=this._mediaSource.addSourceBuffer(t),this._sourceBuffer&&this._sourceBuffer.addEventListener("updateend",this._onUpdateEndBinder)}catch(t){this._onError&&this._onError(n.errorMseOpen,t)}return null!==this._sourceBuffer}},{key:"removeSource",value:function(){this._sourceBuffer&&(this._sourceBuffer.removeEventListener("updateend",this._onUpdateEndBinder,!1),this._mediaSource.removeSourceBuffer(this._sourceBuffer),this._sourceBuffer=null)}},{key:"pushBuffer",value:function(t){this._dataList.push(t),this._onUpdateEnd()}},{key:"pushEnd",value:function(){0!==this._dataList.length||this._sourceBuffer?(this._dataList.push(this._eosBuffer),this._onUpdateEnd()):this._onEnded&&this._onEnded()}},{key:"removeBuffer",value:function(t,e){try{if(!this._sourceBuffer.updating)return this._sourceBuffer.remove(t,e),!0}catch(r){console.warn("remove buffer failed: ".concat(t," -> ").concat(e),r)}return!1}},{key:"_onSourceOpen",value:function(){this._mediaSource&&(this._mediaSource.duration=1/0,this._mediaSource.removeEventListener("sourceopen",this._onSourceOpenBinder),this._sourceOpened=!0,this._mimeType&&this.addSource(this._mimeType))}},{key:"_onUpdateEnd",value:function(){var t=this._sourceBuffer;if(t&&!t.updating){var e=this._dataList;if(e.length){var r=e.shift();try{r===this._eosBuffer?("open"===this._mediaSource.readyState&&this._mediaSource.endOfStream(),this._onEnded&&this._onEnded()):null!==r&&t.appendBuffer(r),r=null}catch(t){"QuotaExceededError"===t.name?r&&e.unshift(r):this._onError&&this._onError(n.errorMseAppend,t)}}}}}])&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,(a=function(t,e){if("object"!==i(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(n.key),"symbol"===i(a)?a:String(a)),n)}var a}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();t.exports.E=a}},e={},function r(i){var n=e[i];if(void 0!==n)return n.exports;var a=e[i]={exports:{}};return t[i](a,a.exports,r),a.exports}(35);var t,e});
},{}],"MwY8":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function u(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,u)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(u){return function(c){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&u[0]?r.return:u[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,u[1])).done)return o;switch(r=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,r=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){i.label=u[1];break}if(6===u[0]&&i.label<o[1]){i.label=o[1],o=u;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(u);break}o[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(c){u=[6,c],r=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};function n(e){var t;switch(e){case 8:t="7.1Ch";break;case 6:t="5.1Ch";break;case 2:t="Stereo";break;case 1:t="Mono";break;default:t="".concat(e,"Ch")}return t}function r(n){var r;return e(this,void 0,Promise,function(){var e,o,a,i;return t(this,function(t){switch(t.label){case 0:return[4,fetch(n)];case 1:return(e=t.sent()).ok&&e.status>=200&&e.status<=299?[4,e.text()]:[3,3];case 2:if(o=t.sent(),(a=o.split("\n")).findIndex(function(e){return"#EXTM3U"===e})>-1&&a.findIndex(function(e){return"#EXT-X-VERSION:3"===e})>-1&&-1!==(i=a.findIndex(function(e){return e.startsWith("#EXT-X-STREAM-INF")})))return[2,null!==(r=a[i+1])&&void 0!==r?r:n];t.label=3;case 3:return[2,n]}})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.redirectHLSV3=exports.parseAudioChannel=void 0,exports.parseAudioChannel=n,exports.redirectHLSV3=r;
},{}],"ao58":[function(require,module,exports) {
"use strict";var e,t,r,i,n,o,a,s,u,d,f,c,l,h,p=this&&this.__assign||function(){return(p=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},v=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{u(i.next(e))}catch(t){o(t)}}function s(e){try{u(i.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}u((i=i.apply(e,t||[])).next())})},m=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(u){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,i&&(n=2&s[0]?i.return:s[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,s[1])).done)return n;switch(i=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){a.label=s[1];break}if(6===s[0]&&a.label<n[1]){a.label=n[1],n=s;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(s);break}n[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(u){s=[6,u],i=0}finally{r=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},y=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)},w=this&&this.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},g=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var i,n=0,o=t.length;n<o;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkVideoRate=exports.Video=exports.VideoError=exports.VideoStatus=exports.NetworkErrorCode=exports.EventType=void 0;var E,P,b,k=require("@bilibili-live/fmp4.js"),T=require("@bilibili-live/web-player-common"),L=require("./video-utils");!function(e){e.VideoInfo="VideoInfo",e.MetaData="MetaData",e.CorePlayerCreated="CorePlayerCreated",e.Error="Error",e.LoadStart="LoadStart",e.Ended="Ended",e.NetworkResponse="NetworkResponse",e.FirstPacket="FirstPacket",e.FirstFrame="FirstFrame",e.SEIData="SEIData",e.Destroyed="Destroyed",e.WaitStart="WaitStart",e.WaitEnd="WaitEnd",e.WaitReport="WaitReport",e.Play="Play",e.Pause="Pause",e.WASMDecoderDegrade="WASMDecoderDegrade",e.MutePlay="MutePlay",e.NotAutoPlay="NotAutoPlay",e.FirstFrameTimeout="FirstFrameTimeout"}(E=exports.EventType||(exports.EventType={})),function(e){e[e.Timeout=11e3]="Timeout",e[e.ResponseError=11001]="ResponseError",e[e.DownloadInterrupt=11002]="DownloadInterrupt"}(P=exports.NetworkErrorCode||(exports.NetworkErrorCode={})),function(e){e.Initialize="Initialize",e.Loading="Loading",e.Playing="Playing",e.Pause="Pause",e.Destroyed="Destroyed"}(b=exports.VideoStatus||(exports.VideoStatus={}));var S,I=0,M={droppedFrames:0,decodedFrames:0,videoBufferLength:0,videoNetworkActivity:0,audioNetworkActivity:0,audioBufferLength:0},D={corePlayerType:T.CorePlayerType.NativePlayer,width:0,height:0,mimeType:"",volume:0,fps:0,encoder:"",videoDataRate:0,audioDataRate:0,audioSampleRate:0,audioChannel:"",videoSrc:""};!function(e){e[e.FirstFrameTimeout=92001]="FirstFrameTimeout"}(S=exports.VideoError||(exports.VideoError={}));var F=function(){function P(v,m){void 0===m&&(m={});var P,k=this;e.set(this,void 0),t.set(this,void 0),r.set(this,null),i.set(this,void 0),n.set(this,void 0),o.set(this,{mediaInfo:p({},D),realtimeInfo:p({},M)}),a.set(this,null),s.set(this,b.Initialize),u.set(this,[]),d.set(this,void 0),f.set(this,void 0),c.set(this,new T.EventBus),this.on=y(this,c,"f").on,this.once=y(this,c,"f").once,this.emit=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];[E.VideoInfo,E.SEIData].includes(e)||y(k,n,"f").debug("video emit: ".concat(e,", handlers count: ").concat(y(k,c,"f").getHandlers(e).size)),(t=y(k,c,"f")).emit.apply(t,g([e],r,!1))},l.set(this,function(){if(y(k,t,"f").includes(".mp4"))return function(){};var e=setTimeout(function(){k.emit(E.Error,{type:E.FirstFrameTimeout,code:S.FirstFrameTimeout,errInfo:{url:y(k,t,"f")}})},1e4),r=function(){clearTimeout(e)};return k.once(E.FirstFrame,r),function(){r()}}),h.set(this,function(e){var i,a;y(k,n,"f").info("metadata fired"),y(k,o,"f").mediaInfo=Object.assign({},y(k,o,"f").mediaInfo,{videoSrc:y(k,t,"f"),width:e.width,height:e.height,mimeType:null===(i=y(k,r,"f"))||void 0===i?void 0:i.mimeType,fps:(0,T.roundNumber)(e.fps,0),encoder:null!==(a=e.encoder)&&void 0!==a?a:e.creator,videoDataRate:e.videodatarate,audioDataRate:e.audiodatarate,audioSampleRate:e.audiosamplerate,audioChannel:(0,L.parseAudioChannel)(e.audiochannel)}),k.emit(E.VideoInfo,k.getVideoInfo()),k.updateStatisticsInfo()}),w(this,i,I,"f"),I+=1,w(this,n,new Proxy(T.logger,{get:function(e,t){return["debug","info","warn","error"].includes(t)?function(r){e[t]("id ".concat(y(k,i,"f"),": ").concat(r))}:e[t]}}),"f"),w(this,t,v,"f"),w(this,d,m,"f"),w(this,e,N(null!==(P=m.wasmDecode)&&void 0!==P&&P),"f"),w(this,f,window.setTimeout(function(){k.load()},1),"f")}return Object.defineProperty(P.prototype,"status",{get:function(){return y(this,s,"f")},set:function(e){y(this,n,"f").info("Video status changed to ".concat(e)),w(this,s,e,"f")},enumerable:!1,configurable:!0}),P.prototype.delyLoad=function(){clearTimeout(y(this,f,"f"))},P.prototype.load=function(){var r;this.status!==b.Destroyed&&(y(this,n,"f").info("load src: ".concat(y(this,t,"f"),", opts: ").concat(JSON.stringify(y(this,d,"f")))),this.status=b.Loading,this.createCorePlayer(y(this,e,"f"),null===(r=y(this,d,"f"))||void 0===r?void 0:r.startTime),this.play().catch(function(e){T.logger.error(e)}))},P.prototype.play=function(){return v(this,void 0,Promise,function(){return m(this,function(t){switch(t.label){case 0:if(y(this,n,"f").info("video play"),null==y(this,e,"f"))return[2];if(this.status===b.Playing)return[2];t.label=1;case 1:return t.trys.push([1,3,,8]),[4,y(this,e,"f").play()];case 2:return t.sent(),this.status=b.Playing,[3,8];case 3:if("NotAllowedError"!==t.sent().name)return[2];y(this,n,"f").warn("try mute play"),y(this,e,"f").muted=!0,t.label=4;case 4:return t.trys.push([4,6,,7]),[4,y(this,e,"f").play()];case 5:return t.sent(),this.status=b.Playing,this.emit(E.MutePlay),[3,7];case 6:return t.sent(),y(this,n,"f").warn("can't auto play"),this.status=b.Pause,this.emit(E.NotAutoPlay),[3,7];case 7:return[3,8];case 8:return[2]}})})},P.prototype.pause=function(){y(this,n,"f").info("video pause"),null!=y(this,e,"f")&&this.status===b.Playing&&(y(this,e,"f").pause(),this.status=b.Pause)},P.prototype.seek=function(t){var r=t.forward,i=t.keepBuffer;if(y(this,n,"f").info("video seek, forward: ".concat(null!=r?r:"null",", keepBuffer: ").concat(null!=i?i:"null")),null!=y(this,e,"f")){var o=(0,T.remainBufferLength)(y(this,e,"f"));if(!(o<=0))if(null!=i&&i>0){if(o<i)return;y(this,e,"f").currentTime+=o-i}else if(null!=r&&r>0){if(r>o)return;y(this,e,"f").currentTime+=r}}},P.prototype.getSrc=function(){return y(this,t,"f")},P.prototype.volume=function(t){y(this,n,"f").info("video setVolume(".concat(t,")")),null!=y(this,e,"f")&&(y(this,e,"f").volume=(0,T.roundNumber)(t,2))},P.prototype.mute=function(t){null!=y(this,e,"f")&&(y(this,e,"f").muted=t)},P.prototype.getVideoEl=function(){return y(this,e,"f")},P.prototype.removeVideoEl=function(){var t,r;y(this,e,"f").remove(),null===(r=(t=y(this,e,"f")).destroy)||void 0===r||r.call(t)},P.prototype.getVideoInfo=function(){return y(this,o,"f").mediaInfo.volume=y(this,e,"f").volume,y(this,o,"f")},P.prototype.getNetworkState=function(){return y(this,r,"f")instanceof k.Hls7Player?y(this,r,"f").getHLSNetworkState():null},P.prototype.capturePic=function(t,r){var i,n,o=null===(n=(i=y(this,e,"f")).toDataURL)||void 0===n?void 0:n.call(i,t,r);return null!=o?o:V(y(this,e,"f"),t,r)},P.prototype.switchAudioTrack=function(t){var i,n;return y(this,r,"f")instanceof k.Hls7Player?null==(null===(i=y(this,r,"f"))||void 0===i?void 0:i.switchAudioTrack)?-1:(null===(n=y(this,r,"f"))||void 0===n||n.switchAudioTrack(t),(0,T.remainBufferLength)(y(this,e,"f"))):-1},P.prototype.getAudioTracks=function(){var e,t,i;return y(this,r,"f")instanceof k.Hls7Player&&null!==(i=null===(t=null===(e=y(this,r,"f"))||void 0===e?void 0:e.getAudioTracks)||void 0===t?void 0:t.call(e))&&void 0!==i?i:[]},P.prototype.destroy=function(t){var i,s;if(void 0===t&&(t=!1),t||this.removeVideoEl(),this.status!==b.Destroyed){this.status=b.Destroyed,y(this,n,"f").info("video destroyed, holdLastFrame: ".concat(t.toString())),clearTimeout(y(this,f,"f")),clearInterval(null!==(i=y(this,a,"f"))&&void 0!==i?i:0),w(this,o,{mediaInfo:p({},D),realtimeInfo:p({},M)},"f"),y(this,e,"f").pause(),y(this,u,"f").forEach(function(e){return null==e?void 0:e()});try{null===(s=y(this,r,"f"))||void 0===s||s.destroy()}catch(d){T.logger.error("corePlayer destroy error!!")}this.emit(E.Destroyed),y(this,c,"f").destroy()}},P.prototype.createCorePlayer=function(e,i){var n=this;if(null!=y(this,t,"f")){var a,s,f=!0===y(this,d,"f").wasmDecode?new window.BwpMediaSource:null!=window.MediaSource?new window.MediaSource:{},c=new URL(y(this,t,"f")).pathname;if(c.endsWith(".flv"))a=new k.fMp4Player(f,e),s=T.CorePlayerType.fMp4Player;else if(c.endsWith(".m3u8"))!0===y(this,d,"f").forceNativePlayer||null==window.MediaSource?(a=new k.NativePlayer(f,e),s=T.CorePlayerType.NativePlayer):(a=new k.Hls7Player(f,e),s=T.CorePlayerType.Hls7Player);else{if(!c.endsWith(".mp4"))throw new Error("Unsupported stream url: ".concat(c));a=new k.NativePlayer(f,e),s=T.CorePlayerType.NativePlayer}y(this,o,"f").mediaInfo=Object.assign({},y(this,o,"f").mediaInfo,{corePlayerType:s}),this.emit(E.LoadStart,{corePlayer:a,videoEl:e,src:y(this,t,"f")}),a.keepUsedBuffer=10,a.timeout=7e3,y(this,u,"f").push(this.bindEvents(a,e),y(this,l,"f").call(this)),null!=i&&i>0&&(a instanceof k.fMp4Player||a instanceof k.NativePlayer)&&(a.startTime=i),s===T.CorePlayerType.NativePlayer&&c.endsWith(".m3u8")?(0,L.redirectHLSV3)(y(this,t,"f")).then(function(e){a.src=e}).catch(function(e){a.src=y(n,t,"f"),T.logger.error(e)}):a.src=y(this,t,"f"),w(this,r,a,"f"),this.emit(E.CorePlayerCreated,{corePlayer:a,videoEl:e,src:y(this,t,"f")})}},P.prototype.updateStatisticsInfo=function(){var t=this,i=0;null!=y(this,a,"f")&&clearInterval(y(this,a,"f")),w(this,a,window.setInterval(function(){var n,a,s,u=null!==(s=null===(a=null===(n=y(t,e,"f"))||void 0===n?void 0:n.getVideoPlaybackQuality)||void 0===a?void 0:a.call(n))&&void 0!==s?s:{},d=u.droppedVideoFrames,f=void 0===d?0:d,c=u.totalVideoFrames,l=void 0===c?0:c,h=0;null!=y(t,r,"f")&&(h=y(t,r,"f").receivedBytes-i,Number.isNaN(h)&&(h=0),i=y(t,r,"f").receivedBytes),y(t,o,"f").realtimeInfo=Object.assign({},y(t,o,"f").realtimeInfo,{droppedFrames:f,decodedFrames:l,videoBufferLength:null==y(t,e,"f")?0:(0,T.roundNumber)((0,T.remainBufferLength)(y(t,e,"f")),3),videoNetworkActivity:h}),t.emit(E.VideoInfo,t.getVideoInfo())},1e3),"f")},P.prototype.bindEvents=function(e,t){var r=this,a=performance.now(),s=!1;e.onMetaData=function(e){y(r,h,"f").call(r,e),r.emit(E.MetaData,performance.now()-a),y(r,n,"f").info("after onMetaData mediaInfo: ".concat(JSON.stringify(y(r,o,"f").mediaInfo)))},e.onSeiData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.emit.apply(r,g([E.SEIData],e,!1))},e.onFileFetched=function(e,t){var i=t.used,o=t.duration,a=2e3;0===o?a=2e3:o<=500&&(a=500),i>a&&y(r,n,"f").warn("fetch slowly: ".concat(e,", cost ").concat(i,"ms, duration: ").concat(o,"ms"))},e.onFirstResponse=function(e){r.emit(E.NetworkResponse,e)},e.onEndOfStream=function(){var e=Math.ceil((0,T.remainBufferLength)(t));(e<0||isNaN(e))&&(e=0),y(r,n,"f").warn("video onEndOfStream, bufLen: ".concat(e)),setTimeout(function(){t.dispatchEvent(new Event("ended"))},1e3*e)},e.onFirstPacket=function(){var e=performance.now()-a;y(r,n,"f").info("video first packet cost: ".concat(Math.round(e))),r.emit(E.FirstPacket,performance.now()-a)};var u=function(e,t,i){if(!s){s=!0;var o=(0,T.any2Str)({code:t,errInfo:i});y(r,n,"f").error("player core ".concat(e,", ").concat(o)),r.emit(E.Error,{code:t,errInfo:i}),r.destroy()}};e.onNetworkError=u.bind(this,"NetworkError"),e.onParserError=u.bind(this,"ParserError");var f=function(){var e=performance.now()-a;y(r,n,"f").info("video first frame cost: ".concat(Math.round(e))),r.emit(E.FirstFrame,e)};t.addEventListener("loadeddata",f);var c=function(){s||(s=!0,r.emit(E.Ended),r.destroy())};t.addEventListener("ended",c);var l=function(){if(!s){s=!0;var e=t.error,i={code:90002,errInfo:{code:null==e?void 0:e.code,msg:null==e?void 0:e.message}};y(r,n,"f").error("video native error: ".concat((0,T.any2Str)(i))),r.emit(E.Error,i),r.destroy()}};t.addEventListener("error",l);var p=W(t,e,{startCb:function(){y(r,n,"f").warn("video waiting!, bufferLen: ".concat((0,T.remainBufferLength)(t))),r.emit(E.WaitStart)},endCb:function(){y(r,n,"f").info("video playing"),r.emit(E.WaitEnd)},reportCb:function(e){r.emit(E.WaitReport,e)},id:y(this,i,"f")}),v=function(){r.emit(E.Play)};t.addEventListener("play",v);var m=function(){r.emit(E.Pause)};t.addEventListener("pause",m);var w=function(){};!0===y(this,d,"f").wasmDecode&&(w=function(){r.emit(E.WASMDecoderDegrade)},t.addEventListener("performance",w));var P=T.mediaAction.on("pause",function(){t.pause()}),b=T.mediaAction.on("play",function(){t.play().catch(function(e){T.logger.error(e)})});return function(){t.removeEventListener("loadeddata",f),t.removeEventListener("ended",c),t.removeEventListener("error",l),t.removeEventListener("play",v),t.removeEventListener("pause",m),t.removeEventListener("performance",w),p(),P(),b()}},P}();function N(e){var t=document.createElement(e?"bwp-video":"video");return t.id="video-".concat(Math.random().toString().slice(2)),t.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  ",t.volume=.9,t.autoplay=!0,t.setAttribute("webkit-playsinline","true"),t.setAttribute("playsinline","true"),t}function W(e,t,r){var i=r.startCb,n=r.endCb,o=r.reportCb,a=r.id,s=!1,u=function t(){s=!0,e.removeEventListener("loadeddata",t)};e.addEventListener("loadeddata",u);var d=!1,f=function t(){e.removeEventListener("progress",t),d&&(d=!1,n())},c=function(){s&&(d=!0,i(),e.addEventListener("progress",f))},l=function(){e.removeEventListener("progress",f),d&&(d=!1,n())};e.addEventListener("waiting",c),e.addEventListener("playing",l);var h=new k.BufferDetector(e,1e3),p=0,v=0,m=0,y=0,w=performance.now(),g=function(){var r=performance.now(),i=t.receivedBytes-y;y=t.receivedBytes,o({count:h.waitedCount-p,duration:Math.round(h.waitedDuration-v),windowSize:Math.round(r-w),playTime:Math.round(e.currentTime-m),playedTime:Math.round(e.currentTime),receivedBytes:i,id:a}),p=h.waitedCount,v=h.waitedDuration,m=e.currentTime,w=r},E=window.setInterval(g,6e4),P=function(){g()};return window.addEventListener("beforeunload",P),function(){clearInterval(E),g(),window.removeEventListener("beforeunload",P),e.removeEventListener("playing",l),e.removeEventListener("waiting",c),e.removeEventListener("loadeddata",u),h.destroy()}}function C(e){if(e.videoHeight>e.videoWidth){var t=x(e);return e.insertAdjacentElement("afterend",t),t}return null}function x(e){var t=V(e),r=null;return(r=document.createElement("div")).style.cssText="\n    background-image: url(".concat(t,");\n    background-size: cover;\n    background-position: center;\n    width: 100%;\n    height: 100%;\n    filter: blur(35px);\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n  "),r}function V(e,t,r){var i;void 0===t&&(t="image/jpeg"),void 0===r&&(r=.8);var n=document.createElement("canvas");return n.width=e.videoWidth,n.height=e.videoHeight,null===(i=n.getContext("2d"))||void 0===i||i.drawImage(e,0,0,n.width,n.height),n.toDataURL(t,r)}exports.Video=F,e=new WeakMap,t=new WeakMap,r=new WeakMap,i=new WeakMap,n=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap,u=new WeakMap,d=new WeakMap,f=new WeakMap,c=new WeakMap,l=new WeakMap,h=new WeakMap,exports.checkVideoRate=C;
},{"@bilibili-live/fmp4.js":"lV3a","@bilibili-live/web-player-common":"KGHo","./video-utils":"MwY8"}],"uCDP":[function(require,module,exports) {
"use strict";var t=this&&this.__assign||function(){return(t=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},e=this&&this.__classPrivateFieldSet||function(t,e,n,o,r){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?r.call(t,n):r?r.value=n:e.set(t,n),n},n=this&&this.__classPrivateFieldGet||function(t,e,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(t):o?o.value:e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var o=require("@bilibili-live/web-player-common"),r=1800,i=function(){function i(L){var W=this;this.source=L,a.set(this,{report_interval_sec:30}),c.set(this,o.P2PType.NONE),l.set(this,void 0),u.set(this,"0"),s.set(this,[]),f.set(this,i.Support_HEVC_No_Err?o.CodecType.HEVC:o.CodecType.AVC),p.set(this,""),h.set(this,[]),d.set(this,void 0),y.set(this,null),v.set(this,0),T.set(this,0),P.set(this,performance.now()),_.set(this,r),w.set(this,new o.EventBus),C.set(this,""),this.on=n(this,w,"f").on,this.once=n(this,w,"f").once,m.set(this,n(this,w,"f").emit),S.set(this,function(t){if(0!==n(W,T,"f"))return n(W,c,"f");var e=null!=t?t:W.source.playurl.p2p_data.p2p_type;return null!=o.wpd.P2PType&&(e=o.wpd.P2PType),null==window.MediaSource&&(e=o.P2PType.NONE),e!==o.P2PType.HLS_BILI&&e!==o.P2PType.HLS_NOT_P2P||W.hasHLSPlayerSupportStream()||(e=o.P2PType.NONE),e in o.P2PType||(e=o.P2PType.NONE),e}),g.set(this,function(t){return navigator.userAgent.includes("PlayStation")?[o.FormatType.TS]:t===o.ProtocolType.HTTP_STREAM?[o.FormatType.FLV]:null!=window.MediaSource||o.ua.isIOS()?[o.FormatType.FMP4,o.FormatType.TS]:[o.FormatType.TS]}),E.set(this,function(t){for(var e,r,i=n(W,g,"f").call(W,t),a=null,c=0,l=i;c<l.length;c++){var u=l[c];if(null!=(a=n(W,M,"f").call(W,{protocol:t,format:u,codec:o.CodecType.AVC})))break}for(var s=null,f=0,p=i;f<p.length;f++){u=p[f];if(null!=(s=n(W,M,"f").call(W,{protocol:t,format:u,codec:o.CodecType.HEVC})))break}var h=n(W,k,"f").call(W,null!==(e=null==a?void 0:a.accept_qn)&&void 0!==e?e:[],null!==(r=null==s?void 0:s.accept_qn)&&void 0!==r?r:[]),d=h.hevcAcceptQn,y=h.avcAcceptQn;return null!=s&&(s.accept_qn=d),null!=a&&(a.accept_qn=y),{avcCodec:a,hevcCodec:s}}),H.set(this,function(t,e){if(t===o.ProtocolType.HTTP_HLS){if(![o.P2PType.HLS_BILI,o.P2PType.HLS_NOT_P2P,o.P2PType.NONE].includes(n(W,c,"f")))return!0}else if(t===o.ProtocolType.HTTP_STREAM&&[o.P2PType.HLS_BILI,o.P2PType.HLS_NOT_P2P].includes(n(W,c,"f")))return!0;return!1}),M.set(this,function(e){var n,o,r,i=e.protocol,a=e.format,c=e.codec,l=null===(r=null===(o=null===(n=W.source.playurl.stream.find(function(t){return t.protocol_name===i}))||void 0===n?void 0:n.format)||void 0===o?void 0:o.find(function(t){return t.format_name===a}))||void 0===r?void 0:r.codec.find(function(t){var e=t.codec_name;return c===e});return null!=l?t(t({},l),{protocol:i,format:a}):null}),b.set(this,function(t,e){void 0===e&&(e=[]);var r=t.map(function(t){return{code:t,value:String(t),label:(i=n(W,l,"f").find(function(e){return e.qn===t}),a="",c=null===(e=null==i?void 0:i.attr_desc)||void 0===e?void 0:e.find(function(t){return"panorama"===t.attr_name}),null!=c&&(a=c.desc),(null!==(r=null==i?void 0:i.desc)&&void 0!==r?r:"")+a),codec:o.CodecType.AVC};var e,r,i,a,c}).filter(function(t){var e=t.label;return Boolean(e)}),a=(null!=e?e:[]).map(function(t){return{code:t,value:String(t),label:(r=n(W,l,"f").find(function(e){return e.qn===t}),i="",a=null===(e=null==r?void 0:r.attr_desc)||void 0===e?void 0:e.find(function(t){return"panorama"===t.attr_name}),null!=a&&(i=a.desc),(null!==(o=null==r?void 0:r.desc)&&void 0!==o?o:"")+i)};var e,o,r,i,a}).filter(function(t){var e=t.label;return Boolean(e)}).map(function(t){var e=t.code,n=t.value,r=t.label;return{code:e,value:"".concat(n,"_").concat(o.CodecType.HEVC),label:"".concat(null!=r?r:"","PRO"),codec:o.CodecType.HEVC}});return i.Support_HEVC_No_Err&&[o.EQuality.Origin,o.EQuality.K4].forEach(function(t){if(a.some(function(e){return e.code===t})){var e=a.find(function(e){return e.code===t});null!=e&&(e.label=e.label.replace(/PRO$/,""),r=r.filter(function(e){return e.code!==t}))}}),r.concat(a).sort(function(t,e){return e.code+(e.codec===o.CodecType.HEVC?1:0)-(t.code+(t.codec===o.CodecType.HEVC?1:0))})}),k.set(this,function(t,e){var n=W.source.playurl.dolby_qn;return null!=n&&(t=t.filter(function(t){return t!==n[0]})),null!=n&&(0,o.isSupportDolby)()?{hevcAcceptQn:e,avcAcceptQn:t=t.concat(n)}:{hevcAcceptQn:e,avcAcceptQn:t}});try{e(this,a,JSON.parse(L.conf_json),"f")}catch(V){o.logger.error(V)}e(this,l,L.playurl.g_qn_desc,"f"),e(this,c,n(this,S,"f").call(this),"f"),null!=window.MediaSource?e(this,d,[o.P2PType.HLS_BILI,o.P2PType.HLS_NOT_P2P].includes(n(this,c,"f"))?o.ProtocolType.HTTP_HLS:o.ProtocolType.HTTP_STREAM,"f"):e(this,d,o.ProtocolType.HTTP_HLS,"f"),this.useStream()}var a,c,l,u,s,f,p,h,d,y,v,T,P,_,w,C,m,S,g,E,H,M,b,k;return i.prototype.getCurPlayUrl=function(){if(performance.now()>n(this,P,"f")+1e3*n(this,_,"f"))throw new Error("source data is expired");return n(this,p,"f")},i.prototype.getCurStreamInfo=function(){var t,e,o=new URL(n(this,p,"f")),r=null!==(e=null===(t=/\/live-bvc\/\d+\/(live_.+?)[/.]/.exec(n(this,p,"f")))||void 0===t?void 0:t[1])&&void 0!==e?e:"";return{host:o.host,query:o.search,name:r,protocol:n(this,d,"f"),format:n(this,y,"f"),codec:n(this,f,"f"),p2pType:n(this,c,"f"),quality:n(this,u,"f"),timeshift:n(this,T,"f"),curAttrName:n(this,C,"f"),qualityDesc:n(this,l,"f")}},i.prototype.getCurQuality=function(){return n(this,u,"f")},i.prototype.getQualityDesc=function(t){var e,o=null!=t?t:n(this,u,"f");return null!==(e=n(this,s,"f").find(function(t){return t.value===o}))&&void 0!==e?e:null},i.prototype.getCurLine=function(){return n(this,v,"f")},i.prototype.getCurLineDesc=function(){var t=this;return this.getLineCandidates().find(function(e){return e.value===n(t,v,"f")})},i.prototype.getTimeShift=function(){return n(this,T,"f")},i.prototype.setTimeShift=function(t){e(this,T,t,"f")},i.prototype.setCurLine=function(t){if(0===n(this,h,"f").length)throw new Error("play url candidates is empty");e(this,v,t%this.getLineCandidates().length,"f");var o=n(this,h,"f")[n(this,v,"f")%n(this,h,"f").length];e(this,p,o.url,"f"),e(this,_,o.ttl>1?o.ttl:r,"f")},i.prototype.getPlayUrlCandates=function(){return n(this,h,"f")},i.prototype.getCurCodecType=function(){return n(this,f,"f")},i.prototype.getCurP2PType=function(){return n(this,c,"f")},i.prototype.getDynamicConfig=function(){return n(this,a,"f")},i.prototype.getQnCandidates=function(){return n(this,s,"f")},i.prototype.getAVCQnCandidates=function(){return this.getQnCandidates().filter(function(t){return t.codec===o.CodecType.AVC})},i.prototype.getLineCandidates=function(){return[{value:0,label:"主线"},{value:1,label:"备线1"},{value:2,label:"备线2"},{value:3,label:"备线3"}]},i.prototype.setCurP2PType=function(t){e(this,c,t,"f")},i.prototype.hasHLSPlayerSupportStream=function(){return Boolean(n(this,M,"f").call(this,{protocol:o.ProtocolType.HTTP_HLS,format:o.FormatType.FMP4,codec:o.CodecType.AVC}))},i.prototype.useStream=function(t){var i,a,l;void 0===t&&(t={});var P,w,m=null!==(i=t.protocol)&&void 0!==i?i:n(this,d,"f"),g=null!==(a=t.codec)&&void 0!==a?a:n(this,f,"f"),M=n(this,E,"f").call(this,m),k=M.avcCodec,L=M.hevcCodec;if(null==k||0===(null!==(l=k.url_info)&&void 0!==l?l:[]).length)throw new Error("can't find stream by protocol: ".concat(m,", codec: ").concat(null!=g?g:""));null!=(null==L?void 0:L.url_info)&&g===o.CodecType.HEVC?(P=L,w=o.CodecType.HEVC):(P=k,w=o.CodecType.AVC);var W=P.url_info.map(function(t){var e,n=t.host,o=t.extra,r=t.stream_ttl;return{url:"".concat(n).concat(P.base_url).concat(o),ttl:r,attr_name:null!==(e=P.attr_name)&&void 0!==e?e:""}});if(0===W.length)throw new Error("play url codec.hosts is empty");var V=n(this,v,"f")%W.length;e(this,C,W[V].attr_name,"f"),e(this,p,W[V].url,"f"),e(this,_,W[V].ttl>1?W[V].ttl:r,"f"),0!==n(this,T,"f")&&e(this,p,"".concat(n(this,p,"f"),"&tmshift=").concat(n(this,T,"f")),"f"),e(this,y,P.format,"f"),e(this,f,w,"f"),e(this,d,m,"f"),e(this,c,n(this,S,"f").call(this,t.expectP2PType),"f"),e(this,s,n(this,b,"f").call(this,k.accept_qn,null==L?void 0:L.accept_qn),"f"),e(this,u,"".concat(P.current_qn).concat(w===o.CodecType.HEVC?"_".concat(o.CodecType.HEVC):""),"f"),e(this,h,W,"f"),n(this,H,"f").call(this,m,n(this,c,"f"))&&e(this,c,o.P2PType.NONE,"f")},a=new WeakMap,c=new WeakMap,l=new WeakMap,u=new WeakMap,s=new WeakMap,f=new WeakMap,p=new WeakMap,h=new WeakMap,d=new WeakMap,y=new WeakMap,v=new WeakMap,T=new WeakMap,P=new WeakMap,_=new WeakMap,w=new WeakMap,C=new WeakMap,m=new WeakMap,S=new WeakMap,g=new WeakMap,E=new WeakMap,H=new WeakMap,M=new WeakMap,b=new WeakMap,k=new WeakMap,i.Support_HEVC_No_Err=(0,o.isHardSupportHEVC)(),i}();exports.default=i;
},{"@bilibili-live/web-player-common":"KGHo"}],"MW6F":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function l(e){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function u(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?c(e):t}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,i=l(e);if(t){var r=l(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return u(this,n)}}function f(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var l,a=e[Symbol.iterator]();!(i=(l=a.next()).done)&&(n.push(l.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==a.return||a.return()}finally{if(r)throw o}}return n}}(e,t)||p(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function d(e){return function(e){if(Array.isArray(e))return v(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||p(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){if(e){if("string"==typeof e)return v(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function C(){}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var h=function(e){return e};function g(e){return e()}function m(){return Object.create(null)}function x(e){e.forEach(g)}function w(e){return"function"==typeof e}function b(t,n){return t!=t?n==n:t!==n||t&&"object"===e(t)||"function"==typeof t}function y(e,t,n,i){return e[1]&&i?function(e,t){for(var n in t)e[n]=t[n];return e}(n.ctx.slice(),e[1](i(t))):n.ctx}function $(e){return null==e?"":e}function k(e){var t="string"==typeof e&&e.match(/^\s*(-?[\d.]+)([^\s]*)\s*$/);return t?[parseFloat(t[1]),t[2]||"px"]:[e,"px"]}var L="undefined"!=typeof window,M=L?function(){return window.performance.now()}:function(){return Date.now()},V=L?function(e){return requestAnimationFrame(e)}:C,H=new Set;function Z(e){H.forEach(function(t){t.c(e)||(H.delete(t),t.f())}),0!==H.size&&V(Z)}function S(e,t){e.appendChild(t)}function q(e,t,n){var i=z(e);if(!i.getElementById(t)){var r=B("style");r.id=t,r.textContent=n,_(i,r)}}function z(e){if(!e)return document;var t=e.getRootNode?e.getRootNode():e.ownerDocument;return t&&t.host?t:e.ownerDocument}function F(e){var t=B("style");return _(z(e),t),t.sheet}function _(e,t){return S(e.head||e,t),t.sheet}function E(e,t,n){e.insertBefore(t,n||null)}function T(e){e.parentNode&&e.parentNode.removeChild(e)}function P(e,t){for(var n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function B(e){return document.createElement(e)}function O(e){return document.createTextNode(e)}function R(){return O(" ")}function j(){return O("")}function I(e,t,n,i){return e.addEventListener(t,n,i),function(){return e.removeEventListener(t,n,i)}}function A(e){return function(t){return t.preventDefault(),e.call(this,t)}}function N(e){return function(t){return t.stopPropagation(),e.call(this,t)}}function Y(e,t,n){null==n?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function X(e){return Array.from(e.childNodes)}function D(e,t){t=""+t,e.data!==t&&(e.data=t)}function G(e,t){e.value=null==t?"":t}function U(e,t,n,i){null==n?e.style.removeProperty(t):e.style.setProperty(t,n,i?"important":"")}function W(e,t,n){e.classList[n?"add":"remove"](t)}function J(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.bubbles,r=void 0!==i&&i,o=n.cancelable,l=void 0!==o&&o,a=document.createEvent("CustomEvent");return a.initCustomEvent(e,r,l,t),a}var K,Q=new Map,ee=0;function te(e){for(var t=5381,n=e.length;n--;)t=(t<<5)-t^e.charCodeAt(n);return t>>>0}function ne(e,t){var n={stylesheet:F(t),rules:{}};return Q.set(e,n),n}function ie(e,t,n,i,r,o,l){for(var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,c=16.666/i,u="{\n",s=0;s<=1;s+=c){var f=t+(n-t)*o(s);u+=100*s+"%{".concat(l(f,1-f),"}\n")}var d=u+"100% {".concat(l(n,1-n),"}\n}"),p="__svelte_".concat(te(d),"_").concat(a),v=z(e),C=Q.get(v)||ne(v,e),h=C.stylesheet,g=C.rules;g[p]||(g[p]=!0,h.insertRule("@keyframes ".concat(p," ").concat(d),h.cssRules.length));var m=e.style.animation||"";return e.style.animation="".concat(m?"".concat(m,", "):"").concat(p," ").concat(i,"ms linear ").concat(r,"ms 1 both"),ee+=1,p}function re(e,t){var n=(e.style.animation||"").split(", "),i=n.filter(t?function(e){return e.indexOf(t)<0}:function(e){return-1===e.indexOf("__svelte")}),r=n.length-i.length;r&&(e.style.animation=i.join(", "),(ee-=r)||V(function(){ee||(Q.forEach(function(e){var t=e.stylesheet.ownerNode;t&&T(t)}),Q.clear())}))}function oe(e){K=e}function le(){if(!K)throw new Error("Function called outside component initialization");return K}function ae(e){le().$$.on_mount.push(e)}function ce(e){le().$$.on_destroy.push(e)}var ue=[],se=[],fe=[],de=[],pe=Promise.resolve(),ve=!1;function Ce(e){fe.push(e)}function he(e){de.push(e)}var ge,me=new Set,xe=0;function we(){if(0===xe){var e=K;do{try{for(;xe<ue.length;){var t=ue[xe];xe++,oe(t),be(t.$$)}}catch(e){throw ue.length=0,xe=0,e}for(oe(null),ue.length=0,xe=0;se.length;)se.pop()();for(var n=0;n<fe.length;n+=1){var i=fe[n];me.has(i)||(me.add(i),i())}fe.length=0}while(ue.length);for(;de.length;)de.pop()();ve=!1,me.clear(),oe(e)}}function be(e){if(null!==e.fragment){e.update(),x(e.before_update);var t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Ce)}}function ye(e,t,n){e.dispatchEvent(J("".concat(t?"intro":"outro").concat(n)))}var $e,ke=new Set;function Le(){$e={r:0,c:[],p:$e}}function Me(){$e.r||x($e.c),$e=$e.p}function Ve(e,t){e&&e.i&&(ke.delete(e),e.i(t))}function He(e,t,n,i){if(e&&e.o){if(ke.has(e))return;ke.add(e),$e.c.push(function(){ke.delete(e),i&&(n&&e.d(1),i())}),e.o(t)}else i&&i()}var Ze={duration:0};function Se(e,t,n,i){var r={direction:"both"},o=t(e,n,r),l=i?0:1,a=null,c=null,u=null;function s(){u&&re(e,u)}function f(e,t){var n=e.b-l;return t*=Math.abs(n),{a:l,b:e.b,d:n,duration:t,start:e.start,end:e.start+t,group:e.group}}function d(t){var n,i=o||Ze,r=i.delay,d=void 0===r?0:r,p=i.duration,v=void 0===p?300:p,g=i.easing,m=void 0===g?h:g,w=i.tick,b=void 0===w?C:w,y=i.css,$={start:M()+d,b:t};t||($.group=$e,$e.r+=1),a||c?c=$:(y&&(s(),u=ie(e,l,t,v,d,m,y)),t&&b(0,1),a=f($,v),Ce(function(){return ye(e,t,"start")}),n=function(t){if(c&&t>c.start&&(a=f(c,v),c=null,ye(e,a.b,"start"),y&&(s(),u=ie(e,l,a.b,a.duration,0,m,o.css))),a)if(t>=a.end)b(l=a.b,1-l),ye(e,a.b,"end"),c||(a.b?s():--a.group.r||x(a.group.c)),a=null;else if(t>=a.start){var n=t-a.start;l=a.a+a.d*m(n/a.duration),b(l,1-l)}return!(!a&&!c)},0===H.size&&V(Z),new Promise(function(e){H.add({c:n,f:e})}))}return{run:function(e){w(o)?(ge||(ge=Promise.resolve()).then(function(){ge=null}),ge).then(function(){o=o(r),d(e)}):d(e)},end:function(){s(),a=c=null}}}function qe(e,t,n){var i=e.$$.props[t];void 0!==i&&(e.$$.bound[i]=n,n(e.$$.ctx[i]))}function ze(e){e&&e.c()}function Fe(e,t,n,i){var r=e.$$,o=r.fragment,l=r.after_update;o&&o.m(t,n),i||Ce(function(){var t,n=e.$$.on_mount.map(g).filter(w);e.$$.on_destroy?(t=e.$$.on_destroy).push.apply(t,d(n)):x(n),e.$$.on_mount=[]}),l.forEach(Ce)}function _e(e,t){var n,i,r,o=e.$$;null!==o.fragment&&(n=o.after_update,i=[],r=[],fe.forEach(function(e){return-1===n.indexOf(e)?i.push(e):r.push(e)}),r.forEach(function(e){return e()}),fe=i,x(o.on_destroy),o.fragment&&o.fragment.d(t),o.on_destroy=o.fragment=null,o.ctx=[])}function Ee(e,t){-1===e.$$.dirty[0]&&(ue.push(e),ve||(ve=!0,pe.then(we)),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Te(e,t,n,i,r,o,l){var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[-1],c=K;oe(e);var u=e.$$={fragment:null,ctx:[],props:o,update:C,not_equal:r,bound:m(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(c?c.$$.context:[])),callbacks:m(),dirty:a,skip_bound:!1,root:t.target||c.$$.root};l&&l(u.root);var s=!1;if(u.ctx=n?n(e,t.props||{},function(t,n){var i=!(arguments.length<=2)&&arguments.length-2?arguments.length<=2?void 0:arguments[2]:n;return u.ctx&&r(u.ctx[t],u.ctx[t]=i)&&(!u.skip_bound&&u.bound[t]&&u.bound[t](i),s&&Ee(e,t)),n}):[],u.update(),s=!0,x(u.before_update),u.fragment=!!i&&i(u.ctx),t.target){if(t.hydrate){var f=X(t.target);u.fragment&&u.fragment.l(f),f.forEach(T)}else u.fragment&&u.fragment.c();t.intro&&Ve(e.$$.fragment),Fe(e,t.target,t.anchor,t.customElement),we()}oe(c)}var Pe=function(){function e(){t(this,e)}return i(e,[{key:"$destroy",value:function(){_e(this,1),this.$destroy=C}},{key:"$on",value:function(e,t){if(!w(t))return C;var n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),function(){var e=n.indexOf(t);-1!==e&&n.splice(e,1)}}},{key:"$set",value:function(e){var t;this.$$set&&(t=e,0!==Object.keys(t).length)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}]),e}();function Be(e){var t=e-1;return t*t*t+1}function Oe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.delay,i=void 0===n?0:n,r=t.duration,o=void 0===r?400:r,l=t.easing,a=void 0===l?h:l,c=+getComputedStyle(e).opacity;return{delay:i,duration:o,easing:a,css:function(e){return"opacity: ".concat(e*c)}}}function Re(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.delay,i=void 0===n?0:n,r=t.duration,o=void 0===r?400:r,l=t.easing,a=void 0===l?Be:l,c=t.x,u=void 0===c?0:c,s=t.y,d=void 0===s?0:s,p=t.opacity,v=void 0===p?0:p,C=getComputedStyle(e),h=+C.opacity,g="none"===C.transform?"":C.transform,m=h*(1-v),x=f(k(u),2),w=x[0],b=x[1],y=f(k(d),2),$=y[0],L=y[1];return{delay:i,duration:o,easing:a,css:function(e,t){return"\n\t\t\ttransform: ".concat(g," translate(").concat((1-e)*w).concat(b,", ").concat((1-e)*$).concat(L,");\n\t\t\topacity: ").concat(h-m*t)}}}var je='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7 2.5C5.61929 2.5 4.5 3.61929 4.5 5V19C4.5 20.3807 5.61929 21.5 7 21.5C8.38071 21.5 9.5 20.3807 9.5 19V5C9.5 3.61929 8.38071 2.5 7 2.5ZM17 2.5C15.6193 2.5 14.5 3.61929 14.5 5V19C14.5 20.3807 15.6193 21.5 17 21.5C18.3807 21.5 19.5 20.3807 19.5 19V5C19.5 3.61929 18.3807 2.5 17 2.5Z" fill="white"/></svg>',Ie='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M20.6249 9.6185C22.4583 10.677 22.4583 13.3232 20.6249 14.3816L9.74994 20.6603C7.91661 21.7188 5.62494 20.3957 5.62494 18.2788L5.62494 5.72139C5.62494 3.60444 7.91661 2.28134 9.74994 3.33982L20.6249 9.6185Z" fill="white"/></svg>',Ae='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 4C4.89543 4 4 4.89543 4 6V12.5C4 13.0522 4.44772 13.5 5 13.5C5.55228 13.5 6 13.0522 6 12.5V6L12.5 6C13.0523 6 13.5 5.55229 13.5 5C13.5 4.44772 13.0523 4 12.5 4H6ZM20 11.5C20 10.9477 19.5523 10.5 19 10.5C18.4477 10.5 18 10.9477 18 11.5V18H11.5C10.9477 18 10.5 18.4477 10.5 19C10.5 19.5523 10.9477 20 11.5 20L18 20C19.1046 20 20 19.1045 20 18V11.5Z" fill="white"/></svg>',Ne='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M11.5 3C11.5 2.44772 11.0523 2 10.5 2C9.9477 2 9.49998 2.44772 9.49998 3V9.49998L2.99998 9.49998C2.4477 9.49998 1.99998 9.94769 1.99998 10.5C1.99998 11.0523 2.4477 11.5 2.99998 11.5L9.49998 11.5C10.6046 11.5 11.5 10.6045 11.5 9.49998L11.5 3ZM14.5 12.5C13.3954 12.5 12.5 13.3954 12.5 14.5L12.5 21C12.5 21.5522 12.9477 22 13.5 22C14.0523 22 14.5 21.5522 14.5 21L14.5 14.5L21 14.5C21.5523 14.5 22 14.0523 22 13.5C22 12.9477 21.5523 12.5 21 12.5L14.5 12.5Z" fill="white"/></svg>',Ye='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 5C9.48178 5 7.283 5.1281 5.73089 5.25397C4.6522 5.34144 3.81611 6.16547 3.72 7.23449C3.60607 8.50175 3.5 10.1729 3.5 12C3.5 13.8271 3.60607 15.4982 3.72 16.7655C3.81611 17.8345 4.6522 18.6586 5.73089 18.746C7.283 18.8719 9.48178 19 12 19C14.5185 19 16.7174 18.8719 18.2696 18.746C19.3481 18.6585 20.184 17.8347 20.2801 16.766C20.394 15.4993 20.5 13.8284 20.5 12C20.5 10.1716 20.394 8.50072 20.2801 7.234C20.184 6.16525 19.3481 5.34147 18.2696 5.25401C16.7174 5.12813 14.5185 5 12 5ZM5.60965 3.75888C7.19232 3.63053 9.43258 3.5 12 3.5C14.5677 3.5 16.8081 3.63056 18.3908 3.75891C20.1881 3.90467 21.6118 5.29473 21.7741 7.09968C21.8909 8.39885 22 10.116 22 12C22 13.884 21.8909 15.6011 21.7741 16.9003C21.6118 18.7053 20.1881 20.0953 18.3908 20.2411C16.8081 20.3694 14.5677 20.5 12 20.5C9.43258 20.5 7.19232 20.3695 5.60965 20.2411C3.81205 20.0954 2.38831 18.7049 2.22602 16.8998C2.10918 15.6002 2 13.8827 2 12C2 10.1173 2.10918 8.39982 2.22602 7.10017C2.38831 5.29507 3.81205 3.90465 5.60965 3.75888ZM9.50582 8.03601C9.52234 8.44989 9.20022 8.79881 8.78633 8.81533C8.20666 8.83848 7.72467 8.86384 7.37432 8.8844C7.3468 9.23937 7.31414 9.7246 7.2892 10.2889C7.27091 10.7028 6.92062 11.0234 6.50681 11.0051C6.093 10.9868 5.77237 10.6365 5.79066 10.2227C5.82948 9.34458 5.88637 8.65052 5.91657 8.31727C5.9609 7.82809 6.35372 7.44737 6.84098 7.41481C7.16305 7.39329 7.8313 7.35227 8.72649 7.31653C9.14038 7.3 9.48929 7.62212 9.50582 8.03601ZM15.2137 8.81533C14.7998 8.79881 14.4777 8.44989 14.4942 8.03601C14.5107 7.62212 14.8596 7.3 15.2735 7.31653C16.1687 7.35227 16.837 7.39329 17.159 7.41481C17.6463 7.44737 18.0391 7.82809 18.0834 8.31727C18.1136 8.65052 18.1705 9.34458 18.2093 10.2227C18.2276 10.6365 17.907 10.9868 17.4932 11.0051C17.0794 11.0234 16.7291 10.7028 16.7108 10.2889C16.6859 9.7246 16.6532 9.23937 16.6257 8.8844C16.2753 8.86384 15.7933 8.83848 15.2137 8.81533ZM9.50582 15.964C9.52234 15.5501 9.20022 15.2012 8.78633 15.1847C8.20666 15.1615 7.72467 15.1362 7.37432 15.1156C7.3468 14.7606 7.31414 14.2754 7.2892 13.7111C7.27091 13.2972 6.92062 12.9766 6.50681 12.9949C6.093 13.0132 5.77237 13.3635 5.79066 13.7773C5.82948 14.6554 5.88637 15.3495 5.91657 15.6827C5.9609 16.1719 6.35372 16.5526 6.84098 16.5852C7.16305 16.6067 7.8313 16.6477 8.72649 16.6835C9.14038 16.7 9.48929 16.3779 9.50582 15.964ZM15.2137 15.1847C14.7998 15.2012 14.4777 15.5501 14.4942 15.964C14.5107 16.3779 14.8596 16.7 15.2735 16.6835C16.1687 16.6477 16.837 16.6067 17.159 16.5852C17.6463 16.5526 18.0391 16.1719 18.0834 15.6827C18.1136 15.3495 18.1705 14.6554 18.2093 13.7773C18.2276 13.3635 17.907 13.0132 17.4932 12.9949C17.0794 12.9766 16.7291 13.2972 16.7108 13.7111C16.6859 14.2754 16.6532 14.7606 16.6257 15.1156C16.2753 15.1362 15.7933 15.1615 15.2137 15.1847Z" fill="white"/></svg>',Xe='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 5C9.48178 5 7.283 5.1281 5.73089 5.25397C4.6522 5.34144 3.81611 6.16547 3.72 7.23449C3.60607 8.50175 3.5 10.1729 3.5 12C3.5 13.8271 3.60607 15.4982 3.72 16.7655C3.81611 17.8345 4.6522 18.6586 5.73089 18.746C7.283 18.8719 9.48178 19 12 19C14.5185 19 16.7174 18.8719 18.2696 18.746C19.3481 18.6585 20.184 17.8347 20.2801 16.766C20.394 15.4993 20.5 13.8284 20.5 12C20.5 10.1716 20.394 8.50072 20.2801 7.234C20.184 6.16525 19.3481 5.34147 18.2696 5.25401C16.7174 5.12813 14.5185 5 12 5ZM5.60965 3.75888C7.19232 3.63053 9.43258 3.5 12 3.5C14.5677 3.5 16.8081 3.63056 18.3908 3.75891C20.1881 3.90467 21.6118 5.29473 21.7741 7.09968C21.8909 8.39885 22 10.116 22 12C22 13.884 21.8909 15.6011 21.7741 16.9003C21.6118 18.7053 20.1881 20.0953 18.3908 20.2411C16.8081 20.3694 14.5677 20.5 12 20.5C9.43258 20.5 7.19232 20.3695 5.60965 20.2411C3.81205 20.0954 2.38831 18.7049 2.22602 16.8998C2.10918 15.6002 2 13.8827 2 12C2 10.1173 2.10918 8.39982 2.22602 7.10017C2.38831 5.29507 3.81205 3.90465 5.60965 3.75888ZM18.0059 13.5399C18.0225 13.9538 17.7003 14.3027 17.2865 14.3192C16.7068 14.3424 16.2248 14.3677 15.8744 14.3883C15.8469 14.7433 15.8143 15.2285 15.7893 15.7928C15.771 16.2067 15.4207 16.5273 15.0069 16.509C14.5931 16.4907 14.2725 16.1404 14.2908 15.7266C14.3296 14.8485 14.3865 14.1544 14.4167 13.8212C14.461 13.332 14.8538 12.9513 15.3411 12.9187C15.6632 12.8972 16.3314 12.8562 17.2266 12.8204C17.6405 12.8039 17.9894 13.126 18.0059 13.5399ZM6.71354 14.3192C6.29966 14.3027 5.97754 13.9538 5.99406 13.5399C6.01059 13.126 6.3595 12.8039 6.77339 12.8204C7.66858 12.8562 8.33683 12.8972 8.6589 12.9187C9.14616 12.9513 9.53898 13.332 9.58331 13.8212C9.61351 14.1544 9.6704 14.8485 9.70922 15.7266C9.72751 16.1404 9.40688 16.4907 8.99307 16.509C8.57926 16.5273 8.22897 16.2067 8.21068 15.7928C8.18573 15.2285 8.15308 14.7433 8.12556 14.3883C7.77521 14.3677 7.29322 14.3424 6.71354 14.3192ZM18.0059 10.4601C18.0225 10.0462 17.7003 9.69729 17.2865 9.68076C16.7068 9.65762 16.2248 9.63225 15.8744 9.61169C15.8469 9.25673 15.8143 8.77149 15.7893 8.20715C15.771 7.79334 15.4207 7.47271 15.0069 7.491C14.5931 7.50929 14.2725 7.85958 14.2908 8.27339C14.3296 9.15151 14.3865 9.84557 14.4167 10.1788C14.461 10.668 14.8538 11.0487 15.3411 11.0813C15.6632 11.1028 16.3314 11.1438 17.2266 11.1796C17.6405 11.1961 17.9894 10.874 18.0059 10.4601ZM6.71354 9.68076C6.29966 9.69729 5.97754 10.0462 5.99406 10.4601C6.01059 10.874 6.3595 11.1961 6.77339 11.1796C7.66858 11.1438 8.33683 11.1028 8.6589 11.0813C9.14616 11.0487 9.53898 10.668 9.58331 10.1788C9.61351 9.84557 9.6704 9.15151 9.70922 8.27339C9.72751 7.85958 9.40688 7.50929 8.99307 7.491C8.57926 7.47271 8.22897 7.79334 8.21068 8.20715C8.18573 8.77149 8.15308 9.25673 8.12556 9.61169C7.77521 9.63225 7.29322 9.65762 6.71354 9.68076Z" fill="white"/></svg>',De='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4.99805C9.48178 4.99805 7.283 5.12615 5.73089 5.25202C4.6522 5.33949 3.81611 6.16351 3.72 7.23253C3.60607 8.4998 3.5 10.171 3.5 11.998C3.5 13.8251 3.60607 15.4963 3.72 16.7636C3.8161 17.8325 4.65243 18.6566 5.73121 18.7441C6.85323 18.8351 8.3137 18.9273 9.98883 18.9714C10.4029 18.9823 10.7297 19.3268 10.7188 19.7408C10.7079 20.1549 10.3634 20.4817 9.94937 20.4708C8.24273 20.4259 6.75465 20.332 5.60997 20.2392C3.81247 20.0934 2.38832 18.7031 2.22602 16.8979C2.10918 15.5982 2 13.8808 2 11.998C2 10.1153 2.10918 8.39787 2.22602 7.09822C2.38831 5.29311 3.81205 3.90269 5.60965 3.75692C7.19232 3.62858 9.43258 3.49805 12 3.49805C14.5677 3.49805 16.8081 3.62861 18.3908 3.75696C20.1883 3.90273 21.6118 5.29327 21.7741 7.09811C21.8459 7.89664 21.9147 8.85236 21.9571 9.90718C21.9738 10.3211 21.6518 10.6701 21.2379 10.6867C20.824 10.7034 20.475 10.3813 20.4583 9.96745C20.4171 8.94094 20.3501 8.01018 20.2801 7.23242C20.184 6.16356 19.348 5.33951 18.2696 5.25205C16.7174 5.12618 14.5185 4.99805 12 4.99805ZM12.5 15.25C12.5 13.7312 13.7312 12.5 15.25 12.5H20.25C21.7688 12.5 23 13.7312 23 15.25V18.25C23 19.7688 21.7688 21 20.25 21H15.25C13.7312 21 12.5 19.7688 12.5 18.25V15.25ZM15.25 14C14.5596 14 14 14.5596 14 15.25V18.25C14 18.9404 14.5596 19.5 15.25 19.5H20.25C20.9404 19.5 21.5 18.9404 21.5 18.25V15.25C21.5 14.5596 20.9404 14 20.25 14H15.25ZM12.0303 11.9697C12.3232 12.2626 12.3232 12.7374 12.0303 13.0303C11.7374 13.3232 11.2626 13.3232 10.9697 13.0303L8.75 10.8107V12C8.75 12.4142 8.41421 12.75 8 12.75C7.58579 12.75 7.25 12.4142 7.25 12V9C7.25 8.58579 7.58579 8.25 8 8.25H11C11.4142 8.25 11.75 8.58579 11.75 9C11.75 9.41421 11.4142 9.75 11 9.75H9.81066L12.0303 11.9697Z" fill="white"/></svg>',Ge='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 4.99805C9.48178 4.99805 7.283 5.12615 5.73089 5.25202C4.6522 5.33949 3.81611 6.16351 3.72 7.23253C3.60607 8.4998 3.5 10.171 3.5 11.998C3.5 13.8251 3.60607 15.4963 3.72 16.7636C3.8161 17.8325 4.65243 18.6566 5.73121 18.7441C6.85323 18.8351 8.3137 18.9273 9.98883 18.9714C10.4029 18.9823 10.7297 19.3268 10.7188 19.7408C10.7079 20.1549 10.3634 20.4817 9.94937 20.4708C8.24273 20.4259 6.75465 20.332 5.60997 20.2392C3.81247 20.0934 2.38832 18.7031 2.22602 16.8979C2.10918 15.5982 2 13.8808 2 11.998C2 10.1153 2.10918 8.39787 2.22602 7.09822C2.38831 5.29311 3.81205 3.90269 5.60965 3.75692C7.19232 3.62858 9.43258 3.49805 12 3.49805C14.5677 3.49805 16.8081 3.62861 18.3908 3.75696C20.1883 3.90273 21.6118 5.29327 21.7741 7.09811C21.8459 7.89664 21.9147 8.85236 21.9571 9.90718C21.9738 10.3211 21.6518 10.6701 21.2379 10.6867C20.824 10.7034 20.475 10.3813 20.4583 9.96745C20.4171 8.94094 20.3501 8.01018 20.2801 7.23242C20.184 6.16356 19.348 5.33951 18.2696 5.25205C16.7174 5.12618 14.5185 4.99805 12 4.99805ZM12.5 15.25C12.5 13.7312 13.7312 12.5 15.25 12.5H20.25C21.7688 12.5 23 13.7312 23 15.25V18.25C23 19.7688 21.7688 21 20.25 21H15.25C13.7312 21 12.5 19.7688 12.5 18.25V15.25ZM15.25 14C14.5596 14 14 14.5596 14 15.25V18.25C14 18.9404 14.5596 19.5 15.25 19.5H20.25C20.9404 19.5 21.5 18.9404 21.5 18.25V15.25C21.5 14.5596 20.9404 14 20.25 14H15.25ZM8.53033 8.46967C8.23744 8.17678 7.76256 8.17678 7.46967 8.46967C7.17678 8.76256 7.17678 9.23744 7.46967 9.53033L9.68934 11.75H8.5C8.08579 11.75 7.75 12.0858 7.75 12.5C7.75 12.9142 8.08579 13.25 8.5 13.25H11.5C11.9142 13.25 12.25 12.9142 12.25 12.5V9.5C12.25 9.08579 11.9142 8.75 11.5 8.75C11.0858 8.75 10.75 9.08579 10.75 9.5V10.6893L8.53033 8.46967Z" fill="white"/></svg>',Ue='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.7803 4.28033C21.0732 3.98744 21.0732 3.51256 20.7803 3.21967C20.4874 2.92678 20.0126 2.92678 19.7197 3.21967L19.3955 3.54385C19.298 3.5596 19.2005 3.5819 19.1035 3.61101L18.4722 3.80038C18.0755 3.9194 17.8504 4.33751 17.9694 4.73426C17.987 4.79296 18.0111 4.8479 18.0408 4.89853L14.5 8.43934V7.86015C14.5 7.73328 14.5136 7.60929 14.5395 7.4896C14.6271 7.08475 14.3699 6.68557 13.965 6.598C13.5602 6.51043 13.161 6.76763 13.0734 7.17248C13.0252 7.39547 13 7.62575 13 7.86015V8.55014C13 8.92917 13.2812 9.24253 13.6463 9.29303L11 11.9393V7.11612C11 6.12251 10.3482 5.24653 9.39653 4.96101L4.89653 3.61101C3.45291 3.17793 2 4.25893 2 5.76612V18.234C2 19.0354 2.41077 19.7163 3.01251 20.1132C2.96922 20.3477 3.03828 20.5989 3.21967 20.7803C3.51256 21.0732 3.98744 21.0732 4.28033 20.7803L20.7803 4.28033ZM3.99841 18.9409L9.5 13.4393V7.11612C9.5 6.78492 9.28275 6.49293 8.96551 6.39775L4.46551 5.04775C3.9843 4.90339 3.5 5.26373 3.5 5.76612V18.234C3.5 18.5678 3.71379 18.8389 3.99841 18.9409ZM8.96551 17.6024L8.57759 17.7188L6.34038 19.956L9.39653 19.0391C10.3482 18.7536 11 17.8777 11 16.884V15.2964L9.5 16.7964V16.884C9.5 17.2152 9.28275 17.5072 8.96551 17.6024ZM13.75 13.4401C13.5063 13.4401 13.2897 13.3238 13.1527 13.1437L14.5 11.7964V12.6901C14.5 13.1043 14.1642 13.4401 13.75 13.4401ZM20.5 6.45878V5.79636L21.6058 4.69061C21.7375 4.78157 21.8413 4.91525 21.8938 5.0796C21.963 5.2964 22 5.52713 22 5.76612V6.45878C22 6.873 21.6642 7.20878 21.25 7.20878C20.8358 7.20878 20.5 6.873 20.5 6.45878ZM15.9473 4.55785C16.3441 4.43882 16.7622 4.66396 16.8812 5.06071C17.0002 5.45745 16.7751 5.87556 16.3784 5.99459L15.7471 6.18395C15.6256 6.22041 15.5108 6.26907 15.4036 6.32826C15.041 6.52847 14.5847 6.39682 14.3845 6.0342C14.1843 5.67159 14.3159 5.21533 14.6785 5.01512C14.8783 4.90484 15.0916 4.81457 15.3161 4.74722L15.9473 4.55785ZM20.5 9.22943C20.5 8.81521 20.8358 8.47943 21.25 8.47943C21.6642 8.47943 22 8.81521 22 9.22943V10.6148C22 11.029 21.6642 11.3648 21.25 11.3648C20.8358 11.3648 20.5 11.029 20.5 10.6148V9.22943ZM20.5 13.3854C20.5 12.9712 20.8358 12.6354 21.25 12.6354C21.6642 12.6354 22 12.9712 22 13.3854V14.7707C22 15.1849 21.6642 15.5207 21.25 15.5207C20.8358 15.5207 20.5 15.1849 20.5 14.7707V13.3854ZM13 15.45C13 15.0358 13.3358 14.7 13.75 14.7C14.1642 14.7 14.5 15.0358 14.5 15.45V16.14C14.5 16.2669 14.5136 16.3909 14.5395 16.5105C14.6271 16.9154 14.3699 17.3146 13.965 17.4022C13.5602 17.4897 13.161 17.2325 13.0734 16.8277C13.0252 16.6047 13 16.3744 13 16.14V15.45ZM20.5 17.5414C20.5 17.1272 20.8358 16.7914 21.25 16.7914C21.6642 16.7914 22 17.1272 22 17.5414V18.234C22 18.473 21.963 18.7037 21.8938 18.9206C21.7679 19.3152 21.3459 19.533 20.9513 19.407C20.5567 19.2811 20.3389 18.8591 20.4648 18.4645C20.4872 18.3943 20.5 18.3173 20.5 18.234V17.5414ZM14.6785 18.985C14.3159 18.7848 14.1843 18.3286 14.3845 17.9659C14.5847 17.6033 15.041 17.4717 15.4036 17.6719C15.5108 17.7311 15.6256 17.7797 15.7471 17.8162L16.3784 18.0056C16.7751 18.1246 17.0002 18.5427 16.8812 18.9394C16.7622 19.3362 16.3441 19.5613 15.9473 19.4423L15.3161 19.2529C15.0916 19.1856 14.8783 19.0953 14.6785 18.985ZM18.4722 20.1998C18.0755 20.0807 17.8504 19.6626 17.9694 19.2659C18.0884 18.8691 18.5065 18.644 18.9033 18.763L19.5345 18.9524C19.6143 18.9763 19.6916 18.9862 19.7654 18.9849C20.1795 18.9777 20.5211 19.3076 20.5284 19.7217C20.5356 20.1359 20.2057 20.4774 19.7916 20.4847C19.564 20.4886 19.3324 20.4578 19.1035 20.3891L18.4722 20.1998Z" fill="white"/></svg>',We='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.89653 3.61101C3.45291 3.17793 2 4.25893 2 5.76612V18.234C2 19.7412 3.45291 20.8222 4.89653 20.3891L9.39653 19.0391C10.3482 18.7536 11 17.8777 11 16.884V7.11612C11 6.12251 10.3482 5.24653 9.39653 4.96101L4.89653 3.61101ZM3.5 5.76612C3.5 5.26373 3.9843 4.90339 4.46551 5.04775L8.96551 6.39775C9.28275 6.49293 9.5 6.78492 9.5 7.11612V16.884C9.5 17.2152 9.28275 17.5072 8.96551 17.6024L4.46551 18.9524C3.9843 19.0968 3.5 18.7364 3.5 18.234V5.76612ZM19.7654 5.01525C19.6916 5.01396 19.6143 5.02382 19.5345 5.04775L18.9033 5.23712C18.5065 5.35614 18.0884 5.131 17.9694 4.73426C17.8504 4.33751 18.0755 3.9194 18.4722 3.80038L19.1035 3.61101C19.3324 3.54234 19.564 3.51151 19.7916 3.51548C20.2057 3.5227 20.5356 3.86429 20.5284 4.27844C20.5211 4.69259 20.1795 5.02247 19.7654 5.01525ZM15.9473 4.55785C16.3441 4.43882 16.7622 4.66396 16.8812 5.06071C17.0002 5.45745 16.7751 5.87556 16.3784 5.99459L15.7471 6.18395C15.6256 6.22041 15.5108 6.26907 15.4036 6.32826C15.041 6.52847 14.5847 6.39682 14.3845 6.0342C14.1843 5.67159 14.3159 5.21533 14.6785 5.01512C14.8783 4.90484 15.0916 4.81457 15.3161 4.74722L15.9473 4.55785ZM20.4648 5.53561C20.3389 5.141 20.5567 4.71903 20.9513 4.5931C21.3459 4.46718 21.7679 4.68499 21.8938 5.0796C21.963 5.2964 22 5.52713 22 5.76612V6.45878C22 6.873 21.6642 7.20878 21.25 7.20878C20.8358 7.20878 20.5 6.873 20.5 6.45878V5.76612C20.5 5.68283 20.4872 5.60588 20.4648 5.53561ZM13.0734 7.17248C13.161 6.76763 13.5602 6.51043 13.965 6.598C14.3699 6.68557 14.6271 7.08475 14.5395 7.4896C14.5136 7.60929 14.5 7.73328 14.5 7.86015V8.55014C14.5 8.96435 14.1642 9.30014 13.75 9.30014C13.3358 9.30014 13 8.96435 13 8.55014V7.86015C13 7.62575 13.0252 7.39547 13.0734 7.17248ZM20.5 9.22943C20.5 8.81521 20.8358 8.47943 21.25 8.47943C21.6642 8.47943 22 8.81521 22 9.22943V10.6148C22 11.029 21.6642 11.3648 21.25 11.3648C20.8358 11.3648 20.5 11.029 20.5 10.6148V9.22943ZM13 11.3101C13 10.8959 13.3358 10.5601 13.75 10.5601C14.1642 10.5601 14.5 10.8959 14.5 11.3101V12.6901C14.5 13.1043 14.1642 13.4401 13.75 13.4401C13.3358 13.4401 13 13.1043 13 12.6901V11.3101ZM20.5 13.3854C20.5 12.9712 20.8358 12.6354 21.25 12.6354C21.6642 12.6354 22 12.9712 22 13.3854V14.7707C22 15.1849 21.6642 15.5207 21.25 15.5207C20.8358 15.5207 20.5 15.1849 20.5 14.7707V13.3854ZM13 15.45C13 15.0358 13.3358 14.7 13.75 14.7C14.1642 14.7 14.5 15.0358 14.5 15.45V16.14C14.5 16.2669 14.5136 16.3909 14.5395 16.5105C14.6271 16.9154 14.3699 17.3146 13.965 17.4022C13.5602 17.4897 13.161 17.2325 13.0734 16.8277C13.0252 16.6047 13 16.3744 13 16.14V15.45ZM20.5 17.5414C20.5 17.1272 20.8358 16.7914 21.25 16.7914C21.6642 16.7914 22 17.1272 22 17.5414V18.234C22 18.473 21.963 18.7037 21.8938 18.9206C21.7679 19.3152 21.3459 19.533 20.9513 19.407C20.5567 19.2811 20.3389 18.8591 20.4648 18.4645C20.4872 18.3943 20.5 18.3173 20.5 18.234V17.5414ZM14.6785 18.985C14.3159 18.7848 14.1843 18.3286 14.3845 17.9659C14.5847 17.6033 15.041 17.4717 15.4036 17.6719C15.5108 17.7311 15.6256 17.7797 15.7471 17.8162L16.3784 18.0056C16.7751 18.1246 17.0002 18.5427 16.8812 18.9394C16.7622 19.3362 16.3441 19.5613 15.9473 19.4423L15.3161 19.2529C15.0916 19.1856 14.8783 19.0953 14.6785 18.985ZM18.4722 20.1998C18.0755 20.0807 17.8504 19.6626 17.9694 19.2659C18.0884 18.8691 18.5065 18.644 18.9033 18.763L19.5345 18.9524C19.6143 18.9763 19.6916 18.9862 19.7654 18.9849C20.1795 18.9777 20.5211 19.3076 20.5284 19.7217C20.5356 20.1359 20.2057 20.4774 19.7916 20.4847C19.564 20.4886 19.3324 20.4578 19.1035 20.3891L18.4722 20.1998Z" fill="white"/></svg>',Je='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.08653 3.39235L8.28133 5.18624C7.5461 5.2058 6.76295 5.23027 5.93182 5.25963C4.13556 5.3231 2.64276 6.66421 2.38792 8.44343C2.22599 9.57393 2.14575 10.9534 2.14575 12.585C2.14575 14.5393 2.2609 16.2276 2.49273 17.6524C2.77397 19.3808 4.22464 20.6776 5.97357 20.7641C7.873 20.8581 10.3376 20.9051 12.5283 20.9051C12.908 20.9051 13.2158 20.5973 13.2158 20.2176C13.2158 19.8379 12.908 19.5301 12.5283 19.5301C10.3595 19.5301 7.91746 19.4836 6.04152 19.3908C4.94034 19.3363 4.02696 18.5198 3.84988 17.4316C3.63098 16.0863 3.52075 14.47 3.52075 12.585C3.52075 11.014 3.59733 9.69747 3.74903 8.63839C3.90948 7.51814 4.8494 6.67374 5.98038 6.63378C8.40317 6.54817 10.4129 6.50452 12.0085 6.50276C13.6041 6.50452 15.6138 6.54817 18.0366 6.63378C19.1676 6.67374 20.1075 7.51814 20.2679 8.63839C20.4196 9.69747 20.4732 11.0897 20.4732 12.6607C20.4732 13.0404 20.781 13.3482 21.1607 13.3482C21.5404 13.3482 21.8482 13.0404 21.8482 12.6607C21.8482 11.0291 21.791 9.57393 21.629 8.44343C21.3742 6.66421 19.8814 5.3231 18.0851 5.25963C17.1431 5.22635 16.2626 5.19936 15.4438 5.17867L16.7064 3.42188C17.0314 2.96967 16.9283 2.33961 16.4761 2.0146C16.0239 1.68959 15.3938 1.7927 15.0688 2.24491L13.1622 4.89769C13.1086 4.97233 13.0666 5.05182 13.0359 5.13398C12.7202 5.13065 12.4175 5.12864 12.1278 5.12796L12.1087 5.1277L12.0085 5.12776L11.9083 5.1277L11.8892 5.12796C11.4963 5.12888 11.0797 5.13224 10.6392 5.13805C10.6124 5.06532 10.5767 4.99456 10.5318 4.92722L8.76499 2.27444C8.45628 1.81094 7.8303 1.68546 7.3668 1.99416C6.90331 2.30287 6.77783 2.92886 7.08653 3.39235ZM11.2013 9.59793H12.5213C12.2683 9.08093 11.9933 8.62993 11.6963 8.23393L12.7413 7.88193C13.0493 8.32193 13.3243 8.78393 13.5553 9.28993L12.8623 9.59793H14.3803C14.6883 9.03693 14.9523 8.43193 15.1943 7.79393L16.2833 8.17893C16.0633 8.70693 15.8103 9.17993 15.5353 9.59793H16.8113V13.0393C15.1626 13.4113 13.8225 14.5979 13.2362 16.1539H10.8053V15.0759H13.4233V14.2289H11.2013V9.59793ZM8.49535 11.6769L8.34135 13.1619H10.5413C10.5413 15.0539 10.4753 16.3189 10.3653 16.9569C10.2333 17.5949 9.67235 17.9469 8.67135 18.0129C8.40449 18.0129 8.13763 17.9938 7.8529 17.9733L7.79135 17.9689L7.49435 16.9019C7.78035 16.9349 8.08835 16.9569 8.39635 16.9569C8.94635 16.9569 9.25435 16.7809 9.33135 16.4289C9.40835 16.0769 9.45235 15.3179 9.45235 14.1519H7.17535L7.48335 10.6979H9.34235V9.26793H7.27435V8.28893H10.4753V11.6769H8.49535ZM15.7993 12.4139V13.2719H14.5453V12.4139H15.7993ZM13.4233 13.2719V12.4139H12.2243V13.2719H13.4233ZM13.4233 11.4679H12.2243V10.5659H13.4233V11.4679ZM14.5453 10.5659V11.4679H15.7993V10.5659H14.5453ZM22.0624 18.0626C22.0624 20.2717 20.2716 22.0626 18.0624 22.0626C15.8533 22.0626 14.0624 20.2717 14.0624 18.0626C14.0624 15.8534 15.8533 14.0626 18.0624 14.0626C20.2716 14.0626 22.0624 15.8534 22.0624 18.0626ZM15.3256 18.0626C15.3256 19.5741 16.5509 20.7994 18.0624 20.7994C18.579 20.7994 19.0621 20.6563 19.4743 20.4076L15.7172 16.6511C15.4686 17.0632 15.3256 17.5462 15.3256 18.0626ZM20.4074 19.4746C20.6561 19.0623 20.7993 18.5792 20.7993 18.0626C20.7993 16.551 19.5739 15.3257 18.0624 15.3257C17.5456 15.3257 17.0623 15.469 16.6499 15.7179L20.4074 19.4746Z" fill="white"/></svg>',Ke='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8.28142 5.18618L7.08662 3.39229C6.77792 2.9288 6.9034 2.30281 7.36689 1.99411C7.83039 1.6854 8.45638 1.81089 8.76508 2.27438L10.5319 4.92716C10.5768 4.9945 10.6125 5.06527 10.6393 5.13799C11.1174 5.13169 11.5675 5.12827 11.9896 5.12772L12 5.12765L12.0544 5.12766L12.1088 5.12765L12.1192 5.12772C12.4115 5.1281 12.7172 5.12986 13.0363 5.13299C13.067 5.05116 13.1088 4.97199 13.1623 4.89763L15.0689 2.24485C15.3939 1.79264 16.024 1.68953 16.4762 2.01454C16.9284 2.33955 17.0315 2.96961 16.7065 3.42182L15.4455 5.17635C16.2897 5.19733 17.2002 5.22507 18.1769 5.25958C19.9731 5.32304 21.3759 6.72997 21.6308 8.50919C21.7162 9.10539 21.7578 10.6458 21.7884 11.7781C21.7974 12.1111 21.8055 12.4088 21.8134 12.6368C21.8266 13.0162 21.5297 13.3345 21.1502 13.3477C20.7708 13.3609 20.4524 13.064 20.4392 12.6845C20.4313 12.4551 20.4233 12.1482 20.4143 11.8042C20.386 10.7137 20.348 9.25085 20.2696 8.70415C20.1092 7.5839 19.2593 6.67368 18.1283 6.63372C15.6823 6.5473 13.6573 6.50363 12.0544 6.50266C10.4515 6.50363 8.42652 6.5473 5.98047 6.63372C4.84949 6.67368 3.90958 7.51808 3.74912 8.63833C3.59742 9.69741 3.52084 11.014 3.52084 12.5849C3.52084 14.4699 3.63107 16.0862 3.84998 17.4315C4.02705 18.5198 4.94043 19.3363 6.04161 19.3908C7.91755 19.4836 9.30361 19.53 11.4724 19.53C11.8521 19.53 12.1599 19.8378 12.1599 20.2175C12.1599 20.5972 11.8521 20.905 11.4724 20.905C9.28169 20.905 7.87309 20.8581 5.97366 20.7641C4.22473 20.6776 2.77406 19.3807 2.49283 17.6524C2.26099 16.2276 2.14584 14.5392 2.14584 12.5849C2.14584 10.9534 2.22608 9.57387 2.38801 8.44338C2.64285 6.66416 4.13566 5.32304 5.93192 5.25958C6.76304 5.23021 7.5462 5.20575 8.28142 5.18618ZM12.5105 9.60362H11.1905V14.2346H13.4125V15.0816H10.7945V16.1596H13.4125L13.4152 16.8373C13.7755 16.8635 14.129 16.9998 14.425 17.2443H14.5345V16.1596H17.2295V15.0816H14.5345V14.2346H16.8005V9.60362H15.5245C15.7995 9.18562 16.0525 8.71262 16.2725 8.18462L15.1835 7.79962C14.9415 8.43762 14.6775 9.04262 14.3695 9.60362H12.8515L13.5445 9.29562C13.3135 8.78962 13.0385 8.32762 12.7305 7.88762L11.6855 8.23962C11.9825 8.63562 12.2575 9.08662 12.5105 9.60362ZM8.33053 13.1676L8.48453 11.6826H10.4645V8.29462H7.26353V9.27362H9.33153V10.7036H7.47253L7.16453 14.1576H9.44153C9.44153 15.3236 9.39753 16.0826 9.32053 16.4346C9.24353 16.7866 8.93553 16.9626 8.38553 16.9626C8.07753 16.9626 7.76953 16.9406 7.48353 16.9076L7.78053 17.9746L7.84208 17.979C8.12681 17.9995 8.39367 18.0186 8.66053 18.0186C9.66153 17.9526 10.2225 17.6006 10.3545 16.9626C10.4645 16.3246 10.5305 15.0596 10.5305 13.1676H8.33053ZM15.7885 13.2776V12.4196H14.5345V13.2776H15.7885ZM13.4125 12.4196V13.2776H12.2135V12.4196H13.4125ZM12.2135 11.4736H13.4125V10.5716H12.2135V11.4736ZM14.5345 11.4736V10.5716H15.7885V11.4736H14.5345Z" fill="white"/><path d="M21.6199 14.869C21.8969 14.561 22.3712 14.5359 22.6791 14.813C22.9591 15.0648 23.0052 15.4796 22.8032 15.7843L22.7351 15.8721L16.9306 22.3705C16.6648 22.666 16.2207 22.699 15.9154 22.4632L15.8359 22.3922L12.8796 19.3578C12.5905 19.0611 12.5967 18.5863 12.8934 18.2972C13.1631 18.0345 13.5801 18.0157 13.8708 18.2374L13.954 18.3111L16.351 20.771L21.6199 14.869Z" fill="#FF6699"/></svg>';function Qe(e){q(e,"svelte-11g6lf7",".tip-wrap.svelte-11g6lf7.svelte-11g6lf7{position:relative}.tip-wrap.svelte-11g6lf7:hover .tip.svelte-11g6lf7{display:block}.tip.svelte-11g6lf7.svelte-11g6lf7{line-height:21px;padding:6px 10px;word-break:keep-all;white-space:nowrap;display:none}")}function et(e){var t,n,i,r;return{c:function(){t=B("div"),n=O(e[0]),Y(t,"class","tip panel svelte-11g6lf7"),Y(t,"style",e[1])},m:function(e,i){E(e,t,i),S(t,n),r=!0},p:function(e,i){(!r||1&i)&&D(n,e[0]),(!r||2&i)&&Y(t,"style",e[1])},i:function(e){r||(Ce(function(){r&&(i||(i=Se(t,Re,{duration:200,y:10},!0)),i.run(1))}),r=!0)},o:function(e){i||(i=Se(t,Re,{duration:200,y:10},!1)),i.run(0),r=!1},d:function(e){e&&T(t),e&&i&&i.end()}}}function tt(e){var t,n,i,r,o,l,a=e[2]&&e[0]&&et(e),c=e[4].default,u=function(e,t,n,i){if(e){var r=y(e,t,n,null);return e[0](r)}}(c,e,e[3]);return{c:function(){t=B("div"),a&&a.c(),n=R(),i=B("div"),u&&u.c(),Y(t,"class","tip-wrap svelte-11g6lf7")},m:function(c,s){E(c,t,s),a&&a.m(t,null),S(t,n),S(t,i),u&&u.m(i,null),r=!0,o||(l=[I(t,"mouseenter",e[5]),I(t,"mouseleave",e[6])],o=!0)},p:function(e,i){var o=f(i,1)[0];e[2]&&e[0]?a?(a.p(e,o),5&o&&Ve(a,1)):((a=et(e)).c(),Ve(a,1),a.m(t,n)):a&&(Le(),He(a,1,1,function(){a=null}),Me()),u&&u.p&&(!r||8&o)&&function(e,t,n,i,r,o){if(r){var l=y(t,n,i,null);e.p(l,r)}}(u,c,e,e[3],r?function(e,t,n,i){return e[2],t.dirty}(c,e[3]):function(e){if(e.ctx.length>32){for(var t=[],n=e.ctx.length/32,i=0;i<n;i++)t[i]=-1;return t}return-1}(e[3]))},i:function(e){r||(Ve(a),Ve(u,e),r=!0)},o:function(e){He(a),He(u,e),r=!1},d:function(e){e&&T(t),a&&a.d(),u&&u.d(e),o=!1,x(l)}}}function nt(e,t,n){var i=t.$$slots,r=void 0===i?{}:i,o=t.$$scope,l=t.text,a=void 0===l?"":l,c=t.style,u=void 0===c?"":c,s=!1;return e.$$set=function(e){"text"in e&&n(0,a=e.text),"style"in e&&n(1,u=e.style),"$$scope"in e&&n(3,o=e.$$scope)},[a,u,s,o,r,function(){return n(2,s=!0)},function(){return n(2,s=!1)}]}var it=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,nt,tt,b,{text:0,style:1},Qe),r}return i}(),rt='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7815 4.28522C13.2722 3.89261 14 4.24201 14 4.87128V19.1286C14 19.7579 13.2722 20.1073 12.7815 19.7147L8.54026 16.3217C7.87534 15.7897 7.04918 15.4999 6.19766 15.4999H4.38145C4.03827 15.4999 3.79833 15.281 3.7531 15.0177C3.62929 14.2971 3.49999 13.2456 3.5 11.9999C3.50001 10.7543 3.6293 9.70279 3.7531 8.98216C3.79833 8.71888 4.03828 8.49994 4.38146 8.49994H6.19766C7.04917 8.49994 7.87534 8.21014 8.54026 7.6782L12.7815 4.28522ZM15.5 4.87128C15.5 2.98504 13.318 1.9351 11.8444 3.11392L7.60322 6.50689C7.20427 6.82606 6.70857 6.99994 6.19766 6.99994H4.38146C3.38521 6.99994 2.45632 7.67137 2.27476 8.72819C2.13963 9.51477 2.00001 10.6527 2 11.9999C1.99999 13.3472 2.13962 14.4851 2.27475 15.2717C2.45632 16.3285 3.3852 16.9999 4.38145 16.9999H6.19766C6.70857 16.9999 7.20427 17.1738 7.60322 17.493L11.8444 20.886C13.318 22.0648 15.5 21.0148 15.5 19.1286V4.87128ZM22.25 11.25H17.75C17.3358 11.25 17 11.5858 17 12C17 12.4142 17.3358 12.75 17.75 12.75H22.25C22.6642 12.75 23 12.4142 23 12C23 11.5858 22.6642 11.25 22.25 11.25ZM18.2803 14.7197L20.7803 17.2197C21.0732 17.5126 21.0732 17.9874 20.7803 18.2803C20.4874 18.5732 20.0126 18.5732 19.7197 18.2803L17.2197 15.7803C16.9268 15.4874 16.9268 15.0126 17.2197 14.7197C17.5126 14.4268 17.9874 14.4268 18.2803 14.7197ZM20.7803 6.78033C21.0732 6.48744 21.0732 6.01256 20.7803 5.71967C20.4874 5.42678 20.0126 5.42678 19.7197 5.71967L17.2197 8.21967C16.9268 8.51256 16.9268 8.98744 17.2197 9.28033C17.5126 9.57322 17.9874 9.57322 18.2803 9.28033L20.7803 6.78033Z" fill="white"/></svg>',ot='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7815 4.28522C13.2722 3.89261 14 4.24201 14 4.87128V19.1286C14 19.7579 13.2722 20.1073 12.7815 19.7147L8.54026 16.3217C7.87534 15.7897 7.04918 15.4999 6.19766 15.4999H4.38145C4.03827 15.4999 3.79833 15.281 3.7531 15.0177C3.62929 14.2971 3.49999 13.2456 3.5 11.9999C3.50001 10.7543 3.6293 9.70279 3.7531 8.98216C3.79833 8.71888 4.03828 8.49994 4.38146 8.49994H6.19766C7.04917 8.49994 7.87534 8.21014 8.54026 7.6782L12.7815 4.28522ZM15.5 4.87128C15.5 2.98504 13.318 1.9351 11.8444 3.11392L7.60322 6.50689C7.20427 6.82606 6.70857 6.99994 6.19766 6.99994H4.38146C3.38521 6.99994 2.45632 7.67137 2.27476 8.72819C2.13963 9.51477 2.00001 10.6527 2 11.9999C1.99999 13.3472 2.13962 14.4851 2.27475 15.2717C2.45632 16.3285 3.3852 16.9999 4.38145 16.9999H6.19766C6.70857 16.9999 7.20427 17.1738 7.60322 17.493L11.8444 20.886C13.318 22.0648 15.5 21.0148 15.5 19.1286V4.87128ZM23.2803 10.0303C23.5732 9.73743 23.5732 9.26256 23.2803 8.96967C22.9874 8.67677 22.5126 8.67678 22.2197 8.96967L20.25 10.9394L18.2803 8.96975C17.9874 8.67686 17.5126 8.67686 17.2197 8.96976C16.9268 9.26266 16.9268 9.73753 17.2197 10.0304L19.1893 12L17.2197 13.9696C16.9268 14.2625 16.9268 14.7373 17.2197 15.0302C17.5125 15.3231 17.9874 15.3231 18.2803 15.0303L20.25 13.0607L22.2197 15.0303C22.5126 15.3232 22.9874 15.3232 23.2803 15.0303C23.5732 14.7374 23.5732 14.2626 23.2803 13.9697L21.3107 12L23.2803 10.0303Z" fill="white"/></svg>',lt=function(e,t,n){return Math.min(Math.max(Math.round(e),t),n)};function at(e){var t;return{onEnter:function(n){clearTimeout(t),t=window.setTimeout(function(){n()},e)},onLeave:function(n){clearTimeout(t),t=window.setTimeout(function(){n()},e)}}}function ct(e){q(e,"svelte-crc1ty",".vertical-slider-wrap.svelte-crc1ty.svelte-crc1ty{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:8px 6px;opacity:0.9;border-radius:8px;-webkit-box-sizing:border-box;box-sizing:border-box}.vertical-slider-wrap.svelte-crc1ty .number.svelte-crc1ty{-ms-flex-negative:0;flex-shrink:0;margin-bottom:5px;width:20px;text-align:center;color:#fff}.vertical-slider-wrap.svelte-crc1ty .slider-rail.svelte-crc1ty{width:2px;-webkit-box-flex:1;-ms-flex:1;flex:1;position:relative;padding:0 4px;background:rgba(255, 255, 255, 0.2);background-clip:content-box;border-radius:2px;cursor:pointer}.vertical-slider-wrap.svelte-crc1ty .slider-handle.svelte-crc1ty{width:12px;height:12px;position:absolute;left:50%;z-index:1;-webkit-transform:translateX(-50%);transform:translateX(-50%);border-radius:50%;background-color:#fff}.vertical-slider-wrap.svelte-crc1ty .slider-handle.top-trans.svelte-crc1ty{-webkit-transition:top 0.2s ease-in-out;transition:top 0.2s ease-in-out}.vertical-slider-wrap.svelte-crc1ty .slider-track.svelte-crc1ty{position:absolute;bottom:0;width:4px;margin-left:-1px;background-color:#fff;border-radius:8px}.vertical-slider-wrap.svelte-crc1ty .slider-track.height-trans.svelte-crc1ty{-webkit-transition:height 0.2s ease-in-out;transition:height 0.2s ease-in-out}")}function ut(e){var t,n,i,r,o,l,a,c,u,s,d=Math.round(e[0])+"";return{c:function(){t=B("div"),n=B("div"),i=O(d),r=R(),o=B("div"),l=B("div"),a=R(),c=B("div"),Y(n,"class","number svelte-crc1ty"),U(l,"top",e[4]+"px"),Y(l,"class","slider-handle svelte-crc1ty"),W(l,"top-trans",!e[3]),U(c,"height",e[0]+"%"),Y(c,"class","slider-track svelte-crc1ty"),W(c,"height-trans",!e[3]),Y(o,"class","slider-rail svelte-crc1ty"),Y(t,"class","vertical-slider-wrap svelte-crc1ty")},m:function(f,d){E(f,t,d),S(t,n),S(n,i),S(t,r),S(t,o),S(o,l),e[9](l),S(o,a),S(o,c),e[10](o),u||(s=[I(l,"mousedown",e[7]),I(o,"mousedown",e[6]),I(t,"wheel",N(A(e[11])))],u=!0)},p:function(e,t){var n=f(t,1)[0];1&n&&d!==(d=Math.round(e[0])+"")&&D(i,d),16&n&&U(l,"top",e[4]+"px"),8&n&&W(l,"top-trans",!e[3]),1&n&&U(c,"height",e[0]+"%"),8&n&&W(c,"height-trans",!e[3])},i:C,o:C,d:function(n){n&&T(t),e[9](null),e[10](null),u=!1,x(s)}}}function st(e,t,n){var i,r,o,l,a=t.value,c=void 0===a?100:a,u=t.onChange,s=void 0===u?null:u,f=Number(null!==(r=getComputedStyle(document.documentElement).zoom)&&void 0!==r?r:1),d=!1,p=function(e){var t=lt(e,0,100);s?s(t):n(0,c=t)};return e.$$set=function(e){"value"in e&&n(0,c=e.value),"onChange"in e&&n(8,s=e.onChange)},e.$$.update=function(){3&e.$$.dirty&&n(4,i=(100-c)/100*((null==o?void 0:o.clientHeight)-12))},[c,o,l,d,i,p,function(e){e.target!==l&&p(100-(e.clientY/f-o.getBoundingClientRect().top)/o.clientHeight*100)},function(e){var t=e.clientY/f,i=c;n(3,d=!0);var r=function(e){var n=t-e.clientY/f;p(i+n/o.clientHeight*100)};document.addEventListener("mousemove",r),document.addEventListener("mouseup",function e(){n(3,d=!1),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e)})},s,function(e){se[e?"unshift":"push"](function(){n(2,l=e)})},function(e){se[e?"unshift":"push"](function(){n(1,o=e)})},function(e){var t=e.deltaY;p(c-Math.ceil(t/10))}]}var ft=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,st,ut,b,{value:0,onChange:8},ct),r}return i}();function dt(e){q(e,"svelte-qk4eah",".volume.svelte-qk4eah.svelte-qk4eah{position:relative}.volume.svelte-qk4eah .volume-control.svelte-qk4eah{height:110px}")}function pt(e){var t,n,i,r,o;return n=new ft({props:{value:e[0]?0:e[1],onChange:e[8]}}),{c:function(){t=B("div"),ze(n.$$.fragment),Y(t,"class","panel volume-control svelte-qk4eah")},m:function(l,a){E(l,t,a),Fe(n,t,null),i=!0,r||(o=I(t,"mousedown",e[9]),r=!0)},p:function(e,t){var i={};3&t&&(i.value=e[0]?0:e[1]),n.$set(i)},i:function(e){i||(Ve(n.$$.fragment,e),i=!0)},o:function(e){He(n.$$.fragment,e),i=!1},d:function(e){e&&T(t),_e(n),r=!1,o()}}}function vt(e){var t,n,i,r,o,l,a=(e[0]?ot:rt)+"",c=(e[2]||e[3])&&pt(e);return{c:function(){t=B("div"),c&&c.c(),n=R(),Y(i=B("span"),"class","icon"),Y(t,"class","volume svelte-qk4eah")},m:function(u,s){E(u,t,s),c&&c.m(t,null),S(t,n),S(t,i),i.innerHTML=a,r=!0,o||(l=[I(i,"click",e[10]),I(t,"mouseenter",e[11]),I(t,"mouseleave",e[12]),I(t,"wheel",N(A(e[13])))],o=!0)},p:function(e,o){var l=f(o,1)[0];e[2]||e[3]?c?(c.p(e,l),12&l&&Ve(c,1)):((c=pt(e)).c(),Ve(c,1),c.m(t,n)):c&&(Le(),He(c,1,1,function(){c=null}),Me()),(!r||1&l)&&a!==(a=(e[0]?ot:rt)+"")&&(i.innerHTML=a)},i:function(e){r||(Ve(c),r=!0)},o:function(e){He(c),r=!1},d:function(e){e&&T(t),c&&c.d(),o=!1,x(l)}}}function Ct(e,t,n){var i=t.onChange,r=void 0===i?null:i,o=t.disabled,l=void 0!==o&&o,a=t.value,c=void 0===a?100:a,u=!1,s=!1,f=function(e,t){if("disabled"===e)r?r({disabled:t,value:c}):n(0,l=t);else if("value"===e&&t!==c){var i=0===t;r?r({disabled:i,value:t}):(n(1,c=t),n(0,l=i))}},d=at(100),p=d.onEnter,v=d.onLeave;return e.$$set=function(e){"onChange"in e&&n(7,r=e.onChange),"disabled"in e&&n(0,l=e.disabled),"value"in e&&n(1,c=e.value)},[l,c,u,s,f,p,v,r,function(e){return f("value",e)},function(){n(3,s=!0),document.addEventListener("mouseup",function e(){n(3,s=!1),document.removeEventListener("mouseup",e)})},function(){return f("disabled",!l)},function(){return p(function(){n(2,u=!0)})},function(){return v(function(){n(2,u=!1)})},function(e){var t=e.deltaY;f("value",lt(c-Math.ceil(t/10),0,100))}]}var ht=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,Ct,vt,b,{onChange:7,disabled:0,value:1},dt),r}return i}(),gt='<svg viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M4.32564 1.57564C4.09132 1.80995 4.09132 2.18985 4.32564 2.42417L7.90137 5.9999L4.32564 9.57564C4.09132 9.80995 4.09132 10.1899 4.32564 10.4242C4.55995 10.6585 4.93985 10.6585 5.17417 10.4242L8.99739 6.60094C9.32934 6.269 9.32933 5.73081 8.99739 5.39886L5.17417 1.57564C4.93985 1.34132 4.55995 1.34132 4.32564 1.57564Z" fill="white"/></svg>';function mt(e){q(e,"svelte-1oym4sv",".quality-wrap.svelte-1oym4sv.svelte-1oym4sv{position:relative}.quality-wrap.svelte-1oym4sv .selected-qn.svelte-1oym4sv{font-size:14px}.quality-wrap.svelte-1oym4sv .panel.svelte-1oym4sv{padding:8px;min-height:94px;border-radius:8px}.quality-wrap.svelte-1oym4sv .line-wrap.svelte-1oym4sv{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;height:42px;line-height:1;margin:-8px -8px 6px;padding:0 20px;border-bottom:1px solid rgba(255, 255, 255, 0.1);cursor:pointer}.quality-wrap.svelte-1oym4sv .line-wrap .arrow-icon.svelte-1oym4sv{display:inline-block;width:12px;height:12px}.quality-wrap.svelte-1oym4sv .line-wrap .arrow-icon.left.svelte-1oym4sv{-webkit-transform:scaleX(-1);transform:scaleX(-1)}.quality-wrap.svelte-1oym4sv .list-it.svelte-1oym4sv{padding:0 12px;height:36px;line-height:36px;width:144px;cursor:pointer;white-space:nowrap;word-break:keep-all}.quality-wrap.svelte-1oym4sv .list-it.svelte-1oym4sv:hover{background-color:rgba(229, 233, 239, 0.1);border-radius:6px}.quality-wrap.svelte-1oym4sv .list-it.selected.svelte-1oym4sv{color:#ff6699}")}function xt(e,t,n){var i=e.slice();return i[26]=t[n],i}function wt(e,t,n){var i=e.slice();return i[23]=t[n],i}function bt(e){var t,n,i,r,o=null!=e[0]&&yt(e);function l(e,t){return e[7]?Mt:Lt}var a=l(e),c=a(e);return{c:function(){t=B("div"),o&&o.c(),n=R(),c.c(),Y(t,"class","panel svelte-1oym4sv")},m:function(l,a){E(l,t,a),o&&o.m(t,null),S(t,n),c.m(t,null),i||(r=I(t,"mousemove",e[20]),i=!0)},p:function(e,i){null!=e[0]?o?o.p(e,i):((o=yt(e)).c(),o.m(t,n)):o&&(o.d(1),o=null),a===(a=l(e))&&c?c.p(e,i):(c.d(1),(c=a(e))&&(c.c(),c.m(t,null)))},d:function(e){e&&T(t),o&&o.d(),c.d(),i=!1,r()}}}function yt(e){var t,n,i,r,o,l,a,c=e[7]&&$t(),u=!e[7]&&kt();return{c:function(){t=B("div"),c&&c.c(),n=R(),i=B("span"),r=O(e[10]),o=R(),u&&u.c(),Y(t,"class","line-wrap svelte-1oym4sv")},m:function(s,f){E(s,t,f),c&&c.m(t,null),S(t,n),S(t,i),S(i,r),S(t,o),u&&u.m(t,null),l||(a=I(t,"click",e[17]),l=!0)},p:function(e,i){e[7]?c?c.p(e,i):((c=$t()).c(),c.m(t,n)):c&&(c.d(1),c=null),1024&i&&D(r,e[10]),e[7]?u&&(u.d(1),u=null):u?u.p(e,i):((u=kt()).c(),u.m(t,null))},d:function(e){e&&T(t),c&&c.d(),u&&u.d(),l=!1,a()}}}function $t(e){var t;return{c:function(){Y(t=B("span"),"class","arrow-icon left svelte-1oym4sv")},m:function(e,n){E(e,t,n),t.innerHTML=gt},p:C,d:function(e){e&&T(t)}}}function kt(e){var t;return{c:function(){Y(t=B("span"),"class","arrow-icon right svelte-1oym4sv")},m:function(e,n){E(e,t,n),t.innerHTML=gt},p:C,d:function(e){e&&T(t)}}}function Lt(e){for(var t,n=e[3],i=[],r=0;r<n.length;r+=1)i[r]=Vt(xt(e,n,r));return{c:function(){for(var e=0;e<i.length;e+=1)i[e].c();t=j()},m:function(e,n){for(var r=0;r<i.length;r+=1)i[r]&&i[r].m(e,n);E(e,t,n)},p:function(e,r){if(2058&r){var o;for(n=e[3],o=0;o<n.length;o+=1){var l=xt(e,n,o);i[o]?i[o].p(l,r):(i[o]=Vt(l),i[o].c(),i[o].m(t.parentNode,t))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d:function(e){P(i,e),e&&T(t)}}}function Mt(e){for(var t,n=e[2],i=[],r=0;r<n.length;r+=1)i[r]=Ht(wt(e,n,r));return{c:function(){for(var e=0;e<i.length;e+=1)i[e].c();t=j()},m:function(e,n){for(var r=0;r<i.length;r+=1)i[r]&&i[r].m(e,n);E(e,t,n)},p:function(e,r){if(4101&r){var o;for(n=e[2],o=0;o<n.length;o+=1){var l=wt(e,n,o);i[o]?i[o].p(l,r):(i[o]=Ht(l),i[o].c(),i[o].m(t.parentNode,t))}for(;o<i.length;o+=1)i[o].d(1);i.length=n.length}},d:function(e){P(i,e),e&&T(t)}}}function Vt(e){var t,n,i,r,o,l=e[26].label+"";function a(){return e[19](e[26])}return{c:function(){t=B("div"),n=O(l),i=R(),Y(t,"class","list-it svelte-1oym4sv"),W(t,"selected",e[26].value==e[1])},m:function(e,l){E(e,t,l),S(t,n),S(t,i),r||(o=I(t,"click",a),r=!0)},p:function(i,r){e=i,8&r&&l!==(l=e[26].label+"")&&D(n,l),10&r&&W(t,"selected",e[26].value==e[1])},d:function(e){e&&T(t),r=!1,o()}}}function Ht(e){var t,n,i,r,o,l=e[23].label+"";function a(){return e[18](e[23])}return{c:function(){t=B("div"),n=O(l),i=R(),Y(t,"class","list-it svelte-1oym4sv"),W(t,"selected",e[23].value==e[0])},m:function(e,l){E(e,t,l),S(t,n),S(t,i),r||(o=I(t,"click",a),r=!0)},p:function(i,r){e=i,4&r&&l!==(l=e[23].label+"")&&D(n,l),5&r&&W(t,"selected",e[23].value==e[0])},d:function(e){e&&T(t),r=!1,o()}}}function Zt(e){var t,n,i,r,o,l,a=e[8]&&bt(e);return{c:function(){t=B("div"),a&&a.c(),n=R(),i=B("span"),r=O(e[9]),Y(i,"class","text selected-qn svelte-1oym4sv"),Y(t,"class","quality-wrap svelte-1oym4sv")},m:function(c,u){E(c,t,u),a&&a.m(t,null),S(t,n),S(t,i),S(i,r),o||(l=[I(t,"mouseenter",e[21]),I(t,"mouseleave",e[22])],o=!0)},p:function(e,i){var o=f(i,1)[0];e[8]?a?a.p(e,o):((a=bt(e)).c(),a.m(t,n)):a&&(a.d(1),a=null),512&o&&D(r,e[9])},i:C,o:C,d:function(e){e&&T(t),a&&a.d(),o=!1,x(l)}}}function St(e,t,n){var i,r,o,l,a=t.lineList,c=void 0===a?[]:a,u=t.qualityList,s=void 0===u?[]:u,f=t.line,d=void 0===f?"":f,p=t.quality,v=void 0===p?"":p,C=t.onChange,h=!1,g=!1,m=function(e){e!==v&&(C?C("quality",e):n(1,v=e))},x=function(e){e!==d&&(C?C("line",e):n(0,d=e))},w=at(100),b=w.onEnter,y=w.onLeave,$=0,k=!1;return e.$$set=function(e){"lineList"in e&&n(2,c=e.lineList),"qualityList"in e&&n(3,s=e.qualityList),"line"in e&&n(0,d=e.line),"quality"in e&&n(1,v=e.quality),"onChange"in e&&n(4,C=e.onChange)},e.$$.update=function(){32773&e.$$.dirty&&n(10,i=null===n(15,o=c.find(function(e){var t=e.value;return d===t}))||void 0===o?void 0:o.label),65546&e.$$.dirty&&n(9,r=null===n(16,l=s.find(function(e){var t=e.value;return v===t}))||void 0===l?void 0:l.label),96&e.$$.dirty&&(k||clearTimeout($))},[d,v,c,s,C,$,k,h,g,r,i,m,x,b,y,o,l,function(){n(7,h=!h),n(6,k=!0)},function(e){return x(e.value)},function(e){return m(e.value)},function(){n(6,k=!1)},function(){return b(function(){n(8,g=!0),C("qualityPanelShow",g)})},function(){return y(function(){k?(clearTimeout($),n(5,$=window.setTimeout(function(){n(8,g=!1),C("qualityPanelShow",g)},2e3))):(n(8,g=!1),C("qualityPanelShow",g))})}]}var qt=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,St,Zt,b,{lineList:2,qualityList:3,line:0,quality:1,onChange:4},mt),r}return i}();function zt(e){q(e,"svelte-1c429zu",".setting.svelte-1c429zu.svelte-1c429zu{position:relative}.setting-panel.svelte-1c429zu.svelte-1c429zu{width:63px;padding:12px 20px}.player-type.svelte-1c429zu .label.svelte-1c429zu{margin-bottom:4px}.player-type.svelte-1c429zu label.svelte-1c429zu{white-space:nowrap;word-break:keep-all}")}function Ft(e){var t,n,i,r,o,l,a,c,u,s,f,d;return f=e[7][0],c={p:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];(d=t).forEach(function(e){return f.push(e)})},r:function(){d.forEach(function(e){return f.splice(f.indexOf(e),1)})}},{c:function(){t=B("div"),n=B("div"),(i=B("div")).textContent="播放器",r=R(),o=B("input"),l=R(),(a=B("label")).textContent="HTML5",Y(i,"class","label svelte-1c429zu"),Y(o,"type","radio"),Y(o,"name","player-type"),Y(o,"id","html5"),o.__value="html5",o.value=o.__value,Y(a,"for","html5"),Y(a,"class","svelte-1c429zu"),Y(n,"class","player-type svelte-1c429zu"),Y(t,"class","panel setting-panel svelte-1c429zu"),c.p(o)},m:function(c,f){E(c,t,f),S(t,n),S(n,i),S(n,r),S(n,o),o.checked=o.__value===e[0],S(n,l),S(n,a),u||(s=[I(o,"click",e[5]),I(o,"change",e[6])],u=!0)},p:function(e,t){1&t&&(o.checked=o.__value===e[0])},d:function(e){e&&T(t),c.r(),u=!1,x(s)}}}function _t(e){var t,n,i,r,o,l=e[2]&&Ft(e);return{c:function(){t=B("div"),l&&l.c(),n=R(),Y(i=B("span"),"class","icon"),Y(t,"class","setting svelte-1c429zu")},m:function(a,c){E(a,t,c),l&&l.m(t,null),S(t,n),S(t,i),i.innerHTML='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg"    xmlns:xlink="http://www.w3.org/1999/xlink">    \x3c!-- Generator: Sketch 63.1 (92452) - https://sketch.com --\x3e            <g id="终稿" stroke="none" stroke-width="1" fill-rule="evenodd" opacity="0.9">        <g id="图标切图" transform="translate(-439.000000, -120.000000)">            <g id="编组-3" transform="translate(421.000000, 56.000000)">                <g id="编组-7" transform="translate(18.000000, 64.000000)">                    <g id="icon_设置" transform="translate(7.000000, 7.000000)">                        <g id="Group-2-Copy-6">                            <g id="player_setting">                                <path                                    d="M12.1355728,17.8458478 C11.7659721,17.9061404 11.3866469,17.9374882 11,17.9374882 C10.6133531,17.9374882 10.2340279,17.9061404 9.86442721,17.8458478 L8.82459672,19.1089545 C8.51390489,19.4863592 7.97590114,19.5838288 7.55255402,19.3394092 L5.55571956,18.1865363 C5.13237243,17.9421167 4.94778172,17.427457 5.11927787,16.9696876 L5.67630577,15.4828303 L5.67630577,15.4828303 C5.15507014,14.8729186 4.73681236,14.1723594 4.44845574,13.408076 L2.83560101,13.1392668 C2.35341304,13.0589022 2,12.6417121 2,12.1528729 L2,9.84712709 C2,9.35828794 2.35341304,8.94109783 2.83560101,8.86073316 L4.39976975,8.60003837 L4.39976975,8.60003837 C4.67272638,7.82931533 5.07685543,7.12062603 5.58532098,6.50080638 L5.01100429,4.9678006 C4.83950815,4.51003124 5.02409886,3.99537151 5.44744598,3.75095193 L7.44428044,2.59807902 C7.86762757,2.35365945 8.40563132,2.45112906 8.71632314,2.82853376 L9.72466395,4.05338917 L9.72466395,4.05338917 C10.1381953,3.9772668 10.5644523,3.93748822 11,3.93748822 C11.4355477,3.93748822 11.8618047,3.9772668 12.2753361,4.05338917 L13.2836769,2.82853376 C13.5943687,2.45112906 14.1323724,2.35365945 14.5557196,2.59807902 L16.552554,3.75095193 C16.9759011,3.99537151 17.1604919,4.51003124 16.9889957,4.9678006 L16.414679,6.50080638 L16.414679,6.50080638 C16.9231446,7.12062603 17.3272736,7.82931533 17.6002302,8.60003837 L19.164399,8.86073316 C19.646587,8.94109783 20,9.35828794 20,9.84712709 L20,12.1528729 C20,12.6417121 19.646587,13.0589022 19.164399,13.1392668 L17.5515443,13.408076 L17.5515443,13.408076 C17.2631876,14.1723594 16.8449299,14.8729186 16.3236942,15.4828303 L16.8807221,16.9696876 C17.0522183,17.427457 16.8676276,17.9421167 16.4442804,18.1865363 L14.447446,19.3394092 C14.0240989,19.5838288 13.4860951,19.4863592 13.1754033,19.1089545 L12.1355728,17.8458478 L12.1355728,17.8458478 Z M11,15 C13.209139,15 15,13.209139 15,11 C15,8.790861 13.209139,7 11,7 C8.790861,7 7,8.790861 7,11 C7,13.209139 8.790861,15 11,15 Z M11,13 C9.8954305,13 9,12.1045695 9,11 C9,9.8954305 9.8954305,9 11,9 C12.1045695,9 13,9.8954305 13,11 C13,12.1045695 12.1045695,13 11,13 Z"                                    id="Combined-Shape"></path>                            </g>                        </g>                    </g>                </g>            </g>        </g>    </g></svg>',r||(o=[I(t,"mouseenter",e[8]),I(t,"mouseleave",e[9])],r=!0)},p:function(e,i){var r=f(i,1)[0];e[2]?l?l.p(e,r):((l=Ft(e)).c(),l.m(t,n)):l&&(l.d(1),l=null)},i:C,o:C,d:function(e){e&&T(t),l&&l.d(),r=!1,x(o)}}}function Et(e,t,n){var i=t.playerType,r=void 0===i?"html5":i,o=t.onChange,l=!1,a=at(100),c=a.onEnter,u=a.onLeave;return e.$$set=function(e){"playerType"in e&&n(0,r=e.playerType),"onChange"in e&&n(1,o=e.onChange)},[r,o,l,c,u,function(){return"html5"!==r&&o("playerType","html5")},function(){r=this.__value,n(0,r)},[[]],function(){return c(function(){n(2,l=!0)})},function(){return u(function(){n(2,l=!1)})}]}var Tt=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,Et,_t,b,{playerType:0,onChange:1},zt),r}return i}();function Pt(e){q(e,"svelte-w4hee4",".horizontal-slider-wrap.svelte-w4hee4.svelte-w4hee4{-webkit-box-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.horizontal-slider-wrap.svelte-w4hee4 .number.svelte-w4hee4{width:31px;-ms-flex-negative:0;flex-shrink:0;margin-left:10px}.horizontal-slider-wrap.svelte-w4hee4 .slider-rail.svelte-w4hee4{height:2px;-webkit-box-flex:1;-ms-flex:1;flex:1;position:relative;padding:5px 0;background:rgba(255, 255, 255, 0.2);background-clip:content-box;border-radius:10px;cursor:pointer}.horizontal-slider-wrap.svelte-w4hee4 .slider-handle.svelte-w4hee4{width:12px;height:12px;position:absolute;top:0;z-index:1;border-radius:50%;background-color:#fff}.horizontal-slider-wrap.svelte-w4hee4 .slider-handle.left-trans.svelte-w4hee4{-webkit-transition:left 0.2s ease-in-out;transition:left 0.2s ease-in-out}.horizontal-slider-wrap.svelte-w4hee4 .slider-track.svelte-w4hee4{position:absolute;height:4px;margin-top:-1px;background-color:#fff;border-radius:8px}.horizontal-slider-wrap.svelte-w4hee4 .slider-track.width-trans.svelte-w4hee4{-webkit-transition:width 0.2s ease-in-out;transition:width 0.2s ease-in-out}")}function Bt(e){var t,n,i,r,o,l,a,c,u,s,d=e[3](e[0])+"";return{c:function(){t=B("div"),n=B("div"),i=B("div"),r=R(),o=B("div"),l=R(),a=B("div"),c=O(d),U(i,"left",e[7]+"px"),Y(i,"class","slider-handle svelte-w4hee4"),W(i,"left-trans",!e[6]),U(o,"width",(e[0]-e[2])/(e[1]-e[2])*100+"%"),Y(o,"class","slider-track svelte-w4hee4"),W(o,"width-trans",!e[6]),Y(n,"class","slider-rail svelte-w4hee4"),Y(a,"class","number svelte-w4hee4"),Y(t,"class","horizontal-slider-wrap svelte-w4hee4")},m:function(f,d){E(f,t,d),S(t,n),S(n,i),e[13](i),S(n,r),S(n,o),e[14](n),S(t,l),S(t,a),S(a,c),u||(s=[I(i,"mousedown",e[10]),I(n,"mousedown",e[9]),I(t,"wheel",N(A(e[15])))],u=!0)},p:function(e,t){var n=f(t,1)[0];128&n&&U(i,"left",e[7]+"px"),64&n&&W(i,"left-trans",!e[6]),7&n&&U(o,"width",(e[0]-e[2])/(e[1]-e[2])*100+"%"),64&n&&W(o,"width-trans",!e[6]),9&n&&d!==(d=e[3](e[0])+"")&&D(c,d)},i:C,o:C,d:function(n){n&&T(t),e[13](null),e[14](null),u=!1,x(s)}}}function Ot(e,t,n){var i,r,o,l,a,c=Number(null!==(o=getComputedStyle(document.documentElement).zoom)&&void 0!==o?o:1),u=t.max,s=void 0===u?100:u,f=t.min,d=void 0===f?0:f,p=t.value,v=void 0===p?s:p,C=t.onChange,h=void 0===C?null:C,g=t.valueFormater,m=void 0===g?function(e){return e}:g,x=!1,w=function(e){var t=lt(e,d,s);h?h(t):n(0,v=t)};return e.$$set=function(e){"max"in e&&n(1,s=e.max),"min"in e&&n(2,d=e.min),"value"in e&&n(0,v=e.value),"onChange"in e&&n(11,h=e.onChange),"valueFormater"in e&&n(3,m=e.valueFormater)},e.$$.update=function(){16&e.$$.dirty&&n(12,i=(null==l?void 0:l.clientWidth)-12),4103&e.$$.dirty&&n(7,r=(v-d)/(s-d)*i)},[v,s,d,m,l,a,x,r,w,function(e){e.target!==a&&w((e.clientX/c-l.getBoundingClientRect().left)/i*(s-d)+d-(s-d)/i*6)},function(e){var t=e.clientX/c,r=v;n(6,x=!0);var o=function(e){var n=e.clientX/c-t;w(r+n*((s-d)/i))};document.addEventListener("mousemove",o),document.addEventListener("mouseup",function e(){n(6,x=!1),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",e)})},h,i,function(e){se[e?"unshift":"push"](function(){n(5,a=e)})},function(e){se[e?"unshift":"push"](function(){n(4,l=e)})},function(e){var t=e.deltaY;w(v+Math.ceil(t/10))}]}var Rt=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,Ot,Bt,b,{max:1,min:2,value:0,onChange:11,valueFormater:3},Pt),r}return i}();function jt(e){q(e,"svelte-p9soo8",".danmaku-control.panel.svelte-p9soo8.svelte-p9soo8{width:298px;padding:16px 12px;-webkit-box-sizing:border-box;box-sizing:border-box;left:auto;right:12px;-webkit-transform:translate(0, calc(-100% - 2px));transform:translate(0, calc(-100% - 2px))}.base-setting.svelte-p9soo8 .item.svelte-p9soo8{display:-webkit-box;display:-ms-flexbox;display:flex;height:16px;margin-bottom:16px}.base-setting.svelte-p9soo8 .item.svelte-p9soo8:last-of-type{margin-bottom:11px}.item-title.svelte-p9soo8.svelte-p9soo8{margin-right:20px}.area-setting.svelte-p9soo8.svelte-p9soo8{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.area-setting.svelte-p9soo8 .area-icon-wrap.svelte-p9soo8{-webkit-box-flex:1;-ms-flex:1;flex:1;margin-right:41px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between}.area-setting.svelte-p9soo8 .area-icon-wrap .area-icon.svelte-p9soo8{width:30px;height:30px;cursor:pointer}.area-setting.svelte-p9soo8 .area-icon-wrap .area-icon.selected.svelte-p9soo8 svg *{fill:#ff6699}.other-setting.svelte-p9soo8.svelte-p9soo8{margin-top:14px}.other-setting.svelte-p9soo8 label.svelte-p9soo8{margin-right:20px}")}function It(e){var t,n,i,r,o,l,a,c,u,s,f,d,p,v,C,h,g,m,w,b,y,$,k,L,M,V,H,Z,q,z,F,_;l=new Rt({props:{value:e[0].opacity,onChange:e[7],min:10,max:100,valueFormater:e[3]}}),f=new Rt({props:{value:e[0].fontScale,onChange:e[8],min:10,max:200,valueFormater:e[3]}}),h=new Rt({props:{value:e[0].density,onChange:e[9],min:10,max:100,valueFormater:e[3]}});var P=e[0].showMaskOption&&At(e);return{c:function(){t=B("div"),n=B("div"),i=B("div"),(r=B("div")).textContent="不透明度",o=R(),ze(l.$$.fragment),a=R(),c=B("div"),(u=B("div")).textContent="字号缩放",s=R(),ze(f.$$.fragment),d=R(),p=B("div"),(v=B("div")).textContent="同屏密度",C=R(),ze(h.$$.fragment),g=R(),m=B("div"),(w=B("div")).textContent="显示区域",b=R(),y=B("div"),$=B("span"),k=R(),L=B("span"),M=R(),V=B("span"),H=R(),Z=B("span"),q=R(),P&&P.c(),Y(r,"class","item-title svelte-p9soo8"),Y(i,"class","item svelte-p9soo8"),Y(u,"class","item-title svelte-p9soo8"),Y(c,"class","item svelte-p9soo8"),Y(v,"class","item-title svelte-p9soo8"),Y(p,"class","item svelte-p9soo8"),Y(n,"class","base-setting svelte-p9soo8"),Y(w,"class","item-title svelte-p9soo8"),Y($,"class","area-icon svelte-p9soo8"),W($,"selected",1===e[0].area),Y(L,"class","area-icon svelte-p9soo8"),W(L,"selected",2===e[0].area),Y(V,"class","area-icon svelte-p9soo8"),W(V,"selected",3===e[0].area),Y(Z,"class","area-icon svelte-p9soo8"),W(Z,"selected",4===e[0].area),Y(y,"class","area-icon-wrap svelte-p9soo8"),Y(m,"class","area-setting svelte-p9soo8"),Y(t,"class","panel danmaku-control svelte-p9soo8")},m:function(x,T){E(x,t,T),S(t,n),S(n,i),S(i,r),S(i,o),Fe(l,i,null),S(n,a),S(n,c),S(c,u),S(c,s),Fe(f,c,null),S(n,d),S(n,p),S(p,v),S(p,C),Fe(h,p,null),S(t,g),S(t,m),S(m,w),S(m,b),S(m,y),S(y,$),$.innerHTML='<svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">  <path fill-rule="evenodd" clip-rule="evenodd"    d="M15 6.5625C11.7392 6.5625 8.8918 6.7137 6.87988 6.86246C5.34947 6.97562 4.15041 8.13128 4.00866 9.6408C3.87148 11.1016 3.75 12.9692 3.75 15C3.75 17.0308 3.87148 18.8984 4.00866 20.3592C4.15041 21.8687 5.34947 23.0244 6.87988 23.1375C8.8918 23.2863 11.7392 23.4375 15 23.4375C18.2612 23.4375 21.1088 23.2863 23.1208 23.1375C24.6509 23.0243 25.8497 21.8691 25.9915 20.3599C26.1286 18.8996 26.25 17.0322 26.25 15C26.25 12.9678 26.1286 11.1004 25.9915 9.64011C25.8497 8.13095 24.6509 6.97566 23.1208 6.86251C21.1088 6.71373 18.2612 6.5625 15 6.5625ZM6.77618 5.46004C8.81428 5.30934 11.6971 5.15625 15 5.15625C18.3032 5.15625 21.1863 5.30938 23.2245 5.46009C25.4204 5.62248 27.1839 7.29789 27.3915 9.50864C27.5317 11.0013 27.6562 12.9138 27.6562 15C27.6562 17.0862 27.5317 18.9987 27.3915 20.4914C27.1839 22.7021 25.4204 24.3775 23.2245 24.5399C21.1863 24.6906 18.3032 24.8438 15 24.8438C11.6971 24.8438 8.81428 24.6907 6.77619 24.54C4.57988 24.3776 2.81619 22.7017 2.60857 20.4907C2.46835 18.9975 2.34375 17.0848 2.34375 15C2.34375 12.9152 2.46835 11.0025 2.60857 9.50933C2.81619 7.29834 4.57988 5.62244 6.77618 5.46004Z"    fill="white" />  <rect x="3" y="8" width="7" height="2" rx="1" fill="white" />  <rect x="11" y="8" width="13" height="2" rx="1" fill="white" />  <circle cx="26" cy="9" r="1" fill="white" />  <g opacity="0.2">    <circle cx="4" cy="13" r="1" fill="white" />    <rect x="6" y="12" width="21" height="2" rx="1" fill="white" />  </g>  <g opacity="0.2">    <rect x="3" y="16" width="7" height="2" rx="1" fill="white" />    <rect x="11" y="16" width="13" height="2" rx="1" fill="white" />    <circle cx="26" cy="17" r="1" fill="white" />  </g>  <g opacity="0.2">    <circle cx="4" cy="21" r="1" fill="white" />    <rect x="6" y="20" width="21" height="2" rx="1" fill="white" />  </g></svg>',S(y,k),S(y,L),L.innerHTML='<svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15 6.5625C11.7392 6.5625 8.8918 6.7137 6.87988 6.86246C5.34947 6.97562 4.15041 8.13128 4.00866 9.6408C3.87148 11.1016 3.75 12.9692 3.75 15C3.75 17.0308 3.87148 18.8984 4.00866 20.3592C4.15041 21.8687 5.34947 23.0244 6.87988 23.1375C8.8918 23.2863 11.7392 23.4375 15 23.4375C18.2612 23.4375 21.1088 23.2863 23.1208 23.1375C24.6509 23.0243 25.8497 21.8691 25.9915 20.3599C26.1286 18.8996 26.25 17.0322 26.25 15C26.25 12.9678 26.1286 11.1004 25.9915 9.64011C25.8497 8.13095 24.6509 6.97566 23.1208 6.86251C21.1088 6.71373 18.2612 6.5625 15 6.5625ZM6.77618 5.46004C8.81428 5.30934 11.6971 5.15625 15 5.15625C18.3032 5.15625 21.1863 5.30938 23.2245 5.46009C25.4204 5.62248 27.1839 7.29789 27.3915 9.50864C27.5317 11.0013 27.6562 12.9138 27.6562 15C27.6562 17.0862 27.5317 18.9987 27.3915 20.4914C27.1839 22.7021 25.4204 24.3775 23.2245 24.5399C21.1863 24.6906 18.3032 24.8438 15 24.8438C11.6971 24.8438 8.81428 24.6907 6.77619 24.54C4.57988 24.3776 2.81619 22.7017 2.60857 20.4907C2.46835 18.9975 2.34375 17.0848 2.34375 15C2.34375 12.9152 2.46835 11.0025 2.60857 9.50933C2.81619 7.29834 4.57988 5.62244 6.77618 5.46004Z" fill="white"/><rect x="3" y="8" width="7" height="2" rx="1" fill="white"/><rect x="11" y="8" width="13" height="2" rx="1" fill="white"/><circle cx="26" cy="9" r="1" fill="white"/><circle cx="4" cy="13" r="1" fill="white"/><rect x="6" y="12" width="21" height="2" rx="1" fill="white"/><g opacity="0.2"><rect x="3" y="16" width="7" height="2" rx="1" fill="white"/><rect x="11" y="16" width="13" height="2" rx="1" fill="white"/><circle cx="26" cy="17" r="1" fill="white"/></g><g opacity="0.2"><circle cx="4" cy="21" r="1" fill="white"/><rect x="6" y="20" width="21" height="2" rx="1" fill="white"/></g></svg>',S(y,M),S(y,V),V.innerHTML='<svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15 6.5625C11.7392 6.5625 8.8918 6.7137 6.87988 6.86246C5.34947 6.97562 4.15041 8.13128 4.00866 9.6408C3.87148 11.1016 3.75 12.9692 3.75 15C3.75 17.0308 3.87148 18.8984 4.00866 20.3592C4.15041 21.8687 5.34947 23.0244 6.87988 23.1375C8.8918 23.2863 11.7392 23.4375 15 23.4375C18.2612 23.4375 21.1088 23.2863 23.1208 23.1375C24.6509 23.0243 25.8497 21.8691 25.9915 20.3599C26.1286 18.8996 26.25 17.0322 26.25 15C26.25 12.9678 26.1286 11.1004 25.9915 9.64011C25.8497 8.13095 24.6509 6.97566 23.1208 6.86251C21.1088 6.71373 18.2612 6.5625 15 6.5625ZM6.77618 5.46004C8.81428 5.30934 11.6971 5.15625 15 5.15625C18.3032 5.15625 21.1863 5.30938 23.2245 5.46009C25.4204 5.62248 27.1839 7.29789 27.3915 9.50864C27.5317 11.0013 27.6562 12.9138 27.6562 15C27.6562 17.0862 27.5317 18.9987 27.3915 20.4914C27.1839 22.7021 25.4204 24.3775 23.2245 24.5399C21.1863 24.6906 18.3032 24.8438 15 24.8438C11.6971 24.8438 8.81428 24.6907 6.77619 24.54C4.57988 24.3776 2.81619 22.7017 2.60857 20.4907C2.46835 18.9975 2.34375 17.0848 2.34375 15C2.34375 12.9152 2.46835 11.0025 2.60857 9.50933C2.81619 7.29834 4.57988 5.62244 6.77618 5.46004Z" fill="white"/><rect x="3" y="8" width="7" height="2" rx="1" fill="white"/><rect x="11" y="8" width="13" height="2" rx="1" fill="white"/><circle cx="26" cy="9" r="1" fill="white"/><circle cx="4" cy="13" r="1" fill="white"/><rect x="6" y="12" width="21" height="2" rx="1" fill="white"/><rect x="3" y="16" width="7" height="2" rx="1" fill="white"/><rect x="11" y="16" width="13" height="2" rx="1" fill="white"/><circle cx="26" cy="17" r="1" fill="white"/><g opacity="0.2"><circle cx="4" cy="21" r="1" fill="white"/><rect x="6" y="20" width="21" height="2" rx="1" fill="white"/></g></svg>',S(y,H),S(y,Z),Z.innerHTML='<svg viewBox="0 0 30 30" fill="none" xmlns="http://www.w3.org/2000/svg">  <path fill-rule="evenodd" clip-rule="evenodd"    d="M15 6.5625C11.7392 6.5625 8.8918 6.7137 6.87988 6.86246C5.34947 6.97562 4.15041 8.13128 4.00866 9.6408C3.87148 11.1016 3.75 12.9692 3.75 15C3.75 17.0308 3.87148 18.8984 4.00866 20.3592C4.15041 21.8687 5.34947 23.0244 6.87988 23.1375C8.8918 23.2863 11.7392 23.4375 15 23.4375C18.2612 23.4375 21.1088 23.2863 23.1208 23.1375C24.6509 23.0243 25.8497 21.8691 25.9915 20.3599C26.1286 18.8996 26.25 17.0322 26.25 15C26.25 12.9678 26.1286 11.1004 25.9915 9.64011C25.8497 8.13095 24.6509 6.97566 23.1208 6.86251C21.1088 6.71373 18.2612 6.5625 15 6.5625ZM6.77618 5.46004C8.81428 5.30934 11.6971 5.15625 15 5.15625C18.3032 5.15625 21.1863 5.30938 23.2245 5.46009C25.4204 5.62248 27.1839 7.29789 27.3915 9.50864C27.5317 11.0013 27.6562 12.9138 27.6562 15C27.6562 17.0862 27.5317 18.9987 27.3915 20.4914C27.1839 22.7021 25.4204 24.3775 23.2245 24.5399C21.1863 24.6906 18.3032 24.8438 15 24.8438C11.6971 24.8438 8.81428 24.6907 6.77619 24.54C4.57988 24.3776 2.81619 22.7017 2.60857 20.4907C2.46835 18.9975 2.34375 17.0848 2.34375 15C2.34375 12.9152 2.46835 11.0025 2.60857 9.50933C2.81619 7.29834 4.57988 5.62244 6.77618 5.46004Z"    fill="white" />  <path    d="M10.284 12.062C9.537 13.124 8.16 14.339 6.684 15.158C6.54 14.906 6.234 14.51 6 14.285C7.548 13.502 9.006 12.116 9.672 11H10.797C11.76 12.386 13.227 13.565 14.658 14.177C14.388 14.456 14.145 14.816 13.947 15.149C12.561 14.384 11.049 13.133 10.284 12.062ZM7.224 16.283H13.38V17.219H7.224V16.283ZM7.683 14.294H12.966V15.239H7.683V14.294ZM6.504 18.308H14.19V19.271H6.504V18.308ZM9.717 14.717H10.86V18.848H9.717V14.717Z"    fill="white" />  <path    d="M15.981 11.423H17.07V14.096C17.07 15.68 16.926 18.029 15.981 19.514C15.765 19.343 15.279 19.064 15.009 18.956C15.909 17.57 15.981 15.536 15.981 14.096V11.423ZM16.647 11.423H22.911V13.844H16.647V12.926H21.822V12.332H16.647V11.423ZM16.998 16.598H23.406V17.507H16.998V16.598ZM17.241 14.762H23.163V15.653H17.241V14.762ZM20.733 15.05H21.777V19.487H20.733V15.05ZM18.42 15.068H19.446V16.508C19.446 17.633 19.221 18.803 17.628 19.523C17.493 19.289 17.142 18.902 16.917 18.722C18.249 18.146 18.42 17.3 18.42 16.49V15.068ZM17.952 13.997L18.888 13.727C19.104 13.997 19.32 14.384 19.401 14.663L18.411 14.951C18.357 14.69 18.15 14.285 17.952 13.997ZM21.291 13.673L22.38 13.952C22.128 14.321 21.876 14.672 21.687 14.906L20.751 14.654C20.94 14.375 21.174 13.97 21.291 13.673Z"    fill="white" /></svg>',S(t,q),P&&P.m(t,null),z=!0,F||(_=[I($,"click",e[10]),I(L,"click",e[11]),I(V,"click",e[12]),I(Z,"click",e[13])],F=!0)},p:function(e,n){var i={};1&n&&(i.value=e[0].opacity),2&n&&(i.onChange=e[7]),l.$set(i);var r={};1&n&&(r.value=e[0].fontScale),2&n&&(r.onChange=e[8]),f.$set(r);var o={};1&n&&(o.value=e[0].density),2&n&&(o.onChange=e[9]),h.$set(o),(!z||1&n)&&W($,"selected",1===e[0].area),(!z||1&n)&&W(L,"selected",2===e[0].area),(!z||1&n)&&W(V,"selected",3===e[0].area),(!z||1&n)&&W(Z,"selected",4===e[0].area),e[0].showMaskOption?P?P.p(e,n):((P=At(e)).c(),P.m(t,null)):P&&(P.d(1),P=null)},i:function(e){z||(Ve(l.$$.fragment,e),Ve(f.$$.fragment,e),Ve(h.$$.fragment,e),z=!0)},o:function(e){He(l.$$.fragment,e),He(f.$$.fragment,e),He(h.$$.fragment,e),z=!1},d:function(e){e&&T(t),_e(l),_e(f),_e(h),P&&P.d(),F=!1,x(_)}}}function At(e){var t,n,i,r,o,l,a;return{c:function(){t=B("div"),n=B("input"),r=R(),(o=B("label")).textContent="智能防挡弹幕",Y(n,"type","checkbox"),Y(n,"id","mask"),n.checked=i=e[0].enableMask,Y(o,"for","mask"),Y(o,"class","svelte-p9soo8"),Y(t,"class","other-setting svelte-p9soo8")},m:function(i,c){E(i,t,c),S(t,n),S(t,r),S(t,o),l||(a=I(n,"click",e[14]),l=!0)},p:function(e,t){1&t&&i!==(i=e[0].enableMask)&&(n.checked=i)},d:function(e){e&&T(t),l=!1,a()}}}function Nt(e){var t,n,i,r,o,l,a=e[2]&&It(e);return{c:function(){t=B("div"),a&&a.c(),n=R(),Y(i=B("span"),"class","icon"),Y(t,"class","danmaku")},m:function(c,u){E(c,t,u),a&&a.m(t,null),S(t,n),S(t,i),i.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M15.4325 5.17716L16.7042 3.40774C17.0259 2.96005 16.9239 2.33629 16.4762 2.01453C16.0285 1.69277 15.4047 1.79485 15.083 2.24254L13.1954 4.86879C13.1356 4.952 13.0905 5.04128 13.0594 5.13358C12.6865 5.12972 12.332 5.12774 11.9958 5.12764C11.995 5.12764 11.9942 5.12764 11.9934 5.12764C11.9894 5.12764 11.9854 5.12764 11.9814 5.12764C11.9774 5.12764 11.9734 5.12764 11.9694 5.12764C11.9685 5.12764 11.9677 5.12764 11.9668 5.12764C11.552 5.12777 11.1092 5.13075 10.6385 5.1366C10.6119 5.06435 10.5765 4.99404 10.5319 4.92715L8.78274 2.3009C8.47713 1.84204 7.8574 1.71781 7.39854 2.02343C6.93968 2.32904 6.81545 2.94877 7.12107 3.40763L8.30351 5.18297C7.54701 5.20276 6.73863 5.22785 5.87833 5.25825C4.10004 5.32108 2.65644 6.72012 2.40415 8.48154C2.24383 9.60074 2.1644 10.9664 2.1644 12.5817C2.1644 14.5164 2.27839 16.1879 2.50791 17.5985C2.78633 19.3095 4.232 20.6798 5.96344 20.7655C7.44086 20.8386 8.98021 20.8333 10.624 20.8277H10.6241H10.6243C11.0726 20.8262 11.5287 20.8246 11.9934 20.8246C12.3693 20.8246 12.6741 20.5199 12.6741 20.144C12.6741 19.7681 12.3693 19.4634 11.9934 19.4634C11.5258 19.4634 11.067 19.465 10.6163 19.4666H10.6163C8.99792 19.4724 7.48334 19.4778 6.03071 19.4059C4.94055 19.352 4.02679 18.4572 3.85149 17.3798C3.63477 16.048 3.52565 14.4478 3.52565 12.5817C3.52565 11.0264 3.60146 9.72304 3.75164 8.67455C3.91049 7.5655 4.80673 6.65821 5.9264 6.61865C8.3693 6.53234 10.388 6.48911 11.9814 6.48889C13.5748 6.48911 15.5935 6.53234 18.0364 6.61865C19.1561 6.65821 20.0866 7.49417 20.2454 8.60322C20.3956 9.65171 20.4243 10.1486 20.4243 11.7039C20.4243 12.0798 20.729 12.3845 21.1049 12.3845C21.4808 12.3845 21.7855 12.0798 21.7855 11.7039C21.7855 10.0887 21.7532 9.5294 21.5929 8.41021C21.3406 6.64879 19.8628 5.32108 18.0845 5.25825C17.1376 5.2248 16.2536 5.19776 15.4325 5.17716ZM11.2249 9.58372H12.5317C12.2812 9.07189 12.009 8.6254 11.7149 8.23336L12.7495 7.88488C13.0544 8.32048 13.3266 8.77786 13.5553 9.2788L12.8693 9.58372H14.3721C14.677 9.02833 14.9384 8.42938 15.1779 7.79776L16.2561 8.17891C16.0383 8.70163 15.7878 9.1699 15.5155 9.58372H16.7788V12.3398H15.2257C15.0759 12.3398 14.9299 12.3656 14.7931 12.4139H14.558V12.5244C14.3574 12.6445 14.1892 12.8185 14.076 13.0329L13.4247 14.2669V14.2266H11.2249V9.58372ZM12.9919 15.0866H10.8328V16.1539H12.4286L12.9919 15.0866ZM8.48609 11.6619L8.33363 13.2236H10.5116C10.5116 15.0967 10.4463 16.349 10.3374 16.9807C10.2067 17.6123 9.65132 17.9608 8.66033 18.0261C8.39621 18.0261 8.13209 18.0071 7.8503 17.9869L7.85016 17.9869H7.85014H7.85012H7.8501L7.78913 17.9825L7.4951 16.9262C7.77824 16.9589 8.08316 16.9807 8.38808 16.9807C8.93258 16.9807 9.2375 16.8064 9.31373 16.4579C9.38996 16.1095 9.43352 15.358 9.43352 14.2037H7.17929L7.48421 10.6927H9.32462V9.25807H7.2773V8.28886H10.4463V11.6619H8.48609ZM13.4234 13.2724V12.423H12.2364V13.2724H13.4234ZM13.4234 11.4679H12.2364V10.5749H13.4234V11.4679ZM14.558 10.5822V11.4752H15.7994V10.5822H14.558ZM16.1731 13.6052C15.725 13.6062 15.3112 13.8451 15.0862 14.2326L13.344 17.2332C13.1174 17.6234 13.1168 18.1051 13.3425 18.4959L15.064 21.4776C15.2896 21.8683 15.7068 22.1086 16.158 22.1076L20.1607 22.0988C20.6087 22.0978 21.0226 21.8589 21.2475 21.4715L22.9898 18.4708C23.2163 18.0806 23.2169 17.599 22.9913 17.2082L21.2698 14.2264C21.0442 13.8357 20.6269 13.5954 20.1758 13.5964L16.1731 13.6052ZM15.8586 15.4939C16.0855 15.114 16.4951 14.8809 16.9376 14.8799L19.4625 14.8743C19.9082 14.8733 20.3212 15.1078 20.5487 15.4909L21.5822 17.2313C21.8181 17.6285 21.8177 18.1229 21.5813 18.5197L20.5253 20.2916C20.2986 20.6721 19.8887 20.9056 19.4458 20.9066L16.9223 20.9122C16.4763 20.9132 16.063 20.6783 15.8356 20.2946L14.8013 18.5495C14.5658 18.1521 14.5666 17.6577 14.8034 17.2611L15.8586 15.4939ZM18.1625 19.3295C18.9357 19.3295 19.5625 18.7027 19.5625 17.9295C19.5625 17.1563 18.9357 16.5295 18.1625 16.5295C17.3893 16.5295 16.7625 17.1563 16.7625 17.9295C16.7625 18.7027 17.3893 19.3295 18.1625 19.3295Z" fill="white"/></svg>',r=!0,o||(l=[I(t,"mouseenter",e[15]),I(t,"mouseleave",e[16])],o=!0)},p:function(e,i){var r=f(i,1)[0];e[2]?a?(a.p(e,r),4&r&&Ve(a,1)):((a=It(e)).c(),Ve(a,1),a.m(t,n)):a&&(Le(),He(a,1,1,function(){a=null}),Me())},i:function(e){r||(Ve(a),r=!0)},o:function(e){He(a),r=!1},d:function(e){e&&T(t),a&&a.d(),o=!1,x(l)}}}function Yt(e,t,n){var i=t.options,r=t.onChange,o=!1,l=function(e){r("enableMask",e.target.checked)},a=at(100),c=a.onEnter,u=a.onLeave;return e.$$set=function(e){"options"in e&&n(0,i=e.options),"onChange"in e&&n(1,r=e.onChange)},[i,r,o,function(e){return"".concat(e,"%")},l,c,u,function(e){return r("opacity",e)},function(e){return r("fontScale",e)},function(e){return r("density",e)},function(){return r("area",1)},function(){return r("area",2)},function(){return r("area",3)},function(){return r("area",4)},function(e){return l(e)},function(){return c(function(){n(2,o=!0)})},function(){return u(function(){n(2,o=!1)})}]}var Xt=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,Yt,Nt,b,{options:0,onChange:1},jt),r}return i}();function Dt(e){q(e,"svelte-1g87leh",".send-panel-wrap.svelte-1g87leh{position:absolute;height:32px;width:400px;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.send-panel-container.svelte-1g87leh{display:-webkit-box;display:-ms-flexbox;display:flex;width:400px;height:32px;background:rgba(255, 255, 255, 0.4);border-radius:15.5px}.send-panel-input.svelte-1g87leh{outline:none;border-radius:15.5px;background:0 0;border:0;width:100%;padding-left:26px;color:#FFFFFF;font-family:PingFang SC;font-style:normal;font-weight:normal;font-size:14px;line-height:20px}.send-panel-input.svelte-1g87leh::-webkit-input-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh::-moz-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh:-ms-input-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh::-ms-input-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh::placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-btn.svelte-1g87leh{width:60px;height:24px;background:#23ade5;border-radius:19px;color:#FFFFFF;margin-top:4px;text-align:center;line-height:26px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;top:0;right:5px}")}function Gt(e){var t,n,i,r,o,l,a;return{c:function(){t=B("div"),n=B("div"),i=B("input"),r=R(),(o=B("div")).textContent="发送",Y(i,"placeholder","发个弹幕呗~"),Y(i,"class","send-panel-input svelte-1g87leh"),Y(i,"maxlength","20"),Y(n,"class","send-panel-container svelte-1g87leh"),Y(o,"class","send-panel-btn svelte-1g87leh"),Y(t,"class","send-panel-wrap svelte-1g87leh")},m:function(c,u){E(c,t,u),S(t,n),S(n,i),G(i,e[0]),S(t,r),S(t,o),l||(a=[I(i,"input",e[3]),I(i,"blur",e[4]),I(i,"focus",e[5]),I(o,"click",e[6])],l=!0)},p:function(e,t){1&f(t,1)[0]&&i.value!==e[0]&&G(i,e[0])},i:C,o:C,d:function(e){e&&T(t),l=!1,x(a)}}}function Ut(e,t,n){var i=t.dmMsg,r=t.onSend,o=t.foucsChange,l=function(e){13===e.keyCode&&r(i)};return ae(function(){window.addEventListener("keydown",l)}),ce(function(){window.removeEventListener("keydown",l)}),e.$$set=function(e){"dmMsg"in e&&n(0,i=e.dmMsg),"onSend"in e&&n(1,r=e.onSend),"foucsChange"in e&&n(2,o=e.foucsChange)},[i,r,o,function(){i=this.value,n(0,i)},function(){o(!1)},function(){o(!0)},function(){r(i)}]}var Wt=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,Ut,Gt,b,{dmMsg:0,onSend:1,foucsChange:2},Dt),r}return i}();function Jt(e){q(e,"svelte-1ildxxc",".quality-container.svelte-1ildxxc.svelte-1ildxxc{position:absolute;right:-160px;z-index:15;width:160px;top:0px;height:100%;-webkit-transition:right 0.5s;transition:right 0.5s;background-color:rgba(0, 0, 0, 0.8);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.quality-container-show.svelte-1ildxxc.svelte-1ildxxc{right:0px}.quality-scroll.svelte-1ildxxc .svelte-1ildxxc::-webkit-scrollbar{display:none}.quality-scroll.svelte-1ildxxc.svelte-1ildxxc{position:absolute;width:100%;height:85%;overflow-y:scroll;padding-left:24px}.quality-select.svelte-1ildxxc.svelte-1ildxxc{color:#FFFFFF;font-size:14px;margin-bottom:20px}.quality-select.selected.svelte-1ildxxc.svelte-1ildxxc{color:#23ade5}")}function Kt(e,t,n){var i=e.slice();return i[12]=t[n],i}function Qt(e){var t,n,i,r,o,l=e[12].label+"";function a(){return e[8](e[12])}return{c:function(){t=B("div"),n=O(l),i=R(),Y(t,"class","quality-select svelte-1ildxxc"),W(t,"selected",e[12].value==e[0])},m:function(e,l){E(e,t,l),S(t,n),S(t,i),r||(o=I(t,"click",a),r=!0)},p:function(i,r){e=i,4&r&&l!==(l=e[12].label+"")&&D(n,l),5&r&&W(t,"selected",e[12].value==e[0])},d:function(e){e&&T(t),r=!1,o()}}}function en(e){for(var t,n,i,r,o,l,a,c,u,s=e[2],d=[],p=0;p<s.length;p+=1)d[p]=Qt(Kt(e,s,p));return{c:function(){t=B("div"),n=B("div"),i=B("div");for(var c=0;c<d.length;c+=1)d[c].c();o=R(),l=B("span"),a=O(e[5]),Y(i,"class","quality-scroll svelte-1ildxxc"),Y(n,"class",r=$(e[4]?"quality-container quality-container-show":"quality-container")+" svelte-1ildxxc"),Y(l,"class","text")},m:function(r,s){E(r,t,s),S(t,n),S(n,i);for(var f=0;f<d.length;f+=1)d[f]&&d[f].m(i,null);e[9](n),S(t,o),S(t,l),S(l,a),c||(u=I(l,"click",e[10]),c=!0)},p:function(e,t){var o=f(t,1)[0];if(29&o){var l;for(s=e[2],l=0;l<s.length;l+=1){var c=Kt(e,s,l);d[l]?d[l].p(c,o):(d[l]=Qt(c),d[l].c(),d[l].m(i,null))}for(;l<d.length;l+=1)d[l].d(1);d.length=s.length}16&o&&r!==(r=$(e[4]?"quality-container quality-container-show":"quality-container")+" svelte-1ildxxc")&&Y(n,"class",r),32&o&&D(a,e[5])},i:C,o:C,d:function(n){n&&T(t),P(d,n),e[9](null),c=!1,u()}}}function tn(e,t,n){var i,r,o=t.container,l=t.qualityList,a=void 0===l?[]:l,c=t.quality,u=void 0===c?"":c,s=t.onChange,f=!1,d=t.ref,p=function(e){null!=d&&(d.contains(e.target)||n(4,f=!1))};return ae(function(){null!=o&&(o.append(d),o.addEventListener("touchstart",p))}),ce(function(){null!=o&&(o.removeChild(d),o.removeEventListener("touchstart",p))}),e.$$set=function(e){"container"in e&&n(6,o=e.container),"qualityList"in e&&n(2,a=e.qualityList),"quality"in e&&n(0,u=e.quality),"onChange"in e&&n(3,s=e.onChange),"ref"in e&&n(1,d=e.ref)},e.$$.update=function(){133&e.$$.dirty&&n(5,i=null===n(7,r=a.find(function(e){var t=e.value;return u===t}))||void 0===r?void 0:r.label)},[u,d,a,s,f,i,o,r,function(e){var t=e.value;console.error(t,u),t!==u&&(s?s("quality",t):n(0,u=t),n(4,f=!1),s("qualityPanelShow",f))},function(e){se[e?"unshift":"push"](function(){n(1,d=e)})},function(){n(4,f=!0),s("qualityPanelShow",f)}]}var nn=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,tn,en,b,{container:6,qualityList:2,quality:0,onChange:3,ref:1},Jt),r}return i}(),rn='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="icon_&#229;&#173;&#151;&#229;&#185;&#149;"><path id="Vector" d="M12 4.99805C9.48178 4.99805 7.283 5.12616 5.73089 5.25202C4.65221 5.33949 3.81611 6.16352 3.72 7.23254C3.60607 8.4998 3.5 10.171 3.5 11.998C3.5 13.8251 3.60607 15.4963 3.72 16.7635C3.81611 17.8325 4.65221 18.6566 5.73089 18.7441C7.283 18.8699 9.48178 18.998 12 18.998C14.5185 18.998 16.7174 18.8699 18.2696 18.744C19.3481 18.6565 20.184 17.8328 20.2801 16.764C20.394 15.4973 20.5 13.8264 20.5 11.998C20.5 10.1696 20.394 8.49877 20.2801 7.23205C20.184 6.1633 19.3481 5.33952 18.2696 5.25205C16.7174 5.12618 14.5185 4.99805 12 4.99805ZM5.60965 3.75693C7.19232 3.62859 9.43258 3.49805 12 3.49805C14.5677 3.49805 16.8081 3.62861 18.3908 3.75696C20.1881 3.90272 21.6118 5.29278 21.7741 7.09773C21.8909 8.3969 22 10.114 22 11.998C22 13.882 21.8909 15.5992 21.7741 16.8984C21.6118 18.7033 20.1881 20.0933 18.3908 20.2391C16.8081 20.3675 14.5677 20.498 12 20.498C9.43258 20.498 7.19232 20.3675 5.60965 20.2392C3.81206 20.0934 2.38831 18.7029 2.22603 16.8979C2.10918 15.5982 2 13.8808 2 11.998C2 10.1153 2.10918 8.39787 2.22603 7.09823C2.38831 5.29312 3.81206 3.90269 5.60965 3.75693Z" fill="white"/><path id="Vector_2" d="M6.0377 9.57774V10.1738C6.0377 10.4568 5.80825 10.6863 5.5252 10.6863C5.24216 10.6863 5.0127 10.4568 5.0127 10.1738V9.31524C5.0127 8.89412 5.35409 8.55274 5.7752 8.55274H10.8164C11.2376 8.55274 11.5789 8.89412 11.5789 9.31524V10.1738C11.5789 10.4568 11.3495 10.6863 11.0664 10.6863C10.7834 10.6863 10.5539 10.4568 10.5539 10.1738V9.57774H6.0377Z" fill="white"/><path id="Vector_3" d="M8.00415 7.87592C8.26546 7.76714 8.56548 7.89079 8.67425 8.15211L8.9724 8.86834C9.08118 9.12964 8.95753 9.42966 8.69622 9.53844C8.43491 9.64721 8.13489 9.52356 8.02612 9.26225L7.72797 8.54602C7.61919 8.2847 7.74284 7.9847 8.00415 7.87592Z" fill="white"/><path id="Vector_4" d="M5.19336 12.957C5.19336 12.6739 5.42281 12.4445 5.70586 12.4445H10.8861C11.1691 12.4445 11.3986 12.6739 11.3986 12.957C11.3986 13.24 11.1691 13.4695 10.8861 13.4695H5.70586C5.42281 13.4695 5.19336 13.24 5.19336 12.957Z" fill="white"/><path id="Vector_5" d="M6.48828 10.6646C6.48828 10.3816 6.71774 10.1521 7.00078 10.1521H9.632C9.82863 10.1521 10.0079 10.2646 10.0935 10.4416C10.179 10.6187 10.1557 10.8291 10.0335 10.9831L9.06966 12.2008V15.232C9.06966 15.515 8.8402 15.7445 8.55716 15.7445H7.48338C7.20033 15.7445 6.97088 15.515 6.97088 15.232C6.97088 14.949 7.20033 14.7195 7.48338 14.7195H8.04466V12.0221C8.04466 11.9065 8.08379 11.7942 8.15569 11.7036L8.5711 11.1771H7.00078C6.71774 11.1771 6.48828 10.9476 6.48828 10.6646Z" fill="white"/><path id="Vector_6" d="M12.0996 8.66282C12.0996 8.40739 12.3067 8.20032 12.5621 8.20032H18.4736C18.729 8.20032 18.9361 8.40739 18.9361 8.66282C18.9361 8.91825 18.729 9.12532 18.4736 9.12532H12.5621C12.3067 9.12532 12.0996 8.91825 12.0996 8.66282Z" fill="white"/><path id="Vector_7" d="M12.7485 10.1299C12.7485 9.71567 13.0843 9.37988 13.4985 9.37988H17.5391C17.9533 9.37988 18.2891 9.71567 18.2891 10.1299V11.6581C18.2891 12.0723 17.9533 12.4081 17.5391 12.4081H13.4985C13.0843 12.4081 12.7485 12.0723 12.7485 11.6581V10.1299ZM13.7485 10.3799V11.4081H17.2891V10.3799H13.7485Z" fill="white"/><path id="Vector_8" d="M12.8984 10.8938C12.8984 10.7005 13.0551 10.5438 13.2484 10.5438H16.5038C16.6971 10.5438 16.8538 10.7005 16.8538 10.8938C16.8538 11.0871 16.6971 11.2438 16.5038 11.2438H13.2484C13.0551 11.2438 12.8984 11.0871 12.8984 10.8938Z" fill="white"/><path id="Vector_9" d="M12.0996 13.0986C12.0996 12.8432 12.3067 12.6361 12.5621 12.6361H18.4735C18.729 12.6361 18.936 12.8432 18.936 13.0986C18.936 13.3541 18.729 13.5611 18.4735 13.5611H12.5621C12.3067 13.5611 12.0996 13.3541 12.0996 13.0986Z" fill="white"/><path id="Vector_10" d="M15.4284 11.6158C15.5979 11.8069 15.5805 12.0992 15.3895 12.2688L12.8691 14.5058C12.6781 14.6754 12.3858 14.658 12.2162 14.467C12.0466 14.2759 12.064 13.9836 12.2551 13.814L14.7754 11.577C14.9665 11.4074 15.2588 11.4248 15.4284 11.6158Z" fill="white"/><path id="Vector_11" d="M14.062 14.8273V15.3317C14.062 15.6078 13.8382 15.8317 13.562 15.8317C13.2859 15.8317 13.062 15.6078 13.062 15.3317V14.5273C13.062 14.1408 13.3755 13.8273 13.762 13.8273H17.3354C17.7219 13.8273 18.0354 14.1408 18.0354 14.5273V15.3651C18.0354 15.6412 17.8115 15.8651 17.5354 15.8651C17.2592 15.8651 17.0354 15.6412 17.0354 15.3651V14.8273H14.062Z" fill="white"/><path id="Vector_12" d="M15.5489 12.7247C15.8044 12.7247 16.0114 12.9318 16.0114 13.1872V15.482C16.0114 15.7375 15.8044 15.9445 15.5489 15.9445C15.2935 15.9445 15.0864 15.7375 15.0864 15.482V13.1872C15.0864 12.9318 15.2935 12.7247 15.5489 12.7247Z" fill="white"/><path id="Vector_13" d="M14.1959 7.75501C14.4513 7.75501 14.6584 7.96208 14.6584 8.2175V9.45639C14.6584 9.71182 14.4513 9.91889 14.1959 9.91889C13.9405 9.91889 13.7334 9.71182 13.7334 9.45639V8.2175C13.7334 7.96208 13.9405 7.75501 14.1959 7.75501ZM16.8394 7.75501C17.0948 7.75501 17.3019 7.96208 17.3019 8.2175V9.45639C17.3019 9.71182 17.0948 9.91889 16.8394 9.91889C16.5839 9.91889 16.3769 9.71182 16.3769 9.45639V8.2175C16.3769 7.96208 16.5839 7.75501 16.8394 7.75501Z" fill="white"/><path id="Vector_14" d="M16.5967 12.8776C16.7399 12.6662 17.0273 12.6109 17.2388 12.754L18.7327 13.7767C18.9442 13.9199 18.9995 14.2074 18.8563 14.4188C18.7131 14.6303 18.4257 14.6856 18.2142 14.5424L16.7202 13.5198C16.5088 13.3766 16.4535 13.0891 16.5967 12.8776Z" fill="white"/></g></svg>',on='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 4.99805C9.48178 4.99805 7.283 5.12616 5.73089 5.25202C4.65221 5.33949 3.81611 6.16352 3.72 7.23254C3.60607 8.4998 3.5 10.171 3.5 11.998C3.5 13.8383 3.60762 15.5204 3.72246 16.7909C3.81814 17.8485 4.63906 18.6614 5.70252 18.7467C7.17555 18.865 9.29769 18.9847 11.9427 18.9967C12.3569 18.9998 12.6902 19.3381 12.6872 19.7522C12.6841 20.1664 12.3458 20.4997 11.9317 20.4967C9.24539 20.4843 7.08632 20.3627 5.58204 20.2419C3.79557 20.0983 2.39027 18.7156 2.22854 16.9257C2.11076 15.6228 2 13.8943 2 11.998C2 10.1153 2.10918 8.39787 2.22603 7.09823C2.38831 5.29312 3.81206 3.90269 5.60965 3.75693C7.19232 3.62859 9.43258 3.49805 12 3.49805C14.5677 3.49805 16.8081 3.62861 18.3908 3.75696C20.1881 3.90272 21.6117 5.2926 21.7741 7.09759C21.8585 8.03701 21.967 10.7115 22 11.998C22.014 12.4119 21.6899 12.7589 21.2759 12.7729C20.862 12.787 20.5151 12.4628 20.501 12.0489C20.4689 10.7949 20.3626 8.14871 20.2801 7.23191C20.184 6.1632 19.3481 5.33953 18.2696 5.25205C16.7174 5.12618 14.5185 4.99805 12 4.99805Z" fill="white"/><path d="M6.03769 9.57774V10.1738C6.03769 10.4568 5.80824 10.6863 5.5252 10.6863C5.24215 10.6863 5.0127 10.4568 5.0127 10.1738V9.31524C5.0127 8.89412 5.35407 8.55274 5.7752 8.55274H10.8164C11.2375 8.55274 11.5789 8.89412 11.5789 9.31524V10.1738C11.5789 10.4568 11.3495 10.6863 11.0664 10.6863C10.7834 10.6863 10.5539 10.4568 10.5539 10.1738V9.57774H6.03769Z" fill="white"/><path d="M8.00416 7.87592C8.26547 7.76714 8.56548 7.89079 8.67426 8.15211L8.97241 8.86834C9.08118 9.12964 8.95753 9.42966 8.69623 9.53844C8.43492 9.64721 8.1349 9.52356 8.02612 9.26225L7.72797 8.54602C7.61919 8.2847 7.74285 7.9847 8.00416 7.87592Z" fill="white"/><path d="M5.19336 12.9568C5.19336 12.6738 5.42282 12.4443 5.70586 12.4443H10.886C11.1691 12.4443 11.3985 12.6738 11.3985 12.9568C11.3985 13.2399 11.1691 13.4693 10.886 13.4693H5.70586C5.42282 13.4693 5.19336 13.2399 5.19336 12.9568Z" fill="white"/><path d="M6.48828 10.6646C6.48828 10.3815 6.71773 10.1521 7.00078 10.1521H9.63199C9.82863 10.1521 10.008 10.2646 10.0934 10.4417C10.179 10.6187 10.1557 10.8291 10.0335 10.9831L9.06966 12.2007V15.232C9.06966 15.5151 8.8402 15.7445 8.55715 15.7445H7.48338C7.20033 15.7445 6.97088 15.5151 6.97088 15.232C6.97088 14.9489 7.20033 14.7195 7.48338 14.7195H8.04466V12.0221C8.04466 11.9065 8.08379 11.7942 8.15568 11.7036L8.57109 11.1771H7.00078C6.71773 11.1771 6.48828 10.9476 6.48828 10.6646Z" fill="white"/><path d="M12.0996 8.66307C12.0996 8.40763 12.3067 8.20057 12.5621 8.20057H18.4736C18.729 8.20057 18.9361 8.40763 18.9361 8.66307C18.9361 8.91849 18.729 9.12557 18.4736 9.12557H12.5621C12.3067 9.12557 12.0996 8.91849 12.0996 8.66307Z" fill="white"/><path d="M12.7485 10.13C12.7485 9.71579 13.0843 9.38001 13.4985 9.38001H17.5391C17.9533 9.38001 18.2891 9.71579 18.2891 10.13V10.8063C18.2891 11.0825 18.0652 11.3063 17.7891 11.3063C17.513 11.3063 17.2891 11.0825 17.2891 10.8063V10.38H13.7485V11.4081H15.2939C15.5701 11.4081 15.7939 11.632 15.7939 11.9081C15.7939 12.1843 15.5701 12.4081 15.2939 12.4081H13.4985C13.0843 12.4081 12.7485 12.0724 12.7485 11.6581V10.13Z" fill="white"/><path d="M12.8984 10.8939C12.8984 10.7006 13.0551 10.5439 13.2484 10.5439H16.5038C16.6971 10.5439 16.8538 10.7006 16.8538 10.8939C16.8538 11.0872 16.6971 11.2439 16.5038 11.2439H13.2484C13.0551 11.2439 12.8984 11.0872 12.8984 10.8939Z" fill="white"/><path d="M12.0996 13.0986C12.0996 12.8432 12.3067 12.6361 12.5621 12.6361H13.9455C14.201 12.6361 14.408 12.8432 14.408 13.0986C14.408 13.3541 14.201 13.5611 13.9455 13.5611H12.5621C12.3067 13.5611 12.0996 13.3541 12.0996 13.0986Z" fill="white"/><path d="M15.4284 11.6161C15.598 11.8071 15.5806 12.0995 15.3895 12.269L12.8692 14.5061C12.6781 14.6756 12.3858 14.6582 12.2162 14.4672C12.0467 14.2762 12.0641 13.9838 12.2551 13.8143L14.7755 11.5772C14.9665 11.4077 15.2588 11.4251 15.4284 11.6161Z" fill="white"/><path d="M14.1959 7.75501C14.4513 7.75501 14.6584 7.96208 14.6584 8.2175V9.45639C14.6584 9.71182 14.4513 9.91889 14.1959 9.91889C13.9405 9.91889 13.7334 9.71182 13.7334 9.45639V8.2175C13.7334 7.96208 13.9405 7.75501 14.1959 7.75501ZM16.8394 7.75501C17.0948 7.75501 17.3019 7.96208 17.3019 8.2175V9.45639C17.3019 9.71182 17.0948 9.91889 16.8394 9.91889C16.5839 9.91889 16.3769 9.71182 16.3769 9.45639V8.2175C16.3769 7.96208 16.5839 7.75501 16.8394 7.75501Z" fill="white"/><path fill-rule="evenodd" clip-rule="evenodd" d="M18.0625 22.06C20.2716 22.06 22.0625 20.2691 22.0625 18.06C22.0625 15.8509 20.2716 14.06 18.0625 14.06C15.8534 14.06 14.0625 15.8509 14.0625 18.06C14.0625 20.2691 15.8534 22.06 18.0625 22.06ZM18.0625 20.7968C16.551 20.7968 15.3257 19.5715 15.3257 18.06C15.3257 17.5436 15.4687 17.0606 15.7173 16.6484L19.4745 20.4049C19.0623 20.6537 18.5791 20.7968 18.0625 20.7968ZM20.4075 19.4719C20.6562 19.0597 20.7993 18.5766 20.7993 18.06C20.7993 16.5485 19.574 15.3232 18.0625 15.3232C17.5457 15.3232 17.0624 15.4664 16.6501 15.7153L20.4075 19.4719Z" fill="white"/></svg>';function ln(e){q(e,"svelte-11eqb4i",".live-web-player-controller .control-area .left-area > *,.live-web-player-controller .control-area .right-area > *{margin:0 2px;border-radius:6px}.live-web-player-controller .control-area .left-area > *:hover,.live-web-player-controller .control-area .right-area > *:hover{background-color:rgba(255, 255, 255, 0.1)}.live-web-player-controller .control-area .left-area > *:first-child{margin-left:0px}.live-web-player-controller .control-area .left-area > *:last-child{margin-right:0px}.live-web-player-controller .control-area .right-area > *:first-child{margin-right:0px}.live-web-player-controller .control-area .right-area > *:last-child{margin-left:0px}@-webkit-keyframes svelte-11eqb4i-hhh{50%{width:28px;height:28px}100%{width:24px;height:24px}}@keyframes svelte-11eqb4i-hhh{50%{width:28px;height:28px}100%{width:24px;height:24px}}.switch.svelte-11eqb4i.svelte-11eqb4i{display:inline-block;width:32px;height:20px;border-radius:48px;background:rgba(255, 255, 255, 0.2);padding:3px;-webkit-box-sizing:border-box;box-sizing:border-box;cursor:pointer}.switch.svelte-11eqb4i .btn.svelte-11eqb4i{width:14px;height:14px;border-radius:50%;background-color:#fff;margin-left:0px;-webkit-transition:margin-left 0.1s;transition:margin-left 0.1s}.switch.on.svelte-11eqb4i.svelte-11eqb4i{background:#ff6699}.switch.on.svelte-11eqb4i .btn.svelte-11eqb4i{margin-left:12px}")}function an(e){var t,n,i;return{c:function(){(t=B("div")).innerHTML='<div class="btn svelte-11eqb4i"></div>',Y(t,"class","switch svelte-11eqb4i"),W(t,"on",e[0])},m:function(r,o){E(r,t,o),n||(i=I(t,"click",e[2]),n=!0)},p:function(e,n){1&f(n,1)[0]&&W(t,"on",e[0])},i:C,o:C,d:function(e){e&&T(t),n=!1,i()}}}function cn(e,t,n){var i,r=t.value,o=(i=le(),function(e,t){var n=(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).cancelable,r=void 0!==n&&n,o=i.$$.callbacks[e];if(o){var l=J(e,t,{cancelable:r});return o.slice().forEach(function(e){e.call(i,l)}),!l.defaultPrevented}return!0});return e.$$set=function(e){"value"in e&&n(0,r=e.value)},[r,o,function(){o("click")}]}var un=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,cn,an,b,{value:0},ln),r}return i}();function sn(e){q(e,"svelte-1aua55n",".subtitle.svelte-1aua55n.svelte-1aua55n{position:relative;line-height:17px}.panel.svelte-1aua55n.svelte-1aua55n{width:265px;padding:16px 12px}.panel.svelte-1aua55n .item.svelte-1aua55n{margin-bottom:15px;display:-webkit-box;display:-ms-flexbox;display:flex}.panel.svelte-1aua55n .item.svelte-1aua55n:last-of-type{margin-bottom:0}.panel.svelte-1aua55n .desc.svelte-1aua55n{margin-left:5px;margin-right:auto;color:#9499a0}")}function fn(e){var t,n,i,r,o,l,a,c,u,s,f,d,p,v,C;return(a=new un({props:{value:e[0]}})).$on("click",e[10]),(v=new un({props:{value:e[1]}})).$on("click",e[11]),{c:function(){t=B("div"),n=B("div"),(i=B("span")).textContent="显示字幕",r=R(),(o=B("span")).textContent="自动生成实时字幕",l=R(),ze(a.$$.fragment),c=R(),u=B("div"),(s=B("span")).textContent="移动字幕",f=R(),(d=B("span")).textContent="开启后可进行字幕移动",p=R(),ze(v.$$.fragment),Y(i,"class","title"),Y(o,"class","desc svelte-1aua55n"),Y(n,"class","item svelte-1aua55n"),Y(s,"class","title"),Y(d,"class","desc svelte-1aua55n"),Y(u,"class","item svelte-1aua55n"),Y(t,"class","panel svelte-1aua55n")},m:function(h,g){E(h,t,g),S(t,n),S(n,i),S(n,r),S(n,o),S(n,l),Fe(a,n,null),S(t,c),S(t,u),S(u,s),S(u,f),S(u,d),S(u,p),Fe(v,u,null),e[12](t),C=!0},p:function(e,t){var n={};1&t&&(n.value=e[0]),a.$set(n);var i={};2&t&&(i.value=e[1]),v.$set(i)},i:function(e){C||(Ve(a.$$.fragment,e),Ve(v.$$.fragment,e),C=!0)},o:function(e){He(a.$$.fragment,e),He(v.$$.fragment,e),C=!1},d:function(n){n&&T(t),_e(a),_e(v),e[12](null)}}}function dn(e){var t,n,i,r,o,l,a=(e[0]?rn:on)+"",c=e[2]&&fn(e);return{c:function(){t=B("div"),c&&c.c(),n=R(),Y(i=B("span"),"class","icon"),Y(t,"class","subtitle svelte-1aua55n")},m:function(u,s){E(u,t,s),c&&c.m(t,null),S(t,n),S(t,i),i.innerHTML=a,e[13](t),r=!0,o||(l=[I(t,"mouseenter",e[14]),I(t,"mouseleave",e[15])],o=!0)},p:function(e,o){var l=f(o,1)[0];e[2]?c?(c.p(e,l),4&l&&Ve(c,1)):((c=fn(e)).c(),Ve(c,1),c.m(t,n)):c&&(Le(),He(c,1,1,function(){c=null}),Me()),(!r||1&l)&&a!==(a=(e[0]?rn:on)+"")&&(i.innerHTML=a)},i:function(e){r||(Ve(c),r=!0)},o:function(e){He(c),r=!1},d:function(n){n&&T(t),c&&c.d(),e[13](null),o=!1,x(l)}}}function pn(e,t,n){var i,o,l,a=t.onChange,c=void 0===a?null:a,u=t.visible,s=void 0!==u&&u,f=t.draggable,d=void 0!==f&&f,p=!1,v=function(e,t){c?c(r({},e,t)):"visible"===e?n(0,s=t):"draggable"===e&&n(1,d=t)},C=at(100),h=C.onEnter,g=C.onLeave;return e.$$set=function(e){"onChange"in e&&n(8,c=e.onChange),"visible"in e&&n(0,s=e.visible),"draggable"in e&&n(1,d=e.draggable)},e.$$.update=function(){if(540&e.$$.dirty&&p&&null!=l&&null!=(null==o?void 0:o.parentElement)){var t=(null===n(9,i=o.parentElement)||void 0===i?void 0:i.getBoundingClientRect().right)-l.getBoundingClientRect().right;t<0&&n(4,l.style.left="calc(50% + ".concat(t,"px)"),l)}},[s,d,p,o,l,v,h,g,c,i,function(){return v("visible",!s)},function(){return v("draggable",!d)},function(e){se[e?"unshift":"push"](function(){n(4,l=e),n(2,p),n(3,o),n(9,i)})},function(e){se[e?"unshift":"push"](function(){n(3,o=e)})},function(){return h(function(){n(2,p=!0),v("showPanel",!0)})},function(){return g(function(){n(2,p=!1),v("showPanel",!1)})}]}var vn=function(e){o(i,Pe);var n=s(i);function i(e){var r;return t(this,i),Te(c(r=n.call(this)),e,pn,dn,b,{onChange:8,visible:0,draggable:1},sn),r}return i}();function Cn(e){q(e,"svelte-rlh2z5",".live-web-player-controller.svelte-rlh2z5.svelte-rlh2z5{position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.live-web-player-controller.svelte-rlh2z5 .control-area.svelte-rlh2z5{position:absolute;bottom:3px;left:0;right:0;padding:0 12px;color:#fff;height:36px;font-size:12px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.live-web-player-controller.svelte-rlh2z5 .control-area .left-area.svelte-rlh2z5,.live-web-player-controller.svelte-rlh2z5 .control-area .right-area.svelte-rlh2z5{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.live-web-player-controller .control-area .left-area > *,.live-web-player-controller .control-area .right-area > *{margin:0 2px;border-radius:6px}.live-web-player-controller .control-area .left-area > *:hover,.live-web-player-controller .control-area .right-area > *:hover{background-color:rgba(255, 255, 255, 0.1)}.live-web-player-controller .control-area .left-area > *:first-child{margin-left:0px}.live-web-player-controller .control-area .left-area > *:last-child{margin-right:0px}.live-web-player-controller .control-area .right-area > *:first-child{margin-right:0px}.live-web-player-controller .control-area .right-area > *:last-child{margin-left:0px}.live-web-player-controller.svelte-rlh2z5 .control-area .right-area.svelte-rlh2z5{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.live-web-player-controller.svelte-rlh2z5 .control-area .ext-nodes.svelte-rlh2z5{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.live-web-player-controller.svelte-rlh2z5 .panel{position:absolute;left:50%;-webkit-transform:translate(-50%, calc(-100% - 2px));transform:translate(-50%, calc(-100% - 2px));opacity:0.9;background-color:rgba(33, 33, 33, 0.9);color:rgba(255, 255, 255, 0.9);border-radius:6px;z-index:100}.live-web-player-controller.svelte-rlh2z5 .icon{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-ms-flex-pack:center;justify-content:center;width:30px;height:30px;cursor:pointer}.live-web-player-controller.svelte-rlh2z5 .icon svg{width:24px;height:24px}@-webkit-keyframes svelte-rlh2z5-hhh{50%{width:28px;height:28px}100%{width:24px;height:24px}}@keyframes svelte-rlh2z5-hhh{50%{width:28px;height:28px}100%{width:24px;height:24px}}.live-web-player-controller.svelte-rlh2z5 .icon:hover svg{-webkit-animation:0.2s svelte-rlh2z5-hhh;animation:0.2s svelte-rlh2z5-hhh}.live-web-player-controller.svelte-rlh2z5 .text{line-height:30px;padding:0 10px;color:rgba(255, 255, 255, 0.9);cursor:pointer}.live-web-player-controller.svelte-rlh2z5 .text:hover{color:#fff}.live-web-player-controller.svelte-rlh2z5 .time{font-size:14px}.live-web-player-controller.svelte-rlh2z5 input[type='radio']{width:16px;height:16px;visibility:hidden;position:absolute;margin:0}.live-web-player-controller.svelte-rlh2z5 input[type='radio']+label{position:relative;margin:0 20px;line-height:16px;cursor:pointer}.live-web-player-controller.svelte-rlh2z5 input[type='radio']+label::before{display:inline-block;position:absolute;left:-20px;width:16px;height:16px;border-radius:50%;vertical-align:text-bottom;-webkit-box-sizing:border-box;box-sizing:border-box;background:rgba(227, 232, 236, 0.1);border:1px solid #757575;content:''}.live-web-player-controller.svelte-rlh2z5 input[type='radio']:checked+label::before{border:1px solid #ff6699;background-color:#ff6699}.live-web-player-controller.svelte-rlh2z5 input[type='radio']:checked+label::after{content:'';position:absolute;width:16px;height:16px;border:4px solid #212121;-webkit-box-sizing:border-box;box-sizing:border-box;left:-20px;-webkit-transform:scale(0.8);transform:scale(0.8);border-radius:50%}.live-web-player-controller.svelte-rlh2z5 input[type='checkbox']{width:12px;height:12px;visibility:hidden;position:absolute;margin:0}.live-web-player-controller.svelte-rlh2z5 input[type='checkbox']+label{position:relative;margin-left:18px;cursor:pointer}.live-web-player-controller.svelte-rlh2z5 input[type='checkbox']+label::before{content:'';position:absolute;top:50%;left:-18px;-webkit-transform:translateY(-50%);transform:translateY(-50%);height:12px;width:12px;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:rgba(0, 0, 0, 0);border:1px solid rgba(255, 255, 255, 0.9);border-radius:2px}.live-web-player-controller.svelte-rlh2z5 input[type='checkbox']:checked+label::before{background-color:#ff6699;border:none}.live-web-player-controller.svelte-rlh2z5 input[type='checkbox']:checked+label::after{content:'';position:absolute;left:-17px;top:calc(50% - 2px);width:2px;height:6px;border:solid #2b2b2b;border-width:0 2px 2px 0;-webkit-transform:rotate(45deg) translateY(-50%);transform:rotate(45deg) translateY(-50%);border-radius:2px}")}function hn(e){var t,n,i,r,o,l,a,c,u,s,f,d,p,v,C,h,g,m,x,w,b,y,$=e[16].playStatus&&gn(e),k=e[16].refresh&&mn(e),L=e[16].volume&&xn(e),M=e[16].time&&wn(e),V=e[16].leftSetting&&$n(e),H=e[16].dmSend&&kn(e),Z=e[16].fullScreen&&Ln(e),q=e[16].webFullScreen&&Vn(e),z=e[16].danmaku&&Zn(e),F=e[16].subtitle&&zn(e),_=e[16].rightSetting&&Fn(e),P=e[16].pip&&document.pictureInPictureEnabled&&_n(e),O=e[16].mirror&&Pn(e),j=e[16].quality&&null!=e[9].value&&!e[14]&&On(e),I=e[16].quality&&null!=e[9].value&&e[14]&&Rn(e);return{c:function(){t=B("div"),n=B("div"),i=B("div"),$&&$.c(),r=R(),k&&k.c(),o=R(),L&&L.c(),l=R(),M&&M.c(),a=R(),V&&V.c(),c=R(),H&&H.c(),u=R(),s=B("div"),Z&&Z.c(),f=R(),q&&q.c(),d=R(),z&&z.c(),p=R(),F&&F.c(),v=R(),_&&_.c(),C=R(),P&&P.c(),h=R(),O&&O.c(),g=R(),j&&j.c(),m=R(),I&&I.c(),x=R(),w=B("div"),Y(i,"class","left-area svelte-rlh2z5"),Y(w,"class","ext-nodes svelte-rlh2z5"),Y(s,"class","right-area svelte-rlh2z5"),Y(n,"class","control-area svelte-rlh2z5"),Y(t,"class","live-web-player-controller svelte-rlh2z5"),Y(t,"style",e[15])},m:function(b,T){E(b,t,T),S(t,n),S(n,i),$&&$.m(i,null),S(i,r),k&&k.m(i,null),S(i,o),L&&L.m(i,null),S(i,l),M&&M.m(i,null),S(i,a),V&&V.m(i,null),S(n,c),H&&H.m(n,null),S(n,u),S(n,s),Z&&Z.m(s,null),S(s,f),q&&q.m(s,null),S(s,d),z&&z.m(s,null),S(s,p),F&&F.m(s,null),S(s,v),_&&_.m(s,null),S(s,C),P&&P.m(s,null),S(s,h),O&&O.m(s,null),S(s,g),j&&j.m(s,null),S(s,m),I&&I.m(s,null),S(s,x),S(s,w),e[41](w),y=!0},p:function(e,c){e[16].playStatus?$?$.p(e,c):(($=gn(e)).c(),$.m(i,r)):$&&($.d(1),$=null),e[16].refresh?k?k.p(e,c):((k=mn(e)).c(),k.m(i,o)):k&&(k.d(1),k=null),e[16].volume?L?(L.p(e,c),65536&c[0]&&Ve(L,1)):((L=xn(e)).c(),Ve(L,1),L.m(i,l)):L&&(Le(),He(L,1,1,function(){L=null}),Me()),e[16].time?M?(M.p(e,c),65536&c[0]&&Ve(M,1)):((M=wn(e)).c(),Ve(M,1),M.m(i,a)):M&&(Le(),He(M,1,1,function(){M=null}),Me()),e[16].leftSetting?V?(V.p(e,c),65536&c[0]&&Ve(V,1)):((V=$n(e)).c(),Ve(V,1),V.m(i,null)):V&&(Le(),He(V,1,1,function(){V=null}),Me()),e[16].dmSend?H?(H.p(e,c),65536&c[0]&&Ve(H,1)):((H=kn(e)).c(),Ve(H,1),H.m(n,u)):H&&(Le(),He(H,1,1,function(){H=null}),Me()),e[16].fullScreen?Z?(Z.p(e,c),65536&c[0]&&Ve(Z,1)):((Z=Ln(e)).c(),Ve(Z,1),Z.m(s,f)):Z&&(Le(),He(Z,1,1,function(){Z=null}),Me()),e[16].webFullScreen?q?(q.p(e,c),65536&c[0]&&Ve(q,1)):((q=Vn(e)).c(),Ve(q,1),q.m(s,d)):q&&(Le(),He(q,1,1,function(){q=null}),Me()),e[16].danmaku?z?(z.p(e,c),65536&c[0]&&Ve(z,1)):((z=Zn(e)).c(),Ve(z,1),z.m(s,p)):z&&(Le(),He(z,1,1,function(){z=null}),Me()),e[16].subtitle?F?(F.p(e,c),65536&c[0]&&Ve(F,1)):((F=zn(e)).c(),Ve(F,1),F.m(s,v)):F&&(Le(),He(F,1,1,function(){F=null}),Me()),e[16].rightSetting?_?(_.p(e,c),65536&c[0]&&Ve(_,1)):((_=Fn(e)).c(),Ve(_,1),_.m(s,C)):_&&(Le(),He(_,1,1,function(){_=null}),Me()),e[16].pip&&document.pictureInPictureEnabled?P?(P.p(e,c),65536&c[0]&&Ve(P,1)):((P=_n(e)).c(),Ve(P,1),P.m(s,h)):P&&(Le(),He(P,1,1,function(){P=null}),Me()),e[16].mirror?O?(O.p(e,c),65536&c[0]&&Ve(O,1)):((O=Pn(e)).c(),Ve(O,1),O.m(s,g)):O&&(Le(),He(O,1,1,function(){O=null}),Me()),e[16].quality&&null!=e[9].value&&!e[14]?j?(j.p(e,c),82432&c[0]&&Ve(j,1)):((j=On(e)).c(),Ve(j,1),j.m(s,m)):j&&(Le(),He(j,1,1,function(){j=null}),Me()),e[16].quality&&null!=e[9].value&&e[14]?I?(I.p(e,c),82432&c[0]&&Ve(I,1)):((I=Rn(e)).c(),Ve(I,1),I.m(s,x)):I&&(Le(),He(I,1,1,function(){I=null}),Me()),(!y||32768&c[0])&&Y(t,"style",e[15])},i:function(e){y||(Ve(L),Ve(M),Ve(V),Ve(H),Ve(Z),Ve(q),Ve(z),Ve(F),Ve(_),Ve(P),Ve(O),Ve(j),Ve(I),Ce(function(){y&&(b||(b=Se(t,Oe,{duration:200},!0)),b.run(1))}),y=!0)},o:function(e){He(L),He(M),He(V),He(H),He(Z),He(q),He(z),He(F),He(_),He(P),He(O),He(j),He(I),b||(b=Se(t,Oe,{duration:200},!1)),b.run(0),y=!1},d:function(n){n&&T(t),$&&$.d(),k&&k.d(),L&&L.d(),M&&M.d(),V&&V.d(),H&&H.d(),Z&&Z.d(),q&&q.d(),z&&z.d(),F&&F.d(),_&&_.d(),P&&P.d(),O&&O.d(),j&&j.d(),I&&I.d(),e[41](null),n&&b&&b.end()}}}function gn(e){var t,n,i,r=(e[2]?je:Ie)+"";return{c:function(){Y(t=B("span"),"class","icon")},m:function(o,l){E(o,t,l),t.innerHTML=r,n||(i=I(t,"click",e[25]),n=!0)},p:function(e,n){4&n[0]&&r!==(r=(e[2]?je:Ie)+"")&&(t.innerHTML=r)},d:function(e){e&&T(t),n=!1,i()}}}function mn(e){var t,n,i;return{c:function(){Y(t=B("span"),"class","icon")},m:function(r,o){E(r,t,o),t.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.75 20.5C12.75 20.9142 12.4142 21.25 12 21.25C6.89137 21.25 2.75 17.1086 2.75 12C2.75 9.64808 3.62821 7.50123 5.07312 5.86963H3.01001C2.5958 5.86963 2.26001 5.53384 2.26001 5.11963C2.26001 4.70542 2.5958 4.36963 3.01001 4.36963H7.01001C7.42422 4.36963 7.76001 4.70542 7.76001 5.11963V9.11963C7.76001 9.53384 7.42422 9.86963 7.01001 9.86963C6.5958 9.86963 6.26001 9.53384 6.26001 9.11963V6.7926C5.01041 8.16902 4.25 9.99568 4.25 12C4.25 16.2802 7.71979 19.75 12 19.75C12.4142 19.75 12.75 20.0858 12.75 20.5ZM17.75 17.1963V14.8799C17.75 14.4657 17.4142 14.1299 17 14.1299C16.5858 14.1299 16.25 14.4657 16.25 14.8799V18.8799C16.25 19.2941 16.5858 19.6299 17 19.6299H21C21.4142 19.6299 21.75 19.2941 21.75 18.8799C21.75 18.4657 21.4142 18.1299 21 18.1299H18.9273C20.372 16.4983 21.25 14.3517 21.25 12C21.25 6.89137 17.1086 2.75 12 2.75C11.5858 2.75 11.25 3.08579 11.25 3.5C11.25 3.91421 11.5858 4.25 12 4.25C16.2802 4.25 19.75 7.71979 19.75 12C19.75 13.999 18.9937 15.8212 17.75 17.1963Z" fill="white"/></svg>',n||(i=I(t,"click",e[26]),n=!0)},p:C,d:function(e){e&&T(t),n=!1,i()}}}function xn(e){var t,n;return t=new ht({props:{disabled:e[8].disabled,value:e[8].value,onChange:e[27]}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};256&n[0]&&(i.disabled=e[8].disabled),256&n[0]&&(i.value=e[8].value),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function wn(e){var t,n;return t=new it({props:{text:e[18].tips,$$slots:{default:[yn]},$$scope:{ctx:e}}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};262144&n[0]&&(i.text=e[18].tips),278528&n[0]|16384&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function bn(e){var t,n,i=e[18].value+"";return{c:function(){t=B("span"),n=O(i),Y(t,"class","text time")},m:function(e,i){E(e,t,i),S(t,n)},p:function(e,t){262144&t[0]&&i!==(i=e[18].value+"")&&D(n,i)},d:function(e){e&&T(t)}}}function yn(e){var t,n=!e[14]&&bn(e);return{c:function(){n&&n.c(),t=j()},m:function(e,i){n&&n.m(e,i),E(e,t,i)},p:function(e,i){e[14]?n&&(n.d(1),n=null):n?n.p(e,i):((n=bn(e)).c(),n.m(t.parentNode,t))},d:function(e){n&&n.d(e),e&&T(t)}}}function $n(e){var t,n;return t=new Tt({props:{onChange:e[20]}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:C,i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function kn(e){var t,n,i;function r(t){e[30](t)}var o={foucsChange:e[28],onSend:e[29]};return void 0!==e[0]&&(o.dmMsg=e[0]),t=new Wt({props:o}),se.push(function(){return qe(t,"dmMsg",r)}),{c:function(){ze(t.$$.fragment)},m:function(e,n){Fe(t,e,n),i=!0},p:function(e,i){var r={};!n&&1&i[0]&&(n=!0,r.dmMsg=e[0],he(function(){return n=!1})),t.$set(r)},i:function(e){i||(Ve(t.$$.fragment,e),i=!0)},o:function(e){He(t.$$.fragment,e),i=!1},d:function(e){_e(t,e)}}}function Ln(e){var t,n;return t=new it({props:{text:e[14]?"":e[3]?"退出全屏模式":"全屏模式",style:"left: auto; right: -80%;",$$slots:{default:[Mn]},$$scope:{ctx:e}}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};16392&n[0]&&(i.text=e[14]?"":e[3]?"退出全屏模式":"全屏模式"),8&n[0]|16384&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function Mn(e){var t,n,i,r=(e[3]?Ne:Ae)+"";return{c:function(){Y(t=B("span"),"class","icon")},m:function(o,l){E(o,t,l),t.innerHTML=r,n||(i=I(t,"click",e[31]),n=!0)},p:function(e,n){8&n[0]&&r!==(r=(e[3]?Ne:Ae)+"")&&(t.innerHTML=r)},d:function(e){e&&T(t),n=!1,i()}}}function Vn(e){var t,n;return t=new it({props:{text:e[14]?"":"".concat(e[4]?"退出":"","网页模式"),$$slots:{default:[Hn]},$$scope:{ctx:e}}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};16400&n[0]&&(i.text=e[14]?"":"".concat(e[4]?"退出":"","网页模式")),16&n[0]|16384&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function Hn(e){var t,n,i,r=(e[4]?Xe:Ye)+"";return{c:function(){Y(t=B("span"),"class","icon")},m:function(o,l){E(o,t,l),t.innerHTML=r,n||(i=I(t,"click",e[32]),n=!0)},p:function(e,n){16&n[0]&&r!==(r=(e[4]?Xe:Ye)+"")&&(t.innerHTML=r)},d:function(e){e&&T(t),n=!1,i()}}}function Zn(e){var t,n,i,r=!e[14]&&e[16].danmakuPanel&&Sn(e);return n=new it({props:{text:e[14]?"":e[11].display?"关闭弹幕":"开启弹幕",$$slots:{default:[qn]},$$scope:{ctx:e}}}),{c:function(){r&&r.c(),t=R(),ze(n.$$.fragment)},m:function(e,o){r&&r.m(e,o),E(e,t,o),Fe(n,e,o),i=!0},p:function(e,i){!e[14]&&e[16].danmakuPanel?r?(r.p(e,i),81920&i[0]&&Ve(r,1)):((r=Sn(e)).c(),Ve(r,1),r.m(t.parentNode,t)):r&&(Le(),He(r,1,1,function(){r=null}),Me());var o={};18432&i[0]&&(o.text=e[14]?"":e[11].display?"关闭弹幕":"开启弹幕"),2048&i[0]|16384&i[1]&&(o.$$scope={dirty:i,ctx:e}),n.$set(o)},i:function(e){i||(Ve(r),Ve(n.$$.fragment,e),i=!0)},o:function(e){He(r),He(n.$$.fragment,e),i=!1},d:function(e){r&&r.d(e),e&&T(t),_e(n,e)}}}function Sn(e){var t,n;return t=new Xt({props:{options:e[11],onChange:e[33]}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};2048&n[0]&&(i.options=e[11]),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function qn(e){var t,n,i,r=(e[11].display?Ke:Je)+"";return{c:function(){Y(t=B("span"),"class","icon")},m:function(o,l){E(o,t,l),t.innerHTML=r,n||(i=I(t,"click",e[34]),n=!0)},p:function(e,n){2048&n[0]&&r!==(r=(e[11].display?Ke:Je)+"")&&(t.innerHTML=r)},d:function(e){e&&T(t),n=!1,i()}}}function zn(e){var t,n;return t=new vn({props:{visible:e[7].visible,draggable:e[7].draggable,onChange:e[35]}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};128&n[0]&&(i.visible=e[7].visible),128&n[0]&&(i.draggable=e[7].draggable),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function Fn(e){var t,n;return t=new Tt({props:{onChange:e[20]}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:C,i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function _n(e){var t,n;return t=new it({props:{text:e[5]?"退出小窗模式":"小窗模式",$$slots:{default:[Tn]},$$scope:{ctx:e}}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};32&n[0]&&(i.text=e[5]?"退出小窗模式":"小窗模式"),16416&n[0]|16384&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function En(e){var t,n,i,r=(e[5]?De:Ge)+"";return{c:function(){Y(t=B("span"),"class","icon")},m:function(o,l){E(o,t,l),t.innerHTML=r,n||(i=I(t,"click",e[36]),n=!0)},p:function(e,n){32&n[0]&&r!==(r=(e[5]?De:Ge)+"")&&(t.innerHTML=r)},d:function(e){e&&T(t),n=!1,i()}}}function Tn(e){var t,n=!e[14]&&En(e);return{c:function(){n&&n.c(),t=j()},m:function(e,i){n&&n.m(e,i),E(e,t,i)},p:function(e,i){e[14]?n&&(n.d(1),n=null):n?n.p(e,i):((n=En(e)).c(),n.m(t.parentNode,t))},d:function(e){n&&n.d(e),e&&T(t)}}}function Pn(e){var t,n;return t=new it({props:{text:e[6]?"退出镜像模式":"镜像模式",$$slots:{default:[Bn]},$$scope:{ctx:e}}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};64&n[0]&&(i.text=e[6]?"退出镜像模式":"镜像模式"),64&n[0]|16384&n[1]&&(i.$$scope={dirty:n,ctx:e}),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function Bn(e){var t,n,i,r=(e[6]?Ue:We)+"";return{c:function(){Y(t=B("span"),"class","icon")},m:function(o,l){E(o,t,l),t.innerHTML=r,n||(i=I(t,"click",e[37]),n=!0)},p:function(e,n){64&n[0]&&r!==(r=(e[6]?Ue:We)+"")&&(t.innerHTML=r)},d:function(e){e&&T(t),n=!1,i()}}}function On(e){var t,n;return t=new qt({props:{qualityList:e[9].list,quality:e[9].value,lineList:e[10].list,line:e[10].value,onChange:e[38]}}),{c:function(){ze(t.$$.fragment)},m:function(e,i){Fe(t,e,i),n=!0},p:function(e,n){var i={};512&n[0]&&(i.qualityList=e[9].list),512&n[0]&&(i.quality=e[9].value),1024&n[0]&&(i.lineList=e[10].list),1024&n[0]&&(i.line=e[10].value),t.$set(i)},i:function(e){n||(Ve(t.$$.fragment,e),n=!0)},o:function(e){He(t.$$.fragment,e),n=!1},d:function(e){_e(t,e)}}}function Rn(e){var t,n,i;function r(t){e[40](t)}var o={container:e[12],quality:e[9].value,qualityList:e[9].list,onChange:e[39]};return void 0!==e[1]&&(o.ref=e[1]),t=new nn({props:o}),se.push(function(){return qe(t,"ref",r)}),{c:function(){ze(t.$$.fragment)},m:function(e,n){Fe(t,e,n),i=!0},p:function(e,i){var r={};4096&i[0]&&(r.container=e[12]),512&i[0]&&(r.quality=e[9].value),512&i[0]&&(r.qualityList=e[9].list),!n&&2&i[0]&&(n=!0,r.ref=e[1],he(function(){return n=!1})),t.$set(r)},i:function(e){i||(Ve(t.$$.fragment,e),i=!0)},o:function(e){He(t.$$.fragment,e),i=!1},d:function(e){_e(t,e)}}}function jn(e){var t,n,i=e[13]&&hn(e);return{c:function(){i&&i.c(),t=j()},m:function(e,r){i&&i.m(e,r),E(e,t,r),n=!0},p:function(e,n){e[13]?i?(i.p(e,n),8192&n[0]&&Ve(i,1)):((i=hn(e)).c(),Ve(i,1),i.m(t.parentNode,t)):i&&(Le(),He(i,1,1,function(){i=null}),Me())},i:function(e){n||(Ve(i),n=!0)},o:function(e){He(i),n=!1},d:function(e){i&&i.d(e),e&&T(t)}}}function In(e,t,n){var i,o=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function l(e){try{c(i.next(e))}catch(e){o(e)}}function a(e){try{c(i.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,a)}c((i=i.apply(e,t||[])).next())})},l=t.onChange,a=t.container,c=t.show,u=t.isMobile,s=void 0!==u&&u,p=t.dmMsg,v=void 0===p?"":p,C=t.style,h=void 0===C?"":C,g=t.qualityPanelRef,m=t.ctrlItemVisibility,x=void 0===m?{playStatus:!0,volume:!0,time:!0,refresh:!0,leftSetting:!1,quality:!0,danmaku:!0,rightSetting:!1,fullScreen:!0,webFullScreen:!0,danmakuPanel:!0,pip:!0,mirror:!1,dmSend:!1,subtitle:!1}:m,w=t.playStatus,b=void 0!==w&&w,y=t.fullScreenStatus,$=void 0!==y&&y,k=t.webFullScreenStatus,L=void 0!==k&&k,M=t.pipStatus,V=void 0!==M&&M,H=t.mirrorStatus,Z=void 0!==H&&H,S=t.subtitleStatus,q=void 0===S?{visible:!1,draggable:!1}:S,z=t.onRefresh,F=t.time,_=void 0===F?{value:"",tips:""}:F,E=t.volume,T=void 0===E?{disabled:!1,value:50}:E,P=t.quality,B=t.line,O=t.danmakuPanel,R=void 0===O||O,j=t.danmaku,I=void 0===j?{display:!0,opacity:100,fontScale:100,density:100,enableMask:!0,showMaskOption:!1,area:4}:j,A=t.playerType,N=void 0===A?"html5":A,Y=new Map;function X(){null!=i&&d(Y.entries()).sort(function(e,t){return f(e,2)[1]-f(t,2)[1]}).map(function(e){return f(e,1)[0]}).forEach(function(e){i.appendChild(e)})}var D=function(e,t){return o(void 0,void 0,void 0,regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,l(e,t);case 2:if(i.t0=i.sent,!1!==i.t0){i.next=5;break}return i.abrupt("return");case 5:i.t1=e,i.next="playStatus"===i.t1?8:"volume"===i.t1?10:"quality"===i.t1?12:"line"===i.t1?14:"playerType"===i.t1?16:"danmaku"===i.t1?18:"fullScreenStatus"===i.t1?20:"webFullScreenStatus"===i.t1?22:"danmakuPanel"===i.t1?24:"pipStatus"===i.t1?26:"mirrorStatus"===i.t1?28:"subtitle"===i.t1?30:32;break;case 8:return n(2,b=t),i.abrupt("break",32);case 10:return n(8,T=Object.assign({},T,t)),i.abrupt("break",32);case 12:return n(9,P.value=t,P),i.abrupt("break",32);case 14:return n(10,B.value=t,B),i.abrupt("break",32);case 16:return n(22,N=t),i.abrupt("break",32);case 18:return n(11,I=Object.assign({},I,t)),i.abrupt("break",32);case 20:return n(3,$=t),i.abrupt("break",32);case 22:return n(4,L=t),i.abrupt("break",32);case 24:return n(21,R=t),i.abrupt("break",32);case 26:return n(5,V=t),i.abrupt("break",32);case 28:return n(6,Z=t),i.abrupt("break",32);case 30:return n(7,q=Object.assign({},q,t)),i.abrupt("break",32);case 32:case"end":return i.stop()}},i)}))};return e.$$set=function(e){"onChange"in e&&n(23,l=e.onChange),"container"in e&&n(12,a=e.container),"show"in e&&n(13,c=e.show),"isMobile"in e&&n(14,s=e.isMobile),"dmMsg"in e&&n(0,v=e.dmMsg),"style"in e&&n(15,h=e.style),"qualityPanelRef"in e&&n(1,g=e.qualityPanelRef),"ctrlItemVisibility"in e&&n(16,x=e.ctrlItemVisibility),"playStatus"in e&&n(2,b=e.playStatus),"fullScreenStatus"in e&&n(3,$=e.fullScreenStatus),"webFullScreenStatus"in e&&n(4,L=e.webFullScreenStatus),"pipStatus"in e&&n(5,V=e.pipStatus),"mirrorStatus"in e&&n(6,Z=e.mirrorStatus),"subtitleStatus"in e&&n(7,q=e.subtitleStatus),"onRefresh"in e&&n(17,z=e.onRefresh),"time"in e&&n(18,_=e.time),"volume"in e&&n(8,T=e.volume),"quality"in e&&n(9,P=e.quality),"line"in e&&n(10,B=e.line),"danmakuPanel"in e&&n(21,R=e.danmakuPanel),"danmaku"in e&&n(11,I=e.danmaku),"playerType"in e&&n(22,N=e.playerType)},e.$$.update=function(){e.$$.dirty[0],532480&e.$$.dirty[0]&&c&&i&&X()},[v,g,b,$,L,V,Z,q,T,P,B,I,a,c,s,h,x,z,_,i,D,R,N,l,function(e,t){var n=t.xIndex;return Y.set(e,n),X(),function(){Y.delete(e),e.remove()}},function(){return D("playStatus",!b)},function(){var e;return null===(e=z)||void 0===e?void 0:e()},function(e){return D("volume",e)},function(e){D("dmInputFocus",e)},function(e){D("dmSend",e)},function(e){n(0,v=e)},function(){return D("fullScreenStatus",!$)},function(){return D("webFullScreenStatus",!L)},function(e,t){return D("danmaku",r({},e,t))},function(){D("danmaku",{display:!I.display})},function(e){return D("subtitle",e)},function(){return D("pipStatus",!document.pictureInPictureElement)},function(){return D("mirrorStatus",!Z)},function(e,t){return D(e,t)},function(e,t){return D(e,t)},function(e){n(1,g=e)},function(e){se[e?"unshift":"push"](function(){n(19,i=e)})}]}var An=function(e){o(r,Pe);var n=s(r);function r(e){var i;return t(this,r),Te(c(i=n.call(this)),e,In,jn,b,{onChange:23,container:12,show:13,isMobile:14,dmMsg:0,style:15,qualityPanelRef:1,ctrlItemVisibility:16,playStatus:2,fullScreenStatus:3,webFullScreenStatus:4,pipStatus:5,mirrorStatus:6,subtitleStatus:7,onRefresh:17,time:18,volume:8,quality:9,line:10,danmakuPanel:21,danmaku:11,playerType:22,appendCtrlItem:24},Cn,[-1,-1]),i}return i(r,[{key:"onChange",get:function(){return this.$$.ctx[23]},set:function(e){this.$$set({onChange:e}),we()}},{key:"container",get:function(){return this.$$.ctx[12]},set:function(e){this.$$set({container:e}),we()}},{key:"show",get:function(){return this.$$.ctx[13]},set:function(e){this.$$set({show:e}),we()}},{key:"isMobile",get:function(){return this.$$.ctx[14]},set:function(e){this.$$set({isMobile:e}),we()}},{key:"dmMsg",get:function(){return this.$$.ctx[0]},set:function(e){this.$$set({dmMsg:e}),we()}},{key:"style",get:function(){return this.$$.ctx[15]},set:function(e){this.$$set({style:e}),we()}},{key:"qualityPanelRef",get:function(){return this.$$.ctx[1]},set:function(e){this.$$set({qualityPanelRef:e}),we()}},{key:"ctrlItemVisibility",get:function(){return this.$$.ctx[16]},set:function(e){this.$$set({ctrlItemVisibility:e}),we()}},{key:"playStatus",get:function(){return this.$$.ctx[2]},set:function(e){this.$$set({playStatus:e}),we()}},{key:"fullScreenStatus",get:function(){return this.$$.ctx[3]},set:function(e){this.$$set({fullScreenStatus:e}),we()}},{key:"webFullScreenStatus",get:function(){return this.$$.ctx[4]},set:function(e){this.$$set({webFullScreenStatus:e}),we()}},{key:"pipStatus",get:function(){return this.$$.ctx[5]},set:function(e){this.$$set({pipStatus:e}),we()}},{key:"mirrorStatus",get:function(){return this.$$.ctx[6]},set:function(e){this.$$set({mirrorStatus:e}),we()}},{key:"subtitleStatus",get:function(){return this.$$.ctx[7]},set:function(e){this.$$set({subtitleStatus:e}),we()}},{key:"onRefresh",get:function(){return this.$$.ctx[17]},set:function(e){this.$$set({onRefresh:e}),we()}},{key:"time",get:function(){return this.$$.ctx[18]},set:function(e){this.$$set({time:e}),we()}},{key:"volume",get:function(){return this.$$.ctx[8]},set:function(e){this.$$set({volume:e}),we()}},{key:"quality",get:function(){return this.$$.ctx[9]},set:function(e){this.$$set({quality:e}),we()}},{key:"line",get:function(){return this.$$.ctx[10]},set:function(e){this.$$set({line:e}),we()}},{key:"danmakuPanel",get:function(){return this.$$.ctx[21]},set:function(e){this.$$set({danmakuPanel:e}),we()}},{key:"danmaku",get:function(){return this.$$.ctx[11]},set:function(e){this.$$set({danmaku:e}),we()}},{key:"playerType",get:function(){return this.$$.ctx[22]},set:function(e){this.$$set({playerType:e}),we()}},{key:"appendCtrlItem",get:function(){return this.$$.ctx[24]}}]),r}(),Nn=An;exports.default=Nn;
},{}],"kyLC":[function(require,module,exports) {
"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(t)}function t(o){var t,e;return null!==(e=null===(t=RegExp("[;\\s]*".concat(o,"=([^;\\s]+)")).exec(document.cookie))||void 0===t?void 0:t[1])&&void 0!==e?e:""}function e(){return/ipad|iphone os|android/i.test(navigator.userAgent)}function n(){}function r(t,e){if(t===e)return!0;if("object"===o(t)){for(var n in t)if(!r(t[n],e[n]))return!1;return!0}return!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCookie=t,exports.isMobile=e,exports.noop=n,exports.deepEqual=r;
},{}],"wPfs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Formatter=void 0;var t=require("./utils"),e=function(t){var e,n;return["".concat(location.href),"".concat(null==t.spmId?"":t.spmId+".").concat(t.evtId),"",Date.now(),"","","".concat(screen.width,"x").concat(screen.height),"",JSON.stringify(Object.assign(Object.assign({},null!==(e=t.data)&&void 0!==e?e:{}),null!==(n=null==t?void 0:t.tags)&&void 0!==n?n:{}))]},n={"011778":e,"000527":e,"000358":function(e){var n,o;return["".concat(location.href),"".concat(null!==(n=document.referrer)&&void 0!==n?n:""),"".concat(null==e.spmId?"":e.spmId+".").concat(e.evtId),Date.now(),null!==(o=(0,t.getCookie)("fts"))&&void 0!==o?o:"","".concat(screen.width,"x").concat(screen.height),(0,t.isMobile)()?2:1,null==e.data?"":JSON.stringify(e.data),"",0]}};exports.Formatter=n;
},{"./utils":"kyLC"}],"EpHV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tracker=void 0;var t=require("./formatter"),e=require("./utils");function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}var r,a,c,s,f,u,l,h,d,v,w=function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function a(t){try{s(i.next(t))}catch(e){r(e)}}function c(t){try{s(i.throw(t))}catch(e){r(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,c)}s((i=i.apply(t,e||[])).next())})},p=function(t,e,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(t,n):o?o.value=n:e.set(t,n),n},m=function(t,e,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(t):i?i.value:e.get(t)},b=new Promise(function(t){""===(0,e.getCookie)("buvid3")?window.fetch("//data.bilibili.com/v/",{credentials:"include"}).then(function(){return t()}).catch(function(){return t()}):t()});function y(t){var n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return w(this,void 0,void 0,regeneratorRuntime.mark(function r(){var a,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==t.length){r.next=2;break}return r.abrupt("return");case 2:if(a="string"==typeof t?t:t.join(""),c="//data.bilibili.com/gol/postweb",!i){r.next=8;break}null===(n=navigator.sendBeacon)||void 0===n||n.call(navigator,c,a),r.next=11;break;case 8:return r.next=10,b;case 10:fetch(c,{method:"POST",body:a,credentials:"include"}).then(function(n){if(429===n.status){var i=[1e4,2e4,4e4][o];if(null==i)return;window.setTimeout(function(){y(t,!1,o+=1).catch(e.noop)},i)}}).catch(function(t){console.error(t)});case 11:case"end":return r.stop()}},r)}))}var g=!1,k=0;window.addEventListener("beforeunload",function(){g=!0,clearTimeout(k),k=window.setTimeout(function(){g=!1},5e3)});var T=function(){function i(o){var w,b,g=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n(this,i),r.set(this,[]),a.set(this,void 0),c.set(this,void 0),s.set(this,function(){}),f.set(this,void 0),u.set(this,[]),l.set(this,(b=!1,function(){if(!b){b=!0;var t=window.setTimeout(function(){b=!1,m(g,d,"f").call(g)},6e4);p(g,s,function(){b=!1,clearTimeout(t)},"f")}})),h.set(this,function(t,n){var i=Math.random()*n,o=window.setTimeout(function(){p(g,u,m(g,u,"f").filter(function(t){return t.timer!==o}),"f"),y(t,i<10,0).catch(e.noop)},i),r={timer:o,data:t};m(g,u,"f").push(r)}),d.set(this,function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];m(g,s,"f").call(g),y(m(g,r,"f"),t).catch(e.noop),p(g,r,[],"f")}),v.set(this,function(){"hidden"===document.visibilityState&&(m(g,u,"f").forEach(function(t){var e=t.timer;return clearTimeout(e)}),y(m(g,u,"f").map(function(t){return t.data}),!0).catch(e.noop),p(g,u,[],"f"),m(g,d,"f").call(g,!0))}),p(this,a,o,"f"),p(this,f,null!==(w=k.formatter)&&void 0!==w?w:t.Formatter[o],"f"),null==m(this,f,"f"))throw new Error("Undefined Formatter for logId: ".concat(o));p(this,c,k,"f"),document.addEventListener("visibilitychange",m(this,v,"f"))}return o(i,[{key:"event",value:function(t,n){var i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof t||""===t)throw Error("evtId: ".concat(JSON.stringify(t)," not a string"));var u=null!==(o=null!==(i=s.sample)&&void 0!==i?i:m(this,c,"f").sample)&&void 0!==o?o:100,v=100*Math.random()>=u;if(!0===m(this,c,"f").debug&&console.log("live-web-track: evtId: ".concat(t,", 采样率 ").concat(u,"%, 本次是否上报 ").concat(JSON.stringify(!v))),!v){var w="".concat(m(this,a,"f")).concat(Date.now()).concat(m(this,f,"f").call(this,Object.assign({evtId:t,data:n},m(this,c,"f"))).join("|"));if(g)y(w,!0).catch(e.noop);else{if("number"==typeof s.randDelay)return void m(this,h,"f").call(this,w,s.randDelay);(0,e.isMobile)()?y(w,!0).catch(e.noop):m(this,r,"f").push(w)}m(this,r,"f").length>=10?m(this,d,"f").call(this):m(this,l,"f").call(this)}}},{key:"set",value:function(t){p(this,c,Object.assign({},m(this,c,"f"),t),"f")}},{key:"destroy",value:function(){m(this,d,"f").call(this),document.removeEventListener("visibilitychange",m(this,v,"f"))}}]),i}();exports.Tracker=T,r=new WeakMap,a=new WeakMap,c=new WeakMap,s=new WeakMap,f=new WeakMap,u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,v=new WeakMap;
},{"./formatter":"wPfs","./utils":"kyLC"}],"jGuH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExpUtils=void 0;var e=require("../utils");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a,i,o,s=function(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r},c=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},l=function(){function e(r,n,c){t(this,e),a.set(this,!1),i.set(this,void 0),o.set(this,null),s(this,i,r,"f"),s(this,o,null,"f"),this.createObserver(n,c)}return n(e,[{key:"createObserver",value:function(e,t){var r=this;null!==c(this,o,"f")&&this.destroyObserver();var n=!1;s(this,a,!1,"f"),s(this,o,new IntersectionObserver(function(t){var i=t.some(function(e){return e.isIntersecting});i!==c(r,a,"f")&&(s(r,a,i,"f"),i&&(n||(n=!0,setTimeout(function(){n=!1},500),e.callback(),e.repeat||r.destroyObserver())))},{threshold:[.5]}),"f"),t.context.$nextTick(function(){var e;null===(e=c(r,o,"f"))||void 0===e||e.observe(c(r,i,"f"))})}},{key:"destroyObserver",value:function(){var e;null===(e=c(this,o,"f"))||void 0===e||e.disconnect(),s(this,o,null,"f")}}]),e}();a=new WeakMap,i=new WeakMap,o=new WeakMap;var u={bind:function(e,t,r){if(void 0===window.IntersectionObserver)console.warn("IntersectionObserver API is not available in your browser.");else{var n=new l(e,t,r);e.track_exp_state=n}},update:function(t,r,n){(0,e.deepEqual)(r.value,r.oldValue)||t.track_exp_state.createObserver({callback:r.callback,repeat:r.repeat},n)},unbind:function(e){e.track_exp_state.destroyObserver()}};exports.ExpUtils=u;
},{"../utils":"kyLC"}],"oQm6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.genDirectives=u;var e=require("./exp");function t(e,t){return a(e)||o(e,t)||r(e,t)||n()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(c){i=!0,o=c}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}}function a(e){if(Array.isArray(e))return e}function u(n){var r=new WeakMap;function i(e,t,i,o){function a(){n.event(i,o),e.removeEventListener("click",a)}if(t)r.set(e,{ck:a}),e.addEventListener("click",a);else{var u=function(){n.event(i,o)};r.set(e,{ck:u}),e.addEventListener("click",u)}}function o(e){var t,n=null===(t=r.get(e))||void 0===t?void 0:t.ck;null!=n&&e.removeEventListener("click",n)}return{bind:function(r,o,a,u){var c=o.value,l=o.arg,v=o.modifiers,f=t(c,2),s=f[0],d=f[1],p=v.repeat,y=v.once;"ck"===l?i(r,y,s,d):"exp"===l&&e.ExpUtils.bind(r,{callback:function(){return n.event(s,d)},repeat:p},a)},update:function(r,a,u){var c=a.value,l=a.arg,v=a.modifiers,f=t(c,2),s=f[0],d=f[1],p=v.repeat,y=v.once;"ck"===l?(o(r),i(r,y,s,d)):"exp"===l&&e.ExpUtils.update(r,{value:a.value,oldValue:a.oldValue,callback:function(){return n.event(s,d)},repeat:p},u)},unbind:function(t,n){var r=n.arg;"ck"===r?o(t):"exp"===r&&e.ExpUtils.unbind(t)}}}
},{"./exp":"jGuH"}],"HmVg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNavigationEntryFromPerformanceTiming=t,exports.getPerformanceTiming=n,exports.performTempalte=void 0;var e=["startTime","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd","duration","redirectCount","decodedBodySize","encodedBodySize","transferSize"];function t(){try{var e=performance.timing,t=performance.navigation.type===performance.navigation.TYPE_BACK_FORWARD?"back_forward":performance.navigation.type===performance.navigation.TYPE_NAVIGATE?"navigate":performance.navigation.type===performance.navigation.TYPE_RELOAD?"reload":"prerender",n={entryType:"navigation",startTime:0,duration:e.loadEventEnd-e.navigationStart,redirectCount:performance.navigation.redirectCount,type:t};for(var r in e)"navigationStart"!==r&&"toJSON"!==r&&(n[r]=Math.max(e[r]-e.navigationStart,0));return n}catch(a){return{}}}function n(){var n;try{var r=null!==(n=null===performance||void 0===performance?void 0:performance.getEntriesByType("navigation")[0])&&void 0!==n?n:t(),a={};return e.forEach(function(e){var t;a[e]=Math.max(null!==(t=r[e])&&void 0!==t?t:0,0)}),a}catch(o){return{}}}exports.performTempalte=e;
},{}],"SCHR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDimension=u,exports.IDimensionOS=exports.IDimensionNavigationType=exports.IDimensionNetworkType=void 0;var n,o,e,i=require("./timing");function r(){return"hidden"===document.visibilityState||document.hidden?0:1}function t(){var o,e,i;return"4g"===(null===(o=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===o?void 0:o.effectiveType)?n["4g"]:"3g"===(null===(e=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===e?void 0:e.effectiveType)?n["3g"]:"2g"===(null===(i=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===i?void 0:i.effectiveType)?n["2g"]:n.other}function a(){var n;try{var e=(null!==(n=null===performance||void 0===performance?void 0:performance.getEntriesByType("navigation")[0])&&void 0!==n?n:(0,i.getNavigationEntryFromPerformanceTiming)()).type;return"navigate"===e?o.navigate:"reload"===e?o.reload:"back_forward"===e?o.backForward:o.other}catch(r){return o.other}}function v(){var n;return null!=(null===(n=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===n?void 0:n.controller)?1:0}function c(){var n="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform,o="Win32"===navigator.platform||"Windows"===navigator.platform,i="X11"===navigator.platform&&!o&&!n,r=String(navigator.platform).includes("Linux");return n?e.Mac:o?e.Windows:i?e.Unix:r?e.Linux:e.Other}function d(){try{return"h2"===performance.getEntriesByType("navigation")[0].nextHopProtocol?1:0}catch(n){return 0}}function l(){var n;return null!=(null===(n=null===window||void 0===window?void 0:window.PerformanceObserver)||void 0===n?void 0:n.supportedEntryTypes)&&["largest-contentful-paint","paint"].every(function(n){return window.PerformanceObserver.supportedEntryTypes.includes(n)})?1:0}function u(){return{OS:c(),VisibilityState:r(),NavigationType:a(),NetworkType:t(),ServiceWorkerState:v(),NextHopProtocol:d(),SupportedEntryTypes:l()}}exports.IDimensionNetworkType=n,function(n){n[n.other=0]="other",n[n["2g"]=2]="2g",n[n["3g"]=3]="3g",n[n["4g"]=4]="4g"}(n||(exports.IDimensionNetworkType=n={})),exports.IDimensionNavigationType=o,function(n){n[n.navigate=0]="navigate",n[n.reload=1]="reload",n[n.backForward=2]="backForward",n[n.other=255]="other"}(o||(exports.IDimensionNavigationType=o={})),exports.IDimensionOS=e,function(n){n[n.Other=0]="Other",n[n.Mac=1]="Mac",n[n.Windows=2]="Windows",n[n.Unix=3]="Unix",n[n.Linux=4]="Linux"}(e||(exports.IDimensionOS=e={}));
},{"./timing":"HmVg"}],"lNBA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BizCommonPerf=void 0;var e=require("./dimension"),t=require("./timing"),n=require(".."),r=require("../utils");function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s,u,c,f,d,m,h,v,p,w=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},g=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},b=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},y=["url","refer_url","spm_id","timestamp","fts","browser_resolution","ptype","business_name","level","event_name","event_content","extra_info","arg1","arg2","arg3"],O=function(e){var t,n,o,i=null!==(t=e.data)&&void 0!==t?t:{},a=i.businessName,l=i.eventName,s=i.level,u=i.extraInfo,c=i.arg1,f=i.arg2,d=i.arg3,m=b(i,["businessName","eventName","level","extraInfo","arg1","arg2","arg3"]);return{url:encodeURIComponent(window.location.href),refer_url:""===document.referrer?"":encodeURIComponent(document.referrer),spm_id:null!==(n=e.spmId)&&void 0!==n?n:"",timestamp:Date.now(),fts:(0,r.getCookie)("fts"),browser_resolution:"".concat(window.innerWidth,"x").concat(window.innerHeight),ptype:(0,r.isMobile)()?2:1,business_name:null!=a?a:"live-performance-track",level:null!=s?s:"log",event_name:null!==(o=null!=l?l:e.evtId)&&void 0!==o?o:"performanceTrack",event_content:null==e.data?"":JSON.stringify(m).replace(/"/g,"%22"),extra_info:null!=u?u:"",arg1:null!=c?c:"",arg2:null!=f?f:"",arg3:null!=d?d:""}},_=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,e),s.add(this),u.set(this,"000967"),c.set(this,void 0),f.set(this,void 0),d.set(this,void 0),m.set(this,null),w(this,c,t,"f"),w(this,f,n,"f"),w(this,d,r,"f"),g(this,s,"m",h).call(this),g(this,s,"m",v).call(this)}return l(e,[{key:"custom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;g(this,s,"m",v).call(this,o({},e,t),{delay:n},!0)}}]),e}();exports.BizCommonPerf=_,u=new WeakMap,c=new WeakMap,f=new WeakMap,d=new WeakMap,m=new WeakMap,s=new WeakSet,h=function(){null==g(this,m,"f")&&w(this,m,new n.Tracker(g(this,u,"f"),{spmId:g(this,c,"f"),formatter:function(e){var t=O(e),n=[];return y.forEach(function(e){n.push(t[e])}),n}}),"f")},v=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!=window.performance?"complete"===document.readyState?g(this,s,"m",p).call(this,t,n,r):window.addEventListener("load",function(){g(e,s,"m",p).call(e,t,n,r)}):console.error("window.performance is nonexistent")},p=function(){var n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="number"==typeof o.delay?o.delay:"number"==typeof g(this,f,"f").delay?g(this,f,"f").delay:0,l=Object.assign(Object.assign(Object.assign(Object.assign({},i?{}:(0,t.getPerformanceTiming)()),(0,e.getDimension)()),g(this,d,"f")),r),s=function(e){var t;return null===(t=g(n,m,"f"))||void 0===t?void 0:t.event("performanceTrack",e,{sample:100,randDelay:0})};a<=0?s(l):setTimeout(function(){s(l)},a)};
},{"./dimension":"SCHR","./timing":"HmVg","..":"BuDO","../utils":"kyLC"}],"BuDO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createDirective=i,Object.defineProperty(exports,"Tracker",{enumerable:!0,get:function(){return e.Tracker}}),Object.defineProperty(exports,"BizCommonPerf",{enumerable:!0,get:function(){return t.BizCommonPerf}});var e=require("./core"),r=require("./directives/directives"),t=require("./perf");function i(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new e.Tracker(t,i);return(0,r.genDirectives)(n)}
},{"./core":"EpHV","./directives/directives":"oQm6","./perf":"lNBA"}],"ESUf":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var o,r=1,t=arguments.length;r<t;r++)for(var a in o=arguments[r])Object.prototype.hasOwnProperty.call(o,a)&&(e[a]=o[a]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CustomCode=exports.OperationCode=exports.ErrorCode=exports.EventCode=exports.PerfCode=exports.Category=void 0;var o,r,t,a,n,i,l=require("@bilibili-live/live-web-track");!function(e){e[e.Perf=1]="Perf",e[e.Event=2]="Event",e[e.Error=3]="Error",e[e.Operation=4]="Operation",e[e.Custom=5]="Custom"}(o=exports.Category||(exports.Category={})),function(e){e[e.PlayerResLoad=1]="PlayerResLoad",e[e.FirstPacket=2]="FirstPacket",e[e.VideoMeta=3]="VideoMeta",e[e.FirstFrame=4]="FirstFrame",e[e.Api=5]="Api",e[e.DevicePerf=6]="DevicePerf"}(r=exports.PerfCode||(exports.PerfCode={})),function(e){e[e.RoomPlayerInit=1]="RoomPlayerInit",e[e.CreateVideo=2]="CreateVideo",e[e.CreateRoundPlayer=3]="CreateRoundPlayer",e[e.HomePlayerInit=100]="HomePlayerInit",e[e.ActivityPlayerInit=200]="ActivityPlayerInit",e[e.MobilePlayerInit=300]="MobilePlayerInit"}(t=exports.EventCode||(exports.EventCode={})),function(e){e[e.UnsupportedPlayer=90001]="UnsupportedPlayer",e[e.NativeVideoError=90002]="NativeVideoError",e[e.NetworkException=90003]="NetworkException",e[e.ApiRequest=91001]="ApiRequest",e[e.ApiResponse=91002]="ApiResponse",e[e.ApiBiz=91003]="ApiBiz",e[e.FirstFrameNotEmit=92001]="FirstFrameNotEmit",e[e.RetryMaxTime=92002]="RetryMaxTime",e[e.SocketConnect=93001]="SocketConnect",e[e.PlayUrlNull=94001]="PlayUrlNull",e[e.RoomP0ApiFetchError=21001]="RoomP0ApiFetchError",e[e.RoomEnterLiveError=21003]="RoomEnterLiveError",e[e.RoomRoundUnknow=22e3]="RoomRoundUnknow",e[e.RoomUnSettingRound=22001]="RoomUnSettingRound",e[e.RoomCantRound=22002]="RoomCantRound",e[e.RoomEnterRoundError=22003]="RoomEnterRoundError",e[e.RoomRoundNotExistDash=22004]="RoomRoundNotExistDash",e[e.ErrorMseOpen=11003]="ErrorMseOpen"}(a=exports.ErrorCode||(exports.ErrorCode={})),function(e){e[e.Play=1]="Play",e[e.Pause=2]="Pause",e[e.Refresh=3]="Refresh",e[e.Mute=4]="Mute",e[e.Volume=5]="Volume",e[e.SwitchQuality=6]="SwitchQuality",e[e.SwitchLine=7]="SwitchLine",e[e.Feedback=8]="Feedback",e[e.TimeShift=9]="TimeShift",e[e.Danmaku=10]="Danmaku",e[e.FullScreen=11]="FullScreen",e[e.WebFullScreen=12]="WebFullScreen",e[e.PictureInPicture=13]="PictureInPicture",e[e.WebFullScreenWay=14]="WebFullScreenWay",e[e.Panorama=15]="Panorama"}(n=exports.OperationCode||(exports.OperationCode={})),function(e){e[e.Waiting=1]="Waiting",e[e.P2PData=2]="P2PData",e[e.UserFeedBack=3]="UserFeedBack",e[e.SEILatency=5]="SEILatency",e[e.StreamErrWhenEnded=100]="StreamErrWhenEnded",e[e.SwitchLine=104]="SwitchLine",e[e.HangUp=105]="HangUp",e[e.NetSpeed=106]="NetSpeed",e[e.AutoDiscardFrame=107]="AutoDiscardFrame",e[e.MutedPlay=108]="MutedPlay",e[e.NotAutoPlay=109]="NotAutoPlay",e[e.VideoPlaybackQuality=110]="VideoPlaybackQuality",e[e.SupportHEVC=111]="SupportHEVC",e[e.VideoEnhance=112]="VideoEnhance"}(i=exports.CustomCode||(exports.CustomCode={}));var d,u=function(e){if(null==e.data)return[];var o=e.data,r=o.ctime,t=o.category,a=o.val,n=o.params;return[o.staticInfo,r,t,o.code,a,n]},s=new l.Tracker("009658",{formatter:u}),c=function(){var e=-1;return function(){return"v".concat(e+=1)}}(),p={},y=c();function m(e){d="".concat(e.uvid,"|").concat(e.uid,"|").concat(e.version,"|").concat(e.roomId)}function v(o,r){if(!0===r)return y=c(),void(p[y]=e({},o));null==p[y]&&(p[y]={}),p[y]=Object.assign({},p[y],o)}function f(e,r,t){var a=void 0===t?{}:t,n=a.extFields,i=a.params,l=a.sampleRate,d=void 0===l?1:l,u=a.randDelay;P({val:Math.round(r),category:o.Perf,code:e,params:null!=i?i:{}},{sample:100*d,randDelay:u,extFields:null!=n?n:["sHost","sProtocol","p2pType","sQuery","x-service-module"]})}function P(o,r){var t,a=Date.now(),n=o.category,i=o.val,l=o.params,u=o.code,c=r.sample,m=r.randDelay,v=r.dynamicFieldsVer,f=r.extFields,P=null!==(t=p[null!=v?v:y])&&void 0!==t?t:{};"all"===f?l=e(e({},l),P):Array.isArray(f)&&(l=f.reduce(function(o,r){var t;return r in P?e(e({},o),((t={})[r]=P[r],t)):o},e({},l)));var E="string"==typeof i?i:null==i?"":JSON.stringify(i),R=0===Object.keys(null!=l?l:{}).length?"":JSON.stringify(l);s.event("playerEvt",{code:u,val:E,ctime:a,category:n,params:R,staticInfo:d},{sample:c,randDelay:m})}function E(e,r,t){var a,n;P({val:r,category:o.Event,code:e},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:1),randDelay:null==t?void 0:t.randDelay,extFields:null!==(n=null==t?void 0:t.extFields)&&void 0!==n?n:["sProtocol","sHost","p2pType","sCodec","sFormat"]})}function R(r,t,a){var n,i,l;void 0===a&&(a={}),P({val:t,category:o.Error,code:r,params:e({},null!=a.apiUrl?{apiUrl:a.apiUrl}:{})},{sample:100*(null!==(n=null==a?void 0:a.sampleRate)&&void 0!==n?n:1),randDelay:null!==(i=null==a?void 0:a.randDelay)&&void 0!==i?i:5e3,extFields:null!==(l=a.extFields)&&void 0!==l?l:"all"})}function C(e,r,t){var a;P({val:r,code:e,category:o.Operation},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:.1),randDelay:null==t?void 0:t.randDelay,extFields:null==t?void 0:t.extFields})}function x(e,r,t){var a;P({val:r,category:o.Custom,code:e},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:1),randDelay:null==t?void 0:t.randDelay,extFields:null==t?void 0:t.extFields})}function F(){var o=y;return{custom:function(e,r,t){x(e,r,Object.assign({},t,{dynamicFieldsVer:o}))},updateDynamicInfo:function(r){p[o]=e(e({},p[o]),r)}}}exports.default={perf:f,event:E,error:R,custom:x,operation:C,PerfCode:r,EventCode:t,ErrorCode:a,OperationCode:n,CustomCode:i,fixedDynamicFieldsVerIns:F,initStaticInfo:m,updateDynamicInfo:v,formatter:u};
},{"@bilibili-live/live-web-track":"BuDO"}],"as8u":[function(require,module,exports) {
"use strict";var t,e,n,i,r,o,s,a,l,u,c,f,h,d,p,w=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{l(i.next(t))}catch(e){o(e)}}function a(t){try{l(i.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}l((i=i.apply(t,e||[])).next())})},v=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(l){a=[6,l],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},y=this&&this.__classPrivateFieldSet||function(t,e,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(t,n):r?r.value=n:e.set(t,n),n},b=this&&this.__classPrivateFieldGet||function(t,e,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(t):i?i.value:e.get(t)},S=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ControllerEventType=void 0;var m,g=S(require("@bilibili-live/web-player-controller")),C=require("@bilibili-live/web-player-common"),k=S(require("@bilibili-live/web-player-track"));!function(t){t.BottomDistanceChange="bottomDistanceChange"}(m=exports.ControllerEventType||(exports.ControllerEventType={}));var E=function(){function S(S,k){var E=this;this.container=S,this.opts=k,t.set(this,new C.EventBus),e.set(this,void 0),n.set(this,void 0),i.set(this,void 0),r.set(this,new Set),o.set(this,new Set),s.set(this,void 0),a.set(this,!1),l.set(this,0),u.set(this,0),c.set(this,function(){}),this.on=b(this,t,"f").on,f.set(this,b(this,t,"f").emit),h.set(this,!1),this.setBottomDistance=function(t){parseInt(getComputedStyle(b(E,e,"f")).bottom)!==t&&(b(E,e,"f").style.bottom="".concat(t,"px"),b(E,n,"f").style.bottom="".concat(t,"px"),b(E,f,"f").call(E,m.BottomDistanceChange,t))},d.set(this,function(){if(C.logger.info("Controller onrefresh"),0!==b(E,o,"f").size)for(var t=0,e=Array.from(b(E,o,"f"));t<e.length;t++){(0,e[t])()}}),this.getCtrlEl=function(){return b(E,e,"f")},p.set(this,function(t,e){return w(E,void 0,Promise,function(){return v(this,function(n){switch(n.label){case 0:return C.logger.info("Controller onchange: type: ".concat(t,", value: ").concat(JSON.stringify(e))),0===b(this,r,"f").size?[2,!1]:[4,Promise.all(Array.from(b(this,r,"f")).map(function(n){return n(t,e)}))];case 1:return n.sent().includes(!1)?[2,!1]:[2]}})})}),this.changeCtrlVisible=function(t){t?(b(E,n,"f").style.visibility="visible",b(E,e,"f").style.visibility="visible"):(b(E,n,"f").style.visibility="hidden",b(E,e,"f").style.visibility="hidden")},y(this,e,M(),"f"),y(this,n,F(),"f"),k.enableCtrlUI&&(this.container.appendChild(b(this,n,"f")),S.appendChild(b(this,e,"f"))),y(this,i,new g.default({target:b(this,e,"f"),props:{show:!1,playStatus:!1,quality:{list:[],value:null},line:{list:[],value:null},onRefresh:b(this,d,"f"),onChange:b(this,p,"f"),isMobile:this.opts.isMobile,container:S,dmMsg:""}}),"f"),this.opts.isMobile?y(this,s,W(S,this,b(this,e,"f")),"f"):(y(this,s,x(S,this,b(this,e,"f")),"f"),y(this,c,T(this),"f"))}return S.prototype.triggerWebFullscreen=function(){var t,e=!(null!==(t=b(this,i,"f").webFullScreenStatus)&&void 0!==t&&t);b(this,i,"f").webFullScreenStatus=e,b(this,r,"f").forEach(function(t){return t("webFullScreenStatus",e)}),k.default.operation(k.default.OperationCode.WebFullScreenWay,e?1:-1)},S.prototype.onChange=function(t){var e=this;return b(this,r,"f").add(t),function(){b(e,r,"f").delete(t)}},S.prototype.onRefresh=function(t){var e=this;return b(this,o,"f").add(t),function(){b(e,o,"f").delete(t)}},S.prototype.getCtrlUI=function(){return b(this,i,"f")},S.prototype.setMiniMode=function(t){y(this,a,t,"f")},S.prototype.show=function(t){void 0===t&&(t=!1),y(this,h,t,"f"),clearTimeout(b(this,l,"f")),b(this,a,"f")||b(this,i,"f").show||(b(this,n,"f").style.display="block",b(this,i,"f").show=!0,b(this,r,"f").forEach(function(t){return t("show",!0)}))},S.prototype.delayHide=function(t,e){var n=this;void 0===e&&(e=function(){}),clearTimeout(b(this,l,"f")),y(this,l,window.setTimeout(function(){b(n,h,"f")||(n.hide(),e())},t),"f")},S.prototype.hide=function(t){void 0===t&&(t=!1),y(this,h,t,"f"),b(this,i,"f").show&&(b(this,n,"f").style.display="none",b(this,i,"f").show=!1,b(this,r,"f").forEach(function(t){return t("show",!1)}))},S.prototype.getLockDisplayState=function(){return b(this,h,"f")},S.prototype.setScreenStatus=function(t){var e=!0===b(this,i,"f").webFullScreenStatus?1:!0===b(this,i,"f").fullScreenStatus?2:0;if(e!==t){var n="fullScreenStatus",o=!0;switch(t){case 0:n=["webFullScreenStatus","webFullScreenStatus","fullScreenStatus"][e],o=!1,b(this,i,"f").webFullScreenStatus=!1,b(this,i,"f").fullScreenStatus=!1;break;case 1:n="webFullScreenStatus",b(this,i,"f").webFullScreenStatus=!0,b(this,i,"f").fullScreenStatus=!1;break;case 2:n="fullScreenStatus",b(this,i,"f").webFullScreenStatus=!1,b(this,i,"f").fullScreenStatus=!0}b(this,r,"f").forEach(function(t){return t(n,o)})}},S.prototype.destroy=function(){y(this,r,new Set,"f"),y(this,o,new Set,"f"),b(this,s,"f").call(this),b(this,i,"f").$destroy(),b(this,e,"f").remove(),b(this,n,"f").remove(),clearTimeout(b(this,l,"f")),clearTimeout(b(this,u,"f")),b(this,c,"f").call(this)},S.prototype.showCursor=function(){clearTimeout(b(this,u,"f")),"default"!==this.container.style.cursor&&(this.container.style.cursor="default")},S.prototype.delayHideCursor=function(t){var e=this;clearTimeout(b(this,u,"f")),y(this,u,window.setTimeout(function(){e.container.style.cursor="none"},t),"f")},S}();function M(){var t=document.createElement("div");return t.style.cssText="\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 13;\n  ",t.classList.add("web-player-controller-wrap"),t.id="web-player-controller-wrap-el",t}function F(){var t=document.createElement("div");return t.classList.add("web-player-controller-bg"),t.style.cssText="\n    display: none;\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 10;\n    height: 56px;\n    background-image: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7));\n  ",t.classList.add("web-player-controller-wrap"),t}function T(t){var e=t.onChange(function(e,n){if("fullScreenStatus"===e||"webFullScreenStatus"===e){if(n)return void t.delayHideCursor(2e3);t.showCursor()}});return function(){e()}}function W(t,e,n){var i=!1,r=function(t){var r=e.getCtrlUI().qualityPanelRef;!i||!L(n,t,!0)&&!0!==(null==r?void 0:r.contains(t.target))?(i=!i)?(e.show(),e.delayHide(2e3,function(){i=!1})):e.hide():e.delayHide(2e3,function(){i=!1})};return e.onChange(function(t,n){"dmInputFocus"===t&&(n?e.show(!0):e.hide())}),t.addEventListener("touchstart",r),function(){t.removeEventListener("touchstart",r)}}function x(t,e,n){var i=this,r=(0,C.throttle)(function(t){if(!e.getLockDisplayState()&&(e.show(),e.showCursor(),!L(n,t))){e.delayHide(2e3);var i=e.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||e.delayHideCursor(2e3)}},500),o=function(){e.getLockDisplayState()||(e.hide(),e.showCursor())},s=function(t){if(!L(n,t)){e.delayHide(2e3);var i=e.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||(e.showCursor(),e.delayHideCursor(2e3))}};t.addEventListener("mousemove",r),t.addEventListener("mouseleave",o),t.addEventListener("click",s);var a=function(t){n.contains(t.target)||w(i,void 0,Promise,function(){return v(this,function(t){return e.triggerWebFullscreen(),[2]})}).catch(function(t){C.logger.error(t)})};return t.addEventListener("dblclick",a),function(){t.removeEventListener("click",s),t.removeEventListener("mousemove",r),t.removeEventListener("mouseleave",o),t.removeEventListener("dblclick",a)}}function L(t,e,n){void 0===n&&(n=!1);var i=t.getBoundingClientRect().top-36-14-(n?52:0);return n?e.touches[0].clientY>i||t.contains(e.target):e.clientY>i||t.contains(e.target)}exports.default=E,t=new WeakMap,e=new WeakMap,n=new WeakMap,i=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap;
},{"@bilibili-live/web-player-controller":"MW6F","@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf"}],"FT5O":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"GTYV":[function(require,module,exports) {
var define;
var process = require("process");
var t,e=require("process"),n="2022-12-23 03:40:09";!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof t&&t.amd?t([],n):"object"==typeof exports?exports["sisters-player"]=n():e["sisters-player"]=n()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=137)}([function(t,e,n){var r=n(136),o=n(186);t.exports=function(t,e,n){return(e=o(e))in t?r(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var r=n(327)();t.exports=r;try{regeneratorRuntime=r}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=r:Function("r","regeneratorRuntime = r")(r)}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var r=n(136),o=n(186);function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),r(t,o(i.key),i)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),r(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(175)},function(t,e,n){t.exports=n(187)},function(t,e,n){var r=n(174);function o(t,e,n,o,i,a,s){try{var c=t[a](s),u=c.value}catch(t){return void n(t)}c.done?e(u):r.resolve(u).then(o,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new r(function(r,i){var a=t.apply(e,n);function s(t){o(a,r,i,s,c,"next",t)}function c(t){o(a,r,i,s,c,"throw",t)}s(void 0)})}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){"use strict";var r=n(15),o=n(84),i=n(101),a=n(18),s=n(85).f,c=n(145),u=n(16),l=n(43),f=n(48),h=n(25),p=function(t){var e=function(n,r,i){if(this instanceof e){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,i)}return o(t,this,arguments)};return e.prototype=t.prototype,e};t.exports=function(t,e){var n,o,d,v,g,y,x,C,m=t.target,w=t.global,k=t.stat,b=t.proto,S=w?r:k?r[m]:(r[m]||{}).prototype,P=w?u:u[m]||f(u,m,{})[m],A=P.prototype;for(d in e)n=!c(w?d:m+(k?".":"#")+d,t.forced)&&S&&h(S,d),g=P[d],n&&(y=t.dontCallGetSet?(C=s(S,d))&&C.value:S[d]),v=n&&y?y:e[d],n&&typeof g==typeof v||(x=t.bind&&n?l(v,r):t.wrap&&n?p(v):b&&a(v)?i(v):v,(t.sham||v&&v.sham||g&&g.sham)&&f(x,"sham",!0),f(P,d,x),b&&(h(u,o=m+"Prototype")||f(u,o,{}),f(u[o],d,v),t.real&&A&&!A[d]&&f(A,d,v)))}},function(t,e,n){"use strict";(function(t){n.d(e,"b",function(){return r}),n.d(e,"a",function(){return o}),n.d(e,"c",function(){return a}),n.d(e,"d",function(){return W});var r,o,i,a,s=n(40),c=n.n(s),u=n(119),l=n.n(u),f=n(120),h=n.n(f),p=n(81),d=n.n(p),v=n(82),g=n.n(v),y=n(2),x=n.n(y),C=n(3),m=n.n(C),w=n(0),k=n.n(w),b=n(32),S=n.n(b),P=n(5),A=n.n(P),E=n(29),R=n.n(E),I=n(9),T=n.n(I),D=n(14),L=n.n(D),F=n(41),O=n.n(F),U=n(26),N=n(201),M=n(11);function B(t,e){var n=void 0!==h.a&&d()(t)||t["@@iterator"];if(!n){if(g()(t)||(n=function(t,e){var n;if(t){if("string"==typeof t)return _(t,e);var r=c()(n=Object.prototype.toString.call(t)).call(n,8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?l()(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t){t[t.SERVER=0]="SERVER",t[t.P2P=1]="P2P",t[t.TYPE_COUNT=2]="TYPE_COUNT"}(r||(r={})),function(t){t[t.SEED=0]="SEED",t[t.EXCHANGE=1]="EXCHANGE",t[t.LACKED=2]="LACKED",t[t.TYPE_COUNT=3]="TYPE_COUNT"}(o||(o={})),function(t){t[t.SUCCESS=0]="SUCCESS",t[t.REPEAT_SETTINGS=1]="REPEAT_SETTINGS",t[t.UNDEFINED=2]="UNDEFINED",t[t.DATALENGTH_ERROR=3]="DATALENGTH_ERROR",t[t.NULL=4]="NULL",t[t.REVERTED_DUE_P2P=5]="REVERTED_DUE_P2P"}(i||(i={})),function(t){t[t.END_SUCCESS=0]="END_SUCCESS",t[t.END_ERROR=1]="END_ERROR",t[t.NULL=2]="NULL"}(a||(a={}));var z=function(){function e(t){x()(this,e),k()(this,"data",void 0),k()(this,"status",void 0),k()(this,"future",void 0),k()(this,"dataSourceType",void 0),k()(this,"dataRoleType",void 0),k()(this,"dataSourcePeerId",void 0),this.data=t,this.status=i.NULL,this.future=new U.b}return m()(e,[{key:"getGhostPeerId",value:function(){return this.dataSourcePeerId}},{key:"onDataResolved",value:function(t){this.future.onResolved(t)}},{key:"setData",value:function(e,n,r,o){return this.status==i.SUCCESS?i.REPEAT_SETTINGS:(void 0!==e&&e.byteLength==this.data.byteLength?(void 0!==o&&(this.dataSourcePeerId=o),this.status==i.REVERTED_DUE_P2P&&t.from(e.buffer).equals(t.from(this.data.buffer))&&(this.dataSourcePeerId=void 0),this.data.set(e),this.dataSourceType=n,this.dataRoleType=r,this.status=i.SUCCESS,this.future.setResult(this.data)):null==e?(this.status=i.UNDEFINED,this.future.setResult(void 0)):void 0!==e&&e.byteLength!==this.data.byteLength&&(this.status=i.DATALENGTH_ERROR),this.status)}},{key:"isSucceed",value:function(){return this.status==i.SUCCESS}},{key:"resetStatus",value:function(){return this.dataSourceType==r.P2P&&(this.status=i.REVERTED_DUE_P2P,!0)}}]),e}(),j=m()(function t(){x()(this,t),k()(this,"startBlockId",void 0),k()(this,"nextFinishedBlockId",void 0),k()(this,"curCount",void 0),k()(this,"maxCount",void 0),k()(this,"sliceSize",void 0),k()(this,"shareSize",void 0),k()(this,"statArray",void 0),k()(this,"roleArray",void 0),this.statArray=new Array;for(var e=0;e<r.TYPE_COUNT;++e)this.statArray[e]=0;for(this.roleArray=new Array,e=0;e<o.TYPE_COUNT;++e)this.roleArray[e]=0}),q=function(){function t(e,n,i,s){x()(this,t),k()(this,"p2pContext",void 0),k()(this,"blockCount",void 0),k()(this,"fragmentName",void 0),k()(this,"fragmentSize",void 0),k()(this,"buffer",void 0),k()(this,"fragStat",void 0),k()(this,"fragEndErrorMsg",void 0),k()(this,"trustedCrc",void 0),k()(this,"requestDownloadToSeedbox",void 0),k()(this,"blockSize",void 0),k()(this,"blocks",void 0),k()(this,"sliceProgressArray",void 0),k()(this,"blockFinishCount",void 0),k()(this,"future",void 0),k()(this,"statArray",void 0),k()(this,"roleArray",void 0),k()(this,"distances",void 0),k()(this,"shareSize",void 0),k()(this,"shareQuota",void 0),k()(this,"sliceBlockRangeRecord",{}),k()(this,"sliceIdsInCharge",void 0),k()(this,"ghostPeerIds",void 0),k()(this,"queryServerNum",void 0),k()(this,"crcErrorCallback",void 0),k()(this,"isCrcErrorToRefetch",!1),this.p2pContext=e,this.fragmentName=n,this.fragmentSize=i,this.requestDownloadToSeedbox=!0,this.trustedCrc=s,this.fragStat=a.NULL,this.blocks=new Array,this.statArray=new Array;for(var c=0;c<r.TYPE_COUNT;++c)this.statArray[c]=0;for(this.roleArray=new Array,c=0;c<o.TYPE_COUNT;++c)this.roleArray[c]=0;for(this.sliceProgressArray=new Array,c=0;c<this.p2pContext.Config.sliceCount;++c)this.sliceProgressArray[c]=new j;this.blockFinishCount=0,this.future=new U.b,this.shareSize=0,this.sliceIdsInCharge=new S.a,this.ghostPeerIds=new S.a,this.queryServerNum=0,this.initFragmentBySize(i)}return m()(t,[{key:"doOnceQueryServer",value:function(){this.queryServerNum++}},{key:"getQueryServerNum",value:function(){return this.queryServerNum}},{key:"setCrcErrorCallback",value:function(t){this.crcErrorCallback=t}},{key:"setSliceIds",value:function(t){var e=this;A()(t).call(t,function(t){e.sliceIdsInCharge.add(t)})}},{key:"getSliceIds",value:function(){return this.sliceIdsInCharge}},{key:"getStatArray",value:function(){return this.statArray}},{key:"getRoleArray",value:function(){return this.roleArray}},{key:"getDistances",value:function(){return this.distances}},{key:"getBlockCount",value:function(){return this.blockCount}},{key:"getBlockSize",value:function(){return this.blockSize}},{key:"getBlockByteRange",value:function(t){if(t<0||t>=this.blockCount)return new Array;var e=this.blockSize*t,n=Math.min(this.fragmentSize,e+this.blockSize);return new Array(e,n)}},{key:"getSliceBlockRange",value:function(t){var e=this.sliceBlockRangeRecord[t];return t<0||t>=this.p2pContext.Config.sliceCount||null==e?new Array:new Array(e.begin,e.end)}},{key:"getBlockBelongSlice",value:function(t){if(t<0||t>=this.blockCount)return-1;for(var e=0;e<this.p2pContext.Config.sliceCount;++e){var n=this.sliceBlockRangeRecord[e];if(null!=n&&t<n.end)return e}return-1}},{key:"getSliceByteRange",value:function(t){var e=this.getSliceBlockRange(t);if(2!==e.length||e[0]==e[1])return new Array(0,0);var n=this.getBlockByteRange(e[0]),r=this.getBlockByteRange(e[1]-1);return 0===n.length||0===r.length?new Array(0,0):new Array(n[0],r[1])}},{key:"getBlock",value:function(t){if(!(t<0||t>=this.blockCount||t>=this.blocks.length))return this.blocks[t]}},{key:"initFragmentBySize",value:function(t){var e;t<this.p2pContext.Config.blockSize*this.p2pContext.Config.sliceCount?(this.blockCount=this.p2pContext.Config.sliceCount,this.blockSize=Math.ceil(this.fragmentSize/this.blockCount)):(this.blockSize=this.p2pContext.Config.blockSize,this.blockCount=Math.ceil(t/this.blockSize)),this.buffer=new Uint8Array(t),this.distances=new Uint8Array(this.blockCount);for(var n=0;n<this.blockCount;++n)this.distances[n]|=127;var r,o=B(this.getSliceIds());try{for(o.s();!(r=o.n()).done;)for(var i=r.value,a=this.getSliceBlockRange(i),s=a[0];s<a[1];++s)this.distances[s]|=128}catch(t){o.e(t)}finally{o.f()}var c=this.p2pContext.Config.fragmentShareOverride;!0===this.p2pContext.Config.multiTabsShareLimitEnable&&this.p2pContext.totalSistersCount>=1&&this.p2pContext.totalSistersCount<32&&(c/=this.p2pContext.totalSistersCount),this.shareQuota=this.fragmentSize*c,this.shareQuota>this.p2pContext.Config.fragmentShareOverrideMaxBytes&&(this.shareQuota=this.p2pContext.Config.fragmentShareOverrideMaxBytes);var u=this.p2pContext.P2P.P2PDataShareQuotaController.takeShareQuota(t*this.p2pContext.Config.fragmentExtraShareRatio);this.addShareQuotaBytes(u);for(var l=0;l<this.p2pContext.Config.sliceCount;++l){var f=Math.floor(this.blockCount/this.p2pContext.Config.sliceCount*l),h=Math.floor(this.blockCount/this.p2pContext.Config.sliceCount*(l+1));this.sliceBlockRangeRecord[l]={begin:f,end:h}}for(R()(e=this.blocks).call(e,0,this.blocks.length),l=0;l<this.blockCount;++l){var p=this.getBlockByteRange(l);this.blocks.push(new z(this.buffer.subarray(p[0],p[1])))}for(l=0;l<this.p2pContext.Config.sliceCount;++l){var d=this.getSliceBlockRange(l);this.sliceProgressArray[l].curCount=0,this.sliceProgressArray[l].maxCount=d[1]-d[0],this.sliceProgressArray[l].startBlockId=d[0],this.sliceProgressArray[l].nextFinishedBlockId=d[0];var v=this.getSliceByteRange(l);this.sliceProgressArray[l].sliceSize=v[1]-v[0],this.sliceProgressArray[l].shareSize=0}}},{key:"getFragmentName",value:function(){return this.fragmentName}},{key:"getFragmentSize",value:function(){return this.fragmentSize}},{key:"getFragmentData",value:function(){return this.getFragStat()==a.END_SUCCESS?this.buffer:void 0}},{key:"getFragmentCRC32",value:function(){return this.trustedCrc}},{key:"enableUseSeedbox",value:function(t){this.requestDownloadToSeedbox=t}},{key:"isUseSeedboxEnabled",value:function(){return this.requestDownloadToSeedbox}},{key:"setNonP2PFragmentData",value:function(t,e,n){if(null!=t)for(var o=0;o<this.blockCount;o++){var i=this.getBlockByteRange(o);if(i.length>0){var a=t.subarray(i[0],i[1]);this.setBlockData(o,a,r.SERVER,e)||this.p2pContext.P2PDataCollectionStatus.addWastedDataSize(a.byteLength,M.e.CDN_REPEAT)}}else this.setFragmentData(t,n)}},{key:"setBlockData",value:function(t,e,n,r,o){var a=this.getBlock(t);if(void 0===a)return!1;if(a.isSucceed())return!1;if(a.setData(e,n,r,o)==i.SUCCESS){this.statArray[n]+=e.byteLength,this.roleArray[r]+=e.byteLength,null!=this.p2pContext.P2PDataCollectionStatus&&this.p2pContext.P2PDataCollectionStatus.addDownloadSizeRealtime(e.byteLength,n);var s,c=this.getBlockBelongSlice(t);return++this.sliceProgressArray[c].curCount,this.sliceProgressArray[c].statArray[n]+=e.byteLength,this.sliceProgressArray[c].roleArray[r]+=e.byteLength,this.isCrcErrorToRefetch&&void 0!==a.getGhostPeerId()&&(this.p2pContext.GhostPeerIds.add(a.getGhostPeerId()),null===(s=this.p2pContext.PeerSched)||void 0===s||s.closePeer(a.getGhostPeerId())),this.distances[t]&=128,++this.blockFinishCount,this.blockFinishCount===this.blockCount&&this.setFragmentData(this.buffer),!0}return!1}},{key:"isBlockFinished",value:function(t){var e=this.getBlock(t);return void 0!==e&&e.isSucceed()}},{key:"isSliceFinished",value:function(t){return this.sliceProgressArray[t].curCount===this.sliceProgressArray[t].maxCount}},{key:"getRoleRatioForSlice",value:function(t,e){if(e<0||e>=this.p2pContext.Config.sliceCount)return 0;var n=this.sliceProgressArray[e];return 0==n.sliceSize?0:n.roleArray[t]/n.sliceSize}},{key:"getSourceRatioForSlice",value:function(t,e){if(e<0||e>=this.p2pContext.Config.sliceCount)return 0;var n=this.sliceProgressArray[e];return 0==n.sliceSize?0:n.statArray[t]/n.sliceSize}},{key:"getSliceSharedRatio",value:function(t){if(t<0||t>=this.p2pContext.Config.sliceCount)return 0;var e=this.sliceProgressArray[t];if(0==e.sliceSize)return 0;var n=e.shareSize/e.sliceSize,r=this.fragmentSize*this.p2pContext.Config.fragmentShareOverride;return r>this.p2pContext.Config.fragmentShareOverrideMaxBytes&&(n=n*r/this.p2pContext.Config.fragmentShareOverrideMaxBytes),n}},{key:"onBlockFinished",value:function(t,e){var n=this.getBlock(t);return void 0!==n&&(n.onDataResolved(e),!0)}},{key:"setFragmentData",value:function(t,e){if(null==t||0!==this.buffer.byteLength&&t.byteLength!==this.buffer.byteLength){if(this.fragStat!==a.NULL)return void this.p2pContext.P2PDataCollectionStatus.addFetchError(M.b.ERROR_NO_EFFECT);for(var n=0;n<this.getBlockCount();++n){var i,s;null!==(i=this.getBlock(n))&&void 0!==i&&i.isSucceed()||null===(s=this.getBlock(n))||void 0===s||s.setData(void 0,void 0,void 0)}this.fragStat=a.END_ERROR,this.fragEndErrorMsg=e}else if(t.byteLength==this.buffer.byteLength){if(null!=this.trustedCrc&&this.p2pContext.Config.crcVerifyEnable){var c=N.a.crc32(t,this.p2pContext.Config.crc32Interval);if(c!=this.trustedCrc){var u,l,f,h;if(this.p2pContext.printExtLog(0,T()(u=T()(l="frag name: ".concat(this.fragmentName," local crc: ")).call(l,c.toString(16)," trust crc: ")).call(u,this.trustedCrc.toString(16))),this.p2pContext.Config.allowPrintLog(0)&&console.warn(T()(f=T()(h="[SistersPlayer] frag name: ".concat(this.fragmentName," local crc: ")).call(h,c.toString(16)," trust crc: ")).call(f,this.trustedCrc.toString(16))),this.statArray[r.P2P]>0){this.isCrcErrorToRefetch=!0;for(var p=0;p<this.p2pContext.Config.sliceCount;++p)if(!this.sliceIdsInCharge.has(p)){var d=this.getSliceBlockRange(p);this.statArray[r.P2P]-=this.sliceProgressArray[p].statArray[r.P2P],this.p2pContext.P2PDataCollectionStatus.addWastedDataSize(this.sliceProgressArray[p].statArray[r.P2P],M.e.ERROR_DATA),this.sliceProgressArray[p].statArray[r.P2P]=0;for(var v=d[1]-1;v>=d[0];--v)this.getBlock(v).resetStatus()&&(--this.blockFinishCount,--this.sliceProgressArray[p].curCount)}return void this.crcErrorCallback()}this.p2pContext.printExtLog(1,"frag name: ".concat(this.fragmentName," --- all from server , but crc is still error")),this.p2pContext.Config.allowPrintLog(1)&&console.warn("[SistersPlayer] frag name: ".concat(this.fragmentName," --- all from server , but crc is still error"))}}this.fragStat=a.END_SUCCESS,this.buffer.set(t)}else if(0==this.buffer.byteLength){for(this.fragmentSize=t.byteLength,this.initFragmentBySize(this.fragmentSize),p=0;p<this.blockCount;++p){var g=this.getBlockByteRange(p);this.setBlockData(p,t.subarray(g[0],g[1]),r.SERVER,o.SEED)}return}this.future.setResult(this)}},{key:"onFinished",value:function(t){this.future.onResolved(t)}},{key:"isFinished",value:function(){return this.fragStat==a.END_SUCCESS}},{key:"getFragStat",value:function(){return this.fragStat}},{key:"getFragEndErrorMsg",value:function(){return this.fragEndErrorMsg}},{key:"addShareData",value:function(t,e){var n=this.getBlockBelongSlice(t);this.sliceProgressArray[n].shareSize+=e,this.shareSize+=e}},{key:"canShare",value:function(){return this.shareSize<this.shareQuota}},{key:"addShareQuotaBytes",value:function(t){this.shareQuota+=t}},{key:"getRemainingShareQuotaBytes",value:function(){return Math.max(0,this.shareQuota-this.shareSize)}},{key:"getShareSize",value:function(){return this.shareSize}},{key:"getSharedRatio",value:function(){return 0==this.fragmentSize?0:this.shareSize/this.fragmentSize}},{key:"destroy",value:function(){this.fragStat==a.NULL&&this.setFragmentData(void 0)}}]),t}(),W=function(){function t(e){x()(this,t),k()(this,"p2pContext",void 0),k()(this,"collection",new L.a),k()(this,"queue",new Array),k()(this,"sliceIdController",void 0),this.p2pContext=e}return m()(t,[{key:"setSliceIdController",value:function(t){this.sliceIdController=t}},{key:"addFragment",value:function(t,e,n){var r=this.collection.get(t);if(void 0!==r){if(r.getFragmentSize()!==e)return;if(null!=r.getFragmentCRC32()&&null!=n&&r.getFragmentCRC32()!=n)return;return r}return r=new q(this.p2pContext,t,e,n),this.collection.set(t,r),this.queue.push(t),r}},{key:"getFragment",value:function(t){return this.collection.get(t)}},{key:"deleteFragment",value:function(t){var e,n,r=O()(e=this.queue).call(e,t);if(r>=0&&R()(n=this.queue).call(n,r,1),this.collection.has(t)){var o=this.collection.get(t);return null==o||o.destroy(),this.collection.delete(t),!0}return!1}},{key:"deleteFragmentUntil",value:function(t){for(var e,n=O()(e=this.queue).call(e,t);n>this.p2pContext.Config.fragmentCountOutdated;){var r=this.queue.shift();if(void 0!==r){var o=this.collection.get(r);void 0!==o&&(null!=this.p2pContext.P2PDataCollectionStatus&&(this.p2pContext.P2PDataCollectionStatus.addFragmentDataCollection(o),this.p2pContext.P2P.P2PDataShareQuotaController.addFragmentDataCollection(o)),void 0!==this.sliceIdController&&void 0!==o&&this.sliceIdController.addFragmentShareData(o),o.destroy()),this.collection.delete(r)}--n}}},{key:"destroy",value:function(){var t;A()(t=this.collection).call(t,function(t){t.destroy()})}}]),t}()}).call(this,n(417).Buffer)},function(t,e,n){t.exports=n(426)},function(t,e,n){t.exports=n(374)},function(t,e,n){"use strict";n.d(e,"e",function(){return r}),n.d(e,"b",function(){return o}),n.d(e,"d",function(){return i}),n.d(e,"c",function(){return b});var r,o,i,a=n(67),s=n.n(a),c=n(2),u=n.n(c),l=n(3),f=n.n(l),h=n(0),p=n.n(h),d=n(32),v=n.n(d),g=n(14),y=n.n(g),x=n(5),C=n.n(x),m=n(19),w=n.n(m),k=n(8);n.d(e,"a",function(){return k.a}),function(t){t[t.P2P_LATE=0]="P2P_LATE",t[t.ERROR_DATA=1]="ERROR_DATA",t[t.CDN_REPEAT=2]="CDN_REPEAT",t[t.TYPE_COUNT=3]="TYPE_COUNT"}(r||(r={})),function(t){t[t.ERROR_TO_RELOAD=0]="ERROR_TO_RELOAD",t[t.ERROR_NO_EFFECT=1]="ERROR_NO_EFFECT",t[t.TYPE_COUNT=2]="TYPE_COUNT"}(o||(o={})),function(t){t[t.TX_PEER=0]="TX_PEER",t[t.RX_PEER=1]="RX_PEER",t[t.LAG_PEER=2]="LAG_PEER",t[t.TX_SEEDBOX=3]="TX_SEEDBOX",t[t.RX_SEEDBOX=4]="RX_SEEDBOX",t[t.LAG_SEEDBOX=5]="LAG_SEEDBOX"}(i||(i={}));var b=function(){function t(){u()(this,t),p()(this,"statArray",new Array),p()(this,"roleArray",new Array),p()(this,"shareSize",0),p()(this,"lastestDeleteFragName","--"),p()(this,"statRealtimeArray",new Array),p()(this,"p2pSendSizeRealtime",0),p()(this,"lastestFragName","--"),p()(this,"lastestSaveRatio","0.000"),p()(this,"lastestShareRatio","0.000"),p()(this,"wastedDataArray",new Array),p()(this,"fetchRepeatFragmentNameList",new v.a),p()(this,"fetchErrorArray",new Array),p()(this,"queryServerInfo",{fragNum:0,queryNum:0,largestQPF:0,bvcServiceModule:new y.a}),p()(this,"trackerInfo",{reqSuccCount:0,reqFailCount:0,reqCostTimeMs:0,conSuccCount:0,conFailCount:0}),p()(this,"peerConnectionInfo",{conSuccCount:0,conFailCount:0,conAbortCount:0}),p()(this,"peerMessageInfo",{pmTxP:0,pmRxP:0,pmLagP:0,pmTxS:0,pmRxS:0,pmLagS:0}),this.initToEmpty()}return f()(t,[{key:"initToEmpty",value:function(){for(var t=0;t<k.b.TYPE_COUNT;++t)this.statArray[t]=0;for(this.shareSize=0,t=0;t<k.b.TYPE_COUNT;++t)this.statRealtimeArray[t]=0;for(this.p2pSendSizeRealtime=0,t=0;t<r.TYPE_COUNT;++t)this.wastedDataArray[t]=0;for(t=0;t<o.TYPE_COUNT;++t)this.fetchErrorArray[t]=0;for(t=0;t<k.a.TYPE_COUNT;++t)this.roleArray[t]=0;this.fetchRepeatFragmentNameList.clear(),this.queryServerInfo.fragNum=0,this.queryServerInfo.queryNum=0,this.queryServerInfo.largestQPF=0,this.queryServerInfo.bvcServiceModule.clear(),this.trackerInfo.reqSuccCount=0,this.trackerInfo.reqFailCount=0,this.trackerInfo.reqCostTimeMs=0,this.trackerInfo.conSuccCount=0,this.trackerInfo.conFailCount=0,this.peerConnectionInfo.conSuccCount=0,this.peerConnectionInfo.conFailCount=0,this.peerConnectionInfo.conAbortCount=0,this.peerMessageInfo={pmTxP:0,pmRxP:0,pmLagP:0,pmTxS:0,pmRxS:0,pmLagS:0}}},{key:"addPeerMessageDataCollection",value:function(t,e){switch(t){case i.TX_PEER:this.peerMessageInfo.pmTxP+=e;break;case i.RX_PEER:this.peerMessageInfo.pmRxP+=e;break;case i.LAG_PEER:this.peerMessageInfo.pmLagP+=e;break;case i.TX_SEEDBOX:this.peerMessageInfo.pmTxS+=e;break;case i.RX_SEEDBOX:this.peerMessageInfo.pmRxS+=e;break;case i.LAG_SEEDBOX:this.peerMessageInfo.pmLagS+=e}}},{key:"addFragmentDataCollection",value:function(t){var e,n,r=this;C()(e=t.getStatArray()).call(e,function(t,e){r.statArray[e]+=t}),C()(n=t.getRoleArray()).call(n,function(t,e){r.roleArray[e]+=t}),this.shareSize+=t.getShareSize(),this.lastestDeleteFragName=t.getFragmentName()}},{key:"addPeerConnectCount",value:function(t,e){t?this.peerConnectionInfo.conAbortCount++:e?this.peerConnectionInfo.conSuccCount++:this.peerConnectionInfo.conFailCount++}},{key:"getExtendReportInfo",value:function(){return{seedSize:this.roleArray[k.a.SEED],xchgSize:this.roleArray[k.a.EXCHANGE],lackSize:this.roleArray[k.a.LACKED],peerConSucc:this.peerConnectionInfo.conSuccCount,peerConAvail:this.peerConnectionInfo.conSuccCount+this.peerConnectionInfo.conFailCount,peerConTotal:this.peerConnectionInfo.conSuccCount+this.peerConnectionInfo.conFailCount+this.peerConnectionInfo.conAbortCount,pmTxP:this.peerMessageInfo.pmTxP,pmRxP:this.peerMessageInfo.pmRxP,pmLagP:this.peerMessageInfo.pmLagP,pmTxS:this.peerMessageInfo.pmTxS,pmRxS:this.peerMessageInfo.pmRxS,pmLagS:this.peerMessageInfo.pmLagS}}},{key:"addDownloadSizeDataCollection",value:function(t,e,n){this.statArray[e]+=t}},{key:"getP2PDownload",value:function(){return this.statArray[k.b.P2P]}},{key:"getServerDownload",value:function(){return this.statArray[k.b.SERVER]}},{key:"getP2PSend",value:function(){return this.shareSize}},{key:"getP2PSaveRatio",value:function(){var t=this.statArray[k.b.P2P]+this.statArray[k.b.SERVER];return 0==t?"0.000":(this.statArray[k.b.P2P]/t*100).toFixed(3)}},{key:"getP2PShareRatio",value:function(){var t=this.statArray[k.b.P2P]+this.statArray[k.b.SERVER];return 0==t?"0.000":(this.shareSize/t*100).toFixed(3)}},{key:"addDownloadSizeRealtime",value:function(t,e){this.statRealtimeArray[e]+=t}},{key:"addP2PSendSizeRealtime",value:function(t){this.p2pSendSizeRealtime+=t}},{key:"getServerSizeRealtime",value:function(){return this.statRealtimeArray[k.b.SERVER]}},{key:"getP2PSendSizeRealtime",value:function(){return this.p2pSendSizeRealtime}},{key:"getP2PDownloadSizeRealtime",value:function(){return this.statRealtimeArray[k.b.P2P]}},{key:"addLastestFragmentDataCollection",value:function(t){if(this.lastestFragName=t.getFragmentName(),0==t.getFragmentSize())this.lastestShareRatio="0.000",this.lastestSaveRatio="0.000";else{var e=t.getShareSize()/t.getFragmentSize();this.lastestShareRatio=(100*e).toFixed(3);var n=t.getStatArray()[k.b.P2P]/t.getFragmentSize();this.lastestSaveRatio=(100*n).toFixed(3)}this.queryServerInfo.fragNum++,this.queryServerInfo.queryNum+=t.getQueryServerNum(),t.getQueryServerNum()>this.queryServerInfo.largestQPF&&(this.queryServerInfo.largestQPF=t.getQueryServerNum())}},{key:"addFetchResponseHeadersCount",value:function(t){var e,n,r=null!==(e=t.get("x-service-module"))&&void 0!==e?e:"unknown",o=null!==(n=this.queryServerInfo.bvcServiceModule.get(r))&&void 0!==n?n:0;this.queryServerInfo.bvcServiceModule.set(r,o+1)}},{key:"getLastestFragmentDataCollection",value:function(){return{lastestFragName:this.lastestFragName,lastestShareRatio:this.lastestShareRatio,lastestSaveRatio:this.lastestSaveRatio}}},{key:"getLastestDeleteFragmentName",value:function(){return this.lastestDeleteFragName}},{key:"addWastedDataSize",value:function(t,e,n){this.wastedDataArray[e]+=t,void 0!==n&&e==r.CDN_REPEAT&&this.fetchRepeatFragmentNameList.add(n.fragname+" , "+w()(s()(n.sliceIds)))}},{key:"getWastedDataSize",value:function(t){return this.wastedDataArray[t]}},{key:"getFetchRepeatFragnameListInfo",value:function(){return w()(s()(this.fetchRepeatFragmentNameList))}},{key:"addFetchError",value:function(t){this.fetchErrorArray[t]++}},{key:"getFetchErrorNum",value:function(t){return this.fetchErrorArray[t]}},{key:"addTrackerConnect",value:function(t){t?this.trackerInfo.conSuccCount+=1:this.trackerInfo.conFailCount+=1}},{key:"addTrackerResponse",value:function(t,e){t?this.trackerInfo.reqSuccCount+=1:this.trackerInfo.reqFailCount+=1,this.trackerInfo.reqCostTimeMs+=e}},{key:"getTrackerInfo",value:function(){return this.trackerInfo}},{key:"getQueryServerInfo",value:function(){return this.queryServerInfo}},{key:"clearP2PDataInfo",value:function(){this.initToEmpty()}}]),t}()},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){var r=n(100),o=Function.prototype,i=o.call,a=r&&o.bind.bind(i,i);t.exports=r?a:function(t){return function(){return i.apply(t,arguments)}}},function(t,e,n){t.exports=n(365)},function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,n(141))},function(t,e){t.exports={}},function(t,e,n){var r=n(15),o=n(87),i=n(25),a=n(106),s=n(73),c=n(143),u=o("wks"),l=r.Symbol,f=l&&l.for,h=c?l:l&&l.withoutSetter||a;t.exports=function(t){if(!i(u,t)||!s&&"string"!=typeof u[t]){var e="Symbol."+t;s&&i(l,t)?u[t]=l[t]:u[t]=c&&f?f(e):h(e)}return u[t]}},function(t,e,n){var r=n(142),o=r.all;t.exports=r.IS_HTMLDDA?function(t){return"function"==typeof t||t===o}:function(t){return"function"==typeof t}},function(t,e,n){t.exports=n(372)},function(t,e,n){var r=n(16),o=n(25),i=n(114),a=n(31).f;t.exports=function(t){var e=r.Symbol||(r.Symbol={});o(e,t)||a(e,t,{value:i.f(t)})}},function(t,e,n){var r=n(13);t.exports=r({}.isPrototypeOf)},function(t,e,n){var r=n(12);t.exports=!r(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(t,e,n){var r=n(100),o=Function.prototype.call;t.exports=r?o.bind(o):function(){return o.apply(o,arguments)}},function(t,e,n){var r=n(18),o=n(142),i=o.all;t.exports=o.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:r(t)||t===i}:function(t){return"object"==typeof t?null!==t:r(t)}},function(t,e,n){var r=n(13),o=n(34),i=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return i(o(t),e)}},function(t,e,n){"use strict";n.d(e,"d",function(){return P}),n.d(e,"b",function(){return A}),n.d(e,"c",function(){return E}),n.d(e,"a",function(){return R});var r=n(67),o=n.n(r),i=n(6),a=n.n(i),s=n(2),c=n.n(s),u=n(3),l=n.n(u),f=n(0),h=n.n(f),p=n(1),d=n.n(p),v=n(14),g=n.n(v),y=n(5),x=n.n(y),C=n(4),m=n.n(C),w=n(29),k=n.n(w),b=n(9),S=n.n(b),P=function(){function t(){c()(this,t),h()(this,"notifyList",void 0),h()(this,"notifyId",0),this.notifyList=new g.a}return l()(t,[{key:"connect",value:function(t){var e=this.notifyId++;return this.notifyList.set(e,t),e}},{key:"disconnect",value:function(t){return this.notifyList.delete(t)}},{key:"call",value:function(t){var e;x()(e=this.notifyList).call(e,function(e){e(t)})}}]),t}(),A=function(){function t(){c()(this,t),h()(this,"result",void 0),h()(this,"callbacks_res",new Array)}return l()(t,[{key:"setResult",value:function(t){if(this.result=t,void 0!==this.callbacks_res){for(var e=0;e<this.callbacks_res.length;++e)this.callbacks_res[e](t);this.callbacks_res=void 0}}},{key:"onResolved",value:function(t){return void 0===this.callbacks_res?t(this.result):this.callbacks_res.push(t),this}},{key:"isResolved",value:function(){return void 0===this.callbacks_res}}]),t}(),E=function(){function t(){c()(this,t),h()(this,"waitingList_",void 0),h()(this,"isLocked_",void 0),h()(this,"mutexId_",void 0),this.waitingList_=new Array,this.isLocked_=!1,this.mutexId_=++t.maxMutexId_}return l()(t,[{key:"lock",value:function(){var t=this;return!0===this.isLocked_?new m.a(function(e){return t.waitingList_.push(e)}):(this.isLocked_=!0,m.a.resolve())}},{key:"unlock",value:function(){var t=this.waitingList_.shift();void 0!==t?t():this.isLocked_=!1}},{key:"isLocked",value:function(){return this.isLocked_}},{key:"getId",value:function(){return this.mutexId_}}]),t}();h()(E,"maxMutexId_",0);var R=function(){function t(){c()(this,t),h()(this,"notifyList",void 0),h()(this,"notifyingList",void 0),this.notifyList=new Array,this.notifyingList=new Array}var e;return l()(t,[{key:"waitUntilAsync",value:(e=a()(d.a.mark(function t(e,n){var r,o,i=this;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.unlock(),t.next=3,new m.a(function(t){return i.notifyList.push(t)});case 3:return r=t.sent,t.next=6,e.lock();case 6:if(o=n(),!0!==r&&!1!==o||this.notify(r),!0!==o){t.next=10;break}return t.abrupt("break",12);case 10:t.next=0;break;case 12:case"end":return t.stop()}},t,this)})),function(t,n){return e.apply(this,arguments)})},{key:"waitUntil",value:function(t,e){return!0===e()?m.a.resolve():this.waitUntilAsync(t,e)}},{key:"prepareNotify",value:function(){var t,e,n;k()(t=this.notifyingList).apply(t,S()(e=[this.notifyingList.length,0]).call(e,o()(this.notifyList))),k()(n=this.notifyList).call(n,0,this.notifyList.length)}},{key:"notify",value:function(t){var e=this.notifyingList.shift();void 0!==e&&e(t)}},{key:"notifyOne",value:function(){this.prepareNotify(),this.notify(!1)}},{key:"notifyAll",value:function(){this.prepareNotify(),this.notify(!0)}}]),t}()},function(t,n,r){"use strict";r.r(n),r.d(n,"PeerRole",function(){return Z}),r.d(n,"PeerExtensionData",function(){return dt}),r.d(n,"PeerRequest",function(){return gt}),r.d(n,"PeerResponse",function(){return yt}),r.d(n,"PeerMessage",function(){return xt}),r.d(n,"NyaPeer",function(){return mt});var o,i,a,s=r(6),c=r.n(s),u=r(3),l=r.n(u),f=r(2),h=r.n(f),p=r(0),d=r.n(p),v=r(1),g=r.n(v),y=r(4),x=r.n(y),C=r(10),m=r.n(C),w=r(14),k=r.n(w),b=r(32),S=r.n(b),P=r(5),A=r.n(P),E=r(29),R=r.n(E),I=r(83),T=r.n(I),D=r(204),L=r.n(D);function F(t,e,n){var r=Math.floor(n/4294967296),o=n;t.setUint32(e,r),t.setUint32(e+4,o)}function O(t,e){return 4294967296*t.getInt32(e)+t.getUint32(e+4)}var U=(void 0===e||"never"!==(null===(o=null==e?void 0:e.env)||void 0===o?void 0:o.TEXT_ENCODING))&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function N(t){for(var e=t.length,n=0,r=0;r<e;){var o=t.charCodeAt(r++);if(0!=(4294967168&o))if(0==(4294965248&o))n+=2;else{if(o>=55296&&o<=56319&&r<e){var i=t.charCodeAt(r);56320==(64512&i)&&(++r,o=((1023&o)<<10)+(1023&i)+65536)}n+=0==(4294901760&o)?3:4}else n++}return n}var M=U?new TextEncoder:void 0,B=U?void 0!==e&&"force"!==(null===(i=null==e?void 0:e.env)||void 0===i?void 0:i.TEXT_ENCODING)?200:0:4294967295,_=(null==M?void 0:M.encodeInto)?function(t,e,n){M.encodeInto(t,e.subarray(n))}:function(t,e,n){e.set(M.encode(t),n)};function z(t,e,n){for(var r=e,o=r+n,i=[],a="";r<o;){var s=t[r++];if(0==(128&s))i.push(s);else if(192==(224&s)){var c=63&t[r++];i.push((31&s)<<6|c)}else if(224==(240&s)){c=63&t[r++];var u=63&t[r++];i.push((31&s)<<12|c<<6|u)}else if(240==(248&s)){var l=(7&s)<<18|(c=63&t[r++])<<12|(u=63&t[r++])<<6|63&t[r++];l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l)}else i.push(s);i.length>=4096&&(a+=String.fromCharCode.apply(String,i),i.length=0)}return i.length>0&&(a+=String.fromCharCode.apply(String,i)),a}var j,q=U?new TextDecoder:null,W=U?void 0!==e&&"force"!==(null===(a=null==e?void 0:e.env)||void 0===a?void 0:a.TEXT_DECODER)?200:0:4294967295,V=function(t,e){this.type=t,this.data=e},G=(j=function(t,e){return(j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}j(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),H=function(t){function e(n){var r=t.call(this,n)||this,o=Object.create(e.prototype);return Object.setPrototypeOf(r,o),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name}),r}return G(e,t),e}(Error),Y={type:-1,encode:function(t){var e,n,r,o;return t instanceof Date?function(t){var e,n=t.sec,r=t.nsec;if(n>=0&&r>=0&&n<=17179869183){if(0===r&&n<=4294967295){var o=new Uint8Array(4);return(e=new DataView(o.buffer)).setUint32(0,n),o}var i=n/4294967296,a=4294967295&n;return o=new Uint8Array(8),(e=new DataView(o.buffer)).setUint32(0,r<<2|3&i),e.setUint32(4,a),o}return o=new Uint8Array(12),(e=new DataView(o.buffer)).setUint32(0,r),F(e,4,n),o}((r=1e6*((e=t.getTime())-1e3*(n=Math.floor(e/1e3))),{sec:n+(o=Math.floor(r/1e9)),nsec:r-1e9*o})):null},decode:function(t){var e=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:var n=e.getUint32(0);return{sec:4294967296*(3&n)+e.getUint32(4),nsec:n>>>2};case 12:return{sec:O(e,4),nsec:e.getUint32(0)};default:throw new H("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(t.length))}}(t);return new Date(1e3*e.sec+e.nsec/1e6)}},Q=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Y)}return t.prototype.register=function(t){var e=t.type,n=t.encode,r=t.decode;if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{var o=1+e;this.builtInEncoders[o]=n,this.builtInDecoders[o]=r}},t.prototype.tryToEncode=function(t,e){for(var n=0;n<this.builtInEncoders.length;n++)if(null!=(r=this.builtInEncoders[n])&&null!=(o=r(t,e)))return new V(-1-n,o);for(n=0;n<this.encoders.length;n++){var r,o;if(null!=(r=this.encoders[n])&&null!=(o=r(t,e)))return new V(n,o)}return t instanceof V?t:null},t.prototype.decode=function(t,e,n){var r=e<0?this.builtInDecoders[-1-e]:this.decoders[e];return r?r(t,e,n):new V(e,t)},t.defaultCodec=new t,t}();function K(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}var X=function(){function t(t,e,n,r,o,i,a,s){void 0===t&&(t=Q.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=100),void 0===r&&(r=2048),void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),this.extensionCodec=t,this.context=e,this.maxDepth=n,this.initialBufferSize=r,this.sortKeys=o,this.forceFloat32=i,this.ignoreUndefined=a,this.forceIntegerToFloat=s,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encodeSharedRef=function(t){return this.reinitializeState(),this.doEncode(t,1),this.bytes.subarray(0,this.pos)},t.prototype.encode=function(t){return this.reinitializeState(),this.doEncode(t,1),this.bytes.slice(0,this.pos)},t.prototype.doEncode=function(t,e){if(e>this.maxDepth)throw new Error("Too deep objects in depth ".concat(e));null==t?this.encodeNil():"boolean"==typeof t?this.encodeBoolean(t):"number"==typeof t?this.encodeNumber(t):"string"==typeof t?this.encodeString(t):this.encodeObject(t,e)},t.prototype.ensureBufferSizeToWrite=function(t){var e=this.pos+t;this.view.byteLength<e&&this.resizeBuffer(2*e)},t.prototype.resizeBuffer=function(t){var e=new ArrayBuffer(t),n=new Uint8Array(e),r=new DataView(e);n.set(this.bytes),this.view=r,this.bytes=n},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(t){!1===t?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(t){Number.isSafeInteger(t)&&!this.forceIntegerToFloat?t>=0?t<128?this.writeU8(t):t<256?(this.writeU8(204),this.writeU8(t)):t<65536?(this.writeU8(205),this.writeU16(t)):t<4294967296?(this.writeU8(206),this.writeU32(t)):(this.writeU8(207),this.writeU64(t)):t>=-32?this.writeU8(224|t+32):t>=-128?(this.writeU8(208),this.writeI8(t)):t>=-32768?(this.writeU8(209),this.writeI16(t)):t>=-2147483648?(this.writeU8(210),this.writeI32(t)):(this.writeU8(211),this.writeI64(t)):this.forceFloat32?(this.writeU8(202),this.writeF32(t)):(this.writeU8(203),this.writeF64(t))},t.prototype.writeStringHeader=function(t){if(t<32)this.writeU8(160+t);else if(t<256)this.writeU8(217),this.writeU8(t);else if(t<65536)this.writeU8(218),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too long string: ".concat(t," bytes in UTF-8"));this.writeU8(219),this.writeU32(t)}},t.prototype.encodeString=function(t){if(t.length>B){var e=N(t);this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),_(t,this.bytes,this.pos),this.pos+=e}else e=N(t),this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),function(t,e,n){for(var r=t.length,o=n,i=0;i<r;){var a=t.charCodeAt(i++);if(0!=(4294967168&a)){if(0==(4294965248&a))e[o++]=a>>6&31|192;else{if(a>=55296&&a<=56319&&i<r){var s=t.charCodeAt(i);56320==(64512&s)&&(++i,a=((1023&a)<<10)+(1023&s)+65536)}0==(4294901760&a)?(e[o++]=a>>12&15|224,e[o++]=a>>6&63|128):(e[o++]=a>>18&7|240,e[o++]=a>>12&63|128,e[o++]=a>>6&63|128)}e[o++]=63&a|128}else e[o++]=a}}(t,this.bytes,this.pos),this.pos+=e},t.prototype.encodeObject=function(t,e){var n=this.extensionCodec.tryToEncode(t,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(t))this.encodeArray(t,e);else if(ArrayBuffer.isView(t))this.encodeBinary(t);else{if("object"!=typeof t)throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(t)));this.encodeMap(t,e)}},t.prototype.encodeBinary=function(t){var e=t.byteLength;if(e<256)this.writeU8(196),this.writeU8(e);else if(e<65536)this.writeU8(197),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large binary: ".concat(e));this.writeU8(198),this.writeU32(e)}var n=K(t);this.writeU8a(n)},t.prototype.encodeArray=function(t,e){var n=t.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else{if(!(n<4294967296))throw new Error("Too large array: ".concat(n));this.writeU8(221),this.writeU32(n)}for(var r=0,o=t;r<o.length;r++){var i=o[r];this.doEncode(i,e+1)}},t.prototype.countWithoutUndefined=function(t,e){for(var n=0,r=0,o=e;r<o.length;r++)void 0!==t[o[r]]&&n++;return n},t.prototype.encodeMap=function(t,e){var n=Object.keys(t);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(t,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large map object: ".concat(r));this.writeU8(223),this.writeU32(r)}for(var o=0,i=n;o<i.length;o++){var a=i[o],s=t[a];this.ignoreUndefined&&void 0===s||(this.encodeString(a),this.doEncode(s,e+1))}},t.prototype.encodeExtension=function(t){var e=t.data.length;if(1===e)this.writeU8(212);else if(2===e)this.writeU8(213);else if(4===e)this.writeU8(214);else if(8===e)this.writeU8(215);else if(16===e)this.writeU8(216);else if(e<256)this.writeU8(199),this.writeU8(e);else if(e<65536)this.writeU8(200),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large extension object: ".concat(e));this.writeU8(201),this.writeU32(e)}this.writeI8(t.type),this.writeU8a(t.data)},t.prototype.writeU8=function(t){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,t),this.pos++},t.prototype.writeU8a=function(t){var e=t.length;this.ensureBufferSizeToWrite(e),this.bytes.set(t,this.pos),this.pos+=e},t.prototype.writeI8=function(t){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,t),this.pos++},t.prototype.writeU16=function(t){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,t),this.pos+=2},t.prototype.writeI16=function(t){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,t),this.pos+=2},t.prototype.writeU32=function(t){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,t),this.pos+=4},t.prototype.writeI32=function(t){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,t),this.pos+=4},t.prototype.writeF32=function(t){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,t),this.pos+=4},t.prototype.writeF64=function(t){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,t),this.pos+=8},t.prototype.writeU64=function(t){this.ensureBufferSizeToWrite(8),function(t,e,n){var r=n/4294967296,o=n;t.setUint32(e,r),t.setUint32(e+4,o)}(this.view,this.pos,t),this.pos+=8},t.prototype.writeI64=function(t){this.ensureBufferSizeToWrite(8),F(this.view,this.pos,t),this.pos+=8},t}(),$={};function J(t){return"".concat(t<0?"-":"","0x").concat(Math.abs(t).toString(16).padStart(2,"0"))}var Z,tt=function(){function t(t,e){void 0===t&&(t=16),void 0===e&&(e=16),this.maxKeyLength=t,this.maxLengthPerKey=e,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return t.prototype.canBeCached=function(t){return t>0&&t<=this.maxKeyLength},t.prototype.find=function(t,e,n){t:for(var r=0,o=this.caches[n-1];r<o.length;r++){for(var i=o[r],a=i.bytes,s=0;s<n;s++)if(a[s]!==t[e+s])continue t;return i.str}return null},t.prototype.store=function(t,e){var n=this.caches[t.length-1],r={bytes:t,str:e};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},t.prototype.decode=function(t,e,n){var r=this.find(t,e,n);if(null!=r)return this.hit++,r;this.miss++;var o=z(t,e,n),i=Uint8Array.prototype.slice.call(t,e,e+n);return this.store(i,o),o},t}(),et=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},nt=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,o){!function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}(r,o,(e=t[n](e)).done,e.value)})}}},rt=function(t){return this instanceof rt?(this.v=t,this):new rt(t)},ot=new DataView(new ArrayBuffer(0)),it=new Uint8Array(ot.buffer),at=function(){try{ot.getInt8(0)}catch(t){return t.constructor}throw new Error("never reached")}(),st=new at("Insufficient data"),ct=new tt,ut=function(){function t(t,e,n,r,o,i,a,s){void 0===t&&(t=Q.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===o&&(o=4294967295),void 0===i&&(i=4294967295),void 0===a&&(a=4294967295),void 0===s&&(s=ct),this.extensionCodec=t,this.context=e,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=o,this.maxMapLength=i,this.maxExtLength=a,this.keyDecoder=s,this.totalPos=0,this.pos=0,this.view=ot,this.bytes=it,this.headByte=-1,this.stack=[]}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1,this.stack.length=0},t.prototype.setBuffer=function(t){this.bytes=K(t),this.view=function(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=K(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}(this.bytes),this.pos=0},t.prototype.appendBuffer=function(t){if(-1!==this.headByte||this.hasRemaining(1)){var e=this.bytes.subarray(this.pos),n=K(t),r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),this.setBuffer(r)}else this.setBuffer(t)},t.prototype.hasRemaining=function(t){return this.view.byteLength-this.pos>=t},t.prototype.createExtraByteError=function(t){var e=this.view,n=this.pos;return new RangeError("Extra ".concat(e.byteLength-n," of ").concat(e.byteLength," byte(s) found at buffer[").concat(t,"]"))},t.prototype.decode=function(t){this.reinitializeState(),this.setBuffer(t);var e=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return e},t.prototype.decodeMulti=function(t){return et(this,function(e){switch(e.label){case 0:this.reinitializeState(),this.setBuffer(t),e.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return e.sent(),[3,1];case 3:return[2]}})},t.prototype.decodeAsync=function(t){var e,n,r,o;return function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})}(this,void 0,void 0,function(){var i,a,s,c,u,l,f,h;return et(this,function(p){switch(p.label){case 0:i=!1,p.label=1;case 1:p.trys.push([1,6,7,12]),e=nt(t),p.label=2;case 2:return[4,e.next()];case 3:if((n=p.sent()).done)return[3,5];if(s=n.value,i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s);try{a=this.doDecodeSync(),i=!0}catch(t){if(!(t instanceof at))throw t}this.totalPos+=this.pos,p.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return c=p.sent(),r={error:c},[3,12];case 7:return p.trys.push([7,,10,11]),n&&!n.done&&(o=e.return)?[4,o.call(e)]:[3,9];case 8:p.sent(),p.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,a]}throw l=(u=this).headByte,f=u.pos,h=u.totalPos,new RangeError("Insufficient data in parsing ".concat(J(l)," at ").concat(h," (").concat(f," in the current buffer)"))}})})},t.prototype.decodeArrayStream=function(t){return this.decodeMultiAsync(t,!0)},t.prototype.decodeStream=function(t){return this.decodeMultiAsync(t,!1)},t.prototype.decodeMultiAsync=function(t,e){return function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){o[t]&&(r[t]=function(e){return new Promise(function(n,r){i.push([t,e,n,r])>1||s(t,e)})})}function s(t,e){try{(n=o[t](e)).value instanceof rt?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(t){l(i[0][3],t)}var n}function c(t){s("next",t)}function u(t){s("throw",t)}function l(t,e){t(e),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function(){var n,r,o,i,a,s,c,u,l;return et(this,function(f){switch(f.label){case 0:n=e,r=-1,f.label=1;case 1:f.trys.push([1,13,14,19]),o=nt(t),f.label=2;case 2:return[4,rt(o.next())];case 3:if((i=f.sent()).done)return[3,12];if(a=i.value,e&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),n&&(r=this.readArraySize(),n=!1,this.complete()),f.label=4;case 4:f.trys.push([4,9,,10]),f.label=5;case 5:return[4,rt(this.doDecodeSync())];case 6:return[4,f.sent()];case 7:return f.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((s=f.sent())instanceof at))throw s;return[3,10];case 10:this.totalPos+=this.pos,f.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c=f.sent(),u={error:c},[3,19];case 14:return f.trys.push([14,,17,18]),i&&!i.done&&(l=o.return)?[4,rt(l.call(o))]:[3,16];case 15:f.sent(),f.label=16;case 16:return[3,18];case 17:if(u)throw u.error;return[7];case 18:return[7];case 19:return[2]}})})},t.prototype.doDecodeSync=function(){t:for(;;){var t=this.readHeadByte(),e=void 0;if(t>=224)e=t-256;else if(t<192)if(t<128)e=t;else if(t<144){if(0!=(r=t-128)){this.pushMapState(r),this.complete();continue t}e={}}else if(t<160){if(0!=(r=t-144)){this.pushArrayState(r),this.complete();continue t}e=[]}else{var n=t-160;e=this.decodeUtf8String(n,0)}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.readI64();else if(217===t)n=this.lookU8(),e=this.decodeUtf8String(n,1);else if(218===t)n=this.lookU16(),e=this.decodeUtf8String(n,2);else if(219===t)n=this.lookU32(),e=this.decodeUtf8String(n,4);else if(220===t){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(221===t){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(222===t){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue t}e={}}else if(223===t){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue t}e={}}else if(196===t){var r=this.lookU8();e=this.decodeBinary(r,1)}else if(197===t)r=this.lookU16(),e=this.decodeBinary(r,2);else if(198===t)r=this.lookU32(),e=this.decodeBinary(r,4);else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t)r=this.lookU8(),e=this.decodeExtension(r,1);else if(200===t)r=this.lookU16(),e=this.decodeExtension(r,2);else{if(201!==t)throw new H("Unrecognized type byte: ".concat(J(t)));r=this.lookU32(),e=this.decodeExtension(r,4)}this.complete();for(var o=this.stack;o.length>0;){var i=o[o.length-1];if(0===i.type){if(i.array[i.position]=e,i.position++,i.position!==i.size)continue t;o.pop(),e=i.array}else{if(1===i.type){if(void 0,"string"!=(a=typeof e)&&"number"!==a)throw new H("The type of key must be string or number but "+typeof e);if("__proto__"===e)throw new H("The key __proto__ is not allowed");i.key=e,i.type=2;continue t}if(i.map[i.key]=e,i.readCount++,i.readCount!==i.size){i.key=null,i.type=1;continue t}o.pop(),e=i.map}}return e}var a},t.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=-1},t.prototype.readArraySize=function(){var t=this.readHeadByte();switch(t){case 220:return this.readU16();case 221:return this.readU32();default:if(t<160)return t-144;throw new H("Unrecognized array type byte: ".concat(J(t)))}},t.prototype.pushMapState=function(t){if(t>this.maxMapLength)throw new H("Max length exceeded: map length (".concat(t,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:t,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(t){if(t>this.maxArrayLength)throw new H("Max length exceeded: array length (".concat(t,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:t,array:new Array(t),position:0})},t.prototype.decodeUtf8String=function(t,e){var n;if(t>this.maxStrLength)throw new H("Max length exceeded: UTF-8 byte length (".concat(t,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+e+t)throw st;var r,o=this.pos+e;return r=this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(t))?this.keyDecoder.decode(this.bytes,o,t):t>W?function(t,e,n){var r=t.subarray(e,e+n);return q.decode(r)}(this.bytes,o,t):z(this.bytes,o,t),this.pos+=e+t,r},t.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},t.prototype.decodeBinary=function(t,e){if(t>this.maxBinLength)throw new H("Max length exceeded: bin length (".concat(t,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(t+e))throw st;var n=this.pos+e,r=this.bytes.subarray(n,n+t);return this.pos+=e+t,r},t.prototype.decodeExtension=function(t,e){if(t>this.maxExtLength)throw new H("Max length exceeded: ext length (".concat(t,") > maxExtLength (").concat(this.maxExtLength,")"));var n=this.view.getInt8(this.pos+e),r=this.decodeBinary(t,e+1);return this.extensionCodec.decode(r,n,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var t=this.view.getUint8(this.pos);return this.pos++,t},t.prototype.readI8=function(){var t=this.view.getInt8(this.pos);return this.pos++,t},t.prototype.readU16=function(){var t=this.view.getUint16(this.pos);return this.pos+=2,t},t.prototype.readI16=function(){var t=this.view.getInt16(this.pos);return this.pos+=2,t},t.prototype.readU32=function(){var t=this.view.getUint32(this.pos);return this.pos+=4,t},t.prototype.readI32=function(){var t=this.view.getInt32(this.pos);return this.pos+=4,t},t.prototype.readU64=function(){var t,e,n=(t=this.view,e=this.pos,4294967296*t.getUint32(e)+t.getUint32(e+4));return this.pos+=8,n},t.prototype.readI64=function(){var t=O(this.view,this.pos);return this.pos+=8,t},t.prototype.readF32=function(){var t=this.view.getFloat32(this.pos);return this.pos+=4,t},t.prototype.readF64=function(){var t=this.view.getFloat64(this.pos);return this.pos+=8,t},t}(),lt={},ft=r(26),ht=r(11),pt=r(121);!function(t){t[t.Peer=0]="Peer",t[t.Leech=1]="Leech",t[t.Seedbox=2]="Seedbox"}(Z||(Z={}));var dt=l()(function t(){h()(this,t),d()(this,"peerId",""),d()(this,"isDownloadBlockReport",!1),d()(this,"isAnswerAccepted",!1),d()(this,"candidate_resolver",void 0)}),vt=l()(function t(e){var n=this;h()(this,t),d()(this,"buf",void 0),d()(this,"promise",void 0),d()(this,"resolver",void 0),this.buf=e,this.promise=new x.a(function(t){n.resolver=t})}),gt=l()(function t(){h()(this,t),d()(this,"action",""),d()(this,"data",void 0)}),yt=l()(function t(){h()(this,t),d()(this,"requestId",-1),d()(this,"status","not_implemented"),d()(this,"data",void 0)}),xt=l()(function t(){h()(this,t),d()(this,"type",""),d()(this,"requestId",-1),d()(this,"action_type",""),d()(this,"action",""),d()(this,"data",void 0)}),Ct=function(){function t(e,n){var r=this;h()(this,t),d()(this,"p2pContext",void 0),d()(this,"dc",void 0),d()(this,"sendQueue",new Array),d()(this,"isSending",!1),this.p2pContext=e,this.dc=n,this.dc.binaryType="arraybuffer",this.dc.bufferedAmountLowThreshold=262144,this.dc.onbufferedamountlow=function(){return r.onDCWritable()}}return l()(t,[{key:"onDCWritable",value:function(){var t=this;this.isSending=!0;for(var e,n,r=this.dc.bufferedAmount;r<1048576;){var o,i=this.sendQueue.shift();if(void 0===i){this.isSending=!1;break}void 0!==i.buf.data&&null!==i.buf.data&&void 0!==i.buf.data.length&&i.buf.data.length>1024||(this.p2pContext.printExtLog(6,"send: "+i.buf),this.p2pContext.Config.allowPrintLog(6)&&console.log("send: "+i.buf));try{if("open"===this.dc.readyState){var a=(e=i.buf,void 0===(n=void 0)&&(n=$),new X(n.extensionCodec,n.context,n.maxDepth,n.initialBufferSize,n.sortKeys,n.forceFloat32,n.ignoreUndefined,n.forceIntegerToFloat).encodeSharedRef(e));this.dc.send(a),r+=a.length}}catch(t){this.p2pContext.printExtLog(0,"One sister forcibly disconnected from the Misaka Network. QwQ"),this.p2pContext.Config.allowPrintLog(0)&&console.info("[SistersPlayer] One sister forcibly disconnected from the Misaka Network. QwQ")}null===(o=i.resolver)||void 0===o||o.call(i)}this.sendQueue.length>0&&r>1048576&&this.dc.bufferedAmount<this.dc.bufferedAmountLowThreshold&&m()(function(){return t.onDCWritable()},0)}},{key:"dataChannel",value:function(){return this.dc}},{key:"send",value:function(t){var e=new vt(t);return this.sendQueue.push(e),!1===this.isSending&&this.onDCWritable(),e.promise}}]),t}(),mt=function(){function t(e,n,r){var o,i=this;h()(this,t),d()(this,"p2pContext",void 0),d()(this,"peerSched",void 0),d()(this,"incoming",void 0),d()(this,"pc",void 0),d()(this,"dc",void 0),d()(this,"requestId",0),d()(this,"pendingRequests",new k.a),d()(this,"dc_resolver",void 0),d()(this,"dc_future",void 0),d()(this,"extData",new dt),d()(this,"onCandidate",void 0),d()(this,"candidates",new Array),d()(this,"role_",Z.Peer),d()(this,"seedSliceIds_",new S.a),d()(this,"seedScore",100),d()(this,"natType","non-sym"),this.p2pContext=e,this.incoming=r,this.peerSched=n;var a=[];if(A()(o=this.p2pContext.Config.stunServers).call(o,function(t){var e={urls:t};a.push(e)}),this.pc=new RTCPeerConnection({iceServers:a,iceCandidatePoolSize:this.p2pContext.Config.iceCandidatePoolSize,iceTransportPolicy:"all"}),!this.pc)throw"Emtpy RTCPeerConnection object after creating.";this.pc.addEventListener("datachannel",function(t){"misaka-denpa"===t.channel.label&&(i.dc=new Ct(i.p2pContext,t.channel),i.dc.dataChannel().onmessage=function(t){return i.onMessageReceived(t.data)},void 0!==i.dc_resolver&&i.dc_resolver())}),this.pc.addEventListener("icegatheringstatechange",function(t){switch(i.p2pContext.printExtLog(4,"peer "+i.extData.peerId+" icegatheringstatechange state: "+i.pc.iceGatheringState),i.p2pContext.Config.allowPrintLog(4)&&console.log("peer "+i.extData.peerId+" icegatheringstatechange state: "+i.pc.iceGatheringState),i.pc.iceGatheringState){case"new":case"gathering":break;case"complete":i.extData.candidate_resolver&&i.extData.candidate_resolver(!0)}}),this.pc.addEventListener("iceconnectionstatechange",function(t){switch(i.p2pContext.printExtLog(4,"peer "+i.extData.peerId+" iceconnection state: "+i.pc.iceConnectionState),i.p2pContext.Config.allowPrintLog(4)&&console.log("peer "+i.extData.peerId+" iceconnection state: "+i.pc.iceConnectionState),i.pc.iceConnectionState){case"new":case"checking":case"connected":case"completed":break;case"disconnected":i.peerSched.onPeerDisConnected(i);break;case"failed":i.peerSched.onPeerConnectComplete(i,!1);break;case"closed":i.peerSched.onPeerDisConnected(i)}}),this.pc.addEventListener("signalingstatechange",function(t){i.p2pContext.printExtLog(4,"peer "+i.extData.peerId+" signaling state: "+i.pc.iceConnectionState),i.p2pContext.Config.allowPrintLog(4)&&console.log("peer "+i.extData.peerId+" signaling state: "+i.pc.iceConnectionState),i.pc.signalingState}),this.pc.addEventListener("icecandidate",function(t){null!=t.candidate&&i.onCandidate(t.candidate)}),this.onCandidate=function(t){null!=t&&null!=t.candidate&&""!=t.candidate&&i.candidates.push(t)}}var e,n,r,o,i,a,s;return l()(t,[{key:"peerRole",get:function(){return this.role_}},{key:"seedSliceIds",get:function(){return this.seedSliceIds_}},{key:"close",value:function(){var t,e,n;0==this.extData.isDownloadBlockReport&&(1==this.extData.isAnswerAccepted?null===(e=this.p2pContext.PeerSched)||void 0===e||e.reportDownloadBlockAwaysFail(this):null===(n=this.p2pContext.PeerSched)||void 0===n||n.reportConnectionAbort(this)),null===(t=this.dc)||void 0===t||t.dataChannel().close(),"closed"!=this.pc.signalingState&&this.pc.close()}},{key:"isIncoming",value:function(){return this.incoming}},{key:"setCandidateCallback",value:function(t){var e=this;new x.a(function(t){return t(e.candidates)}).then(function(e){A()(e).call(e,function(e){return t(e)})}),this.onCandidate=t,this.candidates=new Array}},{key:"createNyaOffer",value:(s=c()(g.a.mark(function t(e){var n,r=this;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.dc=new Ct(this.p2pContext,this.pc.createDataChannel("misaka-denpa",{ordered:!1,negotiated:!1,maxPacketLifeTime:this.p2pContext.Config.peerPacketLifeTime})),this.dc_future=x.a.resolve(),this.dc.dataChannel().onmessage=function(t){return r.onMessageReceived(t.data)},t.next=5,this.pc.createOffer({iceRestart:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1});case 5:return n=t.sent,this.pc.setLocalDescription(n),t.abrupt("return",this.waitForCandidate(e,n));case 8:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"answerNyaOffer",value:(a=c()(g.a.mark(function t(e,n){var r,o=this;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.dc_future=new x.a(function(t){return o.dc_resolver=t}),t.next=3,this.pc.setRemoteDescription(e);case 3:return t.next=5,this.pc.createAnswer({iceRestart:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1});case 5:return r=t.sent,this.pc.setLocalDescription(r),t.abrupt("return",this.waitForCandidate(n,r));case 8:case"end":return t.stop()}},t,this)})),function(t,e){return a.apply(this,arguments)})},{key:"waitForCandidate",value:(i=c()(g.a.mark(function t(e,n){var r,o,i,a,s=this;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new x.a(function(t){return s.extData.candidate_resolver=t}),t.next=3,x.a.race(new Array(new x.a(function(t){return o=m()(function(){return t(!0)},s.p2pContext.Config.candidateWaitMaxTimeMs)}),r));case 3:clearTimeout(o),i=void 0;try{i=this.pc.localDescription}catch(t){this.p2pContext.Config.allowPrintLog(3)&&console.log("localDescription get erreo: ",t)}return null==i?i=new RTCSessionDescription(n):R()(a=this.candidates).call(a,0,this.candidates.length),this.setCandidateCallback(e),t.abrupt("return",i);case 9:case"end":return t.stop()}},t,this)})),function(t,e){return i.apply(this,arguments)})},{key:"acceptNyaAnswer",value:(o=c()(g.a.mark(function t(e){var n=this;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.pc.setRemoteDescription(e).catch(function(t){n.p2pContext.printExtLog(2,"accept answer failed: "+t.message),n.p2pContext.Config.allowPrintLog(2)&&console.warn("accept answer failed: "+t.message),n.extData.isAnswerAccepted=!1}),this.extData.isAnswerAccepted=!0,t.next=4,this.waitForConnected();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"addRemoteCandidate",value:(r=c()(g.a.mark(function t(e){return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.pc.addIceCandidate(e);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return");case 9:case"end":return t.stop()}},t,this,[[0,6]])})),function(t){return r.apply(this,arguments)})},{key:"waitForConnected",value:(n=c()(g.a.mark(function t(){var e,n,r,o,i,a=this;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=new ft.b,void 0===this.dc_future){t.next=6;break}return n=void 0,t.next=5,x.a.race([this.dc_future,new x.a(function(t){n=m()(t,a.p2pContext.Config.peerConnectionTimeoutMs)})]);case 5:void 0!==n&&clearTimeout(n);case 6:if(void 0!==this.dc){t.next=8;break}return t.abrupt("return",!1);case 8:if(r=void 0,"open"!==this.dc.dataChannel().readyState&&(r=new x.a(function(t){if(void 0!==a.dc){a.dc.dataChannel().onopen=function(e){return t(!0)},a.dc.dataChannel().onerror=function(e){return t(!1)};var n=function(e){"failed"===a.pc.iceConnectionState&&(a.p2pContext.printExtLog(2,"ice connection state failed when wait for connected."),a.p2pContext.Config.allowPrintLog(2)&&console.log("ice connection state failed when wait for connected."),t(!1))};a.pc.addEventListener("iceconnectionstatechange",n),e.onResolved(function(){return a.pc.removeEventListener("iceconnectionstatechange",n)})}})),o=!1,void 0===r){t.next=24;break}if(!(this.p2pContext.Config.peerConnectionTimeoutMs>0)){t.next=19;break}return t.next=15,x.a.race(new Array(r,new x.a(function(t){i=m()(function(){return t(!1)},a.p2pContext.Config.peerConnectionTimeoutMs)})));case 15:o=t.sent,clearTimeout(i),t.next=22;break;case 19:return t.next=21,r;case 21:o=t.sent;case 22:t.next=25;break;case 24:o=!0;case 25:return!0===o&&(this.dc.dataChannel().onclose=function(t){return a.peerSched.onPeerDisConnected(a)}),e.setResult(1),t.abrupt("return",o);case 28:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"sendRequestMessage",value:function(t){return this.sendMessage(function(){var e=t();if(void 0!==e)return{type:"request",requestId:-1,action_type:"action",action:e.action,data:e.data}})}},{key:"sendResponseMessage",value:function(t){return this.sendMessage(function(){var e=t();if(void 0!==e)return{type:"response",requestId:e.requestId,action_type:"status",action:e.status,data:e.data}})}},{key:"sendMessage",value:(e=c()(g.a.mark(function t(e){var n,r,o,i,a,s,c,u=this;return g.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("open"!=(null===(n=this.dc)||void 0===n?void 0:n.dataChannel().readyState)){t.next=16;break}if(void 0!==(r=e())){t.next=4;break}return t.abrupt("return",void 0);case 4:return o=r.requestId<0,r.requestId<0&&(++this.requestId,r.requestId=this.requestId),(i={type:r.type,requestId:r.requestId,data:r.data})[r.action_type]=r.action,a=this.pendingRequests,s=this.dc,t.next=12,new x.a(function(t){if(o){a.has(i.requestId)&&console.log("duplicated request id!");var e=void 0;u.p2pContext.Config.peerTimeoutMs>0&&(e=m()(function(){a.delete(i.requestId),t(!1)},u.p2pContext.Config.peerTimeoutMs)),void 0!==e?a.set(i.requestId,function(n){clearTimeout(e),t(n)}):a.set(i.requestId,t)}else t(!0);null==s||s.send(i)});case 12:return c=t.sent,t.abrupt("return",c);case 16:return t.abrupt("return",void 0);case 17:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"terminateAllPendingRequests",value:function(){var t;A()(t=this.pendingRequests).call(t,function(t,e){t(void 0)}),this.pendingRequests.clear()}},{key:"onMessageReceived",value:function(t){try{var e=(n=t,void 0===r&&(r=lt),new ut(r.extensionCodec,r.context,r.maxStrLength,r.maxBinLength,r.maxArrayLength,r.maxMapLength,r.maxExtLength).decode(n));null!==e.data&&void 0!==e.data&&void 0!==e.data.length&&e.data.length>1024||(this.p2pContext.printExtLog(6,this.extData.peerId+" recv: "+e),this.p2pContext.Config.allowPrintLog(6)&&console.log(this.extData.peerId+" recv: ",e)),"response"==e.type&&T()(e.requestId)&&e.requestId>0?this.dispatchResponse(e):"request"==e.type&&T()(e.requestId)&&this.peerSched.onPeerRequestMessage(this,e)}catch(t){void 0!==e&&this.p2pContext.P2PDataCollectionStatus.addWastedDataSize(e.byteLength,ht.e.ERROR_DATA),this.p2pContext.GhostPeerIds.add(this.extData.peerId),this.close(),console.log(t)}var n,r}},{key:"dispatchResponse",value:function(t){var e,n=this.pendingRequests.get(t.requestId);void 0!==n?(this.pendingRequests.delete(t.requestId),n(t)):"ok"===t.status&&void 0!==(null===(e=t.data)||void 0===e?void 0:e.length)&&(this.p2pContext.printExtLog(4,"no request for received response "+t.data.byteLength),this.p2pContext.Config.allowPrintLog(4)&&console.log("no request for received response "+t.data.byteLength),this.peerSched.getP2PContext().P2PDataCollectionStatus.addWastedDataSize(t.data.byteLength,ht.e.P2P_LATE))}},{key:"parsePeerRole",value:function(t){var e;null!=t&&("leech"!==t.type?"seed"===t.type&&t.sliceProvider instanceof Array&&L()(e=t.sliceProvider).call(e,function(t,e){return t&&"number"==typeof e},!0)&&(this.role_=Z.Seedbox,this.seedSliceIds_=new S.a(t.sliceProvider)):this.role_=Z.Leech)}},{key:"onDownloadBlockFailed",value:function(){this.peerRole==Z.Seedbox&&(this.seedScore-=this.p2pContext.Config.seedScoreDown,this.seedScore<=0&&this.close())}},{key:"onDownloadBlockSucceed",value:function(){this.peerRole==Z.Seedbox&&this.seedScore<this.p2pContext.Config.seedBoxScoreMax&&(this.seedScore+=this.p2pContext.Config.seedScoreUp)}},{key:"shouldUsedAsSeed",value:function(){return Object(pt.b)(100)<this.seedScore}}]),t}()},function(t,e,n){var r=n(16);t.exports=function(t){return r[t+"Prototype"]}},function(t,e,n){t.exports=n(421)},function(t,e,n){var r=n(16),o=n(15),i=n(18),a=function(t){return i(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?a(r[t])||a(o[t]):r[t]&&r[t][e]||o[t]&&o[t][e]}},function(t,e,n){var r=n(22),o=n(144),i=n(146),a=n(35),s=n(104),c=TypeError,u=Object.defineProperty,l=Object.getOwnPropertyDescriptor;e.f=r?i?function(t,e,n){if(a(t),e=s(e),a(n),"function"==typeof t&&"prototype"===e&&"value"in n&&"writable"in n&&!n.writable){var r=l(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:"configurable"in n?n.configurable:r.configurable,enumerable:"enumerable"in n?n.enumerable:r.enumerable,writable:!1})}return u(t,e,n)}:u:function(t,e,n){if(a(t),e=s(e),a(n),o)try{return u(t,e,n)}catch(t){}if("get"in n||"set"in n)throw c("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){t.exports=n(388)},function(t,e,n){var r=n(107),o=n(313);function i(e){return t.exports=i="function"==typeof r&&"symbol"==typeof o?function(t){return typeof t}:function(t){return t&&"function"==typeof r&&t.constructor===r&&t!==r.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,i(e)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var r=n(72),o=Object;t.exports=function(t){return o(r(t))}},function(t,e,n){var r=n(24),o=String,i=TypeError;t.exports=function(t){if(r(t))return t;throw i(o(t)+" is not an object")}},function(t,e,n){var r=n(149);t.exports=function(t){return r(t.length)}},function(t,e,n){var r=n(59),o=String;t.exports=function(t){if("Symbol"===r(t))throw TypeError("Cannot convert a Symbol value to a string");return o(t)}},function(t,e,n){var r=n(18),o=n(75),i=TypeError;t.exports=function(t){if(r(t))return t;throw i(o(t)+" is not a function")}},function(t,e){t.exports=!0},function(t,e,n){t.exports=n(166)},function(t,e,n){t.exports=n(377)},function(t,e,n){"use strict";n.r(e),n.d(e,"Configuration",function(){return u});var r=n(2),o=n.n(r),i=n(3),a=n.n(i),s=n(0),c=n.n(s),u=function(){function t(){o()(this,t),c()(this,"trackerServers",["wss://tracker.chat.bilibili.com/"]),c()(this,"stunServers",["stun:stun6.chat.bilibili.com:3478","stun:stun.chat.bilibili.com:3478"]),c()(this,"natCheckStunServers",[]),c()(this,"natFilteringCheckServers",[]),c()(this,"allowedChangeBooleanValues",["p2pTransferSecondhandDataEnable","multiTabsShareLimitEnable","useSeedBox","enableReverseOrder","enableHideOwner"]),c()(this,"nonP2PFragmentCountAllowedRange",[0,8]),c()(this,"nonP2PFragmentCount",4),c()(this,"p2pBufferLengthSecAllowedRange",[0,8]),c()(this,"p2pBufferLengthSec",2.5),c()(this,"iceCandidatePoolSizeAllowedRange",[0,10]),c()(this,"iceCandidatePoolSize",10),c()(this,"serverTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"serverTimeoutMs",3e3),c()(this,"peerConnectionTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"peerConnectionTimeoutMs",5e3),c()(this,"peerTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"peerTimeoutMs",3e3),c()(this,"uploadMaxWaitTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"uploadMaxWaitTimeoutMs",2700),c()(this,"peerPacketLifetimeAllowedRange",[1e3,1e4]),c()(this,"peerPacketLifeTime",2500),c()(this,"refreshPeerProgressIntervalMsAllowedRange",[100,1e3]),c()(this,"refreshPeerProgressIntervalMs",200),c()(this,"sliceCount",4),c()(this,"blockSize",61440),c()(this,"inConnectingLimitAllowedRange",[1,64]),c()(this,"inConnectingLimit",8),c()(this,"outConnectingLimitAllowedRange",[1,64]),c()(this,"outConnectingLimit",8),c()(this,"connectedLimitAllowedRange",[0,64]),c()(this,"connectedLimit",12),c()(this,"leechConnectNumAllowedRange",[0,64]),c()(this,"leechConnectNum",4),c()(this,"seedboxConnectNumBySliceIdAllowedRange",[0,64]),c()(this,"seedboxConnectNumBySliceId",1),c()(this,"revisibleMarkAllowedRange",[1,64]),c()(this,"revisibleMark",8),c()(this,"reconnectWaitTimeSecAllowedRange",[1,120]),c()(this,"reconnectWaitTimeSec",10),c()(this,"fragmentCountOutdatedAllowedRange",[2,120]),c()(this,"fragmentCountOutdated",8),c()(this,"fragmentShareOverrideAllowedRange",[0,100]),c()(this,"fragmentShareOverride",1),c()(this,"fragmentShareOverrideMaxBytesAllowedRange",[0,1e7]),c()(this,"fragmentShareOverrideMaxBytes",125e4),c()(this,"fragmentExtraShareRatioAllowedRange",[0,50]),c()(this,"fragmentExtraShareRatio",this.fragmentShareOverride/2),c()(this,"totalDownloadInstancesAllowedRange",[2,48]),c()(this,"totalDownloadInstances",1.5*this.connectedLimit),c()(this,"minDownloadInstancesPerPeer",1),c()(this,"maxDownloadInstancesPerPeerAllowedRange",[1,32]),c()(this,"maxDownloadInstancesPerPeer",4),c()(this,"cdnFetchInstancesAllowedRange",[1,32]),c()(this,"cdnFetchInstances",2),c()(this,"fallbackCDNFetchInstancesAllowedRange",[1,64]),c()(this,"fallbackCDNFetchInstances",4),c()(this,"fetchCDNTimeoutMsAllowedRange",[500,6e4]),c()(this,"fetchCDNTimeoutMs",7e3),c()(this,"crcVerifyEnable",!0),c()(this,"crc32Interval",1),c()(this,"developmentLogLevel",2),c()(this,"productionLogLevel",0),c()(this,"developmentExtLogLevel",2),c()(this,"productionExtLogLevel",1),c()(this,"p2pSafeBufferDurationForDelayStopMsAllowedRange",[0,15e3]),c()(this,"p2pSafeBufferDurationForDelayStopMs",2e3),c()(this,"p2pDelayStopMaxMsAllowedRange",[0,15e3]),c()(this,"p2pDelayStopMaxMs",1e3),c()(this,"p2pFetchDataObCycleCountAllowedRange",[1,32]),c()(this,"p2pFetchDataObCycleCount",4),c()(this,"p2pShareDataObCycleCountAllowedRange",[1,32]),c()(this,"p2pShareDataObCycleCount",3),c()(this,"p2pSliceIdControlFetchCheckIntervalMsAllowedRange",[2e3,3e4]),c()(this,"p2pSliceIdControlFetchCheckIntervalMs",4e3),c()(this,"p2pSliceIdControlShareCheckIntervalMsAllowedRange",[2e3,3e4]),c()(this,"p2pSliceIdControlShareCheckIntervalMs",3e3),c()(this,"p2pFetchLowestRatioAllowedRange",[.2,1]),c()(this,"p2pFetchLowestRatio",.6),c()(this,"p2pShareLargestAllowedFetchRatioAllowedRange",[.2,1]),c()(this,"p2pShareLargestAllowedFetchRatio",.8),c()(this,"p2pShareLowestRatioAllowedRange",[.2,1]),c()(this,"p2pShareLowestRatio",.6),c()(this,"p2pAddSliceProbabilityAllowedRange",[0,1]),c()(this,"p2pAddSliceProbability",.25),c()(this,"p2pDeleteSliceProbabilityAllowedRange",[0,1]),c()(this,"p2pDeleteSliceProbability",.33),c()(this,"reportPeerSuccessProbabilityAllowedRange",[0,1]),c()(this,"reportPeerSuccessProbability",1),c()(this,"reportPeerFailedProbabilityAllowedRange",[0,1]),c()(this,"reportPeerFailedProbability",.05),c()(this,"trackerStatusReportProbabilityAllowedRange",[0,1]),c()(this,"trackerStatusReportProbability",.01),c()(this,"p2pTransferSecondhandDataEnable",!0),c()(this,"multiTabsShareLimitEnable",!0),c()(this,"useSeedBox",!0),c()(this,"seedScoreUpAllowedRange",[1,20]),c()(this,"seedScoreUp",1),c()(this,"seedScoreDownAllowedRange",[1,50]),c()(this,"seedScoreDown",12),c()(this,"seedBoxScoreMaxAllowedRange",[100,1e3]),c()(this,"seedBoxScoreMax",200),c()(this,"multiCheckBasicNatMinCountAllowedRange",[1,16]),c()(this,"multiCheckBasicNatMinCount",3),c()(this,"checkBasicNatTimeoutMsAllowedRange",[0,3e4]),c()(this,"checkBasicNatTimeoutMs",2e3),c()(this,"natDowngradeLimitAllowedRange",[1,32]),c()(this,"natDowngradeLimit",5),c()(this,"natFilteringCheckPortAllowedRange",[0,65535]),c()(this,"natFilteringCheckPort",53007),c()(this,"natFilteringCheckAltPortAllowedRange",[0,65535]),c()(this,"natFilteringCheckAltPort",53017),c()(this,"natFilteringCheckTimeoutMsAllowedRange",[0,3e4]),c()(this,"natFilteringCheckTimeoutMs",2e3),c()(this,"natKakushinTimeoutMsAllowedRange",[0,6048e5]),c()(this,"natKakushinTimeoutMs",9e5),c()(this,"getPeersIntervalMsAllowedRange",[0,36e5]),c()(this,"getPeersIntervalMs",1e4),c()(this,"candidateWaitMaxTimeMsAllowedRange",[0,3e4]),c()(this,"candidateWaitMaxTimeMs",150),c()(this,"maxDistanceAllowedRange",[0,16]),c()(this,"maxDistance",1),c()(this,"enableReverseOrder",!1),c()(this,"enableHideOwner",!0)}return a()(t,[{key:"allowPrintLog",value:function(e){return"development"===t.curNodeEnv?e<=this.developmentLogLevel:e<=this.productionLogLevel}},{key:"allowPrintExtLog",value:function(e){return"development"===t.curNodeEnv?e<=this.developmentExtLogLevel:e<=this.productionExtLogLevel}}]),t}();c()(u,"curNodeEnv","production"),c()(u,"ProtocolVersion",10),c()(u,"failbackFetchCDNTimeoutMs",7e3)},function(t,e,n){var r=n(101),o=n(38),i=n(100),a=r(r.bind);t.exports=function(t,e){return o(t),void 0===e?t:i?a(t,e):function(){return t.apply(e,arguments)}}},function(t,e,n){var r=n(48);t.exports=function(t,e,n,o){return o&&o.enumerable?t[e]=n:r(t,e,n),t}},function(t,e,n){t.exports=n(429)},function(t,e,n){var r=n(103),o=n(72);t.exports=function(t){return r(o(t))}},function(t,e,n){t.exports=n(458)},function(t,e,n){var r=n(22),o=n(31),i=n(56);t.exports=r?function(t,e,n){return o.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var r=n(128),o=n(31).f,i=n(48),a=n(25),s=n(225),c=n(17)("toStringTag");t.exports=function(t,e,n,u){if(t){var l=n?t:t.prototype;a(l,c)||o(l,c,{configurable:!0,value:e}),u&&!r&&i(l,"toString",s)}}},function(t,e,n){n(51);var r=n(247),o=n(15),i=n(59),a=n(48),s=n(78),c=n(17)("toStringTag");for(var u in r){var l=o[u],f=l&&l.prototype;f&&i(f)!==c&&a(f,c,u),s[u]=s.Array}},function(t,e,n){"use strict";var r=n(46),o=n(132),i=n(78),a=n(60),s=n(31).f,c=n(133),u=n(134),l=n(39),f=n(22),h=a.set,p=a.getterFor("Array Iterator");t.exports=c(Array,"Array",function(t,e){h(this,{type:"Array Iterator",target:r(t),index:0,kind:e})},function(){var t=p(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,u(void 0,!0)):u("keys"==n?r:"values"==n?e[r]:[r,e[r]],!1)},"values");var d=i.Arguments=i.Array;if(o("keys"),o("values"),o("entries"),!l&&f&&"values"!==d.name)try{s(d,"name",{value:"values"})}catch(t){}},function(t,e,n){t.exports=n(392)},function(t,e,n){t.exports=n(414)},function(t,e,n){t.exports=n(381)},function(t,e,n){var r=n(13),o=r({}.toString),i=r("".slice);t.exports=function(t){return i(o(t),8,-1)}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var r=n(30);t.exports=r("navigator","userAgent")||""},function(t,e,n){var r=n(55);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,e,n){var r=n(128),o=n(18),i=n(55),a=n(17)("toStringTag"),s=Object,c="Arguments"==i(function(){return arguments}());t.exports=r?i:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=s(t),a))?n:c?i(e):"Object"==(r=i(e))&&o(e.callee)?"Arguments":r}},function(t,e,n){var r,o,i,a=n(226),s=n(15),c=n(24),u=n(48),l=n(25),f=n(125),h=n(111),p=n(90),d=s.TypeError,v=s.WeakMap;if(a||f.state){var g=f.state||(f.state=new v);g.get=g.get,g.has=g.has,g.set=g.set,r=function(t,e){if(g.has(t))throw d("Object already initialized");return e.facade=t,g.set(t,e),e},o=function(t){return g.get(t)||{}},i=function(t){return g.has(t)}}else{var y=h("state");p[y]=!0,r=function(t,e){if(l(t,y))throw d("Object already initialized");return e.facade=t,u(t,y,e),e},o=function(t){return l(t,y)?t[y]:{}},i=function(t){return l(t,y)}}t.exports={set:r,get:o,has:i,enforce:function(t){return i(t)?o(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!c(e)||(n=o(e)).type!==t)throw d("Incompatible receiver, "+t+" required");return n}}}},function(t,e,n){var r=n(43),o=n(23),i=n(35),a=n(75),s=n(171),c=n(36),u=n(21),l=n(135),f=n(92),h=n(170),p=TypeError,d=function(t,e){this.stopped=t,this.result=e},v=d.prototype;t.exports=function(t,e,n){var g,y,x,C,m,w,k,b=n&&n.that,S=!(!n||!n.AS_ENTRIES),P=!(!n||!n.IS_RECORD),A=!(!n||!n.IS_ITERATOR),E=!(!n||!n.INTERRUPTED),R=r(e,b),I=function(t){return g&&h(g,"normal",t),new d(!0,t)},T=function(t){return S?(i(t),E?R(t[0],t[1],I):R(t[0],t[1])):E?R(t,I):R(t)};if(P)g=t.iterator;else if(A)g=t;else{if(!(y=f(t)))throw p(a(t)+" is not iterable");if(s(y)){for(x=0,C=c(t);C>x;x++)if((m=T(t[x]))&&u(v,m))return m;return new d(!1)}g=l(t,y)}for(w=P?t.next:g.next;!(k=o(w,g)).done;){try{m=T(k.value)}catch(t){h(g,"throw",t)}if("object"==typeof m&&m&&u(v,m))return m}return new d(!1)}},function(t,e,n){"use strict";var r=n(38),o=TypeError,i=function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw o("Bad Promise constructor");e=t,n=r}),this.resolve=r(e),this.reject=r(n)};t.exports.f=function(t){return new i(t)}},function(t,e,n){var r,o=n(35),i=n(151),a=n(130),s=n(90),c=n(153),u=n(126),l=n(111)("IE_PROTO"),f=function(){},h=function(t){return"<script>"+t+"<\/script>"},p=function(t){t.write(h("")),t.close();var e=t.parentWindow.Object;return t=null,e},d=function(){try{r=new ActiveXObject("htmlfile")}catch(t){}var t,e;d="undefined"!=typeof document?document.domain&&r?p(r):((e=u("iframe")).style.display="none",c.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(h("document.F=Object")),t.close(),t.F):p(r);for(var n=a.length;n--;)delete d.prototype[a[n]];return d()};s[l]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(f.prototype=o(t),n=new f,f.prototype=null,n[l]=t):n=d(),void 0===e?n:i.f(n,e)}},function(t,e,n){"use strict";var r=n(163).charAt,o=n(37),i=n(60),a=n(133),s=n(134),c=i.set,u=i.getterFor("String Iterator");a(String,"String",function(t){c(this,{type:"String Iterator",string:o(t),index:0})},function(){var t,e=u(this),n=e.string,o=e.index;return o>=n.length?s(void 0,!0):(t=r(n,o),e.index+=t.length,s(t,!1))})},function(t,e,n){var r=n(207),o=n(216),i=n(164),a=n(273);t.exports=function(t,e){return r(t)||o(t,e)||i(t,e)||a()},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(384)},function(t,e,n){var r=n(304),o=n(305),i=n(164),a=n(306);t.exports=function(t){return r(t)||o(t)||i(t)||a()},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(393)},function(t,e,n){t.exports=n(436)},function(t,e,n){t.exports=n(407)},function(t,e,n){t.exports=n(400)},function(t,e,n){var r=n(86),o=TypeError;t.exports=function(t){if(r(t))throw o("Can't call method on "+t);return t}},function(t,e,n){var r=n(74),o=n(12);t.exports=!!Object.getOwnPropertySymbols&&!o(function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41})},function(t,e,n){var r,o,i=n(15),a=n(57),s=i.process,c=i.Deno,u=s&&s.versions||c&&c.version,l=u&&u.v8;l&&(o=(r=l.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!o&&a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(o=+r[1]),t.exports=o},function(t,e){var n=String;t.exports=function(t){try{return n(t)}catch(t){return"Object"}}},function(t,e,n){"use strict";var r=n(104),o=n(31),i=n(56);t.exports=function(t,e,n){var a=r(e);a in t?o.f(t,a,i(0,n)):t[a]=n}},function(t,e){},function(t,e){t.exports={}},function(t,e){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},function(t,e,n){var r=n(15);t.exports=r.Promise},function(t,e,n){t.exports=n(256)},function(t,e,n){t.exports=n(140)},function(t,e,n){t.exports=n(449)},function(t,e,n){var r=n(100),o=Function.prototype,i=o.apply,a=o.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?a.bind(i):function(){return a.apply(i,arguments)})},function(t,e,n){var r=n(22),o=n(23),i=n(102),a=n(56),s=n(46),c=n(104),u=n(25),l=n(144),f=Object.getOwnPropertyDescriptor;e.f=r?f:function(t,e){if(t=s(t),e=c(e),l)try{return f(t,e)}catch(t){}if(u(t,e))return a(!o(i.f,t,e),t[e])}},function(t,e){t.exports=function(t){return null==t}},function(t,e,n){var r=n(39),o=n(125);(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.26.1",mode:r?"pure":"global",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.26.1/LICENSE",source:"https://github.com/zloirock/core-js"})},function(t,e,n){var r=n(12),o=n(17),i=n(74),a=o("species");t.exports=function(t){return i>=51||!r(function(){var e=[];return(e.constructor={})[a]=function(){return{foo:1}},1!==e[t](Boolean).foo})}},function(t,e,n){var r=n(152),o=n(130);t.exports=Object.keys||function(t){return r(t,o)}},function(t,e){t.exports={}},function(t,e,n){var r=n(43),o=n(13),i=n(103),a=n(34),s=n(36),c=n(108),u=o([].push),l=function(t){var e=1==t,n=2==t,o=3==t,l=4==t,f=6==t,h=7==t,p=5==t||f;return function(d,v,g,y){for(var x,C,m=a(d),w=i(m),k=r(v,g),b=s(w),S=0,P=y||c,A=e?P(d,b):n||h?P(d,0):void 0;b>S;S++)if((p||S in w)&&(C=k(x=w[S],S,m),t))if(e)A[S]=C;else if(C)switch(t){case 3:return!0;case 5:return x;case 6:return S;case 2:u(A,x)}else switch(t){case 4:return!1;case 7:u(A,x)}return f?-1:o||l?l:A}};t.exports={forEach:l(0),map:l(1),filter:l(2),some:l(3),every:l(4),find:l(5),findIndex:l(6),filterReject:l(7)}},function(t,e,n){var r=n(59),o=n(124),i=n(86),a=n(78),s=n(17)("iterator");t.exports=function(t){if(!i(t))return o(t,s)||o(t,"@@iterator")||a[r(t)]}},function(t,e,n){var r=n(55),o=n(15);t.exports="process"==r(o.process)},function(t,e,n){var r=n(21),o=TypeError;t.exports=function(t,e){if(r(e,t))return t;throw o("Incorrect invocation")}},function(t,e,n){var r=n(15),o=n(80),i=n(18),a=n(145),s=n(150),c=n(17),u=n(293),l=n(181),f=n(39),h=n(74),p=o&&o.prototype,d=c("species"),v=!1,g=i(r.PromiseRejectionEvent),y=a("Promise",function(){var t=s(o),e=t!==String(o);if(!e&&66===h)return!0;if(f&&(!p.catch||!p.finally))return!0;if(!h||h<51||!/native code/.test(t)){var n=new o(function(t){t(1)}),r=function(t){t(function(){},function(){})};if((n.constructor={})[d]=r,!(v=n.then(function(){})instanceof r))return!0}return!e&&(u||l)&&!g});t.exports={CONSTRUCTOR:y,REJECTION_EVENT:g,SUBCLASSING:v}},function(t,e,n){t.exports=n(411)},function(t,e,n){var r=n(221);t.exports=function(t){var e=+t;return e!=e||0===e?0:r(e)}},function(t,e,n){"use strict";var r=n(12);t.exports=function(t,e){var n=[][t];return!!n&&r(function(){n.call(null,e||function(){return 1},1)})}},function(t,e,n){"use strict";n.r(e),n.d(e,"UrlHelper",function(){return s});var r=n(2),o=n.n(r),i=n(3),a=n.n(i),s=function(){function t(){o()(this,t)}return a()(t,null,[{key:"urlElementGet",value:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return null!==(n=t.exec(e))&&n[r]?n[r]:void 0}},{key:"getFileName",value:function(t){return this.urlElementGet(/.+[\\|\/](.*?)(?=\?|$)/gm,t)}},{key:"getUrlWithoutArguments",value:function(t){return this.urlElementGet(/^(.*?)(?=\?|$)/gm,t)}},{key:"getStreamName",value:function(t){return this.urlElementGet(/\/(live_.*?)(\/|\.(flv|m3u8|mpd))/gm,t,1)}}]),t}()},function(t,e,n){var r=n(12);t.exports=!r(function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})},function(t,e,n){var r=n(55),o=n(13);t.exports=function(t){if("Function"===r(t))return o(t)}},function(t,e,n){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);e.f=i?function(t){var e=o(this,t);return!!e&&e.enumerable}:r},function(t,e,n){var r=n(13),o=n(12),i=n(55),a=Object,s=r("".split);t.exports=o(function(){return!a("z").propertyIsEnumerable(0)})?function(t){return"String"==i(t)?s(t,""):a(t)}:a},function(t,e,n){var r=n(213),o=n(105);t.exports=function(t){var e=r(t,"string");return o(e)?e:e+""}},function(t,e,n){var r=n(30),o=n(18),i=n(21),a=n(143),s=Object;t.exports=a?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return o(e)&&i(e.prototype,s(t))}},function(t,e,n){var r=n(13),o=0,i=Math.random(),a=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+a(++o+i,36)}},function(t,e,n){t.exports=n(217)},function(t,e,n){var r=n(222);t.exports=function(t,e){return new(r(t))(0===e?0:e)}},function(t,e,n){var r=n(13),o=n(12),i=n(18),a=n(59),s=n(30),c=n(150),u=function(){},l=[],f=s("Reflect","construct"),h=/^\s*(?:class|function)\b/,p=r(h.exec),d=!h.exec(u),v=function(t){if(!i(t))return!1;try{return f(u,l,t),!0}catch(t){return!1}},g=function(t){if(!i(t))return!1;switch(a(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return d||!!p(h,c(t))}catch(t){return!0}};g.sham=!0,t.exports=!f||o(function(){var t;return v(v.call)||!v(Object)||!v(function(){t=!0})||t})?g:v},function(t,e,n){var r=n(97),o=Math.max,i=Math.min;t.exports=function(t,e){var n=r(t);return n<0?o(n+e,0):i(n,e)}},function(t,e,n){var r=n(87),o=n(106),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,e,n){var r=n(152),o=n(130).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){var r=n(17);e.f=r},function(t,e,n){var r=n(13);t.exports=r([].slice)},function(t,e,n){var r=n(25),o=n(18),i=n(34),a=n(111),s=n(162),c=a("IE_PROTO"),u=Object,l=u.prototype;t.exports=s?u.getPrototypeOf:function(t){var e=i(t);if(r(e,c))return e[c];var n=e.constructor;return o(n)&&e instanceof n?n.prototype:e instanceof u?l:null}},function(t,e,n){var r=n(13),o=n(35),i=n(246);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=r(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return o(n),i(r),e?t(n,r):n.__proto__=r,n}}():void 0)},function(t,e){var n=TypeError;t.exports=function(t,e){if(t<e)throw n("Not enough arguments");return t}},function(t,e,n){t.exports=n(168)},function(t,e,n){t.exports=n(147)},function(t,e,n){"use strict";n.d(e,"b",function(){return u}),n.d(e,"a",function(){return l});var r=n(2),o=n.n(r),i=n(3),a=n.n(i),s=n(0),c=n.n(s);function u(t){return Math.floor(Math.random()*Math.floor(t))}n(52),n(53);var l=a()(function t(e){o()(this,t),c()(this,"data",void 0),this.data=e})},function(t,e,n){t.exports=n(461)},function(t,e,n){t.exports=n(446)},function(t,e,n){var r=n(38),o=n(86);t.exports=function(t,e){var n=t[e];return o(n)?void 0:r(n)}},function(t,e,n){var r=n(15),o=n(215),i=r["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=i},function(t,e,n){var r=n(15),o=n(24),i=r.document,a=o(i)&&o(i.createElement);t.exports=function(t){return a?i.createElement(t):{}}},function(t,e){var n=TypeError;t.exports=function(t){if(t>9007199254740991)throw n("Maximum allowed index exceeded");return t}},function(t,e,n){var r={};r[n(17)("toStringTag")]="z",t.exports="[object z]"===String(r)},function(t,e,n){var r=n(46),o=n(110),i=n(36),a=function(t){return function(e,n,a){var s,c=r(e),u=i(c),l=o(a,u);if(t&&n!=n){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((t||l in c)&&c[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e,n){var r=n(110),o=n(36),i=n(76),a=Array,s=Math.max;t.exports=function(t,e,n){for(var c=o(t),u=r(e,c),l=r(void 0===n?c:n,c),f=a(s(l-u,0)),h=0;u<l;u++,h++)i(f,h,t[u]);return f.length=h,f}},function(t,e){t.exports=function(){}},function(t,e,n){"use strict";var r=n(7),o=n(23),i=n(39),a=n(245),s=n(18),c=n(160),u=n(116),l=n(117),f=n(49),h=n(48),p=n(44),d=n(17),v=n(78),g=n(161),y=a.PROPER,x=a.CONFIGURABLE,C=g.IteratorPrototype,m=g.BUGGY_SAFARI_ITERATORS,w=d("iterator"),k=function(){return this};t.exports=function(t,e,n,a,d,g,b){c(n,e,a);var S,P,A,E=function(t){if(t===d&&L)return L;if(!m&&t in T)return T[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},R=e+" Iterator",I=!1,T=t.prototype,D=T[w]||T["@@iterator"]||d&&T[d],L=!m&&D||E(d),F="Array"==e&&T.entries||D;if(F&&(S=u(F.call(new t)))!==Object.prototype&&S.next&&(i||u(S)===C||(l?l(S,C):s(S[w])||p(S,w,k)),f(S,R,!0,!0),i&&(v[R]=k)),y&&"values"==d&&D&&"values"!==D.name&&(!i&&x?h(T,"name","values"):(I=!0,L=function(){return o(D,this)})),d)if(P={values:E("values"),keys:g?L:E("keys"),entries:E("entries")},b)for(A in P)(m||I||!(A in T))&&p(T,A,P[A]);else r({target:e,proto:!0,forced:m||I},P);return i&&!b||T[w]===L||p(T,w,L,{name:d}),v[e]=L,P}},function(t,e){t.exports=function(t,e){return{value:t,done:e}}},function(t,e,n){var r=n(23),o=n(38),i=n(35),a=n(75),s=n(92),c=TypeError;t.exports=function(t,e){var n=arguments.length<2?s(t):e;if(o(n))return i(r(n,t));throw c(a(t)+" is not iterable")}},function(t,e,n){t.exports=n(307)},function(t,e,n){"use strict";n.r(e),n.d(e,"WastedDataType",function(){return Bt.e}),n.d(e,"FetchErrorType",function(){return Bt.b}),n.d(e,"DataRoleType",function(){return Bt.a}),n.d(e,"EventReport",function(){return r}),n.d(e,"SistersPlayerContext",function(){return se});var r={};n.r(r),n.d(r,"EventReportType",function(){return o}),n.d(r,"DataReportTypeCode",function(){return i}),n.d(r,"ConfigUpdateEvent",function(){return kt}),n.d(r,"TrackerStatusDataReportEvent",function(){return bt});var o,i,a=n(65),s=n.n(a),c=n(6),u=n.n(c),l=n(67),f=n.n(l),h=n(2),p=n.n(h),d=n(3),v=n.n(d),g=n(0),y=n.n(g),x=n(1),C=n.n(x),m=n(14),w=n.n(m),k=n(19),b=n.n(k),S=n(5),P=n.n(S),A=n(10),E=n.n(A),R=n(40),I=n.n(R),T=n(4),D=n.n(T),L=n(41),F=n.n(L),O=n(54),U=n.n(O),N=n(66),M=n.n(N),B=n(33),_=n.n(B),z=n(32),j=n.n(z),q=n(52),W=n.n(q),V=n(68),G=n.n(V),H=n(71),Y=n.n(H),Q=n(70),K=n.n(Q),X=n(96),$=n.n(X),J=n(53),Z=n.n(J),tt=n(8),et=n(45),nt=n.n(et),rt=n(202),ot=n.n(rt),it=n(69),at=n.n(it),st=n(9),ct=n.n(st),ut=n(203),lt=n.n(ut),ft=n(123),ht=n.n(ft),pt=n(27),dt=n(83),vt=n.n(dt),gt=n(82),yt=n.n(gt),xt=n(26);!function(t){t[t.DataReport=0]="DataReport",t[t.ConfigUpdate=1]="ConfigUpdate"}(o||(o={})),function(t){t[t.TrackerClosedReport=0]="TrackerClosedReport"}(i||(i={}));var Ct,mt,wt,kt=v()(function t(e){p()(this,t),y()(this,"type",o.ConfigUpdate),y()(this,"body",void 0),this.body=e}),bt=v()(function t(e,n){p()(this,t),y()(this,"type",o.DataReport),y()(this,"body",void 0),this.body={code:i.TrackerClosedReport,data:{statusCode:e,hostname:n}}}),St=n(42),Pt=n(47),At=n.n(Pt);!function(t){t[t.Unknown=-1]="Unknown",t[t.IPv4Reserved=0]="IPv4Reserved",t[t.IPv4Unreserved=1]="IPv4Unreserved",t[t.IPv6Reserved=2]="IPv6Reserved",t[t.IPv6Unreserved=3]="IPv6Unreserved"}(Ct||(Ct={})),function(t){t[t.Unknown=-3]="Unknown",t[t.UDPBlock=-2]="UDPBlock",t[t.PublicAddress=-1]="PublicAddress",t[t.FullConeOrRestrictedCone=0]="FullConeOrRestrictedCone",t[t.UnknownCone=1]="UnknownCone",t[t.PortRestrictedCone=2]="PortRestrictedCone",t[t.Symmetric=3]="Symmetric"}(mt||(mt={})),function(t){t[t.Unknown=-1]="Unknown",t[t.EndpointIndependent=0]="EndpointIndependent",t[t.AddressDependent=1]="AddressDependent",t[t.AddressAndPortDependent=2]="AddressAndPortDependent"}(wt||(wt={}));var Et,Rt=function(){function t(e,n,r){p()(this,t),y()(this,"ipv6",void 0),y()(this,"natTypeChangedCallback",void 0),y()(this,"curNatType",mt.Unknown),y()(this,"p2pContext",void 0),y()(this,"natDowngradeCount",0),y()(this,"kakushinMode",!1),this.natTypeChangedCallback=r,this.p2pContext=e,this.ipv6=n;var o=t.loadNatTypeCache();if(void 0!==o){var i=!1===this.checkKakushinExpired();this.setCurrentNatType(o,i,!0)}}var e,n,r;return v()(t,[{key:"getCurrentNatType",value:function(){return this.curNatType}},{key:"setCurrentNatType",value:function(e,n,r){var o,i;if(e!==mt.Unknown&&((this.kakushinMode!==n||r)&&(this.kakushinMode=n,this.kakushinMode&&0==r&&t.saveKakushinTime(),this.p2pContext.printExtLog(0,ct()(o="NAT Kakushin Mode".concat(r?" (Preload)":"",": ")).call(o,this.kakushinMode,".")),this.p2pContext.Config.allowPrintLog(0)&&console.info(ct()(i="[SistersPlayer] NAT Kakushin Mode".concat(r?" (Preload)":"",": ")).call(i,this.kakushinMode,"."))),this.curNatType!==e)){var a,s;if(e===mt.UnknownCone&&(this.curNatType===mt.FullConeOrRestrictedCone||this.curNatType===mt.PortRestrictedCone))return;this.curNatType=e,t.saveNatTypeCache(e),this.p2pContext.printExtLog(0,ct()(a="NAT TYPE".concat(r?" (Preload)":"",": ")).call(a,mt[e],".")),this.p2pContext.Config.allowPrintLog(0)&&console.info(ct()(s="[SistersPlayer] NAT TYPE".concat(r?" (Preload)":"",": ")).call(s,mt[e],".")),this.natTypeChangedCallback(e)}}},{key:"checkNatTypeAndUpdate",value:(r=u()(C.a.mark(function e(){var n,r,o,i,a,s,c,u,l;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.multiCheckBasicNatType();case 2:if((n=e.sent)!==mt.Unknown){e.next=5;break}return e.abrupt("return");case 5:if(r=!1,o=this.checkKakushinExpired(),n!==mt.UnknownCone){e.next=37;break}if(i=wt.Unknown,a=this.p2pContext.Config.natFilteringCheckServers,!o){e.next=36;break}if(!(a.length>0)){e.next=34;break}return s=this.p2pContext.Config.natFilteringCheckPort,c=this.p2pContext.Config.natFilteringCheckAltPort,u=this.p2pContext.Config.natFilteringCheckTimeoutMs,l=a[Math.floor(Math.random()*a.length)],e.prev=16,e.next=19,t.checkNatFilteringBehavior(l,s,c,u);case 19:i=e.sent,e.next=24;break;case 22:e.prev=22,e.t0=e.catch(16);case 24:e.t1=i,e.next=e.t1===wt.EndpointIndependent||e.t1===wt.AddressDependent?27:e.t1===wt.AddressAndPortDependent?30:(e.t1,wt.Unknown,33);break;case 27:return n=mt.FullConeOrRestrictedCone,r=!0,e.abrupt("break",34);case 30:return n=mt.PortRestrictedCone,r=!0,e.abrupt("break",34);case 33:return e.abrupt("break",34);case 34:e.next=37;break;case 36:r=!0;case 37:this.setCurrentNatType(n,r,!1),this.natDowngradeCount=0;case 39:case"end":return e.stop()}},e,this,[[16,22]])})),function(){return r.apply(this,arguments)})},{key:"onSymmetricConnect",value:function(t){!1===this.kakushinMode&&(t?(this.natDowngradeCount=0,this.setCurrentNatType(mt.FullConeOrRestrictedCone,!1,!1)):this.natDowngradeCount=this.natDowngradeCount+1,this.curNatType!==mt.Symmetric&&this.natDowngradeCount>=this.p2pContext.Config.natDowngradeLimit&&this.setCurrentNatType(mt.PortRestrictedCone,!1,!1))}},{key:"checkKakushinExpired",value:function(){var e=Z()(),n=t.loadKakushinTime(),r=t.loadNatTypeCache(),o=e-n>this.p2pContext.Config.natKakushinTimeoutMs;return(n>e||0==(r===mt.PortRestrictedCone||r===mt.FullConeOrRestrictedCone))&&(o=!0),o}},{key:"multiCheckBasicNatType",value:(n=u()(C.a.mark(function e(){var n,r,o,i,a,s,c,u=this;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,r=new w.a,o=this.p2pContext.Config.natCheckStunServers,i=this.p2pContext.Config.checkBasicNatTimeoutMs,!(o.length>=2)){e.next=28;break}case 5:if(void 0!==n){e.next=26;break}return a=mt.Unknown,e.prev=7,e.next=10,t.checkBasicNatType(o,this.ipv6,i);case 10:a=e.sent,e.next=18;break;case 13:e.prev=13,e.t0=e.catch(7),s=e.t0.message,this.p2pContext.printExtLog(0,s),this.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] "+s);case 18:if(a!=mt.Symmetric){e.next=21;break}return n=mt.Symmetric,e.abrupt("break",26);case 21:void 0===(c=r.get(a))?r.set(a,1):r.set(a,c+1),P()(r).call(r,function(t,e){t>=u.p2pContext.Config.multiCheckBasicNatMinCount&&(n=e)}),e.next=5;break;case 26:e.next=29;break;case 28:n=mt.Unknown;case 29:return e.abrupt("return",n);case 30:case"end":return e.stop()}},e,this,[[7,13]])})),function(){return n.apply(this,arguments)})}],[{key:"loadKakushinTime",value:function(){var t,e,n=null===(t=window)||void 0===t||null===(e=t.localStorage)||void 0===e?void 0:e.getItem("misakaNetworkTypeKakushinJikoku"),r=0;if(null!=n){var o=U()(n);o&&(r=o)}return r}},{key:"saveKakushinTime",value:function(){var t,e,n=Z()();null===(t=window)||void 0===t||null===(e=t.localStorage)||void 0===e||e.setItem("misakaNetworkTypeKakushinJikoku",n.toString())}},{key:"loadNatTypeCache",value:function(){var t,e,n=null===(t=window)||void 0===t||null===(e=t.localStorage)||void 0===e?void 0:e.getItem("misakaNetworkType"),r=void 0;return null!=n&&(r=mt[n]),r}},{key:"saveNatTypeCache",value:function(t){var e,n;null===(e=window)||void 0===e||null===(n=e.localStorage)||void 0===n||n.setItem("misakaNetworkType",mt[t].toString())}},{key:"ip2long",value:function(t){var e;if(e=t.match(/^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/)){for(var n=0,r=1,o=4;o>=1;o-=1)n+=r*At()(e[o]),r*=256;return n}return-1}},{key:"inSubNet",value:function(t,e){var n,r,o=this.ip2long(t);if((n=e.match(/^(.*?)\/(\d{1,2})$/))&&(r=this.ip2long(n[1]))>=0){var i=Math.pow(2,32-At()(n[2]));return(o>r||o===r)&&(o<r+i-1||o===r+i-1)}return!1}},{key:"getAddressType",value:function(t){var e=this;if(this.ip2long(t)>-1){var n=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],r=!1;return P()(n).call(n,function(n){e.inSubNet(t,n)&&(r=!0)}),r?Ct.IPv4Reserved:Ct.IPv4Unreserved}return/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/.test(t)?/^::$/.test(t)||/^::1$/.test(t)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(t)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(t)||/^ff([0-9a-fA-F]{2,2}):/i.test(t)?Ct.IPv6Reserved:Ct.IPv6Unreserved:Ct.Unknown}},{key:"getFixedAnswer",value:function(t,e){var n,r,o,i;return{type:"answer",sdp:ct()(n=ct()(r=ct()(o=ct()(i="v=0\no=- 154894363573307000 2 IN IP4 127.0.0.1\ns=-\nt=0 0\na=group:BUNDLE 0\na=extmap-allow-mixed\na=msid-semantic: WMS\nm=application 9 UDP/DTLS/SCTP webrtc-datachannel\nc=IN IP4 0.0.0.0\na=candidate:2715078485 1 udp 1677729535 ".concat(t," ")).call(i,e.toString()," typ srflx raddr 0.0.0.0 rport 0 generation 0 ufrag ")).call(o,"Misk"," network-cost 999\na=ice-ufrag:")).call(r,"Misk","\na=ice-pwd:")).call(n,"MisakaNetworkMackerelAngo","\na=ice-options:trickle\na=fingerprint:sha-256 19:D9:0C:C7:B5:A2:34:9A:70:FD:DC:43:E1:24:A5:E6:40:C9:F5:42:C0:CC:19:64:C8:35:8F:EF:C4:0F:66:99\na=setup:active\na=mid:0\na=sctp-port:5000\na=max-message-size:262144\n")}}},{key:"getFixedCandidate",value:function(t,e){var n,r;return{candidate:ct()(n=ct()(r="candidate:2715078485 1 udp 1677729535 ".concat(t," ")).call(r,e.toString()," typ srflx raddr 0.0.0.0 rport 0 generation 0 ufrag ")).call(n,"Misk"," network-cost 999"),sdpMid:"0",sdpMLineIndex:0}}},{key:"checkNatFilteringBehavior",value:function(e,n,r){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return new D.a(function(i,a){var s,c=new RTCPeerConnection({iceServers:[],iceCandidatePoolSize:0}),l=wt.AddressDependent,f=void 0;c.createDataChannel("TGSAN-NAT-TEST"),c.oniceconnectionstatechange=function(t){"connected"==c.iceConnectionState&&(c.close(),i(l),clearTimeout(f))},c.createOffer().then((s=u()(C.a.mark(function s(u){return C.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:void 0!==u.sdp&&(u.sdp=u.sdp.replace(/a\=ice\-ufrag\:.*/m,"a=ice-ufrag:Mikt"),u.sdp=u.sdp.replace(/a\=ice\-pwd\:.*/m,"a=ice-pwd:MisakaNetworkTanmatsuAngo")),c.setLocalDescription(u).then(function(){var s=t.getFixedAnswer(e,n);c.setRemoteDescription(s),f=E()(function(){var n=t.getFixedCandidate(e,r);l=wt.AddressAndPortDependent,c.addIceCandidate(n).then(function(){f=E()(function(){c.close(),l=wt.Unknown,i(l)},o)}).catch(function(t){a(t)})},o)}).catch(function(t){a(t)});case 2:case"end":return s.stop()}},s)})),function(t){return s.apply(this,arguments)}))})}},{key:"checkBasicNatType",value:(e=u()(C.a.mark(function t(e){var n,r,o=this,i=arguments;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],r=i.length>2&&void 0!==i[2]?i[2]:2e3,t.abrupt("return",new D.a(function(t,i){try{var a=void 0,s=!1,c=!1,u=function(){if(clearTimeout(a),h.close(),1===$()(l).length){var e=l[$()(l)[0]];t(1===e.length?mt.UnknownCone:mt.Symmetric)}else t((!0===n?c:s)?mt.PublicAddress:mt.UDPBlock)},l={},f=[];P()(e).call(e,function(t){f.push({urls:t})});var h=new RTCPeerConnection({iceServers:f});h.createDataChannel("MisakaNetwork-NAT-Check"),h.onicecandidate=function(t){var e;if(t.candidate&&-1!==F()(e=t.candidate.candidate).call(e,"srflx")){var n=function(t){for(var e,n={foundation:(e=0===F()(t).call(t,"a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" "))[0],component:e[1],protocol:e[2].toLowerCase(),priority:At()(e[3],10),ip:e[4],port:At()(e[5],10),type:e[7],relatedAddress:"",relatedPort:NaN,tcpType:"unknown"},r=8;r<e.length;r+=2)switch(e[r]){case"raddr":n.relatedAddress=e[r+1];break;case"rport":n.relatedPort=At()(e[r+1],10);break;case"tcptype":n.tcpType=e[r+1]}return n}(t.candidate.candidate);if("srflx"===n.type)l[n.relatedPort]||(l[n.relatedPort]=[]),l[n.relatedPort].push(n.port);else if("host"===n.type){var r=o.getAddressType(n.ip);r===Ct.IPv4Unreserved&&(s=!0),r===Ct.IPv6Unreserved&&(c=!0)}}else t.candidate||u()},h.createOffer().then(function(t){h.setLocalDescription(t).then(function(){a=E()(function(){console.debug("[SistersPlayer] Basic test timeout."),u()},r)})})}catch(t){i(new Error("Failed to check NAT type."))}}));case 3:case"end":return t.stop()}},t)})),function(t){return e.apply(this,arguments)})},{key:"getTrackerNatTypeStr",value:function(t){var e=void 0;switch(t){case mt.Symmetric:e="sym";break;case mt.UnknownCone:e="non-sym";break;case mt.PortRestrictedCone:e="port-restricted";break;case mt.FullConeOrRestrictedCone:e="ip-restricted"}return e}}]),t}(),It=function(){function t(e,n,r){p()(this,t),y()(this,"p2pContext",void 0),y()(this,"needDestroy",!1),y()(this,"ws",void 0),y()(this,"requestId",0),y()(this,"pendingRequests",new w.a),y()(this,"messageSink",void 0),y()(this,"trackerSourceParam",void 0),y()(this,"onReconnected",function(){}),this.p2pContext=e,this.trackerSourceParam=n,this.messageSink=r}var e,n,r,o,i;return v()(t,[{key:"trackerConnect",value:(i=u()(C.a.mark(function t(){var e,n=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.p2pContext.printExtLog(0,"Last Order (re)connecting."),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order (re)connecting."),!1!==this.needDestroy){t.next=20;break}return t.next=5,this.newTrackerConnect();case 5:if(void 0!==(e=t.sent)){t.next=11;break}return this.p2pContext.P2PDataCollectionStatus.addTrackerConnect(!1),t.abrupt("return",void 0);case 11:return this.p2pContext.P2PDataCollectionStatus.addTrackerConnect(!0),this.ws=e,this.ws.onmessage=function(t){n.onMessageReceived(t.data)},this.onReconnected(),this.p2pContext.printExtLog(0,"Last Order (re)connect done."),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order (re)connect done."),t.abrupt("return",e);case 18:t.next=22;break;case 20:this.p2pContext.printExtLog(0,"Last Order (re)connect cancel."),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order (re)connect cancel.");case 22:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"newTrackerConnect",value:(o=u()(C.a.mark(function t(){var e=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new D.a(function(t){var n=e.p2pContext.Config.trackerServers[e.p2pContext.trackerPositionInServers],r=new WebSocket(n+e.trackerSourceParam);e.p2pContext.trackerPositionInServers=++e.p2pContext.trackerPositionInServers%e.p2pContext.Config.trackerServers.length,r.onopen=function(o){e.p2pContext.eventReportCallback(new bt(-1,n)),e.needDestroy?(r.close(),t(void 0)):t(r)},r.onclose=function(r){var o;e.p2pContext.eventReportCallback(new bt(r.code,n)),e.p2pContext.printExtLog(0,"Last Order connection is closed. (code: "+r.code+"), url: "+n),e.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Last Order connection is closed. (code: "+r.code+"), url: "+n),P()(o=e.pendingRequests).call(o,function(t,e){return t(void 0)}),e.pendingRequests.clear(),0==e.needDestroy?0==e.p2pContext.trackerPositionInServers?(e.p2pContext.printExtLog(0,"Misaka will reconnect to the Last Order in "+e.p2pContext.Config.reconnectWaitTimeSec+" seconds."),e.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Misaka will reconnect to the Last Order in "+e.p2pContext.Config.reconnectWaitTimeSec+" seconds."),E()(function(){e.trackerConnect()},1e3*e.p2pContext.Config.reconnectWaitTimeSec)):(e.p2pContext.printExtLog(0,"Misaka will reconnect to the Last Order immediately."),e.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Misaka will reconnect to the Last Order immediately."),e.trackerConnect()):(e.p2pContext.printExtLog(0,"Last Order reconnect cancel."),e.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order reconnect cancel.")),t(void 0)}}));case 1:case"end":return t.stop()}},t)})),function(){return o.apply(this,arguments)})},{key:"dispatchResponse",value:function(t){var e=this.pendingRequests.get(t.requestId);void 0!==e&&(this.pendingRequests.delete(t.requestId),e(t))}},{key:"sendMessage",value:function(t,e,n,r,o,i){var a=this,s=this.ws;if(null!=s&&s.readyState==s.OPEN){0==n&&(++this.requestId,n=this.requestId);var c={type:e,requestId:n};c[r]=o,null!==t&&(c.from=this.p2pContext.CurPeerId,c.to=t),void 0!==i&&(c.data=i);var u=this.pendingRequests;return new D.a(function(t){null!=s&&s.readyState==s.OPEN?(a.p2pContext.Config.allowPrintLog(7)&&console.log("send: ",c),u.set(n,t),s.send(b()(c))):t(void 0)})}return new D.a(function(t){return t(void 0)})}},{key:"sendServerRequest",value:(r=u()(C.a.mark(function t(e,n,r){var o,i,a,s,c,u=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=performance.now(),i=this.sendMessage(null,"request",n,"action",e,r),t.next=4,D.a.race(new Array(new D.a(function(t){return a=E()(function(){return t(void 0)},u.p2pContext.Config.serverTimeoutMs)}),i));case 4:if(s=t.sent,clearTimeout(a),!(n<0)){t.next=8;break}return t.abrupt("return",s);case 8:return c=performance.now(),void 0===s?this.p2pContext.P2PDataCollectionStatus.addTrackerResponse(!1,c-o):this.p2pContext.P2PDataCollectionStatus.addTrackerResponse(!0,c-o),t.abrupt("return",s);case 11:case"end":return t.stop()}},t,this)})),function(t,e,n){return r.apply(this,arguments)})},{key:"sendPeerRequest",value:(n=u()(C.a.mark(function t(e,n,r,o){var i,a,s,c=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.sendMessage(e,"request",r,"action",n,o),t.next=3,D.a.race(new Array(new D.a(function(t){return a=E()(function(){return t(void 0)},c.p2pContext.Config.peerConnectionTimeoutMs)}),i));case 3:return s=t.sent,clearTimeout(a),t.abrupt("return",s);case 6:case"end":return t.stop()}},t,this)})),function(t,e,r,o){return n.apply(this,arguments)})},{key:"sendPeerResponse",value:function(t,e,n,r){return this.sendMessage(t,"response",e,"status",n,r)}},{key:"onPeerRequest",value:function(t){this.messageSink.onPeerMessage(this,t.from,t,t.requestId)}},{key:"onServerRequest",value:function(t){this.messageSink.onServerMessage(this,t)}},{key:"onMessageReceived",value:function(t){if(0==this.needDestroy)try{var e=JSON.parse(t);this.p2pContext.Config.allowPrintLog(7)&&console.log("recv: ",e),"response"==e.type&&vt()(e.requestId)&&e.requestId>0?this.dispatchResponse(e):"request"==e.type&&vt()(e.requestId)&&(null==e.from?this.onServerRequest(e):this.onPeerRequest(e))}catch(t){console.log(t)}}},{key:"destroy",value:function(){var t;this.needDestroy=!0,null!=this.ws&&(this.ws.close(),this.ws=void 0),P()(t=this.pendingRequests).call(t,function(t,e){return t(void 0)}),this.pendingRequests.clear()}}],[{key:"connect",value:(e=u()(C.a.mark(function e(n,r,o,i){var a;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new t(n,r,o),e.next=3,new D.a(function(t){a.onReconnected=function(){t()},a.trackerConnect()});case 3:return a.onReconnected=i,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)})),function(t,n,r,o){return e.apply(this,arguments)})}]),t}(),Tt=function(){function t(e,n){p()(this,t),y()(this,"curVisibilityState",Et.BROADCAST),y()(this,"needDestroy",!1),y()(this,"p2pContext",void 0),y()(this,"tracker",void 0),y()(this,"peerSched",void 0),this.p2pContext=e,this.peerSched=n}var e,n,r,o,i;return v()(t,[{key:"initTracker",value:function(t){this.tracker=t,1==this.needDestroy&&this.destroy()}},{key:"onTrackerReconnected",value:function(){var t=this;this.setSelfVisible(this.curVisibilityState).then(function(e){t.p2pContext.printExtLog(0,"SetVisible after reconnect."),t.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] SetVisible after reconnect.")}),this.sendNatType()}},{key:"getPeers",value:(i=u()(C.a.mark(function t(){var e;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e={peers:[],leeches:[],seedboxes:new w.a},null==this.tracker){t.next=7;break}return t.next=4,this.tracker.sendServerRequest("getPeers",0,{roles:["peer","leech","seedbox"]}).then(function(t){if(null!=t&&t.data&&(t.data.peers&&(e.peers=t.data.peers),t.data.leeches&&(e.leeches=t.data.leeches),t.data.seedboxes))for(var n=0,r=M()(t.data.seedboxes);n<r.length;n++){var o=s()(r[n],2),i=o[0],a=o[1];yt()(a)&&e.seedboxes.set(i,a)}return e});case 4:return t.abrupt("return",t.sent);case 7:return t.abrupt("return",new D.a(function(t){return t(e)}));case 8:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"sendPeerCandidate",value:(o=u()(C.a.mark(function t(e,n,r){var o;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.tracker){t.next=11;break}return t.next=3,this.tracker.sendPeerRequest(e,"candidate",-1,{direction:n,cand:r});case 3:if("ok"!=(null==(o=t.sent)?void 0:o.status)){t.next=8;break}return t.abrupt("return",!0);case 8:return t.abrupt("return",!1);case 9:t.next=12;break;case 11:return t.abrupt("return",!1);case 12:case"end":return t.stop()}},t,this)})),function(t,e,n){return o.apply(this,arguments)})},{key:"connectPeer",value:(r=u()(C.a.mark(function t(e,n){var r,o,i,a,s,c,u,l,f,h,p=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new pt.NyaPeer(this.p2pContext,this.peerSched,!1),null==n||n(r),r.extData.peerId=e,o=new xt.c,t.next=6,o.lock();case 6:return t.next=8,r.createNyaOffer(function(t){o.lock().then(function(){p.sendPeerCandidate(e,"offer",t),o.unlock()})});case 8:if(i=t.sent,a=void 0,null==this.tracker){t.next=14;break}return t.next=13,this.tracker.sendPeerRequest(e,"connect",0,{protocol:St.Configuration.ProtocolVersion,offer:i,role:{type:"peer"},nat:null!==(s=Rt.getTrackerNatTypeStr(this.p2pContext.P2P.nat.getCurrentNatType()))&&void 0!==s?s:"non-sym"});case 13:a=t.sent;case 14:if(o.unlock(),null!=a){t.next=18;break}return this.peerSched.onPeerConnectComplete(r,!1),t.abrupt("return");case 18:if(t.prev=18,"ok"===a.status){t.next=23;break}this.peerSched.onPeerConnectComplete(r,!1),t.next=52;break;case 23:if(u=a.data,l=u.answer,this.p2pContext.printExtLog(3,"peer connecting "+e),this.p2pContext.Config.allowPrintLog(3)&&console.log("peer connecting "+e),r.natType=null!==(c=u.nat)&&void 0!==c?c:"non-sym",r.parsePeerRole(u.role),r.peerRole!=pt.PeerRole.Seedbox){t.next=46;break}if(h=!1,P()(f=r.seedSliceIds).call(f,function(t){p.peerSched.getSeedboxNeedConnectNum(t)>0&&(h=!0)}),1!=h){t.next=41;break}return t.t0=this.peerSched,t.t1=r,t.next=37,r.acceptNyaAnswer(l);case 37:t.t2=t.sent,t.t0.onPeerConnectComplete.call(t.t0,t.t1,t.t2),t.next=44;break;case 41:this.p2pContext.printExtLog(2,"not need this seedbox: "+e),this.p2pContext.Config.allowPrintLog(2)&&console.log("not need this seedbox: "+e),this.peerSched.onPeerConnectComplete(r,!1);case 44:t.next=52;break;case 46:return t.t3=this.peerSched,t.t4=r,t.next=50,r.acceptNyaAnswer(l);case 50:t.t5=t.sent,t.t3.onPeerConnectComplete.call(t.t3,t.t4,t.t5);case 52:t.next=58;break;case 54:t.prev=54,t.t6=t.catch(18),console.log(t.t6),this.peerSched.onPeerConnectComplete(r,!1);case 58:case"end":return t.stop()}},t,this,[[18,54]])})),function(t,e){return r.apply(this,arguments)})},{key:"getVisibilityState",value:function(){return this.curVisibilityState}},{key:"setSelfVisible",value:(n=u()(C.a.mark(function t(e){var n,r,o,i,a,s;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!1,e==Et.GONE?r=!1:e==Et.BROADCAST&&(r=!0),this.tracker){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,null===(n=this.tracker)||void 0===n?void 0:n.sendServerRequest("setVisible",0,{value:r});case 6:if("ok"!==(null==(o=t.sent)?void 0:o.status)){t.next=16;break}return t.next=10,null===(i=this.p2pContext.PeerSched)||void 0===i?void 0:i.getConnectMutex().lock();case 10:return this.curVisibilityState=e,null===(a=this.p2pContext.PeerSched)||void 0===a||a.getConnectCV().notifyAll(),null===(s=this.p2pContext.PeerSched)||void 0===s||s.getConnectMutex().unlock(),t.abrupt("return",!0);case 16:return t.abrupt("return",!1);case 17:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"sendNatType",value:function(){var t,e=this.p2pContext.P2P.nat.getCurrentNatType(),n=Rt.getTrackerNatTypeStr(e);return void 0!==n&&(null===(t=this.tracker)||void 0===t||t.sendServerRequest("setNatType",-1,{type:n}),!0)}},{key:"reportDownloadBlockSuccessOrAwaysFail",value:function(t,e){var n,r,o,i;return this.p2pContext.printExtLog(3,ct()(n="peerId ".concat(t," report ")).call(n,e?"peerConnected":"peerConnectFailed"," to tracker.")),this.p2pContext.Config.allowPrintLog(3)&&console.log(ct()(i="peerId ".concat(t," report ")).call(i,e?"peerConnected":"peerConnectFailed"," to tracker.")),null!==(r=null===(o=this.tracker)||void 0===o?void 0:o.sendServerRequest("report",-1,{id:e?"peerConnected":"peerConnectFailed",remote:t}).then(function(t){return void 0!==t&&"ok"===(null==t?void 0:t.status)}))&&void 0!==r?r:D.a.resolve(!1)}},{key:"onPeerMessage",value:function(t,e,n,r){return this.peerSched.onPeerRelayMessage(e,n,r)}},{key:"onServerMessage",value:function(t,e){switch(e.action){case"setPeerId":this.p2pContext.CurPeerId=e.data.id;break;case"updateConfig":this.p2pContext.setConfiguration(e.data.jsonstr);break;case"move":this.p2pContext.setConfiguration(b()({trackerServers:[e.data.target]})),this.peerSched.recreateTracker()}}},{key:"sendPeerResponse",value:function(t,e,n,r){return null!=this.tracker?this.tracker.sendPeerResponse(t,e,n,r):new D.a(function(t){return t(void 0)})}},{key:"destroy",value:function(){var t;this.needDestroy=!0,null===(t=this.tracker)||void 0===t||t.destroy()}}],[{key:"connect",value:(e=u()(C.a.mark(function e(n,r,o,i){var a,s;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new t(n,o),e.next=3,It.connect(n,r,a,function(){a.onTrackerReconnected()});case 3:return s=e.sent,a.initTracker(s),a.setSelfVisible(Et.BROADCAST),a.sendNatType(),e.abrupt("return",a);case 8:case"end":return e.stop()}},e)})),function(t,n,r,o){return e.apply(this,arguments)})}]),t}();!function(t){t[t.GONE=0]="GONE",t[t.BROADCAST=1]="BROADCAST"}(Et||(Et={}));var Dt=function(){function t(e,n,r,o){p()(this,t),y()(this,"p2pContext",void 0),y()(this,"pendingIncomingPeers",new w.a),y()(this,"pendingOutcomingPeers",new w.a),y()(this,"connectedPeers",new w.a),y()(this,"curSliceIds",void 0),y()(this,"cancelToken",void 0),y()(this,"trackerSourceParam",void 0),y()(this,"sliceId",void 0),y()(this,"allSeedboxConnectNumBySlice",new w.a),y()(this,"tracker",void 0),y()(this,"trackerConnecting",!1),y()(this,"connectMutex",new xt.c),y()(this,"connectCV",new xt.a),this.trackerSourceParam=r,this.sliceId=o,this.p2pContext=e,this.cancelToken=n,this.curSliceIds=new j.a,this.updateAllSeedboxConnectNumBySlice()}var e,n,r,o,i;return v()(t,[{key:"allowedInConnectNewPeer",value:function(){var t=this.pendingIncomingPeers.size<this.p2pContext.Config.inConnectingLimit,e=this.connectedPeers.size<this.p2pContext.Config.connectedLimit;return t&&e}},{key:"getConnectMutex",value:function(){return this.connectMutex}},{key:"getConnectCV",value:function(){return this.connectCV}},{key:"getLeechNeedConnectNum",value:function(){var t;return this.p2pContext.Config.leechConnectNum-nt()(t=this.getConnectedPeers()).call(t,function(t){return t.peerRole==pt.PeerRole.Leech}).length}},{key:"getSeedboxNeedConnectNum",value:function(t){var e=this.allSeedboxConnectNumBySlice.get(t);return e||(e=0),this.p2pContext.Config.seedboxConnectNumBySliceId-e}},{key:"recreateTracker",value:(i=u()(C.a.mark(function t(){var e=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new D.a(function(t){null!=e.tracker?(e.p2pContext.printExtLog(2,"Misaka will reconnect to the Last Order. (Service Redirect)"),e.p2pContext.Config.allowPrintLog(2)&&console.warn("Misaka will reconnect to the Last Order. (Service Redirect)"),e.tracker.destroy(),e.tracker=void 0,e.trackerConnecting=!0,Tt.connect(e.p2pContext,e.trackerSourceParam,e,e.sliceId).then(function(n){e.tracker=n,e.trackerConnecting=!0,t(!0)}).catch(function(e){t(!1)})):t(!1)}));case 1:case"end":return t.stop()}},t)})),function(){return i.apply(this,arguments)})},{key:"getTracker",value:function(){return this.tracker}},{key:"getP2PContext",value:function(){return this.p2pContext}},{key:"updateAllSeedboxConnectNumBySlice",value:function(){for(var t,e=new w.a,n=0;n<this.p2pContext.Config.sliceCount;n++)e.set(n,0);P()(t=this.connectedPeers).call(t,function(t){P()(t).call(t,function(t){var n;t.peerRole==pt.PeerRole.Seedbox&&P()(n=t.seedSliceIds).call(n,function(t){var n=e.get(t);e.set(t,(n||0)+1)})})}),this.allSeedboxConnectNumBySlice=e;var r="Update Seedbox Connect Number By Slice: \n"+b()(ot()(e));this.p2pContext.printExtLog(3,r),this.p2pContext.Config.allowPrintLog(3)&&console.log(r)}},{key:"checkVisibilityStateNeedChange",value:(o=u()(C.a.mark(function t(){var e=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new D.a(function(t){var n=e.connectedPeers.size<e.p2pContext.Config.connectedLimit,r=e.connectedPeers.size<=e.p2pContext.Config.revisibleMark;null!=e.tracker&&0==e.trackerConnecting?1==n&&1==r&&e.tracker.getVisibilityState()==Et.GONE?(e.p2pContext.printExtLog(0,"Misaka will broadcast."),e.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka will broadcast."),e.tracker.setSelfVisible(Et.BROADCAST),t()):0==n&&0==r&&e.tracker.getVisibilityState()==Et.BROADCAST?(e.p2pContext.printExtLog(0,"Misaka will gone."),e.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka will gone."),e.tracker.setSelfVisible(Et.GONE),t()):t():t()}));case 1:case"end":return t.stop()}},t)})),function(){return o.apply(this,arguments)})},{key:"doConnect",value:function(t){var e=this;if(this.tracker){if(this.p2pContext.GhostPeerIds.has(t))return this.p2pContext.printExtLog(2,"has a ghost peerId: "+t),void(this.p2pContext.Config.allowPrintLog(2)&&console.warn("has a ghost peerId: "+t));if(this.pendingOutcomingPeers.has(t)||this.pendingIncomingPeers.has(t))return;if(this.connectedPeers.has(t)&&this.connectedPeers.get(t).length>0)return;if(this.p2pContext.CurPeerId===t)return;return new D.a(function(n){e.tracker?e.tracker.connectPeer(t,function(r){e.pendingOutcomingPeers.set(t,r),n()}):n()})}return D.a.resolve()}},{key:"createConnectPeerTask",value:function(t){var e=this;return u()(C.a.mark(function n(){return C.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.connectMutex.lock();case 2:return n.next=4,e.connectCV.waitUntil(e.connectMutex,function(){return!!e.cancelToken.hasCancel||!(e.p2pContext.Config.connectedLimit<e.connectedPeers.size)&&(e.p2pContext.Config.connectedLimit-e.connectedPeers.size-e.pendingIncomingPeers.size-e.pendingOutcomingPeers.size>0||e.pendingOutcomingPeers.size<e.p2pContext.Config.outConnectingLimit)});case 4:if(!1!==e.cancelToken.hasCancel){n.next=7;break}return n.next=7,e.doConnect(t);case 7:e.connectMutex.unlock();case 8:case"end":return n.stop()}},n)}))}},{key:"beginConnectPeers",value:(r=u()(C.a.mark(function t(){var e,n=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=C.a.mark(function t(){var e,r,o,i,a,s,c,u,l,f,h,p,d,v,g,y,x,m,w;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=performance.now(),t.next=3,n.connectMutex.lock();case 3:return t.next=5,n.connectCV.waitUntil(n.connectMutex,function(){return!(null!=n.tracker&&!n.cancelToken.hasCancel)||n.tracker.getVisibilityState()!=Et.GONE});case 5:if(n.connectMutex.unlock(),null==n.tracker){t.next=32;break}return r=function(t){var e,n;return at()(e=G()(n=at()(t).call(t,function(t){return[Math.random(),t]})).call(n,function(t,e){return t[0]-e[0]})).call(e,function(t){return t[1]})},t.next=10,n.tracker.getPeers();case 10:if(o=t.sent,i=(i=o.peers)?r(i):new Array,a=o.leeches,s=n.getLeechNeedConnectNum(),a=a?I()(c=r(a)).call(c,0,s):new Array,n.p2pContext.printExtLog(2,"ready to connect leeches: "+b()(a)),n.p2pContext.Config.allowPrintLog(2)&&console.warn("ready to connect leeches: "+b()(a)),u=new Array,n.p2pContext.Config.useSeedBox){for(l=0;l<n.p2pContext.Config.sliceCount;l++)(f=o.seedboxes.get(l.toString()))&&(h=n.getSeedboxNeedConnectNum(l))>0&&(u=ct()(u).call(u,I()(p=r(f)).call(p,0,h)));n.p2pContext.printExtLog(2,"ready to connect seedboxes: "+b()(u)),n.p2pContext.Config.allowPrintLog(2)&&console.warn("ready to connect seedboxes: "+b()(u))}d=new Array,P()(u).call(u,function(t){var e=n.createConnectPeerTask(t);null!=e&&d.push(e)}),P()(a).call(a,function(t){var e=n.createConnectPeerTask(t);null!=e&&d.push(e)}),P()(i).call(i,function(t){var e=n.createConnectPeerTask(t);null!=e&&d.push(e)}),v=0,g=d;case 25:if(!(v<g.length)){t.next=32;break}return y=g[v],t.next=29,y();case 29:v++,t.next=25;break;case 32:return x=performance.now(),m=x-e,(w=n.p2pContext.Config.getPeersIntervalMs-m)<0&&(w=0),t.next=38,new D.a(function(t){return E()(function(){return t()},w)});case 38:case"end":return t.stop()}},t)});case 1:if(this.cancelToken.hasCancel){t.next=5;break}return t.delegateYield(e(),"t0",3);case 3:t.next=1;break;case 5:case"end":return t.stop()}},t,this)})),function(){return r.apply(this,arguments)})},{key:"IteratorToArray",value:function(t){for(var e=new Array;;){var n=t.next();if(n.done)break;e.push(n.value)}return e}},{key:"getConnectedPeers",value:function(){var t,e;return lt()(t=this.IteratorToArray(ht()(e=this.connectedPeers).call(e))).call(t,function(t){return t})}},{key:"getConnectingPeers",value:function(){var t,e,n;return ct()(t=this.IteratorToArray(ht()(e=this.pendingIncomingPeers).call(e))).call(t,this.IteratorToArray(ht()(n=this.pendingOutcomingPeers).call(n)))}},{key:"onConnectionStatusChanged",value:function(){this.updateAllSeedboxConnectNumBySlice(),this.checkVisibilityStateNeedChange(),this.connectCV.notifyAll()}},{key:"onPeerConnectComplete",value:function(t,e){try{if(!1===t.isIncoming()?this.pendingOutcomingPeers.delete(t.extData.peerId):this.pendingIncomingPeers.delete(t.extData.peerId),"sym"===t.natType&&this.p2pContext.P2P.nat.onSymmetricConnect(e),!1===e)return void t.close();if(this.cancelToken.hasCancel)return this.p2pContext.printExtLog(2,"Cancel connect. target peerId: "+t.extData.peerId+" when cur peerId: "+this.p2pContext.CurPeerId),this.p2pContext.Config.allowPrintLog(2)&&console.warn("Cancel connect. target peerId: "+t.extData.peerId+" when cur peerId: "+this.p2pContext.CurPeerId),void this.onPeerDisConnected(t);try{this.p2pContext.printExtLog(2,"peer connected: id:"+t.extData.peerId),this.p2pContext.Config.allowPrintLog(2)&&console.log("peer connected: id:"+t.extData.peerId),!1===this.connectedPeers.has(t.extData.peerId)&&this.connectedPeers.set(t.extData.peerId,new Array),this.connectedPeers.get(t.extData.peerId).push(t)}catch(t){console.log(t)}}finally{this.onConnectionStatusChanged()}}},{key:"onPeerDisConnected",value:function(t){try{t.close(),t.terminateAllPendingRequests();var e=this.connectedPeers.get(t.extData.peerId);if(void 0!==e){var n=nt()(e).call(e,function(e){return e!=t});n.length>0?(this.p2pContext.printExtLog(2,"remove peerId ".concat(t.extData.peerId," connect.")),this.p2pContext.Config.allowPrintLog(2)&&console.log("remove peerId ".concat(t.extData.peerId," connect.")),this.connectedPeers.set(t.extData.peerId,n)):(this.p2pContext.printExtLog(2,"clear empty peerId ".concat(t.extData.peerId," connect from connectedPeers.")),this.p2pContext.Config.allowPrintLog(2)&&console.log("clear empty peerId ".concat(t.extData.peerId," connect from connectedPeers.")),this.connectedPeers.delete(t.extData.peerId))}}finally{this.onConnectionStatusChanged()}}},{key:"closePeer",value:function(t){var e=this,n=this.connectedPeers.get(t);void 0!==n&&P()(n).call(n,function(t){e.onPeerDisConnected(t)})}},{key:"initSliceId",value:function(t){void 0!==t&&this.curSliceIds.add(t)}},{key:"addSliceId",value:function(t){this.curSliceIds.add(t)}},{key:"deleteSliceId",value:function(t){this.curSliceIds.delete(t)}},{key:"getSliceIds",value:function(){return this.curSliceIds}},{key:"onPeerRelayMessage",value:(n=u()(C.a.mark(function t(e,n,r){var o,i,a,s,c,u,l,f,h,p,d,v=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.tracker){t.next=30;break}if("connect"!=(null==n?void 0:n.action)){t.next=29;break}if(!(void 0!==this.connectedPeers.get(e)&&this.connectedPeers.get(e).length>0||1==this.cancelToken.hasCancel||0==this.allowedInConnectNewPeer()||this.p2pContext.GhostPeerIds.has(e))){t.next=7;break}1==this.cancelToken.hasCancel&&(this.p2pContext.printExtLog(2,"refused connection, because exiting from the Misaka Network."),this.p2pContext.Config.allowPrintLog(2)&&console.warn("refused connection, because exiting from the Misaka Network.")),this.tracker.sendPeerResponse(e,r,"refused"),t.next=27;break;case 7:if((null==n||null===(o=n.data)||void 0===o?void 0:o.protocol)===St.Configuration.ProtocolVersion){t.next=11;break}this.tracker.sendPeerResponse(e,r,"protocol_incompatible"),t.next=27;break;case 11:try{i=new pt.NyaPeer(this.p2pContext,this,!0)}catch(t){this.p2pContext.printExtLog(0,"create peer failed: "+t),this.p2pContext.Config.allowPrintLog(0)&&console.warn("create peer failed: "+t)}if(void 0===i){t.next=27;break}return i.natType=null!==(a=null==n||null===(s=n.data)||void 0===s?void 0:s.nat)&&void 0!==a?a:"non-sym",i.extData.peerId=e,this.pendingIncomingPeers.set(e,i),u=null==n||null===(c=n.data)||void 0===c?void 0:c.offer,i.answerNyaOffer(u,function(t){null!=v.tracker&&v.tracker.sendPeerCandidate(e,"answer",t)}).then(function(t){if(void 0!==v.tracker&&void 0!==i){var o=function(){var n;v.tracker&&v.tracker.sendPeerResponse(e,r,"ok",{answer:t,role:{type:"peer"},nat:null!==(n=Rt.getTrackerNatTypeStr(v.p2pContext.P2P.nat.getCurrentNatType()))&&void 0!==n?n:"non-sym"})};if(i.parsePeerRole(n.data.role),i.peerRole==pt.PeerRole.Seedbox){var a,s=!1;P()(a=i.seedSliceIds).call(a,function(t){v.getSeedboxNeedConnectNum(t)>0&&(s=!0)}),1==s?o():(v.p2pContext.printExtLog(2,"not need this seedbox: "+e),v.p2pContext.Config.allowPrintLog(2)&&console.log("not need this seedbox: "+e))}else o()}}).catch(function(t){v.p2pContext.printExtLog(0,"answerNyaOffer failed: "+t),v.p2pContext.Config.allowPrintLog(0)&&console.warn("answerNyaOffer failed: "+t)}),t.next=20,i.waitForConnected();case 20:if(!t.sent){t.next=24;break}this.onPeerConnectComplete(i,!0),t.next=27;break;case 24:this.onPeerConnectComplete(i,!1),this.p2pContext.printExtLog(2,"peer connect timeout "+e),this.p2pContext.Config.allowPrintLog(2)&&console.log("peer connect timeout "+e);case 27:t.next=30;break;case 29:"candidate"==(null==n?void 0:n.action)?(h=null===(l=n.data)||void 0===l?void 0:l.cand,p=null===(f=n.data)||void 0===f?void 0:f.direction,d=void 0,"offer"==p?d=this.pendingIncomingPeers.get(e):"answer"==p&&(d=this.pendingOutcomingPeers.get(e)),void 0!==d&&d.addRemoteCandidate(h)):this.tracker.sendPeerResponse(e,r,"not_implemented");case 30:case"end":return t.stop()}},t,this)})),function(t,e,r){return n.apply(this,arguments)})},{key:"onPeerRequestMessage",value:function(t,e){var n=this,r=e.requestId;switch(e.action){case"downloadAndStat":var o=e.data.frag,i=this.p2pContext.FragMan.getFragment(o),a=e.data.blockId,s=null==i?void 0:i.getBlock(a);if(null==i)t.sendResponseMessage(function(){return{requestId:r,status:"not_found"}});else if(a>=0&&void 0===s)t.sendResponseMessage(function(){return{requestId:r,status:"not_found"}});else if(i.canShare()){var c=performance.now(),u=e.data.nonblocking,l=function(){if(null==i)return null;var t=i.getDistances();return n.p2pContext.Config.enableHideOwner&&(t=at()(t).call(t,function(t){return 127&t})),t};if(void 0===s||!s.isSucceed()&&u)t.sendResponseMessage(function(){return{requestId:r,status:"ok",data:{block:null,distances:l()}}});else{var f=i.getBlockByteRange(a);i.addShareData(a,f[1]-f[0]),s.onDataResolved(function(e){null!=i&&null!=e&&t.sendResponseMessage(function(){var t;if(null!=i)return performance.now()-c>n.p2pContext.Config.uploadMaxWaitTimeoutMs?(n.p2pContext.printExtLog(2,"drop datablock response due to timeout"),void(n.p2pContext.Config.allowPrintLog(2)&&console.log("drop datablock response due to timeout"))):(null===(t=n.p2pContext.P2PDataCollectionStatus)||void 0===t||t.addP2PSendSizeRealtime(e.byteLength),{requestId:r,status:"ok",data:{block:e,distances:l()}})})})}}else this.p2pContext.printExtLog(2,(null==i?void 0:i.getFragmentName())+" is overload"),this.p2pContext.Config.allowPrintLog(2)&&console.warn((null==i?void 0:i.getFragmentName())+" is overload"),t.sendResponseMessage(function(){return{requestId:r,status:"overload"}})}}},{key:"reportDownloadBlockSuccess",value:function(t){var e;t.extData.isDownloadBlockReport||(this.p2pContext.P2PDataCollectionStatus.addPeerConnectCount(!1,!0),Math.random()<this.p2pContext.Config.reportPeerSuccessProbability&&(null===(e=this.tracker)||void 0===e||e.reportDownloadBlockSuccessOrAwaysFail(t.extData.peerId,!0)),t.extData.isDownloadBlockReport=!0)}},{key:"reportDownloadBlockAwaysFail",value:function(t){var e;this.p2pContext.P2PDataCollectionStatus.addPeerConnectCount(!1,!1),Math.random()<this.p2pContext.Config.reportPeerFailedProbability&&(null===(e=this.tracker)||void 0===e||e.reportDownloadBlockSuccessOrAwaysFail(t.extData.peerId,!1))}},{key:"reportConnectionAbort",value:function(t){this.p2pContext.P2PDataCollectionStatus.addPeerConnectCount(!0,!1)}},{key:"destroy",value:function(){var t,e,n,r=this;null!=this.tracker&&(this.tracker.destroy(),this.tracker=void 0),P()(t=this.pendingIncomingPeers).call(t,function(t){t.close()}),P()(e=this.pendingOutcomingPeers).call(e,function(t){t.close()}),P()(n=this.getConnectedPeers()).call(n,function(t){r.onPeerDisConnected(t)})}}],[{key:"create",value:(e=u()(C.a.mark(function e(n,r,o,i){var a,s;return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new t(n,r,o,i)).trackerConnecting=!0,e.next=4,Tt.connect(n,o,a,i);case 4:return s=e.sent,a.tracker=s,a.trackerConnecting=!1,e.abrupt("return",a);case 8:case"end":return e.stop()}},e)})),function(t,n,r,o){return e.apply(this,arguments)})}]),t}(),Lt=n(119),Ft=n.n(Lt),Ot=n(120),Ut=n.n(Ot),Nt=n(81),Mt=n.n(Nt),Bt=n(11);function _t(t,e){var n=void 0!==Ut.a&&Mt()(t)||t["@@iterator"];if(!n){if(yt()(t)||(n=function(t,e){var n;if(t){if("string"==typeof t)return zt(t,e);var r=I()(n=Object.prototype.toString.call(t)).call(n,8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Ft()(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?zt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function zt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var jt,qt=function(){function t(e,n){p()(this,t),y()(this,"localDistanceChanged",Array()),y()(this,"p2pCtx",void 0),y()(this,"frag",void 0),y()(this,"blockMinDistances",void 0),this.frag=n,this.p2pCtx=e;var r=n.getBlockCount();this.blockMinDistances=new Uint8Array(r);for(var o=0;o<r;++o)this.blockMinDistances[o]=e.Config.maxDistance}return v()(t,[{key:"updateLocalDistances",value:function(t){t(this.frag.getDistances());var e,n=_t(this.localDistanceChanged);try{for(n.s();!(e=n.n()).done;)(0,e.value)()}catch(t){n.e(t)}finally{n.f()}}}]),t}(),Wt=function(){function t(e,n){var r=this;p()(this,t),y()(this,"ctx",void 0),y()(this,"peer",void 0),y()(this,"updateDistancesTS",null),y()(this,"distancesUpdateLock",new xt.c),y()(this,"distances",null),y()(this,"isDistanceFinal",!1),y()(this,"taskAvailableMutex",new xt.c),y()(this,"taskAvailableCV",new xt.a),y()(this,"blockIds",void 0),y()(this,"abandoned",!1),this.ctx=e,this.peer=n,e.frag.onFinished(function(){r.stopAllInstance()}),e.localDistanceChanged.push(function(){r.wakeUpWorkers()});var o=!1;if(e.p2pCtx.Config.enableReverseOrder){var i=this.peer.extData.peerId;i.length>0&&i.charCodeAt(i.length-1)%2==0&&(o=!0)}var a=e.frag.getBlockCount();if(this.blockIds=new Uint8Array(a),o)for(var s=0;s<a;++s)this.blockIds[s]=a-1-s;else for(var c=0;c<a;++c)this.blockIds[c]=c}var e,n,r,o,i,a,s,c,l;return v()(t,[{key:"wakeUpWorkers",value:(l=u()(C.a.mark(function t(){return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.taskAvailableMutex.lock();case 2:this.taskAvailableCV.notifyAll(),this.taskAvailableMutex.unlock();case 4:case"end":return t.stop()}},t,this)})),function(){return l.apply(this,arguments)})},{key:"suspendCurrentWorker",value:(c=u()(C.a.mark(function t(){var e;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0,t.next=3,this.taskAvailableMutex.lock();case 3:return t.next=5,this.taskAvailableCV.waitUntil(this.taskAvailableMutex,function(){return e++>0});case 5:this.taskAvailableMutex.unlock();case 6:case"end":return t.stop()}},t,this)})),function(){return c.apply(this,arguments)})},{key:"launchInstance",value:(s=u()(C.a.mark(function t(){var e,n,r;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.ctx.p2pCtx.Config.allowPrintLog(5)&&console.log("start process peer "+this.peer.extData.peerId+" for "+this.ctx.frag.getFragmentName()),e=0;case 2:if(this.abandoned||this.ctx.frag.isFinished()){t.next=31;break}if(!(++e>100)){t.next=7;break}return console.warn("p2pdownloader instance: loop too many times"),t.abrupt("return");case 7:return t.next=9,this.updateDistance(!1);case 9:if(!((n=t.sent)<0)){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,this.runDownloadLoop();case 14:if(!((r=t.sent)<0)){t.next=17;break}return t.abrupt("return");case 17:if(0!=n||0!=r){t.next=28;break}return t.next=20,this.updateDistance(!0);case 20:if(!((n=t.sent)<0)){t.next=25;break}return t.abrupt("return");case 25:if(0!=n){t.next=28;break}return t.next=28,this.suspendCurrentWorker();case 28:t.next=2;break;case 31:case"end":return t.stop()}},t,this)})),function(){return s.apply(this,arguments)})},{key:"stopAllInstance",value:function(){this.abandoned=!0,this.wakeUpWorkers()}},{key:"sendRequest",value:(a=u()(C.a.mark(function t(e){var n,r=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.peer.sendRequestMessage(function(){if(!r.abandoned)return e()});case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)})),function(t){return a.apply(this,arguments)})},{key:"ban",value:function(){var t;this.ctx.p2pCtx.Config.allowPrintLog(1)&&console.log("ban peer "+this.peer.extData.peerId),this.ctx.p2pCtx.GhostPeerIds.add(this.peer.extData.peerId),null===(t=this.ctx.p2pCtx.PeerSched)||void 0===t||t.closePeer(this.peer.extData.peerId),this.stopAllInstance()}},{key:"setRemoteDistance",value:function(t){var e=!1;if(null==this.distances)e=!0;else{var n=this.distances.length;if(t.length!=n)return!1;for(var r=0;r<n&&t[r]==this.distances[r];++r);r<n&&(e=!0)}return t.length==nt()(t).call(t,function(t){return 0==(127&t)}).length&&(this.isDistanceFinal=!0),this.distances=t,this.updateDistancesTS=performance.now(),e&&this.wakeUpWorkers(),!0}},{key:"sendGetProgress",value:(i=u()(C.a.mark(function t(){var e=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRequest(function(){return{action:"downloadAndStat",data:{frag:e.ctx.frag.getFragmentName(),blockId:-1,nonblocking:!0}}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"sendDownloadBlock",value:(o=u()(C.a.mark(function t(e){var n=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRequest(function(){return{action:"downloadAndStat",data:{frag:n.ctx.frag.getFragmentName(),blockId:e,nonblocking:!1}}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"updateDistance",value:(r=u()(C.a.mark(function t(e){var n,r,o,i;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.distancesUpdateLock.isLocked()){t.next=2;break}return t.abrupt("return",0);case 2:return t.next=4,this.distancesUpdateLock.lock();case 4:if(t.prev=4,!this.abandoned){t.next=7;break}return t.abrupt("return",-1);case 7:if(null==this.updateDistancesTS){t.next=16;break}if(n=this.updateDistancesTS+this.ctx.p2pCtx.Config.refreshPeerProgressIntervalMs-performance.now(),!((n=Math.min(n,this.ctx.p2pCtx.Config.refreshPeerProgressIntervalMs))>0)||e){t.next=14;break}return t.abrupt("return",0);case 14:return t.next=16,new D.a(function(t){return E()(t,n)});case 16:if(!this.abandoned){t.next=18;break}return t.abrupt("return",-1);case 18:if(!this.isDistanceFinal){t.next=20;break}return t.abrupt("return",0);case 20:return t.next=22,this.sendGetProgress();case 22:if(null!=(r=t.sent)&&"overload"!=r.status){t.next=27;break}return t.abrupt("return",-1);case 27:if("not_found"!=r.status){t.next=31;break}this.updateDistancesTS=performance.now(),t.next=36;break;case 31:if("ok"!=r.status){t.next=36;break}if(i=null===(o=r.data)||void 0===o?void 0:o.distances,this.setRemoteDistance(i)){t.next=36;break}return this.ban(),t.abrupt("return",-1);case 36:return t.abrupt("return",1);case 37:return t.prev=37,this.distancesUpdateLock.unlock(),t.finish(37);case 40:case"end":return t.stop()}},t,this,[[4,,37,40]])})),function(t){return r.apply(this,arguments)})},{key:"doDownload",value:(n=u()(C.a.mark(function t(e,n){var r,o,i,a,s,c,u,l,f,h,p,d,v,g,y,x,m,w;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.peer.peerRole==pt.PeerRole.Seedbox?Bt.d.TX_SEEDBOX:Bt.d.TX_PEER,o=this.peer.peerRole==pt.PeerRole.Seedbox?Bt.d.RX_SEEDBOX:Bt.d.RX_PEER,i=this.peer.peerRole==pt.PeerRole.Seedbox?Bt.d.LAG_SEEDBOX:Bt.d.LAG_PEER,a=this.peer.peerRole==pt.PeerRole.Seedbox?Bt.a.SEED:Bt.a.EXCHANGE,(s=this.ctx.frag.getDistances())[e]=128&s[e]|n,c=!1,t.prev=7,u=performance.now(),t.next=11,this.sendDownloadBlock(e);case 11:if(void 0===(l=t.sent)||(!1===l?this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(r,1):(this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(i,Math.round(performance.now()-u)),this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(r,1),this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(o,1))),null!=l&&"overload"!=l.status&&"not_found"!=l.status){t.next=17;break}return t.abrupt("return",!1);case 17:if("ok"!=l.status){t.next=38;break}if(g=null!==(f=null===(h=l.data)||void 0===h||null===(p=h.block)||void 0===p?void 0:p.byteLength)&&void 0!==f?f:0,null==(y=null===(d=l.data)||void 0===d?void 0:d.distances)||this.setRemoteDistance(y)){t.next=24;break}return this.ctx.p2pCtx.P2PDataCollectionStatus.addWastedDataSize(g,Bt.e.ERROR_DATA),this.ban(),t.abrupt("return",!1);case 24:if(null!=(x=null===(v=l.data)||void 0===v?void 0:v.block)&&null!=x){t.next=27;break}return t.abrupt("return",!1);case 27:if((m=this.ctx.frag.getBlockByteRange(e))[1]-m[0]==x.length){t.next=32;break}return this.ctx.p2pCtx.P2PDataCollectionStatus.addWastedDataSize(g,Bt.e.ERROR_DATA),this.ban(),t.abrupt("return",!1);case 32:return this.ctx.frag.setBlockData(e,x,tt.b.P2P,a,this.peer.extData.peerId)||this.ctx.p2pCtx.P2PDataCollectionStatus.addWastedDataSize(g,Bt.e.P2P_LATE),c=!0,t.abrupt("return",!0);case 38:return t.abrupt("return",!1);case 39:return t.prev=39,c?(null===(w=this.ctx.p2pCtx.PeerSched)||void 0===w||w.reportDownloadBlockSuccess(this.peer),this.peer.onDownloadBlockSucceed()):(this.ctx.updateLocalDistances(function(t){return t[e]|=127}),this.peer.onDownloadBlockFailed()),t.finish(39);case 42:case"end":return t.stop()}},t,this,[[7,,39,42]])})),function(t,e){return n.apply(this,arguments)})},{key:"runDownloadLoop",value:(e=u()(C.a.mark(function t(){var e,n,r,o,i,a,s,c,u,l;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=0,null!=this.distances){t.next=3;break}return t.abrupt("return",e);case 3:n=this.ctx.frag.getDistances(),r=this.distances;case 5:if(this.abandoned||this.ctx.frag.isFinished()){t.next=54;break}o=-1,i=127,a=0;case 9:if(!(a<2)){t.next=42;break}s=_t(this.blockIds),t.prev=11,s.s();case 13:if((c=s.n()).done){t.next=27;break}if(u=c.value,0!=a||128!=(128&r[u])){t.next=17;break}return t.abrupt("continue",25);case 17:if(127==(127&n[u])){t.next=19;break}return t.abrupt("continue",25);case 19:if(!((l=127&r[u])>this.ctx.blockMinDistances[u])){t.next=22;break}return t.abrupt("continue",25);case 22:if(l<i&&(o=u,i=l),0!=i){t.next=25;break}return t.abrupt("break",27);case 25:t.next=13;break;case 27:t.next=32;break;case 29:t.prev=29,t.t0=t.catch(11),s.e(t.t0);case 32:return t.prev=32,s.f(),t.finish(32);case 35:if(!(o>=0)){t.next=37;break}return t.abrupt("break",42);case 37:if(0!=i){t.next=39;break}return t.abrupt("break",42);case 39:++a,t.next=9;break;case 42:if(!(o<0)){t.next=44;break}return t.abrupt("break",54);case 44:return this.ctx.blockMinDistances[o]=Math.max(3,127&r[o]),t.next=47,this.doDownload(o,i+2);case 47:if(!t.sent){t.next=51;break}++e,t.next=52;break;case 51:return t.abrupt("return",-1);case 52:t.next=5;break;case 54:return t.abrupt("return",e);case 55:case"end":return t.stop()}},t,this,[[11,29,32,35]])})),function(){return e.apply(this,arguments)})}]),t}(),Vt=function(){function t(e){p()(this,t),y()(this,"peerFragWorkers",new Array),y()(this,"frag",void 0),this.frag=e}var e;return v()(t,[{key:"startDownload",value:(e=u()(C.a.mark(function t(e,n){var r,o,i,a,s,c,u,l,f,h,p,d,v,g,y,x,m,w,k,b,S,P=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:o=this.frag.getDistances(),i=new Array,a=_t(this.frag.getSliceIds());try{for(a.s();!(s=a.n()).done;)for(c=s.value,i.push(c),u=this.frag.getSliceBlockRange(c),l=u[0];l<u[l];++l)o[l]=128&o[l]|1}catch(t){a.e(t)}finally{a.f()}for(f=new qt(e.getP2PContext(),this.frag),this.frag.isUseSeedboxEnabled()&&(g=nt()(h=nt()(p=e.getConnectedPeers()).call(p,function(t){return t.peerRole==pt.PeerRole.Seedbox})).call(h,function(t){return t.shouldUsedAsSeed()}),i=at()(d=nt()(v=at()(i).call(i,function(t){return{sliceid:t,seedboxes:nt()(g).call(g,function(e){return e.seedSliceIds.has(t)})}})).call(v,function(t){if(t.seedboxes.length>0){var e=P.frag.getSliceBlockRange(t.sliceid);if(2==e.length&&e[1]-e[0]>0)for(var n=new Array(t.seedboxes.length),r=e[0];r<e[1];++r){var o,i=r%n.length;null==n[i]&&(n[i]=new Wt(f,t.seedboxes[i])),null===(o=n[i])||void 0===o||o.doDownload(r,1)}return!1}return!0})).call(d,function(t){return t.sliceid})),n(i),y=nt()(r=e.getConnectedPeers()).call(r,function(t){return t.peerRole==pt.PeerRole.Peer}),x=e.getP2PContext().Config,m=Math.min(x.totalDownloadInstances,y.length),w=Math.min(x.totalDownloadInstances,y.length*x.maxDownloadInstancesPerPeer),k=0;k<m;++k)this.peerFragWorkers.push(new Wt(f,y[k]));for(b=[],S=0;S<w;++S)b.push(this.peerFragWorkers[S%m].launchInstance());return t.next=16,D.a.all(b);case 16:return t.abrupt("return");case 17:case"end":return t.stop()}},t,this)})),function(t,n){return e.apply(this,arguments)})},{key:"stopDownload",value:function(){var t,e=_t(this.peerFragWorkers);try{for(e.s();!(t=e.n()).done;)t.value.stopAllInstance()}catch(t){e.e(t)}finally{e.f()}}}]),t}(),Gt=function(){function t(e,n){p()(this,t),y()(this,"url",void 0),y()(this,"p2pContext",void 0),this.p2pContext=e,this.url=n}return v()(t,[{key:"FetchSize",value:function(t){var e=this;return null==t&&(t=!1),new D.a(function(n){fetch(e.url,{method:"HEAD",cache:t?"default":"no-store"}).then(function(t){if(e.p2pContext.P2PDataCollectionStatus.addFetchResponseHeadersCount(t.headers),t.ok&&null!=t.headers.get("Content-Length")){var r=At()(t.headers.get("Content-Length"));n(null!=r?r:void 0)}else n(void 0)}).catch(function(t){n(void 0)})})}},{key:"FetchPart",value:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0;null==o&&(o=!1);var i={};n>=0&&r>0&&(i.Range="bytes="+n+"-"+(r-1));var a,s=!!window.AbortController,c={mode:"cors",method:"GET",headers:i,cache:o?"default":"no-store"};return s&&(a=new AbortController,c.signal=a.signal),new D.a(function(n){var r=E()(function(){a&&a.abort(),n({state:{ok:!1,msg:"HTTP Part fetch response timeout "+t+" ms, aborted when CDN fetching"},data:void 0})},t);fetch(e.url,c).then(function(t){if(e.p2pContext.P2PDataCollectionStatus.addFetchResponseHeadersCount(t.headers),t.ok){if(clearTimeout(r),null!=t.body)return t.arrayBuffer();n({state:{ok:!1,msg:"HTTP Part fetch empty body, status code: "+t.status.toString()+" ("+t.statusText+")"},data:void 0})}else n({state:{ok:!1,msg:"HTTP Part fetch error, status code: "+t.status.toString()+" ("+t.statusText+")"},data:void 0})}).then(function(t){var e=new Uint8Array(t);n({state:{ok:!0,msg:"ok"},data:e})}).catch(function(t){n({state:{ok:!1,msg:"HTTP Part fetch error, message: "+t.toString()},data:void 0})})})}},{key:"FetchPartByBlock",value:function(t,e,n,r,o,i){var a=this;if(r==o)return new D.a(function(t){t({ok:!0,msg:"ok"})});null==i&&(i=!1);var s={};r>=0&&o>0&&(s.Range="bytes="+r+"-"+(o-1));var c,u=!!window.AbortController,l={mode:"cors",method:"GET",headers:s,cache:i?"default":"no-store"},f=!1;return u&&(c=new AbortController,l.signal=c.signal),new D.a(function(r){var o=E()(function(){c&&c.abort(),f=!0,r({ok:!1,msg:"HTTP Stream fetch response timeout "+t+" ms, aborted when CDN fetching"})},t);fetch(a.url,l).then(function(t){if(a.p2pContext.P2PDataCollectionStatus.addFetchResponseHeadersCount(t.headers),t.ok){if(null!=t.body)return clearTimeout(o),t.body;r({ok:!1,msg:"HTTP Stream fetch empty body, status code: "+t.status.toString()+" ("+t.statusText+")"})}else r({ok:!1,msg:"HTTP Stream fetch error, status code: "+t.status.toString()+" ("+t.statusText+")"})}).then(function(t){var o=null==t?void 0:t.getReader(),i=new Uint8Array(0),a=0;null==o||o.read().then(function t(s){if(!1===f)if(void 0!==s.value){var c=s.value;if(i.length>0){var u=new Uint8Array(i.length+c.length);u.set(i,0),u.set(c,i.length),c=u}for(var l,h=0;;){if(!((l=c.subarray(h,h+n)).length>=n)){i=l;break}e(l,a++,!1),i=new Uint8Array(0),h+=n}s.done?(e(i,a++,!0),r({ok:!0,msg:"ok"})):null==o||o.read().then(t).catch(function(t){r({ok:!1,msg:"HTTP Stream fetch reader error, message: "+t.toString()})})}else s.done&&(e(i,a++,!0),r({ok:!0,msg:"ok"}))}).catch(function(t){r({ok:!1,msg:"HTTP Stream fetch reader error, message: "+t.toString()})})}).catch(function(t){r({ok:!1,msg:"HTTP Stream fetch error, message: "+t.toString()})})})}}]),t}(),Ht=function(){function t(e){p()(this,t),y()(this,"p2pContext",void 0),y()(this,"fragMan",void 0),y()(this,"downloadForceStopArray",new w.a),this.p2pContext=e,this.fragMan=new tt.d(this.p2pContext)}return v()(t,[{key:"addDownloadTask",value:function(t,e,n){return this.fragMan.addFragment(t,e,n)}},{key:"startDownload",value:function(t,e,n,r){var o=this,i=this.fragMan.getFragment(n);if(null!=i){var a=i;void 0!==t&&a.setSliceIds(t.getSliceIds());var s=new Gt(this.p2pContext,e);if(a.setCrcErrorCallback(function(){o.checkFragmentData(a,s)}),0!=a.getFragmentSize())if(null==t||void 0!==t&&0==t.getConnectedPeers().length)this.p2pContext.CDNFetchTaskWorker.post(function(){return a.doOnceQueryServer(),s.FetchPartByBlock(o.p2pContext.Config.fetchCDNTimeoutMs,function(t,e,n){e>=0&&e<a.getBlockCount()&&a.setBlockData(e,t,tt.b.SERVER,tt.a.SEED)||o.p2pContext.P2PDataCollectionStatus.addWastedDataSize(t.byteLength,Bt.e.CDN_REPEAT,{fragname:a.getFragmentName(),sliceIds:a.getSliceIds()})},a.getBlockSize(),0,a.getFragmentSize())},!1).then(function(t){null!=t&&t.ok||a.setNonP2PFragmentData(void 0,tt.a.SEED,null==t?void 0:t.msg)});else{var c=function(t){if(t.length>1){var e=G()(t).call(t),n=new Array;P()(e).call(e,function(t){var e=a.getSliceBlockRange(t);n.push(e[0]),n.push(e[1])});for(var r=-1,i=-1,c=0;c<n.length;c+=2)-1==r?(r=n[c],i=n[c+1]):(i==n[c]||(null!=i&&r!=i&&i-1>=0&&o.pullFragmentData(a,s,r,i-1,tt.a.SEED),r=n[c]),i=n[c+1]);null!=r&&null!=i&&r!=i&&i-1>=0&&o.pullFragmentData(a,s,r,i-1,tt.a.SEED)}else P()(t).call(t,function(t){var e=a.getSliceBlockRange(t);e[0]>=0&&e[1]>0&&e[0]!=e[1]&&e[1]-1>=0&&o.pullFragmentData(a,s,e[0],e[1]-1,tt.a.SEED)})},l=new Vt(a),f=Array();if(null!=r){var h=new D.a(function(t){E()(function(){t(!1)},r)});f.push(h)}var p=new D.a(function(t){o.downloadForceStopArray.set(n,t)});f.push(p);var d=new D.a(function(t){a.onFinished(function(e){t(!0)})});f.push(d);var v=new D.a(function(){var e=u()(C.a.mark(function e(n){return C.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.startDownload(t,c);case 2:n(!1);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());f.push(v),D.a.race(f).then(function(t){o.stopDownload(a.getFragmentName()),t||(l.stopDownload(),o.checkFragmentData(a,s))})}else this.p2pContext.FallbackFetchTaskWorker.post(function(){return a.doOnceQueryServer(),s.FetchPart(o.p2pContext.Config.fetchCDNTimeoutMs)},!1).then(function(t){null!=t&&t.state.ok?a.setNonP2PFragmentData(t.data,tt.a.LACKED):a.setNonP2PFragmentData(void 0,tt.a.LACKED,null==t?void 0:t.state.msg)})}}},{key:"checkFragmentData",value:function(t,e){for(var n=void 0,r=0;r<t.getBlockCount();++r)t.isBlockFinished(r)&&null!=n?(this.pullFragmentData(t,e,n,r-1,tt.a.LACKED),n=void 0):t.isBlockFinished(r)||null!=n||(n=r);null!=n&&this.pullFragmentData(t,e,n,t.getBlockCount()-1,tt.a.LACKED)}},{key:"pullFragmentData",value:function(t,e,n,r,o){var i=this;this.p2pContext.FallbackFetchTaskWorker.post(function(){return t.getBlockByteRange(n)[0]==t.getBlockByteRange(r)[1]?new D.a(function(t){t({ok:!0,msg:"ok"})}):(t.doOnceQueryServer(),e.FetchPartByBlock(i.p2pContext.Config.fetchCDNTimeoutMs,function(e,a,s){(a+=n)>=n&&a<=r&&t.setBlockData(a,e,tt.b.SERVER,o)||i.p2pContext.P2PDataCollectionStatus.addWastedDataSize(e.byteLength,Bt.e.CDN_REPEAT,{fragname:t.getFragmentName(),sliceIds:t.getSliceIds()})},t.getBlockSize(),t.getBlockByteRange(n)[0],t.getBlockByteRange(r)[1]))},!1).then(function(e){null!=e&&e.ok||t.setNonP2PFragmentData(void 0,o,null==e?void 0:e.msg)})}},{key:"stopDownload",value:function(t){var e=this.downloadForceStopArray.get(t);null!=e&&(this.downloadForceStopArray.delete(t),e(!1))}},{key:"destroy",value:function(){var t;P()(t=this.downloadForceStopArray).call(t,function(t){t(!1)}),this.downloadForceStopArray.clear()}}]),t}(),Yt=n(29),Qt=n.n(Yt),Kt=n(122),Xt=n.n(Kt),$t=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];p()(this,t),y()(this,"maxLine",255),y()(this,"logBuffer",[]),y()(this,"isStart",!1),this.maxLine=e,this.isStart=n}return v()(t,[{key:"formatTime",value:function(t){var e,n,r,o,i,a=function(t,e){for(var n=t.toString();n.length<e;)n="0"+n;return n};return ct()(e=ct()(n=ct()(r=ct()(o=ct()(i="".concat(a(t.getMonth()+1,2),"-")).call(i,a(t.getDate(),2)," ")).call(o,a(t.getHours(),2),":")).call(r,a(t.getMinutes(),2),":")).call(n,a(t.getSeconds(),2),".")).call(e,a(t.getMilliseconds(),3))}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.isStart)for(this.logBuffer.push(this.formatTime(new Date)+" : "+t);this.logBuffer.length>this.maxLine;)this.logBuffer.shift()}},{key:"start",value:function(){this.isStart=!0}},{key:"stop",value:function(){this.isStart=!1}},{key:"clear",value:function(){var t;Qt()(t=this.logBuffer).call(t,0,this.logBuffer.length)}},{key:"get",value:function(){var t,e="";return P()(t=this.logBuffer).call(t,function(t){e+=t+"\n"}),e}},{key:"download",value:function(){var t=document.createElement("a");t.href=Xt.a.createObjectURL(new Blob([this.get()])),t.download="logfile.log",t.click(),Xt.a.revokeObjectURL(t.href)}}]),t}(),Jt=function(){function t(e){p()(this,t),y()(this,"elements",void 0),y()(this,"_size",void 0),this.elements=new Array,this._size=e}return v()(t,[{key:"push",value:function(t){return this.elements.length==this._size&&this.pop(),this.elements.push(t),!0}},{key:"pop",value:function(){return this.elements.shift()}},{key:"front",value:function(){return this.elements.length>0?this.elements[0]:void 0}},{key:"forEach",value:function(t,e){var n;P()(n=this.elements).call(n,t)}},{key:"size",value:function(){return this.elements.length}},{key:"empty",value:function(){return 0==this.size()}},{key:"clear",value:function(){this.elements=new Array}}]),t}(),Zt=function(){function t(e,n){var r=this;p()(this,t),y()(this,"p2pContext",void 0),y()(this,"lackedDataArray",void 0),y()(this,"currentShareDataLMQueue",void 0),y()(this,"lastestShareDataArray",void 0),y()(this,"sched",void 0),y()(this,"fetchControlIntervalId",void 0),y()(this,"shareControlIntervalId",void 0),y()(this,"lastestShareSliceIds",new j.a),y()(this,"intervalMSChangeId",void 0),this.p2pContext=e,this.sched=n,this.lackedDataArray=new Array(this.p2pContext.Config.sliceCount),this.currentShareDataLMQueue=new Jt(this.p2pContext.Config.p2pFetchDataObCycleCount),this.lastestShareDataArray=new Array(this.p2pContext.Config.sliceCount);for(var o=0;o<this.p2pContext.Config.sliceCount;++o)this.lackedDataArray[o]=new Jt(this.p2pContext.Config.p2pFetchDataObCycleCount),this.lastestShareDataArray[o]=new Jt(this.p2pContext.Config.p2pShareDataObCycleCount);this.startSliceIdControl(),this.intervalMSChangeId=e.sliceIdAutoChangeIntervalSignal.connect(function(){r.startSliceIdControl()})}return v()(t,[{key:"startSliceIdControl",value:function(){var t=this;this.stopSliceIdControl(),this.fetchControlIntervalId=W()(function(){t.checkFetch()},this.p2pContext.Config.p2pSliceIdControlFetchCheckIntervalMs),this.shareControlIntervalId=W()(function(){t.checkShare()},this.p2pContext.Config.p2pSliceIdControlShareCheckIntervalMs)}},{key:"stopSliceIdControl",value:function(){void 0!==this.fetchControlIntervalId&&(clearInterval(this.fetchControlIntervalId),this.fetchControlIntervalId=void 0),void 0!==this.shareControlIntervalId&&(clearInterval(this.shareControlIntervalId),this.shareControlIntervalId=void 0),this.currentShareDataLMQueue.clear();for(var t=0;t<this.p2pContext.Config.sliceCount;++t)this.lackedDataArray[t].clear(),this.lastestShareDataArray[t].clear()}},{key:"addFragmentFetchData",value:function(t){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){if(!this.isSame(this.sched.getSliceIds(),t.getSliceIds())){void 0!==this.fetchControlIntervalId&&this.checkFetch();for(var e=0;e<this.p2pContext.Config.sliceCount;++e)this.lackedDataArray[e].clear(),this.currentShareDataLMQueue.clear()}for(e=0;e<this.p2pContext.Config.sliceCount;++e)this.lackedDataArray[e].push(t.getRoleRatioForSlice(Bt.a.LACKED,e));this.currentShareDataLMQueue.push(t.getSharedRatio())}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"isSame",value:function(t,e){if(t.size==e.size){var n=!0;return P()(t).call(t,function(t){e.has(t)||(n=!1)}),n}return!1}},{key:"addFragmentShareData",value:function(t){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){var e=!0;if(void 0!==this.lastestShareSliceIds&&(e=this.isSame(this.lastestShareSliceIds,t.getSliceIds())),!e){void 0!==this.shareControlIntervalId&&this.checkShare();for(var n=0;n<this.p2pContext.Config.sliceCount;++n)this.lastestShareDataArray[n].clear()}for(n=0;n<this.p2pContext.Config.sliceCount;++n)this.lastestShareDataArray[n].push(t.getSliceSharedRatio(n));this.lastestShareSliceIds=t.getSliceIds()}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"checkFetch",value:function(){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){if(!(this.lackedDataArray[0].size()<this.p2pContext.Config.p2pFetchDataObCycleCount))for(var t=0;t<this.p2pContext.Config.sliceCount;++t){var e,n,r=0;P()(e=this.lackedDataArray[t]).call(e,function(t){r+=t}),r/=this.lackedDataArray[t].size();var o=0;P()(n=this.currentShareDataLMQueue).call(n,function(t){o+=t}),o/=this.currentShareDataLMQueue.size(),!this.sched.getSliceIds().has(t)&&o<this.p2pContext.Config.p2pShareLargestAllowedFetchRatio*this.p2pContext.Config.fragmentShareOverride&&r>=this.p2pContext.Config.p2pFetchLowestRatio&&(this.p2pContext.printExtLog(4,"fetch: want to add "+t),this.p2pContext.Config.allowPrintLog(4)&&console.log("fetch: want to add "+t),Math.random()<this.p2pContext.Config.p2pAddSliceProbability&&this.sched.addSliceId(t))}}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"checkShare",value:function(){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){if(!(this.lastestShareDataArray[0].size()<this.p2pContext.Config.p2pShareDataObCycleCount))for(var t=0;t<this.p2pContext.Config.sliceCount;++t){var e,n=0;P()(e=this.lastestShareDataArray[t]).call(e,function(t){n+=t}),n/=this.lastestShareDataArray[t].size(),this.lastestShareSliceIds.has(t)&&n<=this.p2pContext.Config.p2pShareLowestRatio&&(this.p2pContext.printExtLog(4,"share: want to delete "+t),this.p2pContext.Config.allowPrintLog(4)&&console.log("share: want to delete "+t),Math.random()<this.p2pContext.Config.p2pDeleteSliceProbability&&this.sched.deleteSliceId(t))}}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"destroy",value:function(){this.stopSliceIdControl(),void 0!==this.intervalMSChangeId&&this.p2pContext.sliceIdAutoChangeIntervalSignal.disconnect(this.intervalMSChangeId)}}]),t}(),te=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;p()(this,t),y()(this,"latestWorkerId",-1),y()(this,"minAllowRunningWorkerId",0),y()(this,"tasks",[]),y()(this,"mutex",new xt.c),y()(this,"cv",new xt.a),e<0&&(e=0),this.addWorker(e)}var e,n,r;return v()(t,[{key:"post",value:(r=u()(C.a.mark(function t(e){var n,r=this,o=arguments;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=o.length>1&&void 0!==o[1]&&o[1],t.next=3,this.mutex.lock();case 3:return t.abrupt("return",new D.a(function(t){var o,i={task:(o=u()(C.a.mark(function t(){return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)})),function(){return o.apply(this,arguments)}),r:function(e){return t(e)}};n?r.tasks.unshift(i):r.tasks.push(i),r.cv.notifyOne(),r.mutex.unlock()}));case 4:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"getTask",value:(n=u()(C.a.mark(function t(e){var n,r,o=this;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=!1,t.next=3,this.mutex.lock();case 3:return t.next=5,this.cv.waitUntil(this.mutex,function(){return e<o.minAllowRunningWorkerId?(n=!0,!0):o.tasks.length>0});case 5:return!1===n&&(r=this.tasks.shift()),this.mutex.unlock(),t.abrupt("return",r);case 8:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"workerCoroutine",value:(e=u()(C.a.mark(function t(e){var n;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTask(e);case 2:if(null==(n=t.sent)){t.next=11;break}return t.t0=n,t.next=7,n.task();case 7:t.t1=t.sent,t.t0.r.call(t.t0,t.t1),t.next=12;break;case 11:return t.abrupt("break",14);case 12:t.next=0;break;case 14:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"getWorkerNum",value:function(){return this.latestWorkerId-this.minAllowRunningWorkerId+1}},{key:"addWorker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t<0&&(t=0);for(var e=0;e<t;e++)this.latestWorkerId++,this.workerCoroutine(this.latestWorkerId);return this.getWorkerNum()}},{key:"removeWorker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t<0&&(t=0);for(var e=this.getWorkerNum(),n=0;n<t&&e>0;n++)this.minAllowRunningWorkerId++,this.cv.notifyAll(),e=this.getWorkerNum();return e}},{key:"removeAllTask",value:function(){for(;this.tasks.length>0;){var t=this.tasks.pop();null!=t&&t.r(void 0)}}},{key:"removeAllWorker",value:function(){this.minAllowRunningWorkerId=this.latestWorkerId+1,this.cv.notifyAll()}},{key:"setWorkerNum",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)-this.getWorkerNum();t>0&&this.addWorker(t),t<0&&this.removeWorker(0-t)}}]),t}(),ee=n(121),ne=function(){function t(){p()(this,t),y()(this,"remainingShareQuotaQueue",new Jt(10))}return v()(t,[{key:"addFragmentDataCollection",value:function(t){this.remainingShareQuotaQueue.push(new ee.a(t.getRemainingShareQuotaBytes()))}},{key:"takeShareQuota",value:function(t){for(var e=0;!(this.remainingShareQuotaQueue.empty()||e>=t);){var n=t-e;if(n>0){var r=n,o=this.remainingShareQuotaQueue.front();r>o.data&&(r=o.data),e+=r,o.data-=r,o.data<=0&&this.remainingShareQuotaQueue.pop()}}return e}}]),t}();!function(t){t[t.DONE=0]="DONE",t[t.ERROR=1]="ERROR",t[t.NOTFOUND=2]="NOTFOUND"}(jt||(jt={}));var re,oe=function(){function t(e,n,r){var o=this;p()(this,t),y()(this,"Config",void 0),y()(this,"CDNFetchTaskWorker",new te),y()(this,"FallbackFetchTaskWorker",new te),y()(this,"P2PDataCollectionStatus",new Bt.c),y()(this,"LogFile",new $t(Number.MAX_VALUE)),y()(this,"P2P",void 0),y()(this,"CurPeerId",""),y()(this,"DataFetch",void 0),y()(this,"FragMan",void 0),y()(this,"PeerSched",void 0),y()(this,"GhostPeerIds",new j.a),y()(this,"printExtLog",void 0),y()(this,"eventReportCallback",void 0),y()(this,"sliceIdAutoChangeIntervalSignal",new xt.d),y()(this,"totalSistersCount",1),y()(this,"trackerPositionInServers",0),y()(this,"tabsCheckInterval",3e3),y()(this,"tabsCheckTimer",null),this.Config=e,this.printExtLog=n,this.eventReportCallback=r,this.compatibleRTC(),this.P2P=new ie(this),this.DataFetch=new Ht(this),this.FragMan=this.DataFetch.fragMan,this.tabsCheckTimer=W()(function(){return o.checkMultipleTabs()},this.tabsCheckInterval+100*Math.random())}return v()(t,[{key:"onConfigurationUpdate",value:function(t,e){var n=function(t,e){var n,r;return b()(G()(n=I()(t).call(t)).call(n))!==b()(G()(r=I()(e).call(e)).call(r))};Y()(t).call(t,"cdnFetchInstances")&&this.CDNFetchTaskWorker.getWorkerNum()>0&&(this.printExtLog(1,"[Notify] cdnFetchInstances: "+this.CDNFetchTaskWorker.getWorkerNum()+" -> "+this.Config.cdnFetchInstances),this.Config.allowPrintLog(1)&&console.log("[Notify] cdnFetchInstances: "+this.CDNFetchTaskWorker.getWorkerNum()+" -> "+this.Config.cdnFetchInstances),this.CDNFetchTaskWorker.setWorkerNum(this.Config.cdnFetchInstances)),Y()(t).call(t,"fallbackCDNFetchInstances")&&this.FallbackFetchTaskWorker.getWorkerNum()>0&&(this.printExtLog(1,"[Notify] fallbackCDNFetchInstances: "+this.FallbackFetchTaskWorker.getWorkerNum()+" -> "+this.Config.fallbackCDNFetchInstances),this.Config.allowPrintLog(1)&&console.log("[Notify] fallbackCDNFetchInstances: "+this.FallbackFetchTaskWorker.getWorkerNum()+" -> "+this.Config.fallbackCDNFetchInstances),this.FallbackFetchTaskWorker.setWorkerNum(this.Config.fallbackCDNFetchInstances)),null!=this.PeerSched&&this.PeerSched.onConnectionStatusChanged(),(Y()(t).call(t,"natCheckStunServers")||Y()(t).call(t,"natFilteringCheckServers"))&&(n(this.Config.natCheckStunServers,e.natCheckStunServers)||n(this.Config.natFilteringCheckServers,e.natFilteringCheckServers))&&this.P2P.resetNatType()}},{key:"setConfiguration",value:function(t){var e=this,n=function(t,n,r){if(1==r){var o="Config: "+t+" = "+b()(n);e.printExtLog(1,o),e.Config.allowPrintLog(2)&&console.log(o),e.sliceIdAutoChangeIntervalSignal.call()}else{var i="[Warning] Config: "+t+" = "+b()(n)+" not allowed.";e.printExtLog(1,i),e.Config.allowPrintLog(2)&&console.log(i)}},r=JSON.parse(b()(this.Config));try{for(var o=JSON.parse(t),i=function(){var t,r=s()(c[a],2),o=r[0],i=r[1];if(_()(o)==_()(""))switch(o){case"trackerServers":var u=[];i instanceof Array?(P()(i).call(i,function(t){_()(t)==_()("")&&(K()(t).call(t,"wss://")||K()(t).call(t,"ws://"))&&0==(K()(t).call(t,"wss:///")||K()(t).call(t,"ws:///"))?u.push(t):(e.printExtLog(1,"Value: "+i+" not tracker server address."),e.Config.allowPrintLog(1)&&console.log("Value: "+i+" not tracker server address."))}),u.length>0&&(e.Config[o]=u,e.trackerPositionInServers=0,n(o,i,!0))):n(o,i,!1);break;case"stunServers":case"natCheckStunServers":var l=[];i instanceof Array?(P()(i).call(i,function(t){_()(t)==_()("")&&new RegExp("^(stun|turn):.+?:[0-9]{1,5}$").exec(t)?l.push(t):(e.printExtLog(1,"Value: "+i+" not stun/turn server address."),e.Config.allowPrintLog(1)&&console.log("Value: "+i+" not stun/turn server address."))}),(l.length>0||"natCheckStunServers"==o)&&(e.Config[o]=l,n(o,i,!0))):n(o,i,!1);break;case"natFilteringCheckServers":i instanceof Array?(e.Config[o]=i,n(o,i,!0)):n(o,i,!1);break;default:if(e.Config.hasOwnProperty(o+"AllowedRange")&&e.Config.hasOwnProperty(o)){var f=e.Config[o+"AllowedRange"][0],h=e.Config[o+"AllowedRange"][1];e.printExtLog(2,"Key: "+o+" found range."),e.Config.allowPrintLog(2)&&console.log("Key: "+o+" found range."),_()(i)==_()(0)&&i>=f&&i<=h?(e.Config[o]=i,n(o,i,!0)):n(o,i,!1)}else e.Config.hasOwnProperty(o)&&_()(i)==_()(!0)&&F()(t=e.Config.allowedChangeBooleanValues).call(t,o)>-1?(e.Config[o]=i,n(o,i,!0)):n(o,i,!1)}},a=0,c=M()(o);a<c.length;a++)i();this.onConfigurationUpdate($()(o),r),this.eventReportCallback(new kt(o))}catch(t){this.printExtLog(1,"Parse / Set Configuration Fail: "+t),this.Config.allowPrintLog(1)&&console.warn("Parse / Set Configuration Fail: "+t)}}},{key:"destroy",value:function(){this.GhostPeerIds.clear(),this.P2P.destroy(),this.DataFetch.destroy(),this.FragMan.destroy(),this.CDNFetchTaskWorker.removeAllWorker(),this.CDNFetchTaskWorker.removeAllTask(),this.FallbackFetchTaskWorker.removeAllWorker(),this.FallbackFetchTaskWorker.removeAllTask(),null!==this.tabsCheckTimer&&clearInterval(this.tabsCheckTimer)}},{key:"compatibleRTC",value:function(){var t=window.RTCDataChannel||window.DataChannel;t&&(window.RTCDataChannel||(window.RTCDataChannel=t),window.DataChannel||(window.DataChannel=t));var e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;e&&(window.RTCPeerConnection||(window.RTCPeerConnection=e),window.mozRTCPeerConnection||(window.mozRTCPeerConnection=e),window.webkitRTCPeerConnection||(window.webkitRTCPeerConnection=e))}},{key:"checkMultipleTabs",value:function(){var t=window.localStorage;if(void 0!==t){var e=void 0,n=t.getItem("sistersInstances");if(null!==n)try{e=JSON.parse(n)}catch(t){}void 0===e&&(e=new Object);var r=Z()();e[this.CurPeerId]=r;var o=[],i=0;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var s=e[a];Math.abs(s-r)>2.5*this.tabsCheckInterval?o.push(a):++i}for(var c=0;c<o.length;++c)delete e[o[c]];t.setItem("sistersInstances",b()(e)),this.totalSistersCount=i}}}]),t}(),ie=function(){function t(e){var n=this;p()(this,t),y()(this,"p2pContext",void 0),y()(this,"cancelToken",{hasCancel:!1}),y()(this,"sliceIdController",void 0),y()(this,"P2PDataShareQuotaController",new ne),y()(this,"nat",void 0),this.p2pContext=e,this.nat=new Rt(this.p2pContext,!1,function(t){var e,r;null===(e=n.p2pContext.PeerSched)||void 0===e||null===(r=e.getTracker())||void 0===r||r.sendNatType()}),this.resetNatType()}var e;return v()(t,[{key:"resetNatType",value:function(){this.nat.checkNatTypeAndUpdate()}},{key:"initPeers",value:(e=u()(C.a.mark(function t(e){var n;return C.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Dt.create(this.p2pContext,this.cancelToken,e);case 2:n=t.sent,this.p2pContext.printExtLog(0,"Last Order is Connected."),this.p2pContext.Config.allowPrintLog(0)&&console.info("[SistersPlayer] Last Order is Connected."),1==this.cancelToken.hasCancel?n.destroy():(this.p2pContext.PeerSched=n,this.sliceIdController=new Zt(this.p2pContext,this.p2pContext.PeerSched),this.p2pContext.FragMan.setSliceIdController(this.sliceIdController),this.p2pContext.PeerSched.beginConnectPeers());case 6:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"createDownloadFragment",value:function(t,e,n){var r=this;void 0!==this.p2pContext.FragMan.getFragment(t)&&this.p2pContext.FragMan.deleteFragment(t);var o=this.p2pContext.DataFetch.addDownloadTask(t,null!=e&&e>=0?e:0,n);return null==o||o.onFinished(function(t){var e;void 0!==t&&t.getFragStat()==tt.c.END_SUCCESS?(null!=r.p2pContext.P2PDataCollectionStatus&&null!=t&&r.p2pContext.P2PDataCollectionStatus.addLastestFragmentDataCollection(t),null===(e=r.sliceIdController)||void 0===e||e.addFragmentFetchData(t)):r.p2pContext.P2PDataCollectionStatus.addFetchError(Bt.b.ERROR_TO_RELOAD)}),o}},{key:"startDownloadFragment",value:function(t,e,n,r,o){var i=this.createDownloadFragment(t,n,r);return null!=i&&this.p2pContext.DataFetch.startDownload(this.p2pContext.PeerSched,e,t,o),i}},{key:"startDownloadExtraFile",value:function(t,e,n,r,o){var i=this.createDownloadFragment(t,n,r);return null!=i&&(i.enableUseSeedbox(!1),this.p2pContext.DataFetch.startDownload(this.p2pContext.PeerSched,e,t,o)),i}},{key:"shareFragment",value:function(t,e){var n=this.createDownloadFragment(t,e.length,void 0);return null==n||n.setNonP2PFragmentData(e,Bt.a.SEED,void 0),n}},{key:"stopDownloadFragment",value:function(t){this.p2pContext.DataFetch.stopDownload(t),this.p2pContext.FragMan.deleteFragmentUntil(t)}},{key:"onFragmentFinished",value:function(t,e){var n=this;D.a.resolve().then(function(){var r=n.p2pContext.FragMan.getFragment(t);null!=r?r.onFinished(function(t){void 0!==t&&t.getFragStat()==tt.c.END_SUCCESS?e(jt.DONE,t.getFragmentData()):e(jt.ERROR,void 0,null==r?void 0:r.getFragEndErrorMsg())}):e(jt.NOTFOUND)})}},{key:"destroy",value:function(){var t,e,n,r=this;null===(t=this.sliceIdController)||void 0===t||t.destroy(),null===(e=this.p2pContext.PeerSched)||void 0===e||e.destroy(),this.cancelToken.hasCancel=!0,null===(n=this.p2pContext.PeerSched)||void 0===n||n.getConnectMutex().lock().then(function(){var t,e;null===(t=r.p2pContext.PeerSched)||void 0===t||t.getConnectCV().notifyAll(),null===(e=r.p2pContext.PeerSched)||void 0===e||e.getConnectMutex().unlock()})}}]),t}(),ae=n(99);!function(t){t[t.ErrorNetworkTimeout=11e3]="ErrorNetworkTimeout",t[t.ErrorNetworkFetch=11001]="ErrorNetworkFetch",t[t.ErrorNetworkRead=11002]="ErrorNetworkRead",t[t.ErrorMseOpen=11003]="ErrorMseOpen",t[t.ErrorMseAppend=11004]="ErrorMseAppend",t[t.ErrorPlayList=11010]="ErrorPlayList"}(re||(re={}));var se=function(){function t(e,n){var r=this;p()(this,t),y()(this,"extLogCallback",function(){}),y()(this,"p2pContext",void 0),y()(this,"trackerSourceParam",void 0),y()(this,"preloadPlaylistItems",new w.a),y()(this,"p2pEnable",!1),y()(this,"realtimeData",{lastFetchItem:"--",lastPlaylistItem:"--"}),y()(this,"canStartP2PTask",!1),y()(this,"onRealtimeDataUpdate",function(){}),y()(this,"onEventReport",function(t){}),null!=e&&(this.extLogCallback=e);var o,i,a,s=new St.Configuration;if(this.trackerSourceParam=t.getTrackerParamsString(n.trackerParams),this.p2pContext=new oe(s,function(t,e){return r.printExtLog(t,e)},function(t){return r.eventReportCallback(t)}),null!=n.sdkParams){var c=b()(n.sdkParams);c.length>2&&(this.printExtLog(1,"-> Init Configuration Start <-"),this.p2pContext.Config.allowPrintLog(2)&&console.log("[SistersPlayer] -> Init Configuration Start <-"),this.p2pContext.setConfiguration(c),this.printExtLog(1,"-> Init Configuration Done. <-"),this.p2pContext.Config.allowPrintLog(2)&&console.log("[SistersPlayer] -> Init Configuration Done. <-"))}this.p2pContext.P2P.initPeers(this.trackerSourceParam),this.p2pContext.CDNFetchTaskWorker.setWorkerNum(this.p2pContext.Config.cdnFetchInstances),this.p2pContext.FallbackFetchTaskWorker.setWorkerNum(this.p2pContext.Config.fallbackCDNFetchInstances),this.p2pEnable=!0,this.preloadPlaylistItems.clear(),null!=(null===(o=Object({env:"production",buildtime:"2022-12-23 03:40:09",version:"1.4.36-69d81050-master",packageVersion:"1.4.36-69d81050",git:Object({version:"sistersplayer-next-207-g69d8105",commithash:"69d81050f8cc4838004a7e09a320b81bed610114",branch:"master"})}))||void 0===o?void 0:o.env)&&(this.printExtLog(0,"Environment: production"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Environment: production")),null!=(null===(i=Object({env:"production",buildtime:"2022-12-23 03:40:09",version:"1.4.36-69d81050-master",packageVersion:"1.4.36-69d81050",git:Object({version:"sistersplayer-next-207-g69d8105",commithash:"69d81050f8cc4838004a7e09a320b81bed610114",branch:"master"})}))||void 0===i?void 0:i.buildtime)&&(this.printExtLog(0,"Build Time: 2022-12-23 03:40:09"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Build Time: 2022-12-23 03:40:09")),null!=(null===(a=Object({env:"production",buildtime:"2022-12-23 03:40:09",version:"1.4.36-69d81050-master",packageVersion:"1.4.36-69d81050",git:Object({version:"sistersplayer-next-207-g69d8105",commithash:"69d81050f8cc4838004a7e09a320b81bed610114",branch:"master"})}))||void 0===a?void 0:a.version)&&(this.printExtLog(0,"Version: 1.4.36-69d81050-master"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Version: 1.4.36-69d81050-master")),this.printExtLog(0,"Misaka has been created. >w<"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka has been created. >w<")}return v()(t,[{key:"eventReportCallback",value:function(t){var e,n=!0;if(t.type==o.DataReport)switch(null===(e=t.body)||void 0===e?void 0:e.code){case i.TrackerClosedReport:Math.random()<this.p2pContext.Config.trackerStatusReportProbability&&(n=!1);break;default:n=!1}else n=!1;if(0==n)try{this.onEventReport(t)}catch(t){console.info("[SistersPlayer] Event Report Error: ",t)}}},{key:"printExtLog",value:function(t,e){var n;e="[SistersPlayer] "+e,null!==(n=this.p2pContext)&&void 0!==n&&n.Config.allowPrintExtLog(t)&&this.extLogCallback(t,e)}},{key:"destroy",value:function(){1==this.p2pEnable&&(this.p2pEnable=!1,this.p2pContext.destroy(),this.printExtLog(0,"Misaka has been destroyed. OxO"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka has been destroyed. OxO"))}},{key:"getDestroyState",value:function(){return 0==this.p2pEnable}},{key:"getP2PDataCollectionStatus",value:function(){return 1==this.p2pEnable?this.p2pContext.P2PDataCollectionStatus:void 0}},{key:"getP2PInfo",value:function(){return{p2pEnable:this.p2pEnable,protocolVersion:St.Configuration.ProtocolVersion}}},{key:"getCurPeerIdInfo",value:function(){if(null!=this.p2pContext.PeerSched){var t=this.p2pContext.CurPeerId,e=b()(f()(this.p2pContext.PeerSched.getSliceIds()));return null!=this.p2pContext.PeerSched.getTracker()?"当前 PeerId: "+t+" , SliceIds: "+e:"当前 PeerId (已主动断开): "+t+" , SliceIds: "+e}return"正在连接..."}},{key:"getPeerIdList",value:function(){var t,e,n=Array();return null!=this.p2pContext.PeerSched&&(P()(t=this.p2pContext.PeerSched.getConnectedPeers()).call(t,function(t){n.push({incoming:t.isIncoming(),connected:!0,peerId:t.extData.peerId,peerRole:t.peerRole})}),P()(e=this.p2pContext.PeerSched.getConnectingPeers()).call(e,function(t){n.push({incoming:t.isIncoming(),connected:!1,peerId:t.extData.peerId,peerRole:t.peerRole})})),n}},{key:"mergeChunkToDownloadFragment",value:function(t,e){var n=ae.UrlHelper.getFileName(t);if(null!=n){var r=this.preloadPlaylistItems.get(n);if(null!=r&&r.fileSize>0){var o=this.p2pContext.FragMan.getFragment(n);if(null!=o){var i=r.fileSize,a=new Uint8Array(i),s=0;P()(e).call(e,function(t){a.set(t,s),s+=t.length}),o.setNonP2PFragmentData(a,tt.a.LACKED)}}}}},{key:"cdnFetchAsBuffer",value:function(t,e,n,r){var o=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(window.fetch){var s,c=!!window.AbortController,u={method:"GET",cache:i?"default":"no-store"},l=!1;c&&(s=new AbortController,u.signal=s.signal);var f=E()(function(){s&&s.abort(),l=!0,t(n,re.ErrorNetworkTimeout,"Failback HTTP fetch response timeout "+St.Configuration.failbackFetchCDNTimeoutMs+" ms, aborted.")},St.Configuration.failbackFetchCDNTimeoutMs);fetch(n,u).then(function(i){if(o.p2pContext.P2PDataCollectionStatus.addFetchResponseHeadersCount(i.headers),i.ok)if(clearTimeout(f),i.body){if(!1===l)if(window.ReadableStream){var s=new Array,c=i.body.getReader(),u=function(){},h=function(t){var r;null!=t.value?(s.push(I()(r=t.value).call(r)),e(n,t.value.buffer,t.done),t.done&&o.mergeChunkToDownloadFragment(n,s)):(e(n,new ArrayBuffer(0),t.done),t.done&&o.mergeChunkToDownloadFragment(n,s)),t.done||u()};(u=function(){c.read().then(h).catch(function(e){t(n,re.ErrorNetworkRead,e.toString())})})()}else i.arrayBuffer().then(function(t){1==a&&1==o.p2pEnable&&null!=o.p2pContext.P2PDataCollectionStatus&&o.p2pContext.P2PDataCollectionStatus.addDownloadSizeDataCollection(t.byteLength,tt.b.SERVER,r),e(n,t,!0)}).catch(function(e){t(n,re.ErrorNetworkRead,e.toString())})}else t(n,re.ErrorNetworkRead,"response.body is empty.");else t(n,re.ErrorNetworkRead,"response.ok is false.")}).catch(function(e){t(n,re.ErrorNetworkFetch,e.toString())})}else{var h=new XMLHttpRequest;h.onreadystatechange=function(t){2===h.readyState&&h.status>=200&&h.status},h.onload=function(t){h.status>=200&&h.status<=299&&(null!=h.response&&1==a&&1==o.p2pEnable&&null!=o.p2pContext.P2PDataCollectionStatus&&o.p2pContext.P2PDataCollectionStatus.addDownloadSizeDataCollection(h.response.byteLength,tt.b.SERVER,r),e(n,h.response,!0))},h.onerror=function(e){t(n,h.readyState>2?re.ErrorNetworkRead:re.ErrorNetworkFetch,e.toString())},h.open("GET",n),h.responseType="arraybuffer",h.send()}}},{key:"p2pFetchAsBuffer",value:function(t,e,n,r){var o=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1==this.p2pEnable){!1===this.canStartP2PTask&&n()>500&&this.preloadPlaylistItems.size>this.p2pContext.Config.nonP2PFragmentCount&&(this.canStartP2PTask=!0);var a=this.p2pContext,s=ae.UrlHelper.getFileName(r);if(null!=s&&!1===this.preloadPlaylistItems.has(s)){var c=s;this.realtimeData.lastFetchItem=c,this.onRealtimeDataUpdate();var u=Math.floor(n())-this.p2pContext.Config.p2pSafeBufferDurationForDelayStopMs;u>0?(u=Math.min(u,this.p2pContext.Config.p2pDelayStopMaxMs),E()(function(){a.P2P.stopDownloadFragment(c)},u)):a.P2P.stopDownloadFragment(c);a.P2P.onFragmentFinished(c,function(n,a,s){switch(n){case jt.DONE:null!=a?e(r,a.buffer,!0):(1==o.p2pEnable&&(o.printExtLog(0,"Fetch Error: p2p download data lost. URL: "+r),o.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Fetch Error: p2p download data lost. URL: "+r)),o.cdnFetchAsBuffer(t,e,r,tt.a.LACKED,i,!1));break;case jt.ERROR:1==o.p2pEnable&&(null!=s?(o.printExtLog(0,"Fetch Error: "+s+". on "+r),o.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Fetch Error: "+s+". URL: "+r)):(o.printExtLog(0,"Fetch Error: p2p download error, no message. URL: "+r),o.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Fetch Error: p2p download error, no message. URL: "+r))),o.cdnFetchAsBuffer(t,e,r,tt.a.LACKED,i,!1);break;case jt.NOTFOUND:o.cdnFetchAsBuffer(t,e,r,tt.a.LACKED,i,!0)}})}else this.cdnFetchAsBuffer(t,e,r,tt.a.SEED,i,!1)}else this.cdnFetchAsBuffer(t,e,r,tt.a.SEED,i,!1)}},{key:"downloadExtraFile",value:function(t,e,n,r,o){var i,a=this.p2pContext;return new D.a((i=u()(C.a.mark(function i(s,c){return C.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(null==a.P2P.startDownloadExtraFile(t,e,n,r)){i.next=8;break}return a.P2P.onFragmentFinished(t,function(e,n,r){var o=!1;if(e==jt.DONE&&null!=n){var i=a.FragMan.getFragment(t);if(null!=i){var u=i.getRoleArray();s({data:n,p2pBytes:u[tt.a.EXCHANGE],seedBytes:u[tt.a.SEED],lackBytes:u[tt.a.LACKED]}),o=!0}}o||c(new Error("download "+t+" failed."))}),i.next=5,new D.a(function(t){return E()(t,o)});case 5:a.P2P.stopDownloadFragment(t),i.next=9;break;case 8:c(new Error("fail to start download "+t));case 9:case"end":return i.stop()}},i)})),function(t,e){return i.apply(this,arguments)}))}},{key:"shareExtraFile",value:function(t,e){this.p2pContext.P2P.shareFragment(t,e)}},{key:"parsePlaylistItem",value:function(t){var e=ae.UrlHelper.getFileName(t.uri),n=[],r=0,o=void 0;if(null!=t.title){var i,a=void 0;F()(i=t.title).call(i,"|")>=0?(n=t.title.split("|"),a=16):(n=t.title.split(";"),a=10),null!=n[0]&&(r=U()(n[0],a)),null!=n[1]&&(o=U()(n[1],a))}return{uri:t.uri,duration:t.duration,title:t.title,crc:o,fileSize:r,fragName:e}}},{key:"updatePlaylist",value:function(t,e){if(1==this.p2pEnable){var n=this.parsePlaylistItem(e);if(null!=n.fragName)if(this.realtimeData.lastPlaylistItem=n.fragName,this.onRealtimeDataUpdate(),t||!n.title);else{var r=n.fragName,o=n.uri,i=n.fileSize,a=n.crc;this.preloadPlaylistItems.size<=this.p2pContext.Config.nonP2PFragmentCount&&(this.preloadPlaylistItems.set(r,n),this.p2pContext.P2P.createDownloadFragment(r,i,a)),!0===this.canStartP2PTask&&this.p2pContext.P2P.startDownloadFragment(r,o,i,a)}}}}],[{key:"checkP2PSupport",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,n=!!e.WebSocket,r=!!(e.MediaSource||e.WebKitMediaSource),o=!!(e.RTCPeerConnection||e.mozRTCPeerConnection||e.webkitRTCPeerConnection),i=e.RTCDataChannel||e.DataChannel,a=!!i,s=!!a&&(null==i||null===(t=i.prototype)||void 0===t?void 0:t.hasOwnProperty("onbufferedamountlow")),c=!!e.ReadableStream,u=n&&r&&o&&a&&s&&c,l="Misaka Network Check: ".concat(u?"Supported":"Unsupported");if("development"==St.Configuration.curNodeEnv){var f="[SistersPlayer] ".concat(l,"\n\t")+"WebSocket: ".concat(n,"\n\t")+"MediaSource: ".concat(r,"\n\t")+"RTCPeerConnection: ".concat(o,"\n\t")+"RTCDataChannel: ".concat(a,"\n\t")+"RTCDataChannel onbufferedamountlow: ".concat(s,"\n\t")+"Fetch API ReadableStream: ".concat(c);console.log(f)}else console.log("[SistersPlayer] ".concat(l));return u}},{key:"checkP2PSupportBypass",value:function(){var t=document.createElement("iframe");t.src="about:blank",t.hidden=!0,document.body.appendChild(t);var e=!1;return t.contentWindow&&(e=this.checkP2PSupport(t.contentWindow)),document.body.removeChild(t),e}},{key:"checkIsCheater",value:function(){var t=!1;return 0==this.checkP2PSupport()&&1==this.checkP2PSupportBypass()&&(t=!0),t}},{key:"getTrackerParamsString",value:function(t){var e="?protocol="+St.Configuration.ProtocolVersion.toString();if(null!=t)for(var n=0,r=M()(t);n<r.length;n++){var o=s()(r[n],2),i=o[0],a=o[1];null!=a&&(e=e+"&"+encodeURIComponent(i)+"="+encodeURIComponent(a.toString()))}return e}}]),t}()},function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(t,e,n){t.exports=n(208)},function(t,e,n){var r=n(211);t.exports=r},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e){var n="object"==typeof document&&document.all,r=void 0===n&&void 0!==n;t.exports={all:n,IS_HTMLDDA:r}},function(t,e,n){var r=n(73);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,n){var r=n(22),o=n(12),i=n(126);t.exports=!r&&!o(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var r=n(12),o=n(18),i=/#|\.prototype\./,a=function(t,e){var n=c[s(t)];return n==l||n!=u&&(o(e)?r(e):!!e)},s=a.normalize=function(t){return String(t).replace(i,".").toLowerCase()},c=a.data={},u=a.NATIVE="N",l=a.POLYFILL="P";t.exports=a},function(t,e,n){var r=n(22),o=n(12);t.exports=r&&o(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},function(t,e,n){var r=n(220);n(50),t.exports=r},function(t,e,n){"use strict";var r=n(7),o=n(12),i=n(58),a=n(24),s=n(34),c=n(36),u=n(127),l=n(76),f=n(108),h=n(88),p=n(17),d=n(74),v=p("isConcatSpreadable"),g=d>=51||!o(function(){var t=[];return t[v]=!1,t.concat()[0]!==t}),y=h("concat"),x=function(t){if(!a(t))return!1;var e=t[v];return void 0!==e?!!e:i(t)};r({target:"Array",proto:!0,arity:1,forced:!g||!y},{concat:function(t){var e,n,r,o,i,a=s(this),h=f(a,0),p=0;for(e=-1,r=arguments.length;e<r;e++)if(x(i=-1===e?a:arguments[e]))for(o=c(i),u(p+o),n=0;n<o;n++,p++)n in i&&l(h,p,i[n]);else u(p+1),l(h,p++,i);return h.length=p,h}})},function(t,e,n){var r=n(97),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e,n){var r=n(13),o=n(18),i=n(125),a=r(Function.toString);o(i.inspectSource)||(i.inspectSource=function(t){return a(t)}),t.exports=i.inspectSource},function(t,e,n){var r=n(22),o=n(146),i=n(31),a=n(35),s=n(46),c=n(89);e.f=r&&!o?Object.defineProperties:function(t,e){a(t);for(var n,r=s(e),o=c(e),u=o.length,l=0;u>l;)i.f(t,n=o[l++],r[n]);return t}},function(t,e,n){var r=n(13),o=n(25),i=n(46),a=n(129).indexOf,s=n(90),c=r([].push);t.exports=function(t,e){var n,r=i(t),u=0,l=[];for(n in r)!o(s,n)&&o(r,n)&&c(l,n);for(;e.length>u;)o(r,n=e[u++])&&(~a(l,n)||c(l,n));return l}},function(t,e,n){var r=n(30);t.exports=r("document","documentElement")},function(t,e,n){var r=n(55),o=n(46),i=n(112).f,a=n(131),s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return s&&"Window"==r(t)?function(t){try{return i(t)}catch(t){return a(s)}}(t):i(o(t))}},function(t,e,n){var r=n(23),o=n(30),i=n(17),a=n(44);t.exports=function(){var t=o("Symbol"),e=t&&t.prototype,n=e&&e.valueOf,s=i("toPrimitive");e&&!e[s]&&a(e,s,function(t){return r(n,this)},{arity:1})}},function(t,e,n){var r=n(73);t.exports=r&&!!Symbol.for&&!!Symbol.keyFor},function(t,e,n){var r=n(7),o=n(30),i=n(84),a=n(23),s=n(13),c=n(12),u=n(58),l=n(18),f=n(24),h=n(105),p=n(115),d=n(73),v=o("JSON","stringify"),g=s(/./.exec),y=s("".charAt),x=s("".charCodeAt),C=s("".replace),m=s(1..toString),w=/[\uD800-\uDFFF]/g,k=/^[\uD800-\uDBFF]$/,b=/^[\uDC00-\uDFFF]$/,S=!d||c(function(){var t=o("Symbol")();return"[null]"!=v([t])||"{}"!=v({a:t})||"{}"!=v(Object(t))}),P=c(function(){return'"\\udf06\\ud834"'!==v("\udf06\ud834")||'"\\udead"'!==v("\udead")}),A=function(t,e){var n=p(arguments),r=e;if((f(e)||void 0!==t)&&!h(t))return u(e)||(e=function(t,e){if(l(r)&&(e=a(r,this,t,e)),!h(e))return e}),n[1]=e,i(v,null,n)},E=function(t,e,n){var r=y(n,e-1),o=y(n,e+1);return g(k,t)&&!g(b,o)||g(b,t)&&!g(k,r)?"\\u"+m(x(t,0),16):t};v&&r({target:"JSON",stat:!0,arity:3,forced:S||P},{stringify:function(t,e,n){var r=p(arguments),o=i(S?A:v,null,r);return P&&"string"==typeof o?C(o,w,E):o}})},function(t,e,n){n(20)("iterator")},function(t,e,n){var r=n(20),o=n(155);r("toPrimitive"),o()},function(t,e,n){"use strict";var r=n(161).IteratorPrototype,o=n(63),i=n(56),a=n(49),s=n(78),c=function(){return this};t.exports=function(t,e,n,u){var l=e+" Iterator";return t.prototype=o(r,{next:i(+!u,n)}),a(t,l,!1,!0),s[l]=c,t}},function(t,e,n){"use strict";var r,o,i,a=n(12),s=n(18),c=n(24),u=n(63),l=n(116),f=n(44),h=n(17),p=n(39),d=h("iterator"),v=!1;[].keys&&("next"in(i=[].keys())?(o=l(l(i)))!==Object.prototype&&(r=o):v=!0),!c(r)||a(function(){var t={};return r[d].call(t)!==t})?r={}:p&&(r=u(r)),s(r[d])||f(r,d,function(){return this}),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:v}},function(t,e,n){var r=n(12);t.exports=!r(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},function(t,e,n){var r=n(13),o=n(97),i=n(37),a=n(72),s=r("".charAt),c=r("".charCodeAt),u=r("".slice),l=function(t){return function(e,n){var r,l,f=i(a(e)),h=o(n),p=f.length;return h<0||h>=p?t?"":void 0:(r=c(f,h))<55296||r>56319||h+1===p||(l=c(f,h+1))<56320||l>57343?t?s(f,h):r:t?u(f,h,h+2):l-56320+(r-55296<<10)+65536}};t.exports={codeAt:l(!1),charAt:l(!0)}},function(t,e,n){var r=n(165),o=n(167),i=n(173);t.exports=function(t,e){var n;if(t){if("string"==typeof t)return i(t,e);var a=r(n=Object.prototype.toString.call(t)).call(n,8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?o(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(t,e):void 0}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(261)},function(t,e,n){var r=n(264);t.exports=r},function(t,e,n){t.exports=n(267)},function(t,e,n){var r=n(270);t.exports=r},function(t,e,n){"use strict";var r=n(43),o=n(23),i=n(34),a=n(272),s=n(171),c=n(109),u=n(36),l=n(76),f=n(135),h=n(92),p=Array;t.exports=function(t){var e=i(t),n=c(this),d=arguments.length,v=d>1?arguments[1]:void 0,g=void 0!==v;g&&(v=r(v,d>2?arguments[2]:void 0));var y,x,C,m,w,k,b=h(e),S=0;if(!b||this===p&&s(b))for(y=u(e),x=n?new this(y):p(y);y>S;S++)k=g?v(e[S],S):e[S],l(x,S,k);else for(w=(m=f(e,b)).next,x=n?new this:[];!(C=o(w,m)).done;S++)k=g?a(m,v,[C.value,S],!0):C.value,l(x,S,k);return x.length=S,x}},function(t,e,n){var r=n(23),o=n(35),i=n(124);t.exports=function(t,e,n){var a,s;o(t);try{if(!(a=i(t,"return"))){if("throw"===e)throw n;return n}a=r(a,t)}catch(t){s=!0,a=t}if("throw"===e)throw n;if(s)throw a;return o(a),n}},function(t,e,n){var r=n(17),o=n(78),i=r("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||a[i]===t)}},function(t,e,n){var r=n(17)("iterator"),o=!1;try{var i=0,a={next:function(){return{done:!!i++}},return:function(){o=!0}};a[r]=function(){return this},Array.from(a,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!o)return!1;var n=!1;try{var i={};i[r]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch(t){}return n}},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(274)},function(t,e,n){var r=n(277);n(50),t.exports=r},function(t,e,n){n(278)},function(t,e,n){"use strict";var r=n(30),o=n(31),i=n(17),a=n(22),s=i("species");t.exports=function(t){var e=r(t),n=o.f;a&&e&&!e[s]&&n(e,s,{configurable:!0,get:function(){return this}})}},function(t,e,n){var r=n(35),o=n(287),i=n(86),a=n(17)("species");t.exports=function(t,e){var n,s=r(t).constructor;return void 0===s||i(n=r(s)[a])?e:o(n)}},function(t,e,n){var r,o,i,a,s=n(15),c=n(84),u=n(43),l=n(18),f=n(25),h=n(12),p=n(153),d=n(115),v=n(126),g=n(118),y=n(180),x=n(93),C=s.setImmediate,m=s.clearImmediate,w=s.process,k=s.Dispatch,b=s.Function,S=s.MessageChannel,P=s.String,A=0,E={};try{r=s.location}catch(t){}var R=function(t){if(f(E,t)){var e=E[t];delete E[t],e()}},I=function(t){return function(){R(t)}},T=function(t){R(t.data)},D=function(t){s.postMessage(P(t),r.protocol+"//"+r.host)};C&&m||(C=function(t){g(arguments.length,1);var e=l(t)?t:b(t),n=d(arguments,1);return E[++A]=function(){c(e,void 0,n)},o(A),A},m=function(t){delete E[t]},x?o=function(t){w.nextTick(I(t))}:k&&k.now?o=function(t){k.now(I(t))}:S&&!y?(a=(i=new S).port2,i.port1.onmessage=T,o=u(a.postMessage,a)):s.addEventListener&&l(s.postMessage)&&!s.importScripts&&r&&"file:"!==r.protocol&&!h(D)?(o=D,s.addEventListener("message",T,!1)):o="onreadystatechange"in v("script")?function(t){p.appendChild(v("script")).onreadystatechange=function(){p.removeChild(this),R(t)}}:function(t){setTimeout(I(t),0)}),t.exports={set:C,clear:m}},function(t,e,n){var r=n(57);t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},function(t,e){t.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},function(t,e,n){var r=n(80),o=n(172),i=n(95).CONSTRUCTOR;t.exports=i||!o(function(t){r.all(t).then(void 0,function(){})})},function(t,e,n){var r=n(35),o=n(24),i=n(62);t.exports=function(t,e){if(r(t),o(e)&&e.constructor===t)return e;var n=i.f(t);return(0,n.resolve)(e),n.promise}},function(t,e,n){"use strict";var r=n(7),o=n(23),i=n(38),a=n(62),s=n(79),c=n(61);r({target:"Promise",stat:!0},{allSettled:function(t){var e=this,n=a.f(e),r=n.resolve,u=n.reject,l=s(function(){var n=i(e.resolve),a=[],s=0,u=1;c(t,function(t){var i=s++,c=!1;u++,o(n,e,t).then(function(t){c||(c=!0,a[i]={status:"fulfilled",value:t},--u||r(a))},function(t){c||(c=!0,a[i]={status:"rejected",reason:t},--u||r(a))})}),--u||r(a)});return l.error&&u(l.value),n.promise}})},function(t,e,n){"use strict";var r=n(7),o=n(23),i=n(38),a=n(30),s=n(62),c=n(79),u=n(61);r({target:"Promise",stat:!0},{any:function(t){var e=this,n=a("AggregateError"),r=s.f(e),l=r.resolve,f=r.reject,h=c(function(){var r=i(e.resolve),a=[],s=0,c=1,h=!1;u(t,function(t){var i=s++,u=!1;c++,o(r,e,t).then(function(t){u||h||(h=!0,l(t))},function(t){u||h||(u=!0,a[i]=t,--c||f(new n(a,"No one promise resolved")))})}),--c||f(new n(a,"No one promise resolved"))});return h.error&&f(h.value),r.promise}})},function(t,e,n){var r=n(33).default,o=n(319);t.exports=function(t){var e=o(t,"string");return"symbol"===r(e)?e:String(e)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){n(50);var r=n(59),o=n(25),i=n(21),a=n(346),s=Array.prototype,c={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var e=t.forEach;return t===s||i(s,t)&&e===s.forEach||o(c,r(t))?a:e}},function(t,e,n){"use strict";var r=n(7),o=n(15),i=n(189),a=n(12),s=n(48),c=n(61),u=n(94),l=n(18),f=n(24),h=n(49),p=n(31).f,d=n(91).forEach,v=n(22),g=n(60),y=g.set,x=g.getterFor;t.exports=function(t,e,n){var g,C=-1!==t.indexOf("Map"),m=-1!==t.indexOf("Weak"),w=C?"set":"add",k=o[t],b=k&&k.prototype,S={};if(v&&l(k)&&(m||b.forEach&&!a(function(){(new k).entries().next()}))){var P=(g=e(function(e,n){y(u(e,P),{type:t,collection:new k}),null!=n&&c(n,e[w],{that:e,AS_ENTRIES:C})})).prototype,A=x(t);d(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(t){var e="add"==t||"set"==t;!(t in b)||m&&"clear"==t||s(P,t,function(n,r){var o=A(this).collection;if(!e&&m&&!f(n))return"get"==t&&void 0;var i=o[t](0===n?0:n,r);return e?this:i})}),m||p(P,"size",{configurable:!0,get:function(){return A(this).collection.size}})}else g=n.getConstructor(e,t,C,w),i.enable();return h(g,t,!1,!0),S[t]=g,r({global:!0,forced:!0},S),m||n.setStrong(g,t,C),g}},function(t,e,n){var r=n(7),o=n(13),i=n(90),a=n(24),s=n(25),c=n(31).f,u=n(112),l=n(154),f=n(369),h=n(106),p=n(371),d=!1,v=h("meta"),g=0,y=function(t){c(t,v,{value:{objectID:"O"+g++,weakData:{}}})},x=t.exports={enable:function(){x.enable=function(){},d=!0;var t=u.f,e=o([].splice),n={};n[v]=1,t(n).length&&(u.f=function(n){for(var r=t(n),o=0,i=r.length;o<i;o++)if(r[o]===v){e(r,o,1);break}return r},r({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:l.f}))},fastKey:function(t,e){if(!a(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!s(t,v)){if(!f(t))return"F";if(!e)return"E";y(t)}return t[v].objectID},getWeakData:function(t,e){if(!s(t,v)){if(!f(t))return!0;if(!e)return!1;y(t)}return t[v].weakData},onFreeze:function(t){return p&&d&&f(t)&&!s(t,v)&&y(t),t}};i[v]=!0},function(t,e,n){"use strict";var r=n(31).f,o=n(63),i=n(191),a=n(43),s=n(94),c=n(86),u=n(61),l=n(133),f=n(134),h=n(177),p=n(22),d=n(189).fastKey,v=n(60),g=v.set,y=v.getterFor;t.exports={getConstructor:function(t,e,n,l){var f=t(function(t,r){s(t,h),g(t,{type:e,index:o(null),first:void 0,last:void 0,size:0}),p||(t.size=0),c(r)||u(r,t[l],{that:t,AS_ENTRIES:n})}),h=f.prototype,v=y(e),x=function(t,e,n){var r,o,i=v(t),a=C(t,e);return a?a.value=n:(i.last=a={index:o=d(e,!0),key:e,value:n,previous:r=i.last,next:void 0,removed:!1},i.first||(i.first=a),r&&(r.next=a),p?i.size++:t.size++,"F"!==o&&(i.index[o]=a)),t},C=function(t,e){var n,r=v(t),o=d(e);if("F"!==o)return r.index[o];for(n=r.first;n;n=n.next)if(n.key==e)return n};return i(h,{clear:function(){for(var t=v(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,p?t.size=0:this.size=0},delete:function(t){var e=v(this),n=C(this,t);if(n){var r=n.next,o=n.previous;delete e.index[n.index],n.removed=!0,o&&(o.next=r),r&&(r.previous=o),e.first==n&&(e.first=r),e.last==n&&(e.last=o),p?e.size--:this.size--}return!!n},forEach:function(t){for(var e,n=v(this),r=a(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!C(this,t)}}),i(h,n?{get:function(t){var e=C(this,t);return e&&e.value},set:function(t,e){return x(this,0===t?0:t,e)}}:{add:function(t){return x(this,t=0===t?0:t,t)}}),p&&r(h,"size",{get:function(){return v(this).size}}),f},setStrong:function(t,e,n){var r=e+" Iterator",o=y(e),i=y(r);l(t,e,function(t,e){g(this,{type:r,target:t,state:o(t),kind:e,last:void 0})},function(){for(var t=i(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?f("keys"==e?n.key:"values"==e?n.value:[n.key,n.value],!1):(t.target=void 0,f(void 0,!0))},n?"entries":"values",!n,!0),h(e)}}},function(t,e,n){var r=n(44);t.exports=function(t,e,n){for(var o in e)n&&n.unsafe&&t[o]?t[o]=e[o]:r(t,o,e[o],n);return t}},function(t,e,n){n(375),n(376)},function(t,e,n){var r=n(15),o=n(84),i=n(18),a=n(57),s=n(115),c=n(118),u=/MSIE .\./.test(a),l=r.Function,f=function(t){return u?function(e,n){var r=c(arguments.length,1)>2,a=i(e)?e:l(e),u=r?s(arguments,2):void 0;return t(r?function(){o(a,this,u)}:a,n)}:t};t.exports={setTimeout:f(r.setTimeout),setInterval:f(r.setInterval)}},function(t,e,n){var r=n(15),o=n(12),i=n(13),a=n(37),s=n(205).trim,c=n(138),u=r.parseInt,l=r.Symbol,f=l&&l.iterator,h=/^[+-]?0x/i,p=i(h.exec),d=8!==u(c+"08")||22!==u(c+"0x16")||f&&!o(function(){u(Object(f))});t.exports=d?function(t,e){var n=s(a(t));return u(n,e>>>0||(p(h,n)?16:10))}:u},function(t,e,n){"use strict";var r=n(75),o=TypeError;t.exports=function(t,e){if(!delete t[e])throw o("Cannot delete property "+r(e)+" of "+r(t))}},function(t,e,n){var r=n(131),o=Math.floor,i=function(t,e){var n=t.length,c=o(n/2);return n<8?a(t,e):s(t,i(r(t,0,c),e),i(r(t,c),e),e)},a=function(t,e){for(var n,r,o=t.length,i=1;i<o;){for(r=i,n=t[i];r&&e(t[r-1],n)>0;)t[r]=t[--r];r!==i++&&(t[r]=n)}return t},s=function(t,e,n,r){for(var o=e.length,i=n.length,a=0,s=0;a<o||s<i;)t[a+s]=a<o&&s<i?r(e[a],n[s])<=0?e[a++]:n[s++]:a<o?e[a++]:n[s++];return t};t.exports=i},function(t,e,n){var r=n(406),o=TypeError;t.exports=function(t){if(r(t))throw o("The method doesn't accept regular expressions");return t}},function(t,e,n){var r=n(17)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[r]=!1,"/./"[t](e)}catch(t){}}return!1}},function(t,e,n){var r=n(12),o=n(17),i=n(39),a=o("iterator");t.exports=!r(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n="";return t.pathname="c%20d",e.forEach(function(t,r){e.delete("b"),n+=r+t}),i&&!t.toJSON||!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[a]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})},function(t,e,n){"use strict";n(51);var r=n(7),o=n(15),i=n(23),a=n(13),s=n(22),c=n(199),u=n(44),l=n(191),f=n(49),h=n(160),p=n(60),d=n(94),v=n(18),g=n(25),y=n(43),x=n(59),C=n(35),m=n(24),w=n(37),k=n(63),b=n(56),S=n(135),P=n(92),A=n(118),E=n(17),R=n(196),I=E("iterator"),T=p.set,D=p.getterFor("URLSearchParams"),L=p.getterFor("URLSearchParamsIterator"),F=Object.getOwnPropertyDescriptor,O=function(t){if(!s)return o[t];var e=F(o,t);return e&&e.value},U=O("fetch"),N=O("Request"),M=O("Headers"),B=N&&N.prototype,_=M&&M.prototype,z=o.RegExp,j=o.TypeError,q=o.decodeURIComponent,W=o.encodeURIComponent,V=a("".charAt),G=a([].join),H=a([].push),Y=a("".replace),Q=a([].shift),K=a([].splice),X=a("".split),$=a("".slice),J=/\+/g,Z=Array(4),tt=function(t){return Z[t-1]||(Z[t-1]=z("((?:%[\\da-f]{2}){"+t+"})","gi"))},et=function(t){try{return q(t)}catch(e){return t}},nt=function(t){var e=Y(t,J," "),n=4;try{return q(e)}catch(t){for(;n;)e=Y(e,tt(n--),et);return e}},rt=/[!'()~]|%20/g,ot={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},it=function(t){return ot[t]},at=function(t){return Y(W(t),rt,it)},st=h(function(t,e){T(this,{type:"URLSearchParamsIterator",iterator:S(D(t).entries),kind:e})},"Iterator",function(){var t=L(this),e=t.kind,n=t.iterator.next(),r=n.value;return n.done||(n.value="keys"===e?r.key:"values"===e?r.value:[r.key,r.value]),n},!0),ct=function(t){this.entries=[],this.url=null,void 0!==t&&(m(t)?this.parseObject(t):this.parseQuery("string"==typeof t?"?"===V(t,0)?$(t,1):t:w(t)))};ct.prototype={type:"URLSearchParams",bindURL:function(t){this.url=t,this.update()},parseObject:function(t){var e,n,r,o,a,s,c,u=P(t);if(u)for(n=(e=S(t,u)).next;!(r=i(n,e)).done;){if(a=(o=S(C(r.value))).next,(s=i(a,o)).done||(c=i(a,o)).done||!i(a,o).done)throw j("Expected sequence with length 2");H(this.entries,{key:w(s.value),value:w(c.value)})}else for(var l in t)g(t,l)&&H(this.entries,{key:l,value:w(t[l])})},parseQuery:function(t){if(t)for(var e,n,r=X(t,"&"),o=0;o<r.length;)(e=r[o++]).length&&(n=X(e,"="),H(this.entries,{key:nt(Q(n)),value:nt(G(n,"="))}))},serialize:function(){for(var t,e=this.entries,n=[],r=0;r<e.length;)t=e[r++],H(n,at(t.key)+"="+at(t.value));return G(n,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ut=function(){d(this,lt);var t=arguments.length>0?arguments[0]:void 0;T(this,new ct(t))},lt=ut.prototype;if(l(lt,{append:function(t,e){A(arguments.length,2);var n=D(this);H(n.entries,{key:w(t),value:w(e)}),n.updateURL()},delete:function(t){A(arguments.length,1);for(var e=D(this),n=e.entries,r=w(t),o=0;o<n.length;)n[o].key===r?K(n,o,1):o++;e.updateURL()},get:function(t){A(arguments.length,1);for(var e=D(this).entries,n=w(t),r=0;r<e.length;r++)if(e[r].key===n)return e[r].value;return null},getAll:function(t){A(arguments.length,1);for(var e=D(this).entries,n=w(t),r=[],o=0;o<e.length;o++)e[o].key===n&&H(r,e[o].value);return r},has:function(t){A(arguments.length,1);for(var e=D(this).entries,n=w(t),r=0;r<e.length;)if(e[r++].key===n)return!0;return!1},set:function(t,e){A(arguments.length,1);for(var n,r=D(this),o=r.entries,i=!1,a=w(t),s=w(e),c=0;c<o.length;c++)(n=o[c]).key===a&&(i?K(o,c--,1):(i=!0,n.value=s));i||H(o,{key:a,value:s}),r.updateURL()},sort:function(){var t=D(this);R(t.entries,function(t,e){return t.key>e.key?1:-1}),t.updateURL()},forEach:function(t){for(var e,n=D(this).entries,r=y(t,arguments.length>1?arguments[1]:void 0),o=0;o<n.length;)r((e=n[o++]).value,e.key,this)},keys:function(){return new st(this,"keys")},values:function(){return new st(this,"values")},entries:function(){return new st(this,"entries")}},{enumerable:!0}),u(lt,I,lt.entries,{name:"entries"}),u(lt,"toString",function(){return D(this).serialize()},{enumerable:!0}),f(ut,"URLSearchParams"),r({global:!0,constructor:!0,forced:!c},{URLSearchParams:ut}),!c&&v(M)){var ft=a(_.has),ht=a(_.set),pt=function(t){if(m(t)){var e,n=t.body;if("URLSearchParams"===x(n))return e=t.headers?new M(t.headers):new M,ft(e,"content-type")||ht(e,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),k(t,{body:b(0,w(n)),headers:b(0,e)})}return t};if(v(U)&&r({global:!0,enumerable:!0,dontCallGetSet:!0,forced:!0},{fetch:function(t){return U(t,arguments.length>1?pt(arguments[1]):{})}}),v(N)){var dt=function(t){return d(this,B),new N(t,arguments.length>1?pt(arguments[1]):{})};B.constructor=dt,dt.prototype=B,r({global:!0,constructor:!0,dontCallGetSet:!0,forced:!0},{Request:dt})}}t.exports={URLSearchParams:ut,getState:D}},function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n(2),o=n.n(r),i=n(3),a=n.n(i),s=n(0),c=n.n(s),u=function(){function t(){o()(this,t)}return a()(t,null,[{key:"crc32",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new Uint32Array(1);new Uint32Array(1)[0]=e;var r=new Uint32Array(1);for(r[0]=0,r[0]^=4294967295,n[0]=0;n[0]<t.length;n[0]+=e)r[0]=this.crc32_tab[255&(r[0]^t[n[0]])]^r[0]>>8&16777215;return r[0]=4294967295^r[0],r[0]<0&&(r[0]+=4294967296),r[0]}}]),t}();c()(u,"crc32_tab",new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]))},function(t,e,n){t.exports=n(433)},function(t,e,n){t.exports=n(440)},function(t,e,n){t.exports=n(453)},function(t,e,n){var r=n(13),o=n(72),i=n(37),a=n(138),s=r("".replace),c="["+a+"]",u=RegExp("^"+c+c+"*"),l=RegExp(c+c+"*$"),f=function(t){return function(e){var n=i(o(e));return 1&t&&(n=s(n,u,"")),2&t&&(n=s(n,l,"")),n}};t.exports={start:f(1),end:f(2),trim:f(3)}},,function(t,e,n){var r=n(139);t.exports=function(t){if(r(t))return t},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(209)},function(t,e,n){var r=n(210);t.exports=r},function(t,e,n){var r=n(140);t.exports=r},function(t,e,n){n(212);var r=n(16);t.exports=r.Array.isArray},function(t,e,n){n(7)({target:"Array",stat:!0},{isArray:n(58)})},function(t,e,n){var r=n(23),o=n(24),i=n(105),a=n(124),s=n(214),c=n(17),u=TypeError,l=c("toPrimitive");t.exports=function(t,e){if(!o(t)||i(t))return t;var n,c=a(t,l);if(c){if(void 0===e&&(e="default"),n=r(c,t,e),!o(n)||i(n))return n;throw u("Can't convert object to primitive value")}return void 0===e&&(e="number"),s(t,e)}},function(t,e,n){var r=n(23),o=n(18),i=n(24),a=TypeError;t.exports=function(t,e){var n,s;if("string"===e&&o(n=t.toString)&&!i(s=r(n,t)))return s;if(o(n=t.valueOf)&&!i(s=r(n,t)))return s;if("string"!==e&&o(n=t.toString)&&!i(s=r(n,t)))return s;throw a("Can't convert object to primitive value")}},function(t,e,n){var r=n(15),o=Object.defineProperty;t.exports=function(t,e){try{o(r,t,{value:e,configurable:!0,writable:!0})}catch(n){r[t]=e}return e}},function(t,e,n){var r=n(107),o=n(81);t.exports=function(t,e){var n=null==t?null:void 0!==r&&o(t)||t["@@iterator"];if(null!=n){var i,a,s,c,u=[],l=!0,f=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;l=!1}else for(;!(l=(i=s.call(n)).done)&&(u.push(i.value),u.length!==e);l=!0);}catch(t){f=!0,a=t}finally{try{if(!l&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(f)throw a}}return u}},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(218)},function(t,e,n){var r=n(219);n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),t.exports=r},function(t,e,n){var r=n(147);t.exports=r},function(t,e,n){n(148),n(77),n(223),n(230),n(231),n(232),n(233),n(158),n(234),n(235),n(236),n(237),n(238),n(239),n(159),n(240),n(241),n(242),n(243),n(244);var r=n(16);t.exports=r.Symbol},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=Math.trunc||function(t){var e=+t;return(e>0?r:n)(e)}},function(t,e,n){var r=n(58),o=n(109),i=n(24),a=n(17)("species"),s=Array;t.exports=function(t){var e;return r(t)&&(e=t.constructor,(o(e)&&(e===s||r(e.prototype))||i(e)&&null===(e=e[a]))&&(e=void 0)),void 0===e?s:e}},function(t,e,n){n(224),n(227),n(228),n(157),n(229)},function(t,e,n){"use strict";var r=n(7),o=n(15),i=n(23),a=n(13),s=n(39),c=n(22),u=n(73),l=n(12),f=n(25),h=n(21),p=n(35),d=n(46),v=n(104),g=n(37),y=n(56),x=n(63),C=n(89),m=n(112),w=n(154),k=n(113),b=n(85),S=n(31),P=n(151),A=n(102),E=n(44),R=n(87),I=n(111),T=n(90),D=n(106),L=n(17),F=n(114),O=n(20),U=n(155),N=n(49),M=n(60),B=n(91).forEach,_=I("hidden"),z=M.set,j=M.getterFor("Symbol"),q=Object.prototype,W=o.Symbol,V=W&&W.prototype,G=o.TypeError,H=o.QObject,Y=b.f,Q=S.f,K=w.f,X=A.f,$=a([].push),J=R("symbols"),Z=R("op-symbols"),tt=R("wks"),et=!H||!H.prototype||!H.prototype.findChild,nt=c&&l(function(){return 7!=x(Q({},"a",{get:function(){return Q(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=Y(q,e);r&&delete q[e],Q(t,e,n),r&&t!==q&&Q(q,e,r)}:Q,rt=function(t,e){var n=J[t]=x(V);return z(n,{type:"Symbol",tag:t,description:e}),c||(n.description=e),n},ot=function(t,e,n){t===q&&ot(Z,e,n),p(t);var r=v(e);return p(n),f(J,r)?(n.enumerable?(f(t,_)&&t[_][r]&&(t[_][r]=!1),n=x(n,{enumerable:y(0,!1)})):(f(t,_)||Q(t,_,y(1,{})),t[_][r]=!0),nt(t,r,n)):Q(t,r,n)},it=function(t,e){p(t);var n=d(e),r=C(n).concat(ut(n));return B(r,function(e){c&&!i(at,n,e)||ot(t,e,n[e])}),t},at=function(t){var e=v(t),n=i(X,this,e);return!(this===q&&f(J,e)&&!f(Z,e))&&(!(n||!f(this,e)||!f(J,e)||f(this,_)&&this[_][e])||n)},st=function(t,e){var n=d(t),r=v(e);if(n!==q||!f(J,r)||f(Z,r)){var o=Y(n,r);return!o||!f(J,r)||f(n,_)&&n[_][r]||(o.enumerable=!0),o}},ct=function(t){var e=K(d(t)),n=[];return B(e,function(t){f(J,t)||f(T,t)||$(n,t)}),n},ut=function(t){var e=t===q,n=K(e?Z:d(t)),r=[];return B(n,function(t){!f(J,t)||e&&!f(q,t)||$(r,J[t])}),r};u||(E(V=(W=function(){if(h(V,this))throw G("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?g(arguments[0]):void 0,e=D(t),n=function(t){this===q&&i(n,Z,t),f(this,_)&&f(this[_],e)&&(this[_][e]=!1),nt(this,e,y(1,t))};return c&&et&&nt(q,e,{configurable:!0,set:n}),rt(e,t)}).prototype,"toString",function(){return j(this).tag}),E(W,"withoutSetter",function(t){return rt(D(t),t)}),A.f=at,S.f=ot,P.f=it,b.f=st,m.f=w.f=ct,k.f=ut,F.f=function(t){return rt(L(t),t)},c&&(Q(V,"description",{configurable:!0,get:function(){return j(this).description}}),s||E(q,"propertyIsEnumerable",at,{unsafe:!0}))),r({global:!0,constructor:!0,wrap:!0,forced:!u,sham:!u},{Symbol:W}),B(C(tt),function(t){O(t)}),r({target:"Symbol",stat:!0,forced:!u},{useSetter:function(){et=!0},useSimple:function(){et=!1}}),r({target:"Object",stat:!0,forced:!u,sham:!c},{create:function(t,e){return void 0===e?x(t):it(x(t),e)},defineProperty:ot,defineProperties:it,getOwnPropertyDescriptor:st}),r({target:"Object",stat:!0,forced:!u},{getOwnPropertyNames:ct}),U(),N(W,"Symbol"),T[_]=!0},function(t,e,n){"use strict";var r=n(128),o=n(59);t.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},function(t,e,n){var r=n(15),o=n(18),i=r.WeakMap;t.exports=o(i)&&/native code/.test(String(i))},function(t,e,n){var r=n(7),o=n(30),i=n(25),a=n(37),s=n(87),c=n(156),u=s("string-to-symbol-registry"),l=s("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!c},{for:function(t){var e=a(t);if(i(u,e))return u[e];var n=o("Symbol")(e);return u[e]=n,l[n]=e,n}})},function(t,e,n){var r=n(7),o=n(25),i=n(105),a=n(75),s=n(87),c=n(156),u=s("symbol-to-string-registry");r({target:"Symbol",stat:!0,forced:!c},{keyFor:function(t){if(!i(t))throw TypeError(a(t)+" is not a symbol");if(o(u,t))return u[t]}})},function(t,e,n){var r=n(7),o=n(73),i=n(12),a=n(113),s=n(34);r({target:"Object",stat:!0,forced:!o||i(function(){a.f(1)})},{getOwnPropertySymbols:function(t){var e=a.f;return e?e(s(t)):[]}})},function(t,e,n){n(20)("asyncIterator")},function(t,e){},function(t,e,n){n(20)("hasInstance")},function(t,e,n){n(20)("isConcatSpreadable")},function(t,e,n){n(20)("match")},function(t,e,n){n(20)("matchAll")},function(t,e,n){n(20)("replace")},function(t,e,n){n(20)("search")},function(t,e,n){n(20)("species")},function(t,e,n){n(20)("split")},function(t,e,n){var r=n(30),o=n(20),i=n(49);o("toStringTag"),i(r("Symbol"),"Symbol")},function(t,e,n){n(20)("unscopables")},function(t,e,n){var r=n(15);n(49)(r.JSON,"JSON",!0)},function(t,e){},function(t,e){},function(t,e,n){var r=n(22),o=n(25),i=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,s=o(i,"name"),c=s&&"something"===function(){}.name,u=s&&(!r||r&&a(i,"name").configurable);t.exports={EXISTS:s,PROPER:c,CONFIGURABLE:u}},function(t,e,n){var r=n(18),o=String,i=TypeError;t.exports=function(t){if("object"==typeof t||r(t))return t;throw i("Can't set "+o(t)+" as a prototype")}},function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,e,n){n(20)("asyncDispose")},function(t,e,n){n(20)("dispose")},function(t,e,n){n(20)("matcher")},function(t,e,n){n(20)("metadataKey")},function(t,e,n){n(20)("observable")},function(t,e,n){n(20)("metadata")},function(t,e,n){n(20)("patternMatch")},function(t,e,n){n(20)("replaceAll")},function(t,e,n){t.exports=n(257)},function(t,e,n){var r=n(258);t.exports=r},function(t,e,n){var r=n(259);t.exports=r},function(t,e,n){var r=n(260);n(50),t.exports=r},function(t,e,n){n(51),n(64);var r=n(92);t.exports=r},function(t,e,n){t.exports=n(262)},function(t,e,n){var r=n(263);t.exports=r},function(t,e,n){var r=n(166);t.exports=r},function(t,e,n){var r=n(21),o=n(265),i=Array.prototype;t.exports=function(t){var e=t.slice;return t===i||r(i,t)&&e===i.slice?o:e}},function(t,e,n){n(266);var r=n(28);t.exports=r("Array").slice},function(t,e,n){"use strict";var r=n(7),o=n(58),i=n(109),a=n(24),s=n(110),c=n(36),u=n(46),l=n(76),f=n(17),h=n(88),p=n(115),d=h("slice"),v=f("species"),g=Array,y=Math.max;r({target:"Array",proto:!0,forced:!d},{slice:function(t,e){var n,r,f,h=u(this),d=c(h),x=s(t,d),C=s(void 0===e?d:e,d);if(o(h)&&(n=h.constructor,(i(n)&&(n===g||o(n.prototype))||a(n)&&null===(n=n[v]))&&(n=void 0),n===g||void 0===n))return p(h,x,C);for(r=new(void 0===n?g:n)(y(C-x,0)),f=0;x<C;x++,f++)x in h&&l(r,f,h[x]);return r.length=f,r}})},function(t,e,n){t.exports=n(268)},function(t,e,n){var r=n(269);t.exports=r},function(t,e,n){var r=n(168);t.exports=r},function(t,e,n){n(64),n(271);var r=n(16);t.exports=r.Array.from},function(t,e,n){var r=n(7),o=n(169);r({target:"Array",stat:!0,forced:!n(172)(function(t){Array.from(t)})},{from:o})},function(t,e,n){var r=n(35),o=n(170);t.exports=function(t,e,n,i){try{return i?e(r(n)[0],n[1]):e(n)}catch(e){o(t,"throw",e)}}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(275)},function(t,e,n){var r=n(276);n(300),n(301),n(302),n(303),t.exports=r},function(t,e,n){var r=n(175);t.exports=r},function(t,e,n){n(176),n(51),n(77),n(285),n(184),n(185),n(299),n(64);var r=n(16);t.exports=r.Promise},function(t,e,n){"use strict";var r=n(7),o=n(21),i=n(116),a=n(117),s=n(279),c=n(63),u=n(48),l=n(56),f=n(281),h=n(282),p=n(61),d=n(283),v=n(17),g=n(284),y=v("toStringTag"),x=Error,C=[].push,m=function(t,e){var n,r=arguments.length>2?arguments[2]:void 0,s=o(w,this);a?n=a(x(),s?i(this):w):(n=s?this:c(w),u(n,y,"Error")),void 0!==e&&u(n,"message",d(e)),g&&u(n,"stack",f(n.stack,1)),h(n,r);var l=[];return p(t,C,{that:l}),u(n,"errors",l),n};a?a(m,x):s(m,x,{name:!0});var w=m.prototype=c(x.prototype,{constructor:l(1,m),message:l(1,""),name:l(1,"AggregateError")});r({global:!0,constructor:!0,arity:2},{AggregateError:m})},function(t,e,n){var r=n(25),o=n(280),i=n(85),a=n(31);t.exports=function(t,e,n){for(var s=o(e),c=a.f,u=i.f,l=0;l<s.length;l++){var f=s[l];r(t,f)||n&&r(n,f)||c(t,f,u(e,f))}}},function(t,e,n){var r=n(30),o=n(13),i=n(112),a=n(113),s=n(35),c=o([].concat);t.exports=r("Reflect","ownKeys")||function(t){var e=i.f(s(t)),n=a.f;return n?c(e,n(t)):e}},function(t,e,n){var r=n(13),o=Error,i=r("".replace),a=String(o("zxcasd").stack),s=/\n\s*at [^:]*:[^\n]*/,c=s.test(a);t.exports=function(t,e){if(c&&"string"==typeof t&&!o.prepareStackTrace)for(;e--;)t=i(t,s,"");return t}},function(t,e,n){var r=n(24),o=n(48);t.exports=function(t,e){r(e)&&"cause"in e&&o(t,"cause",e.cause)}},function(t,e,n){var r=n(37);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:r(t)}},function(t,e,n){var r=n(12),o=n(56);t.exports=!r(function(){var t=Error("a");return!("stack"in t)||(Object.defineProperty(t,"stack",o(1,7)),7!==t.stack)})},function(t,e,n){n(286),n(294),n(295),n(296),n(297),n(298)},function(t,e,n){"use strict";var r,o,i,a=n(7),s=n(39),c=n(93),u=n(15),l=n(23),f=n(44),h=n(117),p=n(49),d=n(177),v=n(38),g=n(18),y=n(24),x=n(94),C=n(178),m=n(179).set,w=n(288),k=n(291),b=n(79),S=n(292),P=n(60),A=n(80),E=n(95),R=n(62),I=E.CONSTRUCTOR,T=E.REJECTION_EVENT,D=E.SUBCLASSING,L=P.getterFor("Promise"),F=P.set,O=A&&A.prototype,U=A,N=O,M=u.TypeError,B=u.document,_=u.process,z=R.f,j=z,q=!!(B&&B.createEvent&&u.dispatchEvent),W=function(t){var e;return!(!y(t)||!g(e=t.then))&&e},V=function(t,e){var n,r,o,i=e.value,a=1==e.state,s=a?t.ok:t.fail,c=t.resolve,u=t.reject,f=t.domain;try{s?(a||(2===e.rejection&&K(e),e.rejection=1),!0===s?n=i:(f&&f.enter(),n=s(i),f&&(f.exit(),o=!0)),n===t.promise?u(M("Promise-chain cycle")):(r=W(n))?l(r,n,c,u):c(n)):u(i)}catch(t){f&&!o&&f.exit(),u(t)}},G=function(t,e){t.notified||(t.notified=!0,w(function(){for(var n,r=t.reactions;n=r.get();)V(n,t);t.notified=!1,e&&!t.rejection&&Y(t)}))},H=function(t,e,n){var r,o;q?((r=B.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),u.dispatchEvent(r)):r={promise:e,reason:n},!T&&(o=u["on"+t])?o(r):"unhandledrejection"===t&&k("Unhandled promise rejection",n)},Y=function(t){l(m,u,function(){var e,n=t.facade,r=t.value;if(Q(t)&&(e=b(function(){c?_.emit("unhandledRejection",r,n):H("unhandledrejection",n,r)}),t.rejection=c||Q(t)?2:1,e.error))throw e.value})},Q=function(t){return 1!==t.rejection&&!t.parent},K=function(t){l(m,u,function(){var e=t.facade;c?_.emit("rejectionHandled",e):H("rejectionhandled",e,t.value)})},X=function(t,e,n){return function(r){t(e,r,n)}},$=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,G(t,!0))},J=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw M("Promise can't be resolved itself");var r=W(e);r?w(function(){var n={done:!1};try{l(r,e,X(J,n,t),X($,n,t))}catch(e){$(n,e,t)}}):(t.value=e,t.state=1,G(t,!1))}catch(e){$({done:!1},e,t)}}};if(I&&(N=(U=function(t){x(this,N),v(t),l(r,this);var e=L(this);try{t(X(J,e),X($,e))}catch(t){$(e,t)}}).prototype,(r=function(t){F(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new S,rejection:!1,state:0,value:void 0})}).prototype=f(N,"then",function(t,e){var n=L(this),r=z(C(this,U));return n.parent=!0,r.ok=!g(t)||t,r.fail=g(e)&&e,r.domain=c?_.domain:void 0,0==n.state?n.reactions.add(r):w(function(){V(r,n)}),r.promise}),o=function(){var t=new r,e=L(t);this.promise=t,this.resolve=X(J,e),this.reject=X($,e)},R.f=z=function(t){return t===U||void 0===t?new o(t):j(t)},!s&&g(A)&&O!==Object.prototype)){i=O.then,D||f(O,"then",function(t,e){var n=this;return new U(function(t,e){l(i,n,t,e)}).then(t,e)},{unsafe:!0});try{delete O.constructor}catch(t){}h&&h(O,N)}a({global:!0,constructor:!0,wrap:!0,forced:I},{Promise:U}),p(U,"Promise",!1,!0),d("Promise")},function(t,e,n){var r=n(109),o=n(75),i=TypeError;t.exports=function(t){if(r(t))return t;throw i(o(t)+" is not a constructor")}},function(t,e,n){var r,o,i,a,s,c,u,l,f=n(15),h=n(43),p=n(85).f,d=n(179).set,v=n(180),g=n(289),y=n(290),x=n(93),C=f.MutationObserver||f.WebKitMutationObserver,m=f.document,w=f.process,k=f.Promise,b=p(f,"queueMicrotask"),S=b&&b.value;S||(r=function(){var t,e;for(x&&(t=w.domain)&&t.exit();o;){e=o.fn,o=o.next;try{e()}catch(t){throw o?a():i=void 0,t}}i=void 0,t&&t.enter()},v||x||y||!C||!m?!g&&k&&k.resolve?((u=k.resolve(void 0)).constructor=k,l=h(u.then,u),a=function(){l(r)}):x?a=function(){w.nextTick(r)}:(d=h(d,f),a=function(){d(r)}):(s=!0,c=m.createTextNode(""),new C(r).observe(c,{characterData:!0}),a=function(){c.data=s=!s})),t.exports=S||function(t){var e={fn:t,next:void 0};i&&(i.next=e),o||(o=e,a()),i=e}},function(t,e,n){var r=n(57),o=n(15);t.exports=/ipad|iphone|ipod/i.test(r)&&void 0!==o.Pebble},function(t,e,n){var r=n(57);t.exports=/web0s(?!.*chrome)/i.test(r)},function(t,e,n){var r=n(15);t.exports=function(t,e){var n=r.console;n&&n.error&&(1==arguments.length?n.error(t):n.error(t,e))}},function(t,e){var n=function(){this.head=null,this.tail=null};n.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}},t.exports=n},function(t,e,n){var r=n(181),o=n(93);t.exports=!r&&!o&&"object"==typeof window&&"object"==typeof document},function(t,e,n){"use strict";var r=n(7),o=n(23),i=n(38),a=n(62),s=n(79),c=n(61);r({target:"Promise",stat:!0,forced:n(182)},{all:function(t){var e=this,n=a.f(e),r=n.resolve,u=n.reject,l=s(function(){var n=i(e.resolve),a=[],s=0,l=1;c(t,function(t){var i=s++,c=!1;l++,o(n,e,t).then(function(t){c||(c=!0,a[i]=t,--l||r(a))},u)}),--l||r(a)});return l.error&&u(l.value),n.promise}})},function(t,e,n){"use strict";var r=n(7),o=n(39),i=n(95).CONSTRUCTOR,a=n(80),s=n(30),c=n(18),u=n(44),l=a&&a.prototype;if(r({target:"Promise",proto:!0,forced:i,real:!0},{catch:function(t){return this.then(void 0,t)}}),!o&&c(a)){var f=s("Promise").prototype.catch;l.catch!==f&&u(l,"catch",f,{unsafe:!0})}},function(t,e,n){"use strict";var r=n(7),o=n(23),i=n(38),a=n(62),s=n(79),c=n(61);r({target:"Promise",stat:!0,forced:n(182)},{race:function(t){var e=this,n=a.f(e),r=n.reject,u=s(function(){var a=i(e.resolve);c(t,function(t){o(a,e,t).then(n.resolve,r)})});return u.error&&r(u.value),n.promise}})},function(t,e,n){"use strict";var r=n(7),o=n(23),i=n(62);r({target:"Promise",stat:!0,forced:n(95).CONSTRUCTOR},{reject:function(t){var e=i.f(this);return o(e.reject,void 0,t),e.promise}})},function(t,e,n){"use strict";var r=n(7),o=n(30),i=n(39),a=n(80),s=n(95).CONSTRUCTOR,c=n(183),u=o("Promise"),l=i&&!s;r({target:"Promise",stat:!0,forced:i||s},{resolve:function(t){return c(l&&this===u?a:this,t)}})},function(t,e,n){"use strict";var r=n(7),o=n(39),i=n(80),a=n(12),s=n(30),c=n(18),u=n(178),l=n(183),f=n(44),h=i&&i.prototype;if(r({target:"Promise",proto:!0,real:!0,forced:!!i&&a(function(){h.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=u(this,s("Promise")),n=c(t);return this.then(n?function(n){return l(e,t()).then(function(){return n})}:t,n?function(n){return l(e,t()).then(function(){throw n})}:t)}}),!o&&c(i)){var p=s("Promise").prototype.finally;h.finally!==p&&f(h,"finally",p,{unsafe:!0})}},function(t,e,n){n(176)},function(t,e,n){n(184)},function(t,e,n){"use strict";var r=n(7),o=n(62),i=n(79);r({target:"Promise",stat:!0,forced:!0},{try:function(t){var e=o.f(this),n=i(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}})},function(t,e,n){n(185)},function(t,e,n){var r=n(139),o=n(173);t.exports=function(t){if(r(t))return o(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){var r=n(107),o=n(81),i=n(167);t.exports=function(t){if(void 0!==r&&null!=o(t)||null!=t["@@iterator"])return i(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(308)},function(t,e,n){var r=n(309);t.exports=r},function(t,e,n){var r=n(310);t.exports=r},function(t,e,n){var r=n(311);t.exports=r},function(t,e,n){n(312);var r=n(16).Object,o=t.exports=function(t,e,n){return r.defineProperty(t,e,n)};r.defineProperty.sham&&(o.sham=!0)},function(t,e,n){var r=n(7),o=n(22),i=n(31).f;r({target:"Object",stat:!0,forced:Object.defineProperty!==i,sham:!o},{defineProperty:i})},function(t,e,n){t.exports=n(314)},function(t,e,n){t.exports=n(315)},function(t,e,n){var r=n(316);t.exports=r},function(t,e,n){var r=n(317);t.exports=r},function(t,e,n){var r=n(318);n(50),t.exports=r},function(t,e,n){n(51),n(77),n(64),n(158);var r=n(114);t.exports=r.f("iterator")},function(t,e,n){var r=n(320),o=n(33).default;t.exports=function(t,e){if("object"!==o(t)||null===t)return t;var n=t[r];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==o(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(321)},function(t,e,n){t.exports=n(322)},function(t,e,n){var r=n(323);t.exports=r},function(t,e,n){var r=n(324);t.exports=r},function(t,e,n){var r=n(325);t.exports=r},function(t,e,n){n(326),n(159);var r=n(114);t.exports=r.f("toPrimitive")},function(t,e){},function(t,e,n){var r=n(33).default,o=n(136),i=n(107),a=n(328),s=n(335),c=n(342),u=n(350),l=n(174),f=n(357),h=n(165);function p(){"use strict";t.exports=p=function(){return e},t.exports.__esModule=!0,t.exports.default=t.exports;var e={},n=Object.prototype,d=n.hasOwnProperty,v=o||function(t,e,n){t[e]=n.value},g="function"==typeof i?i:{},y=g.iterator||"@@iterator",x=g.asyncIterator||"@@asyncIterator",C=g.toStringTag||"@@toStringTag";function m(t,e,n){return o(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{m({},"")}catch(t){m=function(t,e,n){return t[e]=n}}function w(t,e,n,r){var o=e&&e.prototype instanceof S?e:S,i=a(o.prototype),s=new N(r||[]);return v(i,"_invoke",{value:L(t,n,s)}),i}function k(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}e.wrap=w;var b={};function S(){}function P(){}function A(){}var E={};m(E,y,function(){return this});var R=s&&s(s(M([])));R&&R!==n&&d.call(R,y)&&(E=R);var I=A.prototype=S.prototype=a(E);function T(t){var e;c(e=["next","throw","return"]).call(e,function(e){m(t,e,function(t){return this._invoke(e,t)})})}function D(t,e){var n;v(this,"_invoke",{value:function(o,i){function a(){return new e(function(n,a){!function n(o,i,a,s){var c=k(t[o],t,i);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==r(l)&&d.call(l,"__await")?e.resolve(l.__await).then(function(t){n("next",t,a,s)},function(t){n("throw",t,a,s)}):e.resolve(l).then(function(t){u.value=t,a(u)},function(t){return n("throw",t,a,s)})}s(c.arg)}(o,i,n,a)})}return n=n?n.then(a,a):a()}})}function L(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=F(a,n);if(s){if(s===b)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=k(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===b)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}function F(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator.return&&(e.method="return",e.arg=void 0,F(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=k(r,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,b;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,b):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,b)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function U(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function N(t){this.tryEntries=[{tryLoc:"root"}],c(t).call(t,O,this),this.reset(!0)}function M(t){if(t){var e=t[y];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(d.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:B}}function B(){return{value:void 0,done:!0}}return P.prototype=A,v(I,"constructor",{value:A,configurable:!0}),v(A,"constructor",{value:P,configurable:!0}),P.displayName=m(A,C,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===P||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return u?u(t,A):(t.__proto__=A,m(t,C,"GeneratorFunction")),t.prototype=a(I),t},e.awrap=function(t){return{__await:t}},T(D.prototype),m(D.prototype,x,function(){return this}),e.AsyncIterator=D,e.async=function(t,n,r,o,i){void 0===i&&(i=l);var a=new D(w(t,n,r,o),i);return e.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},T(I),m(I,C,"Generator"),m(I,y,function(){return this}),m(I,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return f(n).call(n),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,N.prototype={constructor:N,reset:function(t){var e;if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,c(e=this.tryEntries).call(e,U),!t)for(var n in this)"t"===n.charAt(0)&&d.call(this,n)&&!isNaN(+h(n).call(n,1))&&(this[n]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return i.type="throw",i.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r],i=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var a=d.call(o,"catchLoc"),s=d.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&d.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=e,o?(this.method="next",this.next=o.finallyLoc,b):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),b},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),U(n),b}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;U(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:M(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),b}},e}t.exports=p,t.exports.__esModule=!0,t.exports.default=t.exports},function(t,e,n){t.exports=n(329)},function(t,e,n){t.exports=n(330)},function(t,e,n){var r=n(331);t.exports=r},function(t,e,n){var r=n(332);t.exports=r},function(t,e,n){var r=n(333);t.exports=r},function(t,e,n){n(334);var r=n(16).Object;t.exports=function(t,e){return r.create(t,e)}},function(t,e,n){n(7)({target:"Object",stat:!0,sham:!n(22)},{create:n(63)})},function(t,e,n){t.exports=n(336)},function(t,e,n){t.exports=n(337)},function(t,e,n){var r=n(338);t.exports=r},function(t,e,n){var r=n(339);t.exports=r},function(t,e,n){var r=n(340);t.exports=r},function(t,e,n){n(341);var r=n(16);t.exports=r.Object.getPrototypeOf},function(t,e,n){var r=n(7),o=n(12),i=n(34),a=n(116),s=n(162);r({target:"Object",stat:!0,forced:o(function(){a(1)}),sham:!s},{getPrototypeOf:function(t){return a(i(t))}})},function(t,e,n){t.exports=n(343)},function(t,e,n){t.exports=n(344)},function(t,e,n){var r=n(345);t.exports=r},function(t,e,n){var r=n(187);t.exports=r},function(t,e,n){var r=n(347);t.exports=r},function(t,e,n){n(348);var r=n(28);t.exports=r("Array").forEach},function(t,e,n){"use strict";var r=n(7),o=n(349);r({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(t,e,n){"use strict";var r=n(91).forEach,o=n(98)("forEach");t.exports=o?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,e,n){t.exports=n(351)},function(t,e,n){t.exports=n(352)},function(t,e,n){var r=n(353);t.exports=r},function(t,e,n){var r=n(354);t.exports=r},function(t,e,n){var r=n(355);t.exports=r},function(t,e,n){n(356);var r=n(16);t.exports=r.Object.setPrototypeOf},function(t,e,n){n(7)({target:"Object",stat:!0},{setPrototypeOf:n(117)})},function(t,e,n){t.exports=n(358)},function(t,e,n){t.exports=n(359)},function(t,e,n){var r=n(360);t.exports=r},function(t,e,n){var r=n(361);t.exports=r},function(t,e,n){var r=n(362);t.exports=r},function(t,e,n){var r=n(21),o=n(363),i=Array.prototype;t.exports=function(t){var e=t.reverse;return t===i||r(i,t)&&e===i.reverse?o:e}},function(t,e,n){n(364);var r=n(28);t.exports=r("Array").reverse},function(t,e,n){"use strict";var r=n(7),o=n(13),i=n(58),a=o([].reverse),s=[1,2];r({target:"Array",proto:!0,forced:String(s)===String(s.reverse())},{reverse:function(){return i(this)&&(this.length=this.length),a(this)}})},function(t,e,n){var r=n(366);n(50),t.exports=r},function(t,e,n){n(51),n(367),n(77),n(64);var r=n(16);t.exports=r.Map},function(t,e,n){n(368)},function(t,e,n){"use strict";n(188)("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},n(190))},function(t,e,n){var r=n(12),o=n(24),i=n(55),a=n(370),s=Object.isExtensible,c=r(function(){s(1)});t.exports=c||a?function(t){return!!o(t)&&(!a||"ArrayBuffer"!=i(t))&&(!s||s(t))}:s},function(t,e,n){var r=n(12);t.exports=r(function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})},function(t,e,n){var r=n(12);t.exports=!r(function(){return Object.isExtensible(Object.preventExtensions({}))})},function(t,e,n){var r=n(373);t.exports=r},function(t,e,n){n(157);var r=n(16),o=n(84);r.JSON||(r.JSON={stringify:JSON.stringify}),t.exports=function(t,e,n){return o(r.JSON.stringify,null,arguments)}},function(t,e,n){n(192);var r=n(16);t.exports=r.setTimeout},function(t,e,n){var r=n(7),o=n(15),i=n(193).setInterval;r({global:!0,bind:!0,forced:o.setInterval!==i},{setInterval:i})},function(t,e,n){var r=n(7),o=n(15),i=n(193).setTimeout;r({global:!0,bind:!0,forced:o.setTimeout!==i},{setTimeout:i})},function(t,e,n){var r=n(378);t.exports=r},function(t,e,n){var r=n(21),o=n(379),i=Array.prototype;t.exports=function(t){var e=t.indexOf;return t===i||r(i,t)&&e===i.indexOf?o:e}},function(t,e,n){n(380);var r=n(28);t.exports=r("Array").indexOf},function(t,e,n){"use strict";var r=n(7),o=n(101),i=n(129).indexOf,a=n(98),s=o([].indexOf),c=!!s&&1/s([1],1,-0)<0,u=a("indexOf");r({target:"Array",proto:!0,forced:c||!u},{indexOf:function(t){var e=arguments.length>1?arguments[1]:void 0;return c?s(this,t,e)||0:i(this,t,e)}})},function(t,e,n){var r=n(382);t.exports=r},function(t,e,n){n(383);var r=n(16);t.exports=r.Number.parseInt},function(t,e,n){var r=n(7),o=n(194);r({target:"Number",stat:!0,forced:Number.parseInt!=o},{parseInt:o})},function(t,e,n){var r=n(385);t.exports=r},function(t,e,n){n(386);var r=n(16);t.exports=r.Object.entries},function(t,e,n){var r=n(7),o=n(387).entries;r({target:"Object",stat:!0},{entries:function(t){return o(t)}})},function(t,e,n){var r=n(22),o=n(13),i=n(89),a=n(46),s=o(n(102).f),c=o([].push),u=function(t){return function(e){for(var n,o=a(e),u=i(o),l=u.length,f=0,h=[];l>f;)n=u[f++],r&&!s(o,n)||c(h,t?[n,o[n]]:o[n]);return h}};t.exports={entries:u(!0),values:u(!1)}},function(t,e,n){var r=n(389);n(50),t.exports=r},function(t,e,n){n(51),n(77),n(390),n(64);var r=n(16);t.exports=r.Set},function(t,e,n){n(391)},function(t,e,n){"use strict";n(188)("Set",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},n(190))},function(t,e,n){n(192);var r=n(16);t.exports=r.setInterval},function(t,e,n){var r=n(394);t.exports=r},function(t,e,n){var r=n(21),o=n(395),i=Array.prototype;t.exports=function(t){var e=t.sort;return t===i||r(i,t)&&e===i.sort?o:e}},function(t,e,n){n(396);var r=n(28);t.exports=r("Array").sort},function(t,e,n){"use strict";var r=n(7),o=n(13),i=n(38),a=n(34),s=n(36),c=n(195),u=n(37),l=n(12),f=n(196),h=n(98),p=n(397),d=n(398),v=n(74),g=n(399),y=[],x=o(y.sort),C=o(y.push),m=l(function(){y.sort(void 0)}),w=l(function(){y.sort(null)}),k=h("sort"),b=!l(function(){if(v)return v<70;if(!(p&&p>3)){if(d)return!0;if(g)return g<603;var t,e,n,r,o="";for(t=65;t<76;t++){switch(e=String.fromCharCode(t),t){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)y.push({k:e+r,v:n})}for(y.sort(function(t,e){return e.v-t.v}),r=0;r<y.length;r++)e=y[r].k.charAt(0),o.charAt(o.length-1)!==e&&(o+=e);return"DGBEFHACIJK"!==o}});r({target:"Array",proto:!0,forced:m||!w||!k||!b},{sort:function(t){void 0!==t&&i(t);var e=a(this);if(b)return void 0===t?x(e):x(e,t);var n,r,o=[],l=s(e);for(r=0;r<l;r++)r in e&&C(o,e[r]);for(f(o,function(t){return function(e,n){return void 0===n?-1:void 0===e?1:void 0!==t?+t(e,n)||0:u(e)>u(n)?1:-1}}(t)),n=s(o),r=0;r<n;)e[r]=o[r++];for(;r<l;)c(e,r++);return e}})},function(t,e,n){var r=n(57).match(/firefox\/(\d+)/i);t.exports=!!r&&+r[1]},function(t,e,n){var r=n(57);t.exports=/MSIE|Trident/.test(r)},function(t,e,n){var r=n(57).match(/AppleWebKit\/(\d+)\./);t.exports=!!r&&+r[1]},function(t,e,n){var r=n(401);t.exports=r},function(t,e,n){var r=n(21),o=n(402),i=n(404),a=Array.prototype,s=String.prototype;t.exports=function(t){var e=t.includes;return t===a||r(a,t)&&e===a.includes?o:"string"==typeof t||t===s||r(s,t)&&e===s.includes?i:e}},function(t,e,n){n(403);var r=n(28);t.exports=r("Array").includes},function(t,e,n){"use strict";var r=n(7),o=n(129).includes,i=n(12),a=n(132);r({target:"Array",proto:!0,forced:i(function(){return!Array(1).includes()})},{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),a("includes")},function(t,e,n){n(405);var r=n(28);t.exports=r("String").includes},function(t,e,n){"use strict";var r=n(7),o=n(13),i=n(197),a=n(72),s=n(37),c=n(198),u=o("".indexOf);r({target:"String",proto:!0,forced:!c("includes")},{includes:function(t){return!!~u(s(a(this)),s(i(t)),arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var r=n(24),o=n(55),i=n(17)("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[i])?!!e:"RegExp"==o(t))}},function(t,e,n){var r=n(408);t.exports=r},function(t,e,n){var r=n(21),o=n(409),i=String.prototype;t.exports=function(t){var e=t.startsWith;return"string"==typeof t||t===i||r(i,t)&&e===i.startsWith?o:e}},function(t,e,n){n(410);var r=n(28);t.exports=r("String").startsWith},function(t,e,n){"use strict";var r,o=n(7),i=n(101),a=n(85).f,s=n(149),c=n(37),u=n(197),l=n(72),f=n(198),h=n(39),p=i("".startsWith),d=i("".slice),v=Math.min,g=f("startsWith");o({target:"String",proto:!0,forced:!(!h&&!g&&(r=a(String.prototype,"startsWith"),r&&!r.writable)||g)},{startsWith:function(t){var e=c(l(this));u(t);var n=s(v(arguments.length>1?arguments[1]:void 0,e.length)),r=c(t);return p?p(e,r,n):d(e,n,n+r.length)===r}})},function(t,e,n){var r=n(412);t.exports=r},function(t,e,n){n(413);var r=n(16);t.exports=r.Object.keys},function(t,e,n){var r=n(7),o=n(34),i=n(89);r({target:"Object",stat:!0,forced:n(12)(function(){i(1)})},{keys:function(t){return i(o(t))}})},function(t,e,n){var r=n(415);t.exports=r},function(t,e,n){n(416);var r=n(16);t.exports=r.Date.now},function(t,e,n){var r=n(7),o=n(13),i=Date,a=o(i.prototype.getTime);r({target:"Date",stat:!0},{now:function(){return a(new i)}})},function(t,e,n){"use strict";(function(t){var r=n(418),o=n(419),i=n(420);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return u(this,t,e,n)}function u(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=h(t,e),t}(t,e,n,r):"string"==typeof e?function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(e,n),o=(t=s(t,r)).write(e,n);return o!==r&&(t=t.slice(0,o)),t}(t,e,n):function(t,e){if(c.isBuffer(e)){var n=0|p(e.length);return 0===(t=s(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?s(t,0):h(t,e);if("Buffer"===e.type&&i(e.data))return h(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,e){if(l(e),t=s(t,e<0?0:0|p(e)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function h(t,e){var n=e.length<0?0:0|p(e.length);t=s(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function p(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function d(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return _(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(t).length;default:if(r)return _(t).length;e=(""+e).toLowerCase(),r=!0}}function v(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function g(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=c.from(e,r)),c.isBuffer(e))return 0===e.length?-1:y(t,e,n,r,o);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):y(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function y(t,e,n,r,o){var i,a=1,s=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){var l=-1;for(i=n;i<s;i++)if(u(t,i)===u(e,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*a}else-1!==l&&(i-=i-l),l=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){for(var f=!0,h=0;h<c;h++)if(u(t,i+h)!==u(e,h)){f=!1;break}if(f)return i}return-1}function x(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=e.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[n+a]=s}return a}function C(t,e,n,r){return j(_(e,t.length-n),t,n,r)}function m(t,e,n,r){return j(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function w(t,e,n,r){return m(t,e,n,r)}function k(t,e,n,r){return j(z(e),t,n,r)}function b(t,e,n,r){return j(function(t,e){for(var n,r,o,i=[],a=0;a<t.length&&!((e-=2)<0);++a)r=(n=t.charCodeAt(a))>>8,o=n%256,i.push(o),i.push(r);return i}(e,t.length-n),t,n,r)}function S(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function P(t,e,n){n=Math.min(t.length,n);for(var r=[],o=e;o<n;){var i,a,s,c,u=t[o],l=null,f=u>239?4:u>223?3:u>191?2:1;if(o+f<=n)switch(f){case 1:u<128&&(l=u);break;case 2:128==(192&(i=t[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=t[o+1],a=t[o+2],128==(192&i)&&128==(192&a)&&(c=(15&u)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=t[o+1],a=t[o+2],s=t[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,f=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=f}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}function A(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function E(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function R(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=B(t[i]);return o}function I(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function T(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function D(t,e,n,r,o,i){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function L(t,e,n,r){e<0&&(e=65535+e+1);for(var o=0,i=Math.min(t.length-n,2);o<i;++o)t[n+o]=(e&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function F(t,e,n,r){e<0&&(e=4294967295+e+1);for(var o=0,i=Math.min(t.length-n,4);o<i;++o)t[n+o]=e>>>8*(r?o:3-o)&255}function O(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function U(t,e,n,r,i){return i||O(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function N(t,e,n,r,i){return i||O(t,0,n,8),o.write(t,e,n,r,52,8),n+8}e.Buffer=c,e.SlowBuffer=function(t){return+t!=t&&(t=0),c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,n){return u(null,t,e,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,n){return function(t,e,n,r){return l(e),e<=0?s(t,e):void 0!==n?"string"==typeof r?s(t,e).fill(n,r):s(t,e).fill(n):s(t,e)}(null,t,e,n)},c.allocUnsafe=function(t){return f(null,t)},c.allocUnsafeSlow=function(t){return f(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!i(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=c.allocUnsafe(e),o=0;for(n=0;n<t.length;++n){var a=t[n];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,o),o+=a.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return R(this,e,n);case"utf8":case"utf-8":return P(this,e,n);case"ascii":return A(this,e,n);case"latin1":case"binary":return E(this,e,n);case"base64":return S(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,n,r,o){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;for(var i=(o>>>=0)-(r>>>=0),a=(n>>>=0)-(e>>>=0),s=Math.min(i,a),u=this.slice(r,o),l=t.slice(e,n),f=0;f<s;++f)if(u[f]!==l[f]){i=u[f],a=l[f];break}return i<a?-1:a<i?1:0},c.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},c.prototype.indexOf=function(t,e,n){return g(this,t,e,n,!0)},c.prototype.lastIndexOf=function(t,e,n){return g(this,t,e,n,!1)},c.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return x(this,t,e,n);case"utf8":case"utf-8":return C(this,t,e,n);case"ascii":return m(this,t,e,n);case"latin1":case"binary":return w(this,t,e,n);case"base64":return k(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return b(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},c.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=c.prototype;else{var o=e-t;n=new c(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+t]}return n},c.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},c.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},c.prototype.readUInt8=function(t,e){return e||T(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||T(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||T(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||T(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||T(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*e)),r},c.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||T(t,e,this.length);for(var r=e,o=1,i=this[t+--r];r>0&&(o*=256);)i+=this[t+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*e)),i},c.prototype.readInt8=function(t,e){return e||T(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||T(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(t,e){e||T(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(t,e){return e||T(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||T(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||T(t,4,this.length),o.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||T(t,4,this.length),o.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||T(t,8,this.length),o.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||T(t,8,this.length),o.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||D(this,t,e,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},c.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||D(this,t,e,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+n},c.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):F(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):F(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);D(this,t,e,n,o-1,-o)}var i=0,a=1,s=0;for(this[e]=255&t;++i<n&&(a*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+n},c.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);D(this,t,e,n,o-1,-o)}var i=n-1,a=1,s=0;for(this[e+i]=255&t;--i>=0&&(a*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+n},c.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):F(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||D(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):F(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,n){return U(this,t,e,!0,n)},c.prototype.writeFloatBE=function(t,e,n){return U(this,t,e,!1,n)},c.prototype.writeDoubleLE=function(t,e,n){return N(this,t,e,!0,n)},c.prototype.writeDoubleBE=function(t,e,n){return N(this,t,e,!1,n)},c.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var o,i=r-n;if(this===t&&n<e&&e<r)for(o=i-1;o>=0;--o)t[o+e]=this[o+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)t[o+e]=this[o+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+i),e);return i},c.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var o=t.charCodeAt(0);o<256&&(t=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{var a=c.isBuffer(t)?t:_(new c(t,r).toString()),s=a.length;for(i=0;i<n-e;++i)this[i+e]=a[i%s]}return this};var M=/[^+\/0-9A-Za-z-_]/g;function B(t){return t<16?"0"+t.toString(16):t.toString(16)}function _(t,e){var n;e=e||1/0;for(var r=t.length,o=null,i=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function z(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(M,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function j(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}}).call(this,n(141))},function(t,e,n){"use strict";e.byteLength=function(t){var e=u(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,r=u(t),a=r[0],s=r[1],c=new i(3*(a+s)/4-s),l=0,f=s>0?a-4:a;for(n=0;n<f;n+=4)e=o[t.charCodeAt(n)]<<18|o[t.charCodeAt(n+1)]<<12|o[t.charCodeAt(n+2)]<<6|o[t.charCodeAt(n+3)],c[l++]=e>>16&255,c[l++]=e>>8&255,c[l++]=255&e;return 2===s&&(e=o[t.charCodeAt(n)]<<2|o[t.charCodeAt(n+1)]>>4,c[l++]=255&e),1===s&&(e=o[t.charCodeAt(n)]<<10|o[t.charCodeAt(n+1)]<<4|o[t.charCodeAt(n+2)]>>2,c[l++]=e>>8&255,c[l++]=255&e),c},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,i=[],a=0,s=n-o;a<s;a+=16383)i.push(l(t,a,a+16383>s?s:a+16383));return 1===o?(e=t[n-1],i.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],i.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)r[s]=a[s],o[a.charCodeAt(s)]=s;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function l(t,e,n){for(var o,i,a=[],s=e;s<n;s+=3)o=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,o){var i,a,s=8*o-r-1,c=(1<<s)-1,u=c>>1,l=-7,f=n?o-1:0,h=n?-1:1,p=t[e+f];for(f+=h,i=p&(1<<-l)-1,p>>=-l,l+=s;l>0;i=256*i+t[e+f],f+=h,l-=8);for(a=i&(1<<-l)-1,i>>=-l,l+=r;l>0;a=256*a+t[e+f],f+=h,l-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),i-=u}return(p?-1:1)*a*Math.pow(2,i-r)},e.write=function(t,e,n,r,o,i){var a,s,c,u=8*i-o-1,l=(1<<u)-1,f=l>>1,h=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),(e+=a+f>=1?h/c:h*Math.pow(2,1-f))*c>=2&&(a++,c/=2),a+f>=l?(s=0,a=l):a+f>=1?(s=(e*c-1)*Math.pow(2,o),a+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,o),a=0));o>=8;t[n+p]=255&s,p+=d,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;t[n+p]=255&a,p+=d,a/=256,u-=8);t[n+p-d]|=128*v}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){var r=n(422);t.exports=r},function(t,e,n){var r=n(21),o=n(423),i=Array.prototype;t.exports=function(t){var e=t.splice;return t===i||r(i,t)&&e===i.splice?o:e}},function(t,e,n){n(424);var r=n(28);t.exports=r("Array").splice},function(t,e,n){"use strict";var r=n(7),o=n(34),i=n(110),a=n(97),s=n(36),c=n(425),u=n(127),l=n(108),f=n(76),h=n(195),p=n(88)("splice"),d=Math.max,v=Math.min;r({target:"Array",proto:!0,forced:!p},{splice:function(t,e){var n,r,p,g,y,x,C=o(this),m=s(C),w=i(t,m),k=arguments.length;for(0===k?n=r=0:1===k?(n=0,r=m-w):(n=k-2,r=v(d(a(e),0),m-w)),u(m+n-r),p=l(C,r),g=0;g<r;g++)(y=w+g)in C&&f(p,g,C[y]);if(p.length=r,n<r){for(g=w;g<m-r;g++)x=g+n,(y=g+r)in C?C[x]=C[y]:h(C,x);for(g=m;g>m-r+n;g--)h(C,g-1)}else if(n>r)for(g=m-r;g>w;g--)x=g+n-1,(y=g+r-1)in C?C[x]=C[y]:h(C,x);for(g=0;g<n;g++)C[g+w]=arguments[g+2];return c(C,m-r+n),p}})},function(t,e,n){"use strict";var r=n(22),o=n(58),i=TypeError,a=Object.getOwnPropertyDescriptor,s=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=s?function(t,e){if(o(t)&&!a(t,"length").writable)throw i("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},function(t,e,n){var r=n(427);t.exports=r},function(t,e,n){var r=n(21),o=n(428),i=Array.prototype;t.exports=function(t){var e=t.concat;return t===i||r(i,t)&&e===i.concat?o:e}},function(t,e,n){n(148);var r=n(28);t.exports=r("Array").concat},function(t,e,n){var r=n(430);t.exports=r},function(t,e,n){var r=n(21),o=n(431),i=Array.prototype;t.exports=function(t){var e=t.filter;return t===i||r(i,t)&&e===i.filter?o:e}},function(t,e,n){n(432);var r=n(28);t.exports=r("Array").filter},function(t,e,n){"use strict";var r=n(7),o=n(91).filter;r({target:"Array",proto:!0,forced:!n(88)("filter")},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var r=n(434);n(50),t.exports=r},function(t,e,n){n(51),n(435);var r=n(16);t.exports=r.Object.fromEntries},function(t,e,n){var r=n(7),o=n(61),i=n(76);r({target:"Object",stat:!0},{fromEntries:function(t){var e={};return o(t,function(t,n){i(e,t,n)},{AS_ENTRIES:!0}),e}})},function(t,e,n){var r=n(437);t.exports=r},function(t,e,n){var r=n(21),o=n(438),i=Array.prototype;t.exports=function(t){var e=t.map;return t===i||r(i,t)&&e===i.map?o:e}},function(t,e,n){n(439);var r=n(28);t.exports=r("Array").map},function(t,e,n){"use strict";var r=n(7),o=n(91).map;r({target:"Array",proto:!0,forced:!n(88)("map")},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var r=n(441);t.exports=r},function(t,e,n){var r=n(21),o=n(442),i=Array.prototype;t.exports=function(t){var e=t.flatMap;return t===i||r(i,t)&&e===i.flatMap?o:e}},function(t,e,n){n(443),n(445);var r=n(28);t.exports=r("Array").flatMap},function(t,e,n){"use strict";var r=n(7),o=n(444),i=n(38),a=n(34),s=n(36),c=n(108);r({target:"Array",proto:!0},{flatMap:function(t){var e,n=a(this),r=s(n);return i(t),(e=c(n,0)).length=o(e,n,n,r,0,1,t,arguments.length>1?arguments[1]:void 0),e}})},function(t,e,n){"use strict";var r=n(58),o=n(36),i=n(127),a=n(43),s=function(t,e,n,c,u,l,f,h){for(var p,d,v=u,g=0,y=!!f&&a(f,h);g<c;)g in n&&(p=y?y(n[g],g,e):n[g],l>0&&r(p)?(d=o(p),v=s(t,e,p,d,v,l-1)-1):(i(v+1),t[v]=p),v++),g++;return v};t.exports=s},function(t,e,n){n(132)("flatMap")},function(t,e,n){n(50);var r=n(59),o=n(25),i=n(21),a=n(447),s=Array.prototype,c={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var e=t.values;return t===s||i(s,t)&&e===s.values||o(c,r(t))?a:e}},function(t,e,n){var r=n(448);t.exports=r},function(t,e,n){n(51),n(77);var r=n(28);t.exports=r("Array").values},function(t,e,n){var r=n(450);t.exports=r},function(t,e,n){n(451);var r=n(16);t.exports=r.Number.isInteger},function(t,e,n){n(7)({target:"Number",stat:!0},{isInteger:n(452)})},function(t,e,n){var r=n(24),o=Math.floor;t.exports=Number.isInteger||function(t){return!r(t)&&isFinite(t)&&o(t)===t}},function(t,e,n){var r=n(454);t.exports=r},function(t,e,n){var r=n(21),o=n(455),i=Array.prototype;t.exports=function(t){var e=t.reduce;return t===i||r(i,t)&&e===i.reduce?o:e}},function(t,e,n){n(456);var r=n(28);t.exports=r("Array").reduce},function(t,e,n){"use strict";var r=n(7),o=n(457).left,i=n(98),a=n(74),s=n(93);r({target:"Array",proto:!0,forced:!i("reduce")||!s&&a>79&&a<83},{reduce:function(t){var e=arguments.length;return o(this,t,e,e>1?arguments[1]:void 0)}})},function(t,e,n){var r=n(38),o=n(34),i=n(103),a=n(36),s=TypeError,c=function(t){return function(e,n,c,u){r(n);var l=o(e),f=i(l),h=a(l),p=t?h-1:0,d=t?-1:1;if(c<2)for(;;){if(p in f){u=f[p],p+=d;break}if(p+=d,t?p<0:h<=p)throw s("Reduce of empty array with no initial value")}for(;t?p>=0:h>p;p+=d)p in f&&(u=n(u,f[p],p,l));return u}};t.exports={left:c(!1),right:c(!0)}},function(t,e,n){var r=n(459);t.exports=r},function(t,e,n){n(460);var r=n(16);t.exports=r.parseInt},function(t,e,n){var r=n(7),o=n(194);r({global:!0,forced:parseInt!=o},{parseInt:o})},function(t,e,n){var r=n(462);t.exports=r},function(t,e,n){n(463),n(468),n(469);var r=n(16);t.exports=r.URL},function(t,e,n){n(464)},function(t,e,n){"use strict";n(64);var r,o=n(7),i=n(22),a=n(199),s=n(15),c=n(43),u=n(13),l=n(44),f=n(465),h=n(94),p=n(25),d=n(466),v=n(169),g=n(131),y=n(163).codeAt,x=n(467),C=n(37),m=n(49),w=n(118),k=n(200),b=n(60),S=b.set,P=b.getterFor("URL"),A=k.URLSearchParams,E=k.getState,R=s.URL,I=s.TypeError,T=s.parseInt,D=Math.floor,L=Math.pow,F=u("".charAt),O=u(/./.exec),U=u([].join),N=u(1..toString),M=u([].pop),B=u([].push),_=u("".replace),z=u([].shift),j=u("".split),q=u("".slice),W=u("".toLowerCase),V=u([].unshift),G=/[a-z]/i,H=/[\d+-.a-z]/i,Y=/\d/,Q=/^0x/i,K=/^[0-7]+$/,X=/^\d+$/,$=/^[\da-f]+$/i,J=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Z=/[\0\t\n\r #/:<>?@[\\\]^|]/,tt=/^[\u0000-\u0020]+|[\u0000-\u0020]+$/g,et=/[\t\n\r]/g,nt=function(t){var e,n,r,o;if("number"==typeof t){for(e=[],n=0;n<4;n++)V(e,t%256),t=D(t/256);return U(e,".")}if("object"==typeof t){for(e="",r=function(t){for(var e=null,n=1,r=null,o=0,i=0;i<8;i++)0!==t[i]?(o>n&&(e=r,n=o),r=null,o=0):(null===r&&(r=i),++o);return o>n&&(e=r,n=o),e}(t),n=0;n<8;n++)o&&0===t[n]||(o&&(o=!1),r===n?(e+=n?":":"::",o=!0):(e+=N(t[n],16),n<7&&(e+=":")));return"["+e+"]"}return t},rt={},ot=d({},rt,{" ":1,'"':1,"<":1,">":1,"`":1}),it=d({},ot,{"#":1,"?":1,"{":1,"}":1}),at=d({},it,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),st=function(t,e){var n=y(t,0);return n>32&&n<127&&!p(e,t)?t:encodeURIComponent(t)},ct={ftp:21,file:null,http:80,https:443,ws:80,wss:443},ut=function(t,e){var n;return 2==t.length&&O(G,F(t,0))&&(":"==(n=F(t,1))||!e&&"|"==n)},lt=function(t){var e;return t.length>1&&ut(q(t,0,2))&&(2==t.length||"/"===(e=F(t,2))||"\\"===e||"?"===e||"#"===e)},ft=function(t){return"."===t||"%2e"===W(t)},ht={},pt={},dt={},vt={},gt={},yt={},xt={},Ct={},mt={},wt={},kt={},bt={},St={},Pt={},At={},Et={},Rt={},It={},Tt={},Dt={},Lt={},Ft=function(t,e,n){var r,o,i,a=C(t);if(e){if(o=this.parse(a))throw I(o);this.searchParams=null}else{if(void 0!==n&&(r=new Ft(n,!0)),o=this.parse(a,null,r))throw I(o);(i=E(new A)).bindURL(this),this.searchParams=i}};Ft.prototype={type:"URL",parse:function(t,e,n){var o,i,a,s,c,u=this,l=e||ht,f=0,h="",d=!1,y=!1,x=!1;for(t=C(t),e||(u.scheme="",u.username="",u.password="",u.host=null,u.port=null,u.path=[],u.query=null,u.fragment=null,u.cannotBeABaseURL=!1,t=_(t,tt,"")),t=_(t,et,""),o=v(t);f<=o.length;){switch(i=o[f],l){case ht:if(!i||!O(G,i)){if(e)return"Invalid scheme";l=dt;continue}h+=W(i),l=pt;break;case pt:if(i&&(O(H,i)||"+"==i||"-"==i||"."==i))h+=W(i);else{if(":"!=i){if(e)return"Invalid scheme";h="",l=dt,f=0;continue}if(e&&(u.isSpecial()!=p(ct,h)||"file"==h&&(u.includesCredentials()||null!==u.port)||"file"==u.scheme&&!u.host))return;if(u.scheme=h,e)return void(u.isSpecial()&&ct[u.scheme]==u.port&&(u.port=null));h="","file"==u.scheme?l=Pt:u.isSpecial()&&n&&n.scheme==u.scheme?l=vt:u.isSpecial()?l=Ct:"/"==o[f+1]?(l=gt,f++):(u.cannotBeABaseURL=!0,B(u.path,""),l=Tt)}break;case dt:if(!n||n.cannotBeABaseURL&&"#"!=i)return"Invalid scheme";if(n.cannotBeABaseURL&&"#"==i){u.scheme=n.scheme,u.path=g(n.path),u.query=n.query,u.fragment="",u.cannotBeABaseURL=!0,l=Lt;break}l="file"==n.scheme?Pt:yt;continue;case vt:if("/"!=i||"/"!=o[f+1]){l=yt;continue}l=mt,f++;break;case gt:if("/"==i){l=wt;break}l=It;continue;case yt:if(u.scheme=n.scheme,i==r)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=g(n.path),u.query=n.query;else if("/"==i||"\\"==i&&u.isSpecial())l=xt;else if("?"==i)u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=g(n.path),u.query="",l=Dt;else{if("#"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=g(n.path),u.path.length--,l=It;continue}u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,u.path=g(n.path),u.query=n.query,u.fragment="",l=Lt}break;case xt:if(!u.isSpecial()||"/"!=i&&"\\"!=i){if("/"!=i){u.username=n.username,u.password=n.password,u.host=n.host,u.port=n.port,l=It;continue}l=wt}else l=mt;break;case Ct:if(l=mt,"/"!=i||"/"!=F(h,f+1))continue;f++;break;case mt:if("/"!=i&&"\\"!=i){l=wt;continue}break;case wt:if("@"==i){d&&(h="%40"+h),d=!0,a=v(h);for(var m=0;m<a.length;m++){var w=a[m];if(":"!=w||x){var k=st(w,at);x?u.password+=k:u.username+=k}else x=!0}h=""}else if(i==r||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(d&&""==h)return"Invalid authority";f-=v(h).length+1,h="",l=kt}else h+=i;break;case kt:case bt:if(e&&"file"==u.scheme){l=Et;continue}if(":"!=i||y){if(i==r||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()){if(u.isSpecial()&&""==h)return"Invalid host";if(e&&""==h&&(u.includesCredentials()||null!==u.port))return;if(s=u.parseHost(h))return s;if(h="",l=Rt,e)return;continue}"["==i?y=!0:"]"==i&&(y=!1),h+=i}else{if(""==h)return"Invalid host";if(s=u.parseHost(h))return s;if(h="",l=St,e==bt)return}break;case St:if(!O(Y,i)){if(i==r||"/"==i||"?"==i||"#"==i||"\\"==i&&u.isSpecial()||e){if(""!=h){var b=T(h,10);if(b>65535)return"Invalid port";u.port=u.isSpecial()&&b===ct[u.scheme]?null:b,h=""}if(e)return;l=Rt;continue}return"Invalid port"}h+=i;break;case Pt:if(u.scheme="file","/"==i||"\\"==i)l=At;else{if(!n||"file"!=n.scheme){l=It;continue}if(i==r)u.host=n.host,u.path=g(n.path),u.query=n.query;else if("?"==i)u.host=n.host,u.path=g(n.path),u.query="",l=Dt;else{if("#"!=i){lt(U(g(o,f),""))||(u.host=n.host,u.path=g(n.path),u.shortenPath()),l=It;continue}u.host=n.host,u.path=g(n.path),u.query=n.query,u.fragment="",l=Lt}}break;case At:if("/"==i||"\\"==i){l=Et;break}n&&"file"==n.scheme&&!lt(U(g(o,f),""))&&(ut(n.path[0],!0)?B(u.path,n.path[0]):u.host=n.host),l=It;continue;case Et:if(i==r||"/"==i||"\\"==i||"?"==i||"#"==i){if(!e&&ut(h))l=It;else if(""==h){if(u.host="",e)return;l=Rt}else{if(s=u.parseHost(h))return s;if("localhost"==u.host&&(u.host=""),e)return;h="",l=Rt}continue}h+=i;break;case Rt:if(u.isSpecial()){if(l=It,"/"!=i&&"\\"!=i)continue}else if(e||"?"!=i)if(e||"#"!=i){if(i!=r&&(l=It,"/"!=i))continue}else u.fragment="",l=Lt;else u.query="",l=Dt;break;case It:if(i==r||"/"==i||"\\"==i&&u.isSpecial()||!e&&("?"==i||"#"==i)){if(".."===(c=W(c=h))||"%2e."===c||".%2e"===c||"%2e%2e"===c?(u.shortenPath(),"/"==i||"\\"==i&&u.isSpecial()||B(u.path,"")):ft(h)?"/"==i||"\\"==i&&u.isSpecial()||B(u.path,""):("file"==u.scheme&&!u.path.length&&ut(h)&&(u.host&&(u.host=""),h=F(h,0)+":"),B(u.path,h)),h="","file"==u.scheme&&(i==r||"?"==i||"#"==i))for(;u.path.length>1&&""===u.path[0];)z(u.path);"?"==i?(u.query="",l=Dt):"#"==i&&(u.fragment="",l=Lt)}else h+=st(i,it);break;case Tt:"?"==i?(u.query="",l=Dt):"#"==i?(u.fragment="",l=Lt):i!=r&&(u.path[0]+=st(i,rt));break;case Dt:e||"#"!=i?i!=r&&("'"==i&&u.isSpecial()?u.query+="%27":u.query+="#"==i?"%23":st(i,rt)):(u.fragment="",l=Lt);break;case Lt:i!=r&&(u.fragment+=st(i,ot))}f++}},parseHost:function(t){var e,n,r;if("["==F(t,0)){if("]"!=F(t,t.length-1))return"Invalid host";if(!(e=function(t){var e,n,r,o,i,a,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,f=0,h=function(){return F(t,f)};if(":"==h()){if(":"!=F(t,1))return;f+=2,l=++u}for(;h();){if(8==u)return;if(":"!=h()){for(e=n=0;n<4&&O($,h());)e=16*e+T(h(),16),f++,n++;if("."==h()){if(0==n)return;if(f-=n,u>6)return;for(r=0;h();){if(o=null,r>0){if(!("."==h()&&r<4))return;f++}if(!O(Y,h()))return;for(;O(Y,h());){if(i=T(h(),10),null===o)o=i;else{if(0==o)return;o=10*o+i}if(o>255)return;f++}c[u]=256*c[u]+o,2!=++r&&4!=r||u++}if(4!=r)return;break}if(":"==h()){if(f++,!h())return}else if(h())return;c[u++]=e}else{if(null!==l)return;f++,l=++u}}if(null!==l)for(a=u-l,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[l+a-1],c[l+--a]=s;else if(8!=u)return;return c}(q(t,1,-1))))return"Invalid host";this.host=e}else if(this.isSpecial()){if(t=x(t),O(J,t))return"Invalid host";if(null===(e=function(t){var e,n,r,o,i,a,s,c=j(t,".");if(c.length&&""==c[c.length-1]&&c.length--,(e=c.length)>4)return t;for(n=[],r=0;r<e;r++){if(""==(o=c[r]))return t;if(i=10,o.length>1&&"0"==F(o,0)&&(i=O(Q,o)?16:8,o=q(o,8==i?1:2)),""===o)a=0;else{if(!O(10==i?X:8==i?K:$,o))return t;a=T(o,i)}B(n,a)}for(r=0;r<e;r++)if(a=n[r],r==e-1){if(a>=L(256,5-e))return null}else if(a>255)return null;for(s=M(n),r=0;r<n.length;r++)s+=n[r]*L(256,3-r);return s}(t)))return"Invalid host";this.host=e}else{if(O(Z,t))return"Invalid host";for(e="",n=v(t),r=0;r<n.length;r++)e+=st(n[r],rt);this.host=e}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||"file"==this.scheme},includesCredentials:function(){return""!=this.username||""!=this.password},isSpecial:function(){return p(ct,this.scheme)},shortenPath:function(){var t=this.path,e=t.length;!e||"file"==this.scheme&&1==e&&ut(t[0],!0)||t.length--},serialize:function(){var t=this,e=t.scheme,n=t.username,r=t.password,o=t.host,i=t.port,a=t.path,s=t.query,c=t.fragment,u=e+":";return null!==o?(u+="//",t.includesCredentials()&&(u+=n+(r?":"+r:"")+"@"),u+=nt(o),null!==i&&(u+=":"+i)):"file"==e&&(u+="//"),u+=t.cannotBeABaseURL?a[0]:a.length?"/"+U(a,"/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},setHref:function(t){var e=this.parse(t);if(e)throw I(e);this.searchParams.update()},getOrigin:function(){var t=this.scheme,e=this.port;if("blob"==t)try{return new Ot(t.path[0]).origin}catch(t){return"null"}return"file"!=t&&this.isSpecial()?t+"://"+nt(this.host)+(null!==e?":"+e:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(t){this.parse(C(t)+":",ht)},getUsername:function(){return this.username},setUsername:function(t){var e=v(C(t));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var n=0;n<e.length;n++)this.username+=st(e[n],at)}},getPassword:function(){return this.password},setPassword:function(t){var e=v(C(t));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var n=0;n<e.length;n++)this.password+=st(e[n],at)}},getHost:function(){var t=this.host,e=this.port;return null===t?"":null===e?nt(t):nt(t)+":"+e},setHost:function(t){this.cannotBeABaseURL||this.parse(t,kt)},getHostname:function(){var t=this.host;return null===t?"":nt(t)},setHostname:function(t){this.cannotBeABaseURL||this.parse(t,bt)},getPort:function(){var t=this.port;return null===t?"":C(t)},setPort:function(t){this.cannotHaveUsernamePasswordPort()||(""==(t=C(t))?this.port=null:this.parse(t,St))},getPathname:function(){var t=this.path;return this.cannotBeABaseURL?t[0]:t.length?"/"+U(t,"/"):""},setPathname:function(t){this.cannotBeABaseURL||(this.path=[],this.parse(t,Rt))},getSearch:function(){var t=this.query;return t?"?"+t:""},setSearch:function(t){""==(t=C(t))?this.query=null:("?"==F(t,0)&&(t=q(t,1)),this.query="",this.parse(t,Dt)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var t=this.fragment;return t?"#"+t:""},setHash:function(t){""!=(t=C(t))?("#"==F(t,0)&&(t=q(t,1)),this.fragment="",this.parse(t,Lt)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var Ot=function(t){var e=h(this,Ut),n=w(arguments.length,1)>1?arguments[1]:void 0,r=S(e,new Ft(t,!1,n));i||(e.href=r.serialize(),e.origin=r.getOrigin(),e.protocol=r.getProtocol(),e.username=r.getUsername(),e.password=r.getPassword(),e.host=r.getHost(),e.hostname=r.getHostname(),e.port=r.getPort(),e.pathname=r.getPathname(),e.search=r.getSearch(),e.searchParams=r.getSearchParams(),e.hash=r.getHash())},Ut=Ot.prototype,Nt=function(t,e){return{get:function(){return P(this)[t]()},set:e&&function(t){return P(this)[e](t)},configurable:!0,enumerable:!0}};if(i&&(f(Ut,"href",Nt("serialize","setHref")),f(Ut,"origin",Nt("getOrigin")),f(Ut,"protocol",Nt("getProtocol","setProtocol")),f(Ut,"username",Nt("getUsername","setUsername")),f(Ut,"password",Nt("getPassword","setPassword")),f(Ut,"host",Nt("getHost","setHost")),f(Ut,"hostname",Nt("getHostname","setHostname")),f(Ut,"port",Nt("getPort","setPort")),f(Ut,"pathname",Nt("getPathname","setPathname")),f(Ut,"search",Nt("getSearch","setSearch")),f(Ut,"searchParams",Nt("getSearchParams")),f(Ut,"hash",Nt("getHash","setHash"))),l(Ut,"toJSON",function(){return P(this).serialize()},{enumerable:!0}),l(Ut,"toString",function(){return P(this).serialize()},{enumerable:!0}),R){var Mt=R.createObjectURL,Bt=R.revokeObjectURL;Mt&&l(Ot,"createObjectURL",c(Mt,R)),Bt&&l(Ot,"revokeObjectURL",c(Bt,R))}m(Ot,"URL"),o({global:!0,constructor:!0,forced:!a,sham:!i},{URL:Ot})},function(t,e,n){var r=n(31);t.exports=function(t,e,n){return r.f(t,e,n)}},function(t,e,n){"use strict";var r=n(22),o=n(13),i=n(23),a=n(12),s=n(89),c=n(113),u=n(102),l=n(34),f=n(103),h=Object.assign,p=Object.defineProperty,d=o([].concat);t.exports=!h||a(function(){if(r&&1!==h({b:1},h(p({},"a",{enumerable:!0,get:function(){p(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(t){e[t]=t}),7!=h({},t)[n]||"abcdefghijklmnopqrst"!=s(h({},e)).join("")})?function(t,e){for(var n=l(t),o=arguments.length,a=1,h=c.f,p=u.f;o>a;)for(var v,g=f(arguments[a++]),y=h?d(s(g),h(g)):s(g),x=y.length,C=0;x>C;)v=y[C++],r&&!i(p,g,v)||(n[v]=g[v]);return n}:h},function(t,e,n){"use strict";var r=n(13),o=/[^\0-\u007E]/,i=/[.\u3002\uFF0E\uFF61]/g,a="Overflow: input needs wider integers to process",s=RangeError,c=r(i.exec),u=Math.floor,l=String.fromCharCode,f=r("".charCodeAt),h=r([].join),p=r([].push),d=r("".replace),v=r("".split),g=r("".toLowerCase),y=function(t){return t+22+75*(t<26)},x=function(t,e,n){var r=0;for(t=n?u(t/700):t>>1,t+=u(t/e);t>455;)t=u(t/35),r+=36;return u(r+36*t/(t+38))},C=function(t){var e,n,r=[],o=(t=function(t){for(var e=[],n=0,r=t.length;n<r;){var o=f(t,n++);if(o>=55296&&o<=56319&&n<r){var i=f(t,n++);56320==(64512&i)?p(e,((1023&o)<<10)+(1023&i)+65536):(p(e,o),n--)}else p(e,o)}return e}(t)).length,i=128,c=0,d=72;for(e=0;e<t.length;e++)(n=t[e])<128&&p(r,l(n));var v=r.length,g=v;for(v&&p(r,"-");g<o;){var C=2147483647;for(e=0;e<t.length;e++)(n=t[e])>=i&&n<C&&(C=n);var m=g+1;if(C-i>u((2147483647-c)/m))throw s(a);for(c+=(C-i)*m,i=C,e=0;e<t.length;e++){if((n=t[e])<i&&++c>2147483647)throw s(a);if(n==i){for(var w=c,k=36;;){var b=k<=d?1:k>=d+26?26:k-d;if(w<b)break;var S=w-b,P=36-b;p(r,l(y(b+S%P))),w=u(S/P),k+=36}p(r,l(y(w))),d=x(c,m,g==v),c=0,g++}}c++,i++}return h(r,"")};t.exports=function(t){var e,n,r=[],a=v(d(g(t),i,"."),".");for(e=0;e<a.length;e++)n=a[e],p(r,c(o,n)?"xn--"+C(n):n);return h(r,".")}},function(t,e){},function(t,e,n){n(200)}])});
},{"process":"FT5O"}],"ryqy":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.bindBili=exports.getTrackerParamsString=void 0;var r=require("@bilibili-live/web-player-common"),i=t(require("@bilibili-live/fmp4.js")),a=require("@bilibili-live/sisters-p2p"),n=function(e,t){var r,i=null!==(r=u(e))&&void 0!==r?r:{},n=i.streamName,l=i.timeshift;return a.SistersPlayerContext.getTrackerParamsString({stream:n,roomid:t,timeshift:l})};exports.getTrackerParamsString=n;var l={};function o(e){var t,n=e.corePlayer,o=e.videoEl,d=e.src,c=e.roomId,m=e.trackerServer;if(!(n instanceof i.default.Hls7Player))return r.logger.error("bilibili p2p must use be Hls7Player instance"),null;var f=null!==(t=u(d))&&void 0!==t?t:{},v=f.streamName,p=f.timeshift;if(null==v)return r.logger.error("can't detect stream name in url"),null;if(!a.SistersPlayerContext.checkP2PSupport())return r.logger.error("unsupported bilibili p2p"),null;l={};var g=new a.SistersPlayerContext(function(e,t){t.includes("pc.addEventListener is not a function")||r.logger.info(t)},{trackerParams:{stream:v,roomid:c,timeshift:p},sdkParams:{trackerServers:m}});if(void 0!==g.getStatisticsData)throw new Error("getStatisticsData is exist, cannot be extended");return g.getStatisticsData=s(g,{timeshift:p,streamName:v}),n.setP2PContext({P2PBufferLength:3,P2PFetchAsStream:function(e,t){void 0===t&&(t=!1),g.p2pFetchAsBuffer(this._onError,this._onResult,function(){return 1e3*(0,r.remainBufferLength)(o)},e,t)},onPlaylistUpdate:function(e,t){g.updatePlaylist(e,t)}}),g}function s(t,i){var n=i.timeshift,o=i.streamName;return function(){var i,s,u,d,c,m,f,v,p,g,P=t.getP2PDataCollectionStatus();if(null==P)return null;var h=null!==(i=P.getQueryServerInfo())&&void 0!==i?i:{},S=h.fragNum,b=void 0===S?0:S,y=h.queryNum,D=void 0===y?0:y,_=e(e({cdnDownloadValidSize:null!==(s=P.getServerDownload())&&void 0!==s?s:0,cdnDownloadInvalidSize:null!==(u=P.getWastedDataSize(a.WastedDataType.CDN_REPEAT))&&void 0!==u?u:0,fetchErrorNum:null!==(d=P.getFetchErrorNum(a.FetchErrorType.ERROR_TO_RELOAD))&&void 0!==d?d:0,p2pDownloadValidSize:null!==(c=P.getP2PDownload())&&void 0!==c?c:0,p2pDownloadInvalidSize:null!==(m=P.getWastedDataSize(a.WastedDataType.P2P_LATE))&&void 0!==m?m:0,p2pErrorSize:null!==(f=P.getWastedDataSize(a.WastedDataType.ERROR_DATA))&&void 0!==f?f:0,p2pUploadSize:null!==(v=P.getP2PSend())&&void 0!==v?v:0,fragNum:b,queryNum:D,timeshift:n,streamName:o},null!==(p=P.getExtendReportInfo())&&void 0!==p?p:{}),null!==(g=P.getTrackerInfo())&&void 0!==g?g:{});if(0===Object.keys(l).length)return l=_,_;var E=(0,r.minusObject)(l,_);return l=_,E}}function u(e){var t=/\/live-bvc\/\d{3,9}\/(live_.+?)[/.]/.exec(e);if(null==t)return{timeshift:0,streamName:null};var r=Number(new URL(e).searchParams.get("tmshift"));return{streamName:t[1],timeshift:r}}exports.bindBili=o;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/fmp4.js":"lV3a","@bilibili-live/sisters-p2p":"GTYV"}],"p0fG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@bilibili-live/web-player-common"),t=function(){function t(e,t,o){this._element=null,this._loader=null,this._responsed=!1,this._onResponse=e,this._onData=t,this._onError=o,this._onStateChangeBinder=this._onStateChange.bind(this),this.QVBP2P=window.QVBP2P}return t.prototype.destroy=function(){null!=this._loader&&(this._loader.destroy(),this._loader=null),this._responsed=!1},Object.defineProperty(t.prototype,"videoElement",{get:function(){return this._element},set:function(e){this._element=e},enumerable:!1,configurable:!0}),t.prototype.fetchAsStream=function(e){null!=this._element&&(null!=this._loader&&this._loader.close(),this._loader=new this.QVBP2P({debug:!1}),this._loader.listen(this.QVBP2P.ComEvents.STATE_CHANGE,this._onStateChangeBinder),this._loader.loadSource({src:e}),this._loader.setMediaElement(this._element))},t.prototype._onStateChange=function(t,o){switch(o.code){case this.QVBP2P.ComCodes.RECEIVE_BUFFER:this._responsed||(this._responsed=!0,this._onResponse(200,"video/x-flv")),null!=o.payload?this._onData(new Uint8Array(o.payload)):e.logger.warn("QVBP2P no payload");break;case this.QVBP2P.ComCodes.ROLLBACK:e.logger.error("TX P2P error: ".concat(t)),"function"==typeof this._onError&&this._onError(11001,t)}},t.isSupported=function(){var e;return null===(e=window.QVBP2P)||void 0===e?void 0:e.isSupported()},t}();exports.default=t;
},{"@bilibili-live/web-player-common":"KGHo"}],"V6Hm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@bilibili-live/web-player-common"),t=e(require("@bilibili-live/fmp4.js")),i=e(require("./qvb-fetcher")),n=!1;function o(e){var o=e.corePlayer,u=e.videoEl;return o instanceof t.default.fMp4Player?i.default.isSupported()?n?(r.logger.warn("p2p P2P_ERROR_FLAG fallback"),!1):(o.createFetcher=function(e,t,o){var l=new i.default(function(r){e(new a(r))},t,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n=!0,r.logger.error("third fetcher Error: ".concat(JSON.stringify(e))),o.apply(void 0,e)});return l.videoElement=u,l},!0):(r.logger.error("QVB unsupported or sdk not loaded"),!1):(r.logger.error("QVB p2p must use be fMp4Player instance"),!1)}exports.default=o;var u=function(){function e(){this.map={}}return e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,r){this.map[e]=r},e}(),a=function(){return function(e){this.status=e,this.ok=e>=200&&e<=299,this.headers=new u}}();
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/fmp4.js":"lV3a","./qvb-fetcher":"p0fG"}],"R6Co":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./bili-p2p"),i=e(require("./qvb-p2p"));exports.default={bindBili:r.bindBili,getTrackerParamsString:r.getTrackerParamsString,bindQVB:i.default};
},{"./bili-p2p":"ryqy","./qvb-p2p":"V6Hm"}],"A6uK":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var r,n=1,t=arguments.length;n<t;n++)for(var o in r=arguments[n])Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,r,n,t){return new(n||(n=Promise))(function(o,a){function i(e){try{c(t.next(e))}catch(r){a(r)}}function l(e){try{c(t.throw(e))}catch(r){a(r)}}function c(e){var r;e.done?o(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(i,l)}c((t=t.apply(e,r||[])).next())})},n=this&&this.__generator||function(e,r){var n,t,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(c){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(i=0)),i;)try{if(n=1,t&&(o=2&l[0]?t.return:l[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,l[1])).done)return o;switch(t=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return i.label++,{value:l[1],done:!1};case 5:i.label++,t=l[1],l=[0];continue;case 7:l=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){i=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){i.label=l[1];break}if(6===l[0]&&i.label<o[1]){i.label=o[1],o=l;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(l);break}o[2]&&i.ops.pop(),i.trys.pop();continue}l=r.call(e,i)}catch(c){l=[6,c],t=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,c])}}},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var o=require("@bilibili-live/web-player-common"),a=require("@bilibili-live/web-player-video"),i=t(require("@bilibili-live/web-player-p2p")),l=t(require("@bilibili-live/web-player-track"));function c(e){var t=e.video,l=e.type,c=e.roomId,d=e.interval;return r(this,void 0,Promise,function(){var e;return n(this,function(r){switch(r.label){case 0:return o.logger.info("launch p2p: ".concat(l)),l!==o.P2PType.FLV_QVB?[3,4]:(t.delyLoad(),null!=window.QVBP2P?[3,2]:[4,(0,o.loadScript)("//s1.hdslb.com/bfs/static/blive/web-player/p2p/qvbp2p_bilibili_v1.8.16.min.js").catch(function(){o.logger.error("qvb script loading failed")})]);case 1:r.sent(),r.label=2;case 2:return[4,new Promise(function(e,r){t.once(a.EventType.LoadStart,function(n){var t=n.corePlayer,o=n.videoEl;i.default.bindQVB({corePlayer:t,videoEl:o})?e(null):r(new Error("launch flv_qvb failed"))}),t.load()})];case 3:return[2,r.sent()];case 4:return l!==o.P2PType.HLS_BILI?[3,6]:(t.delyLoad(),[4,f(c,t.getSrc()).catch(function(e){return o.logger.error(e),null})]);case 5:return null==(e=r.sent())||0===e.length?(t.load(),[2]):[2,new Promise(function(r,n){t.once(a.EventType.CorePlayerCreated,function(o){var l=o.corePlayer,f=o.videoEl,p=o.src,v=i.default.bindBili({corePlayer:l,videoEl:f,src:p,roomId:c,trackerServer:e});if(null!=v){v.onEventReport=function(e){u(e,l)};var b=s(v,f,d);t.once(a.EventType.Destroyed,function(){b(),v.destroy()}),r(v)}else n(new Error("launch bili_p2p failed"))}),t.load()})];case 6:return[2]}})})}function u(e,r){switch(e.type){case 1:"number"==typeof e.body.p2pBufferLengthSec&&e.body.p2pBufferLengthSec>=0&&(r.minBufferLength=e.body.p2pBufferLengthSec,o.logger.info("Change P2PBufferLength: ".concat(e.body.p2pBufferLengthSec)));break;case 0:l.default.custom(e.body.code+1e4,e.body.data),o.logger.warn("sister p2p emit: code: ".concat(e.type))}}function s(r,n,t){void 0===t&&(t=30);var a=0,i=l.default.fixedDynamicFieldsVerIns();function c(){var t=(0,o.remainBufferLength)(n);t=t<0?0:t;var c=Math.round(1e3*(n.currentTime+t)),u=(0,o.roundNumber)((c<0?0:c)-a,0);a=c;var s=r.getStatisticsData();null!=s&&i.custom(l.default.CustomCode.P2PData,e(e({},s),{duration:u}),{randDelay:5e3,extFields:"all"})}var u=setInterval(c,1e3*(t>=10||t<=300?t:30)),s=function(){clearInterval(u),c()};return window.addEventListener("beforeunload",s),function(){clearInterval(u),window.removeEventListener("beforeunload",s),c()}}exports.default=c;var f=function(){var e={};return function(t,a){return r(void 0,void 0,void 0,function(){var r,l;return n(this,function(n){switch(n.label){case 0:if(r=i.default.getTrackerParamsString(a,t),null!=e[r])return[2,e[r]];l=[],n.label=1;case 1:return n.trys.push([1,4,,5]),[4,(0,o.ajax)("/xlive/open-interface/v2/tracker/conf".concat(r))];case 2:return[4,n.sent().domains];case 3:return l=n.sent(),[3,5];case 4:return n.sent(),o.logger.error("track server url parsed error"),[3,5];case 5:return e[r]=l,[2,l]}})})}}();
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-p2p":"R6Co","@bilibili-live/web-player-track":"ESUf"}],"KY4m":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,n,t){return new(n||(n=Promise))(function(o,i){function c(e){try{a(t.next(e))}catch(r){i(r)}}function u(e){try{a(t.throw(e))}catch(r){i(r)}}function a(e){var r;e.done?o(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(c,u)}a((t=t.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var n,t,o,i,c={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(u){return function(a){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(c=0)),c;)try{if(n=1,t&&(o=2&u[0]?t.return:u[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,u[1])).done)return o;switch(t=0,o&&(u=[2&u[0],o.value]),u[0]){case 0:case 1:o=u;break;case 4:return c.label++,{value:u[1],done:!1};case 5:c.label++,t=u[1],u=[0];continue;case 7:u=c.ops.pop(),c.trys.pop();continue;default:if(!(o=(o=c.trys).length>0&&o[o.length-1])&&(6===u[0]||2===u[0])){c=0;continue}if(3===u[0]&&(!o||u[1]>o[0]&&u[1]<o[3])){c.label=u[1];break}if(6===u[0]&&c.label<o[1]){c.label=o[1],o=u;break}if(o&&c.label<o[2]){c.label=o[2],c.ops.push(u);break}o[2]&&c.ops.pop(),c.trys.pop();continue}u=r.call(e,c)}catch(a){u=[6,a],t=0}finally{n=o=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,a])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.maxRetryChecker=exports.blockStream=exports.loadingOrCoverImg=exports.backoffById=exports.retry=void 0;var n=require("@bilibili-live/web-player-common"),t=require("@bilibili-live/web-player-video");function o(t,o){var i=this,c=-1;return function(){for(var u=[],a=0;a<arguments.length;a++)u[a]=arguments[a];return e(i,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i,a){(function t(i){return e(this,void 0,Promise,function(){var e,u,a;return r(this,function(r){switch(r.label){case 0:return-1!==c?[3,1]:(c+=1,[3,3]);case 1:return e=o[c],n.logger.error("retry times: ".concat(c,", delay: ").concat(e)),c+=1,[4,(0,n.sleep)(e)];case 2:r.sent(),r.label=3;case 3:return r.trys.push([3,5,,9]),[4,i()];case 4:return u=r.sent(),c=-1,[2,u];case 5:return a=r.sent(),n.logger.error(a),c<o.length?[4,t(i)]:[3,7];case 6:return[2,r.sent()];case 7:throw n.logger.error("retry failed"),a;case 8:return[3,9];case 9:return[2]}})})})(function(){return t.apply(void 0,u)}).then(function(e){i(e)}).catch(function(e){a(e)})})];case 1:return[2,i.sent()]}})})}}function i(e,r){var t;return null==r||""===r?(t=(0,n.loading)(e),(0,n.coverImg)(null,e)):(0,n.coverImg)(r,e),function(){null==t||t()}}function c(e,r){null==e||e.destroy(!0);var n=null==e?void 0:e.getVideoEl();if(null!=n){n.addEventListener("play",function e(){n.removeEventListener("play",e),r()})}}exports.retry=o,exports.backoffById=function(){var t=[[0,0],[.5,2],[2,4],[4,6]].map(function(e){return e.map(function(e){return 1e3*e})}),o=new Map;return function(i,c){return e(void 0,void 0,void 0,function(){var e,u,a,l,s,f;return r(this,function(r){switch(r.label){case 0:if(c=c>4?4:c,null==(e=o.get(i))&&(e={count:0,removeTimer:0},o.set(i,e)),clearTimeout(e.removeTimer),(u=e.count)>=c)throw o.delete(i),new Error("backoff failed");return e.removeTimer=window.setTimeout(function(){o.delete(i)},2*t[t.length-1][1]),e.count+=1,a=t[u],l=a[0],s=a[1],f=Math.round(Math.random()*(s-l)+l),n.logger.warn("backoff delay: sleepTime: ".concat(f,", count: ").concat(e.count)),[4,(0,n.sleep)(f)];case 1:return r.sent(),[2,e.count]}})})}}(),exports.loadingOrCoverImg=i,exports.blockStream=c,exports.maxRetryChecker=function(){var e=0,r=function(){e>0||(e=performance.now())};return function(n){return n.once(t.EventType.FirstFrame,function(){e=0}),n.once(t.EventType.Error,r),n.once(t.EventType.Ended,r),function(){return!(e>0&&performance.now()-e>6e4)}}}();
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58"}],"rPou":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},t=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&("get"in o?t.__esModule:!o.writable&&!o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var o in e)"default"!==o&&Object.prototype.hasOwnProperty.call(e,o)&&t(r,e,o);return n(r,e),r},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{u(r.next(e))}catch(t){i(t)}}function l(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,l)}u((r=r.apply(e,t||[])).next())})},i=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(u){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&l[0]?r.return:l[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,l[1])).done)return o;switch(r=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){a.label=l[1];break}if(6===l[0]&&a.label<o[1]){a.label=o[1],o=l;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(l);break}o[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(u){l=[6,u],r=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createVideoTracker=void 0;var a=require("@bilibili-live/web-player-video"),l=r(require("@bilibili-live/web-player-track")),u=require("@bilibili-live/web-player-common"),c=l.default.PerfCode,f=l.default.EventCode,s=l.default.CustomCode;function d(){var t=this,n=!1,r=!1,d=!1;window.addEventListener("unload",function(){d=!0});var p=new WeakMap,v=function(v){l.default.event(f.CreateVideo,null,{sampleRate:.1,extFields:["sProtocol","sHost","p2pType","sCodec","sName","sFormat"],randDelay:0}),v.once(a.EventType.NetworkResponse,function(e){var t,n,r=e.headers.get("x-service-module");null!=r&&l.default.updateDynamicInfo(((t={})["x-service-module"]=((n={})[r]=1,n),t))}),v.once(a.EventType.FirstFrame,function(e){l.default.perf(c.FirstFrame,e,{sampleRate:.1,extFields:"all"})}),v.once(a.EventType.FirstPacket,function(e){l.default.perf(c.FirstPacket,e,{sampleRate:.05})}),v.once(a.EventType.MetaData,function(e){l.default.perf(c.VideoMeta,e,{sampleRate:.05})}),v.on(a.EventType.WaitStart,function(){var e=v.getNetworkState();null!=e&&l.default.error(l.ErrorCode.NetworkException,JSON.stringify(Object.assign({},e,{trigger:"wait",bufLen:1e3*(0,u.remainBufferLength)(v.getVideoEl())})),{sampleRate:.1})}),v.once(a.EventType.Ended,function(){return o(t,void 0,void 0,function(){return i(this,function(e){return n=!0,[2]})})}),v.once(a.EventType.FirstFrame,function(){n=!1,r=!1}),v.once(a.EventType.Error,function(e){if(!d&&!r)if(r=!0,n);else{l.default.error(e.code,JSON.stringify(e.errInfo));var t=v.getNetworkState();e.code in a.NetworkErrorCode&&null!=t&&l.default.error(l.ErrorCode.NetworkException,JSON.stringify(Object.assign({},t,{errCode:e.code,bufLen:1e3*(0,u.remainBufferLength)(v.getVideoEl())})),{sampleRate:.1})}});var y=l.default.fixedDynamicFieldsVerIns(),b={};v.on(a.EventType.WaitReport,function(t){var n,r,o={},i=p.get(v);null!=(null==i?void 0:i.getP2PDataCollectionStatus)&&(null===(r=null==i?void 0:i.getP2PDataCollectionStatus)||void 0===r?void 0:r.call(i)).getQueryServerInfo().bvcServiceModule.forEach(function(e,t){o[t]=e});var a=(0,u.minusObject)(b,o);b=o;null!=i&&y.updateDynamicInfo(((n={})["x-service-module"]=a,n)),y.custom(s.Waiting,e({},t),{randDelay:5e3,extFields:"all"})})};return v.setP2PInstance=function(e,t){p.set(e,t)},v}exports.createVideoTracker=d;
},{"@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-track":"ESUf","@bilibili-live/web-player-common":"KGHo"}],"XQD5":[function(require,module,exports) {
module.exports={webPlayerReplayContainer:"_web-player-replay-container_7d923",replayShow:"_replay-show_7d923",replayHidden:"_replay-hidden_7d923",webPlayerReplayElement:"_web-player-replay-element_7d923",progressShow:"_progress-show_7d923",progressHidden:"_progress-hidden_7d923",webPlayerReplayProgress:"_web-player-replay-progress_7d923",webPlayerReplayCurrentPoint:"_web-player-replay-current-point_7d923",webPlayerReplayBar:"_web-player-replay-bar_7d923",webPlayerReplayHighlightsHidden:"_web-player-replay-highlights-hidden_7d923",highlightItem:"_highlight-item_7d923",highlightPot:"_highlight-pot_7d923",highlightIcon:"_highlight-icon_7d923",webPlayerReplayHighlightsShow:"_web-player-replay-highlights-show_7d923",webPlayerReplayHighlights:"_web-player-replay-highlights_7d923",highlightImg:"_highlight-img_7d923",backliveBtnContainer:"_backlive-btn-container_7d923",backliveBtn:"_backlive-btn_7d923",backliveDot:"_backlive-dot_7d923"};var e='._web-player-replay-container_7d923{z-index:12;position:absolute;bottom:0;width:100%;height:3px;user-select:none;-webkit-touch-callout:none}._web-player-replay-container_7d923 div._replay-show_7d923{bottom:40px}._web-player-replay-container_7d923 div._replay-hidden_7d923{bottom:0}@media screen and (max-width:850px){._web-player-replay-container_7d923 div._replay-show_7d923{bottom:30px;height:50px;display:flex;align-items:center}}._web-player-replay-container_7d923 ._web-player-replay-element_7d923{opacity:.8;bottom:0;left:7px;right:7px;position:absolute}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 div._progress-show_7d923{height:4px;padding:2px 0}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 div._progress-hidden_7d923{height:3px;padding:0}@media screen and (max-width:850px){._web-player-replay-container_7d923 ._web-player-replay-element_7d923 div._progress-show_7d923{height:2px;padding:2px 0}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 div._progress-hidden_7d923{height:2px;padding:0}}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-progress_7d923{height:3px;padding:0;position:relative;width:100%;background:hsla(0,0%,100%,.3);cursor:pointer;opacity:.9;background-clip:content-box}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-progress_7d923 ._web-player-replay-current-point_7d923{position:absolute;left:100%;margin-left:-7px;margin-top:-6px;width:14px;height:14px;background-size:100%;z-index:1;display:none;background-image:url(https://i0.hdslb.com/bfs/activity-plat/static/20210315/d0411babbbf77c49ca42a3320eb804ae/F7QzSyeFMa.png)}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-progress_7d923 ._web-player-replay-bar_7d923{width:100%;height:100%;background:#00a1d6}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-hidden_7d923 ._highlight-item_7d923{top:0}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-hidden_7d923 ._highlight-item_7d923 ._highlight-pot_7d923{width:3px;height:3px}@media screen and (max-width:850px){._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-hidden_7d923 ._highlight-item_7d923 ._highlight-pot_7d923{width:2px;height:2px}}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-hidden_7d923 ._highlight-icon_7d923{display:none}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-show_7d923 ._highlight-item_7d923{top:2px}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-show_7d923 ._highlight-item_7d923 ._highlight-pot_7d923{width:4px;height:4px}@media screen and (max-width:850px){._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-show_7d923 ._highlight-item_7d923 ._highlight-pot_7d923{width:2px;height:2px}}@media screen and (max-width:850px){._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-show_7d923 ._highlight-item_7d923{top:calc(50% - 1px)}}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights-show_7d923 ._highlight-icon_7d923{display:block}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights_7d923 ._highlight-item_7d923{position:absolute}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights_7d923 ._highlight-item_7d923 ._highlight-pot_7d923{position:absolute;left:0;border-radius:50%;background-color:#fff;cursor:pointer}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights_7d923 ._highlight-item_7d923 ._highlight-icon_7d923{position:absolute;width:36px;height:36px;top:-50px;left:-16px;border-radius:50%;background:#00a1d6;cursor:pointer}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights_7d923 ._highlight-item_7d923 ._highlight-icon_7d923 ._highlight-img_7d923{position:absolute;left:2px;top:2px;width:32px;height:32px;border-radius:50%;overflow:hidden;background-size:cover;z-index:1}._web-player-replay-container_7d923 ._web-player-replay-element_7d923 ._web-player-replay-highlights_7d923 ._highlight-item_7d923 ._highlight-icon_7d923:after{content:"";position:absolute;left:13px;bottom:-3px;width:10px;height:10px;transform:rotate(45deg);background-color:#00a1d6}._backlive-btn-container_7d923{display:flex;height:22px}._backlive-btn-container_7d923 ._backlive-btn_7d923{padding:0 8px;margin:0 9px;color:#fff;background-color:rgba(51,51,51,.8);border-radius:12px;font-size:12px;cursor:pointer;display:flex;align-items:center}._backlive-btn-container_7d923 ._backlive-btn_7d923 ._backlive-dot_7d923{display:inline-block;margin-right:6px;width:6px;height:6px;font-size:0;border-radius:50%;background:#ff5243;vertical-align:middle}',l=document.createElement("style");l.type="text/css",l.appendChild(document.createTextNode(e)),document.head.appendChild(l);
},{}],"EfpE":[function(require,module,exports) {
var define;
var t;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(n,o){"object"==("undefined"==typeof exports?"undefined":e(exports))&&"object"==("undefined"==typeof module?"undefined":e(module))?module.exports=o():"function"==typeof t&&t.amd?t([],o):"object"==("undefined"==typeof exports?"undefined":e(exports))?exports.DanmakuWebSocket=o():n.DanmakuWebSocket=o()}("undefined"!=typeof self?self:this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";e.a={WS_OP_HEARTBEAT:2,WS_OP_HEARTBEAT_REPLY:3,WS_OP_MESSAGE:5,WS_OP_USER_AUTHENTICATION:7,WS_OP_CONNECT_SUCCESS:8,WS_PACKAGE_HEADER_TOTAL_LENGTH:16,WS_PACKAGE_OFFSET:0,WS_HEADER_OFFSET:4,WS_VERSION_OFFSET:6,WS_OPERATION_OFFSET:8,WS_SEQUENCE_OFFSET:12,WS_BODY_PROTOCOL_VERSION_NORMAL:0,WS_BODY_PROTOCOL_VERSION_BROTLI:3,WS_HEADER_DEFAULT_VERSION:1,WS_HEADER_DEFAULT_OPERATION:1,WS_HEADER_DEFAULT_SEQUENCE:1,WS_AUTH_OK:0,WS_AUTH_TOKEN_ERROR:-101}},function(t,e,n){var o=n(2).default;t.exports=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),r=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"development"===t.CONFIG.bundleType&&(console.clear(),console.dir(t.CONFIG)),this.initialize(e)}return t.prototype.initialize=function(e){var n=this;"development"===t.CONFIG.bundleType&&console.log("App Initialized.");var i=document.createElement("script");return i.src="//activity.hdslb.com/blackboard/static/20210425/d0411babbbf77c49ca42a3320eb804ae/0NCT06vruR.js",i.onload=function(){n.ws=new o.a(e)},window.document.head.append(i),this.getReturn()},t.prototype.getReturn=function(){return"development"===t.CONFIG.bundleType?this:{destroy:this.destroy.bind(this),send:this.send.bind(this),getAuthInfo:this.getAuthInfo.bind(this),getRetryCount:this.getRetryCount.bind(this),getState:this.getState.bind(this)}},t.prototype.destroy=function(){this.ws&&this.ws.destroy()},t.prototype.getState=function(){return this.ws&&this.ws.getState()},t.prototype.send=function(t){this.ws&&this.ws.send(t)},t.prototype.getAuthInfo=function(){return this.ws&&this.ws.getAuthInfo()},t.prototype.getRetryCount=function(){return this.ws&&this.ws.getRetryCount()},i(t,null,[{key:"CONFIG",get:function(){return{version:"1.4.5",gitHash:"cbde3454",build:"41",bundleType:"release"}}}]),t}();e.default=r},function(t,e,n){"use strict";var o=n(0),i=n(4),r=n(5),s=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.checkOptions(e)){var n={url:"",urlList:[],rid:0,aid:0,uid:0,from:-1,retry:!0,retryMaxCount:0,retryInterval:5,retryThreadCount:10,connectTimeout:5e3,retryConnectCount:3,retryconnectTimeout:1e4,retryRoundInterval:Math.floor(2*Math.random())+3,customAuthParam:[],fallback:function(){},heartBeatInterval:30,onReceivedMessage:function(){},onReceiveAuthRes:function(){},onHeartBeatReply:function(){},onInitialized:function(){},onOpen:function(){},onClose:function(){},onError:function(){},onListConnectError:function(){},onLogger:function(){}};this.options=r.a.extend({},n,e),this.wsBinaryHeaderList=r.a.extend([],i.a),this.authInfo={origin:"",encode:""},0!==this.options.urlList.length&&0!==this.options.retryMaxCount&&this.options.retryMaxCount<this.options.urlList.length&&(this.options.retryMaxCount=this.options.urlList.length-1),this.state={retryCount:0,listConnectFinishedCount:0,index:0,connectTimeoutTimes:0,url:""},this.callbackQueueList={onInitializedQueue:[],onOpenQueue:[],onCloseQueue:[],onErrorQueue:[],onReceivedMessageQueue:[],onHeartBeatReplyQueue:[],onRetryFallbackQueue:[],onListConnectErrorQueue:[],onReceiveAuthResQueue:[]},this.HEART_BEAT_INTERVAL=0,this.CONNECT_TIMEOUT=0,this.mixinCallback().initialize(this.options.urlList.length>0?this.options.urlList[0]:this.options.url)}}return t.prototype.initialize=function(t){var e=this,n="MozWebSocket"in window?window.MozWebSocket:window.WebSocket,o=this.options;try{this.state.url=t,this.ws=new n(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=this.onError.bind(this),r.a.callFunction(this.callbackQueueList.onInitializedQueue),this.callbackQueueList.onInitializedQueue=[];var i=this.state.connectTimeoutTimes>=3?o.retryconnectTimeout:o.connectTimeout;this.CONNECT_TIMEOUT=setTimeout(function(){e.state.connectTimeoutTimes+=1,e.options.onLogger("connect timeout "+e.state.connectTimeoutTimes),e.ws.close()},i)}catch(t){"function"==typeof o.fallback&&o.fallback()}return this},t.prototype.onOpen=function(){return r.a.callFunction(this.callbackQueueList.onOpenQueue),this.state.connectTimeoutTimes=0,this.CONNECT_TIMEOUT&&clearTimeout(this.CONNECT_TIMEOUT),this.userAuthentication(),this},t.prototype.userAuthentication=function(){var t,e=this,n=this.options,i=(/buvid3=(.+?)(;|\s|$)/.exec(document.cookie)||[])[1]||"",r={uid:parseInt(n.uid,10),roomid:parseInt(n.rid,10),protover:3,buvid:i};n.aid&&(r.aid=parseInt(n.aid,10)),n.from>0&&(r.from=parseInt(n.from,10)||7);for(var s=0;s<n.customAuthParam.length;s++){var a=n.customAuthParam[s],u=a.type||"string";switch(void 0!==r[a.key]&&this.options.onLogger("Token has the same key already! 【"+a.key+"】"),a.key.toString()&&a.value.toString()||this.options.onLogger("Invalid customAuthParam, missing key or value! 【"+a.key+"】-【"+a.value+"】"),u){case"string":r[a.key]=a.value;break;case"number":r[a.key]=parseInt(a.value,10);break;case"boolean":r[a.key]=!!r[a.value];break;default:return void this.options.onLogger("Unsupported customAuthParam type!【"+u+"】")}}t=this.convertToArrayBuffer(JSON.stringify(r),o.a.WS_OP_USER_AUTHENTICATION),this.authInfo.origin=r,this.authInfo.encode=t,setTimeout(function(){e.ws.send(t)},0)},t.prototype.getAuthInfo=function(){return this.authInfo},t.prototype.getState=function(){return this.state},t.prototype.heartBeat=function(){var t=this;clearTimeout(this.HEART_BEAT_INTERVAL);var e=this.convertToArrayBuffer({},o.a.WS_OP_HEARTBEAT);this.ws.send(e),this.HEART_BEAT_INTERVAL=setTimeout(function(){t.heartBeat()},1e3*this.options.heartBeatInterval)},t.prototype.onMessage=function(t){var e=this;try{var n=this.convertToObject(t.data);if(n instanceof Array)n.forEach(function(t){e.onMessage(t)});else if(n instanceof Object)switch(n.op){case o.a.WS_OP_HEARTBEAT_REPLY:this.onHeartBeatReply(n.body);break;case o.a.WS_OP_MESSAGE:this.onMessageReply(n.body,n.seq);break;case o.a.WS_OP_CONNECT_SUCCESS:if(0!==n.body.length&&n.body[0])switch(n.body[0].code){case o.a.WS_AUTH_OK:this.heartBeat();break;case o.a.WS_AUTH_TOKEN_ERROR:this.options.retry=!1,"function"==typeof this.options.onReceiveAuthRes&&this.options.onReceiveAuthRes(n.body);break;default:this.onClose()}else this.heartBeat()}}catch(t){this.options.onLogger("WebSocket Error: ",t)}return this},t.prototype.onMessageReply=function(t,e){var n=this;try{t instanceof Array?t.forEach(function(t){n.onMessageReply(t,e)}):t instanceof Object&&"function"==typeof this.options.onReceivedMessage&&this.options.onReceivedMessage(t,e)}catch(t){this.options.onLogger("On Message Resolve Error: ",t)}},t.prototype.onHeartBeatReply=function(t){r.a.callFunction(this.callbackQueueList.onHeartBeatReplyQueue,t)},t.prototype.onClose=function(t){var e=this,n=this.options.urlList.length;return r.a.callFunction(this.callbackQueueList.onCloseQueue,t),clearTimeout(this.HEART_BEAT_INTERVAL),this.options.retry?(this.checkRetryState()?setTimeout(function(){e.options.onLogger("Danmaku Websocket Retry .",e.state.retryCount),e.state.index+=1,0===n||e.state.retryCount>e.options.retryThreadCount?setTimeout(function(){e.initialize(e.options.url)},1e3*e.options.retryRoundInterval):0!==n&&e.state.index>n-1?(e.state.index=0,e.state.listConnectFinishedCount+=1,1===e.state.listConnectFinishedCount&&r.a.callFunction(e.callbackQueueList.onListConnectErrorQueue),setTimeout(function(){e.initialize(e.options.urlList[e.state.index])},1e3*e.options.retryRoundInterval)):e.initialize(e.options.urlList[e.state.index])},1e3*this.options.retryInterval):(this.options.onLogger("Danmaku Websocket Retry Failed."),r.a.callFunction(this.callbackQueueList.onRetryFallbackQueue)),this):this},t.prototype.onError=function(t){return this.options.onLogger("Danmaku Websocket On Error.",t),r.a.callFunction(this.callbackQueueList.onErrorQueue,t),this},t.prototype.destroy=function(){this.HEART_BEAT_INTERVAL&&clearTimeout(this.HEART_BEAT_INTERVAL),this.CONNECT_TIMEOUT&&clearTimeout(this.CONNECT_TIMEOUT),this.options.retry=!1,this.ws&&this.ws.close(),this.ws=null},t.prototype.convertToArrayBuffer=function(t,e){this.encoder||(this.encoder=r.a.getEncoder());var n=new ArrayBuffer(o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH),i=new DataView(n,o.a.WS_PACKAGE_OFFSET),s=this.encoder.encode(t);return i.setInt32(o.a.WS_PACKAGE_OFFSET,o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH+s.byteLength),this.wsBinaryHeaderList[2].value=e,this.wsBinaryHeaderList.forEach(function(t){4===t.bytes?i.setInt32(t.offset,t.value):2===t.bytes&&i.setInt16(t.offset,t.value)}),r.a.mergeArrayBuffer(n,s)},t.prototype.convertToObject=function(t){var e=new DataView(t),n={body:[]};if(n.packetLen=e.getInt32(o.a.WS_PACKAGE_OFFSET),this.wsBinaryHeaderList.forEach(function(t){4===t.bytes?n[t.key]=e.getInt32(t.offset):2===t.bytes&&(n[t.key]=e.getInt16(t.offset))}),n.packetLen<t.byteLength&&this.convertToObject(t.slice(0,n.packetLen)),this.decoder||(this.decoder=r.a.getDecoder()),!n.op||o.a.WS_OP_MESSAGE!==n.op&&n.op!==o.a.WS_OP_CONNECT_SUCCESS)n.op&&o.a.WS_OP_HEARTBEAT_REPLY===n.op&&(n.body={count:e.getInt32(o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH)});else for(var i=o.a.WS_PACKAGE_OFFSET,s=n.packetLen,a="",u="";i<t.byteLength;i+=s){s=e.getInt32(i),a=e.getInt16(i+o.a.WS_HEADER_OFFSET);try{if(n.ver===o.a.WS_BODY_PROTOCOL_VERSION_NORMAL){var c=this.decoder.decode(t.slice(i+a,i+s));u=0!==c.length?JSON.parse(c):null}else if(n.ver===o.a.WS_BODY_PROTOCOL_VERSION_BROTLI){var l=t.slice(i+a,i+s),h=window.BrotliDecode(new Uint8Array(l));u=this.convertToObject(h.buffer).body}u&&n.body.push(u)}catch(e){this.options.onLogger("decode body error:",new Uint8Array(t),n,e)}}return n},t.prototype.send=function(t){this.ws&&this.ws.send(t)},t.prototype.addCallback=function(t,e){return"function"==typeof t&&e instanceof Array&&e.push(t),this},t.prototype.mixinCallback=function(){var t=this.options,e=this.callbackQueueList;return this.addCallback(t.onReceivedMessage,e.onReceivedMessageQueue).addCallback(t.onHeartBeatReply,e.onHeartBeatReplyQueue).addCallback(t.onInitialized,e.onInitializedQueue).addCallback(t.onOpen,e.onOpenQueue).addCallback(t.onClose,e.onCloseQueue).addCallback(t.onError,e.onErrorQueue).addCallback(t.onRetryFallback,e.onRetryFallbackQueue).addCallback(t.onListConnectError,e.onListConnectErrorQueue).addCallback(t.onReceiveAuthRes,e.onReceiveAuthResQueue),this},t.prototype.getRetryCount=function(){return this.state.retryCount},t.prototype.checkRetryState=function(){var t=this.options,e=!1;return(0===t.retryMaxCount||this.state.retryCount<t.retryMaxCount)&&(this.state.retryCount+=1,e=!0),e},t.checkOptions=function(t){return t||t instanceof Object?t.url?null!=t.rid||(console.error("WebSocket Initialize options rid(cid) missing."),!1):(this.options.onLogger("WebSocket Initialize options url missing."),!1):(this.options.onLogger("WebSocket Initialize options missing or error.",t),!1)},t}();e.a=s},function(t,e,n){"use strict";var o=n(0),i=[{name:"Header Length",key:"headerLen",bytes:2,offset:o.a.WS_HEADER_OFFSET,value:o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH},{name:"Protocol Version",key:"ver",bytes:2,offset:o.a.WS_VERSION_OFFSET,value:o.a.WS_HEADER_DEFAULT_VERSION},{name:"Operation",key:"op",bytes:4,offset:o.a.WS_OPERATION_OFFSET,value:o.a.WS_HEADER_DEFAULT_OPERATION},{name:"Sequence Id",key:"seq",bytes:4,offset:o.a.WS_SEQUENCE_OFFSET,value:o.a.WS_HEADER_DEFAULT_SEQUENCE}];e.a=i},function(t,e,n){"use strict";var o={getDecoder:function(){return window.TextDecoder?new window.TextDecoder:{decode:function(t){return decodeURIComponent(window.escape(String.fromCharCode.apply(String,new Uint8Array(t))))}}},getEncoder:function(){return window.TextEncoder?new window.TextEncoder:{encode:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0,i=t.length;o<i;o++)n[o]=t.charCodeAt(o);return e}}},mergeArrayBuffer:function(t,e){var n=new Uint8Array(t),o=new Uint8Array(e),i=new Uint8Array(n.byteLength+o.byteLength);return i.set(n,0),i.set(o,n.byteLength),i.buffer},callFunction:function(t,e){return t instanceof Array&&t.length?(t.forEach(function(t){return"function"==typeof t&&t(e)}),null):"function"==typeof t&&t(e)},extend:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var i=t||{};return i instanceof Object&&n.forEach(function(t){t instanceof Object&&Object.keys(t).forEach(function(e){i[e]=t[e]})}),i}};e.a=o}])});
},{}],"MWvE":[function(require,module,exports) {
"use strict";var e,t,o=this&&this.__awaiter||function(e,t,o,n){return new(o||(o=Promise))(function(r,i){function a(e){try{c(n.next(e))}catch(t){i(t)}}function s(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var o,n,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(o)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(o=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(c){s=[6,c],n=0}finally{o=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},r=this&&this.__classPrivateFieldGet||function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)},i=this&&this.__classPrivateFieldSet||function(e,t,o,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,o):r?r.value=o:t.set(e,o),o},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SocketMsgType=void 0;var s,c=a(require("../sdk/socket-core.min.js")),l=require("@bilibili-live/web-player-common"),u=a(require("@bilibili-live/web-player-track"));function f(e){return o(this,void 0,Promise,function(){return n(this,function(t){switch(t.label){case 0:return[4,(0,l.ajax)("/xlive/web-room/v1/index/getDanmuInfo?id=".concat(e,"&type=0"))];case 1:return[2,t.sent()]}})})}!function(e){e.Danmaku="DANMU_MSG",e.SysMsg="SYS_MSG",e.SysGift="SYS_GIFT",e.GuardMsg="GUARD_MSG",e.SendGift="SEND_GIFT",e.Live="LIVE",e.Preparing="PREPARING",e.End="END",e.Close="CLOSE",e.Block="BLOCK",e.Round="ROUND",e.Welcome="WELCOME",e.Refresh="REFRESH",e.ActivityRedPacket="ACTIVITY_RED_PACKET",e.AreaBlock="ROOM_LIMIT",e.PkPre="PK_PRE",e.PkEnd="PK_END",e.PkSettle="PK_SETTLE",e.PkMicEnd="PK_MIC_END",e.HotRoomNotify="HOT_ROOM_NOTIFY",e.PLAY_TAG="PLAY_TAG",e.PLAY_PROGRESS_BAR="PLAY_PROGRESS_BAR",e.LOG_IN_NOTICE="LOG_IN_NOTICE",e.PlayerLogRecycle="LIVE_PLAYER_LOG_RECYCLE"}(s=exports.SocketMsgType||(exports.SocketMsgType={}));var d=function(){function a(o){this.opts=o,e.set(this,null),t.set(this,new l.EventBus),this.on=r(this,t,"f").on,this.emit=r(this,t,"f").emit,this.init().catch(function(e){l.logger.error(e)})}return a.prototype.init=function(){var t;return o(this,void 0,Promise,function(){var o,a,s=this;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,f(this.opts.roomId)];case 1:return o=n.sent(),[3,3];case 2:return a=n.sent(),l.logger.error("get danmainfo failed ".concat((0,l.any2Str)(a))),o={host_list:[],token:"",max_delay:5e3},[3,3];case 3:return l.logger.info("Socket init, serverInfo: ".concat(JSON.stringify(o))),i(this,e,new c.default({rid:this.opts.roomId,uid:null!==(t=this.opts.userId)&&void 0!==t?t:0,url:"wss://broadcastlv.chat.bilibili.com:443/sub",urlList:o.host_list.map(function(e){var t=e.host,o=e.wss_port;return"wss://".concat(t,":").concat(o,"/sub")}),retry:!0,retryMaxCount:o.host_list.length,protover:3,customAuthParam:[{type:"string",key:"platform",value:"web"},{type:"number",key:"type",value:2},{type:"string",key:"key",value:o.token}],onOpen:function(){l.logger.info("WebSocket On Open")},onClose:function(){l.logger.info("WebSocket On Close.")},onError:function(t){var o,n,i,a;l.logger.warn("WebSocket On Error. url: ".concat(null!==(n=null===(o=r(s,e,"f"))||void 0===o?void 0:o.getState().url)&&void 0!==n?n:"")),p({type:1,evt:t.code,url:null!==(a=null===(i=r(s,e,"f"))||void 0===i?void 0:i.getState().url)&&void 0!==a?a:""})},onInitialized:function(){l.logger.info("WebSocket Initialized.")},onReceivedMessage:function(e,t){l.wpd.SocketMsg2Console&&console.debug("socket onReceivedMessage: ".concat(t),e),t>1&&h(t),[].concat(e).forEach(function(e){s.emit("message",e)})},onHeartBeatReply:function(e){s.emit("heartbeat",e)},onReceiveAuthRes:function(t){var o;l.logger.warn("token expired, reconnect."),null===(o=r(s,e,"f"))||void 0===o||o.destroy(),s.init().catch(function(e){l.logger.error(e)})},onListConnectError:function(){var t,o;l.logger.info("WebSocket On List Connect Error."),p({type:2,url:null!==(o=null===(t=r(s,e,"f"))||void 0===t?void 0:t.getState().url)&&void 0!==o?o:""})},fallback:function(){l.logger.info("WebSocket Supporting Error.")},onLogger:function(e){l.logger.error(e)}}),"f"),[2]}})})},a.prototype.destroy=function(){var o;null===(o=r(this,e,"f"))||void 0===o||o.destroy(),r(this,t,"f").destroy()},a}();function h(e){(0,l.ajax)("/xlive/open-interface/v1/dm/message_ack",{method:"POST",data:{terminal:0,sequence:e}}).catch(function(e){l.logger.error(e)})}function p(e){u.default.error(u.default.ErrorCode.SocketConnect,JSON.stringify(e))}exports.default=d,e=new WeakMap,t=new WeakMap;
},{"../sdk/socket-core.min.js":"EfpE","@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf"}],"xqO8":[function(require,module,exports) {
"use strict";var e,t,i,n,a,s,r,l,o,f,c,d,u,h,p,v,m,w,y,g,b,k,M,L,E,W,C,P,S,_,R,I,H,D,T,x,A,B,O=this&&this.__assign||function(){return(O=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},j=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,s){function r(e){try{o(n.next(e))}catch(t){s(t)}}function l(e){try{o(n.throw(e))}catch(t){s(t)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(r,l)}o((n=n.apply(e,t||[])).next())})},N=this&&this.__generator||function(e,t){var i,n,a,s,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function l(l){return function(o){return function(l){if(i)throw new TypeError("Generator is already executing.");for(;s&&(s=0,l[0]&&(r=0)),r;)try{if(i=1,n&&(a=2&l[0]?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(a=(a=r.trys).length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){r=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(6===l[0]&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(o){l=[6,o],n=0}finally{i=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,o])}}},q=this&&this.__classPrivateFieldSet||function(e,t,i,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,i):a?a.value=i:t.set(e,i),i},U=this&&this.__classPrivateFieldGet||function(e,t,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(e):n?n.value:t.get(e)},F=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var V=F(require("./replay.less")),G=require("@bilibili-live/web-player-common"),Y=require("@bilibili-live/web-player-socket"),z=require("../common/controller"),X=F(require("@bilibili-live/web-player-track")),$=function(){return function(F,$,J,K){var Q=this;this.ctrl=K,e.set(this,3600),t.set(this,300),i.set(this,document.createElement("div")),n.set(this,document.createElement("div")),a.set(this,document.createElement("div")),s.set(this,document.createElement("div")),r.set(this,document.createElement("div")),l.set(this,document.createElement("div")),o.set(this,null),f.set(this,new Map),c.set(this,0),d.set(this,void 0),u.set(this,void 0),h.set(this,[]),p.set(this,[]),v.set(this,0),m.set(this,{}),this.isReplay=!1,w.set(this,new G.EventBus),this.on=U(this,w,"f").on,this.emit=U(this,w,"f").emit,y.set(this,0),g.set(this,!0),b.set(this,!1),this.bakState={},k.set(this,!1),this.init=function(){var e,i=Q.ctrl.onChange(function(e,t){return j(Q,void 0,void 0,function(){return N(this,function(i){return"show"===e&&(this.changeReplayStyle(t),t||this.removeMouseMoveListener()),[2]})})}),a=U(Q,M,"f").call(Q);a.addEventListener("touchstart",U(Q,W,"f")),a.addEventListener("mousedown",U(Q,L,"f"));var s=0,r=function(){return j(Q,void 0,Promise,function(){var e,t=this;return N(this,function(i){switch(i.label){case 0:return[4,U(this,x,"f").call(this)];case 1:return i.sent()?(U(this,B,"f").call(this),null===(e=U(this,o,"f"))||void 0===e||e.appendChild(a),s=window.setInterval(function(){U(t,D,"f").call(t)},1e3),window.addEventListener("message",U(this,T,"f")),[2]):[2]}})})};if(Date.now()/1e3-U(Q,c,"f")>=U(Q,t,"f"))r().catch(function(e){G.logger.error(e)});else{var l=window.setInterval(function(){Date.now()/1e3-U(Q,c,"f")>=U(Q,t,"f")&&(r().catch(function(e){G.logger.error(e)}),clearInterval(l))},5e3);U(Q,h,"f").push(function(){return clearInterval(l)})}var f=null===(e=U(Q,o,"f"))||void 0===e?void 0:e.getElementsByClassName("web-player-controller-wrap"),d=Date.now();null!=f&&f[0].classList.add("web-player-controller-"+d.toString()),U(Q,h,"f").push(i,function(){clearInterval(s)},Q.ctrl.on(z.ControllerEventType.BottomDistanceChange,function(e){U(Q,n,"f").style.bottom="".concat(e,"px")}))},this.removeReplay=function(){U(Q,h,"f").forEach(function(e){return null==e?void 0:e()}),q(Q,h,[],"f"),window.removeEventListener("message",U(Q,T,"f")),U(Q,n,"f").remove(),U(Q,n,"f").removeEventListener("mousedown",U(Q,L,"f"))},this.removeHighlight=function(e){var t=!1;return U(Q,f,"f").forEach(function(i,n){i.tag_id===e&&(U(Q,f,"f").delete(n),t=!0,n.remove())}),t},this.handleHighlight=function(e){Q.removeHighlight(e.tag_id),"ADD"===e.type&&U(Q,H,"f").call(Q,e),"DEL_ALL"===e.type&&U(Q,f,"f").forEach(function(e,t){U(Q,f,"f").delete(t),t.remove()})},this.changeReplayStyle=function(e){e?(U(Q,i,"f").classList.remove(V.default.replayHidden),U(Q,i,"f").classList.add(V.default.replayShow),U(Q,r,"f").classList.remove(V.default.progressHidden),U(Q,r,"f").classList.add(V.default.progressShow),U(Q,a,"f").style.display="block",U(Q,s,"f").classList.add(V.default.webPlayerReplayHighlightsShow),U(Q,s,"f").classList.remove(V.default.webPlayerReplayHighlightsHidden)):(U(Q,i,"f").classList.remove(V.default.replayShow),U(Q,i,"f").classList.add(V.default.replayHidden),U(Q,r,"f").classList.remove(V.default.progressShow),U(Q,r,"f").classList.add(V.default.progressHidden),U(Q,a,"f").style.display="none",U(Q,s,"f").classList.remove(V.default.webPlayerReplayHighlightsShow),U(Q,s,"f").classList.add(V.default.webPlayerReplayHighlightsHidden))},this.setProgress=function(e){U(Q,l,"f").style.width=e,U(Q,a,"f").style.left=e},this.removeMouseMoveListener=function(e){var t,i;if(null===(t=U(Q,o,"f"))||void 0===t||t.removeEventListener("mousemove",U(Q,E,"f")),null!=e){var n=U(Q,_,"f").call(Q,U(Q,a,"f").style.left);if(Q.isReplay=0!==n,0===U(Q,v,"f")){var s=Q.ctrl.getCtrlUI();q(Q,g,Boolean(null===(i=s.danmaku)||void 0===i?void 0:i.display),"f")}q(Q,v,n,"f"),Q.reload(n),window.removeEventListener("mouseup",Q.removeMouseMoveListener),X.default.operation(X.default.OperationCode.TimeShift,{type:!0,timeShiftDuration:0}),q(Q,y,performance.now(),"f")}},M.set(this,function(){return U(Q,n,"f").classList.add(V.default.webPlayerReplayContainer),U(Q,i,"f").classList.add(V.default.webPlayerReplayElement),U(Q,r,"f").classList.add(V.default.webPlayerReplayProgress),U(Q,a,"f").classList.add(V.default.webPlayerReplayCurrentPoint),U(Q,l,"f").classList.add(V.default.webPlayerReplayBar),U(Q,s,"f").classList.add(V.default.webPlayerReplayHighlights,V.default.webPlayerReplayHighlightsHidden),U(Q,r,"f").appendChild(U(Q,a,"f")),U(Q,r,"f").appendChild(U(Q,l,"f")),U(Q,i,"f").appendChild(U(Q,r,"f")),U(Q,i,"f").appendChild(U(Q,s,"f")),U(Q,n,"f").appendChild(U(Q,i,"f")),U(Q,n,"f")}),L.set(this,function(e){var t;if(!e.target.className.includes("highlight")){var i=U(Q,S,"f").call(Q,e);Q.setProgress(i),window.addEventListener("mouseup",Q.removeMouseMoveListener),null===(t=U(Q,o,"f"))||void 0===t||t.addEventListener("mousemove",U(Q,E,"f"))}}),E.set(this,function(e){var t=U(Q,S,"f").call(Q,e);U(Q,l,"f").style.width=t,U(Q,a,"f").style.left=t}),W.set(this,function(e){q(Q,k,!1,"f"),U(Q,n,"f").addEventListener("touchmove",U(Q,P,"f")),U(Q,n,"f").addEventListener("touchend",U(Q,C,"f"))}),C.set(this,function(e){U(Q,n,"f").removeEventListener("touchmove",U(Q,P,"f")),U(Q,n,"f").removeEventListener("touchend",U(Q,C,"f")),U(Q,k,"f")&&(q(Q,k,!1,"f"),Q.removeMouseMoveListener(e.changedTouches[0]))}),P.set(this,function(e){q(Q,k,!0,"f");var t=U(Q,S,"f").call(Q,e.touches[0]);U(Q,l,"f").style.width=t,U(Q,a,"f").style.left=t}),S.set(this,function(e){var t,n=Number(null!==(t=getComputedStyle(document.documentElement).zoom)&&void 0!==t?t:1),a=e.clientX/n-U(Q,i,"f").getBoundingClientRect().left;a=a<0?0:a;var s=U(Q,i,"f").clientWidth;return(a/s>1?100:a/s*100).toFixed(2)+"%"}),_.set(this,function(t){var i=parseFloat(t.split("%")[0]),n=Date.now()/1e3-U(Q,c,"f");return n=n>U(Q,e,"f")?U(Q,e,"f"):n,Math.round(n*(100-i)/100)}),R.set(this,function(t){var i=Date.now()/1e3,n=i-U(Q,c,"f");n=n>U(Q,e,"f")?U(Q,e,"f"):n;var a=Math.round(i-t);return{timeShift:a,left:(100-100*a/n).toFixed(2)+"%"}}),I.set(this,function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div");return e.classList.add(V.default.backliveBtnContainer),t.classList.add(V.default.backliveBtn),i.classList.add(V.default.backliveDot),t.appendChild(i),t.append("返回直播"),t.onclick=function(){Q.setProgress("100%"),Q.returnLive(),Q.emit("timeShiftChange",0),X.default.operation(X.default.OperationCode.TimeShift,{type:!1,timeShiftDuration:Math.round(performance.now()-U(Q,y,"f"))}),q(Q,y,0,"f")},e.appendChild(t),e}),H.set(this,function(e){var t=document.createElement("div");t.classList.add(V.default.highlightItem);var i='<div class="'.concat(V.default.highlightPot,'"></div>');null!=e.pic&&""!==e.pic&&(i+='\n      <div class="'.concat(V.default.highlightIcon,'">\n        <div class="').concat(V.default.highlightImg,'" style="background-image: url(').concat(e.pic,')">\n        </div>\n      </div>\n      ')),t.innerHTML=i,t.onclick=function(){var t,i=U(Q,R,"f").call(Q,e.timestamp),n=i.timeShift,a=i.left;if(Q.setProgress(a),0===U(Q,v,"f")){var s=Q.ctrl.getCtrlUI();q(Q,g,Boolean(null===(t=s.danmaku)||void 0===t?void 0:t.display),"f")}q(Q,v,n,"f"),Q.isReplay=0!==n,Q.reload(n),X.default.operation(X.default.OperationCode.TimeShift,{type:!0,isHighlight:!0,timeShiftDuration:0}),q(Q,y,performance.now(),"f")},U(Q,f,"f").set(t,O(O({},e),{isAppend:!1,left:""}))}),D.set(this,function(){U(Q,f,"f").forEach(function(e,t){var i=U(Q,R,"f").call(Q,e.timestamp);i.left.includes("-")?(t.remove(),U(Q,f,"f").delete(t)):(t.style.left=i.left,U(Q,f,"f").set(t,O(O({},e),i)),e.isAppend||(U(Q,f,"f").set(t,O(O({},e),{isAppend:!0})),U(Q,s,"f").appendChild(t)))})}),T.set(this,function(e){var t=e.origin.split("://");if(t.length>=2&&/^(?:uat-)?mlive\.bilibili\.co(?::\d+)?$/.test(t[1].split("/")[0])||"production".includes("dev")){var i=e.data;"previewPlaybackTimelineAnchor"===i.type&&Q.handleHighlight({tag_id:0,timestamp:i.data.time,pic:i.data.iconUrl,type:"ADD"})}}),x.set(this,function(){return j(Q,void 0,Promise,function(){var e,t=this;return N(this,function(i){switch(i.label){case 0:return U(this,f,"f").forEach(function(e,i){U(t,f,"f").delete(i),i.remove()}),[4,(0,G.ajax)("/xlive/web-room/v1/index/getProgressBarInfo?roomid=".concat(U(this,u,"f"),"&platform=web"))];case 1:return e=i.sent(),U(this,b,"f")?[2,!1]:(null!=e.play_tag_list&&"ENABLE"===e.bar_status&&e.play_tag_list.forEach(function(e){t.handleHighlight(O(O({},e),{type:"ADD"}))}),[2,"ENABLE"===e.bar_status])}})})}),A.set(this,function(e){return e.on("message",function(e){switch(e.cmd){case Y.SocketMsgType.PLAY_TAG:Q.handleHighlight(e.data);break;case Y.SocketMsgType.PLAY_PROGRESS_BAR:var t=e.data,i=t.platform,n=t.type;if(!i.includes("web"))return;if(["DISABLE","LIMIT"].includes(n)){if(Q.isReplay){var a=Q.on("timeShiftChange",function(e){0===e&&(Q.removeReplay(),a())});return void U(Q,h,"f").push(a)}Q.removeReplay()}else if(null!=U(Q,u,"f")){var s=Number(e.data.scatter.min),r=Number(e.data.scatter.max),l=setTimeout(function(){Q.init()},Math.floor(1e3*(Math.random()*(r-s)+s)));U(Q,h,"f").push(function(){clearTimeout(l)})}}})}),this.destroy=function(){q(Q,b,!0,"f"),Q.removeReplay()},this.returnLive=function(){U(Q,p,"f").forEach(function(e){return e()}),q(Q,p,[],"f"),Q.setProgress("100%"),Q.emit("backLive");var e=Q.ctrl.getCtrlUI();e.ctrlItemVisibility=O(O({},e.ctrlItemVisibility),U(Q,m,"f")),e.onChange("danmaku",{display:U(Q,g,"f")}),Q.isReplay=!1,q(Q,v,0,"f")},this.reload=function(e){if(void 0===e&&(e=U(Q,v,"f")),U(Q,p,"f").forEach(function(e){return e()}),q(Q,p,[],"f"),0!==e){var t=Q.ctrl.getCtrlUI();t.onChange("danmaku",{display:!1}),0===Object.keys(U(Q,m,"f")).length&&q(Q,m,O({},t.ctrlItemVisibility),"f"),t.ctrlItemVisibility=O(O({},t.ctrlItemVisibility),{rightSetting:!1,quality:!1,danmaku:!1}),U(Q,p,"f").push(t.appendCtrlItem(U(Q,d,"f"),{xIndex:0})),Q.isReplay=!0}else Q.returnLive();Q.emit("timeShiftChange",e)},B.set(this,function(){var e=Q.ctrl.getCtrlUI();U(Q,n,"f").style.visibility="hidden",U(Q,h,"f").push(Q.ctrl.onChange(function(e,t){"show"===e&&(!1===t&&0===U(Q,v,"f")?U(Q,n,"f").style.visibility="hidden":U(Q,n,"f").style.visibility="visible")}),Q.on("timeShiftChange",function(t){0!==t||e.show?U(Q,n,"f").style.visibility="visible":U(Q,n,"f").style.visibility="hidden"}))}),q(this,o,F,"f"),q(this,c,$.live_time,"f"),q(this,u,$.rid,"f"),U(this,f,"f").clear(),q(this,d,U(this,I,"f").call(this),"f"),U(this,h,"f").push(U(this,A,"f").call(this,J))}}();exports.default=$,e=new WeakMap,t=new WeakMap,i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,r=new WeakMap,l=new WeakMap,o=new WeakMap,f=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,h=new WeakMap,p=new WeakMap,v=new WeakMap,m=new WeakMap,w=new WeakMap,y=new WeakMap,g=new WeakMap,b=new WeakMap,k=new WeakMap,M=new WeakMap,L=new WeakMap,E=new WeakMap,W=new WeakMap,C=new WeakMap,P=new WeakMap,S=new WeakMap,_=new WeakMap,R=new WeakMap,I=new WeakMap,H=new WeakMap,D=new WeakMap,T=new WeakMap,x=new WeakMap,A=new WeakMap,B=new WeakMap;
},{"./replay.less":"XQD5","@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-socket":"MWvE","../common/controller":"as8u","@bilibili-live/web-player-track":"ESUf"}],"blC7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.connectMirror=exports.connectVideoPip=exports.connectVideoLoading=exports.connectUIandVideo=void 0;var t=require("@bilibili-live/web-player-common"),n=require("@bilibili-live/web-player-video"),r=e(require("@bilibili-live/web-player-track"));function i(e,n){var r=e.getCtrlUI(),i=n.getVideoEl();if(null==i||null==r)return function(){};var o=t.userSetting.getVolume();null!=o&&(i.volume=o.value/100,i.muted=o.disabled,r.volume={disabled:i.muted,value:100*i.volume});var u=function(){r.playStatus=!0},a=function(){r.playStatus=!1},l=function(){n.getVideoEl().paused&&e.show()},c=function(e){null!=r.volume&&(r.volume={disabled:i.muted,value:100*i.volume})};i.addEventListener("playing",u),i.addEventListener("pause",a),i.addEventListener("loadeddata",l),i.addEventListener("volumechange",c);var d=e.onChange(function(e,n){if("playStatus"===e)n?i.play().catch(function(e){t.logger.error(e)}):i.pause();else if("volume"===e){var r=n,o=r.disabled,u=r.value;i.muted=o,i.volume=u/100}});return function(){d(),i.removeEventListener("playing",u),i.removeEventListener("pause",a),i.removeEventListener("loadeddata",l),i.removeEventListener("volumechange",c)}}function o(e,r,i){var o,u=function(){o=(0,t.loading)(r)},a=function(){null==o||o()},l=e.on(n.EventType.WaitStart,function(){u()}),c=e.on(n.EventType.WaitEnd,a);return e.once(n.EventType.FirstFrame,function(){a(),(0,t.coverImg)(null,r)}),null==i||""===i?(u(),(0,t.coverImg)(null,r)):(0,t.coverImg)(i,r),function(){l(),c(),a()}}function u(e,i){var o=function(){null!=document.pictureInPictureElement&&document.exitPictureInPicture().catch(function(e){t.logger.error(e)})},u=e.on(n.EventType.Destroyed,function(){o(),c.pipStatus=!1,u()}),a=i.onChange(function(n,r){if("pipStatus"===n&&document.pictureInPictureEnabled){if(r){var i=e.getVideoEl();return o(),void i.requestPictureInPicture().catch(t.logger.error)}o()}}),l=e.getVideoEl(),c=i.getCtrlUI(),d=0,v=function(){r.default.operation(r.default.OperationCode.PictureInPicture,Math.floor((performance.now()-d)/1e3),{sampleRate:1})},s=function(){c.pipStatus=!1,v()},p=function(){d=performance.now()},f=function(){null!=document.pictureInPictureElement&&v()};return l.addEventListener("leavepictureinpicture",s),l.addEventListener("enterpictureinpicture",p),window.addEventListener("beforeunload",f),function(){a(),l.removeEventListener("leavepictureinpicture",s),l.removeEventListener("enterpictureinpicture",p),window.removeEventListener("beforeunload",f),o()}}function a(e,t){!0===t.getCtrlUI().mirrorStatus&&(e.getVideoEl().style.transform="rotateY(180deg)");var n=t.onChange(function(t,n){if("mirrorStatus"===t){var r=e.getVideoEl();r.style.transform=!0!==n?"":"rotateY(180deg)"}});return function(){n()}}exports.connectUIandVideo=i,exports.connectVideoLoading=o,exports.connectVideoPip=u,exports.connectMirror=a;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-track":"ESUf"}],"fyPa":[function(require,module,exports) {
"use strict";var t,e,i,n,r,o,s,h,a,c,f,l,d,p,g,u,w,_,m,b,k,v,y=this&&this.__assign||function(){return(y=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},x=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function s(t){try{a(n.next(t))}catch(e){o(e)}}function h(t){try{a(n.throw(t))}catch(e){o(e)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(s,h)}a((n=n.apply(t,e||[])).next())})},T=this&&this.__generator||function(t,e){var i,n,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function h(h){return function(a){return function(h){if(i)throw new TypeError("Generator is already executing.");for(;o&&(o=0,h[0]&&(s=0)),s;)try{if(i=1,n&&(r=2&h[0]?n.return:h[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,h[1])).done)return r;switch(n=0,r&&(h=[2&h[0],r.value]),h[0]){case 0:case 1:r=h;break;case 4:return s.label++,{value:h[1],done:!1};case 5:s.label++,n=h[1],h=[0];continue;case 7:h=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===h[0]||2===h[0])){s=0;continue}if(3===h[0]&&(!r||h[1]>r[0]&&h[1]<r[3])){s.label=h[1];break}if(6===h[0]&&s.label<r[1]){s.label=r[1],r=h;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(h);break}r[2]&&s.ops.pop(),s.trys.pop();continue}h=e.call(t,s)}catch(a){h=[6,a],n=0}finally{i=r=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([h,a])}}},M=this&&this.__classPrivateFieldSet||function(t,e,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(t,i):r?r.value=i:e.set(t,i),i},E=this&&this.__classPrivateFieldGet||function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var W,R=require("@bilibili-live/web-player-common");!function(t){t[t.Normal=1]="Normal",t[t.Text=2]="Text"}(W||(W={}));var B=(0,R.isWebPSupported)(),S=function(){return function(S){var C=this;this.container=S,t.set(this,void 0),e.set(this,void 0),i.set(this,null),n.set(this,0),r.set(this,0),o.set(this,new Map),s.set(this,new Map),h.set(this,[]),a.set(this,0),c.set(this,[]),f.set(this,!1),this.onSei=function(t){E(C,w,"f").call(C,t).catch(function(t){throw R.logger.error("贴纸加载失败"),new Error(t)})},this.onVideoInfo=function(i){i.width!==E(C,t,"f").width&&i.height!==E(C,t,"f").height&&(M(C,t,i,"f"),M(C,e,{width:0,height:0},"f"))},l.set(this,function(t){var e,i;E(C,o,"f").has(t.sticker_id)||E(C,f,"f")||(M(C,f,!0,"f"),t.sticker_type===W.Text?(null===(e=E(C,o,"f").get(t.sticker_id))||void 0===e||e.el.remove(),E(C,o,"f").set(t.sticker_id,E(C,d,"f").call(C,t))):(null===(i=E(C,o,"f").get(t.sticker_id))||void 0===i||i.el.remove(),E(C,o,"f").set(t.sticker_id,E(C,p,"f").call(C,t))))}),d.set(this,function(t){R.logger.info("create text sticker, id: ".concat(t.sticker_id));var i=new Image,o=document.createElement("div"),h=E(C,s,"f").get(t.sticker_id);return i.onload=function(){C.container.append(i),h.stretch.top_margin=(i.height-3)/2,h.stretch.bottom_margin=i.height/2,E(C,s,"f").set(t.sticker_id,y(y({},h),{width:i.width,height:i.height}));var a=E(C,g,"f").call(C,h,i.getBoundingClientRect(),t),c=document.createElement("span");c.innerText=t.sticker_title,c.style.cssText="\n        color: ".concat(t.sticker_title_color,";\n        font-size: ").concat(a.borderBottom+a.borderTop,"px;\n        position: absolute;\n        z-index: 4;\n        visibility: hidden;\n        word-break: keep-all;\n        white-space: no-wrap;\n        transform: scale(").concat(.3,");\n        transform-origin: 0 0;\n        white-space: nowrap;\n        cursor: default;\n        user-select: none;\n      "),C.container.append(c),c.style.cssText+="\n        top: -".concat(2.2*h.title.bottom_margin/i.height*(a.borderBottom+a.borderTop),"px;\n        left: -").concat(3*h.title.right_margin/i.width*a.width-.3*a.height,"px;\n      "),o.style.cssText="\n        transition: all .1s ease-in-out;\n        position: absolute;\n        z-index: 4;\n        border-style: solid;\n        border-color: transparent;\n        border-left-width: ".concat(a.borderLeft,"px;\n        border-right-width: ").concat(a.borderRight,"px;\n        border-top-width: ").concat(a.borderTop,"px;\n        border-bottom-width: ").concat(a.borderBottom,"px;\n        width: ").concat(c.getBoundingClientRect().width-a.borderRight+.5*a.height,"px;\n        border-image-source: url(").concat(h.url,");\n        border-image-repeat: stretch stretch;\n        border-image-slice: ").concat(h.stretch.top_margin," ").concat(h.stretch.right_margin," ").concat(h.stretch.bottom_margin," ").concat(h.stretch.left_margin," fill;\n      "),o.append(c),C.container.append(o);var l=E(C,e,"f").width,d=E(C,e,"f").height;l-=o.getBoundingClientRect().width,d=d-a.borderBottom-a.borderTop-c.getBoundingClientRect().height,t.display_width-t.sticker_right_offset<2?o.style.cssText+="\n            left: ".concat(E(C,r,"f")+l,"px;\n            top: ").concat(E(C,n,"f")+Math.min(t.sticker_top_offset*E(C,e,"f").height/t.display_height,d),"px;\n          "):o.style.cssText+="\n            left: ".concat(E(C,r,"f")+Math.min(t.sticker_left_offset*E(C,e,"f").width/t.display_width,l),"px;\n            top: ").concat(E(C,n,"f")+Math.min(t.sticker_top_offset*E(C,e,"f").height/t.display_height,d),"px;\n          "),c.style.visibility="visible",i.remove(),M(C,f,!1,"f")},i.src=B?h.url:h.url.replace(".webp",".gif"),i.style.visibility="hidden",{el:o,sei:t,width:0,height:0}}),p.set(this,function(t){R.logger.info("create img sticker, id: ".concat(t.sticker_id));var i=new Image,o=E(C,s,"f").get(t.sticker_id);return C.container.append(i),i.onload=function(){var h=E(C,e,"f").width,a=E(C,e,"f").height,c=E(C,g,"f").call(C,o,i.getBoundingClientRect(),t);a-=c.height,h-=c.width,i.style.cssText="\n          transition: all .1s ease-in-out;\n          position: absolute;\n          z-index: 4;\n        ",t.display_width-t.sticker_right_offset<2?i.style.cssText+="\n            left: ".concat(E(C,r,"f")+h,"px;\n            top: ").concat(E(C,n,"f")+Math.min(t.sticker_top_offset*E(C,e,"f").height/t.display_height,a),"px;\n          "):i.style.cssText+="\n            left: ".concat(E(C,r,"f")+Math.min(t.sticker_left_offset*E(C,e,"f").width/t.display_width,h),"px;\n            top: ").concat(E(C,n,"f")+Math.min(t.sticker_top_offset*E(C,e,"f").height/t.display_height,a),"px;\n          "),E(C,s,"f").set(t.sticker_id,y(y({},o),{width:i.width,height:i.height})),i.width=c.width,M(C,f,!1,"f")},i.src=B?o.url:o.url.replace(".webp",".gif"),{el:i,sei:t,width:0,height:0}}),this.batchUpdateStickerElement=function(){E(C,o,"f").forEach(function(t,e){E(C,u,"f").call(C,e)})},g.set(this,function(t,i,n){var r={width:0,height:0,top:0,left:0,borderLeft:0,borderRight:0,borderTop:0,borderBottom:0};if(r.height=E(C,e,"f").height*(n.sticker_bottom_offset-n.sticker_top_offset)/n.display_height/1.1,r.width=r.height*i.width/i.height,t.sticker_type===W.Text){var o=t,s=o.stretch,h=s.top_margin,a=s.left_margin,c=s.right_margin,f=s.bottom_margin,l=o.title,d=l.top_margin,p=l.left_margin;r.borderBottom=r.height/(f+h)*f,r.borderLeft=r.width/(a+c)*a,r.borderRight=r.width/(a+c)*c,r.borderTop=r.height/(f+h)*h,r.left=p*r.width/i.width,r.top=d*r.width/i.width}return r}),u.set(this,function(t){var i=E(C,o,"f").get(t),h=E(C,s,"f").get(t);if(null!=i&&null!=h){var a=E(C,g,"f").call(C,h,{width:h.width,height:h.height},i.sei),c=E(C,e,"f").width,f=E(C,e,"f").height;if(i.sei.sticker_type===W.Text){var l=h,d=i.el,p=d.firstElementChild;if(null==p)return void E(C,v,"f").call(C);var u=a.borderBottom+a.borderTop;p.style.fontSize=u.toString()+"px",p.innerText=String(i.sei.sticker_title);var w=p.getBoundingClientRect().width-a.borderRight+.5*a.height;w=w>0?w:0,d.style.cssText+="\n          border-left-width: ".concat(a.borderLeft,"px;\n          border-right-width: ").concat(a.borderRight,"px;\n          border-top-width: ").concat(a.borderTop,"px;\n          border-bottom-width: ").concat(a.borderBottom,"px;\n          width: ").concat(w,"px;\n        "),p.style.cssText+="\n          top: -".concat(2.2*l.title.bottom_margin/l.height*(a.borderBottom+a.borderTop),"px;\n          color: ").concat(i.sei.sticker_title_color,";\n          left: -").concat(3*l.title.right_margin/h.width*a.width-.3*a.height,"px;\n        "),c=c-a.borderLeft-a.borderRight-w,f=f-a.borderBottom-a.borderTop-p.getBoundingClientRect().height}else i.el.width=a.width,f-=a.height,c-=a.width;i.el.style.cssText+="\n        display: block;\n      ",i.sei.display_width-i.sei.sticker_right_offset<2?i.el.style.cssText+="\n          left: ".concat(E(C,r,"f")+c,"px;\n          top: ").concat(E(C,n,"f")+Math.min(i.sei.sticker_top_offset*E(C,e,"f").height/i.sei.display_height,f),"px;\n        "):i.el.style.cssText+="\n          left: ".concat(E(C,r,"f")+Math.min(i.sei.sticker_left_offset*E(C,e,"f").width/i.sei.display_width,c),"px;\n          top: ").concat(E(C,n,"f")+Math.min(i.sei.sticker_top_offset*E(C,e,"f").height/i.sei.display_height,f),"px;\n        ")}}),w.set(this,function(i){return x(C,void 0,Promise,function(){var n,r,h,f,d,p=this;return T(this,function(g){if(0===E(this,t,"f").width)return[2];if(!i.includes("LIVE_STICKER"))return[2];if(n=JSON.parse(i),0===E(this,e,"f").width&&(E(this,m,"f").call(this,n.LIVE_STICKER[0]),this.batchUpdateStickerElement()),clearTimeout(E(this,a,"f")),0===n.LIVE_STICKER.length)return E(this,v,"f").call(this),[2];for(E(this,o,"f").forEach(function(t,e){for(var i,r=!0,s=0,h=n.LIVE_STICKER;s<h.length;s++)h[s].sticker_id===e&&(r=!1);r&&(null===(i=t.el)||void 0===i||i.remove(),R.logger.info("remove sticker id: ".concat(t.sei.sticker_id)),E(p,o,"f").delete(e))}),r=0,h=n.LIVE_STICKER;r<h.length;r++)if(f=h[r],E(this,o,"f").has(f.sticker_id))(null==(d=E(this,o,"f").get(f.sticker_id))?void 0:d.sei.hash)!==f.hash&&(null!=d?(E(this,o,"f").set(f.sticker_id,y(y({},d),{sei:f})),E(this,u,"f").call(this,f.sticker_id)):(R.logger.info("2remove sticker id: ".concat(f.sticker_id)),E(this,o,"f").delete(f.sticker_id)));else if(E(this,s,"f").has(f.sticker_id))E(this,l,"f").call(this,f);else{if(E(this,c,"f").includes(f.group_id))return[2];E(this,c,"f").push(f.group_id),E(this,k,"f").call(this,f.group_id,f).catch(function(t){R.logger.error(t)})}return[2]})})}),_.set(this,function(){window.addEventListener("resize",E(C,b,"f")),document.addEventListener("fullscreenchange",E(C,b,"f")),E(C,h,"f").push(function(){window.removeEventListener("resize",E(C,b,"f")),document.removeEventListener("fullscreenchange",E(C,b,"f"))})}),this.calcDisplayInfo=function(){if(null!=E(C,i,"f")){var o=C.container.getBoundingClientRect().height,s=C.container.getBoundingClientRect().width,h=E(C,t,"f").width,a=E(C,t,"f").height;o/a<s/h?(M(C,e,{width:o*h/a,height:o*h/a*E(C,i,"f").display_height/E(C,i,"f").display_width},"f"),M(C,n,E(C,e,"f").width*E(C,i,"f").display_height/E(C,i,"f").display_width*.2,"f"),M(C,r,(s-E(C,e,"f").width)/2,"f")):(M(C,r,0,"f"),M(C,e,{width:s,height:s*E(C,i,"f").display_height/E(C,i,"f").display_width},"f"),M(C,n,(o-E(C,e,"f").width/7*4)/2+E(C,e,"f").width/14,"f"))}},m.set(this,function(t){M(C,i,t,"f"),null!=t&&C.calcDisplayInfo()}),this.destroy=function(){E(C,v,"f").call(C),M(C,f,!1,"f"),E(C,h,"f").forEach(function(t){return t()}),M(C,h,[],"f"),M(C,t,{width:0,height:0},"f"),M(C,e,{width:0,height:0},"f"),M(C,c,[],"f")},b.set(this,function(){C.calcDisplayInfo(),C.batchUpdateStickerElement()}),k.set(this,function(t,e){return x(C,void 0,Promise,function(){var i=this;return T(this,function(n){return R.ajax.disperse("/xlive/web-room/v1/stickers/getStickers",{scope:1e3*e.request_random_sec_range,expiresTime:performance.now()+1e3*e.request_random_sec_range}),(0,R.ajax)("/xlive/web-room/v1/stickers/getStickers?id=".concat(t)).then(function(t){for(var n=0,r=t.pic_stickers;n<r.length;n++){var o=r[n];E(i,s,"f").has(o.id)||E(i,s,"f").set(o.id,o)}for(var h=0,a=t.text_stickers;h<a.length;h++){var c=a[h];E(i,s,"f").has(c.id)||(c.stretch.top_margin*=3,c.stretch.left_margin*=3,c.stretch.right_margin*=3,c.stretch.bottom_margin*=3,E(i,s,"f").set(c.id,c))}E(i,l,"f").call(i,e)}).catch(function(t){R.logger.error(t)}),[2]})})}),v.set(this,function(){E(C,o,"f").forEach(function(t){var e=t.el;null==e||e.remove()}),E(C,o,"f").clear()}),M(this,t,{width:0,height:0},"f"),M(this,e,{width:0,height:0},"f"),E(this,_,"f").call(this)}}();exports.default=S,t=new WeakMap,e=new WeakMap,i=new WeakMap,n=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,h=new WeakMap,a=new WeakMap,c=new WeakMap,f=new WeakMap,l=new WeakMap,d=new WeakMap,p=new WeakMap,g=new WeakMap,u=new WeakMap,w=new WeakMap,_=new WeakMap,m=new WeakMap,b=new WeakMap,k=new WeakMap,v=new WeakMap;
},{"@bilibili-live/web-player-common":"KGHo"}],"OKfi":[function(require,module,exports) {
var define;
var e;!function(r,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof e&&e.amd?e([],o):"object"==typeof exports?exports.WasmPlayerLoader=o():r.WasmPlayerLoader=o()}(self,function(){return function(){"use strict";var e={d:function(r,o){for(var n in o)e.o(o,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:o[n]})},o:function(e,r){return Object.prototype.hasOwnProperty.call(e,r)}},r={};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.d(r,{default:function(){return E}});var n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]);function t(){try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(n)}catch(e){return!1}}var a=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);function i(){try{return WebAssembly.validate(a)}catch(e){return!1}}function s(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video/mp4",n=document.createElement("video");if("function"!=typeof n.canPlayType||"function"!=typeof(null===(r=window.MediaSource)||void 0===r?void 0:r.isTypeSupported))return!1;var t="".concat(o,'; codecs="').concat(e,'"'),a=n.canPlayType(t).toLowerCase();return!("maybe"!==a&&"probably"!==a||!window.MediaSource.isTypeSupported(t))}function c(){var e,r,o=document.createElement("canvas"),n="",t="";try{(e=o.getContext("webgl")||o.getContext("webgl2")||o.getContext("experimental-webgl"))&&(r=e.getExtension("WEBGL_debug_renderer_info"))&&(n=e.getParameter(r.UNMASKED_VENDOR_WEBGL),t=e.getParameter(r.UNMASKED_RENDERER_WEBGL))}catch(e){return null}return{vendor:n,renderer:t}}var u="name",w="version";function l(e,r){for(var n,t,a,i,s,c={},u=0;u<r.length;u+=2){n=r[u],a=r[u+1];for(var w=0;w<n.length;w++)if(s=n[w].exec(e)){for(var l=0;l<a.length;l++)i=s[l+1],"object"===o(t=a[l])&&t.length>0?2===t.length?c[t[0]]=t[1]:console.error("[Browser] [rgxMapper] not support arg count!"):c[t]=i||void 0;return c}}return c}var d=function(){var e="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null,r="other",o="other",n="0";if(null!==e){r=function(e){var r=l(e,[[/microsoft (windows) (vista|xp)/i],"",[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[/ ]?([\d.\w ]*)/i,/(windows)[/ ]?([ntce\d. ]+\w)(?!.+xbox)/i],[u],[/(win(?=3|9|n)|win 9x )([nt\d.]+)/i],"Windows",[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,"iOS"]],[/(mac os x) ?([\w. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"]]]).name;return{Windows:!0,"Mac OS":!0}[r]?r:"other"}(e);var a=function(e){var r=l(e,[[/edg(?:e|ios|a)?\/([\w.]+)/i],[w,[u,"Edge"]],[/\bopr\/([\w.]+)/i],[w,[u,"Opera"]],[/(kindle)\/([\w.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[/ ]?([\w.]*)/i,/(avant |iemobile|slim)(?:browser)?[/ ]?([\w.]*)/i,/(ba?idubrowser)[/ ]?([\w.]+)/i,/(?:ms|\()(ie) ([\w.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w.]+)/i,/(weibo)__([\d.]+)/i],[u,w],[/(?:\buc? ?browser|(?:juc.+)ucweb)[/ ]?([\w.]+)/i],[w,[u,"UCBrowser"]],[/\bqbcore\/([\w.]+)/i],[w,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w.]+)/i],[w,[u,"WeChat"]],[/konqueror\/([\w.]+)/i],[w,[u,"Konqueror"]],[/trident.+rv[: ]([\w.]{1,9})\b.+like gecko/i],[w,[u,"IE"]],[/yabrowser\/([\w.]+)/i],[w,[u,"Yandex"]],[/(avast|avg)\/([\w.]+)/i],[[u,"Avast/AVG Secure Browser"],w],[/coc_coc\w+\/([\w.]+)/i],[w,[u,"Coc Coc"]],[/dolfin\/([\w.]+)/i],[w,[u,"Dolphin"]],[/slbrowser\/([\w.]+)/i],[w,[u,"Lenovo"]],[/115browser\/([\w.]+)/i],[w,[u,"115 Browser"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(comodo_dragon)\/([\w.]+)/i],[[u,"Comodo Dragon"],w],[/(electron)\/([\w.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[/ ]?([\w.]+)/i],[u,w],[/(metasr)[/ ]?([\w.]+)/i,/(lbbrowser)/i],[u],[/headlesschrome(?:\/([\w.]+)| )/i],[w,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w.]+)/i],[[u,"Chrome WebView"],w],[/(chrome)\/v?([\w.]+)/i],[[u,"Chrome"],w]]);return{browser:{Chrome:!0,Edge:!0}[r.name]?r.name:"other",version:r.version||"0"}}(e);o=a.browser,n=a.version}return{ua:e||"",os:r,browser:o,version:n,gpuInfo:c,hardwareConcurrency:window.navigator.hardwareConcurrency||0,isSIMDSupported:i,isPThreadSupported:t,isSupportHEVC:s("hvc1.1.6.L123")}},p="5.0.5",f="1"===window.localStorage.getItem("_wasm_player_debug_")||!1,m={BROWSER_LIST:{Chrome:{min:80,blackList:[]},Edge:{min:80,blackList:[]}},OS_LIST:{Windows:!0,"Mac OS":!0},GPU_LIST:[],BASE_CPU_CORE_NUMBER:4};function b(){if(f){for(var e,r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];(e=console).log.apply(e,["[WasmPlayerLoader]"].concat(o))}}var y=navigator.userAgent,v="wasm_player_supported",h=!1,g=null,S={browser:!1,browserHEVC:!1,cpu:!1,gpu:!1,gpuInfo:null,simd:!1,pthread:!1,hardwareConcurrency:0};function C(){if(null!==g)return g;var e=JSON.parse(localStorage.getItem(v)||"null"),r=(null==e?void 0:e.version)===p;if(e&&r&&e.ua===y)null!=e&&e.supported?(g=!0,null!=e&&e.cached?(b("SUPPORT! Already cached!"),h=!0):(b("SUPPORT! But not cache done!"),S=e.supportInfo,h=!1)):g=!1;else{h=Boolean(e&&e.cached&&r);var o=function(){var e=+new Date,r=!1,o=d(),n=m.BROWSER_LIST[o.browser],t=!!m.OS_LIST[o.os]&&!!n&&parseFloat("".concat(o.version))>=n.min,a=o.isSupportHEVC,i=o.hardwareConcurrency>=m.BASE_CPU_CORE_NUMBER;a&&"Chrome"===o.browser&&(b("use browser HEVC!"),r=!0,t=!0);var s=r?null:o.gpuInfo(),c=!r&&!!o.gpuInfo(),u=!r&&o.isPThreadSupported(),w=!r&&o.isSIMDSupported(),l=!!r||!!(u&&i&&c&&t);return b("supportedChecker end spent: ".concat(+new Date-e,"ms")),{pass:l,supportInfo:{browser:t,browserHEVC:a,cpu:i,gpu:c,gpuInfo:s,simd:w,pthread:u,hardwareConcurrency:o.hardwareConcurrency},isUseNativeHEVC:r}}();S=o.supportInfo,g=o.pass,b("supportInfo:",S),o.isUseNativeHEVC&&(b("IsUseNativeHEVC set cached true!"),h=!0),function(e){var r=JSON.stringify({version:p,ua:y,supported:e,supportInfo:S,cached:h,date:+new Date});localStorage.setItem(v,r)}(g)}return g||!1}var E={loadWasmPlayer:function(){return new Promise(function(e,r){C()?function(e,r){b("start load WasmPlayer SDK");var o=+new Date,n=function(){window.WasmPlayer?(b("load done WasmPlayer SDK, spent: ".concat(+new Date-o," ms")),h?e():window.WasmPlayer.preloadBwp(function(o){o?e():r(new Error("Cache WasmPlayer lib error, please retry!"))})):r(new Error("Can not get WasmPlayer Instance!"))};if(window.WasmPlayer)n();else{var t=document.createElement("script");t.type="text/javascript",t.setAttribute("async","async"),t.src="//s1.hdslb.com/bfs/static/wasm-player/wasm-player-5.0.5.min.js",document.body.appendChild(t),t.addEventListener("load",n),t.addEventListener("error",function(){r(new Error("load SDK error!"))})}}(e,r):r(new Error("Not Support!"))})},isHEVCSupported:C,isBwpSupported:C};return r.default}()});
},{}],"lCVI":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function u(e){try{l(n.next(e))}catch(t){i(t)}}function a(e){try{l(n.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,a)}l((n=n.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(a){return function(l){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,a[0]&&(u=0)),u;)try{if(r=1,n&&(o=2&a[0]?n.return:a[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,a[1])).done)return o;switch(n=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,n=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(e,u)}catch(l){a=[6,l],n=0}finally{r=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadWASMDecoder=exports.isWASMSupportHEVC=exports.destroy=exports.once=exports.on=exports.isBwpSupported=void 0;var n=require("@bilibili-live/web-player-common"),o=r(require("@bilibili/wasmplayer-loader")),i=require("@bilibili/wasmplayer-loader");Object.defineProperty(exports,"isBwpSupported",{enumerable:!0,get:function(){return i.isBwpSupported}});var u=new n.EventBus;exports.on=u.on,exports.once=u.once,exports.destroy=u.destroy;var a=!1;function l(){return a}function s(){return e(this,void 0,Promise,function(){return t(this,function(e){switch(e.label){case 0:return[4,o.default.loadWasmPlayer().then(function(){a=!0})];case 1:return[2,e.sent()]}})})}exports.isWASMSupportHEVC=l,exports.loadWASMDecoder=s,n.wpd.SupportHEVC&&s().catch(function(e){n.logger.error(e)});
},{"@bilibili-live/web-player-common":"KGHo","@bilibili/wasmplayer-loader":"OKfi"}],"yABZ":[function(require,module,exports) {
"use strict";function e(e,r){if(r.some(function(r){return r.value===e.code.toString()}))return e.code.toString();for(var t=r[r.length-1],n=r.length-1;n>=0;n-=1){if(Number(r[n].value)>e.code&&null!=t)return String(t.value);t=r[n]}return String(t.value)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getHEVCDowngradeQn=void 0,exports.getHEVCDowngradeQn=e;
},{}],"H7b7":[function(require,module,exports) {
"use strict";var e=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},t=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SwitchBetterLine=void 0;var n=5,i=8e3,r=6e4,a=1e4,o=5e3,s=0,f=function(){function f(v,m){var l=this;this.video=v,this.opts=m,c.set(this,!1),w.set(this,[]),h.set(this,0),u.set(this,0),p.set(this,[]),this.getNeedSwitchLine=function(){return e(l,c,"f")},this.destroy=function(){e(l,p,"f").forEach(function(e){return e()}),t(l,p,[],"f")},d.set(this,function(d){var v=0;s=performance.now();var m=function(){e(l,c,"f")?f.switchNum+=1:v=performance.now()},g=function(){if(!(s+a>performance.now()||0===v||e(l,u,"f")+o>=performance.now())){var f={duration:performance.now()-v,waitingStartTime:v};e(l,w,"f").push(f),t(l,w,e(l,w,"f").filter(function(n){return n.waitingStartTime+r<performance.now()&&t(l,h,e(l,h,"f")-n.duration,"f"),n.waitingStartTime+r>=performance.now()}),"f"),t(l,h,e(l,w,"f").reduce(function(e,t){return e+t.duration},0),"f"),(e(l,h,"f")>i||e(l,w,"f").length>=n)&&t(l,c,!0,"f")}},E=function(){t(l,u,performance.now(),"f")};d.addEventListener("playing",g),d.addEventListener("seeking",E),d.addEventListener("waiting",m),e(l,p,"f").push(function(){d.removeEventListener("seeking",E),d.removeEventListener("playing",g),d.removeEventListener("waiting",m)})}),f.switchNum+1!==this.opts.lineNum&&e(this,d,"f").call(this,v)}var c,w,h,u,p,d;return c=new WeakMap,w=new WeakMap,h=new WeakMap,u=new WeakMap,p=new WeakMap,d=new WeakMap,f.switchNum=0,f.lastSwitchTime=0,f}();exports.SwitchBetterLine=f;
},{}],"z0Gg":[function(require,module,exports) {
"use strict";var e,r;Object.defineProperty(exports,"__esModule",{value:!0}),exports.useRetryStrategy=exports.RetryStrategies=void 0;var t,o=require("@bilibili-live/web-player-common"),P=((e={})[o.P2PType.HLS_BILI]=o.P2PType.NONE,e[o.P2PType.FLV_QVB]=o.P2PType.HLS_BILI,e[o.P2PType.NONE]=o.P2PType.HLS_NOT_P2P,e[o.P2PType.HLS_NOT_P2P]=o.P2PType.NONE,e);!function(e){e[e.Retry=0]="Retry",e[e.SwitchLine=1]="SwitchLine",e[e.ChangeProtocol=2]="ChangeProtocol",e[e.Failed=3]="Failed"}(t=exports.RetryStrategies||(exports.RetryStrategies={}));var c=((r={})[o.ProtocolType.HTTP_HLS]=[o.P2PType.HLS_BILI,o.P2PType.HLS_NOT_P2P],r[o.ProtocolType.HTTP_STREAM]=[o.P2PType.FLV_QVB,o.P2PType.NONE],r);function y(e,r,y){if(null==e)return t.Retry;var T=e.getCurP2PType();switch(y-r){case 1:case 2:case 3:return o.logger.error("maxRetryTimes: ".concat(y," retry count: ").concat(r,", auto change line")),e.setCurLine(e.getCurLine()+1),t.SwitchLine;case 0:if(null!=o.wpd.P2PType)return t.Retry;if(o.logger.error("retry count: ".concat(r,", auto change Protocol")),c[o.ProtocolType.HTTP_STREAM].includes(T)&&!e.hasHLSPlayerSupportStream())return t.Failed;var a=P[T];return c[o.ProtocolType.HTTP_HLS].includes(a)?e.useStream({protocol:o.ProtocolType.HTTP_HLS,expectP2PType:a}):e.useStream({protocol:o.ProtocolType.HTTP_STREAM,expectP2PType:a}),t.ChangeProtocol;default:return o.logger.error("maxRetryTimes: ".concat(y," retry count: ").concat(r,", retry")),t.Retry}}exports.useRetryStrategy=y;
},{"@bilibili-live/web-player-common":"KGHo"}],"XBQm":[function(require,module,exports) {
"use strict";var e,t,n,a,i,o,r,s,l,c,f,p,d,u,h,m,v,w,x,g,M,E,y,b,k,T,W=this&&this.__classPrivateFieldGet||function(e,t,n,a){if("a"===n&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?a:"a"===n?a.call(e):a?a.value:t.get(e)},L=this&&this.__classPrivateFieldSet||function(e,t,n,a,i){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,n):i?i.value=n:t.set(e,n),n},P=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.showPanoramaTip=exports.Panorama=void 0;var C=require("@bilibili-live/web-player-common"),R=P(require("@bilibili-live/web-player-track")),z=function(){return function(P,z,_){var A=this;this.container=P,this.videoEl=z,e.set(this,document.createElement("div")),t.set(this,!1),n.set(this,0),a.set(this,0),i.set(this,0),o.set(this,0),r.set(this,!1),s.set(this,0),l.set(this,0),c.set(this,0),f.set(this,void 0),p.set(this,[]),d.set(this,null),this.destroy=function(){L(A,t,!0,"f"),W(A,T,"f").call(A),W(A,e,"f").remove(),W(A,p,"f").forEach(function(e){return null==e?void 0:e()})},u.set(this,function(e,t,n){var a=n.getBoundingClientRect(),i=new e.PerspectiveCamera(75,a.width/a.height,1,1100);W(A,h,"f").call(A,i);var o=new e.Scene,r=new e.SphereBufferGeometry(500,100,80);r.scale(-1,1,1);var s=new e.VideoTexture(t),l=new e.MeshBasicMaterial({map:s}),c=new e.Mesh(r,l);o.add(c);var f=new e.WebGLRenderer;return L(A,d,f,"f"),f.setPixelRatio(window.devicePixelRatio),f.setSize(a.width,a.height),W(A,p,"f").push(A.handleResize()),{camera:i,renderer:f,scene:o}}),this.handleResize=function(){var e=function(){var e,t=A.container.getBoundingClientRect();null===(e=W(A,d,"f"))||void 0===e||e.setSize(t.width,t.height)};window.addEventListener("resize",e);var t=setInterval(function(){e()},17);return function(){window.removeEventListener("resize",e),clearInterval(t)}},h.set(this,function(e){L(A,l,Math.max(-85,Math.min(85,W(A,l,"f"))),"f");var t=window.THREE.MathUtils.degToRad(90-W(A,l,"f")),n=window.THREE.MathUtils.degToRad(W(A,s,"f"));e.position.x=10*Math.sin(t)*Math.cos(n),e.position.y=10*Math.cos(t),e.position.z=10*Math.sin(t)*Math.sin(n),e.lookAt(0,0,0)}),m.set(this,function(){var t=window.THREE,n=W(A,u,"f").call(A,t,A.videoEl,A.container),a=n.camera,i=n.renderer,o=n.scene;L(A,f,a,"f");var r=i.domElement;A.videoEl.style.cssText+="\n      z-index: -1;\n    ",C.ua.isSafari()&&(A.videoEl.crossOrigin="anonymous"),r.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      overflow: hidden;\n      z-index: 1;\n    ",r.style.width="100%",r.style.height="100%",A.container.appendChild(r),W(A,p,"f").push(W(A,v,"f").call(A,a)),A.container.appendChild(W(A,e,"f")),function e(){i.render(o,a),l=requestAnimationFrame(e)}();var s=W(A,x,"f").call(A,a,A.container),l=0;return function(){s(),cancelAnimationFrame(l),r.remove(),W(A,e,"f").remove()}}),v.set(this,function(t){R.default.operation(R.default.OperationCode.Panorama,{type:"pv"}),W(A,e,"f").style.cssText="\n    position: absolute;\n    opacity: 0.4;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    z-index: 39;\n    outline: none;\n    left: 10px;\n    top: 60px;\n    background-color: #fff;\n    cursor: pointer;\n  ",W(A,e,"f").appendChild(W(A,g,"f").call(A)),W(A,e,"f").appendChild(W(A,M,"f").call(A)),W(A,e,"f").appendChild(W(A,y,"f").call(A)),W(A,e,"f").appendChild(W(A,b,"f").call(A));var n=function(e){e.stopPropagation()};return W(A,e,"f").addEventListener("dblclick",n),W(A,e,"f").onmouseenter=function(){W(A,e,"f").style.opacity="1"},W(A,e,"f").onmouseleave=function(){W(A,e,"f").style.opacity="0.4"},function(){W(A,e,"f").removeEventListener("dblclick",n)}}),w.set(this,function(t){W(A,e,"f").contains(t.target)||(L(A,r,!0,"f"),R.default.operation(R.default.OperationCode.Panorama,{type:"mouse"},{sampleRate:.1}),L(A,n,t.clientX,"f"),L(A,a,t.clientY,"f"),L(A,i,W(A,s,"f"),"f"),L(A,o,W(A,l,"f"),"f"))}),x.set(this,function(t,c){var f=function(c){W(A,e,"f").contains(c.target)||W(A,r,"f")&&(L(A,s,.1*(W(A,n,"f")-c.clientX)+W(A,i,"f"),"f"),L(A,l,.1*(W(A,a,"f")-c.clientY)+W(A,o,"f"),"f"),W(A,h,"f").call(A,t))},p=function(){L(A,r,!1,"f")};return c.addEventListener("pointerdown",W(A,w,"f")),c.addEventListener("pointermove",f),c.addEventListener("pointerup",p),c.addEventListener("mouseleave",p),c.addEventListener("mouseout",p),function(){c.removeEventListener("pointerdown",W(A,w,"f")),c.removeEventListener("pointermove",f),c.removeEventListener("pointerup",p),c.removeEventListener("mouseleave",p),c.removeEventListener("mouseout",p)}}),g.set(this,function(){var e=document.createElement("span");return e.innerHTML=H,e.style.cssText+=S,e.style.cssText+="\n    left: 50%;\n    margin: -4px 0 0 -8px;\n    top: 0;\n    transform: rotate(-90deg);\n  ",W(A,k,"f").call(A,e,"top"),e}),M.set(this,function(){var e=document.createElement("span");return e.innerHTML=H,e.style.cssText+=S,e.style.cssText+="\n    top: 50%;\n    margin: -10px -4px 0 -4px;\n    left: 1px;\n    transform: rotate(-180deg);\n  ",W(A,k,"f").call(A,e,"left"),e}),E.set(this,function(e){if(null!=W(A,f,"f")){switch(W(A,h,"f").call(A,W(A,f,"f")),e){case"top":L(A,l,W(A,l,"f")-1,"f");break;case"left":L(A,s,W(A,s,"f")-1,"f");break;case"bottom":L(A,l,W(A,l,"f")+1,"f");break;case"right":L(A,s,W(A,s,"f")+1,"f")}L(A,c,requestAnimationFrame(function(){W(A,E,"f").call(A,e)}),"f")}}),y.set(this,function(){var e=document.createElement("span");return e.innerHTML=H,e.style.cssText+=S,e.style.cssText+="\n    left: 50%;\n    margin: -7px 0px -5px -10px;\n    bottom: 0px;\n    transform: rotate(90deg);\n  ",W(A,k,"f").call(A,e,"bottom"),e}),b.set(this,function(){var e=document.createElement("span");return e.innerHTML=H,e.style.cssText+=S,e.style.cssText+="\n    top: 50%;\n    margin: -8px -1px 0 0;\n    right: -2px;\n  ",W(A,k,"f").call(A,e,"right"),e}),k.set(this,function(e,t){e.onmousedown=function(){R.default.operation(R.default.OperationCode.Panorama,{type:t},{sampleRate:.1}),W(A,E,"f").call(A,t)},e.onmouseup=W(A,T,"f"),e.onmouseout=W(A,T,"f")}),T.set(this,function(){cancelAnimationFrame(W(A,c,"f"))}),null==window.THREE?(0,C.loadScript)("//s1.hdslb.com/bfs/live-pkg/live-web-player/three-0.141.0.min.js").then(function(){W(A,t,"f")||W(A,p,"f").push(W(A,m,"f").call(A))}).catch(function(e){C.logger.error(e),_()}):W(this,p,"f").push(W(this,m,"f").call(this))}}();exports.Panorama=z,e=new WeakMap,t=new WeakMap,n=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,r=new WeakMap,s=new WeakMap,l=new WeakMap,c=new WeakMap,f=new WeakMap,p=new WeakMap,d=new WeakMap,u=new WeakMap,h=new WeakMap,m=new WeakMap,v=new WeakMap,w=new WeakMap,x=new WeakMap,g=new WeakMap,M=new WeakMap,E=new WeakMap,y=new WeakMap,b=new WeakMap,k=new WeakMap,T=new WeakMap;var _=function(e,t){var n="bili_panorama_roomId_list",a=localStorage.getItem(n);if(!0===(null==a?void 0:a.includes(t)))return null;if(null==a)localStorage.setItem(n,t);else{var i=a.split(",");100===i.length&&(i=i.slice(1)),i.push(t),localStorage.setItem(n,i.join(","))}R.default.operation(R.default.OperationCode.Panorama,{type:"tip"});var o=A();e.appendChild(o);var r=setTimeout(function(){o.remove()},1e4);return function(){o.remove(),clearTimeout(r)}};exports.showPanoramaTip=_;var S="\n  position: absolute;\n  width: 18px;\n  cursor: pointer;\n  transition: fill .3s;\n  vertical-align: middle;\n  display: inline-block;\n  font-size: 0;\n",H='\n<svg viewBox="0 0 14 16" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2.65 11.634a.75.75 0 01-.073-.976l.072-.085L6.185 7.03 2.65 3.483a.75.75 0 01-.071-.977l.072-.084a.75.75 0 01.977-.071l.084.073L7.776 6.5a.75.75 0 01.072.975l-.072.084-4.065 4.074a.75.75 0 01-1.06.001z" fill="#999"></path>\n</svg>\n',A=function(){var e=document.createElement("div");e.style.cssText="\n    position: absolute;\n    z-index: 40;\n    bottom: 40px;\n    right: 194px;\n    cursor: pointer;\n    background-color: #23ADE5;\n    color: white;\n    height: 30px;\n    text-align: center;\n    vertical-align: middle;\n    line-height: 30px;\n    border-radius: 4px;\n    padding: 0 12px 0 12px;\n    font-size: 14px;\n  ";var t=document.createElement("span");return t.style.cssText+="\n    border: 8px solid transparent;\n    border-top-color: #23ADE5;\n    width: 0;\n    position: absolute;\n    height: 0;\n    bottom: -14px;\n    right: 8px;\n  ",e.innerText="快来体验下沉浸式全景直播吧!",e.appendChild(t),e};
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf"}],"pBr6":[function(require,module,exports) {
"use strict";var e,t,r,i,n,o,a,l,s,u,c,f,d,p,h,y,v,g,m,E,P,S,w,T,C,I,_,b,L,V,k=this&&this.__assign||function(){return(k=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},U=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{s(i.next(e))}catch(t){o(t)}}function l(e){try{s(i.throw(e))}catch(t){o(t)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,l)}s((i=i.apply(e,t||[])).next())})},M=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(s){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(a=0)),a;)try{if(r=1,i&&(n=2&l[0]?i.return:l[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,l[1])).done)return n;switch(i=0,n&&(l=[2&l[0],n.value]),l[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,i=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3])){a.label=l[1];break}if(6===l[0]&&a.label<n[1]){a.label=n[1],n=l;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(l);break}n[2]&&a.ops.pop(),a.trys.pop();continue}l=t.call(e,a)}catch(s){l=[6,s],i=0}finally{r=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},N=this&&this.__classPrivateFieldGet||function(e,t,r,i){if("a"===r&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?i:"a"===r?i.call(e):i?i.value:t.get(e)},A=this&&this.__classPrivateFieldSet||function(e,t,r,i,n){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!n)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?n.call(e,r):n?n.value=r:t.set(e,r),r},D=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var i,n=0,o=t.length;n<o;n++)!i&&n in t||(i||(i=Array.prototype.slice.call(t,0,n)),i[n]=t[n]);return e.concat(i||Array.prototype.slice.call(t))},H=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LivePlayer=exports.LivePlayerEvent=exports.isBwpSupported=void 0;var x=require("@bilibili-live/web-player-common"),F=require("@bilibili-live/web-player-video"),Q=H(require("@bilibili-live/web-player-playurl-parser")),B=H(require("../common/controller")),W=H(require("./p2p-adapter")),q=require("../common/utils"),O=require("../common/track-video"),R=H(require("@bilibili-live/web-player-track")),K=H(require("./replay")),j=require("../common/connects"),J=H(require("./sticker")),G=require("./hevc-adapter"),z=require("./live-player-tool"),X=require("./switch-better-line"),Y=require("./retry-strategy"),Z=require("./panorama"),$=require("./hevc-adapter");Object.defineProperty(exports,"isBwpSupported",{enumerable:!0,get:function(){return $.isBwpSupported}});var ee,te=((e={})[x.P2PType.HLS_BILI]=x.P2PType.HLS_NOT_P2P,e[x.P2PType.FLV_QVB]=x.P2PType.NONE,e[x.P2PType.HLS_NOT_P2P]=x.P2PType.HLS_NOT_P2P,e[x.P2PType.NONE]=x.P2PType.NONE,e);!function(e){e.Failed="liveplayer-failed",e.LiveStatusChange="liveplayer-status-change",e.Destroyed="liveplayer-destroyed",e.VideoError="VideoError"}(ee=exports.LivePlayerEvent||(exports.LivePlayerEvent={}));var re=function(){function e(e,D,H){var W,j=this;this.container=e,this.opts=D,this.socket=H,t.set(this,""),r.set(this,""),i.set(this,null),n.set(this,null),this.playUrlParser=null,o.set(this,0),this.replay=null,a.set(this,[]),l.set(this,[]),s.set(this,null),u.set(this,!1),c.set(this,null),f.set(this,null),d.set(this,"Fetch"),p.set(this,void 0),h.set(this,null),y.set(this,function(){}),v.set(this,!1),g.set(this,new x.EventBus),this.on=N(this,g,"f").on,this.once=N(this,g,"f").once,m.set(this,N(this,g,"f").emit),E.set(this,new Set),P.set(this,null),S.set(this,null),w.set(this,function(e){return U(j,void 0,Promise,function(){var t,r,i,a,s=this;return M(this,function(u){switch(u.label){case 0:return A(this,o,e,"f"),this.opts.roomId=e,x.logger.info("live player init roomId: ".concat(e)),null!=this.opts.roomInfo?[3,2]:[4,N(this,I,"f").call(this)];case 1:return u.sent(),[3,3];case 2:if(A(this,n,this.opts.roomInfo,"f"),null==N(this,n,"f").playurl_info.playurl)return N(this,m,"f").call(this,ee.Failed,R.default.ErrorCode.PlayUrlNull),x.logger.error("playUrlInfo.playurl is null"),[2];this.playUrlParser=ce(N(this,n,"f").playurl_info,{userId:this.opts.userId,ownerId:N(this,n,"f").uid,isMobile:null!==(t=this.opts.isMobile)&&void 0!==t&&t}),u.label=3;case 3:return this.reload(),null!=(null===(r=N(this,n,"f"))||void 0===r?void 0:r.live_time)&&N(this,l,"f").push(ne(N(this,n,"f").live_time,this.ctrl.getCtrlUI())),null!=N(this,n,"f")&&!0!==this.opts.isMobile&&this.opts.enableCtrlUI&&(this.replay=new K.default(this.container,{live_time:null===(i=N(this,n,"f"))||void 0===i?void 0:i.live_time,rid:null===(a=N(this,n,"f"))||void 0===a?void 0:a.room_id},this.socket,this.ctrl),this.replay.on("timeShiftChange",function(e){s.tmShiftHandler(e),s.reload(),e>0&&A(s,S,null,"f")}),this.enableReplay()&&this.replay.init()),[2]}})})}),this.tmShiftHandler=function(e){var t,r,i,n=j.playUrlParser;if(null!=j.replay&&null!=n){var o=n.getCurP2PType(),a=n.getCurStreamInfo().protocol,l=x.ProtocolType.HTTP_HLS,s=x.P2PType.HLS_NOT_P2P,u=n.getCurStreamInfo().timeshift;0!==e?(0===u&&(j.replay.bakState={p2pType:o,protocol:a}),(null!==(t=j.replay.bakState.p2pType)&&void 0!==t?t:o)>0&&(n.setCurP2PType(x.P2PType.HLS_BILI),s=x.P2PType.HLS_BILI)):(s=null!==(r=j.replay.bakState.p2pType)&&void 0!==r?r:o,n.setCurP2PType(s),l=null!==(i=j.replay.bakState.protocol)&&void 0!==i?i:a,j.replay.bakState={}),n.setTimeShift(e),n.useStream({protocol:l,expectP2PType:s})}},T.set(this,function(e){var t,r,i=null!==(r=null===(t=j.playUrlParser)||void 0===t?void 0:t.getLineCandidates().length)&&void 0!==r?r:0,n=new X.SwitchBetterLine(e.getVideoEl(),{lineNum:i}),o=e.on(F.EventType.WaitStart,function(){var t,r,i;if(!0!==(null===(t=j.replay)||void 0===t?void 0:t.isReplay)&&n.getNeedSwitchLine()){var o=performance.now(),a=navigator.connection;j.switchLine(X.SwitchBetterLine.switchNum,!1),R.default.custom(R.default.CustomCode.SwitchLine,{switchNum:X.SwitchBetterLine.switchNum,videoCurrentTime:e.getVideoEl().currentTime,interval:Math.floor((o-X.SwitchBetterLine.lastSwitchTime)/1e3),downlink:null!==(r=null==a?void 0:a.downlink)&&void 0!==r?r:-1,rtt:null!==(i=null==a?void 0:a.rtt)&&void 0!==i?i:-1}),x.logger.warn("waiting auto switch line to ".concat(X.SwitchBetterLine.switchNum))}});N(j,a,"f").push(n.destroy),N(j,a,"f").push(o)}),C.set(this,function(){N(j,a,"f").forEach(function(e){return e()}),A(j,a,[],"f")}),I.set(this,(0,q.retry)(function(e){return U(j,void 0,Promise,function(){var t,r,i,a,l,s,u,f,d,p,h,y,v,g,E,P,S;return M(this,function(w){switch(w.label){case 0:return t=this.playUrlParser,r=null!==(p=null===(d=null==t?void 0:t.getQualityDesc(t.getCurQuality()))||void 0===d?void 0:d.code)&&void 0!==p?p:0,null!=e&&(r=e),(0,q.loadingOrCoverImg)(this.container,N(this,c,"f")),i=null!==(y=null===(h=this.playUrlParser)||void 0===h?void 0:h.getCurLine())&&void 0!==y?y:0,a=(null!==(g=null===(v=this.playUrlParser)||void 0===v?void 0:v.getCurStreamInfo())&&void 0!==g?g:{}).timeshift,x.logger.info("updateRoomInfo quality: ".concat(r,", line: ").concat(i)),[4,this.opts.roomInfoProvider({roomId:N(this,o,"f"),qn:r,isMobile:null!==(E=this.opts.isMobile)&&void 0!==E&&E})];case 1:return l=w.sent(),s=l.code,u=l.data,f=l.message,s===x.ApiErrorCode.AreaBlock?(N(this,m,"f").call(this,ee.Failed,x.ApiErrorCode.AreaBlock,f),[2]):1!==u.live_status?((0,x.unloading)(),N(this,m,"f").call(this,ee.LiveStatusChange,u.live_status),[2]):null==u.playurl_info?((0,x.unloading)(),this.playUrlParser=null,x.logger.info("playUrlInfo is null"),[2]):(A(this,n,u,"f"),x.logger.debug("room info: ".concat(JSON.stringify(u))),null==u.playurl_info.playurl?(N(this,m,"f").call(this,ee.Failed,R.default.ErrorCode.PlayUrlNull),x.logger.error("playUrlInfo.playurl is null"),[2]):(this.playUrlParser=ce(N(this,n,"f").playurl_info,{userId:this.opts.userId,ownerId:u.uid,isMobile:null!==(P=this.opts.isMobile)&&void 0!==P&&P}),null===(S=this.playUrlParser)||void 0===S||S.setCurLine(i),this.tmShiftHandler(null!=a?a:0),[2]))}})})},[0,1,3,5,10,20,30,60,90,120].map(function(e){return 1e3*e}))),_.set(this,function(e,n){e.once(F.EventType.FirstFrame,function(){var o,l,c=null;if(N(j,a,"f").push(function(){null==c||c.remove()}),N(j,E,"f").forEach(function(t){t!==e&&(t.destroy(),N(j,E,"f").delete(t))}),A(j,t,(0,x.uuid)(),"f"),A(j,r,n,"f"),N(j,u,"f"))e.destroy();else{null===(o=N(j,i,"f"))||void 0===o||o.removeVideoEl();var f=e.getVideoEl();j.container.appendChild(f),A(j,i,e,"f"),!0!==j.opts.isMobile&&(c=(0,F.checkVideoRate)(e.getVideoEl())),null===(l=N(j,s,"f"))||void 0===l||l.success(),N(j,y,"f").call(j),A(j,y,ae(e,N(j,h,"f")),"f")}})}),b.set(this,function(e){var t,r,i,n,o=(0,q.maxRetryChecker)(e);e.once(F.EventType.Ended,function(){return U(j,void 0,void 0,function(){return M(this,function(t){return e.destroy(),o()?(l().catch(x.logger.error),[2]):(x.logger.error("retry over 1 min"),N(this,m,"f").call(this,ee.Failed,R.default.ErrorCode.RetryMaxTime),[2])})})}),e.once(F.EventType.Error,function(t){return U(j,void 0,void 0,function(){var r,i,n;return M(this,function(a){return N(this,m,"f").call(this,ee.VideoError,t),e.destroy(),x.logger.error(t),o()?(r=(0,q.loadingOrCoverImg)(this.container,N(this,c,"f")),!0===(null===(i=this.replay)||void 0===i?void 0:i.isReplay)?[2]:(Q.default.Support_HEVC_No_Err&&t.code===R.default.ErrorCode.NativeVideoError?[3,4].includes(t.errInfo.code):t.code===R.default.ErrorCode.ErrorMseOpen&&/NotSupportedError.+hvc1/.test(t.errInfo.info))?(Q.default.Support_HEVC_No_Err=!1,null===(n=this.playUrlParser)||void 0===n||n.useStream({codec:x.CodecType.AVC}),this.reload(),[2]):(l().then(r).catch(function(e){x.logger.error(e),r()}),[2])):(N(this,m,"f").call(this,ee.Failed,R.default.ErrorCode.RetryMaxTime),[2])})})}),x.logger.debug("max retry times：".concat(null!==(r=null===(t=j.playUrlParser)||void 0===t?void 0:t.getPlayUrlCandates().length)&&void 0!==r?r:0));var a=Math.min(null!==(n=null===(i=j.playUrlParser)||void 0===i?void 0:i.getPlayUrlCandates().length)&&void 0!==n?n:0,4),l=function(){return U(j,void 0,Promise,function(){var e,t,r,i;return M(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,7]),[4,(0,q.backoffById)(this.playUrlParser,a)];case 1:if(e=n.sent(),null!=this.playUrlParser)if((t=(0,Y.useRetryStrategy)(this.playUrlParser,e,a))===Y.RetryStrategies.SwitchLine)N(this,m,"f").call(this,x.ExternalEventType.SwitchLine,this.playUrlParser.getCurLine());else if(t===Y.RetryStrategies.Failed)throw new Error("not supported hls protocol stream");return[3,7];case 2:r=n.sent(),x.logger.error(r),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,N(this,I,"f").call(this)];case 4:return n.sent(),[3,6];case 5:throw i=n.sent(),N(this,m,"f").call(this,ee.Failed,R.default.ErrorCode.RoomP0ApiFetchError),this.destroy(),i;case 6:return[3,7];case 7:return this.reload(),[2]}})})}}),L.set(this,function(e){var t=(0,x.seiKeyComparator)(x.SEIType.LIVE_SEI_CHANNEL),r=(0,x.seiKeyComparator)(x.SEIType.B_LIVE_VIBRATION),i=(0,x.seiKeyComparator)(x.SEIType.LIVE_SEI_PC_LINK),n=(0,x.seiKeyComparator)(x.SEIType.BVC_KUAWAN____TS),o=(0,x.seiKeyComparator)(x.SEIType.BVCLIVESTREAMHOP),a=(0,x.seiKeyComparator)(x.SEIType.BILILIVESUBTITLE),l=(0,x.seiKeyComparator)(x.SEIType.BVC__CANVAS_DATA);return e.once(F.EventType.Destroyed,function(){N(j,m,"f").call(j,F.EventType.Destroyed)}),[x.EventBus.forwardEvent(e,N(j,g,"f"),[F.EventType.Play,F.EventType.Pause,F.EventType.LoadStart,F.EventType.MetaData,F.EventType.FirstFrame,F.EventType.WaitStart,F.EventType.WaitEnd,F.EventType.NotAutoPlay,F.EventType.MutePlay,F.EventType.CorePlayerCreated]),e.on(F.EventType.VideoInfo,function(e){var t,r;N(j,m,"f").call(j,F.EventType.VideoInfo,{mediaInfo:k(k({},e.mediaInfo),{corePlayerType:"".concat(null!==(r=null===(t=e.mediaInfo)||void 0===t?void 0:t.corePlayerType)&&void 0!==r?r:""," (").concat(N(j,d,"f"),")")}),realtimeInfo:k(k({},e.realtimeInfo),{latency:N(j,S,"f")})})}),e.on(F.EventType.SEIData,function(){for(var e=[],s=0;s<arguments.length;s++)e[s]=arguments[s];t(e[2])?N(j,m,"f").call(j,x.ExternalEventType.SEIParseData,x.SEIType.LIVE_SEI_CHANNEL,(0,x.uint8ArrayToString)(e[3])):r(e[2])?N(j,m,"f").call(j,x.ExternalEventType.SEIParseData,x.SEIType.B_LIVE_VIBRATION,e[1],e[3]):i(e[2])?N(j,m,"f").call(j,x.ExternalEventType.SEIParseData,x.SEIType.LIVE_SEI_PC_LINK,(0,x.uint8ArrayToString)(e[3])):n(e[2])?N(j,m,"f").call(j,x.ExternalEventType.SEIParseData,x.SEIType.BVC_KUAWAN____TS,(0,x.uint8ArrayToString)(e[3])):o(e[2])?N(j,V,"f").call(j,e):a(e[2])?N(j,m,"f").call(j,x.ExternalEventType.SEIParseData,x.SEIType.BILILIVESUBTITLE,e[1],(0,x.uint8ArrayToString)(e[3])):l(e[2])?N(j,m,"f").call(j,x.ExternalEventType.SEIParseData,x.SEIType.BVC__CANVAS_DATA,e[1],(0,x.uint8ArrayToString)(e[3])):N(j,m,"f").call(j,F.EventType.SEIData,e)}),e.once(F.EventType.WASMDecoderDegrade,function(){var e=j.playUrlParser;if(null!=e){var t=e.getQualityDesc();if((null==t?void 0:t.codec)===x.CodecType.HEVC){var r=(0,z.getHEVCDowngradeQn)(t,e.getAVCQnCandidates());j.switchQuality(r,"CPU负载较高，")}}})]}),this.play=function(){var e;null===(e=N(j,i,"f"))||void 0===e||e.play().catch(function(){})},this.pause=function(){var e;null===(e=N(j,i,"f"))||void 0===e||e.pause()},this.volume=function(e){var t;null===(t=N(j,i,"f"))||void 0===t||t.volume(e)},this.switchAudioTrack=function(e){var t,r;return null!==(r=null===(t=N(j,i,"f"))||void 0===t?void 0:t.switchAudioTrack(e))&&void 0!==r?r:-1},this.getAudioTracks=function(){var e;return null===(e=N(j,i,"f"))||void 0===e?void 0:e.getAudioTracks()},this.mute=function(e){var t;null===(t=N(j,i,"f"))||void 0===t||t.mute(e)},this.enableReplay=function(){return null!=N(j,n,"f")&&null!=j.playUrlParser&&!(!N(j,n,"f").all_special_types.includes(19)||!j.playUrlParser.hasHLSPlayerSupportStream())},V.set(this,function(e){var t,r,n;if(!document.hidden&&!0!==(null===(t=j.replay)||void 0===t?void 0:t.isReplay)){var o=null===(r=N(j,i,"f"))||void 0===r?void 0:r.getVideoEl();if(null!=o&&!o.paused){var a=[];try{a=JSON.parse((0,x.uint8ArrayToString)(e[3]))}catch(p){return void x.logger.error("bvc latency sei解析失败")}var l=j.playUrlParser,s=null!==(n=null==l?void 0:l.getCurStreamInfo())&&void 0!==n?n:{},u=s.format,c=s.p2pType,f=e[1],d=Math.round(1e3*(f-o.currentTime)+Date.now());a.length>0&&A(j,S,d-a[0].curr_ms,"f"),de(a.concat({curr_ms:d,author:"web_player",author_ver:"v".concat("3.7.2"),buffer_ms:Math.round(1e3*(0,x.remainBufferLength)(o)),protocol:null!=c&&c===x.P2PType.HLS_BILI?"webrtc":"http",muxer:u})),pe(function(){A(j,S,null,"f")})}}}),!0!==D.isMobile&&(e.style.overflow="hidden"),this.ctrl=new B.default(e,{userId:D.userId,isMobile:null!==(W=this.opts.isMobile)&&void 0!==W&&W,enableCtrlUI:D.enableCtrlUI}),N(this,l,"f").push(ie(this.ctrl,this,function(){N(j,m,"f").call(j,x.ExternalEventType.Reload)})),A(this,p,(0,O.createVideoTracker)(),"f"),N(this,w,"f").call(this,this.opts.roomId).catch(function(e){x.logger.error(e),R.default.error(R.default.ErrorCode.RoomEnterLiveError,e)})}return e.prototype.reload=function(){var e,t,r,i=this;if(!N(this,u,"f")){x.logger.info("live player load roomId: ".concat(N(this,o,"f")));var l=N(this,o,"f");if(null!=N(this,n,"f")&&0!==l&&null!=this.playUrlParser){var s,h=this.playUrlParser;null==N(this,f,"f")&&A(this,f,h.getCurQuality(),"f");try{s=h.getCurPlayUrl()}catch(w){return x.logger.error(w),void N(this,I,"f").call(this).then(function(){i.reload()}).catch(function(e){x.logger.error(e)})}if(!N(this,u,"f")){var y=h.getCurStreamInfo();R.default.updateDynamicInfo({p2pType:y.p2pType,sHost:y.host,sQuery:y.query,sProtocol:y.protocol,sCodec:y.codec,sName:y.name,quality:y.quality,sFormat:null!==(r=y.format)&&void 0!==r?r:"",line:this.playUrlParser.getCurLine()},!0);var g=R.default.fixedDynamicFieldsVerIns();x.logger.info("current stream info: ".concat(JSON.stringify(y))),N(this,C,"f").call(this);var m=new F.Video(s,{wasmDecode:h.getCurCodecType()===x.CodecType.HEVC&&!(0,x.isHardSupportHEVC)()&&(0,G.isWASMSupportHEVC)(),forceNativePlayer:"panorama"===h.getCurStreamInfo().curAttrName||navigator.userAgent.includes("PlayStation")});y.codec===x.CodecType.HEVC&&g.updateDynamicInfo({videoTag:m.getVideoEl().tagName}),(e=N(this,a,"f")).push.apply(e,fe(this.playUrlParser,this.container,l.toString(),m.getVideoEl(),this.ctrl)),N(this,E,"f").add(m),se(this.ctrl.getCtrlUI(),h,x.wpd.SupportHEVC||(0,x.isHardSupportHEVC)()||N(this,v,"f")),N(this,T,"f").call(this,m),ue(m,this,this.container),N(this,_,"f").call(this,m,s),N(this,b,"f").call(this,m),N(this,p,"f").call(this,m),(t=N(this,a,"f")).push.apply(t,D([(0,j.connectUIandVideo)(this.ctrl,m),oe(m),(0,j.connectVideoLoading)(m,this.container,N(this,c,"f")),(0,j.connectVideoPip)(m,this.ctrl),(0,j.connectMirror)(m,this.ctrl)],N(this,L,"f").call(this,m),!1));var S=h.getCurP2PType();(0,W.default)({video:m,type:S,roomId:l,interval:h.getDynamicConfig().report_interval_sec}).then(function(e){var t;null!=e&&(A(i,P,e,"f"),N(i,p,"f").setP2PInstance(m,e),N(i,a,"f").push(function(){A(i,P,null,"f")})),A(i,d,(t={},t[x.P2PType.HLS_BILI]="SistersFetcher",t[x.P2PType.FLV_QVB]="QVBFetcher",t[x.P2PType.HLS_NOT_P2P]="Fetch",t[x.P2PType.NONE]="Fetch",t)[S],"f")}).catch(function(e){var t;A(i,d,"Fetch","f"),h.setCurP2PType(te[S]),g.updateDynamicInfo({p2pType:te[S]}),x.logger.error(e),null===(t=N(i,P,"f"))||void 0===t||t.destroy(),A(i,P,null,"f")})}}}},e.prototype.setTitlePageImg=function(e){A(this,c,e,"f")},e.prototype.setAutoSyncCfg=function(e){/chrome\/91/g.test(navigator.userAgent.toLowerCase())||(A(this,h,e,"f"),null!=N(this,i,"f")&&(N(this,y,"f").call(this),A(this,y,ae(N(this,i,"f"),e),"f")))},e.prototype.getPlayerInfo=function(){var e,n,o,a,l,s,u,c;return{guid:N(this,t,"f"),playingStatus:!(null===(n=null===(e=N(this,i,"f"))||void 0===e?void 0:e.getVideoEl().paused)||void 0===n||n),playSrc:N(this,r,"f"),quality:null!==(a=null===(o=this.playUrlParser)||void 0===o?void 0:o.getCurQuality())&&void 0!==a?a:"",qualityCandidates:null!==(s=null===(l=this.playUrlParser)||void 0===l?void 0:l.getQnCandidates())&&void 0!==s?s:[],timeShift:null!==(c=null===(u=this.playUrlParser)||void 0===u?void 0:u.getTimeShift())&&void 0!==c?c:0}},e.prototype.getVideoEl=function(){var e;return null===(e=N(this,i,"f"))||void 0===e?void 0:e.getVideoEl()},e.prototype.getP2PTransport=function(){var e,t;return{downloadExtraFile:null===(e=N(this,P,"f"))||void 0===e?void 0:e.downloadExtraFile.bind(N(this,P,"f")),shareExtraFile:null===(t=N(this,P,"f"))||void 0===t?void 0:t.shareExtraFile.bind(N(this,P,"f"))}},e.prototype.blockStream=function(){var e=this;(0,q.blockStream)(N(this,i,"f"),function(){N(e,m,"f").call(e,F.EventType.Play)})},e.prototype.discardFrame=function(e){var t,r=null===(t=N(this,i,"f"))||void 0===t?void 0:t.getVideoEl();null!=r&&(r.currentTime+=e)},e.prototype.remainBufferLength=function(){var e,t=null===(e=N(this,i,"f"))||void 0===e?void 0:e.getVideoEl();return null==t?0:(0,x.remainBufferLength)(t)},e.prototype.showHEVCQuality=function(e){var t=this;if(!(0,x.isHardSupportHEVC)()){var r=this.playUrlParser;if(null!=r)if(e)(0,G.loadWASMDecoder)().then(function(){null!=t.playUrlParser&&(A(t,v,!0,"f"),se(t.ctrl.getCtrlUI(),t.playUrlParser,N(t,v,"f")||x.wpd.SupportHEVC||(0,x.isHardSupportHEVC)()))}).catch(function(e){x.logger.error(e)});else{A(this,v,!1,"f");var i=r.getQualityDesc();if((null==i?void 0:i.codec)!==x.CodecType.HEVC)return void se(this.ctrl.getCtrlUI(),r,!1);var n=(0,z.getHEVCDowngradeQn)(i,r.getAVCQnCandidates());this.switchQuality(n)}}},e.prototype.destroy=function(e){var t,r;x.logger.info("live player destroy, holdLastFrame: ".concat(String(e))),null===(t=N(this,i,"f"))||void 0===t||t.destroy(e),N(this,u,"f")||(A(this,u,!0,"f"),N(this,m,"f").call(this,ee.Destroyed),null===(r=this.replay)||void 0===r||r.destroy(),N(this,C,"f").call(this),this.ctrl.destroy(),N(this,g,"f").destroy(),N(this,l,"f").forEach(function(e){return e()}),A(this,l,[],"f"))},e.prototype.switchQuality=function(e,t){var r,i,n=this;void 0===t&&(t=""),x.logger.info("switchQuality to ".concat(e));var o=this.playUrlParser;if(null!=o){var a=o.getCurStreamInfo().host,l=o.getQualityDesc(e),u=o.getCurQuality(),c=o.getQualityDesc(u),d=o.getQualityDesc(null!==(r=N(this,f,"f"))&&void 0!==r?r:"0");if(null!=l&&null!=d&&null!=c){if(0===Number((0,x.getCookie)("DedeUserID"))&&l.code>d.code)return x.logger.warn("user not login, reject switch quality"),N(this,m,"f").call(this,x.ExternalEventType.SwitchQualityNotLogin,{newQn:{qn:e,text:l.label},oldQn:{qn:c.value,text:c.label}}),!1;if((0,x.toast)("".concat(t,"清晰度即将切换至").concat(l.label),this.container),A(this,s,{success:function(){(0,x.toast)("".concat(t,"清晰度已经切换至").concat(l.label),n.container),A(n,s,null,"f"),N(n,m,"f").call(n,x.ExternalEventType.SwitchQuality,e,c.value,o.getQnCandidates().map(function(e){var t=e.label;return{qn:e.value,desc:t}}))}},"f"),c.code===l.code)return null===(i=this.playUrlParser)||void 0===i||i.useStream({codec:l.codec}),void this.reload();N(this,I,"f").call(this,l.code).then(function(){var t,r,i=l.code===x.EQuality.Dolby?x.ProtocolType.HTTP_HLS:void 0;null===(t=n.playUrlParser)||void 0===t||t.useStream({codec:l.codec,protocol:i}),n.reload();var o=null===(r=n.playUrlParser)||void 0===r?void 0:r.getCurStreamInfo().host;R.default.operation(R.default.OperationCode.SwitchQuality,{fromQuality:u,toQuality:e,fromHost:a,toHost:o})}).catch(function(e){x.logger.error(e)})}else x.logger.error("switchQuality: quality parser error. ".concat(JSON.stringify({targetQnDesc:l,curQnDesc:c,defQnDesc:d})))}},e.prototype.switchLine=function(e,t){var r,i,n,o=this;void 0===t&&(t=!0);var a=this.playUrlParser;if(null!=a){var l=a.getCurStreamInfo().host;t&&(0,x.toast)("线路即将切换至".concat(null!==(i=null===(r=a.getLineCandidates().find(function(t){return t.value===e}))||void 0===r?void 0:r.label)&&void 0!==i?i:""),this.container),A(this,s,{success:function(){t&&(0,x.toast)("线路已经切换至".concat(a.getCurLineDesc().label),o.container),A(o,s,null,"f"),N(o,m,"f").call(o,x.ExternalEventType.SwitchLine,e)}},"f"),null===(n=this.playUrlParser)||void 0===n||n.setCurLine(e);var u=a.getCurStreamInfo().host;R.default.operation(R.default.OperationCode.SwitchLine,{line:e,fromHost:l,toHost:u}),this.reload()}},e.prototype.capturePic=function(e,t){var r,n;return null!==(n=null===(r=N(this,i,"f"))||void 0===r?void 0:r.capturePic(e,t))&&void 0!==n?n:null},e}();function ie(e,t,r){var i=this,n=!1,o=e.onRefresh(function(){var e,i;t.once(F.EventType.FirstFrame,function(){n&&((0,x.toast)("刷新成功",t.container),n=!1)}),(0,x.toast)("正在刷新",t.container),n=!0,!0===(null===(e=t.replay)||void 0===e?void 0:e.isReplay)&&(null===(i=t.replay)||void 0===i||i.returnLive()),t.tmShiftHandler(0),t.reload(),r(),R.default.operation(R.default.OperationCode.Refresh)}),a=e.onChange(function(e,r){return U(i,void 0,void 0,function(){return M(this,function(i){return"quality"===e?t.switchQuality(r):"line"===e&&t.switchLine(r),le(e,r),[2]})})});return function(){o(),a()}}function ne(e,t){var r=Date.now()/1e3-e-performance.now()/1e3,i=window.setInterval(function(){t.time={value:(0,x.formatTime)(performance.now()/1e3+r),tips:"直播持续时间"}},1e3);return function(){clearInterval(i)}}function oe(e){var t=[],r=e.getVideoEl(),i=0;return x.logger.info("start monitor buffer length"),e.on(F.EventType.VideoInfo,function(e){var n=e.realtimeInfo;if(!r.paused){var o=n.videoBufferLength;(o>10||i===r.currentTime&&o>5)&&(r.currentTime+=o/2,x.logger.warn("auto discard frame, current time: ".concat(r.currentTime)),t.length<3&&((t=t.filter(function(e){return performance.now()-e<5e3})).push(performance.now()),3===t.length&&R.default.custom(R.default.CustomCode.AutoDiscardFrame,null,{extFields:"all"}))),i=r.currentTime}})}function ae(e,t){if(null===t)return function(){};if(!x.ua.isChrome()&&!x.ua.isEdg())return function(){};var r=t.auto_sync_enable,i=t.auto_sync_high_speed,n=t.auto_sync_low_speed,o=t.auto_sync_max_threshold,a=t.auto_sync_min_threshold;return 1!==r?function(){}:(x.logger.info("live player start auto sync video progress"),e.on(F.EventType.VideoInfo,function(t){var r=1e3*t.realtimeInfo.videoBufferLength;if(!(r<0||isNaN(r))){var l=e.getVideoEl(),s=1;r<a?s=n:r>o&&(s=i),(s<=0||s>2)&&(s=1),s!==l.playbackRate&&(l.playbackRate=s)}}))}function le(e,t){"danmaku"===e?R.default.operation(R.default.OperationCode.Danmaku,k({},t)):"volume"===e?!0===t.disabled?R.default.operation(R.default.OperationCode.Mute):R.default.operation(R.default.OperationCode.Volume,{value:t.value}):"playStatus"===e?!0===t?R.default.operation(R.default.OperationCode.Play):R.default.operation(R.default.OperationCode.Pause):"fullScreenStatus"===e?R.default.operation(R.default.OperationCode.FullScreen,{value:t}):"webFullScreenStatus"===e&&R.default.operation(R.default.OperationCode.WebFullScreen,{value:t})}function se(e,t,r){var i,n,o,a={list:null!==(i=t.getLineCandidates())&&void 0!==i?i:[],value:null!==(n=t.getCurLine())&&void 0!==n?n:0};e.line=a;var l=t.getQnCandidates();r||(l=t.getAVCQnCandidates());var s={list:l,value:null!==(o=t.getCurQuality())&&void 0!==o?o:"0"};e.quality=s}function ue(e,t,r){x.logger.debug("listen sticker SEI");var i=null,n=!1,o=t.on(x.ExternalEventType.SEIParseData,function(e,t){e===x.SEIType.LIVE_SEI_CHANNEL&&(n||(n=!0,i=new J.default(r)),null==i||i.onSei(t))}),a=e.on(F.EventType.MetaData,function(e){n&&(x.logger.info("destroy sticker when metadata"),null==i||i.destroy(),n=!1)}),l=0,s=t.ctrl.onChange(function(e,t){"webFullScreenStatus"!==e&&"fullScreenStatus"!==e||(clearTimeout(l),l=window.setTimeout(function(){null==i||i.calcDisplayInfo(),null==i||i.batchUpdateStickerElement()},"webFullScreenStatus"===e?10:300))}),u=e.on(F.EventType.VideoInfo,function(e){null==i||i.onVideoInfo({width:e.mediaInfo.width,height:e.mediaInfo.height})});t.once(ee.Destroyed,f),e.once(F.EventType.Destroyed,f);var c=!1;function f(){c||(c=!0,x.logger.info("destroy sticker..."),clearTimeout(l),null==i||i.destroy(),s(),o(),a(),u())}}function ce(e,t){var r=t.userId,i=t.ownerId,n=t.isMobile,o=new Q.default(e);return(r===i||n)&&o.setCurP2PType(te[o.getCurP2PType()]),o}exports.LivePlayer=re,t=new WeakMap,r=new WeakMap,i=new WeakMap,n=new WeakMap,o=new WeakMap,a=new WeakMap,l=new WeakMap,s=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,d=new WeakMap,p=new WeakMap,h=new WeakMap,y=new WeakMap,v=new WeakMap,g=new WeakMap,m=new WeakMap,E=new WeakMap,P=new WeakMap,S=new WeakMap,w=new WeakMap,T=new WeakMap,C=new WeakMap,I=new WeakMap,_=new WeakMap,b=new WeakMap,L=new WeakMap,V=new WeakMap;var fe=function(e,t,r,i,n){var o=[];if(e.getCurStreamInfo().qualityDesc.some(function(e){var t;return!0===(null===(t=e.attr_desc)||void 0===t?void 0:t.some(function(e){return"panorama"===e.attr_name}))})){var a=(0,Z.showPanoramaTip)(t,r);if(null!=a){n.show();var l=setTimeout(function(){n.hide()},1e4);o.push(a,function(){clearTimeout(l)});var s=n.onChange(function(e,t){"qualityPanelShow"===e&&!0===t&&(a(),s(),clearTimeout(l))})}}if("panorama"===e.getCurStreamInfo().curAttrName){var u=new Z.Panorama(t,i,function(){(0,x.toast)("资源加载失败，无法进行全景交互",t)});o.push(u.destroy)}return o},de=(0,x.throttle)(function(e){R.default.custom(R.default.CustomCode.SEILatency,{sei_latency:e},{extFields:["p2pType","sHost","sProtocol","sCodec","quality","sName"],sampleRate:.01})},6e4),pe=(0,x.debounce)(function(e){return e()},6e4);
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-playurl-parser":"uCDP","../common/controller":"as8u","./p2p-adapter":"A6uK","../common/utils":"KY4m","../common/track-video":"rPou","@bilibili-live/web-player-track":"ESUf","./replay":"xqO8","../common/connects":"blC7","./sticker":"fyPa","./hevc-adapter":"lCVI","./live-player-tool":"yABZ","./switch-better-line":"H7b7","./retry-strategy":"z0Gg","./panorama":"XBQm"}],"pl2j":[function(require,module,exports) {
"use strict";var e,t,n,i,r,o,a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function a(e){try{l(i.next(e))}catch(t){o(t)}}function s(e){try{l(i.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((i=i.apply(e,t||[])).next())})},s=this&&this.__generator||function(e,t){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(l){s=[6,l],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},l=this&&this.__classPrivateFieldSet||function(e,t,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(e,n):r?r.value=n:t.set(e,n),n},u=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},c=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DashPlayer=exports.VideoStatus=void 0;var f,d=require("@bilibili-live/web-player-common"),h=require("@bilibili-live/web-player-video");!function(e){e.Initialize="Initialize",e.Loading="Loading",e.Playing="Playing",e.Pause="Pause",e.Destroyed="Destroyed"}(f=exports.VideoStatus||(exports.VideoStatus={}));var y=function(){function y(){var y=this;e.set(this,f.Destroyed),t.set(this,null),n.set(this,void 0),i.set(this,new d.EventBus),r.set(this,void 0),this.on=u(this,i,"f").on,this.once=u(this,i,"f").once,this.emit=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];[h.EventType.VideoInfo].includes(e)||u(y,r,"f").debug("video emit: ".concat(e,", handlers count: ").concat(u(y,i,"f").getHandlers(e).size)),(t=u(y,i,"f")).emit.apply(t,c([e],n,!1))},this.init=function(e,i){return void 0===i&&(i=0),a(y,void 0,Promise,function(){var r=this;return s(this,function(a){switch(a.label){case 0:return null!=window.BLWLitePlayer?[3,2]:[4,(0,d.loadScript)("https://activity.hdslb.com/blackboard/static/20230331/3d1800776659bb31c053477bad97dc6e/40BlqHHKgR.js")];case 1:a.sent(),a.label=2;case 2:return l(this,t,new window.BLWLitePlayer(u(this,n,"f")),"f"),[4,u(this,t,"f").init({type:window.BLWLitePlayer.TYPES.DASH,url:e,enableHEVC:!0,enableAV1:!0,defaultVideoQuality:i}).catch(function(){r.emit(h.EventType.Error)})];case 3:return a.sent(),u(this,o,"f").call(this),[2]}})})},this.play=function(){return a(y,void 0,Promise,function(){return s(this,function(t){switch(t.label){case 0:if(u(this,r,"f").info("video play"),null==u(this,n,"f"))return[2];if(u(this,e,"f")===f.Playing)return[2];t.label=1;case 1:return t.trys.push([1,3,,8]),[4,u(this,n,"f").play()];case 2:return t.sent(),l(this,e,f.Playing,"f"),[3,8];case 3:if("NotAllowedError"!==t.sent().name)return[2];u(this,r,"f").warn("try mute play"),u(this,n,"f").muted=!0,t.label=4;case 4:return t.trys.push([4,6,,7]),[4,u(this,n,"f").play()];case 5:return t.sent(),l(this,e,f.Playing,"f"),this.emit(h.EventType.MutePlay),[3,7];case 6:return t.sent(),u(this,r,"f").warn("can't auto play"),l(this,e,f.Pause,"f"),this.emit(h.EventType.NotAutoPlay),[3,7];case 7:return[3,8];case 8:return[2]}})})},this.pause=function(){u(y,r,"f").info("video pause"),null!=u(y,n,"f")&&u(y,e,"f")===f.Playing&&(u(y,n,"f").pause(),l(y,e,f.Pause,"f"))},this.volume=function(e){u(y,r,"f").info("video setVolume(".concat(e,")")),null!=u(y,n,"f")&&(u(y,n,"f").volume=(0,d.roundNumber)(e,2))},this.mute=function(e){u(y,n,"f").muted=e},this.seek=function(e){return a(y,void 0,Promise,function(){var n;return s(this,function(i){return null===(n=u(this,t,"f"))||void 0===n||n.seek(e).catch(function(e){return console.error(e)}),[2]})})},o.set(this,function(){var n,i,o,a,s,c,d,p,v;null===(n=u(y,t,"f"))||void 0===n||n.on(window.BLWLitePlayer.EVENTS.PLAYING,function(){y.emit(h.EventType.Play)}),null===(i=u(y,t,"f"))||void 0===i||i.on(window.BLWLitePlayer.EVENTS.PAUSE,function(){y.emit(h.EventType.Pause)}),null===(o=u(y,t,"f"))||void 0===o||o.on(window.BLWLitePlayer.EVENTS.REBUFFERING,function(){y.emit(h.EventType.WaitStart)}),null===(a=u(y,t,"f"))||void 0===a||a.on(window.BLWLitePlayer.EVENTS.REBUFFERING_END,function(){y.emit(h.EventType.WaitEnd)}),null===(s=u(y,t,"f"))||void 0===s||s.on(window.BLWLitePlayer.EVENTS.INITIALIZED,function(){l(y,e,f.Initialize,"f"),y.emit(h.EventType.LoadStart)}),null===(c=u(y,t,"f"))||void 0===c||c.on(window.BLWLitePlayer.EVENTS.CANPLAY,function(){y.emit(h.EventType.FirstFrame)}),null===(d=u(y,t,"f"))||void 0===d||d.on(window.BLWLitePlayer.EVENTS.ENDED,function(){y.emit(h.EventType.Ended)}),null===(p=u(y,t,"f"))||void 0===p||p.on(window.BLWLitePlayer.EVENTS.ERROR,function(){y.emit(h.EventType.Error)}),null===(v=u(y,t,"f"))||void 0===v||v.on(window.BLWLitePlayer.EVENTS.CANPLAY,function(){y.play().catch(function(e){return u(y,r,"f").warn(e)})})}),l(this,e,f.Loading,"f"),l(this,n,p(),"f"),l(this,r,new Proxy(d.logger,{get:function(e,t){return["debug","info","warn","error"].includes(t)?function(n){e[t](n)}:e[t]}}),"f")}return y.prototype.getVideoEl=function(){return u(this,n,"f")},y.prototype.removeVideoEl=function(){u(this,n,"f").remove()},y.prototype.getVideoInfo=function(){return{}},y.prototype.capturePic=function(e,t){return v(u(this,n,"f"),e,t)},y.prototype.destroy=function(o){var a;if(void 0===o&&(o=!1),o||this.removeVideoEl(),u(this,e,"f")!==f.Destroyed){l(this,e,f.Destroyed,"f"),u(this,r,"f").info("dashPlayer destroyed, holdLastFrame: ".concat(o.toString())),u(this,n,"f").pause();try{null===(a=u(this,t,"f"))||void 0===a||a.destroy()}catch(s){d.logger.error("corePlayer destroy error!!")}this.emit(h.EventType.Destroyed),u(this,i,"f").destroy(),l(this,e,f.Destroyed,"f")}},y}();function p(){var e=document.createElement("video");return e.id="video-".concat(Math.random().toString().slice(2)),e.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  ",e.volume=.9,e.autoplay=!0,e.setAttribute("webkit-playsinline","true"),e.setAttribute("playsinline","true"),e}function v(e,t,n){var i;void 0===t&&(t="image/jpeg"),void 0===n&&(n=.8);var r=document.createElement("canvas");return r.width=e.videoWidth,r.height=e.videoHeight,null===(i=r.getContext("2d"))||void 0===i||i.drawImage(e,0,0,r.width,r.height),r.toDataURL(t,n)}exports.DashPlayer=y,e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,r=new WeakMap,o=new WeakMap;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58"}],"PvGc":[function(require,module,exports) {
"use strict";var t,e,n,i,r,o,a,s,l,u,c,f=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function a(t){try{l(i.next(t))}catch(e){o(e)}}function s(t){try{l(i.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}l((i=i.apply(t,e||[])).next())})},d=this&&this.__generator||function(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(n=1,i&&(r=2&s[0]?i.return:s[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,s[1])).done)return r;switch(i=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,i=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(r=(r=a.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){a.label=s[1];break}if(6===s[0]&&a.label<r[1]){a.label=r[1],r=s;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(s);break}r[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(l){s=[6,l],i=0}finally{n=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},h=this&&this.__classPrivateFieldSet||function(t,e,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(t,n):r?r.value=n:e.set(t,n),n},p=this&&this.__classPrivateFieldGet||function(t,e,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(t):i?i.value:e.get(t)},v=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoundPlayer=exports.NonRoundStatus=void 0;var y,m=require("./dash-player"),w=v(require("../common/controller")),b=require("@bilibili-live/web-player-common"),E=require("../common/utils"),g=require("../common/connects"),P=v(require("@bilibili-live/web-player-track")),x=require("@bilibili-live/web-player-video");!function(t){t[t.Preround=-1]="Preround",t[t.Failed=-2]="Failed",t[t.Nonenabled=-3]="Nonenabled"}(y=exports.NonRoundStatus||(exports.NonRoundStatus={}));var T=function(){function v(v,T){var R=this;t.set(this,""),e.set(this,null),n.set(this,void 0),i.set(this,void 0),r.set(this,new b.EventBus),this.on=p(this,r,"f").on,this.emit=p(this,r,"f").emit,o.set(this,[]),a.set(this,null),s.set(this,""),l.set(this,!1),this.getVideoEl=function(){var t;return null===(t=p(R,e,"f"))||void 0===t?void 0:t.getVideoEl()},this.getPlayerInfo=function(){var n,i;return{guid:p(R,t,"f"),playingStatus:!(null!==(i=null===(n=p(R,e,"f"))||void 0===n?void 0:n.getVideoEl().paused)&&void 0!==i&&i),playSrc:p(R,s,"f"),quality:"0",qualityCandidates:[]}},this.play=function(){var t;null===(t=p(R,e,"f"))||void 0===t||t.play().catch(function(){})},this.pause=function(){var t;null===(t=p(R,e,"f"))||void 0===t||t.pause()},this.volume=function(t){var n;null===(n=p(R,e,"f"))||void 0===n||n.volume(t)},this.mute=function(t){var n;null===(n=p(R,e,"f"))||void 0===n||n.mute(t)},u.set(this,function(){return f(R,void 0,Promise,function(){var v,w,T,R,S,M,C,W,I,V=this;return d(this,function(q){switch(q.label){case 0:return p(this,l,"f")?[2]:(null===(W=p(this,e,"f"))||void 0===W||W.destroy(),v=(0,b.loading)(p(this,n,"f")),[4,k(p(this,i,"f").roomId)]);case 1:return w=q.sent(),v(),w.cid===y.Failed?[2]:w.cid<=0?(T=void 0,w.cid===y.Nonenabled&&(T=P.default.ErrorCode.RoomUnSettingRound),b.logger.warn("exit round cause: ".concat(y[w.cid])),this.emit("failed",w.cid,w.play_time,T),this.destroy(),[2]):(this.emit(b.ExternalEventType.StartPlayRound,w),[4,_(w.cid,w.bvid,p(this,i,"f").userId)]);case 2:if(null==(R=q.sent().dash))throw P.default.error(P.default.ErrorCode.RoomRoundNotExistDash,"dash url is not exist"),new Error("dash url is not exist");return h(this,e,new m.DashPlayer,"f"),p(this,e,"f").init(R,0===p(this,i,"f").userId?0:80).then(function(){var t;null===(t=p(V,e,"f"))||void 0===t||t.seek(w.play_time).catch(function(t){b.logger.error(t)})}).catch(function(t){b.logger.error(t)}),p(this,l,"f")?[2]:(h(this,t,(0,b.uuid)(),"f"),h(this,s,JSON.stringify(R),"f"),p(this,o,"f").forEach(function(t){return t()}),h(this,o,[],"f"),p(this,o,"f").push(p(this,c,"f").call(this,w.title),(0,g.connectUIandVideo)(this.ctrl,p(this,e,"f")),(0,g.connectVideoLoading)(p(this,e,"f"),p(this,n,"f"),p(this,a,"f")),(0,g.connectVideoPip)(p(this,e,"f"),this.ctrl),(0,g.connectMirror)(p(this,e,"f"),this.ctrl),b.EventBus.forwardEvent(p(this,e,"f"),p(this,r,"f"),[x.EventType.Play,x.EventType.Pause,x.EventType.LoadStart,x.EventType.MetaData,x.EventType.VideoInfo,x.EventType.FirstFrame,x.EventType.WaitEnd,x.EventType.WaitStart])),p(this,e,"f").once(x.EventType.Destroyed,function(){V.emit(x.EventType.Destroyed)}),S=null,M=function(){return f(V,void 0,Promise,function(){var t;return d(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=(0,b.loading)(p(this,n,"f")),[4,(0,E.backoffById)(w.bvid,4)];case 1:return e.sent(),null==t||t(),[3,3];case 2:return e.sent(),null==t||t(),[3,3];case 3:return p(this,u,"f").call(this).catch(function(t){b.logger.error(t),P.default.error(P.default.ErrorCode.RoomEnterRoundError,t)}),null==S||S.remove(),[2]}})})},p(this,e,"f").once(x.EventType.Ended,M),p(this,e,"f").once(x.EventType.Error,M),C=p(this,e,"f").getVideoEl(),p(this,e,"f").once(x.EventType.FirstFrame,function(){S=(0,x.checkVideoRate)(C)}),null===(I=p(this,e,"f"))||void 0===I||I.removeVideoEl(),p(this,n,"f").appendChild(C),[2])}})})}),c.set(this,function(t){var e,i="web-player-round-title";null===(e=document.querySelector(".".concat(i)))||void 0===e||e.remove();var r=document.createElement("div");return r.classList.add(i),r.textContent=t,r.style.cssText="\n      z-index: 2;\n      position: absolute;\n      right: 20px;\n      bottom: 20px;\n      pointer-events: none;\n      color: #aaa;\n      font-size: 14px;\n    ",p(R,n,"f").appendChild(r),function(){r.remove()}}),this.blockStream=function(){(0,E.blockStream)(p(R,e,"f"),function(){R.emit(x.EventType.Play)})},b.logger.info("enter round"),h(this,n,v,"f"),h(this,i,T,"f"),this.ctrl=new w.default(p(this,n,"f"),{userId:p(this,i,"f").userId,isMobile:!1,enableCtrlUI:p(this,i,"f").enableCtrlUI}),p(this,u,"f").call(this).catch(function(t){b.logger.error(t),P.default.error(P.default.ErrorCode.RoomEnterRoundError,t)}),this.ctrl.onRefresh(function(){p(R,u,"f").call(R).catch(function(t){b.logger.error(t),P.default.error(P.default.ErrorCode.RoomEnterRoundError,t)})})}return v.prototype.setTitlePageImg=function(t){h(this,a,t,"f")},v.prototype.capturePic=function(t,n){var i,r;return null!==(r=null===(i=p(this,e,"f"))||void 0===i?void 0:i.capturePic(t,n))&&void 0!==r?r:null},v.prototype.destroy=function(t){var n;void 0===t&&(t=!1),p(this,l,"f")||(h(this,l,!0,"f"),b.logger.info("round player destroy, holdLastFrame: ".concat(String(t))),null===(n=p(this,e,"f"))||void 0===n||n.destroy(t),p(this,o,"f").forEach(function(t){return t()}),h(this,o,[],"f"),this.ctrl.destroy(),p(this,r,"f").destroy())},v}();function k(t){return f(this,void 0,Promise,function(){var e;return d(this,function(n){switch(n.label){case 0:return[4,(0,b.ajax)("/live/getRoundPlayVideo?room_id=".concat(t,"&a=").concat(Date.now(),"&type=flv"))];case 1:if(e=n.sent(),Object.values(y).includes(e.cid))return[2,{play_time:e.play_time,cid:e.cid,bvid:e.bvid,title:e.title}];if(e.cid<=0)throw new Error("getRoundPlayVideo result parse failed: ".concat(JSON.stringify(e)));return[2,{play_time:e.play_time,cid:e.cid,bvid:e.bvid,title:e.title}]}})})}exports.RoundPlayer=T,t=new WeakMap,e=new WeakMap,n=new WeakMap,i=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap;var _=function(t,e,n){return f(void 0,void 0,Promise,function(){return d(this,function(n){switch(n.label){case 0:return[4,(0,b.ajax)("https://api.bilibili.com/x/player/playurl?cid=".concat(t,"&bvid=").concat(e,"&fnval=16&platform=web"))];case 1:return[2,n.sent()]}})})};
},{"./dash-player":"pl2j","../common/controller":"as8u","@bilibili-live/web-player-common":"KGHo","../common/utils":"KY4m","../common/connects":"blC7","@bilibili-live/web-player-track":"ESUf","@bilibili-live/web-player-video":"ao58"}],"DfF7":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t);var i=Object.getOwnPropertyDescriptor(r,t);i&&("get"in i?r.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return r[t]}}),Object.defineProperty(e,o,i)}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),r=this&&this.__exportStar||function(r,t){for(var o in r)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||e(t,r,o)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.VideoEventType=exports.ControllerEventType=void 0;var t=require("@bilibili-live/web-player-video");r(require("./live-player/live-player"),exports),r(require("./round-player"),exports);var o=require("./common/controller");Object.defineProperty(exports,"ControllerEventType",{enumerable:!0,get:function(){return o.ControllerEventType}}),exports.VideoEventType=t.EventType;
},{"@bilibili-live/web-player-video":"ao58","./live-player/live-player":"pBr6","./round-player":"PvGc","./common/controller":"as8u"}],"jM0N":[function(require,module,exports) {
window.requestIdleCallback=window.requestIdleCallback||function(e){var n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(e){clearTimeout(e)};
},{}],"NApx":[function(require,module,exports) {
var define;
var t;!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof t&&t.amd?t([],n):"object"==typeof exports?exports.DanmakuBridge=n():e.DanmakuBridge=n()}(self,function(){return function(){"use strict";var t={};!function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}(t);var e=function(t,e,n){if(n||2===arguments.length)for(var o,a=0,r=e.length;a<r;a++)!o&&a in e||(o||(o=Array.prototype.slice.call(e,0,a)),o[a]=e[a]);return t.concat(o||Array.prototype.slice.call(e))},n="//uat-s1.hdslb.com/bfs/live-pkg/danmaku/danmaku-".concat("v1",".js"),o="//s1.hdslb.com/bfs/live-pkg/danmaku/danmaku-".concat("v1",".js"),a=function(){function t(t,e){this.cacheConfig=t,this.tasks=[],this.errorTimes=0,this.initDanmaku(e)}return Object.defineProperty(t.prototype,"config",{get:function(){var t;return(null===(t=this.Danmaku)||void 0===t?void 0:t.config)||this.cacheConfig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){var t;return null===(t=this.Danmaku)||void 0===t?void 0:t.container},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){var t;return null===(t=this.Danmaku)||void 0===t?void 0:t.manager},enumerable:!1,configurable:!0}),t.prototype.initDanmaku=function(t){if(!this.Danmaku){var e=new URL(window.location.href).searchParams.get("danmakuEnv"),a={dev:n,prod:o}[e]||t||o;this.loadDanmaku(a)}},t.prototype.asyncCallMethod=function(t){for(var n,o=this,a=[],r=1;r<arguments.length;r++)a[r-1]=arguments[r];return this.Danmaku?(n=this.Danmaku[t]).call.apply(n,e([this.Danmaku],a,!1)):new Promise(function(n){var r=setTimeout(function(){n(null)},15e3);o.tasks.push(function(){var i;clearTimeout(r),r=null,n((i=o.Danmaku[t]).call.apply(i,e([o.Danmaku],a,!1)))})})},t.prototype.callMethod=function(t){for(var n,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];if(this.Danmaku)return(n=this.Danmaku[t]).call.apply(n,e([this.Danmaku],o,!1))},t.prototype.callTasks=function(){this.tasks.length>0&&(this.tasks.forEach(function(t){t&&t()}),this.tasks.length=0)},t.prototype.play=function(){this.asyncCallMethod("play")},t.prototype.add=function(t,e){this.callMethod("add",t,e)},t.prototype.searchAreaDanmaku=function(t,e){return this.asyncCallMethod("searchAreaDanmaku",t,e)},t.prototype.option=function(t,e){return this.asyncCallMethod("option",t,e)},t.prototype.visible=function(t){return this.asyncCallMethod("visible",t)},t.prototype.resize=function(){this.asyncCallMethod("resize")},t.prototype.clear=function(){this.asyncCallMethod("clear")},t.prototype.destroy=function(){this.asyncCallMethod("destroy")},t.prototype.loadDanmaku=function(t){var e=this,n=document.createElement("script");n.type="text/javascript",n.onload=function(){e.Danmaku=new window.LiveDanmakuEngine.default(e.config),e.callTasks()},n.onerror=function(){e.errorTimes>=2||(e.errorTimes++,console.error("[Danmaku Core Error]","Times: ".concat(e.errorTimes),"Url: ".concat(t)),e.loadDanmaku(t))},n.src=t,document.getElementsByTagName("body")[0].appendChild(n)},t}();return t.default=a,t}()});
},{}],"QxLc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=10;function e(t,e){for(var a=0,n=0,o=0,r=0,u=0,c=0,f=0,l="",h=0,v=0,m=0,b=0,g=0,p=0,k=new DataView(t.buffer,0,e);a<e;){var d=s(t,a,e);switch(a=d.bufPos,d.value){case 1:a=(d=s(t,a,e)).bufPos;break;case 2:a=(d=i(k,a,e)).bufPos,n=d.value,a=(d=i(k,a,e)).bufPos,o=d.value,a=(d=i(k,a,e)).bufPos,r=d.value,a=(d=i(k,a,e)).bufPos,u=d.value,a=(d=i(k,a,e)).bufPos,c=d.value,a=(d=i(k,a,e)).bufPos,f=d.value;break;case 3:l+="z ";break;case 4:a=(d=s(t,a,e)).bufPos,h=d.value,a=(d=s(t,a,e)).bufPos,v=d.value,l+="M"+h.toString()+" "+v.toString()+" ";break;case 5:a=(d=s(t,a,e)).bufPos,h=d.value,a=(d=s(t,a,e)).bufPos,v=d.value,l+="m"+h.toString()+" "+v.toString()+" ";break;case 6:a=(d=s(t,a,e)).bufPos,h=d.value,a=(d=s(t,a,e)).bufPos,v=d.value,l+="L"+h.toString()+" "+v.toString()+" ";break;case 7:a=(d=s(t,a,e)).bufPos,h=d.value,a=(d=s(t,a,e)).bufPos,v=d.value,l+="l"+h.toString()+" "+v.toString()+" ";break;case 8:a=(d=s(t,a,e)).bufPos,h=d.value,a=(d=s(t,a,e)).bufPos,v=d.value,a=(d=s(t,a,e)).bufPos,m=d.value,a=(d=s(t,a,e)).bufPos,b=d.value,a=(d=s(t,a,e)).bufPos,g=d.value,a=(d=s(t,a,e)).bufPos,p=d.value,l+="C"+h.toString()+" "+v.toString()+" "+m.toString()+" "+b.toString()+" "+g.toString()+" "+p.toString()+" ";break;case 9:a=(d=s(t,a,e)).bufPos,h=d.value,a=(d=s(t,a,e)).bufPos,v=d.value,a=(d=s(t,a,e)).bufPos,m=d.value,a=(d=s(t,a,e)).bufPos,b=d.value,a=(d=s(t,a,e)).bufPos,g=d.value,a=(d=s(t,a,e)).bufPos,p=d.value,l+="c"+h.toString()+" "+v.toString()+" "+m.toString()+" "+b.toString()+" "+g.toString()+" "+p.toString()+" "}}return 0===l.length?"":'<?xml version="1.0" standalone="no"?>\n  <svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n      width="'.concat(n,'px" height="').concat(o,'px" viewBox="0 0 ').concat(n," ").concat(o,'"\n      preserveAspectRatio="xMidYMid meet">\n      <g transform="translate(').concat(r,", ").concat(u,") scale(").concat(c,", ").concat(f,')"\n      fill="#000000" stroke="none" shape-rendering="optimizeSpeed">\n      <path d="').concat(l,'"></path>\n      </g>\n  </svg>')}function s(e,s,i){for(var n=0,o=0;s<i&&n<t;){var r=e[s],u=127&r;if(o+=u<<=7*n,n++,s++,0==(128&r))return{bufPos:s,value:a(o)}}return{bufPos:-1,value:-1}}function a(t){return t>>1^1+~(1&t)}function i(t,e,s){return e+4>s?{bufPos:-1,value:-1}:{bufPos:e+4,value:t.getFloat32(e)}}var n=function(){function t(){this.currentTime=0,this.currentMask="",this.hasVideoInfo=!1,this.videoInfo={direction:"",padding:0},this._masks=[]}return t.prototype.clear=function(){this._masks.splice(0,this._masks.length)},t.prototype.input=function(t,s){var a=e(s,s.length);""!==a&&this._addMask({timestamp:t,mask:a})},t.prototype.output=function(t){if(0===this._masks.length)return null;for(var e=0,s=t-this._masks[0].timestamp,a=Math.abs(s),i=1;i<this._masks.length;++i){var n=Math.abs(t-this._masks[i].timestamp),o=Math.abs(n);if(!(o<=a))break;e=i,s=n,a=o}var r=this._masks[e];return this._masks.splice(0,e),r},t.prototype._addMask=function(t){if(0===this._masks.length)this._masks.push(t);else{for(var e=this._masks.length-1;e>=0;--e){if(this._masks[e].timestamp<t.timestamp){e+=1;break}}this._masks.splice(e,0,t),e>0&&this._masks[e].timestamp<this._masks[e-1].timestamp&&this._masks.splice(0,e)}},t.equalsUuid=function(t,e){if(16!==t.length||16!==e.length)return!1;for(var s=0;s<16;++s)if(t[s]!==e[s])return!1;return!0},t.prototype.onUpdateMask=function(t,e){var s=t.currentTime;this.getVideoInfo(t);var a=this.output(s);if(null!=this.currentTime&&this.currentTime-s>1&&e.style.removeProperty("-webkit-mask-image"),null==a||null==a.mask||a.mask===this.currentMask)return this.currentMask="",void(this.currentTime=0);var i=a.mask;if(null===i||i===this.currentMask)return this.currentMask="",void(this.currentTime=0);if(a.timestamp-s<=1&&this.hasVideoInfo){var n="data:image/svg+xml;base64,"+btoa(i),o="linear-gradient(\n        to ".concat(this.videoInfo.direction,",\n        rgb(0,0,0,1),\n        rgb(0,0,0,1) ").concat(this.videoInfo.padding,"%,\n        rgb(0,0,0,0) ").concat(this.videoInfo.padding,"%,\n        rgba(0,0,0,0) ").concat(100-this.videoInfo.padding,"%,\n        rgba(0,0,0,1) ").concat(100-this.videoInfo.padding,"%,\n        rgba(0,0,0,1)),\n        url(").concat(n,")");e.style.cssText+="\n        -webkit-mask-image: ".concat(o,";\n        -webkit-mask-size: contain;\n        mask-size: contain;\n        -webkit-mask-repeat: no-repeat;\n        mask-repeat: no-repeat;\n        -webkit-mask-position: center center;\n        mask-position: center center;\n      "),this.currentMask=i,this.currentTime=a.timestamp}},t.prototype.destroy=function(){this._masks=[]},t.prototype.getVideoInfo=function(t){var e,s,a=t.videoHeight,i=t.videoWidth,n=t.clientHeight,o=t.clientWidth,r=t.clientHeight,u=t.clientWidth;if(0===a||0===i)return!1;i/a>o/n?(s="bottom",e=Math.ceil((n-a*o/i)/(2*r)*100*100)/100):(s="right",e=Math.ceil((o-i*n/a)/(2*u)*100*100)/100),this.hasVideoInfo=!0,this.videoInfo={direction:s,padding:e}},t}();exports.default=n;
},{}],"uyEh":[function(require,module,exports) {
"use strict";var e,t,n,i,o,a,r,l,s,f,c,u,d,h,m,p=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function r(e){try{s(i.next(e))}catch(t){a(t)}}function l(e){try{s(i.throw(e))}catch(t){a(t)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,l)}s((i=i.apply(e,t||[])).next())})},v=this&&this.__generator||function(e,t){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function l(l){return function(s){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(o=2&l[0]?i.return:l[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,l[1])).done)return o;switch(i=0,o&&(l=[2&l[0],o.value]),l[0]){case 0:case 1:o=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===l[0]||2===l[0])){r=0;continue}if(3===l[0]&&(!o||l[1]>o[0]&&l[1]<o[3])){r.label=l[1];break}if(6===l[0]&&r.label<o[1]){r.label=o[1],o=l;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(l);break}o[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(s){l=[6,s],i=0}finally{n=o=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},w=this&&this.__classPrivateFieldSet||function(e,t,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,n):o?o.value=n:t.set(e,n),n},y=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},b=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DmType=void 0,require("requestidlecallback-polyfill");var k,g=b(require("@bilibili-live/live-danmaku-engine-v2")),E=b(require("./mask-decoder")),M=require("@bilibili-live/web-player-common"),x=(0,M.isWebPSupported)(),T=150;!function(e){e[e.Text=0]="Text",e[e.Emoji=1]="Emoji",e[e.Voice=2]="Voice"}(k=exports.DmType||(exports.DmType={}));var W="web-player-danmaku",P="danmaku-item-container",_=function(){function b(b,g){var M=this;this.container=b,this.opts=g,e.set(this,void 0),t.set(this,void 0),n.set(this,[]),i.set(this,!1),o.set(this,void 0),a.set(this,void 0),r.set(this,void 0),l.set(this,void 0),s.set(this,null),f.set(this,[]),c.set(this,void 0),u.set(this,void 0),d.set(this,0),h.set(this,function(e){var n=null!=e.dm_v2?{mode:e.mode,dm:e.dm_v2}:void 0;e.dmType===k.Emoji?M.getEmoticonInfo(e).then(function(i){var o=i.html,a=i.emojiRatio;e=Object.assign({},e,{html:o,emojiRatio:a}),y(M,t,"f").add(e,n)}).catch(function(e){console.error(e)}):y(M,t,"f").add(e,n)}),m.set(this,function(){w(M,s,window.requestIdleCallback(function(e){if(null!=e.timeRemaining)for(var t=function(){var e=y(M,n,"f").shift(),t=100*y(M,f,"f").length,i=setTimeout(function(){y(M,h,"f").call(M,e),y(M,f,"f").shift()},t);y(M,f,"f").push(i)};(e.timeRemaining()>0||e.didTimeout)&&y(M,n,"f").length>0&&y(M,f,"f").length<10;)t();if(y(M,n,"f").length>0)return y(M,m,"f").call(M);null!=y(M,s,"f")&&(window.cancelIdleCallback(y(M,s,"f")),w(M,s,null,"f"))},{timeout:1e3}),"f")}),this.parseEmoticon=function(e,t){return p(M,void 0,Promise,function(){var n,i;return v(this,function(o){switch(o.label){case 0:return!1,e.dmType!==k.Emoji?[3,2]:(n=new Image,i=t.url,n.style.width="100%",n.style.height="100%",n.src="".concat(i).concat(x?"@56h.webp":"@56h.png"),[4,new Promise(function(e){n.onerror=function(){e(!0)},n.onload=function(){e(!1)}})]);case 1:return o.sent()?[2,""]:[2,n.outerHTML];case 2:return[2,""];case 3:return[2]}})})},this.getEmoticonInfo=function(e){return p(M,void 0,Promise,function(){var t,n,i,o;return v(this,function(a){switch(a.label){case 0:return t=null!==(o=e.emoticonOptions)&&void 0!==o?o:{width:1,height:1,url:"",emoji:""},[4,this.parseEmoticon(e,t)];case 1:return n=a.sent(),i=e.dmType===k.Emoji?Number((t.width/t.height).toFixed(1)):1,[2,{html:n,emojiRatio:i}]}})})},this.add=function(e,i){if(void 0===i&&(i=!1),null!=y(M,t,"f")){if(i)return y(M,h,"f").call(M,e);y(M,n,"f").length>20&&y(M,n,"f").shift(),y(M,n,"f").push(e),null==y(M,s,"f")&&y(M,m,"f").call(M)}},this.onPlay=function(e){w(M,o,e,"f")},this.onPause=function(e){w(M,a,e,"f")},this.offPlay=function(){w(M,o,void 0,"f")},this.offPause=function(){w(M,a,void 0,"f")},this.onSelect=function(e){M.offSelect(),w(M,r,e,"f"),w(M,l,function(n){var i,o=M.container.getBoundingClientRect(),a=Number(null!==(i=getComputedStyle(document.documentElement).zoom)&&void 0!==i?i:1),r=n.clientX/a-o.left,l=n.clientY/a-o.top,s=y(M,t,"f").searchAreaDanmaku(r,l);s.length>0&&(e(s.map(function(e){return e.textData})),n.preventDefault())},"f"),M.container.addEventListener("contextmenu",y(M,l,"f"),!0)},this.offSelect=function(){var e;null!=y(M,l,"f")&&(null===(e=M.container)||void 0===e||e.removeEventListener("contextmenu",y(M,l,"f"),!0),w(M,l,void 0,"f"))},this.play=function(){var e;y(M,i,"f")||(w(M,i,!0,"f"),null===(e=y(M,t,"f"))||void 0===e||e.play(),null!=y(M,o,"f")&&y(M,o,"f").call(M))},this.pause=function(){var e;y(M,i,"f")&&(w(M,i,!1,"f"),null===(e=y(M,t,"f"))||void 0===e||e.pause(),null!=y(M,a,"f")&&y(M,a,"f").call(M))},this.setRenderType=function(n){var i;null===(i=y(M,t,"f"))||void 0===i||i.setType(n),null!=y(M,e,"f")&&M.setBackGroundImage(y(M,e,"f")),null!=y(M,l,"f")&&(M.offSelect(),null!=y(M,r,"f")&&M.onSelect(y(M,r,"f")))},this.resize=function(){var e;if(null==y(M,t,"f"))return M;var n=y(M,t,"f").config.container;return null!=n&&(n.style.width="".concat(y(M,c,"f").clientWidth,"px"),n.style.height="".concat(y(M,c,"f").clientHeight,"px"),null===(e=y(M,t,"f"))||void 0===e||e.resize()),M},this.show=function(){var e;null===(e=y(M,t,"f"))||void 0===e||e.visible(!0)},this.hide=function(){var e;null===(e=y(M,t,"f"))||void 0===e||e.visible(!1)},this.setBackGroundImage=function(t){if(null==y(M,c,"f"))throw new Error("danmakuWrapNode must be HTMLElement");t!==y(M,e,"f")&&w(M,e,t,"f"),y(M,c,"f").style.backgroundImage="url(".concat(t,")"),y(M,c,"f").style.backgroundRepeat="no-repeat",y(M,c,"f").style.backgroundPosition="center",y(M,c,"f").style.backgroundSize="contain"},this.set=function(e){var n=y(M,t,"f");if(null!=n)for(var i in e){var o=e[i];switch(i){case"type":M.setRenderType(o);break;case"backgroundImage":M.setBackGroundImage(o);break;case"maxCount":i="danmakuNumber",n.option(i,o);break;default:n.option(i,o)}}},this.clear=function(){var e;null===(e=y(M,t,"f"))||void 0===e||e.clear()},this.destroy=function(){var e;y(M,c,"f").remove(),null===(e=y(M,t,"f"))||void 0===e||e.destroy(),w(M,t,null,"f"),y(M,u,"f").destroy(),null!=y(M,s,"f")&&(window.cancelIdleCallback(y(M,s,"f")),w(M,s,null,"f")),w(M,n,[],"f"),y(M,f,"f").forEach(function(e){return window.clearTimeout(e)}),window.removeEventListener("resize",M.resize),cancelAnimationFrame(y(M,d,"f"))},this.addMaskSVG=function(e){y(M,u,"f").input(e[1],e[3])},this.clearMask=function(){y(M,u,"f")._masks=[]},this.addMaskToWrap=function(e){var t=y(M,c,"f"),n=y(M,u,"f");cancelAnimationFrame(y(M,d,"f"));w(M,d,window.requestAnimationFrame(function i(o){o>performance.now()-5&&n.onUpdateMask(e,t),w(M,d,window.requestAnimationFrame(i),"f")}),"f")},this.fullscreenDM=function(){y(M,c,"f").style.position="fixed"},this.offsetDM=function(e){y(M,c,"f").style.transform="translate3d(".concat(e,"px, ").concat(e,"px, 0)")},w(this,e,null==g?void 0:g.backgroundImage,"f"),w(this,c,document.createElement("div"),"f"),y(this,c,"f").classList.add(W),y(this,c,"f").style.cssText="\n        width: 100%;\n        height: 100%;\n        position: relative;\n        top: 0;\n        left: 0;\n        z-index: 8;\n        pointer-events: none;\n      ",b.appendChild(y(this,c,"f")),this.initialize(),w(this,u,new E.default,"f")}return b.prototype.initialize=function(){var n,i,o=document.createElement("div");o.classList.add(P);var a=document.createElement("style");a.innerHTML="\n        .".concat(W," .").concat(P,"{\n          width: ").concat(y(this,c,"f").clientWidth,"px;\n          height: ").concat(y(this,c,"f").clientHeight,"px;\n          position: relative;\n          overflow: hidden;\n        }"),document.getElementsByTagName("HEAD")[0].appendChild(a),y(this,c,"f").appendChild(o),w(this,t,new g.default({container:o,isLive:!0,type:"div",opacity:1,fontSize:1,duration:6,danmakuArea:100,danmakuNumber:T,isRecycling:!0,isMobile:null!==(i=null===(n=this.opts)||void 0===n?void 0:n.isMobile)&&void 0!==i&&i}),"f"),null!=y(this,e,"f")&&this.setBackGroundImage(y(this,e,"f")),window.addEventListener("resize",this.resize)},b.prototype.closeMask=function(e){cancelAnimationFrame(y(this,d,"f")),e||y(this,c,"f").style.removeProperty("-webkit-mask-image")},b.prototype.getDanmakuElement=function(){return y(this,c,"f")},b}();e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakMap,r=new WeakMap,l=new WeakMap,s=new WeakMap,f=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap,m=new WeakMap,exports.default=_;
},{"requestidlecallback-polyfill":"jM0N","@bilibili-live/live-danmaku-engine-v2":"NApx","./mask-decoder":"QxLc","@bilibili-live/web-player-common":"KGHo"}],"Rr2x":[function(require,module,exports) {
"use strict";var o,t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EPlatform=exports.RoomStatus=void 0,function(o){o[o.Preparing=0]="Preparing",o[o.Live=1]="Live",o[o.Round=2]="Round"}(o=exports.RoomStatus||(exports.RoomStatus={})),function(o){o[o.Web=1]="Web",o[o.Android=2]="Android",o[o.Ios=3]="Ios",o[o.H5=4]="H5"}(t=exports.EPlatform||(exports.EPlatform={}));
},{}],"E90K":[function(require,module,exports) {
"use strict";function e(e,n,t){var r="直播已断开",l=null!=t?t:"直播时空次元异常，正在努力恢复中",a=document.createElement("div"),i=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div"),c=document.createElement("div");a.className="web-player-error-panel",o.className="web-player-error-code",s.className="web-player-error-image",c.className="web-player-error-tip";r+='\n    <div style="'.concat("\n    display: block;\n    font-size: 13px;\n    color: #fff;\n  ",'" class="web-player-error-operation">\n      ( 请尝试\n        <a style="').concat("\n    color: #fd9ccc;\n    display: inline-block;\n    position: relative;\n    margin: 0 3px;\n  ",'" class="web-player-error-reload" href="javascript:void(0);">刷新</a>\n      )\n    </div>\n  '),i.style.cssText="\n    display: block;\n    max-width: 80%;\n    display: inline-block;\n    font-size: 16px;\n    color: #eee;\n    line-height: 24px;\n    padding: 10px;\n    cursor: default;\n  ",s.style.cssText="\n    display: block;\n    width: 30%;\n    height: 30%;\n    background: url(//s1.hdslb.com/bfs/static/player/live/html5/images/error.png) no-repeat 50% 0;\n    background-size: contain;\n  ",a.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    box-sizing: border-box;\n    z-index: 18;\n    background: #000;\n    cursor: default;\n    display: flex;\n    flex-flow: column;\n    justify-content: center;\n    align-items: center;\n  ";var d="\n    font-size: 24px;\n    margin-top: 12px;\n    color: #999999;\n    height: 33px;\n    line-height: 33px;\n    text-align: center;\n  ";return o.style.cssText=d,c.style.cssText=d,i.innerHTML=r,a.appendChild(i),a.appendChild(s),c.innerHTML=l,o.innerText="status: ".concat(n),i.style.display="none",a.appendChild(o),a.appendChild(c),e.appendChild(a),function(){a.remove()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createErrorPanel=void 0,exports.createErrorPanel=e;
},{}],"Rvqf":[function(require,module,exports) {
"use strict";var t=this&&this.__classPrivateFieldSet||function(t,e,a,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(t,a):i?i.value=a:e.set(t,a),a},e=this&&this.__classPrivateFieldGet||function(t,e,a,n){if("a"===a&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?n:"a"===a?n.call(t):n?n.value:e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebHaptic=void 0;var a=!1,n=function t(){a=!0,window.removeEventListener("touchstart",t),window.removeEventListener("click",t)};window.addEventListener("touchstart",n),window.addEventListener("click",n);var i=function(){function n(b){void 0===b&&(b=!0);var k=this;i.set(this,!1),o.set(this,0),r.set(this,0),s.set(this,!1),c.set(this,!0),f.set(this,[]),l.set(this,void 0),d.set(this,void 0),p.set(this,1e3),u.set(this,-1),this.enableControllerHaptic=function(){t(k,c,!0,"f")},this.disableControllerHaptic=function(){t(k,c,!1,"f")},this.dispose=function(){k.setState(0,0),e(k,s,"f")&&(window.removeEventListener("gamepadconnected",e(k,l,"f")),window.removeEventListener("gamepaddisconnected",e(k,d,"f")))},this.setState=function(a,n){clearTimeout(e(k,u,"f")),e(k,w,"f").call(k,a,n),e(k,v,"f").call(k,a,n),(a>0||n>0)&&t(k,u,window.setTimeout(function(){t(k,u,-1,"f"),k.setState(0,0)},e(k,p,"f")),"f")},w.set(this,function(s,c){if(n.IsSupportWebHaptic()){var f=Math.max(s,.5*c);if(f!==e(k,o,"f")){if(t(k,o,f,"f"),t(k,r,f/65535,"f"),!a)return;f>0?e(k,i,"f")||(t(k,i,!0,"f"),e(k,m,"f").call(k,k)):(t(k,i,!1,"f"),window.navigator.vibrate(0))}}}),v.set(this,function(t,a){var n;if(e(k,s,"f"))for(var i=t/65535,o=a/65535,r=0,c=Object.entries(e(k,f,"f"));r<c.length;r++){var l=c[r],d=(l[0],l[1]);null!=d&&(null===(n=null==d?void 0:d.vibrationActuator)||void 0===n||n.playEffect("dual-rumble",{duration:1e3,strongMagnitude:i,weakMagnitude:o}))}}),this.getMotorPercent=function(){return e(k,r,"f")},h.set(this,function(){t(k,f,navigator.getGamepads(),"f")}),m.set(this,function(t){a&&e(t,o,"f")>0&&e(t,i,"f")&&(e(t,r,"f")<.075?e(t,W,"f").call(t,t,e(t,r,"f")):e(k,r,"f")<.88?e(t,M,"f").call(t,t,e(t,r,"f")):e(t,g,"f").call(t,t,e(t,r,"f")))}),g.set(this,function(t,a){var n=100*a;window.navigator.vibrate(n),setTimeout(function(){e(t,m,"f").call(t,t)},n)}),M.set(this,function(t,a){var n=50*a;window.navigator.vibrate(n),setTimeout(function(){e(t,m,"f").call(t,t)},n)}),W.set(this,function(t,a){var n=100-a/.025*100;window.navigator.vibrate(2),setTimeout(function(){e(t,m,"f").call(t,t)},n)}),t(this,c,b,"f"),e(this,c,"f")&&t(this,s,n.IsSupportControllerHaptic(),"f"),t(this,l,function(t){console.log("A gamepad was connected:"+t.gamepad.id),e(k,h,"f").call(k)},"f"),t(this,d,function(t){console.log("A gamepad was disconnected:"+t.gamepad.id),e(k,h,"f").call(k)},"f"),e(this,s,"f")&&(window.addEventListener("gamepadconnected",e(this,l,"f")),window.addEventListener("gamepaddisconnected",e(this,d,"f")),e(this,h,"f").call(this))}var i,o,r,s,c,f,l,d,p,u,w,v,h,m,g,M,W;return i=new WeakMap,o=new WeakMap,r=new WeakMap,s=new WeakMap,c=new WeakMap,f=new WeakMap,l=new WeakMap,d=new WeakMap,p=new WeakMap,u=new WeakMap,w=new WeakMap,v=new WeakMap,h=new WeakMap,m=new WeakMap,g=new WeakMap,M=new WeakMap,W=new WeakMap,n.IsSupportControllerHaptic=function(){var t,e;return!(null==window.Gamepad||null==window.GamepadHapticActuator||null===(e=null===(t=window.GamepadHapticActuator)||void 0===t?void 0:t.prototype)||void 0===e||!e.hasOwnProperty("playEffect"))},n.IsSupportWebHaptic=function(){return null!=window.navigator.vibrate},n.IsSupport=function(){return n.IsSupportControllerHaptic()||n.IsSupportWebHaptic()},n}();exports.WebHaptic=i;
},{}],"rPeE":[function(require,module,exports) {
"use strict";var t,e,i,a,r,n,o,s,f,c=this&&this.__classPrivateFieldSet||function(t,e,i,a,r){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(t,i):r?r.value=i:e.set(t,i),i},h=this&&this.__classPrivateFieldGet||function(t,e,i,a){if("a"===i&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!a:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?a:"a"===i?a.call(t):a?a.value:e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.VibrateTask=void 0;var p=require("@bilibili-live/web-player-common"),u=require("./haptic"),l=!0,m=function(){function m(m,d){var b=this;this.dmBiz=d,t.set(this,[]),e.set(this,new u.WebHaptic),i.set(this,void 0),a.set(this,0),r.set(this,null),n.set(this,-1),o.set(this,{shiftLimit:2,curLocation:0,speed:.4,direction:"top"}),this.clear=function(){h(b,t,"f").splice(0,h(b,t,"f").length)},this.input=function(t,e){var i=(0,p.uint8ArrayToString)(e),a=JSON.parse(i);b.addVibrateData({timestamp:t,vibrate:a})},this.output=function(e){if(0!==h(b,t,"f").length){for(var i=0,a=e-h(b,t,"f")[0].timestamp,r=Math.abs(a),n=1;n<h(b,t,"f").length;++n){var o=Math.abs(e-h(b,t,"f")[n].timestamp),s=Math.abs(o);if(!(s<=r))break;i=n,a=o,r=s}var f=h(b,t,"f")[i];return h(b,t,"f").splice(0,i),f}},this.addVibrateData=function(e){if(0===h(b,t,"f").length)h(b,t,"f").push(e);else{for(var i=h(b,t,"f").length-1;i>=0;--i){if(h(b,t,"f")[i].timestamp<e.timestamp){i+=1;break}}h(b,t,"f").splice(i,0,e)}},this.onUpdateVibrate=function(){var t=h(b,i,"f").currentTime,e=b.output(t);if(null!=h(b,a,"f")&&t-h(b,a,"f")>1&&l&&b.webXInputSetState(0,0),null!=e&&null!=e.vibrate&&e.vibrate!==h(b,r,"f")){var n=e.timestamp-t;if(Math.abs(n)<=1){if(l){var o=Math.max(0,n);setTimeout(function(){b.webXInputSetState(e.vibrate.l,e.vibrate.r)},1e3*o)}c(b,r,e.vibrate,"f"),c(b,a,e.timestamp,"f")}}},this.onFrameCallback=function(t){t>performance.now()-5&&b.onUpdateVibrate(),c(b,n,window.requestAnimationFrame(b.onFrameCallback),"f")},this.destroy=function(){cancelAnimationFrame(h(b,n,"f")),c(b,t,[],"f"),b.webXInputSetState(0,0),h(b,e,"f").dispose()},s.set(this,function(t){0===t?(h(b,o,"f").shiftLimit=0,h(b,o,"f").curLocation=0):t<.075?h(b,o,"f").shiftLimit=2:t<=.88?h(b,o,"f").shiftLimit=5:t>.88&&(h(b,o,"f").shiftLimit=7),h(b,o,"f").speed=4*t,h(b,f,"f").call(b)}),f.set(this,function(){"top"===h(b,o,"f").direction?(h(b,o,"f").curLocation+=h(b,o,"f").speed,h(b,o,"f").curLocation+=h(b,o,"f").speed):(h(b,o,"f").curLocation-=h(b,o,"f").speed,h(b,o,"f").curLocation-=h(b,o,"f").speed),Math.abs(h(b,o,"f").curLocation)>h(b,o,"f").shiftLimit&&("top"===h(b,o,"f").direction?(h(b,o,"f").direction="bottom",h(b,o,"f").curLocation=h(b,o,"f").shiftLimit):(h(b,o,"f").direction="top",h(b,o,"f").curLocation=h(b,o,"f").shiftLimit)),null!=b.dmBiz&&b.dmBiz.offsetDM(h(b,o,"f").curLocation)}),c(this,t,[],"f"),c(this,i,m,"f"),this.onFrameCallback(0)}return m.prototype.webXInputSetState=function(t,i){h(this,e,"f").setState(t,i),h(this,s,"f").call(this,h(this,e,"f").getMotorPercent())},m}();exports.VibrateTask=m,t=new WeakMap,e=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap,n=new WeakMap,o=new WeakMap,s=new WeakMap,f=new WeakMap;
},{"@bilibili-live/web-player-common":"KGHo","./haptic":"Rvqf"}],"YQ89":[function(require,module,exports) {
"use strict";var e,o,t=this&&this.__awaiter||function(e,o,t,r){return new(t||(t=Promise))(function(n,i){function a(e){try{u(r.next(e))}catch(o){i(o)}}function l(e){try{u(r.throw(e))}catch(o){i(o)}}function u(e){var o;e.done?n(e.value):(o=e.value,o instanceof t?o:new t(function(e){e(o)})).then(a,l)}u((r=r.apply(e,o||[])).next())})},r=this&&this.__generator||function(e,o){var t,r,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(u){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(a=0)),a;)try{if(t=1,r&&(n=2&l[0]?r.return:l[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,l[1])).done)return n;switch(r=0,n&&(l=[2&l[0],n.value]),l[0]){case 0:case 1:n=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,r=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!n||l[1]>n[0]&&l[1]<n[3])){a.label=l[1];break}if(6===l[0]&&a.label<n[1]){a.label=n[1],n=l;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(l);break}n[2]&&a.ops.pop(),a.trys.pop();continue}l=o.call(e,a)}catch(u){l=[6,u],r=0}finally{t=n=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.disableDanmaku=exports.dmVisualVibrate=exports.pressToOpenVideoInfoListener=exports.pause10SecBlockStream=exports.getUserId=exports.updateDanmakuSetting=exports.createContextmenuHandler=exports.ajaxWatcher=exports.initRoomInfoOrBlock=exports.loadRoomInfo=exports.initPlayer=exports.commonLogInfo=exports.downloadFile=exports.isSupported=exports.PlayerEnv=exports.ENV=void 0;var i,a=require("@bilibili-live/web-player-common"),l=n(require("@bilibili-live/web-player-track")),u=require("./ui-components/error-panel"),c=require("@bilibili-live/web-player"),s=require("./vibrate/vibrate_task");function d(){var e;return null!=Object.entries&&null!=Element.prototype.prepend&&("fetch"in window&&"ReadableStream"in window&&Boolean(null===(e=window.MediaSource)||void 0===e?void 0:e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'))||a.ua.isIOS())}function p(o,t){try{var r=document.createElement("a");r.download=t,r.style.display="none";var n=new Blob([o]);r.href=window.URL.createObjectURL(n),document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(e){a.logger.error("Failed to download file")}}function f(e){a.logger.info("".concat(e," version: ").concat(exports.ENV.VERSION,", current date: ").concat((new Date).toLocaleDateString(),", build time: ").concat(exports.ENV.BUILD_TIME)),a.logger.info("user agent: ".concat(navigator.userAgent)),setTimeout(function(){(0,a.ajax)("/xlive/web-room/v1/index/getIpInfo").then(function(e){a.logger.info("client ip info: ".concat(JSON.stringify(e)))}).catch(a.logger.error)},100)}function v(e,o){var t=(0,a.uuid)(),r=g();return a.logger.info("userId: ".concat(r)),l.default.initStaticInfo({uvid:t,uid:r,version:o+exports.ENV.VERSION,roomId:e}),a.userSetting.init(r),d()||(l.default.error(l.default.ErrorCode.UnsupportedPlayer,"UnsupportedPlayer"),a.logger.error("Unsupported Player")),{userId:r,uvid:t}}function m(e,o){return t(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return null==o?[3,2]:[4,o(e)];case 1:return[2,t.sent()];case 2:return[4,new Promise(function(o,t){(0,a.ajax)("//api.live.bilibili.com/xlive/web-room/v2/index/getRoomPlayInfo?room_id=".concat(e.roomId,"&protocol=0,1&format=0,1,2&codec=0,1&qn=").concat(e.qn,"&platform=").concat(e.isMobile?"html5":"web","&ptype=8&dolby=5").concat(e.isMobile?"":"&panorama=1"),{handleRes:o}).catch(t)})];case 3:return[2,t.sent()]}})})}function y(e,o,n){var i=e.roomId,l=e.isMobile;return t(this,void 0,Promise,function(){var e,t,c;return r(this,function(r){switch(r.label){case 0:return[4,m({roomId:i,qn:0,isMobile:l},n)];case 1:if(e=r.sent(),t=e.code,c=e.data,t===a.ApiErrorCode.AreaBlock)throw(0,u.createErrorPanel)(o,a.ApiErrorCode.AreaBlock,"Sorry, bilibili is currently not available in your country according to copyright restrictions<br/>非常抱歉，根据版权方要求，您所在的地区无法观看本直播"),new Error("RoomAreaBlock");return[2,c]}})})}function b(e,o){var t=o.duration,r=void 0===t?0:t,n=o.errMsg,i=void 0===n?"ApiError":n,a=o.apiUrl,u=void 0===a?"":a;"apiBizErr"===e?l.default.error(l.default.ErrorCode.ApiBiz,i,{apiUrl:u,extFields:[]}):"requestErr"===e?l.default.error(l.default.ErrorCode.ApiRequest,i,{apiUrl:u,extFields:[],sampleRate:.01}):"responseErr"===e?l.default.error(l.default.ErrorCode.ApiResponse,i,{apiUrl:u,extFields:[]}):"perf"===e&&l.default.perf(l.default.PerfCode.Api,r,{params:{apiUrl:u},extFields:[],sampleRate:.01})}function h(e,o){return{handleLogger:function(o){var t,r=a.logger.dump();switch(o){case"copy":return void(null===(t=navigator.clipboard)||void 0===t||t.writeText(r).catch(function(){}));case"download":return void p(r,"Bilibili-Live-HTML5-Player-EventLog-".concat(Date.now(),".txt"));case"show":e.show()}},handleVideoInfo:function(){o.show()}}}function x(e,o){var t={area:"danmakuArea",fontScale:"fontSize"},r=function(e){return e/100},n={opacity:r,fontScale:r,density:r,area:function(e){return e/4*100}};Object.entries(e).map(function(e){var o,r,i=e[0],a=e[1];return[null!==(o=t[i])&&void 0!==o?o:i,(null!==(r=n[i])&&void 0!==r?r:function(e){return e})(a)]}).forEach(function(e){var t,r=e[0],n=e[1];"display"===r?o[n?"show":"hide"]():o.set(((t={})[r]=n,t))})}function g(){return Number((0,a.getCookie)("DedeUserID"))}function w(e,o){var t=0,r=!1;a.mediaAction.on("play",function(){n()}),a.mediaAction.on("pause",function(){u()});var n=function(){var n,i;if(clearTimeout(t),r){r=!1;var l=e instanceof c.LivePlayer&&!0===(null===(n=e.replay)||void 0===n?void 0:n.isReplay);a.logger.info("reload when blocked stream, isReplay?: ".concat(String(l))),l?null===(i=e.replay)||void 0===i||i.reload():(e.destroy(),o.reload().catch(function(e){a.logger.error(e)}))}},i=e.on(c.VideoEventType.Play,n),l=e.ctrl.onChange(function(e,o){"playStatus"===e&&(o?n():u())}),u=function(){t=window.setTimeout(function(){a.logger.info("block stream because paused 10 sec"),r=!0,e.blockStream()},1e4)};return function(){i(),l(),clearTimeout(t),r=!1,a.mediaAction.destroy()}}function E(e){var o=[],t=function(t){o.push(performance.now()),(o=o.filter(function(e){return performance.now()-e<50})).length>=2&&(o=[],e.dispatchEvent(new MouseEvent("contextmenu",{clientX:t.changedTouches[0].clientX,clientY:t.changedTouches[0].clientY})))};return e.addEventListener("touchend",t),function(){e.removeEventListener("touchend",t)}}exports.ENV={VERSION:null!==(e="3.7.2")&&void 0!==e?e:"unknown",BUILD_TIME:null!==(o="2023/9/18 下午4:21:33")&&void 0!==o?o:"unknown",NODE_ENV:"production"},function(e){e.Activity="A",e.Room="R",e.Home="H",e.Mobile="M"}(i=exports.PlayerEnv||(exports.PlayerEnv={})),exports.isSupported=d,exports.downloadFile=p,exports.commonLogInfo=f,exports.initPlayer=v,exports.loadRoomInfo=m,exports.initRoomInfoOrBlock=y,exports.ajaxWatcher=b,exports.createContextmenuHandler=h,exports.updateDanmakuSetting=x,exports.getUserId=g,exports.pause10SecBlockStream=w,exports.pressToOpenVideoInfoListener=E;var I=function(e,o){var t=null;return e.on(a.ExternalEventType.SEIParseData,function(r,n,i){if(r===a.SEIType.B_LIVE_VIBRATION){var l=e.getVideoEl();null!=l&&(null==t&&(t=new s.VibrateTask(l,o)),t.input(n,i))}}),e.on(c.VideoEventType.Destroyed,function(){null==t||t.destroy(),t=null}),e.on(c.VideoEventType.WaitStart,function(){null==t||t.webXInputSetState(0,0)}),function(){null==t||t.destroy(),t=null}};function S(e){var o;null!=e.ctrl&&(e.ctrl.getCtrlUI().ctrlItemVisibility.danmaku=!1),null===(o=e.danmakuBiz)||void 0===o||o.hide()}exports.dmVisualVibrate=I,exports.disableDanmaku=S;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf","./ui-components/error-panel":"E90K","@bilibili-live/web-player":"DfF7","./vibrate/vibrate_task":"rPeE"}],"ipbQ":[function(require,module,exports) {
"use strict";async function e(e){const t=document.createElement("script"),n=document.getElementsByTagName("head")[0],a=new Promise((e,n)=>{t.onload=(()=>{e()}),t.onerror=n});t.src=e,null!=n&&n.appendChild(t),await a}function t(e,t){let n;return function(...a){void 0!==n&&window.clearTimeout(n),n=window.setTimeout(()=>{e.apply(this,a)},t)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFlowerRain=m,exports.bodyMaskDetector=void 0;let n=null;const a={isSupported(){var e,t;return"OffscreenCanvas"in window&&(null!=(e=navigator.hardwareConcurrency)?e:-1)>4&&(null!=(t=navigator.deviceMemory)?t:-1)>4},async start(t,a,r){let i=window.LiveShadow;if(null==i&&(null==n&&(n=e("//s1.hdslb.com/bfs/blive-engineer-pkg/live-shadow/detect-body-mask.473689a2.umd.js")),await n,null==(i=window.LiveShadow)))throw Error("LiveShadow load failed");let d=await i.detectBodyMask(t,a,r),c=!1;async function l(){d(),null!=i&&(d=await i.detectBodyMask(t,a,r),c&&d())}const h=s(t,l),v=o(t,l);return()=>{c||(c=!0,h(),v(),d())}}};function o(e,t){if(!(e instanceof HTMLVideoElement))return()=>{};let n=e.videoWidth,a=e.videoHeight;const o=setInterval(async()=>{const{videoWidth:o,videoHeight:s}=e;o===n&&s===a||(n=o,a=s,t())},1e3);return()=>{clearInterval(o)}}function s(e,n){let{width:a,height:o}=e.getBoundingClientRect();const s=new ResizeObserver(t(async e=>{const t=e[0].contentRect;t.width===a&&t.height===o||(a=t.width,o=t.height,n())},1e3));return s.observe(e),()=>{s.disconnect()}}exports.bodyMaskDetector=a;const r=()=>{let e;self.onmessage=(t=>{"start"===t.data.event&&(self.clearInterval(e),e=self.setInterval(()=>{self.postMessage({})},16.7)),"stop"===t.data.event&&self.clearInterval(e)})},i=()=>{const e=new Blob([`(${r.toString()})()`]),t=URL.createObjectURL(e);return new Worker(t)},d=new Map;let c=1;const l=i();l.onmessage=(()=>{c+=1;for(const[e,t]of d.entries())c%e==0&&t.forEach(e=>e())});const h=(e,t=1)=>{var n;const a=null!=(n=d.get(t))?n:new Set;return a.add(e),d.set(t,a),1===d.size&&1===a.size&&l.postMessage({event:"start"}),()=>{a.delete(e),0===a.size&&d.delete(t),0===d.size&&(c=0,l.postMessage({event:"stop"}))}},v=new Image;v.src="https://i0.hdslb.com/bfs/activity-plat/static/20220801/6ad1a552c5f99f6be0ff1b0072d86e59/KhLcCEjHmx.png",v.crossOrigin="anymouse";const p=[[0,0,72,63],[75,0,51,67],[139,0,70,62]],u=()=>{};function m(e,t){const{width:n,height:o}=e,s=document.createElement("canvas");s.width=n,s.height=o;let r=0,i=22,d=!0,c=u,l=u,v=u,p=null;const m=s.getContext("2d"),g=[];async function M(){v==u&&a.isSupported()&&(v=await a.start(e,e=>{p=e},{type:"bitmap"}))}(async()=>{await M(),v(),v=u})();let y=u;return{canvas:s,sprinkle(){d=!1,c==u&&(l(),l=h(()=>w(m,g,{width:n,height:o,bodyMaskBitmap:p}),2),c=h(()=>{r+=1,d||r%i!=0||g.push(f({width:n,height:o}));for(let e=0;e<g.length;e+=1){const a=g[e];a.y.v>o?(g.splice(e,1),0===g.length&&(c(),c=u,m.clearRect(0,0,n,o),l(),l=u,v(),v=u,r=0,i=22,t.onEnded())):(a.x.v+=a.x.spd,a.y.v+=a.y.spd,a.rz.v=r*a.rz.spd*a.rz.d,a.rx.v=Math.sin(r*a.rx.spd)*a.rx.d,a.z.v=(Math.sin(r*a.z.spd)+3)/a.z.scaleRate)}},2)),M(),y(),y=h(()=>{d=!0,y()},300);const e=i-4;e<2||(i=e)}}}function w(e,t,n){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,n.width,n.height),e.globalCompositeOperation="source-over";for(const a of t){const[t,n,o,s]=p[a.type];e.setTransform(1,0,0,1,a.x.v+o/2,a.y.v+s/2),e.rotate(a.rz.v),e.scale(1,a.rx.v),e.drawImage(v,t,n,o,s,-o/a.z.v/2,-s/a.z.v/2,o/a.z.v,s/a.z.v)}null!=n.bodyMaskBitmap&&(e.setTransform(1,0,0,1,0,0),e.globalCompositeOperation="destination-in",e.drawImage(n.bodyMaskBitmap,0,0,n.width,n.height))}function f(e){const t=e.height/720;return{x:{v:Math.random()*e.width-80,spd:(Math.random()+.5)*t},y:{v:-70,spd:(3*Math.random()+2)*t},z:{v:0,d:Math.random()>.5?1:-1,spd:Math.random()/30,scaleRate:t},rz:{v:2*Math.random()*Math.PI,d:Math.random()>.5?1:-1,spd:Math.random()/20},rx:{v:2*Math.random()*Math.PI,d:Math.random()>.5?1:-1,spd:Math.random()/40},type:Math.floor(3*Math.random())}}
},{}],"ZWNU":[function(require,module,exports) {
"use strict";var e,t,n,o,i,r,a,s,l,c,u,d,f,h,p,m,y=this&&this.__assign||function(){return(y=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},k=this&&this.__createBinding||(Object.create?function(e,t,n,o){void 0===o&&(o=n);var i=Object.getOwnPropertyDescriptor(t,n);i&&("get"in i?t.__esModule:!i.writable&&!i.configurable)||(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,o,i)}:function(e,t,n,o){void 0===o&&(o=n),e[o]=t[n]}),v=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),b=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&k(t,e,n);return v(t,e),t},g=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(i,r){function a(e){try{l(o.next(e))}catch(t){r(t)}}function s(e){try{l(o.throw(e))}catch(t){r(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,s)}l((o=o.apply(e,t||[])).next())})},w=this&&this.__generator||function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,s[0]&&(a=0)),a;)try{if(n=1,o&&(i=2&s[0]?o.return:s[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,s[1])).done)return i;switch(o=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,o=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(l){s=[6,l],o=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},_=this&&this.__classPrivateFieldSet||function(e,t,n,o,i){if("m"===o)throw new TypeError("Private method is not writable");if("a"===o&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?i.call(e,n):i?i.value=n:t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t,n,o){if("a"===n&&!o)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?o:"a"===n?o.call(e):o?o.value:t.get(e)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.roomBlockAdapter=exports.DanmakuBiz=void 0;var S=require("@bilibili-live/web-player-common"),D=b(require("@bilibili-live/web-player-danmaku")),T=require("./biz-interface"),B=require("./biz-common"),O=require("@bilibili-live/live-shadow"),x={mode:1,size:25,color:16777215},j=function(){function k(y,k){var v=this;this.container=y,this.opts=k,e.set(this,void 0),t.set(this,[]),n.set(this,[]),o.set(this,{rank:!1,verify:!1,level:0}),i.set(this,[]),r.set(this,[]),a.set(this,null),s.set(this,!1),l.set(this,{}),c.set(this,0),u.set(this,{mode:x.mode,color:x.color,length:20}),d.set(this,{type:"level",level:0,second:0}),f.set(this,!0),this.bodyMaskDetectorStatus=!1,h.set(this,[]),p.set(this,!1),this.maskState=!1,this.isBlocked=function(e){var a;return!!M(v,i,"f").includes(e.type)||(!!M(v,r,"f").includes(e.dmType)||(M(v,o,"f").level>e.user.level||(!!(M(v,o,"f").rank&&e.user.rank<1e4)||(!(null===(a=M(v,o,"f"))||void 0===a||!a.verify||e.user.verify)||(!!M(v,n,"f").some(function(t){return e.text.includes(t)})||!!M(v,t,"f").some(function(t){return t.id===e.uid}))))))},m.set(this,function(e){if(null!=e&&(Array.isArray(e.keyword_list)&&e.keyword_list.forEach(function(e){v.blockKeyword(e,"add")}),Array.isArray(e.shield_user_list)&&e.shield_user_list.forEach(function(e){var t=e.uid,n=e.uname;v.blockUser({uid:t,uname:n},"add")}),null!=(null==e?void 0:e.shield_rules))){var t=e.shield_rules;M(v,o,"f").level=Number(t.level),M(v,o,"f").rank=Boolean(t.rank),M(v,o,"f").verify=Boolean(t.verify)}}),this.getDanmakuElement=function(){return M(v,e,"f").getDanmakuElement()},this.fullscreenDM=function(){M(v,e,"f").fullscreenDM()},this.offsetDM=function(t){M(v,e,"f").offsetDM(t)},_(this,e,new D.default(this.container,k),"f"),this.danmakuStateHandler=K(this),(0,B.updateDanmakuSetting)(S.userSetting.getDanmaku(),this)}return k.supportMaskDanmaku=function(){return O.bodyMaskDetector.isSupported()},k.prototype.onSei=function(t){M(this,e,"f").addMaskSVG(t)},k.prototype.clearMask=function(){M(this,e,"f").clearMask()},k.prototype.changeMaskState=function(t,n,o){void 0===o&&(o=!1),this.maskState=n,n?M(this,e,"f").addMaskToWrap(t):M(this,e,"f").closeMask(o)},k.prototype.connectSocket=function(t,n){_(this,a,L(M(this,e,"f"),this,t,y(y({},this.opts),{isBlocked:this.isBlocked,emitDanmaku:n})),"f")},k.prototype.initDanmakuConfig=function(e){_(this,s,!0,"f"),null!=e.userBlockInfo&&M(this,m,"f").call(this,e.userBlockInfo),null!=e.danmakuInfo&&_(this,u,Object.assign(M(this,u,"f"),e.danmakuInfo),"f"),null!=e.roomBlockInfo&&_(this,d,Object.assign(M(this,d,"f"),e.roomBlockInfo),"f")},k.prototype.getBlockList=function(){return M(this,n,"f").concat(M(this,t,"f").map(function(e){var t=e.id,n=e.name;return"".concat(t,"_").concat(n)}))},k.prototype.setBlockTypes=function(e){Array.isArray(e)&&_(this,i,e,"f")},k.prototype.setBlockSpecialDanmakuTypes=function(e){Array.isArray(e)&&_(this,r,e,"f")},k.prototype.blockUser=function(e,n){"add"===n&&null!=e.uid&&null!=e.uname?(M(this,l,"f")[M(this,c,"f")]={type:"user",value:e.uid},_(this,c,M(this,c,"f")+1,"f"),M(this,t,"f").push({id:e.uid,name:e.uname})):"del"===n&&_(this,t,M(this,t,"f").filter(function(t){return t.id!==e.uid}),"f")},k.prototype.supportMaskDanmaku=function(){return O.bodyMaskDetector.isSupported()},k.prototype.setDanmakuMask=function(t){var n=M(this,e,"f").getDanmakuElement();""!==t?(n.style.webkitMaskImage="url(".concat(t,")"),n.style.webkitMaskSize="100%, 100%"):(n.style.webkitMaskImage="",n.style.webkitMaskSize="")},k.prototype.enableMaskDanmaku=function(e){var t,n=this;null===(t=this.stopBodyMaskDetector)||void 0===t||t.call(this),S.logger.debug("enable MaskDanmaku"),M(this,f,"f")&&(this.bodyMaskDetectorStatus=!0,O.bodyMaskDetector.start(e,function(e){M(n,p,"f")?n.setDanmakuMask(""):"string"==typeof e&&n.setDanmakuMask(e)},{type:"base64"}).then(function(e){S.logger.info("stop resolved");var t=function(){S.logger.info("clear trigger, ".concat(M(n,h,"f").length)),M(n,h,"f").forEach(function(e){return null==e?void 0:e()}),_(n,h,[],"f")};t(),M(n,h,"f").push(e),n.stopBodyMaskDetector=function(){S.logger.info("stop trigger"),n.setDanmakuMask(""),n.stopBodyMaskDetector=void 0,n.bodyMaskDetectorStatus=!1,t()},n.bodyMaskDetectorStatus||n.stopBodyMaskDetector()}).catch(function(e){n.setDanmakuMask(""),S.logger.error(e)}))},k.prototype.blockKeyword=function(e,t){"add"!==t||M(this,n,"f").includes(e)?"del"===t&&_(this,n,M(this,n,"f").filter(function(t){return t!==e}),"f"):(M(this,l,"f")[M(this,c,"f")]={type:"keyword",value:e},_(this,c,M(this,c,"f")+1,"f"),M(this,n,"f").push(e))},k.prototype.findBlockKwOrUserByIdx=function(e){return M(this,l,"f")[e]},k.prototype.blockBatchUsers=function(e,t){"level"===e?M(this,o,"f").level=t:["rank","verify"].includes(e)&&(M(this,o,"f")[e]=Boolean(t))},k.prototype.clear=function(){M(this,e,"f").clear()},k.prototype.userSendDanmaku=function(t){var n,o,i,r,a;return g(this,void 0,Promise,function(){var s,l=this;return w(this,function(c){switch(c.label){case 0:return s={stime:-1,mode:null!==(n=t.mode)&&void 0!==n?n:x.mode,size:null!==(o=t.fontsize)&&void 0!==o?o:x.size,color:null!==(i=t.color)&&void 0!==i?i:x.color,date:performance.now(),uid:this.opts.userId,dmid:this.opts.rnd,text:t.msg,border:!0,borderColor:"66FFFF",uname:"",isMaster:!0,dmType:D.DmType.Text},t.dm_type===D.DmType.Emoji&&(s=Object.assign({},s,{emoticonOptions:t.emoticonOptions,text:null===(r=t.emoticonOptions)||void 0===r?void 0:r.emoji,dmType:D.DmType.Emoji}),delete t.emoticonOptions),delete t.isIgnore,delete t.uniqueID,!0!==t.localOnly?[3,2]:(M(this,e,"f").add(y(y({},s),{extra:null!==(a=t.extra)&&void 0!==a?a:{}}),!0),[4,Promise.resolve(null)]);case 1:return[2,c.sent()];case 2:return[4,new Promise(function(n,o){E(y(y({},t),{color:s.color,fontsize:s.size,mode:s.mode,rnd:s.dmid,roomid:l.opts.roomId}),function(o){var i,r,a;if(0===o.code&&M(l,f,"f")){var c=null===(i=o.data)||void 0===i?void 0:i.mode_info;s.modeInfo=c,s.dm_v2=o.data.dm_v2,s.dmType===D.DmType.Emoji&&1!==(null!==(a=null===(r=t.emoticonOptions)||void 0===r?void 0:r.inPlayerArea)&&void 0!==a?a:1)||M(l,e,"f").add(s,!0)}n(o)}).catch(function(e){o(e)})})];case 3:return[2,c.sent()]}})})},k.prototype.onSelect=function(t){M(this,e,"f").onSelect(t)},k.prototype.offSelect=function(){M(this,e,"f").offSelect()},k.prototype.getDanmakuConfig=function(){var e=M(this,u,"f").color.toString(16);return e=(Array(6).join("0")+e).slice(-6),{ready:M(this,s,"f"),level:M(this,o,"f").level,shield_list:this.getBlockList(),shield_keyword:M(this,n,"f"),shield_users:M(this,t,"f").map(function(e){var t=e.id,n=e.name;return"".concat(t,"_").concat(n)}),danmu_color:"0x".concat(e),danmu_length:M(this,u,"f").length,danmu_mode:M(this,u,"f").mode,room_silent_type:M(this,d,"f").type,room_silent_level:M(this,d,"f").level,room_silent_second:M(this,d,"f").second,user_silent_level:M(this,o,"f").level,user_silent_rank:M(this,o,"f").rank,user_silent_verify:M(this,o,"f").verify}},k.prototype.fetchBlockRules=function(){var e=this;(0,S.ajax)("/banned_service/v1/shield/get_shield_info").then(function(t){M(e,m,"f").call(e,t)}).catch(function(e){S.logger.error(e)})},k.prototype.show=function(){_(this,f,!0,"f"),M(this,e,"f").show(),this.danmakuStateHandler.dmSwitch(!0)},k.prototype.hide=function(){_(this,f,!1,"f"),M(this,e,"f").hide(),this.danmakuStateHandler.dmSwitch(!1)},k.prototype.resize=function(){M(this,e,"f").resize()},k.prototype.set=function(){for(var t,n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];(t=M(this,e,"f")).set.apply(t,n)},k.prototype.destroy=function(){var t,n;null===(t=M(this,a,"f"))||void 0===t||t.call(this),M(this,e,"f").destroy(),null===(n=this.stopBodyMaskDetector)||void 0===n||n.call(this),this.danmakuStateHandler.destroy()},k.prototype.updateDanmakuExtraConfig=function(e,t){var n,o,i;void 0===t&&(t=!1),_(this,p,e.dm_tag>0&&e.platform.includes(t?T.EPlatform.H5:T.EPlatform.Web),"f"),this.set({extra:{type:M(this,p,"f")?e.dm_tag:0,useMode:null!==(n=null==e?void 0:e.dm_mode)&&void 0!==n?n:[],config:null!==(o=null==e?void 0:e.dm_chronos_extra)&&void 0!==o?o:"",material:null!==(i=null==e?void 0:e.material_conf)&&void 0!==i?i:[]}})},k}();function P(e,t,n,o){if("block"===e.component){var i=e.action,r=e.data,a=e.callback;switch(i){case"addShieldUser":t.blockUser(null!=r?r:{},"add"),o("addShieldList",{code:0,msg:"".concat(r.uid,"_").concat(r.uname,"]}")});break;case"addShieldWord":A("add",r,function(e){0===e.code?(t.blockKeyword(r,"add"),o("addShieldList",{code:0,msg:r})):o("addShieldList",Object.assign({},e,{msg:e.message}))});break;case"deleteShieldId":Array.isArray(r)&&r.forEach(function(e){var i=t.findBlockKwOrUserByIdx(e),r=i.type,a=i.value;"keyword"===r?A("del",a,function(n){0===n.code?(t.blockKeyword(a,"del"),o("deleteShieldList",{code:0,msg:[e]})):o("deleteShieldList",Object.assign({},n,{msg:n.message}))}):"user"===r&&I("del",a,n,function(n){0===n.code?(t.blockUser({uid:a},"del"),o("deleteShieldList",{code:0,msg:[e]})):o("deleteShieldList",n)})});break;case"blockDanmaku":t.setBlockTypes(r.type);break;case"blockSpecialDanmaku":t.setBlockSpecialDanmakuTypes(r.type);break;case"roomListShield":W(Boolean(r),n).then(function(){o("roomListShield",Boolean(r))}).catch(function(e){S.logger.error(e)});break;case"globalShield":if(null==(null==r?void 0:r.type))break;z({type:r.type,level:r.level,minute:r.minutes},n,function(e){o("globalShield",e)});break;case"setUserShield":U({type:r.type,level:r.level,callback:function(e){null==a||a(e),0===e.code&&t.blockBatchUsers(r.type,r.level)}}).catch(function(e){S.logger.error(e)})}}}function E(e,t){return g(this,void 0,Promise,function(){return w(this,function(n){switch(n.label){case 0:return[4,(0,S.ajax)("/msg/send",{method:"POST",data:e,handleRes:t})];case 1:return[2,n.sent()]}})})}function A(e,t,n){var o="/xlive/web-ucenter/v1/banned/DelShieldKeyword";"add"===e&&(o="/xlive/web-ucenter/v1/banned/AddShieldKeyword"),(0,S.ajax)(o,{method:"POST",data:{keyword:t},handleRes:n}).catch(function(e){S.logger.error(e)})}function I(e,t,n,o){(0,S.ajax)("/liveact/shield_user",{method:"POST",data:{uid:t,roomid:n,type:"add"===e?1:0},handleRes:o}).catch(function(e){S.logger.error(e)})}function W(e,t){return g(this,void 0,Promise,function(){return w(this,function(n){switch(n.label){case 0:return[4,(0,S.ajax)("/liveact/set_room_shield",{method:"POST",data:{roomid:t,type:e}})];case 1:return n.sent(),[2]}})})}function z(e,t,n){var o=e.type,i=e.level,r=e.minute;(0,S.ajax)("/liveact/room_silent",{method:"POST",data:{room_id:t,type:o,level:i,minute:r},handleRes:n}).catch(function(e){S.logger.error(e)})}function U(e){var t=e.type,n=e.level,o=e.callback;return g(this,void 0,Promise,function(){return w(this,function(e){switch(e.label){case 0:return[4,(0,S.ajax)("/liveact/user_silent",{method:"POST",data:{type:t,level:n},handleRes:o})];case 1:return e.sent(),[2]}})})}function L(e,t,n,o){var i=o.userId,r=o.rnd,a=o.isBlocked,s=o.emitDanmaku,l=o.isMobile;return e.clear(),e.play(),n.on("message",function(n){var o,c,u,d;if("DANMU_TAG_CHANGE"===n.cmd&&t.updateDanmakuExtraConfig(n.data,l),n.cmd.startsWith("DANMU_MSG")){var f=N(n.cmd),h=f.web,p=f.h5,m=C(n.info);m.dm_v2=n.dm_v2;var k=null!==(c=null===(o=m.modeInfo)||void 0===o?void 0:o.extra)&&void 0!==c?c:"{}",v={is_audited:!1};try{v=JSON.parse(k)}catch(g){S.logger.error(g)}if((v.is_audited||m.uid!==i||m.dmid!==r)&&!a(m)){var b=!0===l?p:h;b.danmaku&&(m.dmType===D.DmType.Emoji&&1!==(null!==(d=null===(u=m.emoticonOptions)||void 0===u?void 0:u.in_player_area)&&void 0!==d?d:1)||(e.add(m),t.danmakuStateHandler.dmMsg())),b.panel&&s(y(y({},n),{cmd:"DANMU_MSG"}))}}})}function N(e){if(!e.includes(":"))return{h5:{danmaku:!0,panel:!0},web:{danmaku:!0,panel:!0}};var t=e.split(":"),n=t[4],o=t[5];return{web:{panel:0==(1&Number(n)),danmaku:0==(Number(n)>>1&1)},h5:{panel:0==(1&Number(o)),danmaku:0==(Number(o)>>1&1)}}}function C(e){var t=e[0][12],n=e[0][14],o=e[0][13],i={stime:-1,mode:e[0][1],size:e[0][2],color:e[0][3],date:performance.now(),uid:e[2][0],dmid:e[0][5],text:e[1],uname:e[2][1],user:{level:e[4][0],rank:e[2][5],verify:Boolean(e[2][6])},checkInfo:{ts:e[9].ts,ct:e[9].ct},type:e[0][9],dmType:D.DmType.Text,modeInfo:e[0][15]};return t===D.DmType.Emoji?Object.assign({},i,{emoticonOptions:o,dmType:D.DmType.Emoji}):t===D.DmType.Voice?Object.assign({},i,{dmType:D.DmType.Voice,voiceConfig:n}):i}exports.DanmakuBiz=j,e=new WeakMap,t=new WeakMap,n=new WeakMap,o=new WeakMap,i=new WeakMap,r=new WeakMap,a=new WeakMap,s=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,f=new WeakMap,h=new WeakMap,p=new WeakMap,m=new WeakMap,exports.roomBlockAdapter=P;var K=function(e){var t=null,n=-1,o=!1,i=!1,r=!1,a=!0,s=function(){var n;i&&r&&o&&null!=t?a||(a=!0,e.enableMaskDanmaku(t)):(a=!1,null===(n=e.stopBodyMaskDetector)||void 0===n||n.call(e))};return{dmSwitch:function(e){o=e,s()},updateVideoEl:function(e){t=e,s()},maskSwitch:function(e){i=e,s()},dmMsg:function(){clearTimeout(n),r=!0,n=window.setTimeout(function(){r=!1,s()},2e4),s()},destroy:function(){clearTimeout(n)}}};
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-danmaku":"uyEh","./biz-interface":"Rr2x","./biz-common":"YQ89","@bilibili-live/live-shadow":"ipbQ"}],"vDPq":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var n,t=1,o=arguments.length;t<o;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,n,t,o){return new(t||(t=Promise))(function(i,r){function a(e){try{s(o.next(e))}catch(n){r(n)}}function l(e){try{s(o.throw(e))}catch(n){r(n)}}function s(e){var n;e.done?i(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(a,l)}s((o=o.apply(e,n||[])).next())})},t=this&&this.__generator||function(e,n){var t,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(l){return function(s){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;r&&(r=0,l[0]&&(a=0)),a;)try{if(t=1,o&&(i=2&l[0]?o.return:l[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,l[1])).done)return i;switch(o=0,i&&(l=[2&l[0],i.value]),l[0]){case 0:case 1:i=l;break;case 4:return a.label++,{value:l[1],done:!1};case 5:a.label++,o=l[1],l=[0];continue;case 7:l=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){a=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){a.label=l[1];break}if(6===l[0]&&a.label<i[1]){a.label=i[1],i=l;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(l);break}i[2]&&a.ops.pop(),a.trys.pop();continue}l=n.call(e,a)}catch(s){l=[6,s],o=0}finally{t=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}},o=this&&this.__spreadArray||function(e,n,t){if(t||2===arguments.length)for(var o,i=0,r=n.length;i<r;i++)!o&&i in n||(o||(o=Array.prototype.slice.call(n,0,i)),o[i]=n[i]);return e.concat(o||Array.prototype.slice.call(n))};Object.defineProperty(exports,"__esModule",{value:!0}),exports.endRecommendPanel=void 0;var i,r,a=require("@bilibili-live/web-player-common");function l(e,n,t,o,i){n.classList.add("web-player-ending-panel"),n.style.cssText="\n    z-index: 3;\n    color: #fff;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    background: #000;\n  ",n.appendChild(s(t,o,i))}function s(e,n,t){var o=document.createElement("div"),a=document.createElement("div");return o.style.cssText="\n    width: 606px;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    -webkit-transform: translate3d(-50%, -50%, 0);\n    -moz-transform: translate3d(-50%, -50%, 0);\n    -ms-transform: translate3d(-50%, -50%, 0);\n    -o-transform: translate3d(-50%, -50%, 0);\n    transform: translate3d(-50%, -50%, 0);\n  ",e.style.cssText="\n    font-size: 28px;\n    color: #aaa;\n    text-align: center;\n    line-height: 50px;\n    height: 50px;\n    margin-bottom: 20px;\n  ",o.appendChild(e),n.classList.add("web-player-ending-panel-recommendList"),t.forEach(function(e,t){t<6&&r("info",{type:i.recommendListShow,data:e}),n.appendChild(c(e))}),n.style.cssText="\n    display: ".concat(t.length>0?"block":"none",";\n    height: 236px;\n    overflow: hidden;\n  "),a.innerText="闲置中",a.style.cssText="display: none;",o.appendChild(n),o.appendChild(a),o}function c(e){var n,t,o=document.createElement("a"),l=document.createElement("div"),s=document.createElement("div");l.style.cssText="\n    position: relative;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n  ",s.style.cssText="\n    width: 100%;\n    position: absolute;\n    height: 50px;\n    bottom: -20px;\n    z-index: 3;\n    background-image: linear-gradient(-180deg, rgba(0, 0, 0, 0) 0%, #000000 100%);\n    color: #fffff;\n    -webkit-transition: bottom 0.3s ease-in-out;\n    -moz-transition: bottom 0.3s ease-in-out;\n    -ms-transition: bottom 0.3s ease-in-out;\n    -o-transition: bottom 0.3s ease-in-out;\n    transition: bottom 0.3s ease-in-out;\n  ";var c=document.createElement("div");c.style.cssText="\n    margin-top: 8px;\n    height: 16px;\n    position: relative;\n    line-height: 16px;\n    color: '#fff\n  ";var d=document.createElement("div");d.innerText=e.title,d.style.cssText="\n    padding: 0 8px;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    color: #fff;\n  ";var p=document.createElement("div");p.style.cssText="\n    padding: 6px 8px;\n    color: #969696;\n    height: 16px;\n    position: relative;\n    line-height: 16px;\n  ";var u=document.createElement("div");u.style.cssText="\n    width: 60%;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    float: left;\n  ",u.innerText=e.uname;var h=document.createElement("span");h.style.cssText="\n    float: right;\n  ","online"in e&&(e.online>1e4?h.innerHTML=Math.floor(e.online/1e4).toString()+"万":h.innerText=e.online.toString()),!0===(null===(n=e.watched_show)||void 0===n?void 0:n.switch)&&null!=(null===(t=e.watched_show)||void 0===t?void 0:t.text_small)&&(h.innerText=e.watched_show.text_small),p.appendChild(u),p.appendChild(h),c.appendChild(d),s.appendChild(c),s.appendChild(p);var m=document.createElement("img");if(m.alt=e.title,m.src="".concat(e.cover).concat((0,a.isWebPSupported)()?"@384w_240h.webp":"@384w_240h.jpg"),m.style.cssText="\n    width: 100%;\n    height: 100%;\n    border: none;\n  ",l.appendChild(m),o.appendChild(l),o.appendChild(s),o.style.cssText="\n    width: 192px;\n    height: 108px;\n    -webkit-border-radius: 2px;\n    -moz-border-radius: 2px;\n    border-radius: 2px;\n    float: left;\n    overflow: hidden;\n    display: inline-block;\n    position: relative;\n    margin: 5px;\n    text-decoration: none;\n    outline: none;\n    color: #444;\n    font-size: 12px;\n    cursor: pointer;\n  ",o.href="javascript:void(0);",o.addEventListener("mouseover",function(){s.style.bottom="0px"}),o.addEventListener("mouseout",function(){s.style.bottom="-20px"}),o.onclick=function(){var n="text"in e?"//www.bilibili.com/video/".concat(e.bvid):"//live.bilibili.com/".concat(e.roomid);n="".concat(n,"?live_from=75001"),window.open(n),r("info",{type:i.recommendListClick,data:e}),r("redirect",{type:i.recommendListClick,data:n})},o.onmouseenter=function(){r("info",{type:i.recommendListMoveEnter,data:e})},"text"in e){var f=document.createElement("div");f.innerText=e.text,f.style.cssText="\n      background: #4fc1e9;\n      position: absolute;\n      top: 4px;\n      right: 5px;\n      height: 16px;\n      line-height: 16px;\n      width: 48px;\n      padding: 1px 4px;\n      color: #fff;\n      border-radius: 2px;\n    ",l.appendChild(f)}return o}function d(e,n,t,o,i){var s=t.roomId,c=t.rnd,d=t.showRecommend;void 0===i&&(i=""),r=o;var u=document.createElement("div"),h=document.createElement("div"),m=d;if(d){var f=(0,a.loading)(e);p(s,c).then(function(t){if(f(),m){var o=t.tips,r=void 0===o?"主播已关播":o,a=t.recommend,s=void 0===a?[]:a;h.innerText=r,""!==i&&(h.innerText=i),l(e,n,h,u,s)}else h.innerText="主播已关播",l(e,n,h,u,[])}).catch(function(e){a.logger.error(e),f()})}else h.innerText="主播已关播",l(e,n,h,u,[]);return function(){m=!1,h.innerText="主播已关播",u.style.display="none"}}function p(l,s){return n(this,void 0,Promise,function(){var n,c;return t(this,function(t){switch(t.label){case 0:return[4,(0,a.ajax)("/xlive/web-room/v1/index/getOffLiveList?room_id=".concat(l,"&count=8&rnd=").concat(s.toFixed(0)))];case 1:return null!=(n=t.sent())&&Array.isArray(n.recommend)||r("info",{type:i.recommendListNull}),c=n.record_list.map(function(n){return e(e({},n),{roomid:n.rid,text:"主播推荐"})}),n.recommend=o(o([],c,!0),n.recommend,!0).sort(function(e,n){return e.global_order-n.global_order}),[2,n]}})})}!function(e){e.recommendListNull="nolive",e.recommendListClick="click",e.recommendListMoveEnter="move",e.recommendListShow="show"}(i||(i={})),exports.endRecommendPanel=d;
},{"@bilibili-live/web-player-common":"KGHo"}],"vS7T":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var a=require("../biz-interface"),n='\n  <svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 157 45">\n    <defs>\n      <style>\n        .cls-1,\n        .cls-2 {\n          fill: #fff;\n          opacity: 0.4;\n          filter: url(#shadow);\n        }\n\n        .cls-2 {\n          fill-rule: evenodd;\n        }\n      </style>\n    </defs>\n    <defs>\n      <filter id="shadow">\n        <feDropShadow dx="1" dy="2" stdDeviation="1" />\n      </filter>\n    </defs>\n    <path class="cls-1 xxx"\n      d="M124.92,10.08h-9.28l.86-2a.31.31,0,0,0-.28-.43h-4a.62.62,0,0,0-.56.38l-.88,2.07H99.8a.3.3,0,0,0-.3.31v1.23a.29.29,0,0,0,.3.3H110L108.66,15H102a.3.3,0,0,0-.31.3v23H99.8a.29.29,0,0,0-.3.3V39.8a.3.3,0,0,0,.3.31h25.12a.31.31,0,0,0,.31-.31V38.57a.3.3,0,0,0-.31-.3h-1.84V16.21A1.21,1.21,0,0,0,121.86,15h-8.3l1.3-3.07h10.06a.3.3,0,0,0,.31-.3V10.39A.31.31,0,0,0,124.92,10.08Zm-6.74,28.19H106.54V34.59h11.64Zm0-5.52H106.54V28.46h11.64Zm0-6.12H106.54V22.34h11.64Zm-.61-9.81a.61.61,0,0,1,.61.62V20.5H106.54V16.82Z" />\n    <path class="cls-1"\n      d="M137.06,26.83l-1.42.59V15.6h1.54a.3.3,0,0,0,.3-.31V14.07a.3.3,0,0,0-.3-.31h-1.54V7.94a.3.3,0,0,0-.3-.31h-4.29a.31.31,0,0,0-.31.31v5.82h-1.53a.31.31,0,0,0-.31.31v1.22a.31.31,0,0,0,.31.31h1.53V29.51l-1.46.62a.61.61,0,0,0-.38.56v1a.31.31,0,0,0,.43.28l1.41-.6v6.93a.61.61,0,0,1-.61.61h-.76a.3.3,0,0,0-.28.43l.44,1a.6.6,0,0,0,.56.37h4.33a1.22,1.22,0,0,0,1.22-1.23V29.26l1.47-.62a.61.61,0,0,0,.37-.56v-1A.3.3,0,0,0,137.06,26.83Z" />\n    <path class="cls-1"\n      d="M138.49,17.44h5.82v6.12a.31.31,0,0,0,.31.31h3.68a.3.3,0,0,0,.3-.31V17.44h5.82a.31.31,0,0,0,.31-.31V15.9a.31.31,0,0,0-.31-.3H148.6V10.7h4a1.25,1.25,0,0,0,1.13-.75l.8-1.89a.31.31,0,0,0-.28-.43h-3.42a.62.62,0,0,0-.57.38l-.2.48a.62.62,0,0,1-.56.37h-11a.3.3,0,0,0-.3.31v1.22a.3.3,0,0,0,.3.31h5.82v4.9h-5.82a.3.3,0,0,0-.3.3v1.23A.3.3,0,0,0,138.49,17.44Z" />\n    <path class="cls-1"\n      d="M154.36,11.62h-3.42a.59.59,0,0,0-.56.37l-1,2.26a.31.31,0,0,0,.29.43h3.62a.3.3,0,0,0,.28-.19l1-2.45A.3.3,0,0,0,154.36,11.62Z" />\n    <path class="cls-1"\n      d="M155.68,23.44l-2.08-4.9a.31.31,0,0,0-.28-.18H149.7a.31.31,0,0,0-.29.42l2.16,5.09h3.83A.3.3,0,0,0,155.68,23.44Z" />\n    <path class="cls-1"\n      d="M139.25,14.31a.63.63,0,0,0,.57.37h3.42a.3.3,0,0,0,.28-.43l-1-2.26a.61.61,0,0,0-.56-.37h-3.42a.31.31,0,0,0-.29.42Z" />\n    <path class="cls-1"\n      d="M143.52,18.78a.3.3,0,0,0-.28-.42h-3.62a.31.31,0,0,0-.29.18l-2.08,4.9a.31.31,0,0,0,.29.43h3.82Z" />\n    <path class="cls-1"\n      d="M153.2,25.4H138.8a.31.31,0,0,0-.31.31V39.8a.31.31,0,0,0,.31.31h15.32a.3.3,0,0,0,.3-.31V26.63A1.22,1.22,0,0,0,153.2,25.4Zm-8.89,12.87h-1.53v-4.9h1.53Zm0-6.74h-1.53V27.24h1.53Zm5.82,6.74H148.6v-4.9h1.53Zm0-6.74H148.6V27.24h.92a.61.61,0,0,1,.61.61Z" />\n    <path class="cls-1"\n      d="M32.47,5.09l4.14-.51a.23.23,0,0,1,.25.21l2.66,31.36a.22.22,0,0,1-.22.24h-3a.25.25,0,0,1-.24-.21L32.27,5.35A.24.24,0,0,1,32.47,5.09Z" />\n    <path class="cls-2"\n      d="M26.84,21.69l4.62-.57a.24.24,0,0,1,.27.2l2,16.42a.21.21,0,0,1-.19.24l-3.41.43a.21.21,0,0,1-.23-.17L26.64,22A.23.23,0,0,1,26.84,21.69Z" />\n    <path class="cls-2"\n      d="M41.21,21.44h4.55a.22.22,0,0,1,.22.22V38.25a.21.21,0,0,1-.21.21H42.48a.23.23,0,0,1-.23-.21L41,21.68A.22.22,0,0,1,41.21,21.44Z" />\n    <path class="cls-2"\n      d="M25.36,13.32l2-.24a.22.22,0,0,1,.25.19l.79,5.92a.22.22,0,0,1-.19.25l-1.56.19a.22.22,0,0,1-.25-.18l-1.18-5.89A.19.19,0,0,1,25.36,13.32Z" />\n    <path class="cls-2"\n      d="M28.44,13.16l.73,5.94a.22.22,0,0,0,.24.19l1.82-.23a.22.22,0,0,0,.19-.24l-.73-6a.21.21,0,0,0-.23-.18l-1.83.23A.21.21,0,0,0,28.44,13.16Z" />\n    <path class="cls-2"\n      d="M40.35,13.21l.46,6a.21.21,0,0,0,.2.19h1.61a.21.21,0,0,0,.21-.21l-.13-6a.22.22,0,0,0-.22-.21H40.56A.2.2,0,0,0,40.35,13.21Z" />\n    <path class="cls-2"\n      d="M43.5,13.21l.13,6a.22.22,0,0,0,.22.22h1.71a.22.22,0,0,0,.22-.22v-6a.21.21,0,0,0-.21-.21H43.71A.21.21,0,0,0,43.5,13.21Z" />\n    <path class="cls-2"\n      d="M52.21,40.3a.25.25,0,0,0,.22.23,26.47,26.47,0,0,0,17.13-3.72c2.65-1.63,6.3-5.58,1-8.59a24.15,24.15,0,0,0-14.72-3.06.25.25,0,0,1-.28-.22A138.25,138.25,0,0,1,54.67.58a.2.2,0,0,0-.27-.2L47.51,2.89a.23.23,0,0,0-.15.26A354.89,354.89,0,0,1,52.21,40.3Zm13.51-8.11a27.14,27.14,0,0,1-6,4.23.22.22,0,0,1-.32-.14c-.11-.55-.59-4-.87-6.63a.22.22,0,0,1,.25-.24,22.53,22.53,0,0,1,6.85,2.41C65.83,31.92,65.83,32.09,65.72,32.19Z" />\n    <path class="cls-2"\n      d="M6.14,40.3a.26.26,0,0,0,.23.23,26.44,26.44,0,0,0,17.12-3.72c2.65-1.63,6.3-5.58,1-8.59A24.14,24.14,0,0,0,9.81,25.16a.26.26,0,0,1-.28-.22A138.68,138.68,0,0,1,8.61.5.21.21,0,0,0,8.34.29L1.45,2.8a.23.23,0,0,0-.15.26A362.8,362.8,0,0,1,6.14,40.3Zm13.52-8.11a27.39,27.39,0,0,1-6,4.23.22.22,0,0,1-.32-.14c-.12-.55-.6-4-.88-6.63a.22.22,0,0,1,.26-.24,22.79,22.79,0,0,1,6.85,2.41A.22.22,0,0,1,19.66,32.19Z" />\n    <path class="cls-1"\n      d="M78.63,5.09l4.14-.51a.23.23,0,0,1,.25.21l2.66,31.36a.22.22,0,0,1-.22.24h-3a.25.25,0,0,1-.24-.21L78.43,5.35A.24.24,0,0,1,78.63,5.09Z" />\n    <path class="cls-2"\n      d="M73,21.69l4.62-.57a.24.24,0,0,1,.27.2l2,16.42a.21.21,0,0,1-.19.24l-3.41.43a.21.21,0,0,1-.23-.17L72.8,22A.23.23,0,0,1,73,21.69Z" />\n    <path class="cls-2"\n      d="M87.37,21.44h4.55a.22.22,0,0,1,.22.22V38.25a.21.21,0,0,1-.21.21H88.64a.23.23,0,0,1-.23-.21L87.15,21.68A.22.22,0,0,1,87.37,21.44Z" />\n    <path class="cls-2"\n      d="M71.52,13.32l2-.24a.22.22,0,0,1,.25.19l.79,5.92a.22.22,0,0,1-.19.25l-1.56.19a.22.22,0,0,1-.25-.18l-1.18-5.89A.2.2,0,0,1,71.52,13.32Z" />\n    <path class="cls-2"\n      d="M74.6,13.16l.73,5.94a.22.22,0,0,0,.24.19l1.82-.23a.22.22,0,0,0,.19-.24l-.73-6a.21.21,0,0,0-.23-.18l-1.83.23A.22.22,0,0,0,74.6,13.16Z" />\n    <path class="cls-2"\n      d="M86.51,13.21l.46,6a.21.21,0,0,0,.2.19h1.61a.21.21,0,0,0,.21-.21l-.13-6a.22.22,0,0,0-.22-.21H86.72A.2.2,0,0,0,86.51,13.21Z" />\n    <path class="cls-2"\n      d="M89.66,13.21l.13,6a.22.22,0,0,0,.22.22h1.71a.22.22,0,0,0,.22-.22v-6a.21.21,0,0,0-.21-.21H89.87A.21.21,0,0,0,89.66,13.21Z" />\n  </svg>\n',l="https://i0.hdslb.com/bfs/activity-plat/static/20210309/d0411babbbf77c49ca42a3320eb804ae/xUd8TRdAk.png";function s(a,n){void 0===n&&(n=!1);var l=document.createElement("div");return l.className="web-player-icon-roomStatus",l.style.cssText="\n    position: absolute;\n    left: 10px;\n    top: 10px;\n    z-index: 2;\n    pointer-events: none;\n  ",a.appendChild(l),{destroy:function(){l.remove()},setRoomStatus:function(a){t(l,a,n)},el:l}}function t(s,t,c){t===a.RoomStatus.Round?(s.innerHTML="",s.style.cssText+="\n      background-size: 78px 50px;\n      width: 78px;\n      height: 50px;\n      opacity: 0.8;\n      background: url(".concat(l,") no-repeat 0 0;\n    ")):(s.innerHTML=n,s.style.cssText+="\n      width: 122px;\n      height: 43px;\n      opacity: 0.4;\n      background: none;\n      ".concat(c?"transform: scale(0.7);transform-origin: 0 0;":"","\n    "))}exports.default=s;
},{"../biz-interface":"Rr2x"}],"EORf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e='\n  <svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">\n    <defs>\n      <style>\n        .feed-back-cls-1 {\n          fill: #fff;\n          fill-rule: evenodd;\n          filter: url(#shadow);\n        }\n      </style>\n    </defs>\n    <defs>\n      <filter id="shadow">\n        <feDropShadow dx="0.3" dy="0.3" stdDeviation="0.6" />\n      </filter>\n    </defs>\n    <path class="feed-back-cls-1"\n      d="M24,10H12a2,2,0,0,0-2,2V26l3-3H24a2,2,0,0,0,2-2V12A2,2,0,0,0,24,10ZM19,21H17V19h2Zm1.19-4.38a2,2,0,0,0-.18.15l-.37.31c-.49.4-.64.58-.64.92H17c0-1.84,2-1.76,2-3a1,1,0,0,0-1-1,1,1,0,0,0-.81.41.9.9,0,0,0-.11.24.5.5,0,0,1-.48.35h-1a.5.5,0,0,1-.5-.5.28.28,0,0,1,0-.09,3.17,3.17,0,0,1,.21-.72A3,3,0,0,1,21,15,2.14,2.14,0,0,1,20.19,16.62Z" />\n  </svg>\n';function n(n,t){var o=document.createElement("div"),i=0;function s(e){e.stopPropagation(),clearTimeout(i),i=0,o.style.opacity="1.0"}function a(){clearTimeout(i),i=window.setTimeout(function(){o.style.opacity="0"},1e3),o.style.opacity="0.8"}function r(){i=window.setTimeout(function(){o.style.opacity="0"},1e3)}return o.className="web-player-icon-feedback",o.innerHTML=e,o.style.cssText="\n    position: absolute;\n    top: 0px;\n    right: 12px;\n    z-index: 100;\n    width: 36px;\n    height: 36px;\n    cursor: pointer;\n    transition: opacity 0.5s ease 0s;\n    opacity: 0;\n  ",n.appendChild(o),n.addEventListener("mousemove",a),n.addEventListener("mouseleave",r),o.addEventListener("click",t),o.addEventListener("mousemove",s),function(){o.remove(),n.removeEventListener("mousemove",a),n.removeEventListener("mouseleave",r),o.removeEventListener("click",t),o.removeEventListener("mousemove",s),clearTimeout(i)}}exports.default=n;
},{}],"weyG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var n=require("@bilibili-live/web-player-common");function e(e,r,a){void 0===a&&(a=300),n.logger.info("start round count down");var i=e.getElementsByClassName("web-player-video-round-counter");1===i.length&&i[0].remove();var l=document.createElement("div");l.innerHTML='\n    <p style="'.concat(o(20),'">\n      <span>').concat(t(a),'</span>\n      后\n      </p>\n    <p style="').concat(o(30),'">主播的投稿视频将轮流播放</p>\n  '),l.classList.add("web-player-video-round-counter"),l.style.cssText="\n    width: 400px;\n    position: absolute;\n    z-index: 10;\n    pointer-events: none;\n    left: 50%;\n    top: 50%;\n    margin-left: -200px;\n    margin-top: -66px;\n    color: #aaa;\n  ";var c=l.getElementsByTagName("span");c[0].style.fontSize="50px",e.append(l);var s=window.setInterval(function(){a>1?c[0].innerText=t(--a):(clearInterval(s),l.remove(),r().catch(function(e){n.logger.error(e)}))},1e3);return function(){clearInterval(s),l.remove()}}function t(n){var e=Math.floor(n/60),t=Math.floor(n%60);return"0".concat(e,":").concat(t<10?"0"+t.toString():t)}function o(n){return"\n    text-align: center;\n    line-height: 50px;\n    letter-spacing: 3px;\n    font-weight: normal;\n    font-size: ".concat(n,"px;\n    line-height: 1;\n  ")}exports.default=e;
},{"@bilibili-live/web-player-common":"KGHo"}],"ntSr":[function(require,module,exports) {
module.exports={"web-player-context-menu":"_web-player-context-menu_19b1c","context-menu-item":"_context-menu-item_19b1c",disabled:"_disabled_19b1c","context-sub-menu":"_context-sub-menu_19b1c","menu-item-hr":"_menu-item-hr_19b1c","context-menu-right-arrow":"_context-menu-right-arrow_19b1c","context-menu-text":"_context-menu-text_19b1c","context-sub-menu-item":"_context-sub-menu-item_19b1c","left-sub-menu":"_left-sub-menu_19b1c","blp-icon-show":"_blp-icon-show_19b1c","blp-icon-copy":"_blp-icon-copy_19b1c","blp-icon-download":"_blp-icon-download_19b1c"};var e='._web-player-context-menu_19b1c li,ul._web-player-context-menu_19b1c{list-style:none;margin:0;padding:0}ul._web-player-context-menu_19b1c{position:absolute;left:-9999px;top:-9999px;padding:3px;min-width:80px;font-size:12px;color:#eee;background:rgba(28,28,28,.9);border-radius:3px;opacity:0;text-shadow:0 0 2px rgba(0,0,0,.5);transition:opacity .1s cubic-bezier(0,0,.2,1);z-index:99;font-family:PingFang SC,Microsoft YaHei;outline:none}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c{position:relative;padding:3px 20px;width:200px;line-height:22px;cursor:pointer}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c._disabled_19b1c{color:#777;cursor:default}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c:not(._disabled_19b1c):hover{background:hsla(0,0%,100%,.1)}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c:not(._disabled_19b1c):hover ._context-sub-menu_19b1c{width:auto;opacity:1}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c._menu-item-hr_19b1c:before{content:"";position:absolute;bottom:0;left:9px;right:9px;height:1px;background-color:#aaa}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c ._context-menu-right-arrow_19b1c{position:absolute;right:4px;top:10px;width:8px;height:8px}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c ._context-menu-right-arrow_19b1c:before{content:"";position:absolute;top:0;left:0;border:4px solid transparent;border-left-color:#eee;opacity:.8}ul._web-player-context-menu_19b1c ._context-menu-item_19b1c ._context-menu-text_19b1c{display:inline-block;width:100%;text-overflow:ellipsis;white-space:nowrap;vertical-align:middle;overflow:hidden}ul._web-player-context-menu_19b1c ._context-sub-menu_19b1c{list-style:none;outline:none;margin:0;padding:0;position:absolute;left:100%;top:0;width:0;color:#eee;background:rgba(28,28,28,.9);border-radius:3px;opacity:0;overflow:hidden}ul._web-player-context-menu_19b1c ._context-sub-menu_19b1c ._context-sub-menu-item_19b1c{padding:3px 20px;width:120px;height:22px;line-height:22px;text-align:left;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transition:all .3s ease-in-out}ul._web-player-context-menu_19b1c ._context-sub-menu_19b1c ._context-sub-menu-item_19b1c._disabled_19b1c{color:#777;cursor:default}ul._web-player-context-menu_19b1c ._context-sub-menu_19b1c ._context-sub-menu-item_19b1c:not(._disabled_19b1c):hover{background:hsla(0,0%,100%,.1)}ul._web-player-context-menu_19b1c._left-sub-menu_19b1c ._context-sub-menu_19b1c{left:0;transform:translate(-100%)}ul._web-player-context-menu_19b1c ._blp-icon-copy_19b1c,ul._web-player-context-menu_19b1c ._blp-icon-download_19b1c,ul._web-player-context-menu_19b1c ._blp-icon-show_19b1c{width:12px;height:12px;margin-right:6px;display:inline-block;position:relative;top:2px;margin-left:2px;pointer-events:none}ul._web-player-context-menu_19b1c ._blp-icon-copy_19b1c:after,ul._web-player-context-menu_19b1c ._blp-icon-copy_19b1c:before,ul._web-player-context-menu_19b1c ._blp-icon-download_19b1c:after,ul._web-player-context-menu_19b1c ._blp-icon-download_19b1c:before,ul._web-player-context-menu_19b1c ._blp-icon-show_19b1c:after,ul._web-player-context-menu_19b1c ._blp-icon-show_19b1c:before{content:"";position:absolute}ul._web-player-context-menu_19b1c ._blp-icon-show_19b1c:before{width:14px;height:10px;border-radius:14px/10px;background:#aaa;top:1px;left:-1px}ul._web-player-context-menu_19b1c ._blp-icon-show_19b1c:after{width:6px;height:10px;border-radius:6px/10px;background:#777;left:3px;top:1px}ul._web-player-context-menu_19b1c ._blp-icon-copy_19b1c:after,ul._web-player-context-menu_19b1c ._blp-icon-copy_19b1c:before{width:5px;height:5px;border:2px solid #aaa;top:0;left:0;border-radius:1px}ul._web-player-context-menu_19b1c ._blp-icon-copy_19b1c:after{top:4px;left:4px;background:#1c1c1c;background:rgba(28,28,28,.8);-webkit-box-shadow:-1px 0 0 rgba(28,28,28,.8),0 -1px 0 rgba(28,28,28,.8);-moz-box-shadow:-1px 0 0 rgba(28,28,28,.8),0 -1px 0 rgba(28,28,28,.8);box-shadow:-1px 0 0 rgba(28,28,28,.8),0 -1px 0 rgba(28,28,28,.8)}ul._web-player-context-menu_19b1c ._blp-icon-download_19b1c:before{width:6px;height:8px;background:#aaa;top:1px;left:3px;border-radius:1px}ul._web-player-context-menu_19b1c ._blp-icon-download_19b1c:after{border:5px solid transparent;border-top-color:#aaa;top:7px;left:1px}',t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.head.appendChild(t);
},{}],"wERC":[function(require,module,exports) {
"use strict";var e,t=this&&this.__assign||function(){return(t=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},n=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},a=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@bilibili-live/web-player-common"),u=i(require("./index.less")),o=function(){function i(){this.menuContainer=null,e.set(this,{})}return i.prototype.show=function(e,t){void 0===t&&(t=!1),t?this.menuContainer.classList.add(u.default["left-sub-menu"]):this.menuContainer.classList.remove(u.default["left-sub-menu"]);var n=this.menuContainer.style;n.top=e.top+"px",n.left=e.left+"px",n.opacity="1"},i.prototype.hide=function(){var e=this.menuContainer.style;e.top="",e.left="",e.opacity="0"},i.prototype.initContextmenu=function(e){this.menuContainer=this.createMenuUl(u.default["web-player-context-menu"]);var t=this.createContextmenuList(e);this.menuContainer.appendChild(t)},i.prototype.prependMenuItem=function(e,n){var a=t(t({},n),{name:e}),i=this.createMenuElement(a);return this.menuContainer.prepend(i),function(){i.remove()}},i.prototype.resetSubmenu=function(t,a,i,r){var o;void 0===r&&(r=-1);var l=n(this,e)[t];if(null!=l){var s=null!==(o=l.querySelector(u.default["context-sub-menu"]))&&void 0!==o?o:this.createMenuUl(u.default["context-sub-menu"]);s.innerHTML="";var c=a.map(function(e){return{label:e.label,value:e.value,disable:e.value===r,click:i.bind(null,e.value)}}),d=this.createSubmenuFragment(c);s.appendChild(d),l.appendChild(s)}},i.prototype.submenuActive=function(t,a){var i,r=n(this,e)[t];if(null!=r){for(var o=0,l=r.getElementsByClassName(u.default["context-sub-menu-item"]);o<l.length;o++){l[o].classList.remove(u.default.disabled)}null===(i=r.getElementsByClassName(u.default["context-sub-menu-item"])[a])||void 0===i||i.classList.add(u.default.disabled)}},i.prototype.createMenuUl=function(e){return void 0===e&&(e=""),r.createElement("ul",{classname:e})},i.prototype.createArrow=function(){return r.createElement("div",{classname:u.default["context-menu-right-arrow"]})},i.prototype.createMenuLi=function(e){var n=t({disable:!1,hr:!1,remove:!1},e),a=u.default.disabled,i=u.default["menu-item-hr"];return r.createElement("li",{classname:e.classname+(n.disable?" "+a:"")+(n.hr?" "+i:""),text:"",attributes:n.remove?[["data-auto-remove","1"]]:[]})},i.prototype.createSubmenuLi=function(e){var n=t({disable:!1,icon:""},e),a=u.default.disabled,i=r.createElement("li",{classname:n.classname+(n.disable?" "+a:""),text:n.text});if(""!==n.icon){var o=r.createElement("span",{classname:u.default[n.icon]});i.prepend(o)}return i.onclick=function(){!i.className.includes(u.default.disabled)&&n.click(n.index)},i},i.prototype.createContextmenuList=function(e){var t=this,n=document.createDocumentFragment();return e.forEach(function(e){n.appendChild(t.createMenuElement(e))}),n},i.prototype.createMenuElement=function(t){var a=this,i=t.name,o=t.label,l=t.click,s=t.hr,c=void 0!==s&&s,d=t.submenu,m=void 0===d?null:d,p=t.autoRemove,f=void 0!==p&&p,h=this.createMenuLi({text:o,classname:u.default["context-menu-item"],disable:"function"!=typeof l&&null==m,remove:f,hr:c}),v=r.createElement("span",{text:o,classname:u.default["context-menu-text"]});if(h.appendChild(v),null!=l&&h.addEventListener("click",function(){l(),a.hide()}),null!=m){h.appendChild(this.createArrow());var b=this.createMenuUl(u.default["context-sub-menu"]),y=this.createSubmenuFragment(m);b.appendChild(y),h.appendChild(b)}return f||(n(this,e)[i]=h),h},i.prototype.createSubmenuFragment=function(e){var t=this,n=document.createDocumentFragment();return e.forEach(function(e,a){var i,r=t.createSubmenuLi({text:e.label,classname:u.default["context-sub-menu-item"],disable:e.disable,icon:null!==(i=e.icon)&&void 0!==i?i:"",index:a,click:function(){e.click(),t.hide()}});n.appendChild(r)}),n},i.prototype.removeMenuItems=function(){for(var e=this.menuContainer.querySelectorAll('[data-auto-remove="1"]'),t=e.length-1;t>=0;t--){var n=e[t];this.menuContainer.removeChild(n)}},i.prototype.destroy=function(){this.menuContainer.innerHTML="",a(this,e,{})},i}();e=new WeakMap,exports.default=o;
},{"@bilibili-live/web-player-common":"KGHo","./index.less":"ntSr"}],"x9fc":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EMenuType=void 0,function(e){e.DANMU="danmu",e.LINE="line",e.LOGGER="logger",e.VIDEO_INFO="videoInfo",e.VERSION="version",e.COPYRIGHT="copyright",e.CLOSE="close"}(e=exports.EMenuType||(exports.EMenuType={}));
},{}],"YNoa":[function(require,module,exports) {
"use strict";var e,t,n,i,o,l,a,r,u=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},s=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.IDanmuInfo=void 0;var h,d=p(require("./contextmenu")),f=require("./type");Object.defineProperty(exports,"IDanmuInfo",{enumerable:!0,get:function(){return f.IDanmuInfo}}),function(e){e.DANMU="danmu",e.LINE="line",e.LOGGER="logger",e.VIDEO_INFO="videoInfo",e.VERSION="version",e.COPYRIGHT="copyright",e.CLOSE="close"}(h||(h={}));var m=function(p){function d(u,s){var h=p.call(this)||this;return e.set(h,void 0),t.set(h,void 0),n.set(h,[]),i.set(h,[]),o.set(h,null),l.set(h,!1),a.set(h,function(e){e.preventDefault(),p.prototype.removeMenuItems.call(h),h.danmuPreCheck(),h.showContextmenu(h.computePosition(e))}),r.set(h,function(e){h.menuContainer.contains(e.target)||(h.removeMenuItems(),p.prototype.hide.call(h))}),c(h,t,u),c(h,e,s),h.init(),h}return u(d,p),d.prototype.setLines=function(e,t,n){var l;if(null===(l=s(this,o))||void 0===l||l.call(this),0!==e.length){var a={label:"观看卡顿？切换备线试试",submenu:e.map(function(e){return{value:e.value,label:e.label,disable:e.value===t,click:n.bind(null,e.value)}})};c(this,i,e),c(this,o,this.prependMenuItem(h.LINE,a))}},d.prototype.changeLine=function(e){var t=s(this,i).findIndex(function(t){return t.value===e});null!=t&&this.submenuActive(h.LINE,t)},d.prototype.updateDanmuInfo=function(e){c(this,n,e)},d.prototype.setAdmin=function(){c(this,l,!0)},d.prototype.destroy=function(){p.prototype.destroy.call(this),this.removeListener(),s(this,t).removeChild(this.menuContainer)},d.prototype.init=function(){var e=this.getInitialConfig();p.prototype.initContextmenu.call(this,e),s(this,t).appendChild(this.menuContainer),this.addListener()},d.prototype.getInitialConfig=function(){var t=s(this,e);return[{name:h.LOGGER,label:"播放器日志信息",submenu:[{value:1,icon:"blp-icon-show",label:"显示日志",click:t.click.handleLogger.bind(null,"show")},{value:2,icon:"blp-icon-copy",label:"复制日志",click:t.click.handleLogger.bind(null,"copy")},{value:3,icon:"blp-icon-download",label:"下载日志",click:t.click.handleLogger.bind(null,"download")}]},{name:h.VIDEO_INFO,label:"视频统计信息",click:t.click.handleVideoInfo},{name:h.VERSION,label:"Bilibili HTML5 Live Player "+t.version},{name:h.COPYRIGHT,label:"Copyright bilibili "+(new Date).getFullYear()},{name:h.CLOSE,label:"关闭",click:function(){}}]},d.prototype.showContextmenu=function(e){p.prototype.show.call(this,{top:e.top,left:e.left},e.mainAxiosRight<160)},d.prototype.danmuPreCheck=function(){var e=this,t=s(this,n);t.length>0&&t.forEach(function(t,n){e.prependDanmu(t,0===n)}),c(this,n,[])},d.prototype.getDanmuConfig=function(t,n){var i=this,o=t.text.trim(),a=t.uid,r=a===s(this,e).uid,u={hr:n,autoRemove:!0,label:o,submenu:[{value:1,label:"举报选中弹幕",disable:r,click:s(this,e).click.handleDanmu.bind(this,"report",t)},{value:2,label:"屏蔽此用户的弹幕",disable:r,click:s(this,e).click.handleDanmu.bind(this,"shield",t)},{value:4,label:"复制弹幕",click:function(){var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(o).catch(function(){})}},{value:5,label:"去TA的个人空间",click:function(){var t="//space.bilibili.com/"+a;window.open(t),s(i,e).click.handleEvent(t)}}]};return s(this,l)&&u.submenu.splice(2,0,{value:3,label:"添加进黑名单",disable:r,click:s(this,e).click.handleDanmu.bind(this,"addBlackList",t)}),u},d.prototype.prependDanmu=function(e,t){var n=this.getDanmuConfig(e,t);p.prototype.prependMenuItem.call(this,h.DANMU,n)},d.prototype.computePosition=function(e){var n,i=Number(null!==(n=getComputedStyle(document.documentElement).zoom)&&void 0!==n?n:1),o=s(this,t).getBoundingClientRect(),l=this.menuContainer.getBoundingClientRect(),a=e.clientX,r=e.clientY,u=Math.min(a/i-o.left,o.width-l.width);return{left:u,top:Math.min(r/i-o.top,o.height-l.height),mainAxiosRight:o.width-u-l.width}},d.prototype.addListener=function(){s(this,t).addEventListener("contextmenu",s(this,a)),window.addEventListener("click",s(this,r))},d.prototype.removeListener=function(){s(this,t).removeEventListener("contextmenu",s(this,a)),window.removeEventListener("click",s(this,r))},d}(d.default);e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,o=new WeakMap,l=new WeakMap,a=new WeakMap,r=new WeakMap,exports.default=m;
},{"./contextmenu":"wERC","./type":"x9fc"}],"RYhb":[function(require,module,exports) {
"use strict";var t,e,i,s,h,r,a,n=this&&this.__classPrivateFieldSet||function(t,e,i,s,h){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!h)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!h:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?h.call(t,i):h?h.value=i:e.set(t,i),i},o=this&&this.__classPrivateFieldGet||function(t,e,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(t):s?s.value:e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var f=require("@bilibili-live/web-player-common"),p=function(){function p(o){t.set(this,0),e.set(this,0),i.set(this,[]),s.set(this,[]),h.set(this,0),r.set(this,0),a.set(this,0),n(this,t,o.width,"f"),n(this,e,o.height,"f"),this.initGraph()}return p.prototype.updateGraph=function(t){o(this,i,"f").shift(),o(this,i,"f").push(t),n(this,s,[],"f"),n(this,r,o(this,i,"f").length>0?Math.max.apply(this,o(this,i,"f")):1,"f");try{n(this,a,o(this,e,"f")/(o(this,r,"f")-o(this,h,"f")),"f")}catch(w){f.logger.error(w)}for(var p=0,c=o(this,i,"f").length;p<c;p++){var l=o(this,i,"f")[p];o(this,s,"f").push([2*p,o(this,e,"f")-(l-o(this,h,"f"))*o(this,a,"f")])}},p.prototype.getGraph=function(){for(var i="",h=o(this,s,"f"),r=0,a=h.length;r<a;r++)i+=h[r].join(",")+" ";return i.includes("NaN")&&(i="0"),'<svg width="'.concat(o(this,t,"f"),'" height="').concat(o(this,e,"f"),'" viewBox="0 0 ').concat(o(this,t,"f")," ").concat(o(this,e,"f"),'">\n                <g>\n                  <polyline stroke="white" fill="none" points="').concat(i,'">\n                  </polyline>\n                </g>\n              </svg>')},p.prototype.destroy=function(){n(this,i,[],"f"),n(this,s,[],"f"),n(this,h,0,"f"),n(this,r,0,"f"),n(this,a,0,"f"),this.initGraph()},p.prototype.initGraph=function(){for(var h=0,r=o(this,t,"f")/2;h<r;h++)o(this,i,"f").push(0),o(this,s,"f").push([2*h,o(this,e,"f")])},p}();t=new WeakMap,e=new WeakMap,i=new WeakMap,s=new WeakMap,h=new WeakMap,r=new WeakMap,a=new WeakMap,exports.default=p;
},{"@bilibili-live/web-player-common":"KGHo"}],"E7iI":[function(require,module,exports) {
"use strict";var t,e,i,n,r=this&&this.__assign||function(){return(r=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},o=this&&this.__classPrivateFieldSet||function(t,e,i,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(t,i):r?r.value=i:e.set(t,i),i},s=this&&this.__classPrivateFieldGet||function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("@bilibili-live/web-player-common"),l="web-player-show-videoinfo",p=function(){function p(p,c){t.set(this,void 0),e.set(this,0),i.set(this,{style:{},scope:null}),n.set(this,(0,a.createElement)("div",{classname:"web-player-video-info-panel",attributes:[["style","display: none;\n        position: absolute;\n        padding: 15px 36px 15px 15px;\n        text-align: left;\n        color: #fff;\n        background-color: rgba(28, 28, 28, 0.8);\n        border-radius: 4px;\n        font-size: 12px;\n        z-index: 102;\n        cursor: text;\n        user-select: text;\n      "]]})),o(this,t,p,"f"),o(this,i,r(r({},s(this,i,"f")),c),"f"),this.initPanel(),p.appendChild(s(this,n,"f")),"1"===localStorage.getItem(l)&&(this.status=1)}return Object.defineProperty(p.prototype,"status",{get:function(){return s(this,e,"f")},set:function(t){o(this,e,t,"f"),s(this,n,"f").style.display=1===t?"block":"none",localStorage.setItem(l,"".concat(t))},enumerable:!1,configurable:!0}),p.prototype.destroy=function(){s(this,t,"f").removeChild(s(this,n,"f"))},p.prototype.initPanel=function(){var t=this,e=s(this,i,"f").style;Object.keys(e).forEach(function(i){s(t,n,"f").style[i]=e[i]});var r=this.createCloseBtn();s(this,n,"f").appendChild(r),null!=s(this,i,"f").scope&&s(this,n,"f").appendChild(s(this,i,"f").scope)},p.prototype.createCloseBtn=function(){var t=this,e=(0,a.createElement)("div",{text:"[x]",attributes:[["style","position: absolute;\n        top: 10px;\n        right: 10px;\n        width: 14px;\n        height: 14px;\n        line-height: 14px;\n        text-align: center;\n        cursor: pointer;"]]});return e.addEventListener("click",function(e){e.stopPropagation(),t.status=0}),e},p}();t=new WeakMap,e=new WeakMap,i=new WeakMap,n=new WeakMap,exports.default=p;
},{"@bilibili-live/web-player-common":"KGHo"}],"SR9Z":[function(require,module,exports) {
"use strict";var e,t,a,i,o,n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var o in t=arguments[a])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=this&&this.__classPrivateFieldSet||function(e,t,a,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,a):o?o.value=a:t.set(e,a),a},s=this&&this.__classPrivateFieldGet||function(e,t,a,i){if("a"===a&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?i:"a"===a?i.call(e):i?i.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var d=require("@bilibili-live/web-player-common"),l=c(require("./wave-graph")),p=c(require("./panel")),h="p-video-info-",f=function(){function c(c){var h=this;e.set(this,void 0),t.set(this,void 0),a.set(this,void 0),i.set(this,0),o.set(this,void 0),this.videoTemplate={mimeType:{label:"Mime Type",data:""},playerCore:{label:"Player Core",data:""},videoInfo:{label:"Video Info",data:""},audioInfo:{label:"Audio Info",data:""},encoder:{label:"Encoder",data:""},streamHost:{label:"Stream Host",data:""},bufferLength:{label:"Buffer Length",data:""},droppedFrames:{label:"Decoded Frames",data:""},networkActivity:{label:"Download Bitrate",data:""}},this.template=Object.keys(this.videoTemplate).map(function(e){var t;return(t={})[e]=h.videoTemplate[e].data,t}).reduce(function(e,t){return n(n({},e),t)}),this.templateProxy=this.createTemplateProxy(),r(this,e,c,"f"),r(this,a,(0,d.createElement)("div"),"f"),r(this,o,new l.default({width:180,height:14}),"f"),s(this,a,"f").appendChild(this.combineDataElement()),r(this,t,new p.default(s(this,e,"f"),{scope:s(this,a,"f"),style:{top:"10px",left:"10px"}}),"f")}return c.prototype.show=function(){s(this,t,"f").status=1,this.repaintGraph()},c.prototype.hide=function(){s(this,t,"f").status=0},c.prototype.destroy=function(){for(var e in r(this,a,null,"f"),this.templateProxy)this.templateProxy[e]="";s(this,t,"f").destroy(),s(this,o,"f").destroy()},c.prototype.updateVideoTemplate=function(e){if(0!==s(this,t,"f").status){var a=e.mediaInfo,n=e.realtimeInfo,c=Math.floor(n.videoNetworkActivity/1024),l=this.templateProxy;l.mimeType=a.mimeType,l.playerCore=a.corePlayerType,l.videoInfo="".concat(a.width,"x").concat(a.height,", ").concat(a.fps,"FPS"),l.audioInfo="".concat(a.audioSampleRate/1e3,"KHz, ").concat(a.audioChannel,", ").concat(this.computeBps(a.audioDataRate)),l.encoder=a.encoder,l.streamHost=a.videoSrc.split("://")[1].split("/")[0],l.networkActivity="".concat((0,d.roundNumber)(c/1024*8,2),"Mbps"),l.bufferLength="".concat(n.videoBufferLength,"s, ").concat(n.latency?"".concat(n.latency/1e3,"s"):"N/A"),l.droppedFrames="".concat(n.droppedFrames,"/").concat(n.decodedFrames,", ").concat(n.decodedFrames-s(this,i,"f")<0?0:n.decodedFrames-s(this,i,"f"),"FPS"),r(this,i,n.decodedFrames,"f"),n.decodedFrames>0&&s(this,o,"f").updateGraph(c),this.repaintGraph()}},c.prototype.createTemplateProxy=function(){return new Proxy(this.template,{get:function(e,t,a){if(t in e)return e[t];throw new ReferenceError('Prop name "'+t+'" does not exist.')},set:function(e,t,a,i){var o;if(e[t]!==a){e[t]=a;var n=null===(o=document.getElementById("".concat(h).concat(t)))||void 0===o?void 0:o.querySelector(".web-player-line-data");null!=n&&(n.textContent=a)}return!0}})},c.prototype.repaintGraph=function(){if(0!==s(this,t,"f").status){var e=s(this,o,"f").getGraph(),a=document.querySelector(".web-player-info-graph");null!=a&&(a.innerHTML=e)}},c.prototype.combineDataElement=function(){var e=this,t=document.createDocumentFragment();return Object.keys(this.videoTemplate).forEach(function(a){var i=document.createElement("div");i.id="".concat(h).concat(a),i.style.cssText+="\n          min-width: 290px;\n          line-height: 18px;\n          font-size: 12px;\n        ",i.innerHTML='\n          <div style="display: inline-block;\n          white-space: nowrap;\n          width: 100px;\n          text-align: right;\n          font-weight: 500;\n          margin-right: 10px;">'.concat(e.videoTemplate[a].label,":</div>\n          ").concat("networkActivity"===a?'<div style="display: inline-block; margin-right: 10px;" class="web-player-info-graph">'+s(e,o,"f").getGraph()+"</div>":"",'\n          <div style="display: inline-block; min-width: 58px" class="web-player-line-data">').concat(e.videoTemplate[a].data,"</div>\n        "),t.appendChild(i)}),t},c.prototype.computeBps=function(e){return e<1e3?"".concat((0,d.roundNumber)(e,0),"Kbps"):"".concat((0,d.roundNumber)(e/1e3,1),"Mbps")},c}();e=new WeakMap,t=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,exports.default=f;
},{"@bilibili-live/web-player-common":"KGHo","./wave-graph":"RYhb","./panel":"E7iI"}],"qhQO":[function(require,module,exports) {
var o='.blp-plugin-modal{position:absolute;top:100px;left:0;padding:15px;z-index:99;display:none;background:#fff;border-radius:4px}.blp-plugin-modal.active{display:block}.blp-plugin-modal-header{font-size:16px;color:#4fc1e9;height:26px;line-height:20px}.blp-plugin-modal-body{margin:10px 0;font-size:14px}.blp-plugin-modal-footer{text-align:center;position:relative}.blp-plugin-modal-btn{border:none;display:inline-block;margin:0 2px;font-size:14px;padding:6px 10px;cursor:pointer;outline:none;border-radius:4px}.blp-plugin-modal-btn.submit-btn{color:#fff;background:#4fc1e9}.blp-plugin-modal-btn.submit-btn:hover{background:#61c7eb}.blp-plugin-modal-btn.cancel-btn{color:#4fc1e9;background:#e0f4fb}.blp-plugin-modal-btn.cancel-btn:hover{background:#ceeef9}.blp-plugin-modal-close{position:absolute;width:30px;height:30px;top:9px;right:9px;cursor:pointer;border-radius:100%;transition:transform .3s ease-in-out;display:none}.blp-plugin-modal-close:hover{transform:rotate(180deg)}.blp-plugin-modal-close:before{content:"";position:absolute;width:22px;height:22px;left:4px;top:4px;border-radius:100%}.blp-plugin-modal-close i{font-size:14px;color:#999;position:absolute;z-index:10;text-align:center;top:9px;left:9px}.blp-plugin-modal-close.active{display:block}',e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(o)),document.head.appendChild(e);
},{}],"ywxt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@bilibili-live/web-player-common");require("./modal.less");var e=function(){function e(t,i){this.container=t,this._snippet=['<div class="blp-plugin-modal-header"></div>','<div class="blp-plugin-modal-body"></div>','<div class="blp-plugin-modal-footer clearfix"></div>','<div class="blp-plugin-modal-close"><i class="live-icon-close"></i></div>'],this._opts=Object.assign({},e._DEFAULT_OPTIONS,i),this._initialize()}return e.prototype.show=function(){var t=this._opts,e=this._template;this._freshPos(),e._container.classList.add("active"),"function"==typeof t.onShow&&t.onShow()},e.prototype.hide=function(){var t=this._opts;this._template._container.classList.remove("active"),"function"==typeof t.onHide&&t.onHide(),t.autoRemove&&this.destroy()},e.prototype.destroy=function(){this._template._container.remove()},e.prototype._initialize=function(){this._create()._bindEvents(),this._opts.autoShow&&this.show()},e.prototype._create=function(){var e=(0,t.createElement)("div",{classname:"blp-plugin-modal"});e.innerHTML=this._snippet.join(""),this._template={_container:e,_header:e.querySelector(".blp-plugin-modal-header"),_body:e.querySelector(".blp-plugin-modal-body"),_footer:e.querySelector(".blp-plugin-modal-footer"),_close:e.querySelector(".blp-plugin-modal-close")};var i=this._template,n=this._opts;return i._header.innerText=n.title,i._body.innerHTML=""!==n.html?n.html:n.text,this._createBtn(i._footer,n.btns,n),n.hideBtn&&i._close.classList.add("active"),this.container.appendChild(e),null!=n.width&&0!==n.width&&(e.style.width="".concat(n.width,"px")),this},e.prototype._createBtn=function(e,i,n){var o=this;if(i instanceof Array)i.forEach(function(t){o._createBtn(e,t,n)});else{var l=null;switch(i.type){case"submit":(l=(0,t.createElement)("button",{classname:"blp-plugin-modal-btn submit-btn"})).innerHTML=i.text,"function"==typeof i.click&&l.addEventListener("click",function(t){i.click(t),o.hide()});break;case"cancel":(l=(0,t.createElement)("button",{classname:"blp-plugin-modal-btn cancel-btn"})).innerHTML=i.text,"flex-report"===n.btnPostion&&l.classList.add("live-bilibili-player-report-cancel"),l.addEventListener("click",function(){var t;null===(t=i.click)||void 0===t||t.call(i),o.hide()})}null!=l&&e.append(l)}},e.prototype._bindEvents=function(){var t=this;return this._opts.hideBtn&&this._template._close.addEventListener("click",function(){t.hide()}),this},e.prototype._freshPos=function(){var t=this._opts,e=this._template._container,i=this._template._footer,n="",o="",l=0,s=0,a=e.style;switch(t.btnPostion){case"flex-report":i.style.cssText="\n          display: flex;\n          justify-content: space-around;\n          margin-top: 69px;\n        ",a.height="190px",a.padding="20px"}switch(t.position){case"center-center":n="50%",o="50%",l=-1*parseInt(a.width)/2,s=-1*parseInt(a.height)/2}a.left=n,a.top=o,a.marginLeft="".concat(l,"px"),a.marginTop="".concat(s,"px")},e._DEFAULT_OPTIONS={title:"Bilibili HTML5 Live Player Modal",theme:"white",text:"Are you confirm the operation?",html:"",btns:[{type:"submit",text:"Confirm",click:function(){}},{type:"cancel",text:"Cancel",click:function(){}}],mask:!0,position:"center-center",hideBtn:!0,autoShow:!1,autoRemove:!1},e}();exports.default=e;
},{"@bilibili-live/web-player-common":"KGHo","./modal.less":"qhQO"}],"lmPI":[function(require,module,exports) {
var e='.web-player-report-msg{color:#4fc1e9;font-size:12px;line-height:2}.web-player-report-msg img{height:25px}.web-player-report-uname{font-size:12px;color:#666;line-height:2}.web-player-report-select-input{height:32px;position:relative;border:1px solid #e3e8ec;font-size:12px;background:#fff;cursor:pointer;border-radius:4px;margin:10px 0 25px}.web-player-report-select-wrap{position:absolute;height:34px;width:360px}.web-player-report-select-wrap:hover .bilibili-live-player-report-icon:after{transform-origin:center;transform:rotate(-135deg);transition:transform .3s}.web-player-report-icon{display:inline-block;width:40px;height:30px;margin-right:20px}.web-player-report-icon:after{display:inline-block;content:" ";height:6px;width:6px;border-color:#999;border-style:solid;border-width:0 2px 2px 0;transform:matrix(.71,.71,-.71,.71,0,0);transform-origin:center;transition:transform .3s;position:absolute;top:50%;right:10px;margin-top:-4px}.web-player-report-curt{padding-left:8px;height:32px;line-height:32px;color:#646c7a}.web-player-report-ul{display:none;position:relative;top:-27px;width:358px;height:160px;padding:0;margin:0;font-size:inherit;border:1px solid #ddd;border-top:0;background:#fff;overflow-y:auto;-webkit-box-shadow:0 1px 2px 0 rgba(105,115,133,.22);box-shadow:0 1px 2px 0 rgba(105,115,133,.22);border-radius:0 0 4px 4px;z-index:1;cursor:pointer}.web-player-report-ul li{padding:10px 0 10px 8px;color:#999;font-size:12px;height:24px;line-height:24px}.web-player-report-ul li:hover{background:#eef9fd}',r=document.createElement("style");r.type="text/css",r.appendChild(document.createTextNode(e)),document.head.appendChild(r);
},{}],"wafJ":[function(require,module,exports) {
"use strict";var e,t,r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{l(n.next(e))}catch(t){o(t)}}function s(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}l((n=n.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(l){s=[6,l],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__classPrivateFieldSet||function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},o=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},a=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var l=s(require("./modal")),c=require("@bilibili-live/web-player-common");require("./index.less");var u={reportReason:"/xlive/web-ucenter/v1/dMReport/ForReason",reportDanmaku:"/xlive/web-ucenter/v1/dMReport/Report"},d=function(){function s(r){e.set(this,null),t.set(this,void 0),i(this,t,r,"f")}return s._createModalHtml=function(e,t){var r=t.reduce(function(e,t){return e+"<li>".concat(t.reason,"</li>")},'<li class="web-player-report-item-default" style="display: none">请选择举报理由喔~</li>');return'\n      <div class="web-player-report-wrap">\n        <div class="web-player-report-uname">'.concat(e.uname,'</div>\n        <div class="web-player-report-msg">').concat(e.msg,'</div>\n        <div class="web-player-report-select-wrap">\n          <div class="web-player-report-select-input">\n            <div class="web-player-report-curt">请选择举报理由喔~</div>\n            <div class="web-player-report-icon"></div>\n          </div>\n          <ul class="web-player-report-ul">').concat(r,"</ul>\n        </div>\n      </div>\n    ")},s.prototype.show=function(e){return r(this,void 0,Promise,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,c.ajax)(u.reportReason)];case 1:return r=n.sent(),t=null!=r?r.data:[{id:1,reason:"违法违规"},{id:2,reason:"低俗色情"},{id:3,reason:"垃圾广告"},{id:4,reason:"辱骂引战"},{id:5,reason:"政治敏感"},{id:6,reason:"青少年不良信息"},{id:7,reason:"其他"}],[3,3];case 2:return n.sent(),t=[{id:1,reason:"违法违规"},{id:2,reason:"低俗色情"},{id:3,reason:"垃圾广告"},{id:4,reason:"辱骂引战"},{id:5,reason:"政治敏感"},{id:6,reason:"青少年不良信息"},{id:7,reason:"其他"}],[3,3];case 3:return this.handleReport(e,t),[2]}})})},s.prototype.resetReasonVisible=function(e){a([],e.children,!0).forEach(function(e){e instanceof HTMLElement&&(e.style.display="block")})},s.prototype.checkReportState=function(){var e=document.querySelector(".live-bilibili-player-report-cancel");null==e||e.click()},s.prototype.handleReport=function(a,c){var u=this;this.checkReportState();var d=s._createModalHtml(a,c);null==o(this,e,"f")&&i(this,e,new l.default(o(this,t,"f"),{title:"举报弹幕",html:d,btns:[{type:"submit",text:"警察叔叔就是他",click:function(){return r(u,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,this._submitFunction(a,c)];case 1:return e.sent(),x(),[2]}})})}},{type:"cancel",text:"饶他一命",click:function(){x()}}],width:360,btnPostion:"flex-report"}),"f");var p=document.querySelector(".web-player-report-uname"),f=document.querySelector(".web-player-report-msg");p.innerText=a.uname,a.img_url?f.innerHTML="<img src=".concat(a.img_url,">"):f.innerText=a.msg,o(this,e,"f").show();var y=document.querySelector(".web-player-report-ul"),h=document.querySelector(".web-player-report-curt"),v=document.querySelector(".web-player-report-select-wrap"),b=document.querySelector(".blp-plugin-modal-btn"),m=document.querySelector(".web-player-report-item-default"),w=function(e){u.resetReasonVisible(y);var t=e.target.innerText;b.disabled="请选择举报理由喔~"===t&&"获取不到举报理由，请尝试刷新后举报喔~"===t,h.innerText=t,y.style.display="none",m.style.display="block",e.target.style.display="none"}.bind(this),_=function(){y.style.display="none"}.bind(this),g=function(){y.style.display="block"}.bind(this),x=function(){var t;h.innerText="请选择举报理由喔~",m.style.display="none",u.resetReasonVisible(y),y.removeEventListener("click",w),null==v||v.removeEventListener("mouseover",g),null==v||v.removeEventListener("mouseout",_),null===(t=o(u,e,"f"))||void 0===t||t.destroy(),i(u,e,null,"f")};b.disabled=!0,y.addEventListener("click",w),null==v||v.addEventListener("mouseover",g),null==v||v.addEventListener("mouseout",_)},s.prototype._submitFunction=function(i,a){var s;return r(this,void 0,Promise,function(){var r,l,d,p,f,y;return n(this,function(n){switch(n.label){case 0:if(r=o(this,t,"f").querySelector(".web-player-report-curt"),l=r.innerText,d=i.checkInfo,p=0,null!=(f=a.filter(function(e){return e.reason===l}))&&0!==f.length&&(p=f[0].id),""===l)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(0,c.ajax)(u.reportDanmaku,{method:"POST",data:{reason:l,roomid:i.roomid,msg:i.msg,tuid:i.uid,ts:d.ts,sign:d.ct,reason_id:p,dm_type:i.type,file_id:i.file_id,img_url:i.img_url,id_str:i.id_str}})];case 2:return n.sent(),null===(s=o(this,e,"f"))||void 0===s||s.hide(),[3,4];case 3:return y=n.sent(),c.logger.error(y),[3,4];case 4:return[2]}})})},s}();e=new WeakMap,t=new WeakMap,exports.default=d;
},{"./modal":"ywxt","@bilibili-live/web-player-common":"KGHo","./index.less":"lmPI"}],"jLTy":[function(require,module,exports) {
module.exports={webPlayerLogPanel:"_web-player-log-panel_ce5de",log0:"_log-0_ce5de",log2:"_log-2_ce5de",log3:"_log-3_ce5de",closeBtn:"_close-btn_ce5de"};var e="._web-player-log-panel_ce5de{display:none;position:absolute;top:10px;right:10px;padding:0 5px 0 10px;text-align:left;color:#fff;background-color:rgba(28,28,28,.8);border-radius:4px;font-size:12px;z-index:101;cursor:text;user-select:text}._web-player-log-panel_ce5de pre::-webkit-scrollbar{background-color:transparent;width:4px}._web-player-log-panel_ce5de pre::-webkit-scrollbar-thumb{background-color:hsla(0,0%,100%,.5);border-radius:8px}._web-player-log-panel_ce5de pre{overflow-y:scroll;word-break:break-all;white-space:break-spaces;width:240px;height:310px}._web-player-log-panel_ce5de pre ._log-0_ce5de{color:#999}._web-player-log-panel_ce5de pre ._log-2_ce5de{color:#f90}._web-player-log-panel_ce5de pre ._log-3_ce5de{color:#f3323e}._web-player-log-panel_ce5de pre code{font-family:PingFang SC,Microsoft YaHei}._web-player-log-panel_ce5de ._close-btn_ce5de{position:absolute;top:8px;right:8px;width:14px;height:14px;line-height:14px;text-align:center;cursor:pointer}",l=document.createElement("style");l.type="text/css",l.appendChild(document.createTextNode(e)),document.head.appendChild(l);
},{}],"MY3w":[function(require,module,exports) {
"use strict";var e,t,r,a,i=this&&this.__classPrivateFieldGet||function(e,t,r,a){if("a"===r&&!a)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)},n=this&&this.__classPrivateFieldSet||function(e,t,r,a,i){if("m"===a)throw new TypeError("Private method is not writable");if("a"===a&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?i.call(e,r):i?i.value=r:t.set(e,r),r},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var s=require("@bilibili-live/web-player-common"),l=o(require("./log-panel.less")),c="web-player-show-log",h=function(){function o(n){e.set(this,(0,s.createElement)("div",{classname:l.default.webPlayerLogPanel})),t.set(this,(0,s.createElement)("pre")),r.set(this,!1),a.set(this,null),this.initPanel(),n.appendChild(i(this,e,"f")),"1"===localStorage.getItem(c)&&this.show()}return o.prototype.show=function(){i(this,e,"f").style.display="block",i(this,r,"f")||n(this,a,this.syncLogger(),"f"),localStorage.setItem(c,"1")},o.prototype.destroy=function(){var t;null===(t=i(this,a,"f"))||void 0===t||t.call(this),i(this,e,"f").remove()},o.prototype.initPanel=function(){var t=this.createCloseBtn();i(this,e,"f").appendChild(t)},o.prototype.createCloseBtn=function(){var t=this,r=(0,s.createElement)("div",{text:"[x]",classname:l.default.closeBtn});return r.addEventListener("click",function(r){r.stopPropagation(),i(t,e,"f").style.display="none",localStorage.setItem(c,"0")}),r},o.prototype.syncLogger=function(){var a=this;n(this,r,!0,"f");var o=document.createDocumentFragment();return s.logger.history().forEach(function(e){o.appendChild(c(e))}),i(this,t,"f").appendChild(o),i(this,e,"f").appendChild(i(this,t,"f")),s.logger.watch(function(e){i(a,t,"f").appendChild(c(e))});function c(e){var t=document.createElement("code");return t.classList.add(l.default["log".concat(e.level)]),t.textContent="".concat(s.logger.stringify(e,{tag:!1,time:!1}),"\n"),t}},o}();e=new WeakMap,t=new WeakMap,r=new WeakMap,a=new WeakMap,exports.default=h;
},{"@bilibili-live/web-player-common":"KGHo","./log-panel.less":"jLTy"}],"PTXm":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(l,u){function i(e){try{c(r.next(e))}catch(n){u(n)}}function o(e){try{c(r.throw(e))}catch(n){u(n)}}function c(e){var n;e.done?l(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(i,o)}c((r=r.apply(e,n||[])).next())})},n=this&&this.__generator||function(e,n){var t,r,l,u,i={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return u={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function o(o){return function(c){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;u&&(u=0,o[0]&&(i=0)),i;)try{if(t=1,r&&(l=2&o[0]?r.return:o[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,o[1])).done)return l;switch(r=0,l&&(o=[2&o[0],l.value]),o[0]){case 0:case 1:l=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(l=(l=i.trys).length>0&&l[l.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!l||o[1]>l[0]&&o[1]<l[3])){i.label=o[1];break}if(6===o[0]&&i.label<l[1]){i.label=l[1],l=o;break}if(l&&i.label<l[2]){i.label=l[2],i.ops.push(o);break}l[2]&&i.ops.pop(),i.trys.pop();continue}o=n.call(e,i)}catch(c){o=[6,c],r=0}finally{t=l=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@bilibili-live/web-player-common");function r(t){return e(this,void 0,Promise,function(){var e;return n(this,function(n){switch(n.label){case 0:return e=o(),t.contains(e)?[4,i()]:[3,2];case 1:return n.sent(),[3,4];case 2:return[4,u(t)];case 3:n.sent(),n.label=4;case 4:return[2]}})})}function l(e){for(var n=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],t=0,r=n;t<r.length;t++){var l=r[t];document.addEventListener(l,e)}return function(){for(var t=0,r=n;t<r.length;t++){var l=r[t];document.removeEventListener(l,e)}}}function u(r){return e(this,void 0,Promise,function(){var e,l,u,i;return n(this,function(n){for(e=0,l=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"];e<l.length;e++)if("function"==typeof r[u=l[e]])return[2,r[u]()];if(t.ua.isIOS()&&"function"==typeof(null==(i=r.querySelector("video"))?void 0:i.webkitEnterFullScreen))return i.webkitEnterFullScreen(),[2];throw new Error("browser unsupported fullscreen")})})}function i(){return e(this,void 0,Promise,function(){var e,r,l,u;return n(this,function(n){if(null==(e=o()))return[2];for(r=0,l=["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"];r<l.length;r++)if(u=l[r],"function"==typeof document[u])return[2,document[u]()];return t.ua.isIOS()&&!0===e.webkitDisplayingFullscreen&&e.webkitExitFullScreen(),[2]})})}function o(){for(var e=0,n=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"];e<n.length;e++){if(null!=(u=document[n[e]]))return u}if(t.ua.isIOS())for(var r=0,l=document.querySelectorAll("video");r<l.length;r++){var u;if(!0===(u=l[r]).webkitDisplayingFullscreen)return u}return null}exports.default={onChange:l,toggleFullScreen:r,getFullscreenElement:o,requestFullscreen:u,exitFullscreen:i};
},{"@bilibili-live/web-player-common":"KGHo"}],"n8Xe":[function(require,module,exports) {
"use strict";var e,t,r,n,o,i,s,c,u,a,d=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{u(n.next(e))}catch(t){i(t)}}function c(e){try{u(n.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,c)}u((n=n.apply(e,t||[])).next())})},h=this&&this.__classPrivateFieldSet||function(e,t,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},f=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DBCore=void 0;const l=null!==(r=null!==(t=null!==(e=window.indexedDB)&&void 0!==e?e:window.mozIndexedDB)&&void 0!==t?t:window.webkitIndexedDB)&&void 0!==r?r:window.msIndexedDB;function v(e){return console.error(e),!1}function p(e){return"[object Object]"===Object.prototype.toString.call(e)}function w(e,t){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(t[r]!==e[r])return!1}return!0}function g(e){const t=null!=e?e:"++id",[r,...n]=t.split(",").map(e=>e.trim()),o=r.includes("++");return{keyPath:r.replace("++",""),autoIncrement:o,indexKeys:n}}function m(e){return new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(e.result),n()},i=()=>{r(e.error),v(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)})}function y(){return d(this,void 0,void 0,function*(){const e=l.databases;if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||void 0===e)return;let t;return yield new Promise(r=>{const n=()=>{e().then(r).catch(r)};t=window.setInterval(n,100),n()}).finally(()=>clearInterval(t))})}function P(e,t,r={}){return new Promise((n,o)=>{y().then(()=>{if(void 0===l)return void o("not support indexedDB");const i=l.open(e,t);i.onupgradeneeded=(e=>{const t=i.result;"function"==typeof r.upgrade&&r.upgrade(t)}),i.onsuccess=(e=>{const t=i.result;n(t)}),i.onerror=(e=>{v(i.error),o(i.error)}),i.onblocked=(e=>{var t,s;if(e instanceof IDBVersionChangeEvent){const o=e,c=e=>{const t=i.result;"function"==typeof r.upgrade&&r.upgrade(t),a()},u=()=>{const e=i.result;n(e),a()},a=()=>{var e,t;null===(e=o.target)||void 0===e||e.removeEventListener("upgradeneeded",c),null===(t=o.target)||void 0===t||t.removeEventListener("success",u)};return null===(t=o.target)||void 0===t||t.addEventListener("upgradeneeded",c),void(null===(s=o.target)||void 0===s||s.addEventListener("success",u))}o(i.error)})}).catch(o)})}function b(e){return m(l.deleteDatabase(e))}function S(e,t){const r={};if(!p(t))return r;for(const n in t)if(!e.objectStoreNames.contains(n)){const{keyPath:o,autoIncrement:i,indexKeys:s}=g(t[n]),c=e.createObjectStore(n,{keyPath:o,autoIncrement:i});s.forEach(e=>{c.createIndex(e,e,{unique:!1})}),r[n]=c}return r}class j{constructor(e){n.set(this,void 0),o.set(this,{}),i.set(this,{}),s.set(this,void 0),c.set(this,void 0),u.set(this,{status:"close"}),this.storeNames=[],h(this,s,e,"f")}getDatabase(){return d(this,void 0,void 0,function*(){return void 0!==f(this,n,"f")?f(this,n,"f"):yield P(f(this,s,"f"))})}version(e){if(isNaN(e)||e<.1)throw Error("Given version is not a positive number");return h(this,c,e,"f"),this}getVersion(){return d(this,void 0,void 0,function*(){if("number"==typeof f(this,c,"f"))return f(this,c,"f");return(yield this.getDatabase()).version})}stores(e){return d(this,void 0,void 0,function*(){if(void 0===f(this,c,"f"))throw Error("Please use version() brefore stores()");const t=`${f(this,s,"f")}-${f(this,c,"f")}`;this.storeNames=Object.keys(e),void 0===f(this,o,"f")[t]&&(f(this,o,"f")[t]=e),void 0!==f(this,n,"f")&&(f(this,u,"f").status="closeing",f(this,n,"f").close());try{h(this,n,yield P(f(this,s,"f"),f(this,c,"f"),{upgrade:t=>{S(t,e),f(this,u,"f").status="opened"}}),"f"),f(this,u,"f").status="opened"}catch(r){throw Error(r)}return this})}getStoreOption(){var e;const t=`${f(this,s,"f")}-${null!==(e=f(this,c,"f"))&&void 0!==e?e:""}`;return f(this,o,"f")[`${t}`]}getStore(e){var t;if(void 0===f(this,o,"f")[`${f(this,s,"f")}-${null!==(t=f(this,c,"f"))&&void 0!==t?t:""}`])throw Error("Please use stores() brefore getStore()");if(void 0===f(this,n,"f"))throw Error("DB is not ready, Please await stores()");return void 0!==f(this,i,"f")[e]?f(this,i,"f")[e]:(f(this,i,"f")[e]=new E(f(this,n,"f"),e),f(this,i,"f")[e])}getStoreNames(){return d(this,void 0,void 0,function*(){const e=yield this.getDatabase();return Array.from(e.objectStoreNames)})}close(){var e;null===(e=f(this,n,"f"))||void 0===e||e.close()}}exports.default=j,n=new WeakMap,o=new WeakMap,i=new WeakMap,s=new WeakMap,c=new WeakMap,u=new WeakMap,j.delete=b;class E{constructor(e,t){a.set(this,10),this.db=e,this.storeName=t}transaction(e){return this.db.transaction(e,"readwrite")}cacheTransaction(e){this.trans=e}getStore(e){if(f(this,a,"f")<=0){v(Error("getStore error"))}else try{return(e||this.transaction([this.storeName])).objectStore(this.storeName)}catch(t){return"function"==typeof t.toString&&t.toString().indexOf("closing")>-1?h(this,a,0,"f"):h(this,a,f(this,a,"f")-1,"f"),void v(t)}}clear(){return d(this,void 0,void 0,function*(){const e=this.getStore();return e?m(e.clear()):Promise.reject(e)})}add(e){return d(this,void 0,void 0,function*(){const t=this.trans?this.getStore(this.trans):this.getStore();return t?m(t.add(e)):Promise.reject(t)})}put(e){return d(this,void 0,void 0,function*(){const t=this.trans?this.getStore(this.trans):this.getStore();return t?m(t.put(e)):Promise.reject(t)})}delete(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.delete(e)):Promise.reject(t)})}deleteMany(e){const t=this.getStore();return t?new Promise((r,n)=>{const o=[],i=function(){const s=e.shift();if(!s)return void(0===o.length?r():n(o));const c=t.delete(s);c.onsuccess=function(){i()},c.onerror=function(){v(c.error),o.push(c.error)}};i()}):Promise.reject(t)}deleteByIndex(e,t){return d(this,void 0,void 0,function*(){const r=this.getStore();return r?new Promise((n,o)=>{const i=r.index(e).openCursor(t),s=[];i.onsuccess=function(){const e=i.result;null!==e?(e.delete(),e.continue()):0===s.length?n():o(s)},i.onerror=function(){v(i.error),s.push(i.error)}}):Promise.reject(r)})}count(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.count(e)):Promise.reject(t)})}get(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.get(e)):Promise.reject(t)})}getAll(){return d(this,void 0,void 0,function*(){const e=this.getStore();return e?m(e.getAll()):Promise.reject(e)})}queryWithIndex(e,t){return d(this,void 0,void 0,function*(){const r=this.getStore();return r?new Promise((n,o)=>{const i=[],s=r.index(e).openCursor(t);s.onsuccess=(e=>{const t=s.result;null!==t?(i.push(t.value),t.continue()):n(i)}),s.onerror=(()=>{v(s.error),o(s.error)})}):Promise.reject(r)})}each(e,t){return d(this,void 0,void 0,function*(){const r=this.getStore();return r?new Promise((n,o)=>{let i=0;const s=r.openCursor(e);s.onsuccess=(e=>{const r=s.result;null!==r?(t(r.value,i++),r.continue()):n()}),s.onerror=(()=>{v(s.error),o(s.error)})}):Promise.reject(r)})}query(e){return d(this,void 0,void 0,function*(){const t=[];return this.each(null,r=>{w(r,e)&&t.push(r)}).then(()=>t)})}}exports.DBCore=E,a=new WeakMap;
},{}],"cQRo":[function(require,module,exports) {
"use strict";function t(t){var e,r;const{cookie:o}=document;return null==o?"":null!==(r=null===(e=o.split(";").filter(t=>t.trim().length>0).map(t=>t.split("=")).map(([t,e])=>[t.trim(),e.trim()]).find(([e])=>e===t))||void 0===e?void 0:e[1])&&void 0!==r?r:""}function e(t){return new Promise(e=>{setTimeout(e,t)})}function r(){return Number(t("DedeUserID"))}function o(){return n(8)}function n(t=12){const e=[];for(let r=0;r<t;r++){const t=10*Math.random();e.push(Math.floor(t<1&&0===r?10*Math.random():t))}return Number(e.join(""))}function s(t){return void 0===t?2:t.replace(/[\u0391-\uFFF5]/g,"aa").length}function i(t){let e=null;return s(e="string"==typeof t?t:JSON.stringify(t))}function p(t){const e=new FormData;for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const o=t[r];e.append(r,o)}return e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Object2FormData=exports.getSizeInBytes=exports.getStringLength=exports.UUID=exports.shortUUID=exports.getUserId=exports.sleep=exports.getCookie=void 0,exports.getCookie=t,exports.sleep=e,exports.getUserId=r,exports.shortUUID=o,exports.UUID=n,exports.getStringLength=s,exports.getSizeInBytes=i,exports.Object2FormData=p;
},{}],"gT7a":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(a,r){function i(t){try{c(o.next(t))}catch(e){r(e)}}function s(t){try{c(o.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(i,s)}c((o=o.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ajax=void 0;const e=require("./utils"),n="//api.live.bilibili.com",o=new Map;function a(a,r){return t(this,void 0,void 0,function*(){let t=a;/^(https?:)?\/\//.test(a)||(t=`${n}/${a.replace(/^\//,"")}`);const i=new URL(t,location.href),s=o.get(i.host+i.pathname);if(null!=s&&s.expiresTime>performance.now()){const t=Math.random()*s.scope;yield(0,e.sleep)(t)}const c=(0,e.getCookie)("bili_jct");if(""!==c&&"POST"===(null==r?void 0:r.method)&&null!=(null==r?void 0:r.data)){const t={csrf:c,csrf_token:c},e=Object.keys(t);r.data instanceof FormData?(e.forEach(e=>{var n;null===(n=r.data)||void 0===n||n.append(e,t[e])}),r.body=r.data):r.data&&(e.forEach(e=>{r.data[e]=t[e]}),r.body=JSON.stringify(r.data)),delete r.data}let l;try{l=yield fetch(t,Object.assign({credentials:"include"},null!=r?r:{}))}catch(p){const t=String(p);throw new Error(t)}if(!l.ok){const t=`url: ${a}, status: ${l.status}`;throw new Error(t)}const d=yield l.json(),{code:u,data:f,message:h}=d;if(0!==u)throw new Error(h);return f})}exports.ajax=a,a.disperse=((t,e)=>{const a=/^(https?:)?\/\//.test(t)?t:`${n}/${t.replace(/^\//,"")}`;o.set(a.replace(/^(https?:)?\/\//,""),e)});
},{"./utils":"cQRo"}],"NwTf":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(r,i){function n(e){try{u(a.next(e))}catch(t){i(t)}}function c(e){try{u(a.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(n,c)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.reportLog=void 0;const t=require("./ajax"),o=require("./utils");function a(a,r=""){return e(this,void 0,void 0,function*(){const e=new Blob(["--"+JSON.stringify(a.data)]);"prod"===r&&(r=""),r&&(r=`ff-${r}-`);try{const{location:n}=yield(0,t.ajax)(`//${r?"uat-":""}api.bilibili.com/x/upload/web/image`,{method:"POST",data:(0,o.Object2FormData)({bucket:"live-log-ttl",dir:a.appName,file:e})});if(null==n||""===n)return!1;const c={appName:a.appName,userID:(0,o.getUserId)(),source:a.sourceType,url:n.replace(".txt","")};return null!=a.appId&&(c.appID=a.appId),null!=a.msgId&&(c.msgID=a.msgId),yield(0,t.ajax)(`//${r}api.live.bilibili.com/xlive/open-interface/v1/webLogAgent/setWebAppLogRecord`,{method:"POST",data:(0,o.Object2FormData)(c)}),!0}catch(i){return console.warn(i),!1}})}exports.reportLog=a;
},{"./ajax":"gT7a","./utils":"cQRo"}],"wAJK":[function(require,module,exports) {
"use strict";var e,t,i,s,a,o,n,r,c,d=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(a,o){function n(e){try{c(s.next(e))}catch(t){o(t)}}function r(e){try{c(s.throw(e))}catch(t){o(t)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,r)}c((s=s.apply(e,t||[])).next())})},p=this&&this.__classPrivateFieldGet||function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,i,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,i):a?a.value=i:t.set(e,i),i},l=this&&this.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i},f=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.multitask=exports.GoldMiner=void 0;const u=f(require("./idb")),m=require("./report"),$=require("./utils"),g=(0,$.getSizeInBytes)({$mainId:(0,$.shortUUID)(),$id:(0,$.UUID)(),$createTime:Date.now(),$expire:-1,$content:"",$type:"xxxx"}),v={expire:432e6,maxSpace:20,dbVersion:1},y={main:"$id",logList:"$id, $mainId"};class T{constructor(d){e.set(this,{}),t.set(this,{main:[],logList:[]}),i.set(this,void 0),s.set(this,"closed"),a.set(this,void 0),o.set(this,void 0),n.set(this,void 0),r.set(this,!1),c.set(this,void 0),Object.assign(p(this,e,"f"),v,d),h(this,i,`GM-${p(this,e,"f").appName}`,"f"),this.idb=new u.default(p(this,i,"f")).version(p(this,e,"f").dbVersion),h(this,a,{$id:(0,$.shortUUID)()},"f"),d.init&&this.init(d.init)}static recieveMsg(e,t){return void 0===T.GoldMinerCahce[t.appName]&&(T.GoldMinerCahce[t.appName]=new T({appName:t.appName,env:t.env})),T.GoldMinerCahce[t.appName].reportManyLog({timeRage:[e.data.start_timestamp,e.data.end_timestamp],sourceType:t.source,msgId:e.data.msg_id,appId:e.data.app_id,appName:e.data.app_name,latestCount:t.latestCount}).catch(console.error)}init(i,s=!0){p(this,a,"f").$createTime?(p(this,t,"f").main=[],p(this,t,"f").logList=[],h(this,a,Object.assign(Object.assign({$id:(0,$.shortUUID)()},i),{$expire:p(this,e,"f").expire,$createTime:Date.now(),$updateTime:Date.now()}),"f")):Object.assign(p(this,a,"f"),Object.assign(Object.assign({},i),{$expire:p(this,e,"f").expire,$createTime:Date.now(),$updateTime:Date.now()})),p(this,a,"f").$space=(0,$.getSizeInBytes)(p(this,a,"f")),p(this,t,"f").main[0]=p(this,a,"f"),s&&this.initStore().then(()=>{this.startQueueTask("main")})}initStore(){return d(this,void 0,void 0,function*(){if("opening"!==p(this,s,"f")&&"opened"!==p(this,s,"f")){h(this,s,"opening","f");try{yield this.idb.stores(y),h(this,o,this.idb.getStore("main"),"f"),h(this,n,this.idb.getStore("logList"),"f"),h(this,s,"opened","f"),this.startQueueTask("logList")}catch(e){console.error(e)}}})}destroy(){this.idb.close(),p(this,s,"f")}startQueueTask(e){if(!Array.isArray(p(this,t,"f")[e])||"opened"!=p(this,s,"f")||void 0===p(this,a,"f"))return;const i=this.idb.getStore(e),n=()=>{var s;if("logList"===e&&p(this,t,"f")[e].length){const s=p(this,t,"f")[e].shift();if(!s)return;p(this,a,"f").$updateTime=s.$createTime,p(this,a,"f").$space=(p(this,a,"f").$space||0)+(0,$.getSizeInBytes)(s.$content)+g,i.add(s).then(()=>{var e;n(),p(this,a,"f").$createTime&&(null===(e=p(this,o,"f"))||void 0===e||e.put(p(this,a,"f")))}).catch(n)}else if("main"===e){if(!p(this,t,"f")[e].shift())return;null===(s=p(this,o,"f"))||void 0===s||s.put(p(this,a,"f")).then(()=>{p(this,r,"f")||(h(this,r,!0,"f"),this.checkSpaceAndClear())})}};n()}log(e){var i;!p(this,o,"f")&&p(this,a,"f").$createTime&&this.initStore();const s=Date.now(),n={$id:(0,$.UUID)(),$mainId:p(this,a,"f").$id,$content:e,$createTime:s,$expire:-1};"object"==typeof e&&(n.$content=e.content,n.$createTime=null!==(i=e.ts)&&void 0!==i?i:s,void 0!==e.type&&(n.$type=e.type)),p(this,t,"f").logList.push(n),p(this,t,"f").logList.length<2&&this.startQueueTask("logList")}checkSpaceAndClear(){return d(this,void 0,void 0,function*(){if(!p(this,n,"f")||!p(this,o,"f"))return;const t=yield p(this,o,"f").getAll();let i=0;const s=[],a={};if(t.forEach(t=>{var o;(void 0===t.$expire||t.$expire>5184e6)&&(t.$expire=p(this,e,"f").expire),void 0===t.$createTime&&(t.$createTime=t.$updateTime),i+=null!==(o=t.$space)&&void 0!==o?o:0,Date.now()-t.$updateTime<6e5&&0!==t.$expire||(Date.now()-(t.$createTime||t.$updateTime)>t.$expire?s.push(t.$id):a[t.$id]=t)}),yield this.removeLogList(s),i/1048576>=p(this,e,"f").maxSpace){const e=Date.now(),t=[];for(const o in a)if(Object.prototype.hasOwnProperty.call(a,o)){const i=a[o];e-i.$createTime>i.$expire/2&&t.push(i.$id)}yield this.removeLogList(t);const i=p(this,n,"f").getStore();if(!i)return;const s=i.openCursor();s.onsuccess=(e=>{const t=s.result;if(t){const e=t.value;return void 0===a[e.$mainId]&&t.delete(),void t.continue()}})}})}removeLogList(e){var t;return d(this,void 0,void 0,function*(){if(p(this,n,"f")&&p(this,o,"f"))for(const i of e)i!==(null===(t=p(this,a,"f"))||void 0===t?void 0:t.$id)&&(p(this,o,"f").delete(i),yield p(this,n,"f").deleteByIndex("$mainId",i))})}recieveMsg(t,i){switch(t.cmd){case"LIVE_PLAYER_LOG_RECYCLE":w(t.data.msg_id,()=>d(this,void 0,void 0,function*(){t.data.user_id===(0,$.getUserId)()&&t.data.app_name===p(this,e,"f").appName&&(yield this.reportManyLog({timeRage:[t.data.start_timestamp,t.data.end_timestamp],sourceType:i.source,msgId:t.data.msg_id,appId:t.data.app_id,appName:t.data.app_name,latestCount:i.latestCount}).catch(console.error))}))}}report(t){let i;return t.startTime&&t.endTime&&(i=[t.startTime,t.endTime]),this.reportManyLog({timeRage:i,sourceType:t.source,appName:p(this,e,"f").appName,latestCount:t.latestCount,msgId:t.msgId})}reportManyLog(t){return d(this,void 0,void 0,function*(){const i=yield this.getLogs({timeRange:t.timeRage,latestCount:t.latestCount||10}),s=[];for(const a of i){const{$id:i,$expire:o,$space:n,$createTime:r,$updateTime:c}=a,d=l(a,["$id","$expire","$space","$createTime","$updateTime"]);(yield(0,m.reportLog)({data:Object.assign({createTime:r,updateTime:c},d),appName:t.appName,sourceType:t.sourceType,msgId:t.msgId,appId:t.appId},p(this,e,"f").env))&&s.push(i)}this.removeLogList(s)})}getLogs({timeRange:e,latestCount:t=40}){var i,s;return d(this,void 0,void 0,function*(){if(!p(this,n,"f")||!p(this,o,"f"))return yield this.initStore(),yield(0,$.sleep)(200),this.getLogs({timeRange:e,latestCount:t});const a=[];let r=(yield p(this,o,"f").getAll()).sort((e,t)=>(t.$createTime||t.$updateTime)-(e.$createTime||t.$updateTime));if(Array.isArray(e)){const t=null!==(i=e[0])&&void 0!==i?i:Date.now()-3e3,a=null!==(s=e[1])&&void 0!==s?s:Date.now();r=r.filter(e=>e.$createTime>=t&&e.$createTime<=a)}t>0&&(r=r.slice(0,t));const d=p(this,c,"f")?e=>p(this,c,"f")(e):function(e){var t;let i,s=e.$createTime;"object"==typeof e.$content&&null!==e.$content&&(i=e.$content.color,s=null!==(t=e.$content.ts)&&void 0!==t?t:s,delete e.$content.color,delete e.$content.ts);const a={content:e.$content,ts:s};return e.$type&&(a.type=e.$type),i&&(a.color=i),a};for(const e of r){const t=yield p(this,n,"f").queryWithIndex("$mainId",e.$id);a.push(Object.assign(Object.assign({},e),{logList:t.map(d)}))}return a})}formatter(e){h(this,c,e,"f")}}function w(e,t){return d(this,void 0,void 0,function*(){yield new Promise(e=>{setTimeout(()=>{e()},300*Math.random()|0)});const i=void 0===e?"":`live-log-report-${e}`;if(""!==i){if(null!==localStorage.getItem(i))return;localStorage.setItem(i,"1")}yield t(),""!==i&&localStorage.removeItem(i)})}exports.GoldMiner=T,e=new WeakMap,t=new WeakMap,i=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,n=new WeakMap,r=new WeakMap,c=new WeakMap,T.GoldMinerCahce={},exports.multitask=w;
},{"./idb":"n8Xe","./report":"NwTf","./utils":"cQRo"}],"zRQJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GoldMiner=exports.multitask=void 0;const e=require("./GoldMiner");Object.defineProperty(exports,"GoldMiner",{enumerable:!0,get:function(){return e.GoldMiner}}),Object.defineProperty(exports,"multitask",{enumerable:!0,get:function(){return e.multitask}}),exports.default=e.GoldMiner;
},{"./GoldMiner":"wAJK"}],"hY1T":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.logStorageConfig=exports.goldMiner=exports.logLevelColos=void 0;var o=require("@bilibili-live/web-player-common"),r=require("@bilibili-live/gold-miner"),t=require("./biz-common");exports.logLevelColos=((e={})[o.LogLevel.Error]="red",e[o.LogLevel.Info]="blue",e[o.LogLevel.Warn]="orange",e[o.LogLevel.Debug]="gray",e);var n,i="indexedDB"in window||"webkitIndexedDB"in window||"mozIndexedDB"in window;function l(e){i&&exports.goldMiner.recieveMsg(e,{source:"socket-report",latestCount:20})}function s(e){i&&(exports.goldMiner.init({roomId:e.roomId,uid:(0,t.getUserId)(),ref:window.location.href,createTime:Date.now(),updateTime:Date.now()}),null!=e.socket&&(null!=n&&n(),n=e.socket.on("message",l)))}exports.goldMiner=new r.GoldMiner({appName:"live-web-player"}),exports.goldMiner.formatter(function(e){return{content:e.$content,ts:e.$createTime,color:exports.logLevelColos[e.$type]}}),i&&o.logger.watch(function(e){exports.goldMiner.log({content:e.content,ts:e.ts,type:e.level})}),exports.logStorageConfig=s;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/gold-miner":"zRQJ","./biz-common":"YQ89"}],"z9tw":[function(require,module,exports) {
module.exports={notAutoPlayTipContainer:"_not-auto-play-tip-container_6f52f",tipImg:"_tip-img_6f52f",tipText:"_tip-text_6f52f",textTipEmphasize:"_text-tip-emphasize_6f52f",tipBtn:"_tip-btn_6f52f",mutePlayTipContainer:"_mute-play-tip-container_6f52f"};var t="._not-auto-play-tip-container_6f52f{width:100%;height:100%;display:flex;align-items:center;flex-direction:column;justify-content:center;position:absolute;top:0;left:0;background:rgba(0,0,0,.5);z-index:40}._not-auto-play-tip-container_6f52f ._tip-img_6f52f{margin-top:-10%;width:230px}._not-auto-play-tip-container_6f52f ._tip-text_6f52f{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:18px;line-height:34px;color:#fff;margin-bottom:20px;margin-top:0}._not-auto-play-tip-container_6f52f ._tip-text_6f52f ._text-tip-emphasize_6f52f{color:#23ade5}._not-auto-play-tip-container_6f52f ._tip-btn_6f52f{width:135px;height:45px;background:#23ade5;border-radius:4px;color:#fff;font-family:PingFang SC;font-style:normal;font-weight:500;font-size:18px;text-align:center;vertical-align:middle;line-height:45px;cursor:pointer}._mute-play-tip-container_6f52f{position:absolute;width:150px;height:32px;background:#23ade5;border-radius:4px;z-index:40;bottom:40;left:30px;bottom:10px;cursor:pointer}._mute-play-tip-container_6f52f ._tip-img_6f52f{width:18px;height:18px;line-height:28px;position:absolute;top:6px;left:11px;margin-right:9px}._mute-play-tip-container_6f52f ._tip-text_6f52f{position:absolute;font-family:PingFang SC;font-style:normal;font-weight:500;font-size:16px;line-height:32px;color:#fff;top:0;left:41px;white-space:nowrap;margin:0}",i=document.createElement("style");i.type="text/css",i.appendChild(document.createTextNode(t)),document.head.appendChild(i);
},{}],"QivA":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMutePlayTip=exports.createNotAutoPlayTip=void 0;var t=require("@bilibili-live/web-player"),a=e(require("./not-auto-play.less"));function n(e,t){var n=document.createElement("div"),i=document.createElement("div"),c=document.createElement("p"),l=document.createElement("img");return n.classList.add(a.default.notAutoPlayTipContainer),i.classList.add(a.default.tipBtn),i.innerHTML="点击播放",c.classList.add(a.default.tipText),c.innerHTML='\n    你的浏览器<a class="'.concat(a.default.textTipEmphasize,'">不支持</a>自动播放\n  '),l.classList.add(a.default.tipImg),l.src="//i0.hdslb.com/bfs/activity-plat/static/20211217/d0411babbbf77c49ca42a3320eb804ae/OqYjEF1uIM.png",i.onclick=function(){n.remove(),t()},n.appendChild(l),n.appendChild(c),n.appendChild(i),e.appendChild(n),function(){n.remove()}}function i(e,n,i){var c=document.createElement("div"),l=document.createElement("img"),o=document.createElement("p");return l.src="//i0.hdslb.com/bfs/activity-plat/static/20211220/d0411babbbf77c49ca42a3320eb804ae/hDsUctDb2f.png",o.innerText="点击取消静音",c.classList.add(a.default.mutePlayTipContainer),o.classList.add(a.default.tipText),l.classList.add(a.default.tipImg),c.appendChild(l),c.appendChild(o),e.appendChild(c),c.onclick=function(){c.remove(),i()},n.on(t.ControllerEventType.BottomDistanceChange,function(e){var t=n.getCtrlUI().show;c.style.bottom="".concat(e+(t?50:10),"px")}),{destroy:function(){c.remove()},change:function(e){c.style.bottom="".concat(parseInt(getComputedStyle(n.getCtrlEl()).bottom)+(e?50:10),"px")}}}exports.createNotAutoPlayTip=n,exports.createMutePlayTip=i;
},{"@bilibili-live/web-player":"DfF7","./not-auto-play.less":"z9tw"}],"PcJY":[function(require,module,exports) {
"use strict";function e(e,n,t){var a=r(e,e.VERTEX_SHADER,n),o=r(e,e.FRAGMENT_SHADER,t),c=e.createProgram();if(null==c)throw Error("Can't create shader program");if(e.attachShader(c,a),e.attachShader(c,o),e.linkProgram(c),!e.getProgramParameter(c,e.LINK_STATUS))throw Error("Unable to initialize the shader program");return c}function r(e,r,n){var t=e.createShader(r);if(null==t)throw Error("Can't create shader");if(e.shaderSource(t,n),e.compileShader(t),!e.getShaderParameter(t,e.COMPILE_STATUS)){var a=e.getShaderInfoLog(t);throw e.deleteShader(t),Error(null!=a?a:"An error occurred compiling the shaders")}return t}function n(e,r,n){e.bindTexture(e.TEXTURE_2D,r),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n),e.drawArrays(e.TRIANGLES,0,6)}function t(e){var r=e.createTexture();if(null==r)throw Error("Could not create texture");e.bindTexture(e.TEXTURE_2D,r);var n=e.RGBA,t=e.RGBA,a=e.UNSIGNED_BYTE,o=new Uint8Array([0,0,255,255]);return e.texImage2D(e.TEXTURE_2D,0,n,1,1,0,t,a,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),r}Object.defineProperty(exports,"__esModule",{value:!0}),exports.videoCAS=void 0;var a=[-1,1,-1,-1,1,-1,1,-1,1,1,-1,1],o=[0,1,0,0,1,0,1,0,1,1,0,1];function c(r,n,t){if(null==r)throw Error("Cant create gl context");var c=e(r,g,v);r.useProgram(c),r.uniform1f(r.getUniformLocation(c,"srcWidth"),n),r.uniform1f(r.getUniformLocation(c,"srcHeight"),t),r.uniform1i(r.getUniformLocation(c,"frameTexture"),0);var i=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,i),r.bufferData(r.ARRAY_BUFFER,new Float32Array(a),r.STATIC_DRAW);var f=r.getAttribLocation(c,"aPos");r.vertexAttribPointer(f,2,r.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT,0),r.enableVertexAttribArray(f);var l=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,l),r.bufferData(r.ARRAY_BUFFER,new Float32Array(o),r.STATIC_DRAW);var u=r.getAttribLocation(c,"aTexCoord");r.vertexAttribPointer(u,2,r.FLOAT,!1,2*Float32Array.BYTES_PER_ELEMENT,0),r.enableVertexAttribArray(u)}function i(e,r){function n(){e.width=r.videoWidth,e.height=r.videoHeight;["width","height","position","left","top","zIndex","overflow"].forEach(function(n){e.style[n]=r.style[n]});var n=r.style.objectFit;e.style.objectFit=0===n.length?"contain":n}n();var t=new MutationObserver(function(e){e.some(function(e){return"style"===e.attributeName})&&n()});return t.observe(r,{attributes:!0}),function(){t.disconnect()}}function f(e){var r=document.createElement("canvas");if("VIDEO"!==e.tagName)return{canvas:r,supported:!1,stop:function(){}};var a=i(r,e),o=!0,f=null,v=r.getContext("webgl2");null==v?l():(c(v,e.videoWidth,e.videoHeight),f=t(v),function r(){if(null==v||null==f)return;n(v,f,e);g=requestAnimationFrame(r)}());var g=0;function l(){a(),null==r||r.remove(),o=!1,cancelAnimationFrame(g)}return{canvas:r,supported:o,stop:l}}exports.videoCAS=f;var v="#version 300 es\n// Copyright (c) 2023 Bilibili Inc. All rights reserved.\n// ======================================================================\n// Bili Mobile Super Resolution [BMSR] - scaling & sharpening & vibrance\n// v0.2.7\n// ======================================================================\nprecision highp float;\nout vec4 FragColor;\n\nin vec2 TexCoord;\n\nuniform sampler2D frameTexture;\nuniform float srcWidth; //input width\nuniform float srcHeight; //input height\nconst float usmCoeff = 1.2; // for usm v2, range [1.0, 1.5]\nconst float upperCoeff = 0.5; // range [0.0, 1.0]\nconst float lowerCoeff = 0.5; // range [0.0, 1.0]\nconst float vibCoeff = 0.2; // range [0.0, 0.5)\nconst float brightCoeff = 0.15; // range [0.0, 0.3]\n\nconst float lobe = 0.25; // default 0.25\nconst float eps = 1.0e-8;\n\nvoid calcMeanVar(\n    inout vec3 aMean,\n    inout vec3 aVar,\n    float w,\n    vec3 a, vec3 b, vec3 c, vec3 d, vec3 e\n) {\n    vec3 sum = a + b + c + d + e;\n    vec3 mean = sum / 5.0;\n    vec3 sum2 = a * a + b * b + c * c + d * d + e * e;\n    vec3 var = sum2 / 5.0 - mean * mean;\n    aMean += w * mean;\n    aVar += w * var;\n}\n\nvoid vibranceV2(\n    inout vec3 rgbUSM,\n    vec3 rgbRS\n) {\n    float rgbMax = max(rgbRS.r, max(rgbRS.g, rgbRS.b));\n    float rgbMin = min(rgbRS.r, min(rgbRS.g, rgbRS.b));\n    float delta = rgbMax - rgbMin;\n    float flag = step(eps, delta);\n    float value = rgbMax + rgbMin;\n    float L = value / 2.0;\n    float S = delta / abs(2.0 * step(0.5, L) - value);\n    float alpha = 1.0 / clamp(1.0 - vibCoeff, S, 1.0) - 1.0;\n    rgbUSM = rgbUSM + flag * alpha * (rgbUSM - L);\n}\n\nvoid lanczos2(\n    inout vec3 aC,\n    inout float aW,\n    vec2 off,\n    vec3 c\n) {\n    vec2 wA = 0.4 * off * off - 1.0;\n    wA = 1.5625 * wA * wA - 0.5625;\n    vec2 wB = lobe * off * off - 1.0;\n    wB *= wB;\n    wB *= wA;\n    float w = wB.x * wB.y;\n    aC += w * c;\n    aW += w;\n}\n\nvoid main() {\n    vec2 invSrc = vec2(1.0 / srcWidth, 1.0 / srcHeight);\n    vec2 pp = TexCoord * vec2(srcWidth, srcHeight) - 0.5; // output texture coordinate in the input pixel coordinate\n    vec2 fp = floor(pp); // fp is F in the pixel coordinate\n    pp -= fp; // offset to the top left f\n    fp = fp + 0.5; // make fp being the pixel coordinate corresponding to f in the texture coordinate\n    vec3 bC = texture(frameTexture, (fp + vec2(0.0, -1.0)) * invSrc).rgb;\n    vec3 cC = texture(frameTexture, (fp + vec2(1.0, -1.0)) * invSrc).rgb;\n    vec3 eC = texture(frameTexture, (fp + vec2(-1.0, 0.0)) * invSrc).rgb;\n    vec3 fC = texture(frameTexture, fp * invSrc).rgb;\n    vec3 gC = texture(frameTexture, (fp + vec2(1.0, 0.0)) * invSrc).rgb;\n    vec3 hC = texture(frameTexture, (fp + vec2(2.0, 0.0)) * invSrc).rgb;\n    vec3 iC = texture(frameTexture, (fp + vec2(-1.0, 1.0)) * invSrc).rgb;\n    vec3 jC = texture(frameTexture, (fp + vec2(0.0, 1.0)) * invSrc).rgb;\n    vec3 kC = texture(frameTexture, (fp + vec2(1.0, 1.0)) * invSrc).rgb;\n    vec3 lC = texture(frameTexture, (fp + vec2(2.0, 1.0)) * invSrc).rgb;\n    vec3 nC = texture(frameTexture, (fp + vec2(0.0, 2.0)) * invSrc).rgb;\n    vec3 oC = texture(frameTexture, (fp + vec2(1.0, 2.0)) * invSrc).rgb;\n    vec3 rgbRS = vec3(0.0);\n    float aW = 0.0;\n    lanczos2(rgbRS, aW, vec2(0.0, -1.0) - pp, bC);\n    lanczos2(rgbRS, aW, vec2(1.0, -1.0) - pp, cC);\n    lanczos2(rgbRS, aW, vec2(-1.0, 0.0) - pp, eC);\n    lanczos2(rgbRS, aW, vec2(0.0, 0.0) - pp, fC);\n    lanczos2(rgbRS, aW, vec2(1.0, 0.0) - pp, gC);\n    lanczos2(rgbRS, aW, vec2(2.0, 0.0) - pp, hC);\n    lanczos2(rgbRS, aW, vec2(-1.0, 1.0) - pp, iC);\n    lanczos2(rgbRS, aW, vec2(0.0, 1.0) - pp, jC);\n    lanczos2(rgbRS, aW, vec2(1.0, 1.0) - pp, kC);\n    lanczos2(rgbRS, aW, vec2(2.0, 1.0) - pp, lC);\n    lanczos2(rgbRS, aW, vec2(0.0, 2.0) - pp, nC);\n    lanczos2(rgbRS, aW, vec2(1.0, 2.0) - pp, oC);\n    rgbRS /= aW;\n    rgbRS = clamp(rgbRS, 0.0, 1.0);\n    vec3 mean = vec3(0.0);\n    vec3 var = vec3(0.0);\n    calcMeanVar(mean, var, (1.0 - pp.x) * (1.0 - pp.y), bC, eC, fC, gC, jC);\n    calcMeanVar(mean, var, pp.x * (1.0 - pp.y), cC, fC, gC, hC, kC);\n    calcMeanVar(mean, var, (1.0 - pp.x) * pp.y, fC, iC, jC, kC, nC);\n    calcMeanVar(mean, var, pp.x * pp.y, gC, jC, kC, lC, oC);\n    vec3 W = usmCoeff + 1.0 / (var + 1.0);\n    vec3 rgbUSM = mean + W * (rgbRS - mean);\n    vec3 diff = rgbUSM - rgbRS;\n    vec3 rgbRS2 = rgbRS * rgbRS;\n    vec3 maxDiff = 0.5 * rgbRS2 * rgbRS2 - 1.32 * rgbRS2 * rgbRS + 1.12 * rgbRS2 - 0.38 * rgbRS + 0.08;\n    vec3 minDiff = maxDiff - 0.08;\n    rgbUSM = rgbRS + min(max(diff, minDiff), maxDiff);\n    rgbUSM = clamp(rgbUSM, 0.0, 1.0);\n    vibranceV2(rgbUSM, rgbRS);\n    rgbUSM = -brightCoeff * rgbUSM * rgbUSM + (1.0 + brightCoeff) * rgbUSM;\n    FragColor = vec4(rgbUSM, 1.0);\n}",g="#version 300 es\nlayout (location = 0) in vec2 aPos;\nlayout (location = 1) in vec2 aTexCoord;\n\nout vec2 TexCoord;\n\nvoid main()\n{\n    gl_Position = vec4(aPos, 0.0, 1.0);\n    TexCoord = vec2(aTexCoord.x, 1.0 - aTexCoord.y);\n}";
},{}],"Qsz6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.startVideoCAS=void 0;var e=require("@bilibili-live/web-player"),t=require("./cas");function i(i){var r=function(){},n=0,o=0,a=function(){var e=i.getVideoEl();if(null!=e){n=e.videoWidth,o=e.videoHeight;var a=(0,t.videoCAS)(e),v=a.canvas,d=a.supported,l=a.stop;d&&(r(),r=l,i.container.appendChild(v))}};a();var v=i.on(e.VideoEventType.FirstFrame,function(){r(),a()}),d=i.on(e.VideoEventType.Ended,r),l=i.on(e.VideoEventType.Error,r),c=i.on(e.LivePlayerEvent.Destroyed,r),s=0,u=i.on(e.VideoEventType.MetaData,function(){var e=0;clearInterval(s),s=window.setInterval(function(){if(e>15)clearInterval(s);else{e+=1;var t=i.getVideoEl();null!=t&&(t.videoWidth===n&&t.videoHeight===o||(clearInterval(s),r(),a()))}},1e3)});return function(){clearInterval(s),r(),v(),c(),u(),d(),l()}}exports.startVideoCAS=i;
},{"@bilibili-live/web-player":"DfF7","./cas":"PcJY"}],"ZYDn":[function(require,module,exports) {
"use strict";function e(e,t,n){return Math.max(t,Math.min(n,e))}function t(t,n,o){var i=0,r=0,u=0,s=0,c=100,v=100,d=0,m=0,a=0,l=function(e){var o=e.clientX,l=e.clientY;u=o,s=l;var p=n.getBoundingClientRect(),f=p.x,h=p.y;d=f,m=h;var E=t.getBoundingClientRect(),y=E.x,L=E.y,g=E.width,b=E.height;i=y,r=L,a=b,c=(n.clientWidth-g)/n.clientWidth*100,v=100-b/n.clientHeight*100},p=function(o){var l=o.clientX,p=o.clientY,f=(i+l-u-d)/n.clientWidth*100,h=100-(r+p-s-m+a)/n.clientHeight*100;t.style.transform="",t.style.left="".concat(e(f,0,c),"%"),t.style.bottom="".concat(e(h,15,v),"%")},f=function(e){l(e.touches[0])},h=function(e){e.preventDefault(),p(e.touches[0])},E=function(e){e.preventDefault(),e.stopPropagation(),p(e)},y=function(e){l(e),document.body.addEventListener("mouseup",L),document.body.addEventListener("mousemove",E),o.onMouseDown()},L=function e(t){t.preventDefault(),t.stopPropagation(),document.body.removeEventListener("mouseup",e),document.body.removeEventListener("mousemove",E),o.onMouseUp()};return t.addEventListener("touchstart",f,{passive:!1}),t.addEventListener("touchmove",h,{passive:!1}),t.addEventListener("mousedown",y),function(){t.removeEventListener("touchstart",f),t.removeEventListener("touchmove",h),t.removeEventListener("mousedown",y),document.body.removeEventListener("mouseup",L),document.body.removeEventListener("mousemove",E)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.dragElement=void 0,exports.dragElement=t;
},{}],"YMnC":[function(require,module,exports) {
var e='.web-player-subtitle{display:none;position:absolute;bottom:15%;left:50%;color:#fff;font-size:24px;width:800px;padding:5px 12px;box-sizing:border-box;border-radius:4px;background:rgba(0,0,0,.4);z-index:11;user-select:none}.web-player-subtitle>div{overflow:hidden;line-height:30px;max-height:60px;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;text-overflow:ellipsis}.web-player-subtitle.draggable{z-index:14;pointer-events:auto;cursor:move}.web-player-subtitle.dragging{background:rgba(0,0,0,.9);border:1px solid hsla(0,0%,100%,.3);box-shadow:0 4px 4px 0 rgba(0,0,0,.25)}.web-player-subtitle:after{content:"AI";position:absolute;top:0;right:4px;font-size:10px;opacity:.75;transform:scale(.8)}',t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.head.appendChild(t);
},{}],"E2W8":[function(require,module,exports) {
"use strict";var t,e,i,n,s,r,o,a,l,f,c,u,h,d,p=this&&this.__assign||function(){return(p=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},y=this&&this.__classPrivateFieldGet||function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)},b=this&&this.__classPrivateFieldSet||function(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Subtitle=void 0;var v=require("@bilibili-live/web-player-common"),m=require("./drag-element");require("./subtitle.less");var w=function(){function h(u,h){this.container=u,t.add(this),e.set(this,{}),i.set(this,(0,v.createElement)("div",{attributes:[["id","web-player-subtitle"],["class","web-player-subtitle"]]})),n.set(this,function(){}),s.set(this,function(){}),r.set(this,!1),o.set(this,new v.EventBus),a.set(this,y(this,o,"f").emit),this.on=y(this,o,"f").on,l.set(this,{"#BFEDFA":null,"#FFB3CA":null,"#FFF5BF":null,"#FFC18F":null,"#89E1E1":null,"#D8B6FF":null}),f.set(this,!1),c.set(this,!1),y(this,i,"f").appendChild((0,v.createElement)("div")),y(this,i,"f").appendChild((0,v.createElement)("div")),g(y(this,i,"f"),u,h.pos),u.appendChild(y(this,i,"f"))}return Object.defineProperty(h.prototype,"visible",{get:function(){return y(this,f,"f")},set:function(t){t||(y(this,i,"f").style.display="none"),b(this,f,t,"f")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"pos",{get:function(){return{x:y(this,i,"f").style.left,y:y(this,i,"f").style.bottom}},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"draggable",{get:function(){return y(this,c,"f")},set:function(t){var e=this;t?y(this,i,"f").classList.add("draggable"):y(this,i,"f").classList.remove("draggable"),b(this,c,t,"f"),y(this,s,"f").call(this),t&&b(this,s,(0,m.dragElement)(y(this,i,"f"),this.container,{onMouseDown:function(){b(e,r,!0,"f"),y(e,i,"f").classList.add("dragging"),y(e,a,"f").call(e,"dragStart")},onMouseUp:function(){b(e,r,!1,"f"),y(e,i,"f").classList.remove("dragging"),y(e,i,"f").dataset.offsetBottom=y(e,i,"f").style.bottom,y(e,a,"f").call(e,"dragEnded",{x:y(e,i,"f").style.left,y:y(e,i,"f").style.bottom})}}),"f")},enumerable:!1,configurable:!0}),h.prototype.add=function(i){var n;for(var s in y(this,e,"f"))i.id in y(this,e,"f")[s]&&delete y(this,e,"f")[s][i.id];var r=y(this,e,"f")[i.roleId],o=y(this,t,"m",u).call(this,i.roleId);null==r?(i.color=o,y(this,e,"f")[i.roleId]=((n={})[i.id]=i,n)):r[i.id]=p(p({},i),{color:o})},h.prototype.setVideoSource=function(e){y(this,t,"m",d).call(this,e)},h.prototype.destroy=function(){y(this,n,"f").call(this),b(this,e,{},"f"),y(this,i,"f").remove()},h}();function g(t,e,i){null==i?(t.style.left="50%",t.style.bottom="15%",t.style.transform="translateX(-50%)"):(t.style.left=i.x,t.style.bottom=i.y)}exports.Subtitle=w,e=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,l=new WeakMap,f=new WeakMap,c=new WeakMap,t=new WeakSet,u=function(t){if("0"===t)return"#FFFFFF";for(var e="",i=0,n=Object.entries(y(this,l,"f"));i<n.length;i++){var s=n[i],r=s[0],o=s[1];if(o===t){e=r;break}null==o&&""===e&&(e=r)}return""!==e&&(y(this,l,"f")[e]=t),e},h=function(t){var i=this,n=1e3*t.currentTime;return Object.values(y(this,e,"f")).map(function(t){return Object.values(t)}).filter(function(t){return t.length>0}).slice(0,2).map(function(t){var s=1/0,r=null;return t.forEach(function(t){if(t.offset+t.duration<n)return delete y(i,e,"f")[t.roleId][t.id],void(0===Object.keys(y(i,e,"f")[t.roleId]).length&&delete y(i,e,"f")[t.roleId]);if(!(n<t.offset)){var o=Math.abs(n-t.offset);o<s&&(s=o,r=t)}}),r}).filter(Boolean)},d=function(e){var s=this,o=function(){if(y(s,f,"f")&&!y(s,r,"f")){var n=y(s,t,"m",h).call(s,e);if(0!==n.length){y(s,i,"f").childNodes.forEach(function(t,e){var i;t.textContent="";var s=n[e];null!=s&&(t.textContent=n[e].content,t.style.color=null!==(i=s.color)&&void 0!==i?i:"#fff")});var o=y(s,i,"f").offsetTop,a=y(s,i,"f").style.bottom;if(o<0&&!a.startsWith("calc"))y(s,i,"f").style.bottom="calc(".concat(a," + ").concat(y(s,i,"f").offsetTop,"px)");else if(o>=0){var l=y(s,i,"f").dataset.offsetBottom;null!=l&&(y(s,i,"f").style.bottom=l)}y(s,i,"f").style.display="block"}else y(s,i,"f").style.display="none"}};e.addEventListener("timeupdate",o),y(this,n,"f").call(this),b(this,n,function(){e.removeEventListener("timeupdate",o)},"f")};
},{"@bilibili-live/web-player-common":"KGHo","./drag-element":"ZYDn","./subtitle.less":"YMnC"}],"jYwk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.connSubtitleAndPlayer=void 0;var e=require("@bilibili-live/web-player"),i=require("@bilibili-live/web-player-common"),t=require("@bilibili-live/web-player-subtitle");function r(r){var l=i.userSetting.get("subtitle"),a=new t.Subtitle(r.container,l);function n(){var e=r.getVideoEl();null!=e&&a.setVideoSource(e)}r.ctrl.getCtrlUI().subtitleStatus={visible:l.visible,draggable:l.draggable},a.visible=l.visible,a.draggable=l.draggable,n();var b=r.ctrl.onChange(function(e,t){var r,l;if("subtitle"===e&&null!=t){var n=t;("draggable"in n||"visible"in n)&&(a.draggable=null!==(r=n.draggable)&&void 0!==r?r:a.draggable,a.visible=null!==(l=n.visible)&&void 0!==l?l:a.visible,i.userSetting.set("subtitle",{visible:a.visible,draggable:a.draggable}))}}),o=r.on(i.ExternalEventType.SEIParseData,function(e,t,r){if(e===i.SEIType.BILILIVESUBTITLE)try{for(var l=JSON.parse(r),n=0,b=l;n<b.length;n++){var o=b[n];a.add({id:o.sub_id,roleId:o.role,content:o.sub,duration:o.dt_ms+(1===o.type?5e3:0),offset:1e3*t+o.ot_ms,type:o.type})}}catch(s){i.logger.error(s)}}),s=r.on(e.VideoEventType.FirstFrame,n),u=a.on("dragStart",function(){r.ctrl.hide(!0)}),d=a.on("dragEnded",function(e){r.ctrl.show(),i.userSetting.set("subtitle",{pos:e})});return function(){o(),b(),u(),d(),s(),a.destroy()}}exports.connSubtitleAndPlayer=r;
},{"@bilibili-live/web-player":"DfF7","@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-subtitle":"E2W8"}],"FFSN":[function(require,module,exports) {
"use strict";function e(e,t){var n=e.onChange(function(e,n){if("subtitle"===e)for(var r in n)t({path:"ctrl.subtitle.".concat(r),value:n[r]})});return function(){n()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.bindUserOperation=void 0,exports.bindUserOperation=e;
},{}],"nuNG":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&t(i,e,a);return n(i,e),i},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{u(i.next(e))}catch(t){o(t)}}function l(e){try{u(i.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,l)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(u){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(a=2&l[0]?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(a=(a=r.trys).length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){r=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(6===l[0]&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(u){l=[6,u],i=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}},r=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,n,i,a){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var i,a=0,o=t.length;a<o;a++)!i&&a in t||(i||(i=Array.prototype.slice.call(t,0,a)),i[a]=t[a]);return e.concat(i||Array.prototype.slice.call(t))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoomPlayer=void 0;var c,f=require("@bilibili-live/web-player-common"),d=require("@bilibili-live/web-player"),v=i(require("@bilibili-live/web-player-socket")),p=require("./danmaku-biz"),m=require("./biz-common"),h=require("./biz-interface"),y=i(require("@bilibili-live/web-player-track")),g=require("./ui-components/end-recommend-panel"),E=s(require("./ui-components/video-logo")),k=s(require("./ui-components/feedback")),b=require("./ui-components/error-panel"),S=s(require("./ui-components/preround-conuter")),w=s(require("@bilibili-live/web-player-contextmenu")),T=s(require("@bilibili-live/web-player-video-info")),I=s(require("@bilibili-live/web-player-danmaku-report")),M=s(require("./ui-components/log-panel")),C=s(require("./browser-fullscreen")),P=require("./log-storage"),x=require("./ui-components/not-auto-play"),V=require("./video-enhance"),D=require("./connects/conn-subtitle"),R=require("./events/user-operation");f.logger.printToConsole=f.wpd.Log2Console,(0,m.commonLogInfo)("RoomPlayer"),function(e){e[e.Click=1]="Click",e[e.Esc=2]="Esc",e[e.DBClick=3]="DBClick",e[e.Other=4]="Other"}(c||(c={}));var F=function(){function t(t,Me){var Ce,Pe,xe,Ve,De,Re,Fe,Le,_e,We=this;this.container=t,this.opts=Me,n.set(this,void 0),i.set(this,void 0),s.set(this,void 0),x.set(this,null),F.set(this,void 0),z.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),J.set(this,void 0),K.set(this,[]),Y.set(this,null),X.set(this,null),Z.set(this,!1),$.set(this,new f.EventBus),ee.set(this,{}),te.set(this,[]),ne.set(this,0),ie.set(this,!1),ae.set(this,void 0),oe.set(this,void 0),re.set(this,null),le.set(this,function(){}),ue.set(this,void 0),this.reload=function(){return a(We,void 0,Promise,function(){var e,t,i,a,u;return o(this,function(o){switch(o.label){case 0:if(r(this,ie,"f"))return[2];l(this,ie,!0,"f"),null===(i=r(this,re,"f"))||void 0===i||i.remove(),l(this,re,null,"f"),o.label=1;case 1:return o.trys.push([1,,4,5]),e=r(this,s,"f"),null!=(t=r(this,n,"f"))?[3,3]:[4,(0,m.initRoomInfoOrBlock)({roomId:e,isMobile:!1},this.container,this.opts.roomInfoProvider)];case 2:t=o.sent(),o.label=3;case 3:if(r(this,Z,"f"))return[2];switch(r(this,ye,"f").call(this),null===(a=r(this,X,"f"))||void 0===a||a.setRoomStatus(t.live_status),t.live_status){case h.RoomStatus.Preparing:r(this,be,"f").call(this,e),this.updateRoomStatus(h.RoomStatus.Preparing);break;case h.RoomStatus.Live:this.updateRoomStatus(h.RoomStatus.Live),l(this,x,r(this,fe,"f").call(this,t,r(this,F,"f")),"f");break;case h.RoomStatus.Round:this.updateRoomStatus(h.RoomStatus.Round),l(this,x,r(this,se,"f").call(this),"f")}return this.emit(f.ExternalEventType.WebPlayerCreated),null!=r(this,x,"f")&&(r(this,we,"f").call(this),r(this,K,"f").push((0,m.pause10SecBlockStream)(r(this,x,"f"),this)),!1===(null===(u=this.opts.UI)||void 0===u?void 0:u.danmaku)&&(0,m.disableDanmaku)({danmakuBiz:r(this,z,"f"),ctrl:r(this,x,"f").ctrl})),r(this,K,"f").push(r(this,pe,"f").call(this,r(this,F,"f"))),l(this,n,void 0,"f"),[3,5];case 4:return l(this,ie,!1,"f"),f.logger.info("room player is reload"),[7];case 5:return[2]}})})},se.set(this,function(){var e,t,n=r(We,s,"f"),a=new d.RoundPlayer(We.container,{roomId:n,userId:r(We,i,"f"),enableCtrlUI:null===(t=null===(e=We.opts.UI)||void 0===e?void 0:e.enableCtrlUI)||void 0===t||t});return y.default.event(y.EventCode.CreateRoundPlayer,{sample:.1}),a.on("failed",function(e,t,i){void 0===i&&(i=y.default.ErrorCode.RoomRoundUnknow),e===d.NonRoundStatus.Preround?r(We,K,"f").push((0,S.default)(We.container,We.reload,t)):e===d.NonRoundStatus.Nonenabled?r(We,be,"f").call(We,n,"系统维护中,轮播暂时不可用"):(y.default.error(i,"".concat(e)),r(We,K,"f").push((0,b.createErrorPanel)(We.container,i)))}),a.on(d.VideoEventType.FirstFrame,function(){var e,t=a.getVideoEl();null!=t&&(r(We,z,"f").danmakuStateHandler.updateVideoEl(t),!0===(null===(e=We.opts.UI)||void 0===e?void 0:e.enableMaskDanmaku)&&r(We,z,"f").danmakuStateHandler.maskSwitch(!0))}),f.EventBus.forwardEvent(a,We,[f.ExternalEventType.StartPlayRound,f.ExternalEventType.Reload,d.VideoEventType.MutePlay,d.VideoEventType.NotAutoPlay,[d.VideoEventType.WaitEnd,f.ExternalEventType.WaitEnd],[d.VideoEventType.WaitStart,f.ExternalEventType.WaitStart],[d.VideoEventType.FirstFrame,f.ExternalEventType.FirstFrame],[d.VideoEventType.Play,f.ExternalEventType.Playing],[d.VideoEventType.Pause,f.ExternalEventType.Paused]]),r(We,K,"f").push(L(r(We,z,"f"),a.ctrl,r(We,i,"f")),O(a.ctrl,We)),a}),ce.set(this,function(){C.default.exitFullscreen().then(function(){We.emit(f.ExternalEventType.FeedBackClick)}).catch(function(e){f.logger.warn(e)})}),fe.set(this,function(e,t){var n,l,u,c,v,p,g,E,k,w=We.opts,T=w.rnd,I=w.UI,M=new d.LivePlayer(We.container,{roomId:r(We,s,"f"),roomInfo:e,userId:r(We,i,"f"),rnd:T,enableCtrlUI:null===(n=null==I?void 0:I.enableCtrlUI)||void 0===n||n,roomInfoProvider:function(e){return a(We,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,(0,m.loadRoomInfo)(e,this.opts.roomInfoProvider)];case 1:return[2,t.sent()]}})})}},t);r(We,te,"f").push((0,m.dmVisualVibrate)(M,r(We,z,"f"))),(0,d.isBwpSupported)()&&M.showHEVCQuality(!0);var C=M.ctrl.getCtrlUI();for(var P in C.ctrlItemVisibility.mirror=null!==(u=null===(l=We.opts.UI)||void 0===l?void 0:l.showMirror)&&void 0!==u&&u,C.ctrlItemVisibility.pip=null===(v=null===(c=We.opts.UI)||void 0===c?void 0:c.pip)||void 0===v||v,C.ctrlItemVisibility.subtitle=null!==(g=null===(p=We.opts.UI)||void 0===p?void 0:p.subtitle)&&void 0!==g&&g,C.ctrlItemVisibility.webFullScreen=null===(k=null===(E=We.opts.UI)||void 0===E?void 0:E.webFullScreen)||void 0===k||k,C.ctrlItemVisibility.subtitle&&(r(We,ve,"f").enable(M),r(We,K,"f").push(r(We,ve,"f").disable)),r(We,ee,"f"))"setAutoSyncCfg"===P&&M.setAutoSyncCfg(r(We,ee,"f")[P]);return r(We,de,"f").refresh(M),M.on(d.LivePlayerEvent.Failed,function(e,t){y.default.error(e,null!=t?t:""),r(We,K,"f").push((0,b.createErrorPanel)(We.container,e,t)),M.destroy()}),M.on(d.LivePlayerEvent.LiveStatusChange,function(e){We.updateRoomStatus(h.RoomStatus.Preparing),r(We,Te,"f").call(We),e===h.RoomStatus.Round?r(We,K,"f").push((0,S.default)(We.container,We.reload)):r(We,be,"f").call(We,r(We,s,"f"))}),M.on(d.VideoEventType.FirstFrame,function(){var e,t=M.getVideoEl();if(null!=t){r(We,z,"f").danmakuStateHandler.updateVideoEl(t);var n=!0===(null===(e=We.opts.UI)||void 0===e?void 0:e.enableMaskDanmaku);r(We,z,"f").danmakuStateHandler.maskSwitch(n),H({dmBiz:r(We,z,"f"),dmSwitch:M.ctrl.getCtrlUI().danmaku.display})}}),f.EventBus.forwardEvent(M,We,[f.ExternalEventType.SwitchLine,f.ExternalEventType.SwitchQuality,f.ExternalEventType.SwitchQualityNotLogin,f.ExternalEventType.Reload,f.ExternalEventType.SEIParseData,[d.VideoEventType.WaitEnd,f.ExternalEventType.WaitEnd],[d.VideoEventType.WaitStart,f.ExternalEventType.WaitStart],d.VideoEventType.MutePlay,d.VideoEventType.NotAutoPlay,[d.VideoEventType.FirstFrame,f.ExternalEventType.FirstFrame],[d.VideoEventType.Destroyed,f.ExternalEventType.VideoDestroyed],[d.VideoEventType.Play,f.ExternalEventType.Playing],[d.VideoEventType.Pause,f.ExternalEventType.Paused],[d.VideoEventType.MetaData,f.ExternalEventType.MetaDataChange],[d.LivePlayerEvent.VideoError,f.ExternalEventType.VideoError],[d.LivePlayerEvent.Failed,f.ExternalEventType.PlayFaild]]),r(We,K,"f").push(L(r(We,z,"f"),M.ctrl,r(We,i,"f")),O(M.ctrl,We),_(r(We,G,"f"),M)),M}),de.set(this,(Ve=!1,De=function(){},{start:Re=function(e){Ve=!0,De(),e instanceof d.LivePlayer&&(De=(0,V.startVideoCAS)(e)),y.default.custom(y.default.CustomCode.VideoEnhance,1,{extFields:["videoTag","quality","sCodec"]})},stop:function(){Ve=!1,De(),y.default.custom(y.default.CustomCode.VideoEnhance,0,{extFields:["videoTag","quality","sCodec"]})},refresh:function(e){Ve&&Re(e)}})),ve.set(this,(Fe=function(){},{enable:function(e){Fe(),Fe=(0,D.connSubtitleAndPlayer)(e)},disable:function(){Fe()}})),pe.set(this,function(e){f.logger.info("room player listen socket message");var t=function(e){f.logger.warn("refresh by socket ".concat(e)),We.reload().catch(function(e){f.logger.error(e)})},n=r(We,s,"f"),a=e.on("message",function(e){if(!e.cmd.startsWith("DANMU_MSG")){switch(e.cmd){case v.SocketMsgType.Live:if(r(We,x,"f")instanceof d.LivePlayer)break;r(We,K,"f").push((0,f.disperseAction)(1e4,function(){t(e.cmd)}));break;case v.SocketMsgType.Round:if(r(We,x,"f")instanceof d.RoundPlayer)break;t(e.cmd);break;case v.SocketMsgType.Preparing:r(We,Te,"f").call(We),1===e.round?r(We,K,"f").push((0,S.default)(We.container,We.reload)):r(We,be,"f").call(We,n),We.updateRoomStatus(h.RoomStatus.Preparing);break;case v.SocketMsgType.End:case v.SocketMsgType.Close:case v.SocketMsgType.Block:r(We,be,"f").call(We,n),We.updateRoomStatus(h.RoomStatus.Preparing);break;case v.SocketMsgType.Refresh:t(e.cmd);break;case v.SocketMsgType.AreaBlock:break;case v.SocketMsgType.HotRoomNotify:if(!Array.isArray(e.data.random_delay_req_v2))break;a=performance.now()+1e3*Number(e.data.ttl),isNaN(a)?f.logger.error("HotRoomNotify ttl error: ".concat(String(e.data.ttl))):(f.logger.debug("HotRoomNotify msg: ".concat(JSON.stringify(e.data.random_delay_req_v2))),e.data.random_delay_req_v2.forEach(function(e){var t=e.path,n=e.delay;f.ajax.disperse(t,{scope:n,expiresTime:a})}));break;case v.SocketMsgType.LOG_IN_NOTICE:0===r(We,i,"f")&&r(We,ue,"f").call(We)}var a;We.emit(f.ExternalEventType.ReceiveMessage,e)}}),o=e.on("heartbeat",function(e){We.emit(f.ExternalEventType.ReceiveOnlineCount,e.count)});return function(){a(),o()}}),me.set(this,function(e,t){var n;if(r(We,x,"f")instanceof d.LivePlayer){var i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.getVideoEl();"danmaku"===e&&r(We,z,"f").changeMaskState(i,t.enableMask),"playStatus"===e&&!0!==t&&(clearTimeout(r(We,ne,"f")),r(We,z,"f").changeMaskState(i,!1,!0))}}),he.set(this,function(e,t){return a(We,void 0,Promise,function(){var n,i,a,l,u,c,d=this;return o(this,function(o){switch(o.label){case 0:switch(e){case"report":return[3,1];case"shield":return[3,3];case"addBlackList":return[3,4]}return[3,5];case 1:return[4,r(this,ae,"f").show({uid:t.uid,roomid:r(this,s,"f"),uname:t.uname,msg:t.text,checkInfo:t.checkInfo,type:t.dmType,file_id:null!==(l=null!==(i=null===(n=t.voiceConfig)||void 0===n?void 0:n.file_id)&&void 0!==i?i:null===(a=t.emoticonOptions)||void 0===a?void 0:a.emoticon_unique)&&void 0!==l?l:"",img_url:null!==(c=null===(u=t.emoticonOptions)||void 0===u?void 0:u.url)&&void 0!==c?c:"",id_str:t.id_str})];case 2:return o.sent(),[3,5];case 3:return(0,p.roomBlockAdapter)({component:"block",action:"addShieldUser",data:{uid:t.uid,uname:t.uname}},r(this,z,"f"),r(this,s,"f"),function(e,t){d.emit(f.ExternalEventType.Set,{component:"block",action:e,data:t})}),[3,5];case 4:return this.emit(f.ExternalEventType.Set,{component:"block",action:"addBlackList",data:t.uname}),[3,5];case 5:return[2]}})})}),ye.set(this,function(){r(We,K,"f").forEach(function(e){return e()}),l(We,K,[],"f")}),ge.set(this,function(){var t=e(e({NAME:"BILIBILI HTML5 LIVE PLAYER",VERSION:m.ENV.VERSION},"development"===m.ENV.NODE_ENV?{socket:r(We,F,"f")}:{}),{play:function(){var e;null===(e=r(We,x,"f"))||void 0===e||e.play()},pause:function(){var e;null===(e=r(We,x,"f"))||void 0===e||e.pause()},volume:function(t){var n;f.userSetting.setVolume(e(e({},f.userSetting.getVolume()),{value:t})),null===(n=r(We,x,"f"))||void 0===n||n.volume(t/100)},setDanmaku:function(){},reload:We.reload,destroy:We.destroy,getOperableElements:We.getOperableElements,freeze:function(){var e;null===(e=r(We,x,"f"))||void 0===e||e.blockStream()},refresh:function(){We.reload().catch(function(e){f.logger.error(e)})},set:function(e){"block"===e.component&&(0,p.roomBlockAdapter)(e,r(We,z,"f"),r(We,s,"f"),function(e,t){We.emit(f.ExternalEventType.Set,{component:"block",action:e,data:t})})},setFullscreenDanmaku:function(e){null!=r(We,x,"f")&&U(e,r(We,x,"f"))},sendDanmaku:function(e){return a(We,void 0,void 0,function(){var t=this;return o(this,function(n){switch(n.label){case 0:return[4,r(this,z,"f").userSendDanmaku(e).then(function(n){var i={uniqueID:e.uniqueID,response:n};return t.emit(f.ExternalEventType.SendDanmaku,i),i})];case 1:return[2,n.sent()]}})})},setFullscreenStatus:function(e){null!=r(We,x,"f")&&r(We,x,"f").ctrl.setScreenStatus(e)},toast:function(e){(0,f.toast)(e,We.container)},setToastCssText:function(e){(0,f.setToastCssText)(e)},notifyInOperation:function(e){We.getOperableElements().mainElement.style.zIndex="".concat(e?9:-1)},notifyAnnouncement:We.notifyAnnouncement,injectInitAPIData:We.injectInitAPIData,getVideoEl:function(){var e,t;return null!==(t=null===(e=r(We,x,"f"))||void 0===e?void 0:e.getVideoEl())&&void 0!==t?t:null},supportMaskDanmaku:function(){return r(We,z,"f").supportMaskDanmaku()},featSupport:function(e){return"MaskDanmaku"===e?r(We,z,"f").supportMaskDanmaku():"VideoEnhance"===e?!f.ua.isSafari()&&null!=document.createElement("canvas").getContext("webgl2"):void 0},switchAudioTrack:function(e){var t,n;return r(We,x,"f")instanceof d.LivePlayer&&null!==(n=null===(t=r(We,x,"f"))||void 0===t?void 0:t.switchAudioTrack(e))&&void 0!==n?n:-1},getAudioTracks:function(){var e;if(r(We,x,"f")instanceof d.LivePlayer)return null===(e=r(We,x,"f"))||void 0===e?void 0:e.getAudioTracks()},changeUIStatus:function(t){var n,i,a,o,u,s,c=null===(n=r(We,x,"f"))||void 0===n?void 0:n.getVideoEl();if(null!==(a=null===(i=JSON.stringify(We.opts.roomInitDataV2))||void 0===i?void 0:i.includes("全景"))&&void 0!==a&&a&&null!=t.showMirror&&(t.showMirror=!1),null!=c&&(!0===t.enableMaskDanmaku?(r(We,z,"f").bodyMaskDetectorStatus=!0,r(We,z,"f").danmakuStateHandler.maskSwitch(!0)):!1===t.enableMaskDanmaku&&(r(We,z,"f").bodyMaskDetectorStatus=!1,r(We,z,"f").danmakuStateHandler.maskSwitch(!1))),!1===t.feedback?null===(o=r(We,Y,"f"))||void 0===o||o.call(We):!0===t.feedback&&null==r(We,Y,"f")&&l(We,Y,(0,k.default)(We.container,r(We,ce,"f")),"f"),!1===t.logo?null===(u=r(We,X,"f"))||void 0===u||u.destroy():!0===t.logo&&null==r(We,X,"f")&&l(We,X,(0,E.default)(We.container),"f"),!1===t.recommend&&r(We,le,"f").call(We),We.opts.UI=Object.assign({},We.opts.UI,t),null!=r(We,x,"f")){!0===t.subtitle&&r(We,x,"f")instanceof d.LivePlayer?r(We,ve,"f").enable(r(We,x,"f")):!1===t.subtitle&&r(We,ve,"f").disable();var v=r(We,x,"f").ctrl.getCtrlUI();if(null!=t.showMirror&&(v.ctrlItemVisibility.mirror=t.showMirror),v.ctrlItemVisibility.subtitle=null!==(s=We.opts.UI.subtitle)&&void 0!==s&&s,!1===t.webFullScreen&&(v.ctrlItemVisibility.webFullScreen=!1),null!=t.pip&&(v.ctrlItemVisibility.pip=t.pip),null!=t.pipStatus)if(v.pipStatus=t.pipStatus,t.pipStatus){var p=r(We,x,"f").getVideoEl();null==p||p.requestPictureInPicture().catch(f.logger.error)}else j();null!=t.showDanmakuSetting&&(v.ctrlItemVisibility=e(e({},v.ctrlItemVisibility),{danmakuPanel:t.showDanmakuSetting})),!1===t.danmaku&&(0,m.disableDanmaku)({danmakuBiz:r(We,z,"f"),ctrl:r(We,x,"f").ctrl})}},changeDanmakuExtraConfig:function(e){r(We,z,"f").updateDanmakuExtraConfig(e)},changeCtrlVisible:function(e,t){var n,i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.ctrl;if(null!=i){var a=!1===t;e?i.show(a):i.hide()}},capturePic:function(e,t){var n,i;return null!==(i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.capturePic(e,t))&&void 0!==i?i:null},on:function(t,i){var a;if(t===f.ExternalEventType.Initialized)return i({type:"html5"}),void f.logger.info("room player emit external event: Initialized");if(t===f.ExternalEventType.InitDanmaku){var o=r(We,z,"f").getDanmakuConfig();return f.logger.info("room player emit external event: InitDanmaku, data: ".concat(JSON.stringify(o))),void i(e(e({},o),{room_shield:null===(a=r(We,n,"f"))||void 0===a?void 0:a.room_shield}))}return We.on(t,i)},once:function(e,t){return We.once(e,t)},addLoadingPicture:function(e){var t;null===(t=r(We,x,"f"))||void 0===t||t.setTitlePageImg(e)},stopPlayback:function(e){var t;null!=r(We,x,"f")&&(r(We,x,"f").destroy(),r(We,ye,"f").call(We),(0,f.coverImg)(null!==(t=null==e?void 0:e.url)&&void 0!==t?t:"//s1.hdslb.com/bfs/static/player/live/html5/images/error@1x.png",We.container),r(We,K,"f").push(function(){(0,f.coverImg)(null,We.container)}))},getPlayerInfo:function(){var t,n,i,a=r(We,x,"f"),o={type:1,version:m.ENV.VERSION,playerType:"HTML5",liveStatus:h.RoomStatus.Preparing,playerStatus:0,playingStatus:!1,playurl:"",guid:"",quality:"0",qualityCandidates:[],timeShift:0};if(null==a)return o;var l=a.getPlayerInfo(),u=null!==(t=a.ctrl.getCtrlUI().webFullScreenStatus)&&void 0!==t&&t?1:null!==(n=a.ctrl.getCtrlUI().fullScreenStatus)&&void 0!==n&&n?2:0;return e(e({},o),{liveStatus:a instanceof d.LivePlayer?1:0,playerStatus:u,timeShift:null!==(i=l.timeShift)&&void 0!==i?i:0,playingStatus:l.playingStatus,playurl:l.playSrc,guid:l.guid,quality:l.quality,qualityCandidates:l.qualityCandidates.map(function(e){var t=e.label;return{qn:e.value,desc:t}}),volume:a.ctrl.getCtrlUI().volume,danmaku:f.userSetting.getDanmaku()})},switchQuality:function(e){r(We,x,"f")instanceof d.LivePlayer&&r(We,x,"f").switchQuality(e)},updateDMSetting:function(t){null!=r(We,z,"f")&&(f.userSetting.setDanmaku(e(e({},f.userSetting.getDanmaku()),t)),(0,m.updateDanmakuSetting)(t,r(We,z,"f")))},init:function(e,t){if("config"===e&&(null==t?void 0:t.isAdmin))r(We,G,"f").setAdmin();else if("autoSync"===e){var n=t;for(var i in t)n[i]=Number(t[i]);r(We,ee,"f").setAutoSyncCfg=n,r(We,x,"f")instanceof d.LivePlayer&&r(We,x,"f").setAutoSyncCfg(n)}else"VideoEnhance"===e&&(t?r(We,de,"f").start(r(We,x,"f")):r(We,de,"f").stop())},remainBufferLength:function(){return r(We,x,"f")instanceof d.LivePlayer?r(We,x,"f").remainBufferLength():0},discardFrame:function(e){if(r(We,x,"f")instanceof d.LivePlayer){if(!r(We,x,"f").getPlayerInfo().playingStatus)return;r(We,x,"f").discardFrame(e)}},sendGift:function(){},resize:function(){var e;r(We,z,"f").resize(),null===(e=r(We,x,"f"))||void 0===e||e.ctrl.setMiniMode(We.container.clientWidth<=500)},noticeGift:function(){},setChasingFrameThreshold:function(){},loadVideo:function(){},getP2PTransport:function(){if(r(We,x,"f")instanceof d.LivePlayer){var e=r(We,x,"f").getP2PTransport();return{downloadExtraFile:e.downloadExtraFile,shareExtraFile:e.shareExtraFile}}},changeCtrlIconVisible:r(We,Ee,"f"),appendCtrlItem:function(e,t){var n;if(!(e instanceof Element))throw new Error("Illegal arguments, el not an Element");var i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.ctrl.getCtrlUI();if(null==i)throw Error("Can't get controller instance");return i.appendCtrlItem(e,t)},userFeedback:(0,f.debounce)(function(t){return a(We,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return y.default.custom(y.default.CustomCode.UserFeedBack,t),[4,B(e(e({},t),{mid:r(this,i,"f"),buvid:r(this,oe,"f")}))];case 1:return n.sent(),[2]}})})},400),setBottomBar:function(e,t,n){void 0===t&&(t="normal");var i=t,l=[],u=document.createElement("div");u.id="web-player__bottom-bar__container",u.style.cssText="\n          width: 100%;\n          position: absolute;\n          bottom: 0;\n          z-index: ".concat(null!=n?n.toString():"auto","\n        "),u.appendChild(e),We.container.appendChild(u);var s=r(We,z,"f").getDanmakuElement(),c=function(e){var t;null!=r(We,x,"f")?null===(t=r(We,x,"f"))||void 0===t||t.ctrl.setBottomDistance(e):l.push(We.on(f.ExternalEventType.WebPlayerCreated,function(){var t;null===(t=r(We,x,"f"))||void 0===t||t.ctrl.setBottomDistance(e)}))},d=function(){return a(We,void 0,Promise,function(){var e=this;return o(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){var n;null==r(e,x,"f")?l.push(e.on(f.ExternalEventType.FirstFrame,function(){var n;t(null===(n=r(e,x,"f"))||void 0===n?void 0:n.getVideoEl())})):t(null===(n=r(e,x,"f"))||void 0===n?void 0:n.getVideoEl())})];case 1:return[2,t.sent()]}})})},v=function(){d().then(function(e){null!=e&&(e.style.height="normal"===i?"calc(100% - ".concat(u.clientHeight,"px)"):"100%")}).catch(function(e){console.log(e)})},p=function(e,t){i=e,v(),s.style.height="normal"===e?"calc(100% - ".concat(u.clientHeight,"px)"):"100%",r(We,z,"f").resize(),u.style.zIndex=null!=t?t.toString():"auto"};p(t,n),c(u.clientHeight);var m=null!=window.ResizeObserver?new ResizeObserver(function(e){return c(e[0].target.clientHeight)}):null;null==m||m.observe(u),l.push(We.on(f.ExternalEventType.FirstFrame,function(){null!=r(We,x,"f")&&v()}));return{remove:function(){We.container.removeChild(u),d().then(function(e){null!=e&&(e.style.height="100%")}).catch(function(e){return console.log(e)}),s.style.height="100%",r(We,z,"f").resize(),c(0),null==m||m.unobserve(u),l.forEach(function(e){return e()}),l=[]},switchShowType:p}}}),u=function(e){var n=e;if("function"==typeof t[n]){if(["getPlayerInfo","notifyAnnouncement","notifyInOperation","on","set","getOperableElements","remainBufferLength","receiveOnlineCount"].includes(n))return"continue";var i=t[n];t[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f.logger.debug("external call player api: ".concat(n,", args: ").concat(JSON.stringify(e))),i.apply(void 0,e)}}};for(var c in t)u(c);return t}),Ee.set(this,function(t){var n,i;if(null!=r(We,x,"f")){var a=r(We,x,"f").ctrl.getCtrlUI();a.ctrlItemVisibility=e(e({},a.ctrlItemVisibility),{playStatus:t.play,volume:t.volume,time:t.time,refresh:t.reload,quality:t.quality,rightSetting:t.setting,danmaku:t.danmaku,fullScreen:t.fullscreen,webFullScreen:t.webFullscreen}),t.danmaku?r(We,z,"f").fetchBlockRules():r(We,z,"f").destroy(),t.feedback||null===(n=r(We,Y,"f"))||void 0===n||n.call(We),t.logo||null===(i=r(We,X,"f"))||void 0===i||i.destroy()}}),ke.set(this,function(e){var t,n;if(r(We,x,"f")instanceof d.LivePlayer){var i=r(We,x,"f").ctrl.getCtrlUI().danmaku,a=null===(t=r(We,x,"f"))||void 0===t?void 0:t.getVideoEl();if(null!=i&&null!=a){var o=null===(n=r(We,x,"f"))||void 0===n?void 0:n.ctrl.getCtrlUI().playStatus;f.ua.isChrome()?(r(We,z,"f").onSei(e),i.enableMask&&(clearTimeout(r(We,ne,"f")),l(We,ne,window.setTimeout(function(){o||(i.showMaskOption=!1,r(We,z,"f").changeMaskState(a,!1))},1e4),"f")),i.showMaskOption=!0,!r(We,z,"f").maskState&&o&&r(We,z,"f").changeMaskState(a,i.enableMask)):(i.showMaskOption=!1,i.enableMask=!1,r(We,z,"f").changeMaskState(a,!1))}}}),this.notifyAnnouncement=(Le=!1,function(e,t){void 0===e&&(e=!0),void 0===t&&(t=100),Le!==e&&(Le=e,r(We,z,"f").set({offsetTop:Le?t:0}))}),this.updateRoomStatus=(_e=h.RoomStatus.Preparing,function(e){var t;r(We,z,"f").danmakuStateHandler.maskSwitch(!1),null===(t=r(We,x,"f"))||void 0===t||t.destroy(),l(We,x,null,"f"),_e!==e&&(_e=e,We.emit(f.ExternalEventType.LiveStateChange,_e))}),this.injectInitAPIData=function(e){r(We,z,"f").initDanmakuConfig(e)},this.on=function(e,t){return r(We,$,"f").on(e,t)},this.once=function(e,t){return r(We,$,"f").once(e,t)},this.emit=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];[f.ExternalEventType.ReceiveMessage,f.ExternalEventType.ReceiveOnlineCount,f.ExternalEventType.SEIParseData,f.ExternalEventType.SEIData].includes(e)||f.logger.info("room player emit external event: ".concat(e,", data: ").concat(JSON.stringify(n)));try{(t=r(We,$,"f")).emit.apply(t,u([e],n,!1))}catch(a){f.logger.error("ExternalEventHandler error, event type: ".concat(e))}},be.set(this,function(e,t){var n,i,a;void 0===t&&(t=""),null===(n=r(We,re,"f"))||void 0===n||n.remove(),l(We,re,document.createElement("div"),"f"),We.container.appendChild(r(We,re,"f")),l(We,le,(0,g.endRecommendPanel)(We.container,r(We,re,"f"),{roomId:e,rnd:We.opts.rnd,showRecommend:null===(a=null===(i=We.opts.UI)||void 0===i?void 0:i.recommend)||void 0===a||a},function(e,t){"info"===e&&We.emit(f.ExternalEventType.Recommend,t),"redirect"===e&&We.emit(f.ExternalEventType.UserRedirect,t.data)},t),"f")}),this.destroy=function(){var e,t,n,i;r(We,Z,"f")||(l(We,Z,!0,"f"),null===(e=r(We,re,"f"))||void 0===e||e.remove(),l(We,re,null,"f"),r(We,Se,"f").call(We).el.remove(),r(We,te,"f").forEach(function(e){return e()}),l(We,te,[],"f"),f.logger.info("room player destroyed"),null===(t=r(We,x,"f"))||void 0===t||t.destroy(),r(We,F,"f").destroy(),r(We,z,"f").destroy(),r(We,Q,"f").destroy(),r(We,J,"f").destroy(),r(We,G,"f").destroy(),r(We,ye,"f").call(We),r(We,$,"f").destroy(),null===(n=r(We,Y,"f"))||void 0===n||n.call(We),null===(i=r(We,X,"f"))||void 0===i||i.destroy())},this.getOperableElements=function(){return{mainElement:r(We,Se,"f").call(We).el}},Se.set(this,function(){var e="web-player-inject-wrap",t=We.container.querySelector(".".concat(e));return null==t&&((t=document.createElement("div")).classList.add(e),t.style.cssText="\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        z-index: -1;\n      ",We.container.appendChild(t),We.on(f.ExternalEventType.LiveStateChange,function(e){null!=t&&(t.style.height=e===h.RoomStatus.Round||e===h.RoomStatus.Live?"auto":"100px")}),t.style.height=null==r(We,x,"f")?"100px":"auto"),{el:t}}),we.set(this,function(){var e,t=r(We,x,"f");if(null!=t){var n=0,i="",a=(0,f.seiKeyComparator)(f.SEIType.BILIMASK__SVGBIN);r(We,K,"f").push((0,R.bindUserOperation)(t.ctrl,function(e){r(We,$,"f").emit(f.ExternalEventType.UserOperation,e)}),N(t,We.container,null===(e=We.opts.UI)||void 0===e?void 0:e.enableAutoPlayTips),t.on(d.VideoEventType.Destroyed,function(){if(r(We,z,"f").danmakuStateHandler.maskSwitch(!1),t instanceof d.LivePlayer){var e=t.getVideoEl();r(We,z,"f").changeMaskState(e,!1),r(We,z,"f").clearMask()}}),t.ctrl.onChange(function(e,t){"volume"===e&&We.emit(f.ExternalEventType.VolumeChange,t),r(We,me,"f").call(We,e,t),"show"===e&&We.emit(f.ExternalEventType.CtrlVisibleChange,t)}),t.on(d.VideoEventType.SEIData,function(e){a(e[2])&&r(We,ke,"f").call(We,e)}),t.on(d.VideoEventType.VideoInfo,function(e){r(We,Q,"f").updateVideoTemplate(e),n=e.mediaInfo.videoDataRate;var t=e.mediaInfo,a=t.height>t.width?"vertical":"horizontal";a!==i&&(We.emit(f.ExternalEventType.VideoDirectionChange,a),i=a)}),t.on(d.VideoEventType.LoadStart,(0,f.runOnlyOnce)("VideoEventType.LoadStart",function(){We.emit(f.ExternalEventType.FirstLoadStart)})),t.on(d.VideoEventType.MetaData,(0,f.runOnlyOnce)("VideoEventType.MetaData",function(){We.emit(f.ExternalEventType.FirstLoadedMetaData)})),t.on(d.VideoEventType.Play,(0,f.runOnlyOnce)("VideoEventType.Play",function(){We.emit(f.ExternalEventType.FirstPlaying)})),t.on(d.VideoEventType.WaitStart,function(){var e,t,i=navigator.connection;f.logger.warn("connect downlink is: ".concat(null!==(e=null==i?void 0:i.downlink)&&void 0!==e?e:-1,"Mbps,connect rtt is: ").concat(null!==(t=null==i?void 0:i.rtt)&&void 0!==t?t:-1,"ms,video bitRate is: ").concat((n/1024).toFixed(2),"Mbps"))}))}}),Te.set(this,function(){C.default.exitFullscreen().catch(function(){f.logger.error("exit fullscreen error")}),We.emit(f.ExternalEventType.WebFullscreen,!1,c.Other),We.emit(f.ExternalEventType.ScreenStateChange,"normal")}),Ie.set(this,function(e){We.emit(f.ExternalEventType.UserRedirect,e)});var Oe=this.opts,Ue=Oe.cid,qe=Oe.roomInitDataV2,Ae=Oe.rnd,Be=!0===Me.isActivity?m.PlayerEnv.Activity:m.PlayerEnv.Room,Ne=(0,m.initPlayer)(Ue,Be),ze=Ne.userId,He=Ne.uvid;return r(this,te,"f").push(f.ajax.watch(m.ajaxWatcher)),l(this,i,ze,"f"),l(this,oe,He,"f"),y.default.event(y.default.EventCode.RoomPlayerInit,null,{sampleRate:.5}),y.default.custom(y.default.CustomCode.SupportHEVC,{hard:(0,f.isHardSupportHEVC)(),soft:(0,d.isBwpSupported)()},{sampleRate:.1}),null!=qe&&qe.code>=0&&l(this,n,qe.data,"f"),l(this,s,Ue,"f"),l(this,F,new v.default({roomId:Ue,userId:ze}),"f"),l(this,z,new p.DanmakuBiz(this.container,{userId:ze,rnd:Ae,roomId:Ue}),"f"),r(this,z,"f").connectSocket(r(this,F,"f"),function(e){We.emit(f.ExternalEventType.ReceiveMessage,e)}),!1===(null===(Ce=Me.UI)||void 0===Ce?void 0:Ce.danmaku)&&(0,m.disableDanmaku)({danmakuBiz:r(this,z,"f")}),(0,P.logStorageConfig)({roomId:Ue,socket:r(this,F,"f")}),l(this,Q,new T.default(this.container),"f"),l(this,J,new M.default(this.container),"f"),l(this,ae,new I.default(t),"f"),l(this,G,new w.default(this.container,{uid:ze,version:m.ENV.VERSION,click:e({handleEvent:r(this,Ie,"f"),handleDanmu:r(this,he,"f")},(0,m.createContextmenuHandler)(r(this,J,"f"),r(this,Q,"f")))}),"f"),l(this,ue,W(r(this,z,"f"),r(this,G,"f")),"f"),r(this,te,"f").push(r(this,ue,"f"),(0,m.pressToOpenVideoInfoListener)(this.container)),!1!==(null===(Pe=Me.UI)||void 0===Pe?void 0:Pe.feedback)&&l(this,Y,(0,k.default)(t,r(this,ce,"f")),"f"),!1!==(null===(xe=Me.UI)||void 0===xe?void 0:xe.logo)&&l(this,X,(0,E.default)(this.container),"f"),this.reload().catch(function(e){f.logger.error(e)}),r(this,te,"f").push(q(),A()),r(this,ge,"f").call(this)}var n,i,s,x,F,z,G,Q,J,K,Y,X,Z,$,ee,te,ne,ie,ae,oe,re,le,ue,se,ce,fe,de,ve,pe,me,he,ye,ge,Ee,ke,be,Se,we,Te,Ie;return n=new WeakMap,i=new WeakMap,s=new WeakMap,x=new WeakMap,F=new WeakMap,z=new WeakMap,G=new WeakMap,Q=new WeakMap,J=new WeakMap,K=new WeakMap,Y=new WeakMap,X=new WeakMap,Z=new WeakMap,$=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,ie=new WeakMap,ae=new WeakMap,oe=new WeakMap,re=new WeakMap,le=new WeakMap,ue=new WeakMap,se=new WeakMap,ce=new WeakMap,fe=new WeakMap,de=new WeakMap,ve=new WeakMap,pe=new WeakMap,me=new WeakMap,he=new WeakMap,ye=new WeakMap,ge=new WeakMap,Ee=new WeakMap,ke=new WeakMap,be=new WeakMap,Se=new WeakMap,we=new WeakMap,Te=new WeakMap,Ie=new WeakMap,t.isSupported=m.isSupported,t.featSupport=function(e){return"MaskDanmaku"===e?p.DanmakuBiz.supportMaskDanmaku():"VideoEnhance"===e&&(!f.ua.isSafari()&&null!=document.createElement("canvas").getContext("webgl2"))},t}();function L(t,n,i){var a=n.getCtrlUI();a.danmaku=f.userSetting.getDanmaku(),a.danmaku.showMaskOption=!1;var o=0,r=n.onChange(function(n,i){if("webFullScreenStatus"===n)return clearTimeout(o),void(o=window.setTimeout(function(){t.resize()},10));"danmaku"===n&&(f.userSetting.setDanmaku(e(e({},a.danmaku),i)),(0,m.updateDanmakuSetting)(i,t)),"volume"===n&&f.userSetting.setVolume(e(e({},a.volume),i))}),l=C.default.onChange(function(){clearTimeout(o),o=window.setTimeout(function(){t.resize()},300)});return function(){r(),l(),clearTimeout(o)}}function _(e,t){var n,i,a=t.ctrl.getCtrlUI().line,o=a.list;"number"==typeof a.value&&e.setLines(o,a.value,t.switchLine.bind(t));var r=null===(n=t.replay)||void 0===n?void 0:n.on("timeShiftChange",function(n){"number"==typeof a.value&&n>0&&e.setLines([],a.value,t.switchLine.bind(t))}),l=null===(i=t.replay)||void 0===i?void 0:i.on("backLive",function(){"number"==typeof a.value&&e.setLines(o,a.value,t.switchLine.bind(t))}),u=t.on(f.ExternalEventType.SwitchLine,function(t){e.changeLine(t)});return function(){null==r||r(),null==l||l(),u()}}function W(e,t){return e.onSelect(function(e){return t.updateDanmuInfo(e)}),function(){e.offSelect()}}function O(e,t){var n=this,i=!1,r=e.onChange(function(r,l){return a(n,void 0,void 0,function(){var n;return o(this,function(a){switch(a.label){case 0:return n=e.getCtrlUI(),"fullScreenStatus"!==r?[3,6]:(!1===l&&(i=!0),!0===n.webFullScreenStatus&&y.default.operation(y.default.OperationCode.WebFullScreenWay,0),n.webFullScreenStatus=!1,t.emit(f.ExternalEventType.WebFullscreen,!1,c.Other),n.fullScreenStatus=l,!0!==l?[3,3]:t.container.contains(C.default.getFullscreenElement())?[3,2]:[4,C.default.requestFullscreen(t.container)]);case 1:a.sent(),a.label=2;case 2:return[3,5];case 3:return[4,C.default.exitFullscreen()];case 4:a.sent(),a.label=5;case 5:return t.emit(f.ExternalEventType.ScreenStateChange,l?"full":"normal"),[3,8];case 6:return"webFullScreenStatus"!==r?[3,8]:[4,C.default.exitFullscreen()];case 7:a.sent(),i=!0,n.fullScreenStatus=!1,t.emit(f.ExternalEventType.WebFullscreen,l,c.Click),t.emit(f.ExternalEventType.ScreenStateChange,l?"webFull":"normal"),!1===l&&e.hide(),a.label=8;case 8:return[2]}})})}),l=C.default.onChange(function(){var n=t.container===C.default.getFullscreenElement();n||i||(e.getCtrlUI().fullScreenStatus=!1,t.emit(f.ExternalEventType.ScreenStateChange,"normal")),t.emit(f.ExternalEventType.FullscreenChange,n,i?c.Click:c.Esc),i=!1});return function(){l(),r()}}function U(e,t){e.on("danmuInputBlur",function(){t.ctrl.show(!1)}),e.on("danmuInputFocus",function(){t.ctrl.show(!0)})}function q(){var e=function e(){return window.setTimeout(function(){y.default.custom(y.default.CustomCode.HangUp,{time:Math.floor(performance.now()/1e3),visible:"visible"===document.visibilityState?1:0}),clearTimeout(t),t=e()},18e5)},t=e(),n=function(){clearTimeout(t),t=e()};return window.addEventListener("mousemove",n),function(){window.removeEventListener("mousemove",n),clearTimeout(t)}}function A(){var e=setInterval(function(){var e,t,n=navigator.connection;y.default.custom(y.default.CustomCode.NetSpeed,{downlink:null!==(e=null==n?void 0:n.downlink)&&void 0!==e?e:-1,rtt:null!==(t=null==n?void 0:n.rtt)&&void 0!==t?t:-1},{sampleRate:.1})},18e4);return function(){clearInterval(e)}}function B(e){return a(this,void 0,Promise,function(){var t,n;return o(this,function(i){switch(i.label){case 0:if(!["其他问题或建议","黑屏","播放卡顿"].includes(e.type))return[2];t=5,n=36e5,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,P.goldMiner.report({startTime:Date.now()-n,endTime:Date.now(),latestCount:t,source:"player-report[".concat(e.type,"]")})];case 2:return i.sent(),[3,4];case 3:return i.sent(),y.default.error(y.default.ErrorCode.ApiBiz,"LogReportFail"),[3,4];case 4:return[2]}})})}exports.RoomPlayer=F;var N=function(e,t,n){var i=null==n||n,a=[];return a.push(e.on(d.VideoEventType.MutePlay,function(){if(i){var n=(0,x.createMutePlayTip)(t,e.ctrl,function(){var t=e.getVideoEl();null!=t&&(t.muted=!1)});e.ctrl.getCtrlUI().show?n.change(!0):n.change(!1),a.push(e.on(d.VideoEventType.Destroyed,n.destroy),e.ctrl.onRefresh(n.destroy),e.on(f.ExternalEventType.SwitchLine,n.destroy),e.on(f.ExternalEventType.SwitchQuality,n.destroy),n.destroy,e.ctrl.onChange(function(e,t){if("show"===e&&(t?n.change(!0):n.change(!1)),"volume"===e){var i=t,a=i.disabled,o=i.value;(!a||o>0)&&n.destroy()}}))}})),a.push(e.on(d.VideoEventType.NotAutoPlay,function(){if(i){var n=(0,x.createNotAutoPlayTip)(t,function(){var t=e.getVideoEl();null!=t&&(t.muted=!1,t.play().catch(function(e){f.logger.error("click btn to play failed")}))});a.push(e.on(d.VideoEventType.Destroyed,function(){n()}))}})),function(){a.forEach(function(e){e()})}},z=!1;function H(t){if(!(z||(z=!0,Math.random()>.01))){var n=0,i=(0,f.monitorFPS)({type:"avg"},function(e){n=e});window.setTimeout(function(){var o;i(),y.default.perf(y.default.PerfCode.DevicePerf,n,{params:e(e({cpuCnt:navigator.hardwareConcurrency,mem:null!==(o=navigator.deviceMemory)&&void 0!==o?o:-1},a()),{dmSwitch:t.dmSwitch,maskDM:t.dmBiz.bodyMaskDetectorStatus}),extFields:[]})},1e4)}function a(){var e=document.createElement("canvas").getContext("experimental-webgl"),t={renderer:"",vendor:""};if(null==e)return t;var n=e.getExtension("WEBGL_debug_renderer_info");return null!=n&&(t.renderer=e.getParameter(n.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(n.UNMASKED_VENDOR_WEBGL)),t}}function j(){null!=document.pictureInPictureElement&&document.exitPictureInPicture().catch(function(e){f.logger.error(e)})}window.Player=F;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player":"DfF7","@bilibili-live/web-player-socket":"MWvE","./danmaku-biz":"ZWNU","./biz-common":"YQ89","./biz-interface":"Rr2x","@bilibili-live/web-player-track":"ESUf","./ui-components/end-recommend-panel":"vDPq","./ui-components/video-logo":"vS7T","./ui-components/feedback":"EORf","./ui-components/error-panel":"E90K","./ui-components/preround-conuter":"weyG","@bilibili-live/web-player-contextmenu":"YNoa","@bilibili-live/web-player-video-info":"SR9Z","@bilibili-live/web-player-danmaku-report":"wafJ","./ui-components/log-panel":"MY3w","./browser-fullscreen":"PTXm","./log-storage":"hY1T","./ui-components/not-auto-play":"QivA","./video-enhance":"Qsz6","./connects/conn-subtitle":"jYwk","./events/user-operation":"FFSN"}]},{},["nuNG"], null)