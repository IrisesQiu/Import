/**
 * id: OKfi
 * path: @bilibili/wasmplayer-loader
 */

(function(require,module,exports) {
var define;
var e;!function(r,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof e&&e.amd?e([],o):"object"==typeof exports?exports.WasmPlayerLoader=o():r.WasmPlayerLoader=o()}(self,function(){return function(){"use strict";var e={d:function(r,o){for(var n in o)e.o(o,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:o[n]})},o:function(e,r){return Object.prototype.hasOwnProperty.call(e,r)}},r={};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.d(r,{default:function(){return E}});var n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]);function t(){try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(n)}catch(e){return!1}}var a=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);function i(){try{return WebAssembly.validate(a)}catch(e){return!1}}function s(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video/mp4",n=document.createElement("video");if("function"!=typeof n.canPlayType||"function"!=typeof(null===(r=window.MediaSource)||void 0===r?void 0:r.isTypeSupported))return!1;var t="".concat(o,'; codecs="').concat(e,'"'),a=n.canPlayType(t).toLowerCase();return!("maybe"!==a&&"probably"!==a||!window.MediaSource.isTypeSupported(t))}function c(){var e,r,o=document.createElement("canvas"),n="",t="";try{(e=o.getContext("webgl")||o.getContext("webgl2")||o.getContext("experimental-webgl"))&&(r=e.getExtension("WEBGL_debug_renderer_info"))&&(n=e.getParameter(r.UNMASKED_VENDOR_WEBGL),t=e.getParameter(r.UNMASKED_RENDERER_WEBGL))}catch(e){return null}return{vendor:n,renderer:t}}var u="name",w="version";function l(e,r){for(var n,t,a,i,s,c={},u=0;u<r.length;u+=2){n=r[u],a=r[u+1];for(var w=0;w<n.length;w++)if(s=n[w].exec(e)){for(var l=0;l<a.length;l++)i=s[l+1],"object"===o(t=a[l])&&t.length>0?2===t.length?c[t[0]]=t[1]:console.error("[Browser] [rgxMapper] not support arg count!"):c[t]=i||void 0;return c}}return c}var d=function(){var e="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null,r="other",o="other",n="0";if(null!==e){r=function(e){var r=l(e,[[/microsoft (windows) (vista|xp)/i],"",[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[/ ]?([\d.\w ]*)/i,/(windows)[/ ]?([ntce\d. ]+\w)(?!.+xbox)/i],[u],[/(win(?=3|9|n)|win 9x )([nt\d.]+)/i],"Windows",[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,"iOS"]],[/(mac os x) ?([\w. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"]]]).name;return{Windows:!0,"Mac OS":!0}[r]?r:"other"}(e);var a=function(e){var r=l(e,[[/edg(?:e|ios|a)?\/([\w.]+)/i],[w,[u,"Edge"]],[/\bopr\/([\w.]+)/i],[w,[u,"Opera"]],[/(kindle)\/([\w.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[/ ]?([\w.]*)/i,/(avant |iemobile|slim)(?:browser)?[/ ]?([\w.]*)/i,/(ba?idubrowser)[/ ]?([\w.]+)/i,/(?:ms|\()(ie) ([\w.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w.]+)/i,/(weibo)__([\d.]+)/i],[u,w],[/(?:\buc? ?browser|(?:juc.+)ucweb)[/ ]?([\w.]+)/i],[w,[u,"UCBrowser"]],[/\bqbcore\/([\w.]+)/i],[w,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w.]+)/i],[w,[u,"WeChat"]],[/konqueror\/([\w.]+)/i],[w,[u,"Konqueror"]],[/trident.+rv[: ]([\w.]{1,9})\b.+like gecko/i],[w,[u,"IE"]],[/yabrowser\/([\w.]+)/i],[w,[u,"Yandex"]],[/(avast|avg)\/([\w.]+)/i],[[u,"Avast/AVG Secure Browser"],w],[/coc_coc\w+\/([\w.]+)/i],[w,[u,"Coc Coc"]],[/dolfin\/([\w.]+)/i],[w,[u,"Dolphin"]],[/slbrowser\/([\w.]+)/i],[w,[u,"Lenovo"]],[/115browser\/([\w.]+)/i],[w,[u,"115 Browser"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(comodo_dragon)\/([\w.]+)/i],[[u,"Comodo Dragon"],w],[/(electron)\/([\w.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[/ ]?([\w.]+)/i],[u,w],[/(metasr)[/ ]?([\w.]+)/i,/(lbbrowser)/i],[u],[/headlesschrome(?:\/([\w.]+)| )/i],[w,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w.]+)/i],[[u,"Chrome WebView"],w],[/(chrome)\/v?([\w.]+)/i],[[u,"Chrome"],w]]);return{browser:{Chrome:!0,Edge:!0}[r.name]?r.name:"other",version:r.version||"0"}}(e);o=a.browser,n=a.version}return{ua:e||"",os:r,browser:o,version:n,gpuInfo:c,hardwareConcurrency:window.navigator.hardwareConcurrency||0,isSIMDSupported:i,isPThreadSupported:t,isSupportHEVC:s("hvc1.1.6.L123")}},p="5.0.5",f="1"===window.localStorage.getItem("_wasm_player_debug_")||!1,m={BROWSER_LIST:{Chrome:{min:80,blackList:[]},Edge:{min:80,blackList:[]}},OS_LIST:{Windows:!0,"Mac OS":!0},GPU_LIST:[],BASE_CPU_CORE_NUMBER:4};function b(){if(f){for(var e,r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];(e=console).log.apply(e,["[WasmPlayerLoader]"].concat(o))}}var y=navigator.userAgent,v="wasm_player_supported",h=!1,g=null,S={browser:!1,browserHEVC:!1,cpu:!1,gpu:!1,gpuInfo:null,simd:!1,pthread:!1,hardwareConcurrency:0};function C(){if(null!==g)return g;var e=JSON.parse(localStorage.getItem(v)||"null"),r=(null==e?void 0:e.version)===p;if(e&&r&&e.ua===y)null!=e&&e.supported?(g=!0,null!=e&&e.cached?(b("SUPPORT! Already cached!"),h=!0):(b("SUPPORT! But not cache done!"),S=e.supportInfo,h=!1)):g=!1;else{h=Boolean(e&&e.cached&&r);var o=function(){var e=+new Date,r=!1,o=d(),n=m.BROWSER_LIST[o.browser],t=!!m.OS_LIST[o.os]&&!!n&&parseFloat("".concat(o.version))>=n.min,a=o.isSupportHEVC,i=o.hardwareConcurrency>=m.BASE_CPU_CORE_NUMBER;a&&"Chrome"===o.browser&&(b("use browser HEVC!"),r=!0,t=!0);var s=r?null:o.gpuInfo(),c=!r&&!!o.gpuInfo(),u=!r&&o.isPThreadSupported(),w=!r&&o.isSIMDSupported(),l=!!r||!!(u&&i&&c&&t);return b("supportedChecker end spent: ".concat(+new Date-e,"ms")),{pass:l,supportInfo:{browser:t,browserHEVC:a,cpu:i,gpu:c,gpuInfo:s,simd:w,pthread:u,hardwareConcurrency:o.hardwareConcurrency},isUseNativeHEVC:r}}();S=o.supportInfo,g=o.pass,b("supportInfo:",S),o.isUseNativeHEVC&&(b("IsUseNativeHEVC set cached true!"),h=!0),function(e){var r=JSON.stringify({version:p,ua:y,supported:e,supportInfo:S,cached:h,date:+new Date});localStorage.setItem(v,r)}(g)}return g||!1}var E={loadWasmPlayer:function(){return new Promise(function(e,r){C()?function(e,r){b("start load WasmPlayer SDK");var o=+new Date,n=function(){window.WasmPlayer?(b("load done WasmPlayer SDK, spent: ".concat(+new Date-o," ms")),h?e():window.WasmPlayer.preloadBwp(function(o){o?e():r(new Error("Cache WasmPlayer lib error, please retry!"))})):r(new Error("Can not get WasmPlayer Instance!"))};if(window.WasmPlayer)n();else{var t=document.createElement("script");t.type="text/javascript",t.setAttribute("async","async"),t.src="//s1.hdslb.com/bfs/static/wasm-player/wasm-player-5.0.5.min.js",document.body.appendChild(t),t.addEventListener("load",n),t.addEventListener("error",function(){r(new Error("load SDK error!"))})}}(e,r):r(new Error("Not Support!"))})},isHEVCSupported:C,isBwpSupported:C};return r.default}()});
})()