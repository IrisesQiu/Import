/**
 * id: nuNG
 */

(function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n);var a=Object.getOwnPropertyDescriptor(t,n);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,i,a)}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&t(i,e,a);return n(i,e),i},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{u(i.next(e))}catch(t){o(t)}}function l(e){try{u(i.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,l)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(u){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(r=0)),r;)try{if(n=1,i&&(a=2&l[0]?i.return:l[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,l[1])).done)return a;switch(i=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,i=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(a=(a=r.trys).length>0&&a[a.length-1])&&(6===l[0]||2===l[0])){r=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){r.label=l[1];break}if(6===l[0]&&r.label<a[1]){r.label=a[1],a=l;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(l);break}a[2]&&r.ops.pop(),r.trys.pop();continue}l=t.call(e,r)}catch(u){l=[6,u],i=0}finally{n=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,u])}}},r=this&&this.__classPrivateFieldGet||function(e,t,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(e):i?i.value:t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,n,i,a){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?a.call(e,n):a?a.value=n:t.set(e,n),n},u=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var i,a=0,o=t.length;a<o;a++)!i&&a in t||(i||(i=Array.prototype.slice.call(t,0,a)),i[a]=t[a]);return e.concat(i||Array.prototype.slice.call(t))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoomPlayer=void 0;var c,f=require("@bilibili-live/web-player-common"),d=require("@bilibili-live/web-player"),v=i(require("@bilibili-live/web-player-socket")),p=require("./danmaku-biz"),m=require("./biz-common"),h=require("./biz-interface"),y=i(require("@bilibili-live/web-player-track")),g=require("./ui-components/end-recommend-panel"),E=s(require("./ui-components/video-logo")),k=s(require("./ui-components/feedback")),b=require("./ui-components/error-panel"),S=s(require("./ui-components/preround-conuter")),w=s(require("@bilibili-live/web-player-contextmenu")),T=s(require("@bilibili-live/web-player-video-info")),I=s(require("@bilibili-live/web-player-danmaku-report")),M=s(require("./ui-components/log-panel")),C=s(require("./browser-fullscreen")),P=require("./log-storage"),x=require("./ui-components/not-auto-play"),V=require("./video-enhance"),D=require("./connects/conn-subtitle"),R=require("./events/user-operation");f.logger.printToConsole=f.wpd.Log2Console,(0,m.commonLogInfo)("RoomPlayer"),function(e){e[e.Click=1]="Click",e[e.Esc=2]="Esc",e[e.DBClick=3]="DBClick",e[e.Other=4]="Other"}(c||(c={}));var F=function(){function t(t,Me){var Ce,Pe,xe,Ve,De,Re,Fe,Le,_e,We=this;this.container=t,this.opts=Me,n.set(this,void 0),i.set(this,void 0),s.set(this,void 0),x.set(this,null),F.set(this,void 0),z.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),J.set(this,void 0),K.set(this,[]),Y.set(this,null),X.set(this,null),Z.set(this,!1),$.set(this,new f.EventBus),ee.set(this,{}),te.set(this,[]),ne.set(this,0),ie.set(this,!1),ae.set(this,void 0),oe.set(this,void 0),re.set(this,null),le.set(this,function(){}),ue.set(this,void 0),this.reload=function(){return a(We,void 0,Promise,function(){var e,t,i,a,u;return o(this,function(o){switch(o.label){case 0:if(r(this,ie,"f"))return[2];l(this,ie,!0,"f"),null===(i=r(this,re,"f"))||void 0===i||i.remove(),l(this,re,null,"f"),o.label=1;case 1:return o.trys.push([1,,4,5]),e=r(this,s,"f"),null!=(t=r(this,n,"f"))?[3,3]:[4,(0,m.initRoomInfoOrBlock)({roomId:e,isMobile:!1},this.container,this.opts.roomInfoProvider)];case 2:t=o.sent(),o.label=3;case 3:if(r(this,Z,"f"))return[2];switch(r(this,ye,"f").call(this),null===(a=r(this,X,"f"))||void 0===a||a.setRoomStatus(t.live_status),t.live_status){case h.RoomStatus.Preparing:r(this,be,"f").call(this,e),this.updateRoomStatus(h.RoomStatus.Preparing);break;case h.RoomStatus.Live:this.updateRoomStatus(h.RoomStatus.Live),l(this,x,r(this,fe,"f").call(this,t,r(this,F,"f")),"f");break;case h.RoomStatus.Round:this.updateRoomStatus(h.RoomStatus.Round),l(this,x,r(this,se,"f").call(this),"f")}return this.emit(f.ExternalEventType.WebPlayerCreated),null!=r(this,x,"f")&&(r(this,we,"f").call(this),r(this,K,"f").push((0,m.pause10SecBlockStream)(r(this,x,"f"),this)),!1===(null===(u=this.opts.UI)||void 0===u?void 0:u.danmaku)&&(0,m.disableDanmaku)({danmakuBiz:r(this,z,"f"),ctrl:r(this,x,"f").ctrl})),r(this,K,"f").push(r(this,pe,"f").call(this,r(this,F,"f"))),l(this,n,void 0,"f"),[3,5];case 4:return l(this,ie,!1,"f"),f.logger.info("room player is reload"),[7];case 5:return[2]}})})},se.set(this,function(){var e,t,n=r(We,s,"f"),a=new d.RoundPlayer(We.container,{roomId:n,userId:r(We,i,"f"),enableCtrlUI:null===(t=null===(e=We.opts.UI)||void 0===e?void 0:e.enableCtrlUI)||void 0===t||t});return y.default.event(y.EventCode.CreateRoundPlayer,{sample:.1}),a.on("failed",function(e,t,i){void 0===i&&(i=y.default.ErrorCode.RoomRoundUnknow),e===d.NonRoundStatus.Preround?r(We,K,"f").push((0,S.default)(We.container,We.reload,t)):e===d.NonRoundStatus.Nonenabled?r(We,be,"f").call(We,n,"系统维护中,轮播暂时不可用"):(y.default.error(i,"".concat(e)),r(We,K,"f").push((0,b.createErrorPanel)(We.container,i)))}),a.on(d.VideoEventType.FirstFrame,function(){var e,t=a.getVideoEl();null!=t&&(r(We,z,"f").danmakuStateHandler.updateVideoEl(t),!0===(null===(e=We.opts.UI)||void 0===e?void 0:e.enableMaskDanmaku)&&r(We,z,"f").danmakuStateHandler.maskSwitch(!0))}),f.EventBus.forwardEvent(a,We,[f.ExternalEventType.StartPlayRound,f.ExternalEventType.Reload,d.VideoEventType.MutePlay,d.VideoEventType.NotAutoPlay,[d.VideoEventType.WaitEnd,f.ExternalEventType.WaitEnd],[d.VideoEventType.WaitStart,f.ExternalEventType.WaitStart],[d.VideoEventType.FirstFrame,f.ExternalEventType.FirstFrame],[d.VideoEventType.Play,f.ExternalEventType.Playing],[d.VideoEventType.Pause,f.ExternalEventType.Paused]]),r(We,K,"f").push(L(r(We,z,"f"),a.ctrl,r(We,i,"f")),O(a.ctrl,We)),a}),ce.set(this,function(){C.default.exitFullscreen().then(function(){We.emit(f.ExternalEventType.FeedBackClick)}).catch(function(e){f.logger.warn(e)})}),fe.set(this,function(e,t){var n,l,u,c,v,p,g,E,k,w=We.opts,T=w.rnd,I=w.UI,M=new d.LivePlayer(We.container,{roomId:r(We,s,"f"),roomInfo:e,userId:r(We,i,"f"),rnd:T,enableCtrlUI:null===(n=null==I?void 0:I.enableCtrlUI)||void 0===n||n,roomInfoProvider:function(e){return a(We,void 0,void 0,function(){return o(this,function(t){switch(t.label){case 0:return[4,(0,m.loadRoomInfo)(e,this.opts.roomInfoProvider)];case 1:return[2,t.sent()]}})})}},t);r(We,te,"f").push((0,m.dmVisualVibrate)(M,r(We,z,"f"))),(0,d.isBwpSupported)()&&M.showHEVCQuality(!0);var C=M.ctrl.getCtrlUI();for(var P in C.ctrlItemVisibility.mirror=null!==(u=null===(l=We.opts.UI)||void 0===l?void 0:l.showMirror)&&void 0!==u&&u,C.ctrlItemVisibility.pip=null===(v=null===(c=We.opts.UI)||void 0===c?void 0:c.pip)||void 0===v||v,C.ctrlItemVisibility.subtitle=null!==(g=null===(p=We.opts.UI)||void 0===p?void 0:p.subtitle)&&void 0!==g&&g,C.ctrlItemVisibility.webFullScreen=null===(k=null===(E=We.opts.UI)||void 0===E?void 0:E.webFullScreen)||void 0===k||k,C.ctrlItemVisibility.subtitle&&(r(We,ve,"f").enable(M),r(We,K,"f").push(r(We,ve,"f").disable)),r(We,ee,"f"))"setAutoSyncCfg"===P&&M.setAutoSyncCfg(r(We,ee,"f")[P]);return r(We,de,"f").refresh(M),M.on(d.LivePlayerEvent.Failed,function(e,t){y.default.error(e,null!=t?t:""),r(We,K,"f").push((0,b.createErrorPanel)(We.container,e,t)),M.destroy()}),M.on(d.LivePlayerEvent.LiveStatusChange,function(e){We.updateRoomStatus(h.RoomStatus.Preparing),r(We,Te,"f").call(We),e===h.RoomStatus.Round?r(We,K,"f").push((0,S.default)(We.container,We.reload)):r(We,be,"f").call(We,r(We,s,"f"))}),M.on(d.VideoEventType.FirstFrame,function(){var e,t=M.getVideoEl();if(null!=t){r(We,z,"f").danmakuStateHandler.updateVideoEl(t);var n=!0===(null===(e=We.opts.UI)||void 0===e?void 0:e.enableMaskDanmaku);r(We,z,"f").danmakuStateHandler.maskSwitch(n),H({dmBiz:r(We,z,"f"),dmSwitch:M.ctrl.getCtrlUI().danmaku.display})}}),f.EventBus.forwardEvent(M,We,[f.ExternalEventType.SwitchLine,f.ExternalEventType.SwitchQuality,f.ExternalEventType.SwitchQualityNotLogin,f.ExternalEventType.Reload,f.ExternalEventType.SEIParseData,[d.VideoEventType.WaitEnd,f.ExternalEventType.WaitEnd],[d.VideoEventType.WaitStart,f.ExternalEventType.WaitStart],d.VideoEventType.MutePlay,d.VideoEventType.NotAutoPlay,[d.VideoEventType.FirstFrame,f.ExternalEventType.FirstFrame],[d.VideoEventType.Destroyed,f.ExternalEventType.VideoDestroyed],[d.VideoEventType.Play,f.ExternalEventType.Playing],[d.VideoEventType.Pause,f.ExternalEventType.Paused],[d.VideoEventType.MetaData,f.ExternalEventType.MetaDataChange],[d.LivePlayerEvent.VideoError,f.ExternalEventType.VideoError],[d.LivePlayerEvent.Failed,f.ExternalEventType.PlayFaild]]),r(We,K,"f").push(L(r(We,z,"f"),M.ctrl,r(We,i,"f")),O(M.ctrl,We),_(r(We,G,"f"),M)),M}),de.set(this,(Ve=!1,De=function(){},{start:Re=function(e){Ve=!0,De(),e instanceof d.LivePlayer&&(De=(0,V.startVideoCAS)(e)),y.default.custom(y.default.CustomCode.VideoEnhance,1,{extFields:["videoTag","quality","sCodec"]})},stop:function(){Ve=!1,De(),y.default.custom(y.default.CustomCode.VideoEnhance,0,{extFields:["videoTag","quality","sCodec"]})},refresh:function(e){Ve&&Re(e)}})),ve.set(this,(Fe=function(){},{enable:function(e){Fe(),Fe=(0,D.connSubtitleAndPlayer)(e)},disable:function(){Fe()}})),pe.set(this,function(e){f.logger.info("room player listen socket message");var t=function(e){f.logger.warn("refresh by socket ".concat(e)),We.reload().catch(function(e){f.logger.error(e)})},n=r(We,s,"f"),a=e.on("message",function(e){if(!e.cmd.startsWith("DANMU_MSG")){switch(e.cmd){case v.SocketMsgType.Live:if(r(We,x,"f")instanceof d.LivePlayer)break;r(We,K,"f").push((0,f.disperseAction)(1e4,function(){t(e.cmd)}));break;case v.SocketMsgType.Round:if(r(We,x,"f")instanceof d.RoundPlayer)break;t(e.cmd);break;case v.SocketMsgType.Preparing:r(We,Te,"f").call(We),1===e.round?r(We,K,"f").push((0,S.default)(We.container,We.reload)):r(We,be,"f").call(We,n),We.updateRoomStatus(h.RoomStatus.Preparing);break;case v.SocketMsgType.End:case v.SocketMsgType.Close:case v.SocketMsgType.Block:r(We,be,"f").call(We,n),We.updateRoomStatus(h.RoomStatus.Preparing);break;case v.SocketMsgType.Refresh:t(e.cmd);break;case v.SocketMsgType.AreaBlock:break;case v.SocketMsgType.HotRoomNotify:if(!Array.isArray(e.data.random_delay_req_v2))break;a=performance.now()+1e3*Number(e.data.ttl),isNaN(a)?f.logger.error("HotRoomNotify ttl error: ".concat(String(e.data.ttl))):(f.logger.debug("HotRoomNotify msg: ".concat(JSON.stringify(e.data.random_delay_req_v2))),e.data.random_delay_req_v2.forEach(function(e){var t=e.path,n=e.delay;f.ajax.disperse(t,{scope:n,expiresTime:a})}));break;case v.SocketMsgType.LOG_IN_NOTICE:0===r(We,i,"f")&&r(We,ue,"f").call(We)}var a;We.emit(f.ExternalEventType.ReceiveMessage,e)}}),o=e.on("heartbeat",function(e){We.emit(f.ExternalEventType.ReceiveOnlineCount,e.count)});return function(){a(),o()}}),me.set(this,function(e,t){var n;if(r(We,x,"f")instanceof d.LivePlayer){var i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.getVideoEl();"danmaku"===e&&r(We,z,"f").changeMaskState(i,t.enableMask),"playStatus"===e&&!0!==t&&(clearTimeout(r(We,ne,"f")),r(We,z,"f").changeMaskState(i,!1,!0))}}),he.set(this,function(e,t){return a(We,void 0,Promise,function(){var n,i,a,l,u,c,d=this;return o(this,function(o){switch(o.label){case 0:switch(e){case"report":return[3,1];case"shield":return[3,3];case"addBlackList":return[3,4]}return[3,5];case 1:return[4,r(this,ae,"f").show({uid:t.uid,roomid:r(this,s,"f"),uname:t.uname,msg:t.text,checkInfo:t.checkInfo,type:t.dmType,file_id:null!==(l=null!==(i=null===(n=t.voiceConfig)||void 0===n?void 0:n.file_id)&&void 0!==i?i:null===(a=t.emoticonOptions)||void 0===a?void 0:a.emoticon_unique)&&void 0!==l?l:"",img_url:null!==(c=null===(u=t.emoticonOptions)||void 0===u?void 0:u.url)&&void 0!==c?c:"",id_str:t.id_str})];case 2:return o.sent(),[3,5];case 3:return(0,p.roomBlockAdapter)({component:"block",action:"addShieldUser",data:{uid:t.uid,uname:t.uname}},r(this,z,"f"),r(this,s,"f"),function(e,t){d.emit(f.ExternalEventType.Set,{component:"block",action:e,data:t})}),[3,5];case 4:return this.emit(f.ExternalEventType.Set,{component:"block",action:"addBlackList",data:t.uname}),[3,5];case 5:return[2]}})})}),ye.set(this,function(){r(We,K,"f").forEach(function(e){return e()}),l(We,K,[],"f")}),ge.set(this,function(){var t=e(e({NAME:"BILIBILI HTML5 LIVE PLAYER",VERSION:m.ENV.VERSION},"development"===m.ENV.NODE_ENV?{socket:r(We,F,"f")}:{}),{play:function(){var e;null===(e=r(We,x,"f"))||void 0===e||e.play()},pause:function(){var e;null===(e=r(We,x,"f"))||void 0===e||e.pause()},volume:function(t){var n;f.userSetting.setVolume(e(e({},f.userSetting.getVolume()),{value:t})),null===(n=r(We,x,"f"))||void 0===n||n.volume(t/100)},setDanmaku:function(){},reload:We.reload,destroy:We.destroy,getOperableElements:We.getOperableElements,freeze:function(){var e;null===(e=r(We,x,"f"))||void 0===e||e.blockStream()},refresh:function(){We.reload().catch(function(e){f.logger.error(e)})},set:function(e){"block"===e.component&&(0,p.roomBlockAdapter)(e,r(We,z,"f"),r(We,s,"f"),function(e,t){We.emit(f.ExternalEventType.Set,{component:"block",action:e,data:t})})},setFullscreenDanmaku:function(e){null!=r(We,x,"f")&&U(e,r(We,x,"f"))},sendDanmaku:function(e){return a(We,void 0,void 0,function(){var t=this;return o(this,function(n){switch(n.label){case 0:return[4,r(this,z,"f").userSendDanmaku(e).then(function(n){var i={uniqueID:e.uniqueID,response:n};return t.emit(f.ExternalEventType.SendDanmaku,i),i})];case 1:return[2,n.sent()]}})})},setFullscreenStatus:function(e){null!=r(We,x,"f")&&r(We,x,"f").ctrl.setScreenStatus(e)},toast:function(e){(0,f.toast)(e,We.container)},setToastCssText:function(e){(0,f.setToastCssText)(e)},notifyInOperation:function(e){We.getOperableElements().mainElement.style.zIndex="".concat(e?9:-1)},notifyAnnouncement:We.notifyAnnouncement,injectInitAPIData:We.injectInitAPIData,getVideoEl:function(){var e,t;return null!==(t=null===(e=r(We,x,"f"))||void 0===e?void 0:e.getVideoEl())&&void 0!==t?t:null},supportMaskDanmaku:function(){return r(We,z,"f").supportMaskDanmaku()},featSupport:function(e){return"MaskDanmaku"===e?r(We,z,"f").supportMaskDanmaku():"VideoEnhance"===e?!f.ua.isSafari()&&null!=document.createElement("canvas").getContext("webgl2"):void 0},switchAudioTrack:function(e){var t,n;return r(We,x,"f")instanceof d.LivePlayer&&null!==(n=null===(t=r(We,x,"f"))||void 0===t?void 0:t.switchAudioTrack(e))&&void 0!==n?n:-1},getAudioTracks:function(){var e;if(r(We,x,"f")instanceof d.LivePlayer)return null===(e=r(We,x,"f"))||void 0===e?void 0:e.getAudioTracks()},changeUIStatus:function(t){var n,i,a,o,u,s,c=null===(n=r(We,x,"f"))||void 0===n?void 0:n.getVideoEl();if(null!==(a=null===(i=JSON.stringify(We.opts.roomInitDataV2))||void 0===i?void 0:i.includes("全景"))&&void 0!==a&&a&&null!=t.showMirror&&(t.showMirror=!1),null!=c&&(!0===t.enableMaskDanmaku?(r(We,z,"f").bodyMaskDetectorStatus=!0,r(We,z,"f").danmakuStateHandler.maskSwitch(!0)):!1===t.enableMaskDanmaku&&(r(We,z,"f").bodyMaskDetectorStatus=!1,r(We,z,"f").danmakuStateHandler.maskSwitch(!1))),!1===t.feedback?null===(o=r(We,Y,"f"))||void 0===o||o.call(We):!0===t.feedback&&null==r(We,Y,"f")&&l(We,Y,(0,k.default)(We.container,r(We,ce,"f")),"f"),!1===t.logo?null===(u=r(We,X,"f"))||void 0===u||u.destroy():!0===t.logo&&null==r(We,X,"f")&&l(We,X,(0,E.default)(We.container),"f"),!1===t.recommend&&r(We,le,"f").call(We),We.opts.UI=Object.assign({},We.opts.UI,t),null!=r(We,x,"f")){!0===t.subtitle&&r(We,x,"f")instanceof d.LivePlayer?r(We,ve,"f").enable(r(We,x,"f")):!1===t.subtitle&&r(We,ve,"f").disable();var v=r(We,x,"f").ctrl.getCtrlUI();if(null!=t.showMirror&&(v.ctrlItemVisibility.mirror=t.showMirror),v.ctrlItemVisibility.subtitle=null!==(s=We.opts.UI.subtitle)&&void 0!==s&&s,!1===t.webFullScreen&&(v.ctrlItemVisibility.webFullScreen=!1),null!=t.pip&&(v.ctrlItemVisibility.pip=t.pip),null!=t.pipStatus)if(v.pipStatus=t.pipStatus,t.pipStatus){var p=r(We,x,"f").getVideoEl();null==p||p.requestPictureInPicture().catch(f.logger.error)}else j();null!=t.showDanmakuSetting&&(v.ctrlItemVisibility=e(e({},v.ctrlItemVisibility),{danmakuPanel:t.showDanmakuSetting})),!1===t.danmaku&&(0,m.disableDanmaku)({danmakuBiz:r(We,z,"f"),ctrl:r(We,x,"f").ctrl})}},changeDanmakuExtraConfig:function(e){r(We,z,"f").updateDanmakuExtraConfig(e)},changeCtrlVisible:function(e,t){var n,i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.ctrl;if(null!=i){var a=!1===t;e?i.show(a):i.hide()}},capturePic:function(e,t){var n,i;return null!==(i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.capturePic(e,t))&&void 0!==i?i:null},on:function(t,i){var a;if(t===f.ExternalEventType.Initialized)return i({type:"html5"}),void f.logger.info("room player emit external event: Initialized");if(t===f.ExternalEventType.InitDanmaku){var o=r(We,z,"f").getDanmakuConfig();return f.logger.info("room player emit external event: InitDanmaku, data: ".concat(JSON.stringify(o))),void i(e(e({},o),{room_shield:null===(a=r(We,n,"f"))||void 0===a?void 0:a.room_shield}))}return We.on(t,i)},once:function(e,t){return We.once(e,t)},addLoadingPicture:function(e){var t;null===(t=r(We,x,"f"))||void 0===t||t.setTitlePageImg(e)},stopPlayback:function(e){var t;null!=r(We,x,"f")&&(r(We,x,"f").destroy(),r(We,ye,"f").call(We),(0,f.coverImg)(null!==(t=null==e?void 0:e.url)&&void 0!==t?t:"//s1.hdslb.com/bfs/static/player/live/html5/images/error@1x.png",We.container),r(We,K,"f").push(function(){(0,f.coverImg)(null,We.container)}))},getPlayerInfo:function(){var t,n,i,a=r(We,x,"f"),o={type:1,version:m.ENV.VERSION,playerType:"HTML5",liveStatus:h.RoomStatus.Preparing,playerStatus:0,playingStatus:!1,playurl:"",guid:"",quality:"0",qualityCandidates:[],timeShift:0};if(null==a)return o;var l=a.getPlayerInfo(),u=null!==(t=a.ctrl.getCtrlUI().webFullScreenStatus)&&void 0!==t&&t?1:null!==(n=a.ctrl.getCtrlUI().fullScreenStatus)&&void 0!==n&&n?2:0;return e(e({},o),{liveStatus:a instanceof d.LivePlayer?1:0,playerStatus:u,timeShift:null!==(i=l.timeShift)&&void 0!==i?i:0,playingStatus:l.playingStatus,playurl:l.playSrc,guid:l.guid,quality:l.quality,qualityCandidates:l.qualityCandidates.map(function(e){var t=e.label;return{qn:e.value,desc:t}}),volume:a.ctrl.getCtrlUI().volume,danmaku:f.userSetting.getDanmaku()})},switchQuality:function(e){r(We,x,"f")instanceof d.LivePlayer&&r(We,x,"f").switchQuality(e)},updateDMSetting:function(t){null!=r(We,z,"f")&&(f.userSetting.setDanmaku(e(e({},f.userSetting.getDanmaku()),t)),(0,m.updateDanmakuSetting)(t,r(We,z,"f")))},init:function(e,t){if("config"===e&&(null==t?void 0:t.isAdmin))r(We,G,"f").setAdmin();else if("autoSync"===e){var n=t;for(var i in t)n[i]=Number(t[i]);r(We,ee,"f").setAutoSyncCfg=n,r(We,x,"f")instanceof d.LivePlayer&&r(We,x,"f").setAutoSyncCfg(n)}else"VideoEnhance"===e&&(t?r(We,de,"f").start(r(We,x,"f")):r(We,de,"f").stop())},remainBufferLength:function(){return r(We,x,"f")instanceof d.LivePlayer?r(We,x,"f").remainBufferLength():0},discardFrame:function(e){if(r(We,x,"f")instanceof d.LivePlayer){if(!r(We,x,"f").getPlayerInfo().playingStatus)return;r(We,x,"f").discardFrame(e)}},sendGift:function(){},resize:function(){var e;r(We,z,"f").resize(),null===(e=r(We,x,"f"))||void 0===e||e.ctrl.setMiniMode(We.container.clientWidth<=500)},noticeGift:function(){},setChasingFrameThreshold:function(){},loadVideo:function(){},getP2PTransport:function(){if(r(We,x,"f")instanceof d.LivePlayer){var e=r(We,x,"f").getP2PTransport();return{downloadExtraFile:e.downloadExtraFile,shareExtraFile:e.shareExtraFile}}},changeCtrlIconVisible:r(We,Ee,"f"),appendCtrlItem:function(e,t){var n;if(!(e instanceof Element))throw new Error("Illegal arguments, el not an Element");var i=null===(n=r(We,x,"f"))||void 0===n?void 0:n.ctrl.getCtrlUI();if(null==i)throw Error("Can't get controller instance");return i.appendCtrlItem(e,t)},userFeedback:(0,f.debounce)(function(t){return a(We,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return y.default.custom(y.default.CustomCode.UserFeedBack,t),[4,B(e(e({},t),{mid:r(this,i,"f"),buvid:r(this,oe,"f")}))];case 1:return n.sent(),[2]}})})},400),setBottomBar:function(e,t,n){void 0===t&&(t="normal");var i=t,l=[],u=document.createElement("div");u.id="web-player__bottom-bar__container",u.style.cssText="\n          width: 100%;\n          position: absolute;\n          bottom: 0;\n          z-index: ".concat(null!=n?n.toString():"auto","\n        "),u.appendChild(e),We.container.appendChild(u);var s=r(We,z,"f").getDanmakuElement(),c=function(e){var t;null!=r(We,x,"f")?null===(t=r(We,x,"f"))||void 0===t||t.ctrl.setBottomDistance(e):l.push(We.on(f.ExternalEventType.WebPlayerCreated,function(){var t;null===(t=r(We,x,"f"))||void 0===t||t.ctrl.setBottomDistance(e)}))},d=function(){return a(We,void 0,Promise,function(){var e=this;return o(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){var n;null==r(e,x,"f")?l.push(e.on(f.ExternalEventType.FirstFrame,function(){var n;t(null===(n=r(e,x,"f"))||void 0===n?void 0:n.getVideoEl())})):t(null===(n=r(e,x,"f"))||void 0===n?void 0:n.getVideoEl())})];case 1:return[2,t.sent()]}})})},v=function(){d().then(function(e){null!=e&&(e.style.height="normal"===i?"calc(100% - ".concat(u.clientHeight,"px)"):"100%")}).catch(function(e){console.log(e)})},p=function(e,t){i=e,v(),s.style.height="normal"===e?"calc(100% - ".concat(u.clientHeight,"px)"):"100%",r(We,z,"f").resize(),u.style.zIndex=null!=t?t.toString():"auto"};p(t,n),c(u.clientHeight);var m=null!=window.ResizeObserver?new ResizeObserver(function(e){return c(e[0].target.clientHeight)}):null;null==m||m.observe(u),l.push(We.on(f.ExternalEventType.FirstFrame,function(){null!=r(We,x,"f")&&v()}));return{remove:function(){We.container.removeChild(u),d().then(function(e){null!=e&&(e.style.height="100%")}).catch(function(e){return console.log(e)}),s.style.height="100%",r(We,z,"f").resize(),c(0),null==m||m.unobserve(u),l.forEach(function(e){return e()}),l=[]},switchShowType:p}}}),u=function(e){var n=e;if("function"==typeof t[n]){if(["getPlayerInfo","notifyAnnouncement","notifyInOperation","on","set","getOperableElements","remainBufferLength","receiveOnlineCount"].includes(n))return"continue";var i=t[n];t[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return f.logger.debug("external call player api: ".concat(n,", args: ").concat(JSON.stringify(e))),i.apply(void 0,e)}}};for(var c in t)u(c);return t}),Ee.set(this,function(t){var n,i;if(null!=r(We,x,"f")){var a=r(We,x,"f").ctrl.getCtrlUI();a.ctrlItemVisibility=e(e({},a.ctrlItemVisibility),{playStatus:t.play,volume:t.volume,time:t.time,refresh:t.reload,quality:t.quality,rightSetting:t.setting,danmaku:t.danmaku,fullScreen:t.fullscreen,webFullScreen:t.webFullscreen}),t.danmaku?r(We,z,"f").fetchBlockRules():r(We,z,"f").destroy(),t.feedback||null===(n=r(We,Y,"f"))||void 0===n||n.call(We),t.logo||null===(i=r(We,X,"f"))||void 0===i||i.destroy()}}),ke.set(this,function(e){var t,n;if(r(We,x,"f")instanceof d.LivePlayer){var i=r(We,x,"f").ctrl.getCtrlUI().danmaku,a=null===(t=r(We,x,"f"))||void 0===t?void 0:t.getVideoEl();if(null!=i&&null!=a){var o=null===(n=r(We,x,"f"))||void 0===n?void 0:n.ctrl.getCtrlUI().playStatus;f.ua.isChrome()?(r(We,z,"f").onSei(e),i.enableMask&&(clearTimeout(r(We,ne,"f")),l(We,ne,window.setTimeout(function(){o||(i.showMaskOption=!1,r(We,z,"f").changeMaskState(a,!1))},1e4),"f")),i.showMaskOption=!0,!r(We,z,"f").maskState&&o&&r(We,z,"f").changeMaskState(a,i.enableMask)):(i.showMaskOption=!1,i.enableMask=!1,r(We,z,"f").changeMaskState(a,!1))}}}),this.notifyAnnouncement=(Le=!1,function(e,t){void 0===e&&(e=!0),void 0===t&&(t=100),Le!==e&&(Le=e,r(We,z,"f").set({offsetTop:Le?t:0}))}),this.updateRoomStatus=(_e=h.RoomStatus.Preparing,function(e){var t;r(We,z,"f").danmakuStateHandler.maskSwitch(!1),null===(t=r(We,x,"f"))||void 0===t||t.destroy(),l(We,x,null,"f"),_e!==e&&(_e=e,We.emit(f.ExternalEventType.LiveStateChange,_e))}),this.injectInitAPIData=function(e){r(We,z,"f").initDanmakuConfig(e)},this.on=function(e,t){return r(We,$,"f").on(e,t)},this.once=function(e,t){return r(We,$,"f").once(e,t)},this.emit=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];[f.ExternalEventType.ReceiveMessage,f.ExternalEventType.ReceiveOnlineCount,f.ExternalEventType.SEIParseData,f.ExternalEventType.SEIData].includes(e)||f.logger.info("room player emit external event: ".concat(e,", data: ").concat(JSON.stringify(n)));try{(t=r(We,$,"f")).emit.apply(t,u([e],n,!1))}catch(a){f.logger.error("ExternalEventHandler error, event type: ".concat(e))}},be.set(this,function(e,t){var n,i,a;void 0===t&&(t=""),null===(n=r(We,re,"f"))||void 0===n||n.remove(),l(We,re,document.createElement("div"),"f"),We.container.appendChild(r(We,re,"f")),l(We,le,(0,g.endRecommendPanel)(We.container,r(We,re,"f"),{roomId:e,rnd:We.opts.rnd,showRecommend:null===(a=null===(i=We.opts.UI)||void 0===i?void 0:i.recommend)||void 0===a||a},function(e,t){"info"===e&&We.emit(f.ExternalEventType.Recommend,t),"redirect"===e&&We.emit(f.ExternalEventType.UserRedirect,t.data)},t),"f")}),this.destroy=function(){var e,t,n,i;r(We,Z,"f")||(l(We,Z,!0,"f"),null===(e=r(We,re,"f"))||void 0===e||e.remove(),l(We,re,null,"f"),r(We,Se,"f").call(We).el.remove(),r(We,te,"f").forEach(function(e){return e()}),l(We,te,[],"f"),f.logger.info("room player destroyed"),null===(t=r(We,x,"f"))||void 0===t||t.destroy(),r(We,F,"f").destroy(),r(We,z,"f").destroy(),r(We,Q,"f").destroy(),r(We,J,"f").destroy(),r(We,G,"f").destroy(),r(We,ye,"f").call(We),r(We,$,"f").destroy(),null===(n=r(We,Y,"f"))||void 0===n||n.call(We),null===(i=r(We,X,"f"))||void 0===i||i.destroy())},this.getOperableElements=function(){return{mainElement:r(We,Se,"f").call(We).el}},Se.set(this,function(){var e="web-player-inject-wrap",t=We.container.querySelector(".".concat(e));return null==t&&((t=document.createElement("div")).classList.add(e),t.style.cssText="\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        z-index: -1;\n      ",We.container.appendChild(t),We.on(f.ExternalEventType.LiveStateChange,function(e){null!=t&&(t.style.height=e===h.RoomStatus.Round||e===h.RoomStatus.Live?"auto":"100px")}),t.style.height=null==r(We,x,"f")?"100px":"auto"),{el:t}}),we.set(this,function(){var e,t=r(We,x,"f");if(null!=t){var n=0,i="",a=(0,f.seiKeyComparator)(f.SEIType.BILIMASK__SVGBIN);r(We,K,"f").push((0,R.bindUserOperation)(t.ctrl,function(e){r(We,$,"f").emit(f.ExternalEventType.UserOperation,e)}),N(t,We.container,null===(e=We.opts.UI)||void 0===e?void 0:e.enableAutoPlayTips),t.on(d.VideoEventType.Destroyed,function(){if(r(We,z,"f").danmakuStateHandler.maskSwitch(!1),t instanceof d.LivePlayer){var e=t.getVideoEl();r(We,z,"f").changeMaskState(e,!1),r(We,z,"f").clearMask()}}),t.ctrl.onChange(function(e,t){"volume"===e&&We.emit(f.ExternalEventType.VolumeChange,t),r(We,me,"f").call(We,e,t),"show"===e&&We.emit(f.ExternalEventType.CtrlVisibleChange,t)}),t.on(d.VideoEventType.SEIData,function(e){a(e[2])&&r(We,ke,"f").call(We,e)}),t.on(d.VideoEventType.VideoInfo,function(e){r(We,Q,"f").updateVideoTemplate(e),n=e.mediaInfo.videoDataRate;var t=e.mediaInfo,a=t.height>t.width?"vertical":"horizontal";a!==i&&(We.emit(f.ExternalEventType.VideoDirectionChange,a),i=a)}),t.on(d.VideoEventType.LoadStart,(0,f.runOnlyOnce)("VideoEventType.LoadStart",function(){We.emit(f.ExternalEventType.FirstLoadStart)})),t.on(d.VideoEventType.MetaData,(0,f.runOnlyOnce)("VideoEventType.MetaData",function(){We.emit(f.ExternalEventType.FirstLoadedMetaData)})),t.on(d.VideoEventType.Play,(0,f.runOnlyOnce)("VideoEventType.Play",function(){We.emit(f.ExternalEventType.FirstPlaying)})),t.on(d.VideoEventType.WaitStart,function(){var e,t,i=navigator.connection;f.logger.warn("connect downlink is: ".concat(null!==(e=null==i?void 0:i.downlink)&&void 0!==e?e:-1,"Mbps,connect rtt is: ").concat(null!==(t=null==i?void 0:i.rtt)&&void 0!==t?t:-1,"ms,video bitRate is: ").concat((n/1024).toFixed(2),"Mbps"))}))}}),Te.set(this,function(){C.default.exitFullscreen().catch(function(){f.logger.error("exit fullscreen error")}),We.emit(f.ExternalEventType.WebFullscreen,!1,c.Other),We.emit(f.ExternalEventType.ScreenStateChange,"normal")}),Ie.set(this,function(e){We.emit(f.ExternalEventType.UserRedirect,e)});var Oe=this.opts,Ue=Oe.cid,qe=Oe.roomInitDataV2,Ae=Oe.rnd,Be=!0===Me.isActivity?m.PlayerEnv.Activity:m.PlayerEnv.Room,Ne=(0,m.initPlayer)(Ue,Be),ze=Ne.userId,He=Ne.uvid;return r(this,te,"f").push(f.ajax.watch(m.ajaxWatcher)),l(this,i,ze,"f"),l(this,oe,He,"f"),y.default.event(y.default.EventCode.RoomPlayerInit,null,{sampleRate:.5}),y.default.custom(y.default.CustomCode.SupportHEVC,{hard:(0,f.isHardSupportHEVC)(),soft:(0,d.isBwpSupported)()},{sampleRate:.1}),null!=qe&&qe.code>=0&&l(this,n,qe.data,"f"),l(this,s,Ue,"f"),l(this,F,new v.default({roomId:Ue,userId:ze}),"f"),l(this,z,new p.DanmakuBiz(this.container,{userId:ze,rnd:Ae,roomId:Ue}),"f"),r(this,z,"f").connectSocket(r(this,F,"f"),function(e){We.emit(f.ExternalEventType.ReceiveMessage,e)}),!1===(null===(Ce=Me.UI)||void 0===Ce?void 0:Ce.danmaku)&&(0,m.disableDanmaku)({danmakuBiz:r(this,z,"f")}),(0,P.logStorageConfig)({roomId:Ue,socket:r(this,F,"f")}),l(this,Q,new T.default(this.container),"f"),l(this,J,new M.default(this.container),"f"),l(this,ae,new I.default(t),"f"),l(this,G,new w.default(this.container,{uid:ze,version:m.ENV.VERSION,click:e({handleEvent:r(this,Ie,"f"),handleDanmu:r(this,he,"f")},(0,m.createContextmenuHandler)(r(this,J,"f"),r(this,Q,"f")))}),"f"),l(this,ue,W(r(this,z,"f"),r(this,G,"f")),"f"),r(this,te,"f").push(r(this,ue,"f"),(0,m.pressToOpenVideoInfoListener)(this.container)),!1!==(null===(Pe=Me.UI)||void 0===Pe?void 0:Pe.feedback)&&l(this,Y,(0,k.default)(t,r(this,ce,"f")),"f"),!1!==(null===(xe=Me.UI)||void 0===xe?void 0:xe.logo)&&l(this,X,(0,E.default)(this.container),"f"),this.reload().catch(function(e){f.logger.error(e)}),r(this,te,"f").push(q(),A()),r(this,ge,"f").call(this)}var n,i,s,x,F,z,G,Q,J,K,Y,X,Z,$,ee,te,ne,ie,ae,oe,re,le,ue,se,ce,fe,de,ve,pe,me,he,ye,ge,Ee,ke,be,Se,we,Te,Ie;return n=new WeakMap,i=new WeakMap,s=new WeakMap,x=new WeakMap,F=new WeakMap,z=new WeakMap,G=new WeakMap,Q=new WeakMap,J=new WeakMap,K=new WeakMap,Y=new WeakMap,X=new WeakMap,Z=new WeakMap,$=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,ie=new WeakMap,ae=new WeakMap,oe=new WeakMap,re=new WeakMap,le=new WeakMap,ue=new WeakMap,se=new WeakMap,ce=new WeakMap,fe=new WeakMap,de=new WeakMap,ve=new WeakMap,pe=new WeakMap,me=new WeakMap,he=new WeakMap,ye=new WeakMap,ge=new WeakMap,Ee=new WeakMap,ke=new WeakMap,be=new WeakMap,Se=new WeakMap,we=new WeakMap,Te=new WeakMap,Ie=new WeakMap,t.isSupported=m.isSupported,t.featSupport=function(e){return"MaskDanmaku"===e?p.DanmakuBiz.supportMaskDanmaku():"VideoEnhance"===e&&(!f.ua.isSafari()&&null!=document.createElement("canvas").getContext("webgl2"))},t}();function L(t,n,i){var a=n.getCtrlUI();a.danmaku=f.userSetting.getDanmaku(),a.danmaku.showMaskOption=!1;var o=0,r=n.onChange(function(n,i){if("webFullScreenStatus"===n)return clearTimeout(o),void(o=window.setTimeout(function(){t.resize()},10));"danmaku"===n&&(f.userSetting.setDanmaku(e(e({},a.danmaku),i)),(0,m.updateDanmakuSetting)(i,t)),"volume"===n&&f.userSetting.setVolume(e(e({},a.volume),i))}),l=C.default.onChange(function(){clearTimeout(o),o=window.setTimeout(function(){t.resize()},300)});return function(){r(),l(),clearTimeout(o)}}function _(e,t){var n,i,a=t.ctrl.getCtrlUI().line,o=a.list;"number"==typeof a.value&&e.setLines(o,a.value,t.switchLine.bind(t));var r=null===(n=t.replay)||void 0===n?void 0:n.on("timeShiftChange",function(n){"number"==typeof a.value&&n>0&&e.setLines([],a.value,t.switchLine.bind(t))}),l=null===(i=t.replay)||void 0===i?void 0:i.on("backLive",function(){"number"==typeof a.value&&e.setLines(o,a.value,t.switchLine.bind(t))}),u=t.on(f.ExternalEventType.SwitchLine,function(t){e.changeLine(t)});return function(){null==r||r(),null==l||l(),u()}}function W(e,t){return e.onSelect(function(e){return t.updateDanmuInfo(e)}),function(){e.offSelect()}}function O(e,t){var n=this,i=!1,r=e.onChange(function(r,l){return a(n,void 0,void 0,function(){var n;return o(this,function(a){switch(a.label){case 0:return n=e.getCtrlUI(),"fullScreenStatus"!==r?[3,6]:(!1===l&&(i=!0),!0===n.webFullScreenStatus&&y.default.operation(y.default.OperationCode.WebFullScreenWay,0),n.webFullScreenStatus=!1,t.emit(f.ExternalEventType.WebFullscreen,!1,c.Other),n.fullScreenStatus=l,!0!==l?[3,3]:t.container.contains(C.default.getFullscreenElement())?[3,2]:[4,C.default.requestFullscreen(t.container)]);case 1:a.sent(),a.label=2;case 2:return[3,5];case 3:return[4,C.default.exitFullscreen()];case 4:a.sent(),a.label=5;case 5:return t.emit(f.ExternalEventType.ScreenStateChange,l?"full":"normal"),[3,8];case 6:return"webFullScreenStatus"!==r?[3,8]:[4,C.default.exitFullscreen()];case 7:a.sent(),i=!0,n.fullScreenStatus=!1,t.emit(f.ExternalEventType.WebFullscreen,l,c.Click),t.emit(f.ExternalEventType.ScreenStateChange,l?"webFull":"normal"),!1===l&&e.hide(),a.label=8;case 8:return[2]}})})}),l=C.default.onChange(function(){var n=t.container===C.default.getFullscreenElement();n||i||(e.getCtrlUI().fullScreenStatus=!1,t.emit(f.ExternalEventType.ScreenStateChange,"normal")),t.emit(f.ExternalEventType.FullscreenChange,n,i?c.Click:c.Esc),i=!1});return function(){l(),r()}}function U(e,t){e.on("danmuInputBlur",function(){t.ctrl.show(!1)}),e.on("danmuInputFocus",function(){t.ctrl.show(!0)})}function q(){var e=function e(){return window.setTimeout(function(){y.default.custom(y.default.CustomCode.HangUp,{time:Math.floor(performance.now()/1e3),visible:"visible"===document.visibilityState?1:0}),clearTimeout(t),t=e()},18e5)},t=e(),n=function(){clearTimeout(t),t=e()};return window.addEventListener("mousemove",n),function(){window.removeEventListener("mousemove",n),clearTimeout(t)}}function A(){var e=setInterval(function(){var e,t,n=navigator.connection;y.default.custom(y.default.CustomCode.NetSpeed,{downlink:null!==(e=null==n?void 0:n.downlink)&&void 0!==e?e:-1,rtt:null!==(t=null==n?void 0:n.rtt)&&void 0!==t?t:-1},{sampleRate:.1})},18e4);return function(){clearInterval(e)}}function B(e){return a(this,void 0,Promise,function(){var t,n;return o(this,function(i){switch(i.label){case 0:if(!["其他问题或建议","黑屏","播放卡顿"].includes(e.type))return[2];t=5,n=36e5,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,P.goldMiner.report({startTime:Date.now()-n,endTime:Date.now(),latestCount:t,source:"player-report[".concat(e.type,"]")})];case 2:return i.sent(),[3,4];case 3:return i.sent(),y.default.error(y.default.ErrorCode.ApiBiz,"LogReportFail"),[3,4];case 4:return[2]}})})}exports.RoomPlayer=F;var N=function(e,t,n){var i=null==n||n,a=[];return a.push(e.on(d.VideoEventType.MutePlay,function(){if(i){var n=(0,x.createMutePlayTip)(t,e.ctrl,function(){var t=e.getVideoEl();null!=t&&(t.muted=!1)});e.ctrl.getCtrlUI().show?n.change(!0):n.change(!1),a.push(e.on(d.VideoEventType.Destroyed,n.destroy),e.ctrl.onRefresh(n.destroy),e.on(f.ExternalEventType.SwitchLine,n.destroy),e.on(f.ExternalEventType.SwitchQuality,n.destroy),n.destroy,e.ctrl.onChange(function(e,t){if("show"===e&&(t?n.change(!0):n.change(!1)),"volume"===e){var i=t,a=i.disabled,o=i.value;(!a||o>0)&&n.destroy()}}))}})),a.push(e.on(d.VideoEventType.NotAutoPlay,function(){if(i){var n=(0,x.createNotAutoPlayTip)(t,function(){var t=e.getVideoEl();null!=t&&(t.muted=!1,t.play().catch(function(e){f.logger.error("click btn to play failed")}))});a.push(e.on(d.VideoEventType.Destroyed,function(){n()}))}})),function(){a.forEach(function(e){e()})}},z=!1;function H(t){if(!(z||(z=!0,Math.random()>.01))){var n=0,i=(0,f.monitorFPS)({type:"avg"},function(e){n=e});window.setTimeout(function(){var o;i(),y.default.perf(y.default.PerfCode.DevicePerf,n,{params:e(e({cpuCnt:navigator.hardwareConcurrency,mem:null!==(o=navigator.deviceMemory)&&void 0!==o?o:-1},a()),{dmSwitch:t.dmSwitch,maskDM:t.dmBiz.bodyMaskDetectorStatus}),extFields:[]})},1e4)}function a(){var e=document.createElement("canvas").getContext("experimental-webgl"),t={renderer:"",vendor:""};if(null==e)return t;var n=e.getExtension("WEBGL_debug_renderer_info");return null!=n&&(t.renderer=e.getParameter(n.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(n.UNMASKED_VENDOR_WEBGL)),t}}function j(){null!=document.pictureInPictureElement&&document.exitPictureInPicture().catch(function(e){f.logger.error(e)})}window.Player=F;
})()