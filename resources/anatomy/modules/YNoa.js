/**
 * id: YNoa
 * path: @bilibili-live/web-player-contextmenu
 */

(function(require,module,exports) {
"use strict";var e,t,n,i,o,l,a,r,u=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},s=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.IDanmuInfo=void 0;var h,d=p(require("./contextmenu")),f=require("./type");Object.defineProperty(exports,"IDanmuInfo",{enumerable:!0,get:function(){return f.IDanmuInfo}}),function(e){e.DANMU="danmu",e.LINE="line",e.LOGGER="logger",e.VIDEO_INFO="videoInfo",e.VERSION="version",e.COPYRIGHT="copyright",e.CLOSE="close"}(h||(h={}));var m=function(p){function d(u,s){var h=p.call(this)||this;return e.set(h,void 0),t.set(h,void 0),n.set(h,[]),i.set(h,[]),o.set(h,null),l.set(h,!1),a.set(h,function(e){e.preventDefault(),p.prototype.removeMenuItems.call(h),h.danmuPreCheck(),h.showContextmenu(h.computePosition(e))}),r.set(h,function(e){h.menuContainer.contains(e.target)||(h.removeMenuItems(),p.prototype.hide.call(h))}),c(h,t,u),c(h,e,s),h.init(),h}return u(d,p),d.prototype.setLines=function(e,t,n){var l;if(null===(l=s(this,o))||void 0===l||l.call(this),0!==e.length){var a={label:"观看卡顿？切换备线试试",submenu:e.map(function(e){return{value:e.value,label:e.label,disable:e.value===t,click:n.bind(null,e.value)}})};c(this,i,e),c(this,o,this.prependMenuItem(h.LINE,a))}},d.prototype.changeLine=function(e){var t=s(this,i).findIndex(function(t){return t.value===e});null!=t&&this.submenuActive(h.LINE,t)},d.prototype.updateDanmuInfo=function(e){c(this,n,e)},d.prototype.setAdmin=function(){c(this,l,!0)},d.prototype.destroy=function(){p.prototype.destroy.call(this),this.removeListener(),s(this,t).removeChild(this.menuContainer)},d.prototype.init=function(){var e=this.getInitialConfig();p.prototype.initContextmenu.call(this,e),s(this,t).appendChild(this.menuContainer),this.addListener()},d.prototype.getInitialConfig=function(){var t=s(this,e);return[{name:h.LOGGER,label:"播放器日志信息",submenu:[{value:1,icon:"blp-icon-show",label:"显示日志",click:t.click.handleLogger.bind(null,"show")},{value:2,icon:"blp-icon-copy",label:"复制日志",click:t.click.handleLogger.bind(null,"copy")},{value:3,icon:"blp-icon-download",label:"下载日志",click:t.click.handleLogger.bind(null,"download")}]},{name:h.VIDEO_INFO,label:"视频统计信息",click:t.click.handleVideoInfo},{name:h.VERSION,label:"Bilibili HTML5 Live Player "+t.version},{name:h.COPYRIGHT,label:"Copyright bilibili "+(new Date).getFullYear()},{name:h.CLOSE,label:"关闭",click:function(){}}]},d.prototype.showContextmenu=function(e){p.prototype.show.call(this,{top:e.top,left:e.left},e.mainAxiosRight<160)},d.prototype.danmuPreCheck=function(){var e=this,t=s(this,n);t.length>0&&t.forEach(function(t,n){e.prependDanmu(t,0===n)}),c(this,n,[])},d.prototype.getDanmuConfig=function(t,n){var i=this,o=t.text.trim(),a=t.uid,r=a===s(this,e).uid,u={hr:n,autoRemove:!0,label:o,submenu:[{value:1,label:"举报选中弹幕",disable:r,click:s(this,e).click.handleDanmu.bind(this,"report",t)},{value:2,label:"屏蔽此用户的弹幕",disable:r,click:s(this,e).click.handleDanmu.bind(this,"shield",t)},{value:4,label:"复制弹幕",click:function(){var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(o).catch(function(){})}},{value:5,label:"去TA的个人空间",click:function(){var t="//space.bilibili.com/"+a;window.open(t),s(i,e).click.handleEvent(t)}}]};return s(this,l)&&u.submenu.splice(2,0,{value:3,label:"添加进黑名单",disable:r,click:s(this,e).click.handleDanmu.bind(this,"addBlackList",t)}),u},d.prototype.prependDanmu=function(e,t){var n=this.getDanmuConfig(e,t);p.prototype.prependMenuItem.call(this,h.DANMU,n)},d.prototype.computePosition=function(e){var n,i=Number(null!==(n=getComputedStyle(document.documentElement).zoom)&&void 0!==n?n:1),o=s(this,t).getBoundingClientRect(),l=this.menuContainer.getBoundingClientRect(),a=e.clientX,r=e.clientY,u=Math.min(a/i-o.left,o.width-l.width);return{left:u,top:Math.min(r/i-o.top,o.height-l.height),mainAxiosRight:o.width-u-l.width}},d.prototype.addListener=function(){s(this,t).addEventListener("contextmenu",s(this,a)),window.addEventListener("click",s(this,r))},d.prototype.removeListener=function(){s(this,t).removeEventListener("contextmenu",s(this,a)),window.removeEventListener("click",s(this,r))},d}(d.default);e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,o=new WeakMap,l=new WeakMap,a=new WeakMap,r=new WeakMap,exports.default=m;
})()