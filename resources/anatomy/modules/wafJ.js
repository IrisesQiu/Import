/**
 * id: wafJ
 * path: @bilibili-live/web-player-danmaku-report
 */

(function(require,module,exports) {
"use strict";var e,t,r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function a(e){try{l(n.next(e))}catch(t){o(t)}}function s(e){try{l(n.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}l((n=n.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(l){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(l){s=[6,l],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}},i=this&&this.__classPrivateFieldSet||function(e,t,r,n,i){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?i.call(e,r):i?i.value=r:t.set(e,r),r},o=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},a=this&&this.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var l=s(require("./modal")),c=require("@bilibili-live/web-player-common");require("./index.less");var u={reportReason:"/xlive/web-ucenter/v1/dMReport/ForReason",reportDanmaku:"/xlive/web-ucenter/v1/dMReport/Report"},d=function(){function s(r){e.set(this,null),t.set(this,void 0),i(this,t,r,"f")}return s._createModalHtml=function(e,t){var r=t.reduce(function(e,t){return e+"<li>".concat(t.reason,"</li>")},'<li class="web-player-report-item-default" style="display: none">请选择举报理由喔~</li>');return'\n      <div class="web-player-report-wrap">\n        <div class="web-player-report-uname">'.concat(e.uname,'</div>\n        <div class="web-player-report-msg">').concat(e.msg,'</div>\n        <div class="web-player-report-select-wrap">\n          <div class="web-player-report-select-input">\n            <div class="web-player-report-curt">请选择举报理由喔~</div>\n            <div class="web-player-report-icon"></div>\n          </div>\n          <ul class="web-player-report-ul">').concat(r,"</ul>\n        </div>\n      </div>\n    ")},s.prototype.show=function(e){return r(this,void 0,Promise,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,(0,c.ajax)(u.reportReason)];case 1:return r=n.sent(),t=null!=r?r.data:[{id:1,reason:"违法违规"},{id:2,reason:"低俗色情"},{id:3,reason:"垃圾广告"},{id:4,reason:"辱骂引战"},{id:5,reason:"政治敏感"},{id:6,reason:"青少年不良信息"},{id:7,reason:"其他"}],[3,3];case 2:return n.sent(),t=[{id:1,reason:"违法违规"},{id:2,reason:"低俗色情"},{id:3,reason:"垃圾广告"},{id:4,reason:"辱骂引战"},{id:5,reason:"政治敏感"},{id:6,reason:"青少年不良信息"},{id:7,reason:"其他"}],[3,3];case 3:return this.handleReport(e,t),[2]}})})},s.prototype.resetReasonVisible=function(e){a([],e.children,!0).forEach(function(e){e instanceof HTMLElement&&(e.style.display="block")})},s.prototype.checkReportState=function(){var e=document.querySelector(".live-bilibili-player-report-cancel");null==e||e.click()},s.prototype.handleReport=function(a,c){var u=this;this.checkReportState();var d=s._createModalHtml(a,c);null==o(this,e,"f")&&i(this,e,new l.default(o(this,t,"f"),{title:"举报弹幕",html:d,btns:[{type:"submit",text:"警察叔叔就是他",click:function(){return r(u,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,this._submitFunction(a,c)];case 1:return e.sent(),x(),[2]}})})}},{type:"cancel",text:"饶他一命",click:function(){x()}}],width:360,btnPostion:"flex-report"}),"f");var p=document.querySelector(".web-player-report-uname"),f=document.querySelector(".web-player-report-msg");p.innerText=a.uname,a.img_url?f.innerHTML="<img src=".concat(a.img_url,">"):f.innerText=a.msg,o(this,e,"f").show();var y=document.querySelector(".web-player-report-ul"),h=document.querySelector(".web-player-report-curt"),v=document.querySelector(".web-player-report-select-wrap"),b=document.querySelector(".blp-plugin-modal-btn"),m=document.querySelector(".web-player-report-item-default"),w=function(e){u.resetReasonVisible(y);var t=e.target.innerText;b.disabled="请选择举报理由喔~"===t&&"获取不到举报理由，请尝试刷新后举报喔~"===t,h.innerText=t,y.style.display="none",m.style.display="block",e.target.style.display="none"}.bind(this),_=function(){y.style.display="none"}.bind(this),g=function(){y.style.display="block"}.bind(this),x=function(){var t;h.innerText="请选择举报理由喔~",m.style.display="none",u.resetReasonVisible(y),y.removeEventListener("click",w),null==v||v.removeEventListener("mouseover",g),null==v||v.removeEventListener("mouseout",_),null===(t=o(u,e,"f"))||void 0===t||t.destroy(),i(u,e,null,"f")};b.disabled=!0,y.addEventListener("click",w),null==v||v.addEventListener("mouseover",g),null==v||v.addEventListener("mouseout",_)},s.prototype._submitFunction=function(i,a){var s;return r(this,void 0,Promise,function(){var r,l,d,p,f,y;return n(this,function(n){switch(n.label){case 0:if(r=o(this,t,"f").querySelector(".web-player-report-curt"),l=r.innerText,d=i.checkInfo,p=0,null!=(f=a.filter(function(e){return e.reason===l}))&&0!==f.length&&(p=f[0].id),""===l)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,(0,c.ajax)(u.reportDanmaku,{method:"POST",data:{reason:l,roomid:i.roomid,msg:i.msg,tuid:i.uid,ts:d.ts,sign:d.ct,reason_id:p,dm_type:i.type,file_id:i.file_id,img_url:i.img_url,id_str:i.id_str}})];case 2:return n.sent(),null===(s=o(this,e,"f"))||void 0===s||s.hide(),[3,4];case 3:return y=n.sent(),c.logger.error(y),[3,4];case 4:return[2]}})})},s}();e=new WeakMap,t=new WeakMap,exports.default=d;
})()