/**
 * id: SR9Z
 * path: @bilibili-live/web-player-video-info
 */

(function(require,module,exports) {
"use strict";var e,t,a,i,o,n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,a=1,i=arguments.length;a<i;a++)for(var o in t=arguments[a])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},r=this&&this.__classPrivateFieldSet||function(e,t,a,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(e,a):o?o.value=a:t.set(e,a),a},s=this&&this.__classPrivateFieldGet||function(e,t,a,i){if("a"===a&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===a?i:"a"===a?i.call(e):i?i.value:t.get(e)},c=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var d=require("@bilibili-live/web-player-common"),l=c(require("./wave-graph")),p=c(require("./panel")),h="p-video-info-",f=function(){function c(c){var h=this;e.set(this,void 0),t.set(this,void 0),a.set(this,void 0),i.set(this,0),o.set(this,void 0),this.videoTemplate={mimeType:{label:"Mime Type",data:""},playerCore:{label:"Player Core",data:""},videoInfo:{label:"Video Info",data:""},audioInfo:{label:"Audio Info",data:""},encoder:{label:"Encoder",data:""},streamHost:{label:"Stream Host",data:""},bufferLength:{label:"Buffer Length",data:""},droppedFrames:{label:"Decoded Frames",data:""},networkActivity:{label:"Download Bitrate",data:""}},this.template=Object.keys(this.videoTemplate).map(function(e){var t;return(t={})[e]=h.videoTemplate[e].data,t}).reduce(function(e,t){return n(n({},e),t)}),this.templateProxy=this.createTemplateProxy(),r(this,e,c,"f"),r(this,a,(0,d.createElement)("div"),"f"),r(this,o,new l.default({width:180,height:14}),"f"),s(this,a,"f").appendChild(this.combineDataElement()),r(this,t,new p.default(s(this,e,"f"),{scope:s(this,a,"f"),style:{top:"10px",left:"10px"}}),"f")}return c.prototype.show=function(){s(this,t,"f").status=1,this.repaintGraph()},c.prototype.hide=function(){s(this,t,"f").status=0},c.prototype.destroy=function(){for(var e in r(this,a,null,"f"),this.templateProxy)this.templateProxy[e]="";s(this,t,"f").destroy(),s(this,o,"f").destroy()},c.prototype.updateVideoTemplate=function(e){if(0!==s(this,t,"f").status){var a=e.mediaInfo,n=e.realtimeInfo,c=Math.floor(n.videoNetworkActivity/1024),l=this.templateProxy;l.mimeType=a.mimeType,l.playerCore=a.corePlayerType,l.videoInfo="".concat(a.width,"x").concat(a.height,", ").concat(a.fps,"FPS"),l.audioInfo="".concat(a.audioSampleRate/1e3,"KHz, ").concat(a.audioChannel,", ").concat(this.computeBps(a.audioDataRate)),l.encoder=a.encoder,l.streamHost=a.videoSrc.split("://")[1].split("/")[0],l.networkActivity="".concat((0,d.roundNumber)(c/1024*8,2),"Mbps"),l.bufferLength="".concat(n.videoBufferLength,"s, ").concat(n.latency?"".concat(n.latency/1e3,"s"):"N/A"),l.droppedFrames="".concat(n.droppedFrames,"/").concat(n.decodedFrames,", ").concat(n.decodedFrames-s(this,i,"f")<0?0:n.decodedFrames-s(this,i,"f"),"FPS"),r(this,i,n.decodedFrames,"f"),n.decodedFrames>0&&s(this,o,"f").updateGraph(c),this.repaintGraph()}},c.prototype.createTemplateProxy=function(){return new Proxy(this.template,{get:function(e,t,a){if(t in e)return e[t];throw new ReferenceError('Prop name "'+t+'" does not exist.')},set:function(e,t,a,i){var o;if(e[t]!==a){e[t]=a;var n=null===(o=document.getElementById("".concat(h).concat(t)))||void 0===o?void 0:o.querySelector(".web-player-line-data");null!=n&&(n.textContent=a)}return!0}})},c.prototype.repaintGraph=function(){if(0!==s(this,t,"f").status){var e=s(this,o,"f").getGraph(),a=document.querySelector(".web-player-info-graph");null!=a&&(a.innerHTML=e)}},c.prototype.combineDataElement=function(){var e=this,t=document.createDocumentFragment();return Object.keys(this.videoTemplate).forEach(function(a){var i=document.createElement("div");i.id="".concat(h).concat(a),i.style.cssText+="\n          min-width: 290px;\n          line-height: 18px;\n          font-size: 12px;\n        ",i.innerHTML='\n          <div style="display: inline-block;\n          white-space: nowrap;\n          width: 100px;\n          text-align: right;\n          font-weight: 500;\n          margin-right: 10px;">'.concat(e.videoTemplate[a].label,":</div>\n          ").concat("networkActivity"===a?'<div style="display: inline-block; margin-right: 10px;" class="web-player-info-graph">'+s(e,o,"f").getGraph()+"</div>":"",'\n          <div style="display: inline-block; min-width: 58px" class="web-player-line-data">').concat(e.videoTemplate[a].data,"</div>\n        "),t.appendChild(i)}),t},c.prototype.computeBps=function(e){return e<1e3?"".concat((0,d.roundNumber)(e,0),"Kbps"):"".concat((0,d.roundNumber)(e/1e3,1),"Mbps")},c}();e=new WeakMap,t=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,exports.default=f;
})()