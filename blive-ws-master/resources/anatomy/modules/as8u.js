/**
 * id: as8u
 * path: ./common/controller
 */

(function(require,module,exports) {
"use strict";var t,e,n,i,r,o,s,a,l,u,c,f,h,d,p,w=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,o){function s(t){try{l(i.next(t))}catch(e){o(e)}}function a(t){try{l(i.throw(t))}catch(e){o(e)}}function l(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}l((i=i.apply(t,e||[])).next())})},v=this&&this.__generator||function(t,e){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(a){return function(l){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,a[0]&&(s=0)),s;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return s.label++,{value:a[1],done:!1};case 5:s.label++,i=a[1],a=[0];continue;case 7:a=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){s=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){s.label=a[1];break}if(6===a[0]&&s.label<r[1]){s.label=r[1],r=a;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(a);break}r[2]&&s.ops.pop(),s.trys.pop();continue}a=e.call(t,s)}catch(l){a=[6,l],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,l])}}},y=this&&this.__classPrivateFieldSet||function(t,e,n,i,r){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?r.call(t,n):r?r.value=n:e.set(t,n),n},b=this&&this.__classPrivateFieldGet||function(t,e,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(t):i?i.value:e.get(t)},S=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ControllerEventType=void 0;var m,g=S(require("@bilibili-live/web-player-controller")),C=require("@bilibili-live/web-player-common"),k=S(require("@bilibili-live/web-player-track"));!function(t){t.BottomDistanceChange="bottomDistanceChange"}(m=exports.ControllerEventType||(exports.ControllerEventType={}));var E=function(){function S(S,k){var E=this;this.container=S,this.opts=k,t.set(this,new C.EventBus),e.set(this,void 0),n.set(this,void 0),i.set(this,void 0),r.set(this,new Set),o.set(this,new Set),s.set(this,void 0),a.set(this,!1),l.set(this,0),u.set(this,0),c.set(this,function(){}),this.on=b(this,t,"f").on,f.set(this,b(this,t,"f").emit),h.set(this,!1),this.setBottomDistance=function(t){parseInt(getComputedStyle(b(E,e,"f")).bottom)!==t&&(b(E,e,"f").style.bottom="".concat(t,"px"),b(E,n,"f").style.bottom="".concat(t,"px"),b(E,f,"f").call(E,m.BottomDistanceChange,t))},d.set(this,function(){if(C.logger.info("Controller onrefresh"),0!==b(E,o,"f").size)for(var t=0,e=Array.from(b(E,o,"f"));t<e.length;t++){(0,e[t])()}}),this.getCtrlEl=function(){return b(E,e,"f")},p.set(this,function(t,e){return w(E,void 0,Promise,function(){return v(this,function(n){switch(n.label){case 0:return C.logger.info("Controller onchange: type: ".concat(t,", value: ").concat(JSON.stringify(e))),0===b(this,r,"f").size?[2,!1]:[4,Promise.all(Array.from(b(this,r,"f")).map(function(n){return n(t,e)}))];case 1:return n.sent().includes(!1)?[2,!1]:[2]}})})}),this.changeCtrlVisible=function(t){t?(b(E,n,"f").style.visibility="visible",b(E,e,"f").style.visibility="visible"):(b(E,n,"f").style.visibility="hidden",b(E,e,"f").style.visibility="hidden")},y(this,e,M(),"f"),y(this,n,F(),"f"),k.enableCtrlUI&&(this.container.appendChild(b(this,n,"f")),S.appendChild(b(this,e,"f"))),y(this,i,new g.default({target:b(this,e,"f"),props:{show:!1,playStatus:!1,quality:{list:[],value:null},line:{list:[],value:null},onRefresh:b(this,d,"f"),onChange:b(this,p,"f"),isMobile:this.opts.isMobile,container:S,dmMsg:""}}),"f"),this.opts.isMobile?y(this,s,W(S,this,b(this,e,"f")),"f"):(y(this,s,x(S,this,b(this,e,"f")),"f"),y(this,c,T(this),"f"))}return S.prototype.triggerWebFullscreen=function(){var t,e=!(null!==(t=b(this,i,"f").webFullScreenStatus)&&void 0!==t&&t);b(this,i,"f").webFullScreenStatus=e,b(this,r,"f").forEach(function(t){return t("webFullScreenStatus",e)}),k.default.operation(k.default.OperationCode.WebFullScreenWay,e?1:-1)},S.prototype.onChange=function(t){var e=this;return b(this,r,"f").add(t),function(){b(e,r,"f").delete(t)}},S.prototype.onRefresh=function(t){var e=this;return b(this,o,"f").add(t),function(){b(e,o,"f").delete(t)}},S.prototype.getCtrlUI=function(){return b(this,i,"f")},S.prototype.setMiniMode=function(t){y(this,a,t,"f")},S.prototype.show=function(t){void 0===t&&(t=!1),y(this,h,t,"f"),clearTimeout(b(this,l,"f")),b(this,a,"f")||b(this,i,"f").show||(b(this,n,"f").style.display="block",b(this,i,"f").show=!0,b(this,r,"f").forEach(function(t){return t("show",!0)}))},S.prototype.delayHide=function(t,e){var n=this;void 0===e&&(e=function(){}),clearTimeout(b(this,l,"f")),y(this,l,window.setTimeout(function(){b(n,h,"f")||(n.hide(),e())},t),"f")},S.prototype.hide=function(t){void 0===t&&(t=!1),y(this,h,t,"f"),b(this,i,"f").show&&(b(this,n,"f").style.display="none",b(this,i,"f").show=!1,b(this,r,"f").forEach(function(t){return t("show",!1)}))},S.prototype.getLockDisplayState=function(){return b(this,h,"f")},S.prototype.setScreenStatus=function(t){var e=!0===b(this,i,"f").webFullScreenStatus?1:!0===b(this,i,"f").fullScreenStatus?2:0;if(e!==t){var n="fullScreenStatus",o=!0;switch(t){case 0:n=["webFullScreenStatus","webFullScreenStatus","fullScreenStatus"][e],o=!1,b(this,i,"f").webFullScreenStatus=!1,b(this,i,"f").fullScreenStatus=!1;break;case 1:n="webFullScreenStatus",b(this,i,"f").webFullScreenStatus=!0,b(this,i,"f").fullScreenStatus=!1;break;case 2:n="fullScreenStatus",b(this,i,"f").webFullScreenStatus=!1,b(this,i,"f").fullScreenStatus=!0}b(this,r,"f").forEach(function(t){return t(n,o)})}},S.prototype.destroy=function(){y(this,r,new Set,"f"),y(this,o,new Set,"f"),b(this,s,"f").call(this),b(this,i,"f").$destroy(),b(this,e,"f").remove(),b(this,n,"f").remove(),clearTimeout(b(this,l,"f")),clearTimeout(b(this,u,"f")),b(this,c,"f").call(this)},S.prototype.showCursor=function(){clearTimeout(b(this,u,"f")),"default"!==this.container.style.cursor&&(this.container.style.cursor="default")},S.prototype.delayHideCursor=function(t){var e=this;clearTimeout(b(this,u,"f")),y(this,u,window.setTimeout(function(){e.container.style.cursor="none"},t),"f")},S}();function M(){var t=document.createElement("div");return t.style.cssText="\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 13;\n  ",t.classList.add("web-player-controller-wrap"),t.id="web-player-controller-wrap-el",t}function F(){var t=document.createElement("div");return t.classList.add("web-player-controller-bg"),t.style.cssText="\n    display: none;\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 10;\n    height: 56px;\n    background-image: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7));\n  ",t.classList.add("web-player-controller-wrap"),t}function T(t){var e=t.onChange(function(e,n){if("fullScreenStatus"===e||"webFullScreenStatus"===e){if(n)return void t.delayHideCursor(2e3);t.showCursor()}});return function(){e()}}function W(t,e,n){var i=!1,r=function(t){var r=e.getCtrlUI().qualityPanelRef;!i||!L(n,t,!0)&&!0!==(null==r?void 0:r.contains(t.target))?(i=!i)?(e.show(),e.delayHide(2e3,function(){i=!1})):e.hide():e.delayHide(2e3,function(){i=!1})};return e.onChange(function(t,n){"dmInputFocus"===t&&(n?e.show(!0):e.hide())}),t.addEventListener("touchstart",r),function(){t.removeEventListener("touchstart",r)}}function x(t,e,n){var i=this,r=(0,C.throttle)(function(t){if(!e.getLockDisplayState()&&(e.show(),e.showCursor(),!L(n,t))){e.delayHide(2e3);var i=e.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||e.delayHideCursor(2e3)}},500),o=function(){e.getLockDisplayState()||(e.hide(),e.showCursor())},s=function(t){if(!L(n,t)){e.delayHide(2e3);var i=e.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||(e.showCursor(),e.delayHideCursor(2e3))}};t.addEventListener("mousemove",r),t.addEventListener("mouseleave",o),t.addEventListener("click",s);var a=function(t){n.contains(t.target)||w(i,void 0,Promise,function(){return v(this,function(t){return e.triggerWebFullscreen(),[2]})}).catch(function(t){C.logger.error(t)})};return t.addEventListener("dblclick",a),function(){t.removeEventListener("click",s),t.removeEventListener("mousemove",r),t.removeEventListener("mouseleave",o),t.removeEventListener("dblclick",a)}}function L(t,e,n){void 0===n&&(n=!1);var i=t.getBoundingClientRect().top-36-14-(n?52:0);return n?e.touches[0].clientY>i||t.contains(e.target):e.clientY>i||t.contains(e.target)}exports.default=E,t=new WeakMap,e=new WeakMap,n=new WeakMap,i=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,f=new WeakMap,h=new WeakMap,d=new WeakMap,p=new WeakMap;
})()