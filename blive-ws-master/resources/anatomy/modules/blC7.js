/**
 * id: blC7
 * path: ../common/connects
 */

(function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.connectMirror=exports.connectVideoPip=exports.connectVideoLoading=exports.connectUIandVideo=void 0;var t=require("@bilibili-live/web-player-common"),n=require("@bilibili-live/web-player-video"),r=e(require("@bilibili-live/web-player-track"));function i(e,n){var r=e.getCtrlUI(),i=n.getVideoEl();if(null==i||null==r)return function(){};var o=t.userSetting.getVolume();null!=o&&(i.volume=o.value/100,i.muted=o.disabled,r.volume={disabled:i.muted,value:100*i.volume});var u=function(){r.playStatus=!0},a=function(){r.playStatus=!1},l=function(){n.getVideoEl().paused&&e.show()},c=function(e){null!=r.volume&&(r.volume={disabled:i.muted,value:100*i.volume})};i.addEventListener("playing",u),i.addEventListener("pause",a),i.addEventListener("loadeddata",l),i.addEventListener("volumechange",c);var d=e.onChange(function(e,n){if("playStatus"===e)n?i.play().catch(function(e){t.logger.error(e)}):i.pause();else if("volume"===e){var r=n,o=r.disabled,u=r.value;i.muted=o,i.volume=u/100}});return function(){d(),i.removeEventListener("playing",u),i.removeEventListener("pause",a),i.removeEventListener("loadeddata",l),i.removeEventListener("volumechange",c)}}function o(e,r,i){var o,u=function(){o=(0,t.loading)(r)},a=function(){null==o||o()},l=e.on(n.EventType.WaitStart,function(){u()}),c=e.on(n.EventType.WaitEnd,a);return e.once(n.EventType.FirstFrame,function(){a(),(0,t.coverImg)(null,r)}),null==i||""===i?(u(),(0,t.coverImg)(null,r)):(0,t.coverImg)(i,r),function(){l(),c(),a()}}function u(e,i){var o=function(){null!=document.pictureInPictureElement&&document.exitPictureInPicture().catch(function(e){t.logger.error(e)})},u=e.on(n.EventType.Destroyed,function(){o(),c.pipStatus=!1,u()}),a=i.onChange(function(n,r){if("pipStatus"===n&&document.pictureInPictureEnabled){if(r){var i=e.getVideoEl();return o(),void i.requestPictureInPicture().catch(t.logger.error)}o()}}),l=e.getVideoEl(),c=i.getCtrlUI(),d=0,v=function(){r.default.operation(r.default.OperationCode.PictureInPicture,Math.floor((performance.now()-d)/1e3),{sampleRate:1})},s=function(){c.pipStatus=!1,v()},p=function(){d=performance.now()},f=function(){null!=document.pictureInPictureElement&&v()};return l.addEventListener("leavepictureinpicture",s),l.addEventListener("enterpictureinpicture",p),window.addEventListener("beforeunload",f),function(){a(),l.removeEventListener("leavepictureinpicture",s),l.removeEventListener("enterpictureinpicture",p),window.removeEventListener("beforeunload",f),o()}}function a(e,t){!0===t.getCtrlUI().mirrorStatus&&(e.getVideoEl().style.transform="rotateY(180deg)");var n=t.onChange(function(t,n){if("mirrorStatus"===t){var r=e.getVideoEl();r.style.transform=!0!==n?"":"rotateY(180deg)"}});return function(){n()}}exports.connectUIandVideo=i,exports.connectVideoLoading=o,exports.connectVideoPip=u,exports.connectMirror=a;
})()