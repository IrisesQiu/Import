/**
 * id: E2W8
 * path: @bilibili-live/web-player-subtitle
 */

(function(require,module,exports) {
"use strict";var t,e,i,n,s,r,o,a,l,f,c,u,h,d,p=this&&this.__assign||function(){return(p=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var s in e=arguments[i])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},y=this&&this.__classPrivateFieldGet||function(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)},b=this&&this.__classPrivateFieldSet||function(t,e,i,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(t,i):s?s.value=i:e.set(t,i),i};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Subtitle=void 0;var v=require("@bilibili-live/web-player-common"),m=require("./drag-element");require("./subtitle.less");var w=function(){function h(u,h){this.container=u,t.add(this),e.set(this,{}),i.set(this,(0,v.createElement)("div",{attributes:[["id","web-player-subtitle"],["class","web-player-subtitle"]]})),n.set(this,function(){}),s.set(this,function(){}),r.set(this,!1),o.set(this,new v.EventBus),a.set(this,y(this,o,"f").emit),this.on=y(this,o,"f").on,l.set(this,{"#BFEDFA":null,"#FFB3CA":null,"#FFF5BF":null,"#FFC18F":null,"#89E1E1":null,"#D8B6FF":null}),f.set(this,!1),c.set(this,!1),y(this,i,"f").appendChild((0,v.createElement)("div")),y(this,i,"f").appendChild((0,v.createElement)("div")),g(y(this,i,"f"),u,h.pos),u.appendChild(y(this,i,"f"))}return Object.defineProperty(h.prototype,"visible",{get:function(){return y(this,f,"f")},set:function(t){t||(y(this,i,"f").style.display="none"),b(this,f,t,"f")},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"pos",{get:function(){return{x:y(this,i,"f").style.left,y:y(this,i,"f").style.bottom}},enumerable:!1,configurable:!0}),Object.defineProperty(h.prototype,"draggable",{get:function(){return y(this,c,"f")},set:function(t){var e=this;t?y(this,i,"f").classList.add("draggable"):y(this,i,"f").classList.remove("draggable"),b(this,c,t,"f"),y(this,s,"f").call(this),t&&b(this,s,(0,m.dragElement)(y(this,i,"f"),this.container,{onMouseDown:function(){b(e,r,!0,"f"),y(e,i,"f").classList.add("dragging"),y(e,a,"f").call(e,"dragStart")},onMouseUp:function(){b(e,r,!1,"f"),y(e,i,"f").classList.remove("dragging"),y(e,i,"f").dataset.offsetBottom=y(e,i,"f").style.bottom,y(e,a,"f").call(e,"dragEnded",{x:y(e,i,"f").style.left,y:y(e,i,"f").style.bottom})}}),"f")},enumerable:!1,configurable:!0}),h.prototype.add=function(i){var n;for(var s in y(this,e,"f"))i.id in y(this,e,"f")[s]&&delete y(this,e,"f")[s][i.id];var r=y(this,e,"f")[i.roleId],o=y(this,t,"m",u).call(this,i.roleId);null==r?(i.color=o,y(this,e,"f")[i.roleId]=((n={})[i.id]=i,n)):r[i.id]=p(p({},i),{color:o})},h.prototype.setVideoSource=function(e){y(this,t,"m",d).call(this,e)},h.prototype.destroy=function(){y(this,n,"f").call(this),b(this,e,{},"f"),y(this,i,"f").remove()},h}();function g(t,e,i){null==i?(t.style.left="50%",t.style.bottom="15%",t.style.transform="translateX(-50%)"):(t.style.left=i.x,t.style.bottom=i.y)}exports.Subtitle=w,e=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,l=new WeakMap,f=new WeakMap,c=new WeakMap,t=new WeakSet,u=function(t){if("0"===t)return"#FFFFFF";for(var e="",i=0,n=Object.entries(y(this,l,"f"));i<n.length;i++){var s=n[i],r=s[0],o=s[1];if(o===t){e=r;break}null==o&&""===e&&(e=r)}return""!==e&&(y(this,l,"f")[e]=t),e},h=function(t){var i=this,n=1e3*t.currentTime;return Object.values(y(this,e,"f")).map(function(t){return Object.values(t)}).filter(function(t){return t.length>0}).slice(0,2).map(function(t){var s=1/0,r=null;return t.forEach(function(t){if(t.offset+t.duration<n)return delete y(i,e,"f")[t.roleId][t.id],void(0===Object.keys(y(i,e,"f")[t.roleId]).length&&delete y(i,e,"f")[t.roleId]);if(!(n<t.offset)){var o=Math.abs(n-t.offset);o<s&&(s=o,r=t)}}),r}).filter(Boolean)},d=function(e){var s=this,o=function(){if(y(s,f,"f")&&!y(s,r,"f")){var n=y(s,t,"m",h).call(s,e);if(0!==n.length){y(s,i,"f").childNodes.forEach(function(t,e){var i;t.textContent="";var s=n[e];null!=s&&(t.textContent=n[e].content,t.style.color=null!==(i=s.color)&&void 0!==i?i:"#fff")});var o=y(s,i,"f").offsetTop,a=y(s,i,"f").style.bottom;if(o<0&&!a.startsWith("calc"))y(s,i,"f").style.bottom="calc(".concat(a," + ").concat(y(s,i,"f").offsetTop,"px)");else if(o>=0){var l=y(s,i,"f").dataset.offsetBottom;null!=l&&(y(s,i,"f").style.bottom=l)}y(s,i,"f").style.display="block"}else y(s,i,"f").style.display="none"}};e.addEventListener("timeupdate",o),y(this,n,"f").call(this),b(this,n,function(){e.removeEventListener("timeupdate",o)},"f")};
})()