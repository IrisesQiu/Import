parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"cPXi":[function(require,module,exports) {
"use strict";var e,a,t,r,o,n,i,l;Object.defineProperty(exports,"__esModule",{value:!0}),exports.SEIType=exports.CorePlayerType=exports.ExternalEventType=exports.ApiErrorCode=exports.P2PType=exports.CodecType=exports.FormatType=exports.ProtocolType=void 0,function(e){e.HTTP_HLS="http_hls",e.HTTP_STREAM="http_stream"}(e=exports.ProtocolType||(exports.ProtocolType={})),function(e){e.FLV="flv",e.TS="ts",e.FMP4="fmp4"}(a=exports.FormatType||(exports.FormatType={})),function(e){e.AVC="avc",e.HEVC="hevc"}(t=exports.CodecType||(exports.CodecType={})),function(e){e[e.HLS_NOT_P2P=-1]="HLS_NOT_P2P",e[e.NONE=0]="NONE",e[e.HLS_BILI=1]="HLS_BILI",e[e.FLV_QVB=8]="FLV_QVB"}(r=exports.P2PType||(exports.P2PType={})),function(e){e[e.AreaBlock=6005]="AreaBlock"}(o=exports.ApiErrorCode||(exports.ApiErrorCode={})),function(e){e.Initialized="initialized",e.PlayerStateChange="playerStateChange",e.LiveStateChange="liveStateChange",e.StartPlayRound="startPlayRound",e.VideoStateChange="videoStateChange",e.FullscreenChange="fullscreenChange",e.Playing="playing",e.Paused="paused",e.SwitchLine="switchLine",e.SwitchQuality="switchQuality",e.WebFullscreen="webFullscreen",e.FeedBackClick="feedBackClick",e.BlockSettingClick="blockSettingClick",e.Set="set",e.Reload="reload",e.GuidChange="guidChange",e.InitDanmaku="initDanmaku",e.AddDanmaku="addDanmaku",e.SendDanmaku="sendDanmaku",e.ReceiveOnlineCount="receiveOnlineCount",e.ReceiveMessage="receiveMessage",e.UserLogin="userLogin",e.SendGift="sendGift",e.FirstLoadedAPIPlayer="firstLoadedAPIPlayer",e.FirstLoadedAPIPlayurl="firstLoadedAPIPlayurl",e.FirstLoadStart="firstLoadStart",e.FirstLoadedMetaData="firstLoadedMetaData",e.FirstPlaying="firstPlaying",e.EnterTheRoom="enterTheRoom",e.OperableElementsChange="operableElementsChange",e.AutoPlay="autoPlay",e.SwitchQualityNotLogin="switchQualityNotLogin",e.Recommend="recommend",e.DanmakuMaskChange="danmakuMaskChange",e.DanmakuMaskStatusChange="danmakuMaskStatusChange",e.CtrlVisibleChange="ctrlVisibleChange",e.WebPlayerCreated="webPlayerCreated",e.FirstFrame="FirstFrame",e.SEIData="SEIData",e.VolumeChange="VolumeChange",e.VideoDirectionChange="VideoDirectionChange",e.UserClickPlayIcon="UserClickPlayIcon",e.MergeStream="MergeStream",e.SEIParseData="SEIParseData",e.OrientationChange="OrientationChange",e.UserRedirect="UserRedirect",e.MutePlay="MutePlay",e.NotAutoPlay="NotAutoPlay"}(n=exports.ExternalEventType||(exports.ExternalEventType={})),function(e){e.fMp4Player="fMp4Player",e.Hls7Player="Hls7Player",e.NativePlayer="NativePlayer"}(i=exports.CorePlayerType||(exports.CorePlayerType={})),function(e){e.LIVE_SEI_CHANNEL="LIVE_SEI_CHANNEL",e.BILIMASK__SVGBIN="BILIMASK__SVGBIN",e.B_LIVE_VIBRATION="B_LIVE_VIBRATION",e.LIVE_SEI_PC_LINK="LIVE_SEI_PC_LINK"}(l=exports.SEIType||(exports.SEIType={}));
},{}],"MFFc":[function(require,module,exports) {
"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}var t=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function u(e){try{c(n.next(e))}catch(t){i(t)}}function a(e){try{c(n.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,a)}c((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var r,n,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;u;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,n=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=t.call(e,u)}catch(a){i=[6,a],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function n(t){return t instanceof Error?String(t):"object"===e(t)?JSON.stringify(t,function(e,t){return t instanceof Error?String(t):t}):String(t)}function o(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function i(e){var t=e.buffered;return null==t||0===t.length?0:t.end(t.length-1)-e.currentTime}function u(e){var t,r,n=document.cookie;return null==n?"":null!==(r=null===(t=n.split(";").filter(function(e){return e.trim().length>0}).map(function(e){return e.split("=")}).map(function(e){var t=e[0],r=e[1];return[t.trim(),r.trim()]}).find(function(t){return t[0]===e}))||void 0===t?void 0:t[1])&&void 0!==r?r:""}function a(e,t){var r;if(null!=e){var n=t.querySelector(".web-player-video-cover-img");if(null==n){var o=document.createElement("div");o.classList.add("web-player-video-cover-img-wrap"),o.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n  ";var i=document.createElement("img");i.classList.add("web-player-video-cover-img"),i.style.cssText="\n    max-width: 100%;\n    max-height: 100%;\n  ",i.src=e,o.appendChild(i),t.appendChild(o)}else n.src=e}else null===(r=t.querySelector(".web-player-video-cover-img-wrap"))||void 0===r||r.remove()}function c(e,t){var r=new Set;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];r.has(e)||(r.add(e),t.apply(void 0,n))}}function l(e,t){return"number"!=typeof e?0:Math.round(e*Math.pow(10,t))/Math.pow(10,t)}function s(e,t){var r;return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];if(null==r||Date.now()-r>t)return r=Date.now(),e.apply(this,n)}}function p(e,t){var r;return function(){for(var n=this,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];void 0!==r&&window.clearTimeout(r),r=window.setTimeout(function(){e.apply(n,o)},t)}}function f(e){return t(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return[4,new Promise(function(t){setTimeout(t,e)})];case 1:return[2,t.sent()]}})})}function d(e,t){if(16!==e.length||16!==t.length)return!1;for(var r=0;r<16;++r)if(e[r]!==t[r])return!1;return!0}function x(e){for(var t=new Uint8Array(16),r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return function(e){if(16!==t.length||16!==e.length)return!1;for(var r=0;r<16;++r)if(t[r]!==e[r])return!1;return!0}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadScript=exports.formatTime=exports.isSupportDolby=exports.isWebPSupported=exports.disperseAction=exports.uint8ArrayToString=exports.seiKeyComparator=exports.equalsUuid=exports.sleep=exports.debounce=exports.throttle=exports.roundNumber=exports.runOnlyOnce=exports.coverImg=exports.getCookie=exports.remainBufferLength=exports.uuid=exports.any2Str=void 0,exports.any2Str=n,exports.uuid=o,exports.remainBufferLength=i,exports.getCookie=u,exports.coverImg=a,exports.runOnlyOnce=c,exports.roundNumber=l,exports.throttle=s,exports.debounce=p,exports.sleep=f,exports.equalsUuid=d,exports.seiKeyComparator=x;var m="TextDecoder"in window?new TextDecoder:null;function h(e){return null==m?"":m.decode(e)}function y(e,t){var r=setTimeout(function(){t()},Math.floor(Math.random()*e));return function(){clearTimeout(r)}}exports.uint8ArrayToString=h,exports.disperseAction=y;var v=function(){var e=!1;try{var t=document.createElement("canvas");t.width=1,t.height=1,e=t.toDataURL("image/webp").startsWith("data:image/webp")}catch(r){}return e};exports.isWebPSupported=v;var b=function(){var e=document.createElement("video");return"probably"===e.canPlayType('video/mp4;codecs="ec-3"')&&"probably"===e.canPlayType('video/mp4;codecs="ac-3"')};exports.isSupportDolby=b;var g=function(e){var t=Math.floor(e/3600),r=("0"+Math.floor((e-3600*t)/60)).slice(-2),n=("0"+Math.floor(e%60)).slice(-2);return(0!==t?t.toFixed(0)+":":"")+r+":"+n};function w(e){return t(this,void 0,Promise,function(){var t,n,o;return r(this,function(r){return t=document.createElement("script"),n=document.getElementsByTagName("head")[0],o=new Promise(function(e,r){t.onload=function(){e()},t.onerror=r}),t.src=e,null!=n&&n.appendChild(t),[2,o]})})}exports.formatTime=g,exports.loadScript=w;
},{}],"GlyE":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var i=navigator.userAgent,e={chrome:/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9.]+)/,edg:/Edg\/([0-9._]+)/,safari:/Version\/([0-9._]+).*Safari/},n=i.includes("Windows NT"),r=i.includes("Mac OS X"),t=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod","iOS"].includes(navigator.platform)||i.includes("Mac")&&"ontouchend"in document,o=e.safari.test(i),u=e.chrome.test(i),a=e.edg.test(i),s=function(){function n(e){var n;return Number(null===(n=e.exec(i))||void 0===n?void 0:n[1].split(".")[0])}return u?n(e.chrome):a?n(e.edg):o?n(e.safari):0}();exports.default={isWin:function(){return n},isMac:function(){return r},isIOS:function(){return t},isSafari:function(){return o},isChrome:function(){return u},isEdg:function(){return a},version:function(){return s}};
},{}],"fk22":[function(require,module,exports) {
"use strict";function t(t,e){void 0===e&&(e={});var s=document.createElement(t),n=Object.assign({classname:"",attributes:[],text:"",textAsHtml:!1},e);return s.className=n.classname,s[n.textAsHtml?"innerHTML":"textContent"]=n.text,n.attributes.forEach(function(t){s.setAttribute(t[0],t[1])}),s}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createElement=void 0,exports.createElement=t;
},{}],"Klvu":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.unloading=exports.loading=void 0;var e='\n<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; background: rgba(0, 0, 0, 0.5); border-radius: 10px; display: block; shape-rendering: auto;" width="50px" height="50px" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n<g transform="rotate(0 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.8888888888888888s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(40 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.7777777777777778s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(80 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.6666666666666666s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(120 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.5555555555555556s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(160 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.4444444444444444s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(200 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.3333333333333333s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(240 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.2222222222222222s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(280 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="-0.1111111111111111s" repeatCount="indefinite"></animate>\n  </rect>\n</g><g transform="rotate(320 50 50)">\n  <rect x="47" y="19" rx="3" ry="6" width="6" height="12" fill="#ffffff">\n    <animate attributeName="opacity" values="1;0" keyTimes="0;1" dur="1s" begin="0s" repeatCount="indefinite"></animate>\n  </rect>\n</g>\n</svg>\n';function t(t){t.querySelectorAll(".web-player-loading").forEach(function(e){return e.remove()});var n=document.createElement("div");n.classList.add("web-player-loading"),n.innerHTML=e,n.style.cssText="\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    z-index: 10;\n    display: none;\n    pointer-events: none;\n  ",t.appendChild(n);var i=setTimeout(function(){n.style.display="flex"},500);return function(){clearTimeout(i),n.remove()}}function n(){document.querySelectorAll(".web-player-loading").forEach(function(e){return e.remove()})}exports.loading=t,exports.unloading=n;
},{}],"PFwM":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(a,o){function i(e){try{u(n.next(e))}catch(t){o(t)}}function s(e){try{u(n.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,s)}u((n=n.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var r,n,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ajax=void 0;var n=require("./common-utils"),a="//api.live.bilibili.com",o=new Map,i=new Set;function s(s,u){var c;return t(this,void 0,Promise,function(){var t,l,f,p,h,d,w,b,v,y,m,g,E,x,_,j;return r(this,function(r){switch(r.label){case 0:return t=performance.now(),l=s,/^(https?:)?\/\//.test(s)||(l=a+"/"+s.replace(/^\//,"")),f=new URL(l,location.href),null==(p=o.get(f.host+f.pathname))?[3,2]:p.expiresTime>performance.now()?(h=Math.random()*p.scope,[4,n.sleep(h)]):[3,2];case 1:r.sent(),r.label=2;case 2:""!==(d=n.getCookie("bili_jct"))&&"POST"===(null==u?void 0:u.method)&&null!=(null==u?void 0:u.data)&&(w=new FormData,b=e(e({},null!==(c=u.data)&&void 0!==c?c:{}),{csrf:d,csrf_token:d}),Object.keys(b).forEach(function(e){w.append(e,b[e])}),u.body=w),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,fetch(l,e({credentials:"include"},null!=u?u:{}))];case 4:return v=r.sent(),[3,6];case 5:throw y=r.sent(),m=String(y),i.forEach(function(e){return e("requestErr",{errMsg:m,apiUrl:f.pathname})}),new Error(m);case 6:if(!v.ok)throw g="url: "+s+", status: "+v.status,i.forEach(function(e){return e("responseErr",{errMsg:"status: "+v.status,apiUrl:f.pathname})}),new Error(g);return[4,v.json()];case 7:if(E=r.sent(),i.forEach(function(e){return e("perf",{duration:performance.now()-t,apiUrl:f.pathname})}),"function"==typeof(null==u?void 0:u.handleRes))return u.handleRes(E),[2,E.data];if(x=E.code,_=E.data,j=E.message,0!==x)throw i.forEach(function(e){return e("apiBizErr",{errMsg:j,apiUrl:f.pathname})}),new Error(j);return[2,_]}})})}exports.ajax=s,s.watch=function(e){return i.add(e),function(){i.delete(e)}},s.disperse=function(e,t){var r=/^(https?:)?\/\//.test(e)?e:a+"/"+e.replace(/^\//,"");o.set(r.replace(/^(https?:)?\/\//,""),t)};
},{"./common-utils":"MFFc"}],"hSGw":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.monitorFPS=void 0;var e=[],n=new Set,t=0,r=0,i=[],o=!1,a=0,u=function u(){t++;var c=performance.now(),f=c-r;if(f>=1e3){var l=Math.round(1e3*t/f);if(r=c,t=0,i.push(l),10===(i=i.slice(-10)).length)for(var s=Math.max.apply(Math,i),d=0,v=e;d<v.length;d++){var h=v[d],m=h[0],p=h[1];s<m&&p.forEach(function(e){return e()})}var y=i.reduce(function(e,n){return e+n},0)/i.length;n.forEach(function(e){return e(y)})}o&&(a=requestAnimationFrame(u))};function c(){r=performance.now(),i=[],t=0,cancelAnimationFrame(a),a=requestAnimationFrame(u)}function f(t,r){if("alert"===t.type){var i=e.find(function(e){var n=e[0];return t.threshold===n});null==i&&(i=[t.threshold,new Set],e.push(i),e.sort(function(e,n){return e[0]-n[0]})),i[1].add(r)}else"avg"===t.type&&n.add(r);return o||(o=!0,c()),function(){var i;"alert"===t.type?null===(i=e.find(function(e){return e[0]===t.threshold}))||void 0===i||i[1].delete(r):"avg"===t.type&&n.delete(r),e.map(function(e){return e[1]}).every(function(e){return 0===e.size})&&0===n.size&&(o=!1,cancelAnimationFrame(a))}}document.addEventListener("visibilitychange",function(){"visible"===document.visibilityState&&c()}),exports.monitorFPS=f;
},{}],"JKnM":[function(require,module,exports) {
"use strict";function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(t)}var t=this&&this.__assign||function(){return(t=Object.assign||function(n){for(var t,o=1,e=arguments.length;o<e;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.Level=void 0;var o,e=require("./common");!function(n){n[n.Debug=0]="Debug",n[n.Info=1]="Info",n[n.Warn=2]="Warn",n[n.Error=3]="Error"}(o=exports.Level||(exports.Level={}));var r={printToConsole:!1,debug:f,info:s,warn:a,error:l,dump:y,history:p,watch:b,stringify:v,clear:g},i=[],u=new Set;function c(e,c){var f={content:"object"===n(e)?JSON.stringify(e,function(n,t){return t instanceof Error?t.toString():t}):e,level:c,ts:Date.now()};if(i.push(f),r.printToConsole){var s=o[c].toLowerCase();console[s](e)}setTimeout(function(){u.forEach(function(n){return n(t({},f))})},1)}function f(n){c(n,o.Debug)}function s(n){c(n,o.Info)}function a(n){c(n,o.Warn)}function l(n){e.wpd.Log2Console&&console.error(n),c(n,o.Error)}function p(){return i.slice(0)}function y(){return i.map(function(n){return v(n)}).join("\n")}function g(){i=[]}function b(n){return u.add(n),function(){u.delete(n)}}function v(n,t){var e=Object.assign({tag:!0,time:!0},t),r=new Date(n.ts),i=o[n.level]+" ",u=r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+"."+r.getMilliseconds();return""+(e.tag?i:"")+(e.time?u:"")+"> "+n.content}exports.default=r;
},{"./common":"KGHo"}],"JkDX":[function(require,module,exports) {
"use strict";var t,e=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)},n=this&&this.__classPrivateFieldSet||function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,o=t.length;n<r;n++,o++)t[o]=e[n];return t};Object.defineProperty(exports,"__esModule",{value:!0}),exports.EventBus=void 0;var o=function(){function o(){var n=this;t.set(this,new Map),this.on=function(r,o){var i,a=null!==(i=e(n,t).get(r))&&void 0!==i?i:new Set;return a.add(o),e(n,t).has(r)||e(n,t).set(r,a),function(){a.delete(o),0===a.size&&e(n,t).delete(r)}},this.emit=function(r){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];var a=e(n,t).get(r);null!=a&&a.forEach(function(t){return t.apply(void 0,o)})}}return o.forwardEvent=function(t,e,n){var o=n.map(function(n){var o=Array.isArray(n)?n:[n,n],i=o[0],a=o[1];return t.on(i,function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return e.emit.apply(e,r([a],t))})});return function(){o.forEach(function(t){return t()})}},o.prototype.getHandlers=function(n){var r;return null!==(r=e(this,t).get(n))&&void 0!==r?r:new Set},o.prototype.once=function(t,e){var n=this.on(t,function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];n(),e.apply(void 0,t)});return n},o.prototype.destroy=function(){n(this,t,new Map)},o}();exports.EventBus=o,t=new WeakMap;
},{}],"BEmL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.DebugUrlParamKeys=void 0;var e,o=new URL(location.href).searchParams;!function(e){e.P2PType="wpdP2PType",e.SupportHEVC="wpdSupportHEVC",e.Log2Console="wpdLog2Console",e.SocketMsg2Console="wpdSocketMsg2Console",e.DMRenderType="wpdDMRenderType"}(e=exports.DebugUrlParamKeys||(exports.DebugUrlParamKeys={}));var r=o.get(e.P2PType),p=o.get(e.Log2Console),l=o.get(e.SupportHEVC),s=o.get(e.SocketMsg2Console);exports.default={P2PType:null==r?null:Number(r),Log2Console:null!=p&&"0"!==p,SupportHEVC:null!=l&&"0"!==l,SocketMsg2Console:null!=s&&"0"!==s,DMRenderType:o.get(e.DMRenderType)};
},{}],"wHWR":[function(require,module,exports) {
"use strict";function e(e,t){document.querySelectorAll(".web-player-toast").forEach(function(e){return e.remove()});var n=document.createElement("div");n.classList.add("web-player-toast"),n.textContent=e,n.style.cssText="\n    font-size: 14px;\n    color: #fff;\n    background-color: rgba(0, 0, 0, 0.6);\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    z-index: 11;\n    padding: 6px 12px;\n    border-radius: 6px;\n    transition: opacity 1s;\n  ",t.appendChild(n),setTimeout(function(){n.style.opacity="0"},1500),setTimeout(function(){n.remove()},2500)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"U3yD":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,r=1,a=arguments.length;r<a;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=t(require("./logger")),a="web-player-ui-config",n=0;function u(){var e,t=localStorage.getItem(a+":"+n),u={volume:{value:90,disabled:!1},danmaku:{display:!0,opacity:100,fontScale:100,density:100,area:4,showMaskOption:!1,enableMask:!0}};if(null===t)return u;try{e=JSON.parse(t)}catch(o){return r.default.error(o),u}return e=Object.assign({},u,e)}function o(e){n=e}function i(){return u().danmaku}function l(){return u().volume}function s(t){var r=u();localStorage.setItem(a+":"+n,JSON.stringify(e(e({},r),{volume:t})))}function c(t){var r=u();localStorage.setItem(a+":"+n,JSON.stringify(e(e({},r),{danmaku:t})))}exports.default={getDanmaku:i,getVolume:l,init:o,setDanmaku:c,setVolume:s};
},{"./logger":"JKnM"}],"Qw13":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("./event-bus"),n=new e.EventBus;function t(e,t){return n.on(e,t)}function i(){n.destroy(),n=new e.EventBus}null!=navigator.mediaSession&&(navigator.mediaSession.setActionHandler("pause",function(){n.emit("pause")}),navigator.mediaSession.setActionHandler("play",function(){n.emit("play")})),exports.default={on:t,destroy:i};
},{"./event-bus":"JkDX"}],"KGHo":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,r,t,o){void 0===o&&(o=t),Object.defineProperty(e,o,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,o){void 0===o&&(o=t),e[o]=r[t]}),r=this&&this.__exportStar||function(r,t){for(var o in r)"default"===o||Object.prototype.hasOwnProperty.call(t,o)||e(t,r,o)},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.mediaAction=exports.userSetting=exports.toast=exports.wpd=exports.LogLevel=exports.LogItem=exports.logger=exports.ua=void 0,r(require("./interface"),exports),r(require("./common-utils"),exports);var o=require("./ua");Object.defineProperty(exports,"ua",{enumerable:!0,get:function(){return t(o).default}}),r(require("./create-element"),exports),r(require("./loading"),exports),r(require("./ajax"),exports),r(require("./fps-monitor"),exports);var n=require("./logger");Object.defineProperty(exports,"logger",{enumerable:!0,get:function(){return t(n).default}}),Object.defineProperty(exports,"LogItem",{enumerable:!0,get:function(){return n.LogItem}}),Object.defineProperty(exports,"LogLevel",{enumerable:!0,get:function(){return n.Level}}),r(require("./event-bus"),exports);var u=require("./player-debug");Object.defineProperty(exports,"wpd",{enumerable:!0,get:function(){return t(u).default}});var i=require("./toast");Object.defineProperty(exports,"toast",{enumerable:!0,get:function(){return t(i).default}});var a=require("./user-setting");Object.defineProperty(exports,"userSetting",{enumerable:!0,get:function(){return t(a).default}});var s=require("./media-action");Object.defineProperty(exports,"mediaAction",{enumerable:!0,get:function(){return t(s).default}});
},{"./interface":"cPXi","./common-utils":"MFFc","./ua":"GlyE","./create-element":"fk22","./loading":"Klvu","./ajax":"PFwM","./fps-monitor":"hSGw","./logger":"JKnM","./event-bus":"JkDX","./player-debug":"BEmL","./toast":"wHWR","./user-setting":"U3yD","./media-action":"Qw13"}],"lV3a":[function(require,module,exports) {
var define;
var e;!function(t,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof e&&e.amd?e([],r):"object"==typeof exports?exports.fmp4=r():t.fmp4=r()}(window,function(){return function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t){e.exports={SomeError:function(e,t){this.name=e,this.message=t,this.stack=(new Error).stack},errorAudioInfo:10001,errorVideoInfo:10002,errorAudioTrack:10003,errorVideoTrack:10004,errorUnknownCodec:10005,errorFlvPacket:10006,errorFlvDts:10007,errorNetworkTimeout:11e3,errorNetworkFetch:11001,errorNetworkRead:11002,errorMseOpen:11003,errorMseAppend:11004,errorM3u8Data:11010,errorMp4Data:11011,errorMp4Dts:11012,errorM3u8NotUpdate:11013}},function(e,t){var r=[[0,200,0,128,35,128],[33,0,73,144,2,25,0,35,128],[0,200,0,128,32,132,1,38,64,8,100,0,142],[0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56],[0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56],[0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]],i=[[1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90],[1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10],[1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10]],n=[90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94];function a(e,t,r){for(;t<r;)if(3!==e[t]&&0!==e[t])t+=3;else{if(0===e[t-2]&&0===e[t-1]&&3===e[t])return t-2;t+=1}return null}e.exports={getSilentFrame:function(e,t){switch(e){case 2:if(t>=1&&t<=6)return new Uint8Array(r[t-1]);break;default:if(t>=1&&t<=3)return new Uint8Array(i[t-1].concat(n))}return null},ebsp2rbsp:function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),n=0,o=0;;){var s=a(t,o,r);if(null===s)break;i.set(t.subarray(o,s+2),n),n+=s-o+2,o=s+3}return i.set(t.subarray(o,t.length),n),n+=t.length-o,i.subarray(0,n)},to02uString:function(e){var t=e.toString(10);return t.length<2&&(t="0"+t),t},to02xString:function(e){var t=e.toString(16);return t.length<2&&(t="0"+t),t}}},function(e,t,r){var i=r(3).checkChromeVer,n=r(10).BufferDetector,a=r(11).fMp4Player,o=r(19).Hls7Player,s=r(22).NativePlayer;e.exports={checkChromeVer:i,BufferDetector:n,fMp4Player:a,Hls7Player:o,NativePlayer:s}},function(e,t){var r=void 0;e.exports.checkChromeVer=function(){if(void 0!==r)return r;try{var e=navigator.userAgent,t=e.indexOf("Chrome/");if(t>0){t+=7;var i=e.indexOf(".",t);return-1===i&&(i=e.length),r=parseInt(e.substring(t,i)),console.log("Chrome verion: ".concat(r)),r}}catch(e){console.warn("parse Chrome version failed",e)}return r=0}},function(e,t,r){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n=r(12).MseController,a=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mediaSource=t,this._player=r,this._url=null,this._isOpened=!1,this._isDestroied=!1,this._mimeType=null,this._mseController=null,this._keepUsedBuffer=10,this._timeout=0,this._lastRemovedPos=0,this._firstResponseNotified=!1,this._firstPacketNotified=!1,this._receivedBytes=0,this.startTime=0,this.onFirstResponse=null,this.onFirstPacket=null,this.onMetaData=null,this.onSeiData=null,this.onEndOfStream=null,this.onFileFetched=null,this.onNetworkError=null,this.onParserError=null}var t,r;return t=e,(r=[{key:"destroy",value:function(){this._isDestroied||(this._isDestroied=!0,this._player.src&&URL.revokeObjectURL(this._player.src)),this._mseController&&(this._mseController.destroy(),this._mseController=null),this._isOpened=!1,this._lastRemovedPos=0,this._mimeType=null,this._firstResponseNotified=!1,this._firstPacketNotified=!1,this._receivedBytes=0}},{key:"_notifyNetworkError",value:function(e,t){this.onNetworkError&&!this._isDestroied&&this.onNetworkError(e,t)}},{key:"_notifyParserError",value:function(e,t){this.onParserError&&!this._isDestroied&&this.onParserError(e,t)}},{key:"_onMseError",value:function(e,t){this._notifyParserError(e,{url:this._url,info:t})}},{key:"_setup",value:function(e){this._mseController&&this._mseController.destroy(),this._mseController=new n(this._mediaSource,this.onEndOfStream,this._onMseError.bind(this)),this._lastRemovedPos=0,this._receivedBytes=0,this._isDestroied=!1,this._url=e,this._mediaSource&&(this._mediaSource.createObjectURL?this._player.src=this._mediaSource.createObjectURL(this._player):this._player.src=URL.createObjectURL(this._mediaSource))}},{key:"_ensureMse",value:function(e){this._mimeType=e,e&&!this._isOpened&&this._mseController&&(this._isOpened=this._mseController.addSource(e))}},{key:"_pushBuffer",value:function(e){this._mseController&&this._mseController.pushBuffer(e)}},{key:"_pushEnd",value:function(){this._mseController&&this._mseController.pushEnd()}},{key:"_removeOutdated",value:function(){var e=this._player.currentTime;if(e>this._lastRemovedPos+this._keepUsedBuffer+10){var t=this._lastRemovedPos>10?this._lastRemovedPos-10:0,r=Math.floor(e-this._keepUsedBuffer);this._mseController&&this._mseController.removeBuffer(t,r)&&(this._lastRemovedPos=r)}}},{key:"version",get:function(){}},{key:"buffered",get:function(){var e=this._player.buffered;return e&&e.length>0?e.end(e.length-1)-this._player.currentTime:0}},{key:"mimeType",get:function(){return this._mimeType}},{key:"receivedBytes",get:function(){return this._receivedBytes}},{key:"keepUsedBuffer",set:function(e){this._keepUsedBuffer=e}},{key:"timeout",set:function(e){this._timeout=e}}])&&i(t.prototype,r),e}();e.exports.LivePlayer=a},function(e,t,r){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=r(14),a=r(15),o=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],s=[44100,48e3,32e3,-1],u=function(e,t){return 1===t&&(t=2),"mp4a."+e.toString(16)+(t?"."+t.toString():"")},h=function e(t,r,n,a,o){i(this,e),this.profile=r,this.rate=n,this.channel=a,this.frame=o,this.codecs=u(t,r)},f=function e(t,r,n,a){i(this,e),this.width=t,this.height=r,this.nalu=n,this.codecs=a};e.exports={audioTypeAAC:64,audioTypeMP3:107,getAacCodec:u,parseAudioInfo:function(e,t){if(64===t){if(e.length<2)return null;var r=e[0]>>>3&31,i=(7&e[0])<<1|e[1]>>>7&1,n=e[1]>>3&15;return new h(t,r,o[i],n,1024)}if(107===t){if(e.length<4)return null;var a=e[1]>>>3&3,u=e[1]>>>1&3;if(u<1||u>3)return null;var f,l,c=e[2]>>>2&3,d=3==(e[3]>>>6&3)?1:2;switch(a){case 3:f=s[c];break;case 2:f=s[c]>>>1;break;default:f=s[c]>>>2}switch(u){case 3:l=3===a?1152:576;break;case 2:l=1152;break;default:l=384}return new h(t,0,f,d,l)}return null},parseVideoInfo:function(e,t){var r;if(-7===t)r=new n.AvcParser;else{if(-12!==t)return null;r=new a.HevcParser}if(0!==r.parse(e))return null;var i=r.displaySize;return new f(i.width,i.height,r.nalu,r.codecs)}}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=[0,16,1,2,4,8,32,3,5,10,12,15,47,7,11,13,14,6,9,31,35,37,42,44,33,34,36,40,39,43,45,46,17,18,20,24,19,21,26,28,23,27,29,30,22,25,38,41],n=[47,31,15,0,23,27,29,30,7,11,13,14,39,43,45,46,16,3,5,10,12,19,21,26,28,35,37,42,44,1,2,4,8,17,18,20,24,6,9,22,25,32,33,34,36,40,38,41],a=[15,0,7,11,13,14,3,5,10,12,1,2,4,8,6,9],o=[0,1,2,4,8,3,5,10,12,15,7,11,13,14,6,9],s=function(e){!1===e&&console.warn(e)},u=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._data=t,this._bytes=t.length,this._offsetBits=0,this._offsetBytes=0}var t,u;return t=e,(u=[{key:"moveNextBit",value:function(){++this._offsetBits,this._offsetBits>=8&&(this._offsetBits%=8,this._offsetBytes+1<=this._bytes&&(++this._offsetBytes,this._offsetBytes<this._bytes&&3===this._data[this._offsetBytes]&&this._offsetBytes>1&&0===this._data[this._offsetBytes-1]&&0===this._data[this._offsetBytes-2]&&++this._offsetBytes))}},{key:"getOffset",value:function(){return{bytes:this._offsetBytes,bits:this._offsetBits}}},{key:"setOffset",value:function(e,t){return e>this._bytes||t>8?-1:(this._offsetBits=t,this._offsetBytes=e,0)}},{key:"nextBit",value:function(){return s(this._data&&this._bytes>0),this._offsetBytes>=this._bytes?-1:this._data[this._offsetBytes]>>>7-this._offsetBits&1}},{key:"nextBits",value:function(t){var r=new e(this._data);return r._offsetBits=this._offsetBits,r._offsetBytes=this._offsetBytes,r.readBits(t)}},{key:"readBit",value:function(){if(s(this._data&&this._bytes>0),this._offsetBytes>=this._bytes)return-1;var e=this._data[this._offsetBytes]>>>7-this._offsetBits&1;return this.moveNextBit(),s(0===e||1===e),e}},{key:"readBits",value:function(e){s(e>0&&e<=32);for(var t=0,r=0,i=0;r<e&&-1!==i;r++)i=this.readBit(),s(0===i||1===i),t=t<<1|i;return t}},{key:"readBool",value:function(){return 1===this.readBit()}},{key:"readUe",value:function(){var e,t=-1;for(e=0;!e&&-1!==e;++t)e=this.readBit(),s(0===e||1===e);return e=0,t>0&&(s(t<32),e=this.readBits(t)),(1<<t)-1+e}},{key:"readSe",value:function(){var e=this.readUe();return(e+1)/2*(0==e%2?-1:1)}},{key:"readMe",value:function(e,t){var r=this.readUe();return e?(s(r>=0&&r<48),0!==t?i[r]:n[r]):(s(r>=0&&r<16),0!==t?a[r]:o[r])}},{key:"readTe",value:function(){var e=this.readUe();return 1!==e?e:0!==this.readBit()?0:1}}])&&r(t.prototype,u),e}();e.exports.BitStream=u},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function e(t,r,n,a){i(this,e),this.name=t,this.value=r,this.offset=n,this.end=a},a=function(){function e(){i(this,e);try{this._textDecoder=new TextDecoder}catch(e){this._textDecoder=null,this._fromChar=String.fromCodePoint?String.fromCodePoint:String.fromCharCode}}var t,a;return t=e,(a=[{key:"decodeUtf8",value:function(e){if(this._textDecoder){var t=e.indexOf(0);return-1!==t&&(e=e.subarray(0,t)),this._textDecoder.decode(e)}for(var r=e.length,i="",n=0;n<r;){var a=e[n++];if(0===a)break;var o=0;switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:o=a;break;case 12:case 13:o=(31&a)<<6|63&e[n++];break;case 14:o=(15&a)<<12|(63&e[n++])<<6|(63&e[n++])<<0;break;case 15:o=(7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++]}0!==o&&(i+=this._fromChar(o))}return i}},{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;for(r||(r=e.byteLength-1);t<r;)try{var i=this._parseValue(e,null,t),n=this._parseValue(e,i,i.offset);if(t=n.offset,"onMetaData"===i.value)return n.value}catch(e){console.warn("parse failed",e);break}return null}},{key:"_parseValue",value:function(e,t,r){var i,a=e.getUint8(r++),o=!1;switch(a){case 0:i=e.getFloat64(r),r+=8;break;case 1:i=!!e.getUint8(r),r+=1;break;case 2:case 12:var s=this._parseArray(e,r,12===a);r+=2+s.length,i=this.decodeUtf8(s);break;case 3:i={},r=this._parseObjects(e,r,65535,i);break;case 8:var u=e.getUint32(r);r+=4,i={},r=this._parseObjects(e,r,u,i);break;case 9:i=null,o=!0;break;case 10:var h=e.byteLength-1,f=e.getUint32(r);for(r+=4,i=[];f-- >0&&r<h;){var l=this._parseValue(e,null,r);r=l.offset,i.push(l.value)}break;case 11:i=this._parseDate(e,r),r+=10}return new n(t,i,r,o)}},{key:"_parseArray",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=r?e.getUint32(t):e.getUint16(t);return new Uint8Array(e.buffer,e.byteOffset+t+(r?4:2),i)}},{key:"_parseDate",value:function(e,t){var r=e.getFloat64(t),i=e.getInt16(t+8);return new Date(r+=60*i*1e3)}},{key:"_parseObject",value:function(e,t){var r=this._parseArray(e,t);t+=2+r.length;var i=this.decodeUtf8(r);return this._parseValue(e,i,t)}},{key:"_parseObjects",value:function(e,t,r,i){for(var n=e.byteLength-1;r-- >0&&t<n;){var a=this._parseObject(e,t);if(t=a.offset,a.end)break;i[a.name]=a.value}return t}}])&&r(t.prototype,a),e}();e.exports.AmfParser=a},function(e,t,r){function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=r(1),s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"_readSeiNumber",value:function(e,t){for(var r=0;t.offset<e.byteLength;){var i=e[t.offset];if(t.offset+=1,255!==i)return r+i;r+=255}return null}},{key:"_isEndOfSei",value:function(e,t){return t.offset>=e.byteLength||128===e[t.offset]&&(t.offset+=1,!0)}},{key:"_readSeiMessage",value:function(e,t){var r=this._readSeiNumber(e,t),i=this._readSeiNumber(e,t);if(null!==r&&null!==r){var n=t.offset+i;if(n<e.byteLength){var a={payloadType:r,payloadData:e.subarray(t.offset,n)};return t.offset+=i,a}}return null}},{key:"readSeiMessages",value:function(e){for(var t=[],r={offset:0};!this._isEndOfSei(e,r);){var i=this._readSeiMessage(e,r);if(null===i)break;t.push(i)}return t}},{key:"parse",value:function(t,r,n,a,s,u,h,f){for(var l=r+n,c=r;c+u<l;){for(var d=0,_=0;_<u;_++)d=d<<8|t[c++];var v=c+d;if(v>l||v<=c)break;if((h?t[c++]>>1:31&t[c])==(h?39:6)){var p,y=o.ebsp2rbsp(t.subarray(c+1,v)),m=i(e.readSeiMessages(y));try{for(m.s();!(p=m.n()).done;){var g=p.value;5===g.payloadType&&g.payloadData.length>=16&&f(a,s,g.payloadData.slice(0,16),g.payloadData.slice(16))}}catch(e){m.e(e)}finally{m.f()}}c=v}}}],null&&a(t.prototype,null),r&&a(t,r),e}();e.exports.SeiParser=s},function(e,t,r){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var o=r(0),s=!!window.fetch,u=!!window.ReadableStream,h=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,e),this._callbackMap=new Map,this._onResponse=t,this._onResult=r,this._onError=n}return a(e,[{key:"fetchAsBuffer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(e,r);s?this._doFetch(e,t,"arrayBuffer",i):this._doRequest(e,"arraybuffer",i)}},{key:"fetchAsJson",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(e,r);s?this._doFetch(e,t,"json",i):this._doRequest(e,"json",i)}},{key:"fetchAsText",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=this._setTimeout(e,r);s?this._doFetch(e,t,"text",i):this._doRequest(e,"text",i)}},{key:"fetchAsStream",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(u){var n=this._setTimeout(e,i);fetch(e,r?{}:{cache:"no-store"}).then(function(r){if(void 0===n||t._clearTimeout(n))if(t._onResponse(e,r)&&r.ok){var i=r.body.getReader(),a=[],s=function(r){!r.done&&a[0]?a[0]():a[0]=null,t._onResult(e,r.value,r.done)};a[0]=function(){i.read().then(s).catch(function(r){t._onError(e,o.errorNetworkRead,r)})},a[0]()}else r.body.getReader().cancel()}).catch(function(r){(void 0===n||t._clearTimeout(n))&&t._onError(e,o.errorNetworkFetch,r)})}else this.fetchAsBuffer(e,r,i)}},{key:"_doFetch",value:function(e,t,r,i){var n=this;fetch(e,t?{}:{cache:"no-store"}).then(function(t){(void 0===i||n._clearTimeout(i))&&(n._onResponse(e,t)&&t.ok?t[r]().then(function(t){n._onResult(e,t,!0)}).catch(function(t){n._onError(e,o.errorNetworkRead,t)}):t.body.getReader().cancel())}).catch(function(t){(void 0===i||n._clearTimeout(i))&&n._onError(e,o.errorNetworkFetch,t)})}},{key:"_doRequest",value:function(e,t,r){var i=this,n=new XMLHttpRequest;n.onreadystatechange=function(t){(void 0===r||i._clearTimeout(r))&&2===n.readyState&&(n.ok=n.status>=200&&n.status<=299,i._onResponse(e,n))},n.onload=function(t){n.status>=200&&n.status<=299&&i._onResult(e,n.response,!0)},n.onerror=function(t){(void 0===r||i._clearTimeout(r))&&i._onError(e,n.readyState>2?o.errorNetworkRead:o.errorNetworkFetch,t)},n.open("GET",e),n.responseType=t,n.send()}},{key:"_clearTimeout",value:function(e){return void 0!==e&&(window.clearTimeout(e),this._callbackMap.delete(e))}},{key:"_setTimeout",value:function(e,t){var r=this;if(t>0){var i=[];return i[0]=window.setTimeout(function(){r._callbackMap.delete(i[0]),r._onError(e,o.errorNetworkTimeout,t)},t),this._callbackMap.set(i[0],1),i[0]}}}]),e}(),f=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;i(this,e),this._readDone=!1,this._reader=null,this._onResponse=t,this._onData=r,this._onError=n,this._onDataFetchedBinder=this._onDataFetched.bind(this),this._onReadErrorBinder=this._onReadError.bind(this)}return a(e,[{key:"destroy",value:function(){this._readDone=!0,this._onData=null}},{key:"fetchAsStream",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s={};if(0!=i){var u={};u.Range="bytes=".concat(i,"-")+(n>0?(n-1).toString():""),s.headers=u}r||(s.cache="no-store");var h=a>0?window.setTimeout(function(){t._onError(o.errorNetworkTimeout,a)},a):void 0;fetch(e,s).then(function(e){t._clearTimeout(h),t._reader&&(t._reader.cancel(),t._reader=null),t._onResponse(e)&&e.ok?(t._readDone=!1,t._reader=e.body.getReader(),t._reader.read().then(t._onDataFetchedBinder).catch(t._onReadErrorBinder)):e.body.getReader().cancel()}).catch(function(e){t._clearTimeout(h),t._onError(o.errorNetworkFetch,e)})}},{key:"_onDataFetched",value:function(e){e.done&&(this._reader=null,this._readDone=!0),this._reader&&(this._readDone?(this._reader.cancel(),this._reader=null):this._reader.read().then(this._onDataFetchedBinder).catch(this._onReadErrorBinder)),this._onData&&!this._onData(e.value)&&(this._readDone=!0,this._reader&&(this._reader.cancel(),this._reader=null))}},{key:"_onReadError",value:function(e){this._onError(o.errorNetworkRead,e)}},{key:"_clearTimeout",value:function(e){void 0!==e&&window.clearTimeout(e)}}]),e}();e.exports={Fetcher:h,StreamFetcher:f}},function(e,t){function r(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var i=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this._player=t,this._minBufferMs=r,this._loaded=!1,this._waitCount=0,this._waitDuration=0,this._waiting=!1,this._beginWaitTime=0,this._savedPaused=void 0,this._timer=void 0,this.minWaitMs=100,this._onLoadedDataBinder=this._onLoadedData.bind(this),this._onPlayingBinder=this._onPlaying.bind(this),this._onWaitingBinder=this._onWaiting.bind(this),t.addEventListener("loadeddata",this._onLoadedDataBinder),t.addEventListener("playing",this._onPlayingBinder),t.addEventListener("waiting",this._onWaitingBinder)}var t,i;return t=e,(i=[{key:"destroy",value:function(){this._clearTimer(),this._player.removeEventListener("waiting",this._onWaitingBinder),this._player.removeEventListener("playing",this._onPlayingBinder),this._player.removeEventListener("loadeddata",this._onLoadedDataBinder),this._waitCount=0,this._waitDuration=0}},{key:"_onLoadedData",value:function(e){this._loaded=!0}},{key:"_onPlaying",value:function(e){if(this._waiting){var t=performance.now()-this._beginWaitTime;t>this.minWaitMs&&(this._waitCount++,this._waitDuration+=t),this._waiting=!1}}},{key:"_onWaiting",value:function(e){var t=this;if(this._loaded&&!this._player.seeking){var r=this._player.readyState;if(!(r===HTMLMediaElement.HAVE_ENOUGH_DATA||r===HTMLMediaElement.HAVE_CURRENT_DATA&&this.buffered>=2)&&(this._waiting=!0,this._beginWaitTime=performance.now(),this._savedPaused=void 0,this._clearTimer(),this._minBufferMs>this.minWaitMs)){var i=this._minBufferMs/1e3,n=this._beginWaitTime+this._minBufferMs+1e3;this._timer=window.setInterval(function(){!t._waiting||t.buffered>=i||performance.now()>=n?(t._clearTimer(),!t._savedPaused&&t._player.paused&&t._player.play().then(function(){}).catch(function(e){})):void 0===t._savedPaused&&(t._savedPaused=!!t._player.paused,t._player.pause())},2*this.minWaitMs)}}}},{key:"_clearTimer",value:function(){void 0!==this._timer&&(window.clearInterval(this._timer),this._timer=void 0)}},{key:"buffered",get:function(){var e=this._player.buffered;return e&&e.length>0?e.end(e.length-1)-this._player.currentTime:0}},{key:"waitedCount",get:function(){return this._waitCount}},{key:"waitedDuration",get:function(){return Math.round(this._waitDuration)}}])&&r(t.prototype,i),e}();e.exports.BufferDetector=i},function(e,t,r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,i=f(e);if(t){var n=f(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=r(0),c=r(4),d=r(13),_=r(18).lowerBound,v=r(9).StreamFetcher,p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(u,e);var t,r,i=s(u);function u(e,t){var r;return function(e,t){if(!(e instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=i.call(this,e,t),console.log("fMp4Player ".concat(r.version)),r.maxDuration=30,r.minDuration=10,r.startTime=0,r._contentLength=void 0,r._loader=null,r._readDone=!1,r._readPaused=!1,r._readPosition=0,r._fmp4Muxer=null,r._checkBufferInterval=void 0,r._onCheckBufferBinder=r._onCheckBuffer.bind(h(r)),r._onResponseBinder=r._onResponse.bind(h(r)),r._onDataFetchedBinder=r._onDataFetched.bind(h(r)),r._onDataConvertedBinder=r._onDataConverted.bind(h(r)),r._onMetaDataBinder=r._onMetaDataParsed.bind(h(r)),r._onConvertErrorBinder=r._onConvertError.bind(h(r)),r._onReadErrorBinder=r._onReadError.bind(h(r)),r}return t=u,(r=[{key:"destroy",value:function(){a(f(u.prototype),"destroy",this).call(this),void 0!==this._checkBufferInterval&&(window.clearInterval(this._checkBufferInterval),this._checkBufferInterval=void 0),this._firstPacketNotified=!1,this._readPaused=!1,this._readDone=!0,this._loader&&(this._loader.destroy(),this._loader=null),this._fmp4Muxer&&(this._fmp4Muxer.destroy(),this._fmp4Muxer=null),this._contentLength=void 0}},{key:"createFetcher",value:function(e,t,r){return new v(e,t,r)}},{key:"_fetchUrl",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._contentLength=void 0,this._receivedBytes=0,this._readDone=!1,this._readPaused=!1,this._readPosition=e,this._loader=this.createFetcher(this._onResponseBinder,this._onDataFetchedBinder,this._onReadErrorBinder),this._loader.fetchAsStream(this._url,!1,e,-1,this._timeout)}},{key:"_onDataConverted",value:function(e){this._ensureMse(this._mimeType),this._pushBuffer(e)}},{key:"_onMetaDataParsed",value:function(e){var t=this;if(this._mimeType=this._fmp4Muxer.mimeType,this.onMetaData&&this.onMetaData(e),this._contentLength&&this.startTime>0){var r=e.keyframes;if(r&&r.times&&r.filepositions){var i=_(r.times,this.startTime);if(i>=0&&i<r.filepositions.length){var n=r.filepositions[i];r.times[i]>this.startTime&&i>0&&(n=r.filepositions[--i]),this._fmp4Muxer&&this._fmp4Muxer.reset(),console.log("seek to: ".concat(r.times[i],"/").concat(e.duration,"s, pos=").concat(n));var a=function(){t._seekToPosition(n)};window.Promise?Promise.resolve().then(a):window.setTimeout(a,0)}else console.warn("seek failed: ".concat(this.startTime,"/").concat(e.duration,"s"))}this.startTime=0}}},{key:"_onConvertError",value:function(e,t){this._notifyParserError(e,{url:this._url,info:t})}},{key:"_onReadError",value:function(e,t){this._notifyNetworkError(e,{url:this._url,info:t})}},{key:"_processFetchedData",value:function(e){this._fmp4Muxer?this._fmp4Muxer.input(e):this._onDataConverted(e)}},{key:"_seekToPosition",value:function(e){this._fmp4Muxer&&this._fmp4Muxer.reset(),this._loader&&(this._loader.destroy(),this._loader=null),this._fetchUrl(e)}},{key:"_onDataFetched",value:function(e){return!(this._isDestroied||(!this._firstPacketNotified&&this.onFirstPacket&&(this._firstPacketNotified=!0,this.onFirstPacket()),e?(this._removeOutdated(),this._processFetchedData(e),this._receivedBytes+=e.length,this._readPosition+=e.length):e||(this._readDone=void 0===this._contentLength||this._receivedBytes>=this._contentLength,this._readDone&&this._pushEnd()),this._readDone||this._readPaused))}},{key:"_onResponse",value:function(e){if(this._isDestroied)return!1;if(!e.ok)return this._notifyNetworkError(l.errorNetworkFetch,{url:this._url,status:e.status}),!1;!this._firstResponseNotified&&this.onFirstResponse&&(this._firstResponseNotified=!0,this.onFirstResponse(e));var t=e.headers.get("Content-Length"),r=t?parseInt(t):void 0;void 0===this._contentLength&&(this._contentLength=r),this._contentLength&&void 0===this._checkBufferInterval&&(this._checkBufferInterval=window.setInterval(this._onCheckBufferBinder,500));var i=e.headers.get("Content-Type");return i&&-1!==i.indexOf("video/mp4")?(this._mimeType=i,this._fmp4Muxer=null):null===this._fmp4Muxer&&(this._mimeType=null,this._fmp4Muxer=new d.fMp4Muxer(250,this._onDataConvertedBinder,this._onMetaDataBinder,this.onSeiData,this._onConvertErrorBinder)),!0}},{key:"_onCheckBuffer",value:function(){var e=this.buffered;e<=this.minDuration&&this._readPaused&&this._receivedBytes<this._contentLength?(this._readPaused=!1,this._loader.fetchAsStream(this._url,!1,this._readPosition,-1,this._timeout)):e>=this.maxDuration&&!this._readPaused&&(this._readPaused=!0)}},{key:"version",get:function(){return"v1.40"}},{key:"src",set:function(e){this.destroy(),this._setup(e),this._fetchUrl()}}])&&n(t.prototype,r),u}(c.LivePlayer);e.exports.fMp4Player=p},function(e,t,r){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var n=r(0),a=function(){function e(t,r,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._mediaSource=t,this._onEnded=r,this._onError=i,this._dataList=[],this._mimeType=null,this._sourceOpened=!1,this._sourceBuffer=null,this._eosBuffer=new Uint8Array,this._onSourceOpenBinder=this._onSourceOpen.bind(this),this._onUpdateEndBinder=this._onUpdateEnd.bind(this),t&&t.addEventListener("sourceopen",this._onSourceOpenBinder)}var t,r;return t=e,(r=[{key:"destroy",value:function(){this.removeSource(),this._dataList.length=0,this._mediaSource=null,this._mimeType=null,this._sourceOpened=!1}},{key:"addSource",value:function(e){if(this._mimeType=e,e&&this._sourceOpened&&!this._sourceBuffer)try{this._sourceBuffer=this._mediaSource.addSourceBuffer(e),this._sourceBuffer&&this._sourceBuffer.addEventListener("updateend",this._onUpdateEndBinder)}catch(e){this._onError&&this._onError(n.errorMseOpen,e)}return null!==this._sourceBuffer}},{key:"removeSource",value:function(){this._sourceBuffer&&(this._sourceBuffer.removeEventListener("updateend",this._onUpdateEndBinder,!1),this._mediaSource.removeSourceBuffer(this._sourceBuffer),this._sourceBuffer=null)}},{key:"pushBuffer",value:function(e){this._dataList.push(e),this._onUpdateEnd()}},{key:"pushEnd",value:function(){0!==this._dataList.length||this._sourceBuffer?(this._dataList.push(this._eosBuffer),this._onUpdateEnd()):this._onEnded&&this._onEnded()}},{key:"removeBuffer",value:function(e,t){try{if(!this._sourceBuffer.updating)return this._sourceBuffer.remove(e,t),!0}catch(r){console.warn("remove buffer failed: ".concat(e," -> ").concat(t),r)}return!1}},{key:"_onSourceOpen",value:function(){this._mediaSource&&(this._mediaSource.duration=1/0,this._mediaSource.removeEventListener("sourceopen",this._onSourceOpenBinder),this._sourceOpened=!0,this._mimeType&&this.addSource(this._mimeType))}},{key:"_onUpdateEnd",value:function(){var e=this._sourceBuffer;if(e&&!e.updating){var t=this._dataList;if(t.length){var r=t.shift();try{r===this._eosBuffer?("open"===this._mediaSource.readyState&&this._mediaSource.endOfStream(),this._onEnded&&this._onEnded()):null!==r&&e.appendBuffer(r),r=null}catch(e){"QuotaExceededError"===e.name?r&&t.unshift(r):this._onError&&this._onError(n.errorMseAppend,e)}}}}}])&&i(t.prototype,r),e}();e.exports.MseController=a},function(e,t,r){function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function s(e,t,r){return t&&o(e.prototype,t),r&&o(e,r),e}var u=r(5),h=r(0),f=r(16),l=r(17),c=r(3),d=r(1),_=r(8).SeiParser,v=function(){function e(t,r,i){a(this,e),this.type=t,this.id=r,this.tag=i,this.baseMediaDecodeTime=0,this.extraData=null,this.dataOffset=0,this.duration=0,this.samples=[],this.sequenceDts=null,this.timestampOffset=0,this.totalDuration=0,this.totalSampleCount=0,this.audioInfo=null,this.objectType=0,this.defaultDuration=0,this.maxGapDuration=0,this.videoInfo=null,this.averageDuration=0}return s(e,[{key:"timeScale",get:function(){return null!==this.audioInfo?this.audioInfo.rate:9e4}},{key:"channelCount",get:function(){return null!==this.audioInfo?this.audioInfo.channel:null}},{key:"sampleRate",get:function(){return null!==this.audioInfo?this.audioInfo.rate:null}},{key:"sampleBits",get:function(){return 16}},{key:"width",get:function(){return null!==this.videoInfo?this.videoInfo.width:null}},{key:"height",get:function(){return null!==this.videoInfo?this.videoInfo.height:null}}]),e}(),p=function(){function e(t,r,i,n,o){a(this,e);var s=c.checkChromeVer();this._chrome4x=s>0&&s<=49,this._audioTrackIndex=-1,this._videoTrackIndex=-1,this._lastSegmentDts=0,this._mdatSize=0,this._metaChanged=0,this._metaData={},this._nextTrackId=1,this._onMetaData=i,this._onSegment=r,this._onSeiData=n,this._onError=o,this._parser=new f.FlvParser(this._onSampleReceived.bind(this),this._onMetaDataReceived.bind(this)),this._segmentIsGop=!0,this._segmentDuration=t,this._sequenceNumber=1,this._tracks=[],this._unknownTypes=new Set}return s(e,[{key:"destroy",value:function(){}},{key:"reset",value:function(){this._parser.clear(),this._lastSegmentDts=0,this._mdatSize=0,this._segmentIsGop=!0;var e,t=i(this._tracks);try{for(t.s();!(e=t.n()).done;){var r=e.value;r.samples.length=0,r.dataOffset=0,r.sequenceDts=null,r.timestampOffset=0,r.totalDuration=0,r.totalSampleCount=0}}catch(e){t.e(e)}finally{t.f()}}},{key:"input",value:function(e){try{this._parser.input(e)}catch(e){if(this._onError){var t="DtsError"===e.name?h.errorFlvDts:h.errorFlvPacket;this._onError(t,e.message)}}}},{key:"_addSample",value:function(e,t){e.samples.push(t),e.totalSampleCount++,this._mdatSize+=t.size}},{key:"_onAudioSample",value:function(t){var r=t.dts;if(-1===this._videoTrackIndex&&this._timeToOutput(!1,r)&&this._outputDataSegment(r),this._audioTrackIndex>=0&&this._audioTrackIndex<this._tracks.length){var i=this._tracks[this._audioTrackIndex];if(null===i.sequenceDts&&(i.sequenceDts=r),i.objectType===u.audioTypeAAC){var n=i.audioInfo.rate,a=e._millisecToAudioTs(r,i)-i.totalDuration;if(a>=i.maxGapDuration){var o=a/n;if(o>=30)throw new h.SomeError("DtsError","too large ".concat(o," underflow"));var s=Math.floor(a/i.defaultDuration);for(console.log("insert ".concat(s," frames due to ").concat(o," underflow"));s--;){var f=e._getSilentAacFrame(i,t.data);f.duration=i.defaultDuration,i.totalDuration+=f.duration,this._addSample(i,f)}}else if(a<=-i.maxGapDuration)return void console.log("skip 1 frame due to ".concat(-a/n," overflow"))}t.dts=i.totalDuration,t.duration=i.defaultDuration,i.totalDuration+=t.duration,this._addSample(i,t)}else console.warn("invalid audio track: ".concat(this._audioTrackIndex))}},{key:"_onVideoSample",value:function(t){var r=t.dts,i=1===t.flags;if(this._timeToOutput(i,r)&&(this._outputDataSegment(r),this._segmentIsGop=i),this._videoTrackIndex>=0&&this._videoTrackIndex<this._tracks.length){var n=this._tracks[this._videoTrackIndex];if(null===n.sequenceDts&&(n.sequenceDts=r,0===n.totalSampleCount&&(t.cts=0),t.flags=1),t.cts=Math.floor(90*t.cts),t.dts=e._millisecToVideoTs(r,n),n.samples.length>0){var a=n.samples[n.samples.length-1];a.duration=t.dts>a.dts?t.dts-a.dts:0}n.totalDuration=t.dts,n.totalSampleCount>0&&(n.averageDuration=Math.floor(n.totalDuration/n.totalSampleCount)),t.type!==f.typeVideoH264&&t.type!==f.typeVideoH265||this._parseSeiData(t.data,t.size,t.dts/9e4,t.cts/9e4,n.videoInfo.nalu,t.type===f.typeVideoH265),this._addSample(n,t)}else console.warn("invalid video track: ".concat(this._videoTrackIndex))}},{key:"_onAudioTrack",value:function(t){var r=t.type===f.trackAudioAAC,i=r?u.audioTypeAAC:u.audioTypeMP3,n=u.parseAudioInfo(t.data,i);if(n){if(this._audioTrackIndex>=0&&this._audioTrackIndex<this._tracks.length){var a=this._tracks[this._audioTrackIndex];if(e._same_array(a.extraData,t.data))return;this._outputNow(),a.extraData=t.data,a.audioInfo=n,a.objectType=i,a.defaultDuration=n.frame,a.maxGapDuration=2*a.defaultDuration,e._resetTrackTimestamps(a)}else{var o=l.types.mp4a,s=new v("audio",this._nextTrackId++,o);s.extraData=r?t.data:null,s.audioInfo=n,s.objectType=i,s.defaultDuration=n.frame,s.maxGapDuration=2*s.defaultDuration,this._audioTrackIndex=this._tracks.length,this._tracks.push(s),this._outputNow()}this._metaData.audiosamplerate=n.rate,this._metaData.audiochannel=n.channel,this._metaChanged|=1}else this._onError&&this._onError(h.errorAudioInfo,"parse audio track failed")}},{key:"_onVideoTrack",value:function(t){var r=u.parseVideoInfo(t.data,t.type);if(r){if(this._videoTrackIndex>=0&&this._videoTrackIndex<this._tracks.length){var i=this._tracks[this._videoTrackIndex];if(e._same_array(i.extraData,t.data))return;this._outputNow(),i.extraData=t.data,i.videoInfo=r,e._fixLastVideoDuration(i,0),e._resetTrackTimestamps(i)}else{var n=void 0;switch(t.type){case f.trackVideoH264:n=l.types.avc1;break;case f.trackVideoH265:n=l.types.hvc1}var a=new v("video",this._nextTrackId++,n);a.extraData=t.data,a.videoInfo=r,this._videoTrackIndex=this._tracks.length,this._tracks.push(a),this._outputNow()}this._metaData.width=r.width,this._metaData.height=r.height,this._metaData.fps||(this._metaData.fps=this._metaData.framerate),this._metaChanged|=2}else this._onError&&this._onError(h.errorVideoInfo,"parse video track failed")}},{key:"_onMetaDataReceived",value:function(e){if(e)for(var t in e)this._metaData[t]=e[t]}},{key:"_onSampleReceived",value:function(e){switch(e.type){case f.typeAudioAAC:this._onAudioSample(e);break;case f.typeVideoH264:case f.typeVideoH265:this._onVideoSample(e);break;case f.trackAudioAAC:case f.trackAudioMP3:this._onAudioTrack(e);break;case f.trackVideoH264:case f.trackVideoH265:this._onVideoTrack(e);break;default:this._unknownTypes.has(e.type)||(this._unknownTypes.add(e.type),this._onError&&this._onError(h.errorUnknownCodec,"unknown codec: ".concat(e.type)))}return!0}},{key:"_outputDataSegment",value:function(t){if(this._mdatSize&&this._metaChanged){this._onMetaData&&this._onMetaData(this._metaData),this._metaChanged=0;var r=l.initSegment(this._tracks);this._onSegment(r)}var n=this._tracks;if(this._mdatSize){var a=l.moofSize(n),o=8+this._mdatSize,s=new Uint8Array(a+o);s[a+0]=o>>>24&255,s[a+1]=o>>>16&255,s[a+2]=o>>>8&255,s[a+3]=255&o,s.set(l.types.mdat,a+4);var u,h=a+8,f=i(n);try{for(f.s();!(u=f.n()).done;){var c=u.value;c.samples.length>0&&("video"===c.type&&e._fixLastVideoDuration(c,t),this._chrome4x&&(c.samples[0].flags=1),c.baseMediaDecodeTime=c.samples[0].dts),c.dataOffset=h,h=e._concatenateSamplesData(c,s,h)}}catch(e){f.e(e)}finally{f.f()}var d=l.moof(this._sequenceNumber++,n);s.set(d),this._onSegment(s)}this._lastSegmentDts=t,this._mdatSize=0;var _,v=i(n);try{for(v.s();!(_=v.n()).done;){var p=_.value;p.samples.length=0,p.dataOffset=0}}catch(e){v.e(e)}finally{v.f()}}},{key:"_outputNow",value:function(){this._mdatSize>0&&this._outputDataSegment(this._lastSegmentDts)}},{key:"_parseSeiData",value:function(e,t,r,i,n,a){this._onSeiData&&_.parse(e,0,t,r,r+i,n,a,this._onSeiData)}},{key:"_timeToOutput",value:function(e,t){return!(!e||this._segmentIsGop)||t<this._lastSegmentDts||t>=this._lastSegmentDts+this._segmentDuration}},{key:"mimeType",get:function(){var e,t="",r=i(this._tracks);try{for(r.s();!(e=r.n()).done;){var n=e.value;null!==n.audioInfo?t+=n.audioInfo.codecs+",":null!==n.videoInfo&&(t+=n.videoInfo.codecs+",")}}catch(e){r.e(e)}finally{r.f()}for(;t.length>1&&","===t[t.length-1];)t=t.substring(0,t.length-1);return'video/mp4; codecs="'+t+'"'}}],[{key:"_same_array",value:function(e,t){var r=e?e.length:0;if(r!==(t?t.length:0))return!1;for(var i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}},{key:"_concatenateSamplesData",value:function(e,t,r){var n,a=i(e.samples);try{for(a.s();!(n=a.n()).done;){var o=n.value;t.set(o.data,r),r+=o.size}}catch(e){a.e(e)}finally{a.f()}return r}},{key:"_fixLastVideoDuration",value:function(t,r){if(t.samples.length>0){var i=t.samples[t.samples.length-1];0===i.duration&&(r=e._millisecToVideoTs(r,t),i.duration=r>i.dts?r-i.dts:t.averageDuration>0?t.averageDuration:1500,t.totalDuration+=i.duration)}}},{key:"_getSilentAacFrame",value:function(e,t){var r=d.getSilentFrame(e.audioInfo.profile,e.audioInfo.channel),i=e.totalDuration;return new f.Sample(f.typeAudioAAC,r||t,0,i,0)}},{key:"_millisecToAudioTs",value:function(e,t){return Math.floor((e-t.sequenceDts)*t.audioInfo.rate/1e3)+t.timestampOffset}},{key:"_millisecToVideoTs",value:function(e,t){return 90*(e-t.sequenceDts)+t.timestampOffset}},{key:"_resetTrackTimestamps",value:function(e){e.timestampOffset=e.totalDuration,e.sequenceDts=null}}]),e}();e.exports={fMp4Muxer:p}},function(e,t,r){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var o=r(6).BitStream,s=r(1),u=function(){function e(){i(this,e),this.width=0,this.height=0}return a(e,[{key:"parse",value:function(e){var t=new o(e),r=1,i=this.profile_idc=t.readBits(8),n=t.readBits(8),a=(this.compatibility=n,this.level_idc=t.readBits(8),t.readUe(),0);if((100===i||110===i||122===i||244===i||44===i||83===i||86===i||118===i||128===i||138===i||139===i||134===i||135===i)&&(3===(r=t.readUe())&&(a=t.readBit()),t.readUe(),t.readUe(),t.readBit(),0!==t.readBit()))for(var s=0;s<(3!==r?8:12);s++)t.readBit();t.readUe();var u=t.readUe();if(0===u)t.readUe();else if(1===u){t.readBit(),t.readSe(),t.readSe();var h=t.readUe();for(s=0;s<h;s++)t.readSe()}t.readUe(),t.readBit();var f=t.readUe(),l=t.readUe(),c=t.readBit();0===c&&t.readBit(),t.readBit();var d=t.readBit(),_=0,v=0,p=0,y=0;0!==d&&(_=t.readUe(),v=t.readUe(),p=t.readUe(),y=t.readUe()),t.readBit();var m,g=f+1,b=(l+1)*(2-(0!==c?1:0)),k=0!==c?1:0,w=0!==a?0:r;m=w>3?null:0===w?{dx:1,dy:2-k}:{dx:[0,2,2,1][w],dy:[0,2,1,1][w]*(2-k)};var S=0!==d,B=S?_*m.dx:0,D=S?p*m.dy:0,M=S?v*m.dx:0,T=S?y*m.dy:0;this.width=16*g-M-B,this.height=16*b-T-D}},{key:"displaySize",get:function(){return{width:this.width,height:this.height}}}]),e}(),h=function(){function e(){i(this,e),this.verison=0,this.profile=0,this.compatibility=0,this.level=0,this.nalu=4,this.sps=[]}return a(e,[{key:"parse",value:function(e){var t=e.length;if(t<7)return-1;this.version=e[0],this.profile=e[1],this.compatibility=e[2],this.level=e[3],this.nalu=1+(3&e[4]);var r=31&e[5];if(0===r)return-1;for(var i=6,n=0;n<r&&i+2<t;++n){var a=e[i]<<8|e[i+1];if(a+i+2+1>=t)return-1;try{var o=e.subarray(i+2+1,i+2+a-1),s=new u;s.parse(o),this.sps.push(s),0===n&&(this.profile=s.profile_idc,this.compatibility=-4&s.compatibility,this.level=s.level_idc)}catch(e){console.warn("parse avc-sps error")}i+=a+2}return 0}},{key:"codecs",get:function(){return"avc1."+s.to02xString(this.profile)+s.to02xString(this.compatibility)+s.to02xString(this.level)}},{key:"displaySize",get:function(){var e=this.sps.length?this.sps[0].displaySize:null;return e||(e={width:1280,height:720}),e}}]),e}();e.exports.AvcParser=h},function(e,t,r){function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}var o=r(6).BitStream,s=function(){function e(){i(this,e),this.pic_width_in_luma_samples=0,this.pic_height_in_luma_samples=0}return a(e,[{key:"parse",value:function(e){var t=new o(e);t.readBits(16),t.readBits(4);var r=t.readBits(3);t.readBool(),this.general_profile_space=t.readBits(2),this.general_tier_flag=t.readBool(),this.general_profile_idc=t.readBits(5),this.general_profile_compatibility_flags=t.readBits(32),t.readBool(),t.readBool(),t.readBool(),t.readBool(),t.readBits(32),t.readBits(12),this.general_level_idc=t.readBits(8);for(var i=[],n=[],a=0;a<r;++a)i.push(t.readBool()),n.push(t.readBool());if(r>0)for(a=r;a<8;++a)t.readBits(2);for(a=0;a<r;++a)i[a]&&t.readBits(88),n[a]&&t.readBits(8);t.readUe(),3===t.readUe()&&t.readBool(),this.pic_width_in_luma_samples=t.readUe(),this.pic_height_in_luma_samples=t.readUe()}},{key:"displaySize",get:function(){return{width:this.pic_width_in_luma_samples,height:this.pic_height_in_luma_samples}}}]),e}(),u=function(){function e(){i(this,e),this.general_profile_space=0,this.general_profile_idc=0,this.general_level_idc=0,this.general_tier_flag=0,this.general_profile_compatibility_flags=0,this.nalu=4,this.sps=[]}return a(e,[{key:"parse",value:function(e){var t=e.length;if(t<23)return-1;if(1!==e[0])return-1;this.general_profile_space=e[1]>>6&3,this.general_tier_flag=e[1]>>5&1,this.general_profile_idc=31&e[1],this.general_profile_compatibility_flags=e[2]<<24|e[3]<<16|e[4]<<8|e[5];var r=e[6]<<24|e[7]<<16|e[8]<<8|e[9];r=r<<16|e[10]<<8|e[11],this.general_level_idc=e[12],this.nalu=1+(3&e[21]);for(var i=e[22],n=23,a=0;a<i;a++){if(n+3>e+t)return-1;var o=e[n],u=e[n+1]<<8|e[n+2];n+=3;for(var h=0;h<u;h++){if(n+2>t)return-1;var f=e[n]<<8|e[n+1];if(n+2+f>t)return-1;if(33==(63&o))try{var l=e.subarray(n+2,n+2+f),c=new s;c.parse(l),this.sps.push(c),0==h&&(this.general_profile_compatibility_flags=c.general_profile_compatibility_flags,this.general_profile_space=c.general_profile_space,this.general_profile_idc=c.general_profile_idc,this.general_tier_flag=c.general_tier_flag?1:0,this.general_level_idc=c.general_level_idc)}catch(e){console.warn("parse hevc-sps error")}n+=2+f}}return 0}},{key:"codecs",get:function(){var e=this.general_profile_compatibility_flags;return e=(e=(e=(e=(e=e>>1&1431655765|(1431655765&e)<<1)>>2&858993459|(858993459&e)<<2)>>4&252645135|(252645135&e)<<4)>>8&16711935|(16711935&e)<<8)>>16|e<<16,"hvc1."+["","A","B","C"][this.general_profile_space%4]+this.general_profile_idc.toString()+"."+e.toString(16).toLowerCase()+"."+["L","H"][this.general_tier_flag%2]+this.general_level_idc.toString()}},{key:"displaySize",get:function(){var e=this.sps.length?this.sps[0].displaySize:null;return e||(e={width:1280,height:720}),e}}]),e}();e.exports.HevcParser=u},function(e,t,r){function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=r(7).AmfParser,o=function e(t,r,i,a,o){n(this,e),this.type=t,this.data=r,this.cts=i,this.dts=a,this.duration=0,this.size=r.length,this.flags=o},s=function(){function e(t,r){n(this,e),this._buffer=new Uint8Array(2097152),this._readPos=0,this._writePos=0,this._onSampleParsed=t,this._onMetaDataParsed=r}var t,r,s;return t=e,s=[{key:"_readUint32",value:function(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}}],(r=[{key:"clear",value:function(){this._readPos=0,this._writePos=0}},{key:"input",value:function(e){for(this._writeToBuffer(e);this._parsePacket(););}},{key:"_parseHeader",value:function(){var t=this._writePos-this._readPos;if(t<9)return!1;var r=e._readUint32(this._buffer,this._readPos+5)+4;return!(t<r||(this._readPos+=r,0))}},{key:"_parsePacket",value:function(){var e=this._readPos,t=this._writePos-e;if(t<11)return!1;var r=this._buffer,i=r[e],n=r[e+1]<<16|r[e+2]<<8|r[e+3];if(5002753===n&&70===i)return this._parseHeader();if(n<=0||n>=12582912)throw new RangeError("invalid data size: ".concat(n));var a=11+n+4;if(t<a)return!1;this._readPos+=a;var o=r[e+4]<<16|r[e+5]<<8|r[e+6]|r[e+7]<<24,s=e+11,u=!0;switch(31&i){case 8:u=this._parseAudio(s,n,o);break;case 9:u=this._parseVideo(s,n,o);break;case 18:u=this._parseScript(s,n)}return u}},{key:"_parseAudio",value:function(e,t,r){var i=this._buffer,n=(240&i[e])>>>4;if(10===n){var a=0===i[e+1]?-n:n,s=new o(a,i.subarray(e+2,e+t),0,r,0);return this._onSampleParsed(s)}var u=new o(n,i.subarray(e+1,e+t),0,r,0);return this._onSampleParsed(u)}},{key:"_parseVideo",value:function(e,t,r){var i=this._buffer,n=(240&i[e])>>>4,a=15&i[e];if(7===a||12===a){var s=0===i[e+1]?-a:a,u=i[e+2]<<16|i[e+3]<<8|i[e+4];u=u<<8>>8;var h=new o(s,i.subarray(e+5,e+t),u,r,n);return this._onSampleParsed(h)}var f=new o(a,i.subarray(e+1,e+t),0,r,n);return this._onSampleParsed(f)}},{key:"_parseScript",value:function(e,t){var r=new DataView(this._buffer.buffer,e,t),i=(new a).parse(r);return this._onMetaDataParsed(i),!0}},{key:"_writeToBuffer",value:function(e){var t=e.length;if(this._writePos+t>this._buffer.length){var r=this._writePos-this._readPos,i=Math.max(this._buffer.length,r+2*t),n=new Uint8Array(i);n.set(this._buffer.subarray(this._readPos,this._writePos)),this._buffer=n,this._readPos=0,this._writePos=r}this._buffer.set(e,this._writePos),this._writePos+=t}}])&&i(t.prototype,r),s&&i(t,s),e}();e.exports={typeAudioAAC:10,typeAudioMP3:2,typeVideoH264:7,typeVideoH265:12,trackAudioAAC:-10,trackAudioMP3:-2,trackVideoH264:-7,trackVideoH265:-12},e.exports.Sample=o,e.exports.FlvParser=s},function(e,t){function r(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}var n,a,o,s,u,h,f,l,c,d,_,v,p,y,m,g,b,k,w,S,B,D,M,T,P,x,U,E,A,C,O,I,R,F,L,j,N,q,V,H,z,X=Math.pow(2,32)-1;!function(){for(var e in B={avc1:[97,118,99,49],avcC:[97,118,99,67],btrt:[98,116,114,116],dinf:[100,105,110,102],dref:[100,114,101,102],esds:[101,115,100,115],ftyp:[102,116,121,112],hdlr:[104,100,108,114],hvc1:[104,118,99,49],hvcC:[104,118,99,67],mdat:[109,100,97,116],mdhd:[109,100,104,100],mdia:[109,100,105,97],mfhd:[109,102,104,100],minf:[109,105,110,102],moof:[109,111,111,102],moov:[109,111,111,118],mp4a:[109,112,52,97],mvex:[109,118,101,120],mvhd:[109,118,104,100],pasp:[112,97,115,112],sdtp:[115,100,116,112],smhd:[115,109,104,100],stbl:[115,116,98,108],stco:[115,116,99,111],stsc:[115,116,115,99],stsd:[115,116,115,100],stss:[115,116,115,115],stsz:[115,116,115,122],stts:[115,116,116,115],styp:[115,116,121,112],tfdt:[116,102,100,116],tfhd:[116,102,104,100],traf:[116,114,97,102],trak:[116,114,97,107],trun:[116,114,117,110],trex:[116,114,101,120],tkhd:[116,107,104,100],vmhd:[118,109,104,100]})B[e]=new Uint8Array(B[e]);D=new Uint8Array([105,115,111,109]),T=new Uint8Array([97,118,99,49]),P=new Uint8Array([109,112,52,50]),x=new Uint8Array([100,97,115,104]),M=new Uint8Array([0,0,0,1]),U=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),E=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),A={video:U,audio:E},I=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),O=new Uint8Array([0,0,0,0,0,0,0,0]),R=new Uint8Array([0,0,0,0,0,0,0,0]),F=R,L=R,j=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),N=R,C=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}(),n=function(e){var t,r,i=Array.prototype.slice.call(arguments,1),n=0;for(t=0;t<i.length;t++)n+=i[t].byteLength;for((r=new Uint8Array(n+8))[0]=r.byteLength>>>24&255,r[1]=r.byteLength>>>16&255,r[2]=r.byteLength>>>8&255,r[3]=255&r.byteLength,r.set(e,4),t=0,n=8;t<i.length;t++)r.set(i[t],n),n+=i[t].byteLength;return r},a=function(){return n(B.dinf,n(B.dref,I))},o=function(e){var t=e.extraData?e.extraData.length:0,r=13+(t>0?t+5:0),i=8+r+5+1,a=new Uint8Array([0,0,0,0,3,128|i>>>21,128|i>>>14,128|i>>>7,127&i,0,1,0,4,128|r>>>21,128|r>>>14,128|r>>>7,127&r,e.objectType,21,0,0,0,0,1,89,40,0,1,89,40]),o=0===t?null:new Uint8Array([5,128|t>>>21,128|t>>>14,128|t>>>7,127&t]),s=new Uint8Array([6,128,128,128,1,2]);return t>0?n(B.esds,a,o,e.extraData,s):n(B.esds,a,s)},s=function(){return n(B.ftyp,D,M,D,P,T,x)},m=function(e){return n(B.hdlr,A[e])},y=function(e){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,e.duration>>>24&255,e.duration>>>16&255,e.duration>>>8&255,255&e.duration,85,196,0,0]);return e.sampleRate&&(t[12]=e.sampleRate>>>24&255,t[13]=e.sampleRate>>>16&255,t[14]=e.sampleRate>>>8&255,t[15]=255&e.sampleRate),n(B.mdhd,t)},p=function(e){return n(B.mdia,y(e),m(e.type),h(e))},u=function(e){return n(B.mfhd,new Uint8Array([0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]))},h=function(e){return n(B.minf,"video"===e.type?n(B.vmhd,C):n(B.smhd,O),a(),g(e))},V=function(e){var t=8;t+=16;var i,n=r(e);try{for(n.s();!(i=n.n()).done;){var a=i.value,o=a.samples.length;o>0&&(t+=8,t+=8+(a.defaultDuration?4:0)+16,t+=20,t+=24+o*(a.defaultDuration?4:12))}}catch(e){n.e(e)}finally{n.f()}return t},f=function(e,t){var i=[B.moof];i.push(u(e));var a,o=r(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;s.samples.length>0&&i.push(k(s,0))}}catch(e){o.e(e)}finally{o.f()}return n.apply(null,i)},l=function(e){var t=[B.moov];t.push(d(e.length+1,0));var i,a=r(e);try{for(a.s();!(i=a.n()).done;){var o=i.value;t.push(_(o))}}catch(e){a.e(e)}finally{a.f()}return t.push(c(e)),n.apply(null,t)},c=function(e){var t,i=[B.mvex],a=r(e);try{for(a.s();!(t=a.n()).done;){var o=t.value;i.push(w(o))}}catch(e){a.e(e)}finally{a.f()}return n.apply(null,i)},d=function(e,t){var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(4278190080&t)>>24,(16711680&t)>>16,(65280&t)>>8,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(4278190080&e)>>24,(16711680&e)>>16,(65280&e)>>8,255&e]);return n(B.mvhd,r)},g=function(e){return"video"===e.type?n(B.stbl,b(e),n(B.stts,N),n(B.stss,L),n(B.stsc,F),n(B.stsz,j),n(B.stco,R)):n(B.stbl,b(e),n(B.stts,N),n(B.stsc,F),n(B.stsz,j),n(B.stco,R))},b=function(e){return n(B.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),"video"===e.type?H(e):z(e))},H=function(e){var t=B.avcC;switch(e.tag){case B.avc1:t=B.avcC;break;case B.hvc1:t=B.hvcC}var r=[e.tag,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]),n(t,e.extraData)];if(e.sarRatio){var i=e.sarRatio[0],a=e.sarRatio[1];r.push(n(B.pasp,new Uint8Array([(4278190080&i)>>24,(16711680&i)>>16,(65280&i)>>8,255&i,(4278190080&a)>>24,(16711680&a)>>16,(65280&a)>>8,255&a])))}return n.apply(null,r)},z=function(e){return n(e.tag,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelCount)>>8,255&e.channelCount,(65280&e.sampleBits)>>8,255&e.sampleBits,0,0,0,0,(65280&e.sampleRate)>>8,255&e.sampleRate,0,0]),o(e))},v=function(e){var t=new Uint8Array([0,0,0,3,0,0,0,0,0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,0,(4278190080&e.duration)>>24,(16711680&e.duration)>>16,(65280&e.duration)>>8,255&e.duration,0,0,0,0,0,0,0,0,0,0,0,0,"audio"===e.type?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(65280&e.width)>>8,255&e.width,0,0,(65280&e.height)>>8,255&e.height,0,0]);return n(B.tkhd,t)},k=function(e,t){var r,i,a,o,s,u=e.defaultDuration,h=u?131114:131106,f="audio"===e.type?33554432:16842752;return r=n(B.tfhd,new Uint8Array(u?[0,(16711680&h)>>16,(65280&h)>>8,255&h,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,(4278190080&u)>>24,(16711680&u)>>16,(65280&u)>>8,255&u,f>>>24&255,f>>>16&255,f>>>8&255,255&f]:[0,(16711680&h)>>16,(65280&h)>>8,255&h,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,f>>>24&255,f>>>16&255,f>>>8&255,255&f])),o=Math.floor(e.baseMediaDecodeTime/(X+1)),s=Math.floor(e.baseMediaDecodeTime%(X+1)),i=n(B.tfdt,new Uint8Array([1,0,0,0,o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s])),a=S(e,t),n(B.traf,r,i,a)},_=function(e){return n(B.trak,v(e),p(e))},w=function(e){var t=new Uint8Array([0,0,0,0,(4278190080&e.id)>>24,(16711680&e.id)>>16,(65280&e.id)>>8,255&e.id,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0]);return n(B.trex,t)},S=function(e,t){var r=t+e.dataOffset,i=e.samples,a=i.length,o=e.defaultDuration,s=a>0&&1===i[0].flags,u=new Uint8Array(16+a*(o?4:12)),h=517;o||(h|=2304),u.set([1,(16711680&h)>>16,(65280&h)>>8,255&h,(4278190080&a)>>>24,(16711680&a)>>>16,(65280&a)>>>8,255&a,(4278190080&r)>>>24,(16711680&r)>>>16,(65280&r)>>>8,255&r],0);var f=12;if(u.set(s?[2,0,0,0]:[1,1,0,0],f),f+=4,o)for(var l=0;l<a;l++){var c=i[l].size;u.set([(4278190080&c)>>>24,(16711680&c)>>>16,(65280&c)>>>8,255&c],f),f+=4}else for(l=0;l<a;l++){var d=i[l],_=d.duration,v=d.size,p=d.cts;u.set([(4278190080&_)>>>24,(16711680&_)>>>16,(65280&_)>>>8,255&_,(4278190080&v)>>>24,(16711680&v)>>>16,(65280&v)>>>8,255&v,(4278190080&p)>>>24,(16711680&p)>>>16,(65280&p)>>>8,255&p],f),f+=12}return n(B.trun,u)},q=function(e){var t,r=s(),i=l(e);return(t=new Uint8Array(r.byteLength+i.byteLength)).set(r),t.set(i,r.byteLength),t},e.exports={moof:f,moov:l,types:B,initSegment:q,moofSize:V}},function(e,t){e.exports.lowerBound=function(e,t){for(var r=0,i=e.length;0!=i;){var n=i>>1,a=r+n;e[a]<t?(r=++a,i-=n+1):i=n}return r}},function(e,t,r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=f(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,i=f(e);if(t){var n=f(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?h(e):t}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var l=r(0),c=r(4),d=r(9).Fetcher,_=r(20).fMp4Parser,v=r(21),p=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(u,e);var t,r,i=s(u);function u(e,t){var r;return function(e,t){if(!(e instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=i.call(this,e,t),console.log("Hls7Player ".concat(r.version)),r._playlist=null,r._fetchM3u8Timer=void 0,r._fetchM3u8Binder=r._fetchM3u8.bind(h(r)),r._onM3u8ResponsedBinder=r._onM3u8Responsed.bind(h(r)),r._onM3u8FetchedBinder=r._onM3u8Fetched.bind(h(r)),r._onM3u8FetchErrorBinder=r._onM3u8FetchError.bind(h(r)),r._fetchedM4sCount=0,r._fetchingBegin=0,r._lastFetchM3u8=0,r._lastM3u8Sequence=0,r._lastM3u8Updated=0,r._initDone=!1,r._lastDuration=0,r._totalDuration=0,r._tryM3u8Times=0,r._pendingBuffers=[],r._onM4sResponsedBinder=r._onM4sResponsed.bind(h(r)),r._onM4sFetchedBinder=r._onM4sFetched.bind(h(r)),r._onM4sFetchErrorBinder=r._onM4sFetchError.bind(h(r)),r._mp4Parser=null,r._onM4sParsedBinder=r._onM4sParsed.bind(h(r)),r._m3u8Fetcher=new d(r._onM3u8ResponsedBinder,r._onM3u8FetchedBinder,r._onM3u8FetchErrorBinder),r._m4sFetcher=new d(r._onM4sResponsedBinder,r._onM4sFetchedBinder,r._onM4sFetchErrorBinder),r._savedFetchAsStream=r._m4sFetcher.fetchAsStream,r._minBufferLength=0,r._onPlaylistUpdate=function(e,t){},r}return t=u,(r=[{key:"destroy",value:function(){a(f(u.prototype),"destroy",this).call(this),void 0!==this._fetchM3u8Timer&&(window.clearTimeout(this._fetchM3u8Timer),this._fetchM3u8Timer=void 0),this._fetchedM4sCount=0,this._mp4Parser=null,this._playlist=null,this._initDone=!1,this._lastDuration=0,this._lastM3u8Sequence=0,this._totalDuration=0,this._tryM3u8Times=0,this._pendingBuffers=[]}},{key:"setP2PContext",value:function(e){this._isDestroied||(e?(null!=e.P2PBufferLength&&(this._minBufferLength=e.P2PBufferLength),null!=e.P2PFetchAsStream&&(this._m4sFetcher.fetchAsStream=e.P2PFetchAsStream),null!=e.onPlaylistUpdate&&(this._onPlaylistUpdate=e.onPlaylistUpdate)):(this._minBufferLength=0,this._m4sFetcher.fetchAsStream=this._savedFetchAsStream,this._onPlaylistUpdate=function(e,t){}),this._playlist&&(this._playlist.onPlaylistUpdate=this._onPlaylistUpdate))}},{key:"_doNextFetch",value:function(){var e=this._playlist,t=e.count,r=e.endOfStream;if(0===t&&r)this._pushEnd();else if(t>0&&(r||this._totalDuration<4e3||e.remainDuration>this._minBufferLength))this._fetchNextM4s();else{void 0!==this._fetchM3u8Timer&&(window.clearTimeout(this._fetchM3u8Timer),this._fetchM3u8Timer=void 0);var i=performance.now()-this._lastFetchM3u8,n=Math.round(this._lastDuration-i);this._tryM3u8Times=0,n>=100?this._fetchM3u8Timer=window.setTimeout(this._fetchM3u8Binder,n):this._fetchM3u8()}}},{key:"_fetchM3u8",value:function(){try{this._fetchingBegin=this._lastFetchM3u8=performance.now(),this._m3u8Fetcher.fetchAsText(this._url,!1,2e3)}catch(e){this._notifyNetworkError(l.errorNetworkFetch,{url:this._url,info:e})}}},{key:"_fetchNextM4s",value:function(){var e=null;try{var t=this._playlist.shift();t&&(e=t.uri,this._lastDuration=Math.floor(1e3*t.duration),this._fetchingBegin=performance.now(),this._m4sFetcher.fetchAsStream(e,!1,this._timeout))}catch(t){this._notifyNetworkError(l.errorNetworkFetch,{url:e,info:t})}this._removeOutdated()}},{key:"_onM3u8Responsed",value:function(e,t){return!(this._isDestroied||(304===t.status?(this._isDestroied||this._doNextFetch(),1):t.ok?(!this._firstResponseNotified&&this.onFirstResponse&&(this._firstResponseNotified=!0,this.onFirstResponse(t)),0):(this._playlist&&(this._playlist.endOfStream=!0),this._notifyNetworkError(l.errorNetworkFetch,{url:e,status:t.status}),1)))}},{key:"_onM3u8Fetched",value:function(e,t,r){var i=performance.now(),n=i-this._fetchingBegin,a=this._playlist;if(t&&a){var o=a.parse(t);if(o==v.parsedAsMaster)return this._url=a.streamUrls[0],console.log("stream url: ".concat(this._url)),a.setUrl(this._url),void this._fetchM3u8();if(o<0&&0===a.count)return void this._notifyParserError(l.errorM3u8Data,{url:e,info:o});if(this._lastM3u8Sequence!==a.lastSequence)this._lastM3u8Sequence=a.lastSequence,this._lastM3u8Updated=i;else if(i>=this._lastM3u8Updated+this._timeout)return void this._notifyParserError(l.errorM3u8NotUpdate,{url:e,info:Math.round(i-this._lastM3u8Updated)})}if(a&&a.count>0&&!this._initDone){var s=a.shift();try{new d(this._onM4sResponsedBinder,this._onInitM4sFetched.bind(this),this._onM4sFetchErrorBinder).fetchAsBuffer(s.uri)}catch(e){this._notifyNetworkError(l.errorNetworkFetch,{url:s?s.uri:null,info:e})}}this._isDestroied||(this._doNextFetch(),this._onUrlFetchDone(e,n))}},{key:"_onM3u8FetchError",value:function(e,t,r){t===l.errorNetworkTimeout&&!this._isDestroied&&++this._tryM3u8Times<3?(console.warn("fetch ".concat(this._tryM3u8Times,": ").concat(e," after 1s timeout")),this._fetchM3u8()):this._notifyNetworkError(t,{url:e,info:r})}},{key:"_onM4sResponsed",value:function(e,t){return!(this._isDestroied||!t.ok&&(this._notifyNetworkError(l.errorNetworkFetch,{url:e,status:t.status}),1))}},{key:"_onInitM4sFetched",value:function(e,t,r){var i=performance.now()-this._fetchingBegin;t&&(this._parseM4s(e,t,r),this._receivedBytes+=t.byteLength),r&&(this._initDone=!0,this._fetchedM4sCount++,this._onUrlFetchDone(e,i))}},{key:"_onM4sFetched",value:function(e,t,r){if(!this._isDestroied){!this._firstPacketNotified&&this.onFirstPacket&&(this._firstPacketNotified=!0,this.onFirstPacket());var i=performance.now()-this._fetchingBegin;if(r&&(this._totalDuration+=this._lastDuration,this._doNextFetch()),t){var n=this._pendingBuffers;if(this._initDone){for(;n.length>0;){var a=n.shift();this._parseM4s(a.url,a.buffer,a.done)}this._parseM4s(e,t,r)}else n.push({url:e,buffer:t,done:r});this._receivedBytes+=t.byteLength}r&&(this._fetchedM4sCount++,this._onUrlFetchDone(e,i,this._lastDuration))}}},{key:"_onM4sFetchError",value:function(e,t,r){this._notifyNetworkError(t,{url:e,info:r})}},{key:"_onM4sParsed",value:function(e,t){var r=this._mp4Parser;1836019574===t&&r&&r.metaData&&(this._mimeType=r.mimeType,this.onMetaData&&this.onMetaData(r.metaData)),r&&this._ensureMse(r.mimeType),this._pushBuffer(e)}},{key:"_onUrlFetchDone",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.onFileFetched&&this.onFileFetched(e,{used:Math.round(t),duration:r})}},{key:"_parseM4s",value:function(e,t,r){try{this._mp4Parser&&this._mp4Parser.parse(t,r)}catch(t){var i="DtsError"===t.name?l.errorMp4Dts:l.errorMp4Data;this._notifyParserError(i,{url:e,info:t.message})}}},{key:"version",get:function(){return"v1.80"}},{key:"fetchedM4sCount",get:function(){return this._fetchedM4sCount}},{key:"minBufferLength",set:function(e){this._minBufferLength=e}},{key:"src",set:function(e){this.destroy(),this._setup(e),this._playlist=new v.M3u8Parser,this._playlist.setUrl(this._url),this._playlist.onPlaylistUpdate=this._onPlaylistUpdate,this._mp4Parser=new _(this._onM4sParsedBinder,this.onSeiData),this._fetchM3u8()}}])&&n(t.prototype,r),u}(c.LivePlayer);e.exports.Hls7Player=p},function(e,t,r){function i(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function a(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=r(7).AmfParser,s=r(5),u=r(0),h=r(3),f=r(1),l=r(8).SeiParser,c=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var i=h.checkChromeVer();this._chrome4x=i>0&&i<=49,this.uint32_max=Math.pow(2,32),this.mimeType=null,this.metaData={},this._audioChannel=void 0,this._audioRate=void 0,this._audioCodec=null,this._videoWidth=void 0,this._videoHeight=void 0,this._videoCodec=null,this._videoTag=0,this._videoBaseDts=0,this._videoCtsFixed=!1,this._videoTrackId=void 0,this._videoFrames=[],this._lastMoofSize=void 0,this._lastTrackId=void 0,this._findingStartDts=!1,this._minStartDts=void 0,this._timeScaleMap=new Map,this._buffer=null,this._bytesInBuffer=0,this._onParsed=t,this._onSeiParsed=r,this._parseMoofBoxsBinder=this._parseMoofBoxs.bind(this),this._parseMoovBoxsBinder=this._parseMoovBoxs.bind(this)}var t,r,n;return t=e,n=[{key:"parseEncoder",value:function(e,t){var r=t,i=t+32;e.getUint8(t)<32&&(r++,i--);var n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength).subarray(r,i);return(new o).decodeUtf8(n)}},{key:"parseH264Codec",value:function(e,t){t+=8;var r=e.getUint8(t+1),i=e.getUint8(t+2),n=e.getUint8(t+3);return"avc1."+f.to02xString(r)+f.to02xString(i)+f.to02xString(n)}},{key:"parseH265Codec",value:function(e,t){t+=8;var r=e.getUint8(t+1),i=r>>6&3,n=r>>5&1,a=31&r,o=e.getUint32(t+2),s=e.getUint8(t+12),u=o;return u=(u=(u=(u=(u=u>>>1&1431655765|(1431655765&u)<<1)>>>2&858993459|(858993459&u)<<2)>>>4&252645135|(252645135&u)<<4)>>>8&16711935|(16711935&u)<<8)>>>16|u<<16,"hvc1."+["","A","B","C"][i%4]+a.toString()+"."+u.toString(16).toLowerCase()+"."+["L","H"][n%2]+s.toString()}}],(r=[{key:"clear",value:function(){this._buffer=null,this._bytesInBuffer=0}},{key:"parse",value:function(e,t){var r=0!==this._bytesInBuffer;r&&(this._appendBuffer(new Uint8Array(e)),e=this._buffer.subarray(0,this._bytesInBuffer));for(var i=new Uint8Array(e),n=new DataView(i.buffer),a=i.byteLength,o=0;o+8<=a;){var s=n.getUint32(o),u=o+s;if(u>a)break;var h=n.getUint32(o+4),f=i.subarray(o,u);switch(h){case 1836019558:if(void 0===this._minStartDts&&(this._findingStartDts=!0,this._parseBox(n,o,u,this._parseMoofBoxsBinder),this._findingStartDts=!1),this._lastMoofSize=s,this._lastTrackId=void 0,this._videoFrames.length=0,r)this._parseBox(n,o,u,this._parseMoofBoxsBinder);else{var l=new Uint8Array(f);this._parseBox(new DataView(l.buffer),0,s,this._parseMoofBoxsBinder),f=l}break;case 1836019574:this._lastTrackId=void 0,this._parseBox(n,o,u,this._parseMoovBoxsBinder)&&(this._updateMediaInfo(),this._updateMimeType());break;case 1835295092:this._videoFrames.length&&(this._parseMdatBox(f,s),this._videoFrames.length=0)}this._onParsed(f,h),o=u}r&&0===o||(o>=a?this._bytesInBuffer=0:(this._bytesInBuffer=0,!t&&o<a&&this._appendBuffer(i.subarray(o))))}},{key:"_appendBuffer",value:function(e){var t=this._bytesInBuffer+e.length,r=new Uint8Array(t);this._buffer&&this._bytesInBuffer&&r.set(this._buffer.subarray(0,this._bytesInBuffer),0),this._buffer=r,this._buffer.set(e,this._bytesInBuffer),this._bytesInBuffer=t}},{key:"_parseMoovBoxs",value:function(e,t,r,i){switch(r){case 1836019574:case 1953653099:case 1835297121:case 1835626086:case 1937007212:return this._parseBox(e,t+8,t+i,this._parseMoovBoxsBinder);case 1937011556:this._parseStsdBox(e,t,i);break;case 1835296868:this._parseMdhdBox(e,t,i);break;case 1953196132:this._lastTrackId=e.getUint32(t+8+4+8)}return!0}},{key:"_parseMoofBoxs",value:function(e,t,r,i){switch(r){case 1836019558:case 1953653094:return this._parseBox(e,t+8,t+i,this._parseMoofBoxsBinder);case 1952868452:this._lastTrackId=e.getUint32(t+8+4);break;case 1952867444:this._parseTfdtBox(e,t,i);break;case 1953658222:this._parseTrunBox(e,t,i)}return!0}},{key:"_parseMdhdBox",value:function(e,t,r){t+=12,t+=8,this._timeScaleMap[this._lastTrackId]=e.getUint32(t)}},{key:"_parseStsdBox",value:function(t,r,i){r+=12;var n=t.getUint32(r);if(r+=4,0!==n){t.getUint32(r),r+=4;var a=t.getUint32(r);r+=4;var o=0;switch(a){case 1635148593:case 1752589105:this.metaData.fps=t.getUint32(r+16)/100,this.metaData.videodatarate=t.getUint32(r+20)/1e3,this._videoWidth=t.getUint16(r+24),this._videoHeight=t.getUint16(r+26),this.metaData.encoder=e.parseEncoder(t,r+42),r+=78,(o=t.getUint32(r))>=12?1635148593===a?this._videoCodec=e.parseH264Codec(t,r):1752589105===a&&(this._videoCodec=e.parseH265Codec(t,r)):1635148593===a?this._videoCodec="avc1.64002a":1752589105===a&&(this._videoCodec="hvc1.1.6.L93.90"),this._videoTag=a,this._videoTrackId=this._lastTrackId;break;case 1836069985:this._audioChannel=t.getUint16(r+16),this._audioRate=t.getUint32(r+24)>>>16,r+=28,o=t.getUint32(r),this._audioCodec=o>=10?this._parseAudioCodec(t,r):"mp4a.40.2";break;case 1700998451:this._audioChannel=t.getUint16(r+16),this._audioRate=t.getUint32(r+24)>>>16,this._audioCodec="ec-3"}}}},{key:"_parseTfdtBox",value:function(e,t,r){t+=8;var i=e.getUint8(t);t+=4;var n=1===i?this.getUint64(e,t):e.getUint32(t);if(void 0!==this._lastTrackId){if(this._findingStartDts){var a=n/this._timeScaleMap[this._lastTrackId];return void((this._minStartDts>a||void 0===this._minStartDts)&&(this._minStartDts=a,console.log("track ".concat(this._lastTrackId," start dts: ").concat(a))))}var o=Math.floor(this._minStartDts*this._timeScaleMap[this._lastTrackId]),s=n-o;if(s<0)throw new u.SomeError("DtsError","wrong dts: ".concat(n,"<").concat(o));1===i?this.setUint64(e,t,s):e.setUint32(t,s),this._lastTrackId===this._videoTrackId&&(this._videoBaseDts=s)}}},{key:"_parseTrunBox",value:function(e,t,r){if(this._lastTrackId===this._videoTrackId){t+=8;var i=16777215&e.getUint32(t);this._chrome4x&&4&i&&e.setUint32(t+12,33554432),t+=4;var n=e.getUint32(t);if(t+=4,0!==n){if(!this._videoCtsFixed&&2048&i){var a=t;1&i&&(t+=4),4&i&&(t+=4),256&i&&(t+=4),512&i&&(t+=4),0!==e.getInt32(t)&&e.setInt32(t,0),this._videoCtsFixed=!0,t=a}if(this._onSeiParsed){var o=0;1&i&&(o=e.getUint32(t)-this._lastMoofSize,t+=4),4&i&&(t+=4);for(var s=this._videoBaseDts,u=0;u<n;u++){var h=e.getUint32(t);t+=4;var f=e.getUint32(t);t+=4;var l=e.getInt32(t);t+=4,this._videoFrames.push({dts:s,cts:l,offset:o,size:f}),s+=h,o+=f}}}}}},{key:"_parseMdatBox",value:function(e,t){var r,n=i(this._videoFrames);try{for(n.s();!(r=n.n()).done;){var a=r.value;if(!this._onSeiParsed||a.offset+a.size>t)break;var o=this._timeScaleMap[this._videoTrackId];o=1/(o||9e4);var s=a.dts*o,u=s+a.cts*o;l.parse(e,a.offset,a.size,s,u,4,1752589105===this._videoTag,this._onSeiParsed)}}catch(e){n.e(e)}finally{n.f()}}},{key:"_parseAudioCodec",value:function(e,t){t+=8,t+=4,t+=8,t+=5;var r=e.getUint8(t);if(107==r||105==r)return"mp3";t+=9,this.metaData.audiodatarate=e.getUint32(t)/1e3,t+=4,t+=5;var i=e.getUint8(t)>>>3&31;return s.getAacCodec(r,i)}},{key:"_parseBox",value:function(e,t,r,i){for(;t+8<=r;){var n=e.getUint32(t),a=e.getUint32(t+4);if(t+n>r||!i(e,t,a,n))return!1;t+=n}return t<=r}},{key:"_updateMediaInfo",value:function(){void 0!==this._audioRate&&(this.metaData.audiosamplerate=this._audioRate),void 0!==this._audioChannel&&(this.metaData.audiochannel=this._audioChannel),void 0!==this._videoWidth&&(this.metaData.width=this._videoWidth),void 0!==this._videoHeight&&(this.metaData.height=this._videoHeight)}},{key:"_updateMimeType",value:function(){var e='video/mp4; codecs="';if(this._audioCodec&&this._videoCodec)e+=this._videoCodec+","+this._audioCodec;else if(this._audioCodec)e+=this._audioCodec;else{if(!this._videoCodec)return;e+=this._videoCodec}this.mimeType=e+'"'}},{key:"getUint64",value:function(e,t){var r=e.getUint32(t),i=e.getUint32(t+4);return r*this.uint32_max+i}},{key:"setUint64",value:function(e,t,r){e.setUint32(t,r>=this.uint32_max?Math.floor(r/this.uint32_max):0),e.setUint32(t+4,4294967295&r)}}])&&a(t.prototype,r),n&&a(t,n),e}();e.exports.fMp4Parser=c},function(e,t){function r(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return i(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,a=function(){};return{s:a,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=e[Symbol.iterator]()},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++)i[r]=e[r];return i}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onPlaylistUpdate=function(e,t){},this.endOfStream=!1,this.mimeType=null,this.streamUrls=[],this._initUris=new Set,this._lastSeq=0,this._lastUri=null,this._nextSequence=void 0,this._remainDuration=0,this._totalCount=0,this._totalDuration=0,this._dataUrls=[],this._url=null}var t,i;return t=e,(i=[{key:"setUrl",value:function(e){var t=e.lastIndexOf("/"),r=e.lastIndexOf("?");this._relativePath=e.substring(0,t+1),this._queryParams=r>0?e.substring(r):null,this._url=e,this._initUris.clear(),this._lastSeq=0,this._lastUri=null,this._nextSequence=void 0}},{key:"parse",value:function(e){for(var t=void 0,i=void 0,n=void 0,a=void 0,o=null,s=null,u=0,h=[],f=[],l=this._initUris.size,c=e.length,d=0;d<c;){var _=e.indexOf("\n",d);-1===_&&(_=c);var v=e.substring(d,_);if(d=_+1,0!==v.length)if("#"===v[0]){var p=v.indexOf(":");if(p>0){var y=v.substring(0,p),m=v.substring(p+1);if("#EXTINF"===y){var g=m.lastIndexOf(",");o=-1!==g?m.substring(0,g):m.substring(0),s=-1!==g?m.substring(g+1,m.length):null,u=1}else if("#EXT-X-VERSION"===y)t=parseInt(m.trim());else if("#EXT-X-MEDIA-SEQUENCE"===y)n=i=parseInt(m.trim());else if("#EXT-X-MAP"===y){var b=m.trim();if(b.length<=5||'URI="'!==b.substring(0,5))return console.warn("wrong #EXT-X-MAP: ".concat(m)),-2;var k=(b=b.substring(5)).lastIndexOf('"');b=-1!==k?b.substring(0,k):b.substring(0),this._initUris.has(b)||(h.push({uri:b,duration:this.averageDuration,title:"",seq:void 0}),this._initUris.add(b))}else"#EXT-X-STREAM-INF"===y&&(u=2)}else"#EXT-X-ENDLIST"===v&&(a=!0)}else 1===u?(this._lastSeq=n++,this._lastUri=v.trim(),h.push({uri:this._lastUri,duration:o.trim(),title:s,seq:this._lastSeq}),o=null,s=null,u=0):2===u&&(f.push(v),u=0)}if(this.streamUrls=f,f.length>0)return 1;if(void 0===t||t<6)return console.warn("wrong #EXT-X-VERSION: ".concat(t)),-1;if(void 0!==a&&(this.endOfStream=a),0===this._initUris.size&&!this.endOfStream)return console.warn("missing #EXT-X-MAP URI"),-2;if(this._nextSequence!==n||l!==this._initUris.size){if(void 0===this._nextSequence&&(this._nextSequence=i),this._nextSequence<i&&this._nextSequence+30>=i&&this._lastUri){console.warn("lost sequence: ".concat(this._nextSequence," -> ").concat(i));for(var w=this.averageDuration,S=this._lastSeq.toString(),B=i-1;B>=this._nextSequence;B--){var D=this._lastUri.replace(S,B.toString());h.unshift({uri:D,duration:w})}}var M,T=r(h);try{for(T.s();!(M=T.n()).done;){var P=M.value;(P.seq>=this._nextSequence||void 0===P.seq)&&(P.duration=parseFloat(P.duration),isNaN(P.duration)&&(P.duration=this.averageDuration),this._appendEntry(P))}}catch(e){T.e(e)}finally{T.f()}this._nextSequence<n&&(this._nextSequence=n)}return 0}},{key:"shift",value:function(){var e=this._dataUrls.length>0?this._dataUrls.shift():null;return e&&(this._remainDuration-=e.duration),e}},{key:"_appendEntry",value:function(e){e.uri=this._buildM4sUrl(e.uri),this._dataUrls.push(e),this.onPlaylistUpdate(!1,e),this._remainDuration+=e.duration,this._totalCount++,this._totalDuration+=e.duration}},{key:"_buildM4sUrl",value:function(e){var t=-1!==e.indexOf("://")?e:this._relativePath+e;return null!==this._queryParams&&(-1!==e.indexOf("?")?t+="&"+this._queryParams.substring(1):t+=this._queryParams),t}},{key:"count",get:function(){return this._dataUrls.length}},{key:"averageDuration",get:function(){return this._totalCount>0?this._totalDuration/this._totalCount:0}},{key:"lastSequence",get:function(){return this._nextSequence>0?this._nextSequence-1:0}},{key:"remainDuration",get:function(){return this._remainDuration}}])&&n(t.prototype,i),e}();e.exports={M3u8Parser:a,parsedOk:0,parsedAsMaster:1,parsedErrorVer:-1,parsedErrorInit:-2}},function(e,t,r){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function n(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function a(e,t,r){return(a="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(i){var n=Object.getOwnPropertyDescriptor(i,t);return n.get?n.get.call(r):n.value}})(e,t,r||e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var r,i=h(e);if(t){var n=h(this).constructor;r=Reflect.construct(i,arguments,n)}else r=i.apply(this,arguments);return u(this,r)}}function u(e,t){return!t||"object"!==i(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(u,e);var t,r,i=s(u);function u(e,t){var r;return function(e,t){if(!(e instanceof u))throw new TypeError("Cannot call a class as a function")}(this),r=i.call(this,e,t),console.log("NativePlayer ".concat(r.version)),r}return t=u,(r=[{key:"destroy",value:function(){a(h(u.prototype),"destroy",this).call(this)}},{key:"version",get:function(){return"v1.0"}},{key:"src",set:function(e){this.destroy(),this._player.src=e,0!==this.startTime&&(this._player.currentTime=this.startTime)}}])&&n(t.prototype,r),u}(r(4).LivePlayer);e.exports.NativePlayer=f}])});
},{}],"MwY8":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,a){function i(e){try{c(r.next(e))}catch(t){a(t)}}function u(e){try{c(r.throw(e))}catch(t){a(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(i,u)}c((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(a){return function(u){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=t.call(e,i)}catch(u){a=[6,u],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,u])}}};function n(e){var t;switch(e){case 8:t="7.1Ch";break;case 6:t="5.1Ch";break;case 2:t="Stereo";break;case 1:t="Mono";break;default:t=e+"Ch"}return t}function r(n){var r;return e(this,void 0,Promise,function(){var e,o,a,i;return t(this,function(t){switch(t.label){case 0:return[4,fetch(n)];case 1:return(e=t.sent()).ok&&e.status>=200&&e.status<=299?[4,e.text()]:[3,3];case 2:if(o=t.sent(),(a=o.split("\n")).findIndex(function(e){return"#EXTM3U"===e})>-1&&a.findIndex(function(e){return"#EXT-X-VERSION:3"===e})>-1&&-1!==(i=a.findIndex(function(e){return e.startsWith("#EXT-X-STREAM-INF")})))return[2,null!==(r=a[i+1])&&void 0!==r?r:n];t.label=3;case 3:return[2,n]}})})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.redirectHLSV3=exports.parseAudioChannel=void 0,exports.parseAudioChannel=n,exports.redirectHLSV3=r;
},{}],"ao58":[function(require,module,exports) {
"use strict";var e,t,r,i,n,o,a,s,d,u,l,c,f,h,v=this&&this.__assign||function(){return(v=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},p=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function a(e){try{d(i.next(e))}catch(t){o(t)}}function s(e){try{d(i.throw(e))}catch(t){o(t)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}d((i=i.apply(e,t||[])).next())})},m=this&&this.__generator||function(e,t){var r,i,n,o,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){a.label=o[1];break}if(6===o[0]&&a.label<n[1]){a.label=n[1],n=o;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(o);break}n[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(s){o=[6,s],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}},y=this&&this.__classPrivateFieldSet||function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},w=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},g=this&&this.__spreadArray||function(e,t){for(var r=0,i=t.length,n=e.length;r<i;r++,n++)e[n]=t[r];return e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.checkVideoRate=exports.Video=exports.VideoError=exports.VideoStatus=exports.EventType=void 0;var E,P,b=require("@bilibili-live/fmp4.js"),L=require("@bilibili-live/web-player-common"),k=require("./video-utils");!function(e){e.VideoInfo="VideoInfo",e.MetaData="MetaData",e.CorePlayerCreated="CorePlayerCreated",e.Error="Error",e.LoadStart="LoadStart",e.Ended="Ended",e.NetworkResponse="NetworkResponse",e.FirstPacket="FirstPacket",e.FirstFrame="FirstFrame",e.SEIData="SEIData",e.Destroyed="Destroyed",e.WaitStart="WaitStart",e.WaitEnd="WaitEnd",e.WaitReport="WaitReport",e.Play="Play",e.Pause="Pause",e.WASMDecoderDegrade="WASMDecoderDegrade",e.MutePlay="MutePlay",e.NotAutoPlay="NotAutoPlay",e.FirstFrameTimeout="FirstFrameTimeout"}(E=exports.EventType||(exports.EventType={})),function(e){e.Initialize="Initialize",e.Loading="Loading",e.Playing="Playing",e.Pause="Pause",e.Destroyed="Destroyed"}(P=exports.VideoStatus||(exports.VideoStatus={}));var M,S=0,I={droppedFrames:0,decodedFrames:0,videoBufferLength:0,videoNetworkActivity:0,audioNetworkActivity:0,audioBufferLength:0},T={corePlayerType:L.CorePlayerType.NativePlayer,width:0,height:0,mimeType:"",volume:0,fps:0,encoder:"",videoDataRate:0,audioDataRate:0,audioSampleRate:0,audioChannel:"",videoSrc:""};!function(e){e[e.FirstFrameTimeout=92001]="FirstFrameTimeout"}(M=exports.VideoError||(exports.VideoError={}));var D=function(){function D(p,m){var b,D=this;void 0===m&&(m={}),e.set(this,void 0),t.set(this,void 0),r.set(this,null),i.set(this,void 0),n.set(this,void 0),o.set(this,{mediaInfo:v({},T),realtimeInfo:v({},I)}),a.set(this,null),s.set(this,P.Initialize),d.set(this,[]),u.set(this,void 0),l.set(this,void 0),c.set(this,new L.EventBus),this.on=w(this,c).on,this.once=w(this,c).once,this.emit=function(e){for(var t,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];[E.VideoInfo,E.SEIData].includes(e)||w(D,n).debug("video emit: "+e+", handlers count: "+w(D,c).getHandlers(e).size),(t=w(D,c)).emit.apply(t,g([e],r))},f.set(this,function(){var e=setTimeout(function(){D.emit(E.Error,{type:E.FirstFrameTimeout,code:M.FirstFrameTimeout,errInfo:{url:w(D,t)}})},1e4),r=function(){clearTimeout(e)};return D.once(E.FirstFrame,r),function(){r()}}),h.set(this,function(e){var i,a;w(D,n).info("metadata fired"),w(D,o).mediaInfo=Object.assign({},w(D,o).mediaInfo,{videoSrc:w(D,t),width:e.width,height:e.height,mimeType:null===(i=w(D,r))||void 0===i?void 0:i.mimeType,fps:L.roundNumber(e.fps,0),encoder:null!==(a=e.encoder)&&void 0!==a?a:e.creator,videoDataRate:e.videodatarate,audioDataRate:e.audiodatarate,audioSampleRate:e.audiosamplerate,audioChannel:k.parseAudioChannel(e.audiochannel)}),D.emit(E.VideoInfo,D.getVideoInfo()),D.updateStatisticsInfo()}),y(this,i,S),S+=1,y(this,n,new Proxy(L.logger,{get:function(e,t){return["debug","info","warn","error"].includes(t)?function(r){e[t]("id "+w(D,i)+": "+r)}:e[t]}})),y(this,t,p),y(this,u,m),y(this,e,F(null!==(b=m.wasmDecode)&&void 0!==b&&b)),y(this,l,window.setTimeout(function(){D.load()},1))}return Object.defineProperty(D.prototype,"status",{get:function(){return w(this,s)},set:function(e){w(this,n).info("Video status changed to "+e),y(this,s,e)},enumerable:!1,configurable:!0}),D.prototype.delyLoad=function(){clearTimeout(w(this,l))},D.prototype.load=function(){var r;this.status!==P.Destroyed&&(w(this,n).info("load src: "+w(this,t)+", opts: "+JSON.stringify(w(this,u))),this.status=P.Loading,this.createCorePlayer(w(this,e),null===(r=w(this,u))||void 0===r?void 0:r.startTime),this.play().catch(function(e){L.logger.error(e)}))},D.prototype.play=function(){return p(this,void 0,Promise,function(){return m(this,function(t){switch(t.label){case 0:if(w(this,n).info("video play"),null==w(this,e))return[2];if(this.status===P.Playing)return[2];t.label=1;case 1:return t.trys.push([1,3,,8]),[4,w(this,e).play()];case 2:return t.sent(),this.status=P.Playing,[3,8];case 3:if("NotAllowedError"!==t.sent().name)return[2];w(this,n).warn("try mute play"),w(this,e).muted=!0,t.label=4;case 4:return t.trys.push([4,6,,7]),[4,w(this,e).play()];case 5:return t.sent(),this.status=P.Playing,this.emit(E.MutePlay),[3,7];case 6:return t.sent(),w(this,n).warn("can't auto play"),this.status=P.Pause,this.emit(E.NotAutoPlay),[3,7];case 7:return[3,8];case 8:return[2]}})})},D.prototype.pause=function(){w(this,n).info("video pause"),null!=w(this,e)&&this.status===P.Playing&&(w(this,e).pause(),this.status=P.Pause)},D.prototype.seek=function(t){var r=t.forward,i=t.keepBuffer;if(w(this,n).info("video seek, forward: "+(null!=r?r:"null")+", keepBuffer: "+(null!=i?i:"null")),null!=w(this,e)){var o=L.remainBufferLength(w(this,e));if(!(o<=0))if(null!=i&&i>0){if(o<i)return;w(this,e).currentTime+=o-i}else if(null!=r&&r>0){if(r>o)return;w(this,e).currentTime+=r}}},D.prototype.getSrc=function(){return w(this,t)},D.prototype.volume=function(t){w(this,n).info("video setVolume("+t+")"),null!=w(this,e)&&(w(this,e).volume=L.roundNumber(t,2))},D.prototype.mute=function(t){null!=w(this,e)&&(w(this,e).muted=t)},D.prototype.getVideoEl=function(){return w(this,e)},D.prototype.removeVideoEl=function(){var t,r;w(this,e).remove(),null===(r=(t=w(this,e)).destroy)||void 0===r||r.call(t)},D.prototype.getVideoInfo=function(){return w(this,o).mediaInfo.volume=w(this,e).volume,w(this,o)},D.prototype.capturePic=function(t,r){var i,n,o=null===(n=(i=w(this,e)).toDataURL)||void 0===n?void 0:n.call(i,t,r);return null!=o?o:C(w(this,e),t,r)},D.prototype.destroy=function(t){var i,s;void 0===t&&(t=!1),t||this.removeVideoEl(),this.status!==P.Destroyed&&(this.status=P.Destroyed,w(this,n).info("video destroyed, holdLastFrame: "+t.toString()),clearTimeout(w(this,l)),clearInterval(null!==(i=w(this,a))&&void 0!==i?i:0),y(this,o,{mediaInfo:v({},T),realtimeInfo:v({},I)}),w(this,e).pause(),null===(s=w(this,r))||void 0===s||s.destroy(),w(this,d).forEach(function(e){return null==e?void 0:e()}),this.emit(E.Destroyed),w(this,c).destroy())},D.prototype.createCorePlayer=function(e,i){var n=this;if(null!=w(this,t)){var a,s,l=!0===w(this,u).wasmDecode?new window.BwpMediaSource:null!=window.MediaSource?new window.MediaSource:{},c=new URL(w(this,t));if(c.pathname.endsWith(".flv"))a=new b.fMp4Player(l,e),s=L.CorePlayerType.fMp4Player;else if(c.pathname.endsWith(".m3u8"))!0===w(this,u).forceNativePlayer||null==window.MediaSource?(a=new b.NativePlayer(l,e),s=L.CorePlayerType.NativePlayer):(a=new b.Hls7Player(l,e),s=L.CorePlayerType.Hls7Player);else{if(!c.pathname.endsWith(".mp4"))throw new Error("Unsupported stream url: "+c.pathname);a=new b.NativePlayer(l,e),s=L.CorePlayerType.NativePlayer}w(this,o).mediaInfo=Object.assign({},w(this,o).mediaInfo,{corePlayerType:s}),this.emit(E.LoadStart,{corePlayer:a,videoEl:e,src:w(this,t)}),a.keepUsedBuffer=10,a.timeout=7e3,w(this,d).push(this.bindEvents(a,e),w(this,f).call(this)),null!=i&&i>0&&a instanceof b.fMp4Player&&(a.startTime=i),s===L.CorePlayerType.NativePlayer?k.redirectHLSV3(w(this,t)).then(function(e){a.src=e}).catch(function(e){a.src=w(n,t),L.logger.error(e)}):a.src=w(this,t),y(this,r,a),this.emit(E.CorePlayerCreated,{corePlayer:a,videoEl:e,src:w(this,t)})}},D.prototype.updateStatisticsInfo=function(){var t=this,i=0;null!=w(this,a)&&clearInterval(w(this,a)),y(this,a,window.setInterval(function(){var n,a,s,d=null!==(s=null===(a=null===(n=w(t,e))||void 0===n?void 0:n.getVideoPlaybackQuality)||void 0===a?void 0:a.call(n))&&void 0!==s?s:{},u=d.droppedVideoFrames,l=void 0===u?0:u,c=d.totalVideoFrames,f=void 0===c?0:c,h=0;null!=w(t,r)&&(h=w(t,r).receivedBytes-i,Number.isNaN(h)&&(h=0),i=w(t,r).receivedBytes),w(t,o).realtimeInfo=Object.assign({},w(t,o).realtimeInfo,{droppedFrames:l,decodedFrames:f,videoBufferLength:null==w(t,e)?0:L.roundNumber(L.remainBufferLength(w(t,e)),3),videoNetworkActivity:h}),t.emit(E.VideoInfo,t.getVideoInfo())},1e3))},D.prototype.bindEvents=function(e,t){var r=this,i=performance.now(),a=!1;e.onMetaData=function(e){w(r,h).call(r,e),r.emit(E.MetaData,performance.now()-i),w(r,n).info("after onMetaData mediaInfo: "+JSON.stringify(w(r,o).mediaInfo))},e.onSeiData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];r.emit.apply(r,g([E.SEIData],e))},e.onFileFetched=function(e,t){var i=t.used,o=t.duration,a=2e3;0===o?a=2e3:o<=500&&(a=500),i>a&&w(r,n).warn("fetch slowly: "+e+", cost "+i+"ms, duration: "+o+"ms")},e.onFirstResponse=function(e){r.emit(E.NetworkResponse,e)},e.onEndOfStream=function(){var e=Math.ceil(L.remainBufferLength(t));(e<0||isNaN(e))&&(e=0),w(r,n).warn("video onEndOfStream, bufLen: "+e),setTimeout(function(){t.dispatchEvent(new Event("ended"))},1e3*e)},e.onFirstPacket=function(){var e=performance.now()-i;w(r,n).info("video first packet cost: "+Math.round(e)),r.emit(E.FirstPacket,performance.now()-i)};var s=function(e,t,i){if(!a){a=!0;var o=L.any2Str({code:t,errInfo:i});w(r,n).error("player core "+e+", "+o),r.emit(E.Error,{code:t,errInfo:i}),r.destroy()}};e.onNetworkError=s.bind(this,"NetworkError"),e.onParserError=s.bind(this,"ParserError");var d=function(){var e=performance.now()-i;w(r,n).info("video first frame cost: "+Math.round(e)),r.emit(E.FirstFrame,e)};t.addEventListener("loadeddata",d);var l=function(){a||(a=!0,r.emit(E.Ended),r.destroy())};t.addEventListener("ended",l);var c=function(){if(!a){a=!0;var e=t.error,i={code:90002,errInfo:{code:null==e?void 0:e.code,msg:null==e?void 0:e.message}};w(r,n).error("video native error: "+L.any2Str(i)),r.emit(E.Error,i),r.destroy()}};t.addEventListener("error",c);var f=W(t,e,{startCb:function(){w(r,n).warn("video waiting!, bufferLen: "+L.remainBufferLength(t)),r.emit(E.WaitStart)},endCb:function(){w(r,n).info("video playing"),r.emit(E.WaitEnd)},reportCb:function(e){r.emit(E.WaitReport,e)}}),v=function(){r.emit(E.Play)};t.addEventListener("play",v);var p=function(){r.emit(E.Pause)};t.addEventListener("pause",p);var m=function(){};!0===w(this,u).wasmDecode&&(m=function(){r.emit(E.WASMDecoderDegrade)},t.addEventListener("performance",m));var y=L.mediaAction.on("pause",function(){t.pause()}),P=L.mediaAction.on("play",function(){t.play().catch(function(e){L.logger.error(e)})});return function(){t.removeEventListener("loadeddata",d),t.removeEventListener("ended",l),t.removeEventListener("error",c),t.removeEventListener("play",v),t.removeEventListener("pause",p),t.removeEventListener("performance",m),f(),y(),P()}},D}();function F(e){var t=document.createElement(e?"bwp-video":"video");return t.id="video-"+Math.random().toString().slice(2),t.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1;\n    width: 100%;\n    height: 100%;\n    overflow: hidden;\n  ",t.volume=.9,t.autoplay=!0,t}function W(e,t,r){var i=r.startCb,n=r.endCb,o=r.reportCb,a=!1,s=function t(){a=!0,e.removeEventListener("loadeddata",t)};e.addEventListener("loadeddata",s);var d=!1,u=function t(){e.removeEventListener("progress",t),d&&(d=!1,n())},l=function(){a&&(d=!0,i(),e.addEventListener("progress",u))},c=function(){e.removeEventListener("progress",u),d&&(d=!1,n())};e.addEventListener("waiting",l),e.addEventListener("playing",c);var f=new b.BufferDetector(e,1e3),h=0,v=0,p=0,m=0,y=performance.now(),w=function(){var r=performance.now(),i=t.receivedBytes-m;m=t.receivedBytes,o({count:f.waitedCount-h,duration:Math.round(f.waitedDuration-v),windowSize:Math.round(r-y),playTime:Math.round(e.currentTime-p),playedTime:Math.round(e.currentTime),receivedBytes:i}),h=f.waitedCount,v=f.waitedDuration,p=e.currentTime,y=r},g=window.setInterval(w,6e4),E=function(){w()};return window.addEventListener("beforeunload",E),function(){clearInterval(g),w(),window.removeEventListener("beforeunload",E),e.removeEventListener("playing",c),e.removeEventListener("waiting",l),e.removeEventListener("loadeddata",s),f.destroy()}}function N(e){if(e.videoHeight>e.videoWidth){var t=V(e);return e.insertAdjacentElement("afterend",t),t}return null}function V(e){var t=C(e),r=null;return(r=document.createElement("div")).style.cssText="\n    background-image: url("+t+");\n    background-size: cover;\n    background-position: center;\n    width: 100%;\n    height: 100%;\n    filter: blur(35px);\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    left: 0;\n    right: 0;\n  ",r}function C(e,t,r){var i;void 0===t&&(t="image/jpeg"),void 0===r&&(r=.8);var n=document.createElement("canvas");return n.width=e.videoWidth,n.height=e.videoHeight,null===(i=n.getContext("2d"))||void 0===i||i.drawImage(e,0,0,n.width,n.height),n.toDataURL(t,r)}exports.Video=D,e=new WeakMap,t=new WeakMap,r=new WeakMap,i=new WeakMap,n=new WeakMap,o=new WeakMap,a=new WeakMap,s=new WeakMap,d=new WeakMap,u=new WeakMap,l=new WeakMap,c=new WeakMap,f=new WeakMap,h=new WeakMap,exports.checkVideoRate=N;
},{"@bilibili-live/fmp4.js":"lV3a","@bilibili-live/web-player-common":"KGHo","./video-utils":"MwY8"}],"uCDP":[function(require,module,exports) {
"use strict";var t,e,n,o,r,i,a,l,c,s,u,p,h,d,f,y,v,T,P,_,C,w,m,S,g=this&&this.__assign||function(){return(g=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},M=this&&this.__classPrivateFieldSet||function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},H=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var k=require("@bilibili-live/web-player-common"),L=1800,E=function(){function E(E){var W=this;this.source=E,t.set(this,{report_interval_sec:30}),e.set(this,k.P2PType.NONE),n.set(this,void 0),o.set(this,"0"),r.set(this,[]),i.set(this,k.CodecType.AVC),a.set(this,""),l.set(this,[]),c.set(this,void 0),s.set(this,null),u.set(this,0),p.set(this,0),h.set(this,performance.now()),d.set(this,L),f.set(this,new k.EventBus),y.set(this,""),this.on=H(this,f).on,this.once=H(this,f).once,v.set(this,H(this,f).emit),T.set(this,function(t){if(0!==H(W,p))return H(W,e);var n=null!=t?t:W.source.playurl.p2p_data.p2p_type;return null!=k.wpd.P2PType&&(n=k.wpd.P2PType),null==window.MediaSource&&(n=k.P2PType.NONE),n!==k.P2PType.HLS_BILI&&n!==k.P2PType.HLS_NOT_P2P||W.hasHLSPlayerSupportStream()||(n=k.P2PType.NONE),n in k.P2PType||(n=k.P2PType.NONE),n}),P.set(this,function(t){return navigator.userAgent.includes("PlayStation")?[k.FormatType.TS]:t===k.ProtocolType.HTTP_STREAM?[k.FormatType.FLV]:null!=window.MediaSource||k.ua.isIOS()?[k.FormatType.FMP4,k.FormatType.TS]:[k.FormatType.TS]}),_.set(this,function(t){for(var e,n,o=H(W,P).call(W,t),r=null,i=0,a=o;i<a.length;i++){var l=a[i];if(null!=(r=H(W,w).call(W,{protocol:t,format:l,codec:k.CodecType.AVC})))break}for(var c=null,s=0,u=o;s<u.length;s++){l=u[s];if(null!=(c=H(W,w).call(W,{protocol:t,format:l,codec:k.CodecType.HEVC})))break}var p=H(W,S).call(W,null!==(e=null==r?void 0:r.accept_qn)&&void 0!==e?e:[],null!==(n=null==c?void 0:c.accept_qn)&&void 0!==n?n:[]),h=p.hevcAcceptQn,d=p.avcAcceptQn;return null!=c&&(c.accept_qn=h),null!=r&&(r.accept_qn=d),{avcCodec:r,hevcCodec:c}}),C.set(this,function(t,n){if(t===k.ProtocolType.HTTP_HLS){if(![k.P2PType.HLS_BILI,k.P2PType.HLS_NOT_P2P,k.P2PType.NONE].includes(H(W,e)))return!0}else if(t===k.ProtocolType.HTTP_STREAM&&[k.P2PType.HLS_BILI,k.P2PType.HLS_NOT_P2P].includes(H(W,e)))return!0;return!1}),w.set(this,function(t){var e,n,o,r=t.protocol,i=t.format,a=t.codec,l=null===(o=null===(n=null===(e=W.source.playurl.stream.find(function(t){return t.protocol_name===r}))||void 0===e?void 0:e.format)||void 0===n?void 0:n.find(function(t){return t.format_name===i}))||void 0===o?void 0:o.codec.find(function(t){var e=t.codec_name;return a===e});return null!=l?g(g({},l),{protocol:r,format:i}):null}),m.set(this,function(t,e){void 0===e&&(e=[]);var o=t.map(function(t){var e;return{code:t,value:String(t),label:null===(e=H(W,n).find(function(e){return e.qn===t}))||void 0===e?void 0:e.desc,codec:k.CodecType.AVC}}).filter(function(t){var e=t.label;return Boolean(e)}),r=(null!=e?e:[]).map(function(t){var e;return{code:t,value:String(t),label:null===(e=H(W,n).find(function(e){return e.qn===t}))||void 0===e?void 0:e.desc}}).filter(function(t){var e=t.label;return Boolean(e)}).map(function(t){var e=t.code,n=t.value,o=t.label;return{code:e,value:n+"_hevc",label:(null!=o?o:"")+"PRO",codec:k.CodecType.HEVC}});return o.concat(r).sort(function(t,e){return e.code+(e.codec===k.CodecType.HEVC?1:0)-(t.code+(t.codec===k.CodecType.HEVC?1:0))})}),S.set(this,function(t,e){var n=W.source.playurl.dolby_qn;return null!=n&&(t=t.filter(function(t){return t!==n[0]})),null!=n&&k.isSupportDolby()?{hevcAcceptQn:e,avcAcceptQn:t=t.concat(n)}:{hevcAcceptQn:e,avcAcceptQn:t}});try{M(this,t,JSON.parse(E.conf_json))}catch(b){k.logger.error(b)}M(this,n,E.playurl.g_qn_desc),M(this,e,H(this,T).call(this)),null!=window.MediaSource?M(this,c,[k.P2PType.HLS_BILI,k.P2PType.HLS_NOT_P2P].includes(H(this,e))?k.ProtocolType.HTTP_HLS:k.ProtocolType.HTTP_STREAM):M(this,c,k.ProtocolType.HTTP_HLS),this.useStream()}return E.prototype.getCurPlayUrl=function(){if(performance.now()>H(this,h)+1e3*H(this,d))throw new Error("source data is expired");return H(this,a)},E.prototype.getCurStreamInfo=function(){var t,n,r=new URL(H(this,a)),l=null!==(n=null===(t=/\/live-bvc\/\d+\/(live_.+?)[/.]/.exec(H(this,a)))||void 0===t?void 0:t[1])&&void 0!==n?n:"";return{host:r.host,query:r.search,name:l,protocol:H(this,c),format:H(this,s),codec:H(this,i),p2pType:H(this,e),quality:H(this,o),timeshift:H(this,p),curAttrName:H(this,y)}},E.prototype.getCurQuality=function(){return H(this,o)},E.prototype.getQualityDesc=function(t){var e,n=null!=t?t:H(this,o);return null!==(e=H(this,r).find(function(t){return t.value===n}))&&void 0!==e?e:null},E.prototype.getCurLine=function(){return H(this,u)},E.prototype.getCurLineDesc=function(){var t=this;return this.getLineCandidates().find(function(e){return e.value===H(t,u)})},E.prototype.setTimeShift=function(t){M(this,p,t)},E.prototype.setCurLine=function(t){if(0===H(this,l).length)throw new Error("play url candidates is empty");M(this,u,t%this.getLineCandidates().length);var e=H(this,l)[H(this,u)%H(this,l).length];M(this,a,e.url),M(this,d,e.ttl>1?e.ttl:L)},E.prototype.getPlayUrlCandates=function(){return H(this,l)},E.prototype.getCurCodecType=function(){return H(this,i)},E.prototype.getCurP2PType=function(){return H(this,e)},E.prototype.getDynamicConfig=function(){return H(this,t)},E.prototype.getQnCandidates=function(){return H(this,r)},E.prototype.getAVCQnCandidates=function(){return this.getQnCandidates().filter(function(t){return t.codec===k.CodecType.AVC})},E.prototype.getLineCandidates=function(){return[{value:0,label:"主线"},{value:1,label:"备线1"},{value:2,label:"备线2"},{value:3,label:"备线3"}]},E.prototype.setCurP2PType=function(t){M(this,e,t)},E.prototype.hasHLSPlayerSupportStream=function(){return Boolean(H(this,w).call(this,{protocol:k.ProtocolType.HTTP_HLS,format:k.FormatType.FMP4,codec:k.CodecType.AVC}))},E.prototype.useStream=function(t){var n,h,f;void 0===t&&(t={});var v,P,w=null!==(n=t.protocol)&&void 0!==n?n:H(this,c),S=null!==(h=t.codec)&&void 0!==h?h:H(this,i),g=H(this,_).call(this,w),E=g.avcCodec,W=g.hevcCodec;if(null==E||0===(null!==(f=E.url_info)&&void 0!==f?f:[]).length)throw new Error("can't find stream by protocol: "+w+", codec: "+(null!=S?S:""));null!=(null==W?void 0:W.url_info)&&S===k.CodecType.HEVC?(v=W,P=k.CodecType.HEVC):(v=E,P=k.CodecType.AVC);var b=v.url_info.map(function(t){var e,n=t.host,o=t.extra,r=t.stream_ttl;return{url:""+n+v.base_url+o,ttl:r,attr_name:null!==(e=v.attr_name)&&void 0!==e?e:""}});if(0===b.length)throw new Error("play url codec.hosts is empty");var A=H(this,u)%b.length;M(this,y,b[A].attr_name),M(this,a,b[A].url),M(this,d,b[A].ttl>1?b[A].ttl:L),0!==H(this,p)&&M(this,a,H(this,a)+"&tmshift="+H(this,p)),M(this,s,v.format),M(this,i,P),M(this,c,w),M(this,e,H(this,T).call(this,t.expectP2PType)),M(this,r,H(this,m).call(this,E.accept_qn,null==W?void 0:W.accept_qn)),M(this,o,v.current_qn+(P===k.CodecType.HEVC?"_"+k.CodecType.HEVC:"")),M(this,l,b),H(this,C).call(this,w,H(this,e))&&M(this,e,k.P2PType.NONE)},E}();exports.default=E,t=new WeakMap,e=new WeakMap,n=new WeakMap,o=new WeakMap,r=new WeakMap,i=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,s=new WeakMap,u=new WeakMap,p=new WeakMap,h=new WeakMap,d=new WeakMap,f=new WeakMap,y=new WeakMap,v=new WeakMap,T=new WeakMap,P=new WeakMap,_=new WeakMap,C=new WeakMap,w=new WeakMap,m=new WeakMap,S=new WeakMap;
},{"@bilibili-live/web-player-common":"KGHo"}],"MW6F":[function(require,module,exports) {
var global = arguments[3];
var t=arguments[3];function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?s(t):e}function c(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}();return function(){var n,i=l(t);if(e){var o=l(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return u(this,n)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var n=[],i=!0,o=!1,r=void 0;try{for(var l,a=t[Symbol.iterator]();!(i=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==a.return||a.return()}finally{if(o)throw r}}return n}}(t,e)||p(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t){return function(t){if(Array.isArray(t))return v(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||p(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){if(t){if("string"==typeof t)return v(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(t,e):void 0}}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function m(){}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var h=function(t){return t};function g(t){return t()}function x(){return Object.create(null)}function y(t){t.forEach(g)}function b(t){return"function"==typeof t}function w(t,n){return t!=t?n==n:t!==n||t&&"object"===e(t)||"function"==typeof t}function C(t,e,n,i){return t[1]&&i?function(t,e){for(var n in e)t[n]=e[n];return t}(n.ctx.slice(),t[1](i(e))):n.ctx}function $(t,n,i,o,r,l,a){var s=function(t,n,i,o){if(t[2]&&o){var r=t[2](o(i));if(void 0===n.dirty)return r;if("object"===e(r)){for(var l=[],a=Math.max(n.dirty.length,r.length),s=0;s<a;s+=1)l[s]=n.dirty[s]|r[s];return l}return n.dirty|r}return n.dirty}(n,o,r,l);if(s){var u=C(n,i,o,a);t.p(u,s)}}function k(t){return null==t?"":t}var L="undefined"!=typeof window,S=L?function(){return window.performance.now()}:function(){return Date.now()},M=L?function(t){return requestAnimationFrame(t)}:m,z=new Set;function q(t){z.forEach(function(e){e.c(t)||(z.delete(e),e.f())}),0!==z.size&&M(q)}function F(t,e){t.appendChild(e)}function H(t,e,n){t.insertBefore(e,n||null)}function _(t){t.parentNode.removeChild(t)}function E(t,e){for(var n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function V(t){return document.createElement(t)}function T(t){return document.createTextNode(t)}function Z(){return T(" ")}function j(){return T("")}function P(t,e,n,i){return t.addEventListener(e,n,i),function(){return t.removeEventListener(e,n,i)}}function B(t){return function(e){return e.preventDefault(),t.call(this,e)}}function I(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function R(t,e,n){null==n?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function A(t){return Array.from(t.childNodes)}function O(t,e){e=""+e,t.wholeText!==e&&(t.data=e)}function G(t,e){t.value=null==e?"":e}function X(t,e,n,i){t.style.setProperty(e,n,i?"important":"")}function Y(t,e,n){t.classList[n?"add":"remove"](e)}var N,U=new Set,D=0;function W(t){for(var e=5381,n=t.length;n--;)e=(e<<5)-e^t.charCodeAt(n);return e>>>0}function J(t,e,n,i,o,r,l){for(var a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,s=16.666/i,u="{\n",c=0;c<=1;c+=s){var d=e+(n-e)*r(c);u+=100*c+"%{".concat(l(d,1-d),"}\n")}var f=u+"100% {".concat(l(n,1-n),"}\n}"),p="__svelte_".concat(W(f),"_").concat(a),v=t.ownerDocument;U.add(v);var m=v.__svelte_stylesheet||(v.__svelte_stylesheet=v.head.appendChild(V("style")).sheet),h=v.__svelte_rules||(v.__svelte_rules={});h[p]||(h[p]=!0,m.insertRule("@keyframes ".concat(p," ").concat(f),m.cssRules.length));var g=t.style.animation||"";return t.style.animation="".concat(g?"".concat(g,", "):"").concat(p," ").concat(i,"ms linear ").concat(o,"ms 1 both"),D+=1,p}function K(t,e){var n=(t.style.animation||"").split(", "),i=n.filter(e?function(t){return t.indexOf(e)<0}:function(t){return-1===t.indexOf("__svelte")}),o=n.length-i.length;o&&(t.style.animation=i.join(", "),(D-=o)||M(function(){D||(U.forEach(function(t){for(var e=t.__svelte_stylesheet,n=e.cssRules.length;n--;)e.deleteRule(n);t.__svelte_rules={}}),U.clear())}))}function Q(t){N=t}function tt(){if(!N)throw new Error("Function called outside component initialization");return N}function et(t){tt().$$.on_mount.push(t)}function nt(t){tt().$$.on_destroy.push(t)}var it=[],ot=[],rt=[],lt=[],at=Promise.resolve(),st=!1;function ut(t){rt.push(t)}function ct(t){lt.push(t)}var dt,ft=!1,pt=new Set;function vt(){if(!ft){ft=!0;do{for(var t=0;t<it.length;t+=1){var e=it[t];Q(e),mt(e.$$)}for(Q(null),it.length=0;ot.length;)ot.pop()();for(var n=0;n<rt.length;n+=1){var i=rt[n];pt.has(i)||(pt.add(i),i())}rt.length=0}while(it.length);for(;lt.length;)lt.pop()();st=!1,ft=!1,pt.clear()}}function mt(t){if(null!==t.fragment){t.update(),y(t.before_update);var e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(ut)}}function ht(t,e,n){var i,o;t.dispatchEvent((i="".concat(e?"intro":"outro").concat(n),(o=document.createEvent("CustomEvent")).initCustomEvent(i,!1,!1,void 0),o))}var gt,xt=new Set;function yt(){gt={r:0,c:[],p:gt}}function bt(){gt.r||y(gt.c),gt=gt.p}function wt(t,e){t&&t.i&&(xt.delete(t),t.i(e))}function Ct(t,e,n,i){if(t&&t.o){if(xt.has(t))return;xt.add(t),gt.c.push(function(){xt.delete(t),i&&(n&&t.d(1),i())}),t.o(e)}}var $t={duration:0};function kt(t,e,n,i){var o=e(t,n),r=i?0:1,l=null,a=null,s=null;function u(){s&&K(t,s)}function c(t,e){var n=t.b-r;return e*=Math.abs(n),{a:r,b:t.b,d:n,duration:e,start:t.start,end:t.start+e,group:t.group}}function d(e){var n,i=o||$t,d=i.delay,f=void 0===d?0:d,p=i.duration,v=void 0===p?300:p,g=i.easing,x=void 0===g?h:g,b=i.tick,w=void 0===b?m:b,C=i.css,$={start:S()+f,b:e};e||($.group=gt,gt.r+=1),l||a?a=$:(C&&(u(),s=J(t,r,e,v,f,x,C)),e&&w(0,1),l=c($,v),ut(function(){return ht(t,e,"start")}),n=function(e){if(a&&e>a.start&&(l=c(a,v),a=null,ht(t,l.b,"start"),C&&(u(),s=J(t,r,l.b,l.duration,0,x,o.css))),l)if(e>=l.end)w(r=l.b,1-r),ht(t,l.b,"end"),a||(l.b?u():--l.group.r||y(l.group.c)),l=null;else if(e>=l.start){var n=e-l.start;r=l.a+l.d*x(n/l.duration),w(r,1-r)}return!(!l&&!a)},0===z.size&&M(q),new Promise(function(t){z.add({c:n,f:t})}))}return{run:function(t){b(o)?(dt||(dt=Promise.resolve()).then(function(){dt=null}),dt).then(function(){o=o(),d(t)}):d(t)},end:function(){u(),l=a=null}}}var Lt="undefined"!=typeof window?window:"undefined"!=typeof globalThis?globalThis:t;function St(t,e,n){var i=t.$$.props[e];void 0!==i&&(t.$$.bound[i]=n,n(t.$$.ctx[i]))}function Mt(t){t&&t.c()}function zt(t,e,n){var i=t.$$,o=i.fragment,r=i.on_mount,l=i.on_destroy,a=i.after_update;o&&o.m(e,n),ut(function(){var e=r.map(g).filter(b);l?l.push.apply(l,f(e)):y(e),t.$$.on_mount=[]}),a.forEach(ut)}function qt(t,e){var n=t.$$;null!==n.fragment&&(y(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function Ft(t,e){-1===t.$$.dirty[0]&&(it.push(t),st||(st=!0,at.then(vt)),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Ht(t,e,n,i,o,r){var l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[-1],a=N;Q(t);var s=e.props||{},u=t.$$={fragment:null,ctx:null,props:r,update:m,not_equal:o,bound:x(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(a?a.$$.context:[]),callbacks:x(),dirty:l,skip_bound:!1},c=!1;if(u.ctx=n?n(t,s,function(e,n){var i=!(arguments.length<=2)&&arguments.length-2?arguments.length<=2?void 0:arguments[2]:n;return u.ctx&&o(u.ctx[e],u.ctx[e]=i)&&(!u.skip_bound&&u.bound[e]&&u.bound[e](i),c&&Ft(t,e)),n}):[],u.update(),c=!0,y(u.before_update),u.fragment=!!i&&i(u.ctx),e.target){if(e.hydrate){var d=A(e.target);u.fragment&&u.fragment.l(d),d.forEach(_)}else u.fragment&&u.fragment.c();e.intro&&wt(t.$$.fragment),zt(t,e.target,e.anchor),vt()}Q(a)}var _t=function(){function t(){n(this,t)}return o(t,[{key:"$destroy",value:function(){qt(this,1),this.$destroy=m}},{key:"$on",value:function(t,e){var n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),function(){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}}},{key:"$set",value:function(t){var e;this.$$set&&(e=t,0!==Object.keys(e).length)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}]),t}();function Et(t){var e=t-1;return e*e*e+1}function Vt(t,e){var n=e.delay,i=void 0===n?0:n,o=e.duration,r=void 0===o?400:o,l=e.easing,a=void 0===l?h:l,s=+getComputedStyle(t).opacity;return{delay:i,duration:r,easing:a,css:function(t){return"opacity: ".concat(t*s)}}}function Tt(t,e){var n=e.delay,i=void 0===n?0:n,o=e.duration,r=void 0===o?400:o,l=e.easing,a=void 0===l?Et:l,s=e.x,u=void 0===s?0:s,c=e.y,d=void 0===c?0:c,f=e.opacity,p=void 0===f?0:f,v=getComputedStyle(t),m=+v.opacity,h="none"===v.transform?"":v.transform,g=m*(1-p);return{delay:i,duration:r,easing:a,css:function(t,e){return"\n\t\t\ttransform: ".concat(h," translate(").concat((1-t)*u,"px, ").concat((1-t)*d,"px);\n\t\t\topacity: ").concat(m-g*e)}}}var Zt='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg"    xmlns:xlink="http://www.w3.org/1999/xlink">    \x3c!-- Generator: Sketch 63.1 (92452) - https://sketch.com --\x3e            <g id="终稿" stroke="none" stroke-width="1" fill-rule="evenodd" opacity="0.9">        <g id="图标切图" transform="translate(-439.000000, -74.000000)">            <g id="编组-3" transform="translate(421.000000, 56.000000)">                <g id="编组-11" transform="translate(18.000000, 18.000000)">                    <g id="icon_暂停" transform="translate(12.000000, 10.000000)">                        <path                            d="M2,0 C3.104,0 4,0.896 4,2 L4,2 L4,14 C4,15.104 3.104,16 2,16 C0.896,16 0,15.104 0,14 L0,14 L0,2 C0,0.896 0.896,0 2,0 Z M10,0 L10.1502192,0.00546944456 C11.1911389,0.0815918399 12,0.942829791 12,1.99406028 L12,1.99406028 L12,14.0059397 C12,15.1054862 11.1045695,16 10,16 L10,16 L9.84978083,15.9945306 C8.8088611,15.9184082 8,15.0571702 8,14.0059397 L8,14.0059397 L8,1.99406028 C8,0.894513756 8.8954305,0 10,0 L10,0 Z"                            id="暂停"></path>                    </g>                </g>            </g>        </g>    </g></svg>',jt='<svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">    <path id="Play"    d="M25,19.72l-9.94,6A2,2,0,0,1,12,24V12a2,2,0,0,1,2-2,2.1,2.1,0,0,1,1,.28l9.94,6A2,2,0,0,1,25.66,19,1.93,1.93,0,0,1,25,19.72Z"    style="fill-rule:evenodd" /></svg>',Pt='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg"    xmlns:xlink="http://www.w3.org/1999/xlink">    \x3c!-- Generator: Sketch 63.1 (92452) - https://sketch.com --\x3e            <g id="终稿" stroke="none" stroke-width="1" fill-rule="evenodd" opacity="0.9">        <g id="图标切图" transform="translate(-511.000000, -120.000000)">            <g id="编组-3" transform="translate(421.000000, 56.000000)">                <g id="编组-9" transform="translate(90.000000, 64.000000)">                    <g id="icon_网页全屏" transform="translate(7.000000, 7.000000)">                        <g id="player_fullpage">                            <path                                d="M16,14 L16,12.5 C16,12.2238576 16.2238576,12 16.5,12 L17.5,12 C17.7761424,12 18,12.2238576 18,12.5 L18,15.5 C18,15.7761424 17.7761424,16 17.5,16 L14.5,16 C14.2238576,16 14,15.7761424 14,15.5 L14,14.5 C14,14.2238576 14.2238576,14 14.5,14 L16,14 L16,14 Z M6,14 L7.5,14 C7.77614237,14 8,14.2238576 8,14.5 L8,15.5 C8,15.7761424 7.77614237,16 7.5,16 L4.5,16 C4.22385763,16 4,15.7761424 4,15.5 L4,12.5 C4,12.2238576 4.22385763,12 4.5,12 L5.5,12 C5.77614237,12 6,12.2238576 6,12.5 L6,14 L6,14 Z M18,6.5 L18,9.5 C18,9.77614237 17.7761424,10 17.5,10 L16.5,10 C16.2238576,10 16,9.77614237 16,9.5 L16,8 L16,8 L14.5,8 C14.2238576,8 14,7.77614237 14,7.5 L14,6.5 C14,6.22385763 14.2238576,6 14.5,6 L17.5,6 C17.7761424,6 18,6.22385763 18,6.5 Z M4.5,6 L7.5,6 C7.77614237,6 8,6.22385763 8,6.5 L8,7.5 C8,7.77614237 7.77614237,8 7.5,8 L6,8 L6,8 L6,9.5 C6,9.77614237 5.77614237,10 5.5,10 L4.5,10 C4.22385763,10 4,9.77614237 4,9.5 L4,6.5 C4,6.22385763 4.22385763,6 4.5,6 Z M4,4 L18,4 C19.1045695,4 20,4.8954305 20,6 L20,16 C20,17.1045695 19.1045695,18 18,18 L4,18 C2.8954305,18 2,17.1045695 2,16 L2,6 C2,4.8954305 2.8954305,4 4,4 Z"                                id="Combined-Shape"></path>                        </g>                    </g>                </g>            </g>        </g>    </g></svg>',Bt='<svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">    <path id="Combined-Shape"    d="M23,21v1.5a.47.47,0,0,1-.5.5h-1a.47.47,0,0,1-.5-.5v-3a.47.47,0,0,1,.5-.5h3a.47.47,0,0,1,.5.5v1a.47.47,0,0,1-.5.5ZM13,21H11.5a.47.47,0,0,1-.5-.5v-1a.47.47,0,0,1,.5-.5h3a.47.47,0,0,1,.5.5v3a.47.47,0,0,1-.5.5h-1a.47.47,0,0,1-.5-.5Zm8-4.5v-3a.47.47,0,0,1,.5-.5h1a.47.47,0,0,1,.5.5V15h1.5a.47.47,0,0,1,.5.5v1a.47.47,0,0,1-.5.5h-3A.47.47,0,0,1,21,16.5Zm-6.5.5h-3a.47.47,0,0,1-.5-.5v-1a.47.47,0,0,1,.5-.5H13V13.5a.47.47,0,0,1,.5-.5h1a.47.47,0,0,1,.5.5v3A.47.47,0,0,1,14.5,17ZM11,11H25a2,2,0,0,1,2,2V23a2,2,0,0,1-2,2H11a2,2,0,0,1-2-2V13A2,2,0,0,1,11,11Z"    style="fill-rule:evenodd" /></svg>',It='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e<svg version="1.1" id="图层_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve"><g id="页面-2">\t<g id="画中画icon-复原">\t\t<path id="路径" d="M12.9,25.7c-1.6,0-2.9-1.2-3-2.7l0-0.2v-2.4c0-0.5,0.4-1,1-1c0.5,0,0.9,0.4,0.9,0.8l0,0.1v2.4\t\t\tc0,0.5,0.4,0.9,0.9,0.9l0.1,0h10.3c0.6,0,1-0.4,1.1-0.9l0-0.1v-9.5c0-0.5-0.4-0.9-0.9-0.9l-0.1,0h-3.1c-0.5,0-1-0.4-1-1\t\t\tc0-0.5,0.4-0.9,0.8-0.9l0.1,0h3.1c1.6,0,2.9,1.2,3,2.7l0,0.2v9.5c0,1.5-1.2,2.8-2.8,2.9l-0.2,0H12.9z"/>\t\t<path id="矩形-2" d="M17.4,19.2C17.3,19.2,17.3,19.2,17.4,19.2l-5.8-5.8l0,3.2c0,0.4-0.4,0.8-0.8,0.8h-0.1\t\t\tc-0.4,0-0.8-0.4-0.8-0.8v-5.3c0-0.3,0.1-0.5,0.3-0.6l-0.1,0c0.1-0.2,0.3-0.2,0.5-0.3c0.1,0,0.2,0,0.3,0h5.2c0.4,0,0.8,0.4,0.8,0.8\t\t\tv0.1c0,0.4-0.4,0.8-0.8,0.8l-3.4,0l5.8,5.8c0.4,0.4,0.4,0.9,0,1.3C18.2,19.5,17.7,19.5,17.4,19.2z"/>\t</g></g></svg>',Rt='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Generator: Adobe Illustrator 22.1.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e<svg version="1.1" id="图层_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve"><g id="页面-2" class="st0">\t<g id="画中画icon">\t\t<path id="路径" d="M25,9.9c1.6,0,2.9,1.2,3,2.7l0,0.2V18c0,0.5-0.4,1-1,1c-0.5,0-0.9-0.4-0.9-0.8l0-0.1v-5.2\t\t\tc0-0.5-0.4-0.9-0.9-0.9l-0.1,0H11c-0.6,0-1,0.4-1.1,0.9l0,0.1v9.5c0,0.5,0.4,0.9,0.9,0.9l0.1,0h5.8c0.5,0,1,0.4,1,1\t\t\tc0,0.5-0.4,0.9-0.8,0.9l-0.1,0H11c-1.6,0-2.9-1.2-3-2.7l0-0.2v-9.5c0-1.5,1.2-2.8,2.8-2.9l0.2,0H25z"/>\t\t<path id="矩形" d="M20.4,20.4H27c0.5,0,1,0.4,1,1v3.8c0,0.5-0.4,1-1,1h-6.7c-0.5,0-1-0.4-1-1v-3.8\t\t\tC19.4,20.8,19.9,20.4,20.4,20.4z"/>\t\t<path id="矩形-2" d="M17.5,13.3c0.4,0,0.7,0.3,0.7,0.7v4.6c0,0.2-0.1,0.4-0.2,0.5c0,0-0.1,0.1-0.1,0.1c-0.2,0.2-0.4,0.2-0.7,0.2\t\t\tc0,0-0.1,0-0.1,0h-4.6c-0.4,0-0.7-0.3-0.7-0.7s0.3-0.7,0.7-0.7l3.1,0l-3.2-3.2c-0.3-0.3-0.3-0.7,0-1s0.7-0.3,1,0l3.2,3.2l0-3\t\t\tC16.8,13.7,17.1,13.3,17.5,13.3z"/>\t</g></g></svg>',At='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">        <g id="镜像备份-VER2备份-2">        <path d="M10.6409374,9.273203 L10.6547337,9.28700042 L10.6547337,9.28700042 L25.9811827,24.9326454 C26.0247624,24.9538216 26.0696068,24.9714846 26.1152949,24.9856387 C26.0987291,24.996065 26.0819817,25.0067498 26.0650813,25.0171782 L26.368872,25.3264603 C26.7441619,25.7095196 26.7441765,26.3223786 26.3689047,26.7054558 L26.3614896,26.7130252 C25.9920126,27.090187 25.3867423,27.0964169 25.0095804,26.72694 C25.0049053,26.7223601 25.0002774,26.7177324 24.9956973,26.7130575 L23.11,24.789 L20.6356386,23.9855094 C19.8743642,23.738264 19.3435461,23.0577799 19.2801675,22.2701928 L19.2737946,22.1113439 L19.273,20.872 L17.342,18.901 L17.3422432,22.1016015 C17.3422432,22.960156 16.7979043,23.7200014 15.996361,23.9803253 L12.1332583,25.2349772 C11.1167119,25.5651294 10.0304252,24.9916374 9.70696907,23.9540469 C9.6467092,23.7607438 9.61603779,23.5591061 9.61603779,23.3562534 L9.61603779,12.085326 C9.61603779,11.7735988 9.68691742,11.478769 9.81312403,11.2167115 L9.28147729,10.6735062 C8.9061528,10.2904113 8.906178,9.67748365 9.28153401,9.29441968 L9.28885886,9.28694442 C9.65843044,8.90978366 10.2637766,8.90363142 10.6409374,9.273203 Z M11.064,12.493 L11.0647013,23.3562534 C11.0647013,23.4069666 11.0723692,23.457376 11.0874341,23.5057018 C11.1593133,23.7362774 11.381875,23.8751793 11.608934,23.8452307 L11.6940064,23.8259344 L15.5571091,22.5712824 C15.7288684,22.5154988 15.8533861,22.3679662 15.8854573,22.1917865 L15.8935797,22.1016015 L15.893,17.422 L11.064,12.493 Z M25.0294677,10.1327135 C26.1177626,10.1327135 27,11.0149509 27,12.1032458 L27,12.1032458 L26.999,23.262 L19.273,15.377 L19.2737946,13.473172 C19.2737946,12.6987707 19.7265395,12.0018007 20.4212289,11.6827376 L20.5737173,11.6202607 L24.3588582,10.2503345 C24.5738769,10.1725145 24.8007998,10.1327135 25.0294677,10.1327135 Z M15.345,11.368 L16.0562061,11.6252862 C16.8023231,11.8953224 17.3088771,12.6012767 17.3406565,13.4032942 L15.345,11.368 Z" id="矩形"></path>    </g></svg>',Ot='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">        <g id="镜像备份-VER2备份">        <path d="M11,10.5 C11.2277182,10.5 11.453764,10.5377956 11.6683894,10.611757 L15.6683894,11.9901849 C16.4665917,12.2652509 17,12.9990945 17,13.8221657 L17,22.3187792 C17,23.1652278 16.4363713,23.914359 15.6064236,24.1710122 L11.6064236,25.4079729 C10.5538537,25.7334698 9.42907214,25.1680643 9.09415362,24.1451043 C9.03175832,23.9545269 9,23.7557324 9,23.55574 L9,12.4437379 C9,11.3702411 9.8954305,10.5 11,10.5 Z M24.9596712,10.5130738 C26.0865137,10.5130738 27,11.4265601 27,12.5534026 L27,12.5534026 L27,23.4473726 C27,23.6517289 26.9692989,23.8549257 26.9089246,24.0501601 C26.5760143,25.126703 25.4334266,25.7295364 24.3568837,25.396626 L24.3568837,25.396626 L20.4375413,24.1846079 C19.5828274,23.920296 19,23.1300034 19,22.2353545 L19,22.2353545 L19,13.9040352 C19,13.0334032 19.5524531,12.2586879 20.375581,11.9750323 L20.375581,11.9750323 L24.2949233,10.6243997 C24.5088021,10.5506956 24.7334491,10.5130738 24.9596712,10.5130738 Z M11,11.9578034 C10.7545401,11.9578034 10.5503916,12.1297029 10.5080557,12.3563906 L10.5,12.4437379 L10.5,23.55574 C10.5,23.6057381 10.5079396,23.6554367 10.5235384,23.703081 C10.5979647,23.9304055 10.8284134,24.0673488 11.0635188,24.0378225 L11.1516059,24.0187982 L15.1516059,22.7818375 C15.3294518,22.7268404 15.458382,22.5813881 15.4915897,22.4076926 L15.5,22.3187792 L15.5,13.8221657 C15.5,13.6457933 15.402027,13.4858097 15.2483703,13.4003946 L15.1670973,13.3641705 L11.1670973,11.9857427 C11.113441,11.9672524 11.0569296,11.9578034 11,11.9578034 Z" id="矩形"></path>    </g></svg>',Gt='<svg viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect opacity="0.01" width="36" height="36" fill="#5E9FFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M14.5913 11.754L13.4961 10.1096C13.2131 9.68473 13.3281 9.11091 13.753 8.82793C14.1779 8.54495 14.7517 8.65998 15.0347 9.08485L16.6543 11.5166C16.6954 11.5783 16.7281 11.6432 16.7527 11.7098C17.191 11.7041 17.6036 11.7009 17.9905 11.7004L18 11.7003L18.0499 11.7004L18.0997 11.7003L18.1093 11.7004C18.3772 11.7008 18.6574 11.7024 18.95 11.7052C18.9781 11.6302 19.0165 11.5577 19.0655 11.4895L20.8132 9.05778C21.1111 8.64326 21.6887 8.54874 22.1032 8.84667C22.5177 9.14459 22.6122 9.72215 22.3143 10.1367L21.1584 11.745C21.9323 11.7642 22.7669 11.7896 23.6622 11.8213C25.3087 11.8795 26.5946 13.1691 26.8282 14.8001C26.9065 15.3466 26.9447 16.7585 26.9727 17.7964L26.9727 17.7966L26.9728 17.7969L26.9728 17.7973L26.9728 17.7979C26.981 18.1026 26.9884 18.375 26.9957 18.5837C27.0077 18.9315 26.7356 19.2233 26.3877 19.2354C26.0399 19.2475 25.7481 18.9753 25.736 18.6275C25.7287 18.4172 25.7214 18.1358 25.7132 17.8205C25.6872 16.8208 25.6523 15.4799 25.5805 14.9788C25.4334 13.9519 24.6544 13.1175 23.6177 13.0809C21.3756 13.0017 19.5195 12.9617 18.0503 12.9608C16.5809 12.9617 14.7245 13.0017 12.4821 13.0809C11.4454 13.1175 10.5838 13.8916 10.4367 14.9185C10.2977 15.8893 10.2275 17.0961 10.2275 18.5362C10.2275 20.2641 10.3285 21.7457 10.5292 22.9789C10.6915 23.9764 11.5287 24.7249 12.5382 24.7749C14.2578 24.86 15.5283 24.9025 17.5164 24.9025C17.8644 24.9025 18.1466 25.1847 18.1466 25.5327C18.1466 25.8808 17.8644 26.163 17.5164 26.163C15.5082 26.163 14.217 26.1199 12.4759 26.0337C10.8727 25.9544 9.5429 24.7657 9.28511 23.1813C9.07259 21.8753 8.96704 20.3276 8.96704 18.5362C8.96704 17.0406 9.04059 15.7761 9.18903 14.7398C9.42263 13.1088 10.791 11.8795 12.4376 11.8213C13.1995 11.7944 13.9174 11.7719 14.5913 11.754ZM18.468 15.8033H17.258V20.0484H19.2948V20.8248H16.895V21.813H19.2948L19.2973 22.4342C19.6276 22.4582 19.9516 22.5832 20.2229 22.8073H20.3233V21.813H22.7937V20.8248H20.3233V20.0484H22.4005V15.8033H21.2308C21.4829 15.4202 21.7148 14.9866 21.9165 14.5026L20.9182 14.1497C20.6964 14.7345 20.4544 15.2891 20.1721 15.8033H18.7806L19.4158 15.521C19.2041 15.0572 18.952 14.6337 18.6697 14.2303L17.7118 14.553C17.984 14.916 18.2361 15.3294 18.468 15.8033ZM14.6363 19.0703L14.7775 17.7091H16.5925V14.6034H13.6582V15.5008H15.5539V16.8117H13.8498L13.5675 19.9778H15.6547C15.6547 21.0467 15.6144 21.7424 15.5438 22.0651C15.4732 22.3877 15.1909 22.5491 14.6867 22.5491C14.4044 22.5491 14.1221 22.5289 13.8599 22.4987L14.1322 23.4767L14.1886 23.4808C14.4496 23.4995 14.6942 23.5171 14.9388 23.5171C15.8564 23.4566 16.3707 23.1339 16.4917 22.5491C16.5925 21.9642 16.653 20.8047 16.653 19.0703H14.6363ZM21.4728 19.1712V18.3847H20.3233V19.1712H21.4728ZM19.2948 18.3847V19.1712H18.1957V18.3847H19.2948ZM18.1957 17.5175H19.2948V16.6907H18.1957V17.5175ZM20.3233 17.5175V16.6907H21.4728V17.5175H20.3233Z" fill="white"/><path d="M26.8183 20.6299C27.0722 20.3476 27.5069 20.3246 27.7892 20.5785C28.0458 20.8094 28.0881 21.1896 27.9029 21.469L27.8405 21.5495L22.5197 27.5063C22.2761 27.7772 21.8689 27.8074 21.5891 27.5913L21.5162 27.5262L18.8063 24.7446C18.5413 24.4727 18.547 24.0374 18.819 23.7725C19.0662 23.5316 19.4484 23.5144 19.7149 23.7176L19.7911 23.7851L21.9884 26.0401L26.8183 20.6299Z" fill="#00AEEC"/></svg>',Xt='<svg viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect opacity="0.01" width="36" height="36" fill="#5E9FFF"/><path fill-rule="evenodd" clip-rule="evenodd" d="M13.4961 10.1096L14.5913 11.754C13.9174 11.7719 13.1995 11.7944 12.4376 11.8213C10.791 11.8795 9.42263 13.1088 9.18903 14.7398C9.04059 15.7761 8.96704 17.0406 8.96704 18.5362C8.96704 20.3276 9.07259 21.8753 9.28511 23.1813C9.5429 24.7657 10.8727 25.9544 12.4759 26.0337C14.217 26.1199 16.4763 26.163 18.4844 26.163C18.8325 26.163 19.1146 25.8808 19.1146 25.5327C19.1146 25.1847 18.8325 24.9025 18.4844 24.9025C16.4964 24.9025 14.2578 24.86 12.5382 24.7749C11.5287 24.7249 10.6915 23.9764 10.5292 22.9789C10.3285 21.7457 10.2275 20.2641 10.2275 18.5362C10.2275 17.0961 10.2977 15.8893 10.4367 14.9185C10.5838 13.8916 11.4454 13.1175 12.4821 13.0809C14.7031 13.0024 16.5454 12.9624 18.0081 12.9608C19.4707 12.9624 21.3128 13.0024 23.5336 13.0809C24.5704 13.1175 25.4319 13.8916 25.579 14.9185C25.7181 15.8893 25.7672 17.1655 25.7672 18.6056C25.7672 18.9537 26.0494 19.2358 26.3974 19.2358C26.7455 19.2358 27.0276 18.9537 27.0276 18.6056C27.0276 17.11 26.9751 15.7761 26.8267 14.7398C26.5931 13.1088 25.2247 11.8795 23.5781 11.8213C22.7146 11.7908 21.9075 11.766 21.1569 11.7471L22.3143 10.1367C22.6122 9.72215 22.5177 9.14459 22.1032 8.84667C21.6887 8.54874 21.1111 8.64326 20.8132 9.05778L19.0655 11.4895C19.0163 11.5579 18.9778 11.6308 18.9497 11.7061C18.6603 11.703 18.3828 11.7012 18.1172 11.7006L18.0997 11.7003L18.0079 11.7004L17.916 11.7003L17.8985 11.7006C17.5384 11.7014 17.1565 11.7045 16.7527 11.7098C16.7281 11.6432 16.6954 11.5783 16.6543 11.5166L15.0347 9.08485C14.7517 8.65998 14.1779 8.54495 13.753 8.82793C13.3281 9.11091 13.2131 9.68473 13.4961 10.1096ZM17.268 15.7981H18.478C18.2461 15.3241 17.994 14.9107 17.7218 14.5477L18.6797 14.2251C18.962 14.6284 19.2141 15.0519 19.4258 15.5157L18.7906 15.7981H20.1821C20.4644 15.2838 20.7064 14.7292 20.9283 14.1444L21.9265 14.4973C21.7248 14.9813 21.4929 15.4149 21.2408 15.7981H22.4105V18.9526C20.8992 19.2936 19.6708 20.3813 19.1333 21.8077H16.905V20.8196H19.3048V20.0431H17.268V15.7981ZM14.7875 17.7038L14.6463 19.0651H16.663C16.663 20.7994 16.6025 21.959 16.5017 22.5438C16.3807 23.1286 15.8664 23.4513 14.9488 23.5118C14.7042 23.5118 14.4596 23.4942 14.1986 23.4755L14.1422 23.4715L13.8699 22.4934C14.1321 22.5236 14.4144 22.5438 14.6968 22.5438C15.2009 22.5438 15.4833 22.3825 15.5538 22.0598C15.6244 21.7371 15.6648 21.0414 15.6648 19.9726H13.5775L13.8598 16.8064H15.5639V15.4956H13.6683V14.5981H16.6025V17.7038H14.7875ZM21.4828 18.3794V19.1659H20.3333V18.3794H21.4828ZM19.3048 19.1659V18.3794H18.2058V19.1659H19.3048ZM19.3048 17.5122H18.2058V16.6854H19.3048V17.5122ZM20.3333 16.6854V17.5122H21.4828V16.6854H20.3333ZM27.224 23.5573C27.224 25.5823 25.5824 27.224 23.5573 27.224C21.5323 27.224 19.8907 25.5823 19.8907 23.5573C19.8907 21.5323 21.5323 19.8906 23.5573 19.8906C25.5824 19.8906 27.224 21.5323 27.224 23.5573ZM21.0485 23.5573C21.0485 24.9429 22.1718 26.0661 23.5573 26.0661C24.0308 26.0661 24.4737 25.9349 24.8516 25.7069L21.4075 22.2634C21.1796 22.6412 21.0485 23.084 21.0485 23.5573ZM22.2625 21.408L25.7068 24.8517C25.9349 24.4738 26.0661 24.0308 26.0661 23.5573C26.0661 22.1717 24.9429 21.0485 23.5573 21.0485C23.0836 21.0485 22.6405 21.1798 22.2625 21.408Z" fill="white"/></svg>';function Yt(t){var e,n,i,o;return{c:function(){e=V("div"),n=T(t[0]),R(e,"class","tip panel svelte-1fgqxfc"),R(e,"style",t[1])},m:function(t,i){H(t,e,i),F(e,n),o=!0},p:function(t,i){(!o||1&i)&&O(n,t[0]),(!o||2&i)&&R(e,"style",t[1])},i:function(t){o||(ut(function(){i||(i=kt(e,Tt,{duration:200,y:10},!0)),i.run(1)}),o=!0)},o:function(t){i||(i=kt(e,Tt,{duration:200,y:10},!1)),i.run(0),o=!1},d:function(t){t&&_(e),t&&i&&i.end()}}}function Nt(t){var e,n,i,o,r,l,a=t[2]&&t[0]&&Yt(t),s=t[4].default,u=function(t,e,n,i){if(t){var o=C(t,e,n,null);return t[0](o)}}(s,t,t[3]);return{c:function(){e=V("div"),a&&a.c(),n=Z(),i=V("div"),u&&u.c(),R(e,"class","tip-wrap svelte-1fgqxfc")},m:function(s,c){H(s,e,c),a&&a.m(e,null),F(e,n),F(e,i),u&&u.m(i,null),o=!0,r||(l=[P(e,"mouseenter",t[5]),P(e,"mouseleave",t[6])],r=!0)},p:function(t,i){var o=d(i,1)[0];t[2]&&t[0]?a?(a.p(t,o),5&o&&wt(a,1)):((a=Yt(t)).c(),wt(a,1),a.m(e,n)):a&&(yt(),Ct(a,1,1,function(){a=null}),bt()),u&&u.p&&8&o&&$(u,s,t,t[3],o,null,null)},i:function(t){o||(wt(a),wt(u,t),o=!0)},o:function(t){Ct(a),Ct(u,t),o=!1},d:function(t){t&&_(e),a&&a.d(),u&&u.d(t),r=!1,y(l)}}}function Ut(t,e,n){var i=e.$$slots,o=void 0===i?{}:i,r=e.$$scope,l=e.text,a=void 0===l?"":l,s=e.style,u=void 0===s?"":s,c=!1;return t.$$set=function(t){"text"in t&&n(0,a=t.text),"style"in t&&n(1,u=t.style),"$$scope"in t&&n(3,r=t.$$scope)},[a,u,c,r,o,function(){return n(2,c=!0)},function(){return n(2,c=!1)}]}var Dt=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),document.getElementById("svelte-1fgqxfc-style")||((r=V("style")).id="svelte-1fgqxfc-style",r.textContent=".tip-wrap.svelte-1fgqxfc.svelte-1fgqxfc{position:relative}.tip-wrap.svelte-1fgqxfc:hover .tip.svelte-1fgqxfc{display:block}.tip.svelte-1fgqxfc.svelte-1fgqxfc{padding:4px 6px;word-break:keep-all;white-space:nowrap;display:none}",F(document.head,r)),Ht(s(o),t,Ut,Nt,w,{text:0,style:1}),o}return i}(),Wt='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Generator: Adobe Illustrator 24.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e<svg version="1.1" id="图层_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"    y="0px" viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">        <path class="st0" d="M20,14.5c1.9,1.1,2.6,3.6,1.5,5.5c-0.3,0.6-0.9,1.1-1.5,1.5V14.5z" />    <path class="st0" d="M21.4,10.7c4,1.9,5.7,6.7,3.8,10.7c-0.8,1.7-2,3-3.7,3.8c-0.5,0.2-1.1,0-1.3-0.5l0,0c-0.2-0.5,0-1.1,0.5-1.3\tc2.9-1.5,4.1-4.9,2.7-8c-0.6-1.2-1.6-2.3-2.8-2.8c-0.5-0.2-0.7-0.8-0.5-1.3S20.8,10.5,21.4,10.7C21.3,10.7,21.3,10.7,21.4,10.7\tL21.4,10.7z" />    <path class="st0" d="M17.9,11.7c0.1,0.1,0.1,0.1,0.1,0.2l0.1,12c0,0.3-0.2,0.5-0.5,0.5c-0.1,0-0.2,0-0.3-0.1l-4.2-3.4h-1\tc-1.1,0-2-0.9-2-2v-2c0-1.1,0.9-2,2-2h1l4.1-3.3C17.4,11.5,17.7,11.5,17.9,11.7L17.9,11.7z" /></svg>',Jt='<?xml version="1.0" encoding="utf-8"?>\x3c!-- Generator: Adobe Illustrator 24.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --\x3e<svg version="1.1" id="图层_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"  y="0px" viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">    <path class="st0" d="M25.8,25.8c0.4,0.4,0.4,1,0,1.4s-1,0.4-1.4,0l-2.3-2.3c-0.2,0.1-0.4,0.2-0.6,0.3c-0.5,0.2-1.1,0-1.3-0.5\tc-0.2-0.5,0-1.1,0.5-1.3l0,0l-2.6-2.6v3.1c0,0.3-0.2,0.5-0.5,0.5c-0.1,0-0.2,0-0.3-0.1l-4.2-3.4h-1c-1.1,0-2-0.9-2-2v-2\tc0-1.1,0.9-2,2-2h0.2l-3.4-3.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0L25.8,25.8z" />  <path class="st0" d="M21.4,10.8c4,1.9,5.7,6.7,3.8,10.7c-0.1,0.2-0.2,0.4-0.3,0.6l-1.5-1.5c1.4-3,0.2-6.6-2.8-8l0,0\tc-0.5-0.2-0.7-0.8-0.5-1.3l0,0C20.4,10.7,21,10.5,21.4,10.8z" />  <path class="st0" d="M20,14.5c1.2,0.7,2,2,2,3.5c0,0.3,0,0.7-0.1,1L20,17.1V14.5z" />  <path class="st0" d="M17.9,11.7C18,11.8,18,11.9,18,12v3.1l-2.3-2.3l1.5-1.2C17.4,11.5,17.7,11.5,17.9,11.7z" /></svg>',Kt=function(t,e,n){return Math.min(Math.max(Math.round(t),e),n)};function Qt(t){var e;return{onEnter:function(n){clearTimeout(e),e=window.setTimeout(function(){n()},t)},onLeave:function(n){clearTimeout(e),e=window.setTimeout(function(){n()},t)}}}var te=Lt.document;function ee(t){var e,n,i,o,r,l,a,s,u,c,f=Math.round(t[0])+"";return{c:function(){e=V("div"),n=V("div"),i=T(f),o=Z(),r=V("div"),l=V("div"),a=Z(),s=V("div"),R(n,"class","number svelte-126wnuj"),X(l,"top",t[4]+"px"),R(l,"class","slider-handle svelte-126wnuj"),Y(l,"top-trans",!t[3]),X(s,"height",t[0]+"%"),R(s,"class","slider-track svelte-126wnuj"),Y(s,"height-trans",!t[3]),R(r,"class","slider-rail svelte-126wnuj"),R(e,"class","vertical-slider-wrap svelte-126wnuj")},m:function(d,f){H(d,e,f),F(e,n),F(n,i),F(e,o),F(e,r),F(r,l),t[9](l),F(r,a),F(r,s),t[10](r),u||(c=[P(l,"mousedown",t[7]),P(r,"mousedown",t[6]),P(e,"wheel",I(B(t[11])))],u=!0)},p:function(t,e){var n=d(e,1)[0];1&n&&f!==(f=Math.round(t[0])+"")&&O(i,f),16&n&&X(l,"top",t[4]+"px"),8&n&&Y(l,"top-trans",!t[3]),1&n&&X(s,"height",t[0]+"%"),8&n&&Y(s,"height-trans",!t[3])},i:m,o:m,d:function(n){n&&_(e),t[9](null),t[10](null),u=!1,y(c)}}}function ne(t,e,n){var i,o,r,l,a=e.value,s=void 0===a?100:a,u=e.onChange,c=void 0===u?null:u,d=Number(null!==(o=getComputedStyle(document.documentElement).zoom)&&void 0!==o?o:1),f=!1,p=function(t){var e=Kt(t,0,100);c?c(e):n(0,s=e)};return t.$$set=function(t){"value"in t&&n(0,s=t.value),"onChange"in t&&n(8,c=t.onChange)},t.$$.update=function(){3&t.$$.dirty&&n(4,i=(100-s)/100*((null==r?void 0:r.clientHeight)-12))},[s,r,l,f,i,p,function(t){t.target!==l&&p(100-(t.clientY/d-r.getBoundingClientRect().top)/r.clientHeight*100)},function(t){var e=t.clientY/d,i=s;n(3,f=!0);var o=function(t){var n=e-t.clientY/d;p(i+n/r.clientHeight*100)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",function t(){n(3,f=!1),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",t)})},c,function(t){ot[t?"unshift":"push"](function(){n(2,l=t)})},function(t){ot[t?"unshift":"push"](function(){n(1,r=t)})},function(t){var e=t.deltaY;p(s-Math.ceil(e/10))}]}var ie=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),te.getElementById("svelte-126wnuj-style")||((r=V("style")).id="svelte-126wnuj-style",r.textContent=".vertical-slider-wrap.svelte-126wnuj.svelte-126wnuj{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding:8px 6px;opacity:0.9;background:#212121;border-radius:4px;-webkit-box-sizing:border-box;box-sizing:border-box}.vertical-slider-wrap.svelte-126wnuj .number.svelte-126wnuj{-ms-flex-negative:0;flex-shrink:0;margin-bottom:5px;width:20px;text-align:center;color:#e5e9ef}.vertical-slider-wrap.svelte-126wnuj .slider-rail.svelte-126wnuj{width:2px;-webkit-box-flex:1;-ms-flex:1;flex:1;position:relative;padding:0 4px;background:#e7e7e7;background-clip:content-box;border-radius:2px;cursor:pointer}.vertical-slider-wrap.svelte-126wnuj .slider-handle.svelte-126wnuj{width:12px;height:12px;position:absolute;left:50%;z-index:1;-webkit-transform:translateX(-50%);transform:translateX(-50%);border-radius:50%;background-color:#00a1d6}.vertical-slider-wrap.svelte-126wnuj .slider-handle.top-trans.svelte-126wnuj{-webkit-transition:top 0.2s ease-in-out;transition:top 0.2s ease-in-out}.vertical-slider-wrap.svelte-126wnuj .slider-track.svelte-126wnuj{position:absolute;bottom:0;width:2px;background-color:#00a1d6}.vertical-slider-wrap.svelte-126wnuj .slider-track.height-trans.svelte-126wnuj{-webkit-transition:height 0.2s ease-in-out;transition:height 0.2s ease-in-out}",F(te.head,r)),Ht(s(o),t,ne,ee,w,{value:0,onChange:8}),o}return i}(),oe=Lt.document;function re(t){var e,n,i,o,r;return n=new ie({props:{value:t[0]?0:t[1],onChange:t[8]}}),{c:function(){e=V("div"),Mt(n.$$.fragment),R(e,"class","panel volume-control svelte-16y1m1m")},m:function(l,a){H(l,e,a),zt(n,e,null),i=!0,o||(r=P(e,"mousedown",t[9]),o=!0)},p:function(t,e){var i={};3&e&&(i.value=t[0]?0:t[1]),n.$set(i)},i:function(t){i||(wt(n.$$.fragment,t),i=!0)},o:function(t){Ct(n.$$.fragment,t),i=!1},d:function(t){t&&_(e),qt(n),o=!1,r()}}}function le(t){var e,n,i,o,r,l,a=(t[0]?Jt:Wt)+"",s=(t[2]||t[3])&&re(t);return{c:function(){e=V("div"),s&&s.c(),n=Z(),R(i=V("span"),"class","icon"),R(e,"class","volume svelte-16y1m1m")},m:function(u,c){H(u,e,c),s&&s.m(e,null),F(e,n),F(e,i),i.innerHTML=a,o=!0,r||(l=[P(i,"click",t[10]),P(e,"mouseenter",t[11]),P(e,"mouseleave",t[12]),P(e,"wheel",I(B(t[13])))],r=!0)},p:function(t,r){var l=d(r,1)[0];t[2]||t[3]?s?(s.p(t,l),12&l&&wt(s,1)):((s=re(t)).c(),wt(s,1),s.m(e,n)):s&&(yt(),Ct(s,1,1,function(){s=null}),bt()),(!o||1&l)&&a!==(a=(t[0]?Jt:Wt)+"")&&(i.innerHTML=a)},i:function(t){o||(wt(s),o=!0)},o:function(t){Ct(s),o=!1},d:function(t){t&&_(e),s&&s.d(),r=!1,y(l)}}}function ae(t,e,n){var i=e.onChange,o=void 0===i?null:i,r=e.disabled,l=void 0!==r&&r,a=e.value,s=void 0===a?100:a,u=!1,c=!1,d=function(t,e){if("disabled"===t)o?o({disabled:e,value:s}):n(0,l=e);else if("value"===t&&e!==s){var i=0===e;o?o({disabled:i,value:e}):(n(1,s=e),n(0,l=i))}},f=Qt(100),p=f.onEnter,v=f.onLeave;return t.$$set=function(t){"onChange"in t&&n(7,o=t.onChange),"disabled"in t&&n(0,l=t.disabled),"value"in t&&n(1,s=t.value)},[l,s,u,c,d,p,v,o,function(t){return d("value",t)},function(){n(3,c=!0),document.addEventListener("mouseup",function t(){n(3,c=!1),document.removeEventListener("mouseup",t)})},function(){return d("disabled",!l)},function(){return p(function(){n(2,u=!0)})},function(){return v(function(){n(2,u=!1)})},function(t){var e=t.deltaY;d("value",Kt(s-Math.ceil(e/10),0,100))}]}var se=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),oe.getElementById("svelte-16y1m1m-style")||((r=V("style")).id="svelte-16y1m1m-style",r.textContent=".volume.svelte-16y1m1m.svelte-16y1m1m{position:relative}.volume.svelte-16y1m1m .volume-control.svelte-16y1m1m{height:100px}",F(oe.head,r)),Ht(s(o),t,ae,le,w,{onChange:7,disabled:0,value:1}),o}return i}();function ue(t,e,n){var i=t.slice();return i[21]=e[n],i}function ce(t,e,n){var i=t.slice();return i[24]=e[n],i}function de(t){for(var e,n,i=null!=t[0]&&fe(t),o=t[3],r=[],l=0;l<o.length;l+=1)r[l]=me(ue(t,o,l));return{c:function(){e=V("div"),i&&i.c(),n=Z();for(var t=0;t<r.length;t+=1)r[t].c();R(e,"class","panel svelte-73epzt")},m:function(t,o){H(t,e,o),i&&i.m(e,null),F(e,n);for(var l=0;l<r.length;l+=1)r[l].m(e,null)},p:function(t,l){if(null!=t[0]?i?i.p(t,l):((i=fe(t)).c(),i.m(e,n)):i&&(i.d(1),i=null),522&l){var a;for(o=t[3],a=0;a<o.length;a+=1){var s=ue(t,o,a);r[a]?r[a].p(s,l):(r[a]=me(s),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=o.length}},d:function(t){t&&_(e),i&&i.d(),E(r,t)}}}function fe(t){for(var e,n,i,o,r,l,a,s,u,c,d=t[2],f=[],p=0;p<d.length;p+=1)f[p]=ve(ce(t,d,p));return{c:function(){e=V("div"),n=V("div"),i=V("div"),o=T(t[7]),r=Z(),l=V("div"),a=Z(),s=V("div");for(var u=0;u<f.length;u+=1)f[u].c();R(l,"class","arrow svelte-73epzt"),R(i,"class","line-label svelte-73epzt"),R(s,"class","option-wrap"),R(n,"class","line-selector svelte-73epzt"),X(n,"height",(t[5]?22*t[2].length+2:22)+"px"),R(e,"class","line-wrap svelte-73epzt")},m:function(d,p){H(d,e,p),F(e,n),F(n,i),F(i,o),F(i,r),F(i,l),F(n,a),F(n,s);for(var v=0;v<f.length;v+=1)f[v].m(s,null);u||(c=[P(n,"mouseenter",t[16]),P(n,"mouseleave",t[17])],u=!0)},p:function(t,e){if(128&e&&O(o,t[7]),1029&e){var i;for(d=t[2],i=0;i<d.length;i+=1){var r=ce(t,d,i);f[i]?f[i].p(r,e):(f[i]=ve(r),f[i].c(),f[i].m(s,null))}for(;i<f.length;i+=1)f[i].d(1);f.length=d.length}36&e&&X(n,"height",(t[5]?22*t[2].length+2:22)+"px")},d:function(t){t&&_(e),E(f,t),u=!1,y(c)}}}function pe(t){var e,n,i,o,r,l=t[24].label+"";function a(){return t[15](t[24])}return{c:function(){e=V("div"),n=T(l),i=Z(),R(e,"class","option svelte-73epzt"),Y(e,"selected",t[24].value==t[0])},m:function(t,l){H(t,e,l),F(e,n),F(e,i),o||(r=P(e,"click",a),o=!0)},p:function(i,o){t=i,4&o&&l!==(l=t[24].label+"")&&O(n,l),5&o&&Y(e,"selected",t[24].value==t[0])},d:function(t){t&&_(e),o=!1,r()}}}function ve(t){var e,n=t[24].value!==t[0]&&pe(t);return{c:function(){n&&n.c(),e=j()},m:function(t,i){n&&n.m(t,i),H(t,e,i)},p:function(t,i){t[24].value!==t[0]?n?n.p(t,i):((n=pe(t)).c(),n.m(e.parentNode,e)):n&&(n.d(1),n=null)},d:function(t){n&&n.d(t),t&&_(e)}}}function me(t){var e,n,i,o,r,l=t[21].label+"";function a(){return t[18](t[21])}return{c:function(){e=V("div"),n=T(l),i=Z(),R(e,"class","quality-it svelte-73epzt"),Y(e,"selected",t[21].value==t[1])},m:function(t,l){H(t,e,l),F(e,n),F(e,i),o||(r=P(e,"click",a),o=!0)},p:function(i,o){t=i,8&o&&l!==(l=t[21].label+"")&&O(n,l),10&o&&Y(e,"selected",t[21].value==t[1])},d:function(t){t&&_(e),o=!1,r()}}}function he(t){var e,n,i,o,r,l,a=t[6]&&de(t);return{c:function(){e=V("div"),a&&a.c(),n=Z(),i=V("span"),o=T(t[8]),R(i,"class","text"),R(e,"class","quality-wrap svelte-73epzt")},m:function(s,u){H(s,e,u),a&&a.m(e,null),F(e,n),F(e,i),F(i,o),r||(l=[P(e,"mouseenter",t[19]),P(e,"mouseleave",t[20])],r=!0)},p:function(t,i){var r=d(i,1)[0];t[6]?a?a.p(t,r):((a=de(t)).c(),a.m(e,n)):a&&(a.d(1),a=null),256&r&&O(o,t[8])},i:m,o:m,d:function(t){t&&_(e),a&&a.d(),r=!1,y(l)}}}function ge(t,e,n){var i,o,r,l,a=e.lineList,s=void 0===a?[]:a,u=e.qualityList,c=void 0===u?[]:u,d=e.line,f=void 0===d?"":d,p=e.quality,v=void 0===p?"":p,m=e.onChange,h=!1,g=!1,x=function(t){t!==v&&(m?m("quality",t):n(1,v=t))},y=function(t){t!==f&&(m?m("line",t):n(0,f=t))},b=Qt(100),w=b.onEnter,C=b.onLeave;return t.$$set=function(t){"lineList"in t&&n(2,s=t.lineList),"qualityList"in t&&n(3,c=t.qualityList),"line"in t&&n(0,f=t.line),"quality"in t&&n(1,v=t.quality),"onChange"in t&&n(4,m=t.onChange)},t.$$.update=function(){8197&t.$$.dirty&&n(7,i=null===n(13,r=s.find(function(t){var e=t.value;return f===e}))||void 0===r?void 0:r.label),16394&t.$$.dirty&&n(8,o=null===n(14,l=c.find(function(t){var e=t.value;return v===e}))||void 0===l?void 0:l.label)},[f,v,s,c,m,h,g,i,o,x,y,w,C,r,l,function(t){return y(t.value)},function(){return n(5,h=!0)},function(){return n(5,h=!1)},function(t){return x(t.value)},function(){return w(function(){n(6,g=!0),m("qualityPanelShow",g)})},function(){return C(function(){n(6,g=!1),m("qualityPanelShow",g)})}]}var xe=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),document.getElementById("svelte-73epzt-style")||((r=V("style")).id="svelte-73epzt-style",r.textContent=".quality-wrap.svelte-73epzt.svelte-73epzt{position:relative}.quality-wrap.svelte-73epzt .panel.svelte-73epzt{padding:9px 0;min-height:94px}.quality-wrap.svelte-73epzt .line-wrap.svelte-73epzt{width:66px;margin-bottom:28px;padding:3px 20px 0 20px;position:relative}.quality-wrap.svelte-73epzt .line-wrap .line-selector.svelte-73epzt{width:66px;border:1px solid rgba(255, 255, 255, 0.4);-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:2px;position:absolute;background:#212121;-webkit-transition:height 0.1s ease-in-out;transition:height 0.1s ease-in-out;overflow:hidden}.quality-wrap.svelte-73epzt .line-wrap .line-label.svelte-73epzt,.quality-wrap.svelte-73epzt .line-wrap .option.svelte-73epzt{height:22px;padding-left:9px;line-height:22px}.quality-wrap.svelte-73epzt .line-wrap .line-label.svelte-73epzt{position:relative}.quality-wrap.svelte-73epzt .line-wrap .arrow.svelte-73epzt{width:0;height:0;top:8px;right:8px;border:4px solid transparent;border-top:6px solid #797979;position:absolute}.quality-wrap.svelte-73epzt .quality-it.svelte-73epzt,.quality-wrap.svelte-73epzt .option.svelte-73epzt{cursor:pointer;line-height:22px}.quality-wrap.svelte-73epzt .quality-it.svelte-73epzt:hover,.quality-wrap.svelte-73epzt .option.svelte-73epzt:hover{background-color:rgba(255, 255, 255, 0.1)}.quality-wrap.svelte-73epzt .quality-it.svelte-73epzt{padding:0 20px}.quality-wrap.svelte-73epzt .quality-it.selected.svelte-73epzt{color:#23ade5}.quality-wrap.svelte-73epzt .quality-it.svelte-73epzt,.quality-wrap.svelte-73epzt .line-label.svelte-73epzt{white-space:nowrap;word-break:keep-all}",F(document.head,r)),Ht(s(o),t,ge,he,w,{lineList:2,qualityList:3,line:0,quality:1,onChange:4}),o}return i}();function ye(t){var e,n,i,o,r,l,a,s,u;return{c:function(){e=V("div"),n=V("div"),(i=V("div")).textContent="播放器",o=Z(),r=V("input"),l=Z(),(a=V("label")).textContent="HTML5",R(i,"class","label svelte-1c429zu"),R(r,"type","radio"),R(r,"name","player-type"),R(r,"id","html5"),r.__value="html5",r.value=r.__value,t[7][0].push(r),R(a,"for","html5"),R(a,"class","svelte-1c429zu"),R(n,"class","player-type svelte-1c429zu"),R(e,"class","panel setting-panel svelte-1c429zu")},m:function(c,d){H(c,e,d),F(e,n),F(n,i),F(n,o),F(n,r),r.checked=r.__value===t[0],F(n,l),F(n,a),s||(u=[P(r,"click",t[5]),P(r,"change",t[6])],s=!0)},p:function(t,e){1&e&&(r.checked=r.__value===t[0])},d:function(n){n&&_(e),t[7][0].splice(t[7][0].indexOf(r),1),s=!1,y(u)}}}function be(t){var e,n,i,o,r,l=t[2]&&ye(t);return{c:function(){e=V("div"),l&&l.c(),n=Z(),R(i=V("span"),"class","icon"),R(e,"class","setting svelte-1c429zu")},m:function(a,s){H(a,e,s),l&&l.m(e,null),F(e,n),F(e,i),i.innerHTML='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg"    xmlns:xlink="http://www.w3.org/1999/xlink">    \x3c!-- Generator: Sketch 63.1 (92452) - https://sketch.com --\x3e            <g id="终稿" stroke="none" stroke-width="1" fill-rule="evenodd" opacity="0.9">        <g id="图标切图" transform="translate(-439.000000, -120.000000)">            <g id="编组-3" transform="translate(421.000000, 56.000000)">                <g id="编组-7" transform="translate(18.000000, 64.000000)">                    <g id="icon_设置" transform="translate(7.000000, 7.000000)">                        <g id="Group-2-Copy-6">                            <g id="player_setting">                                <path                                    d="M12.1355728,17.8458478 C11.7659721,17.9061404 11.3866469,17.9374882 11,17.9374882 C10.6133531,17.9374882 10.2340279,17.9061404 9.86442721,17.8458478 L8.82459672,19.1089545 C8.51390489,19.4863592 7.97590114,19.5838288 7.55255402,19.3394092 L5.55571956,18.1865363 C5.13237243,17.9421167 4.94778172,17.427457 5.11927787,16.9696876 L5.67630577,15.4828303 L5.67630577,15.4828303 C5.15507014,14.8729186 4.73681236,14.1723594 4.44845574,13.408076 L2.83560101,13.1392668 C2.35341304,13.0589022 2,12.6417121 2,12.1528729 L2,9.84712709 C2,9.35828794 2.35341304,8.94109783 2.83560101,8.86073316 L4.39976975,8.60003837 L4.39976975,8.60003837 C4.67272638,7.82931533 5.07685543,7.12062603 5.58532098,6.50080638 L5.01100429,4.9678006 C4.83950815,4.51003124 5.02409886,3.99537151 5.44744598,3.75095193 L7.44428044,2.59807902 C7.86762757,2.35365945 8.40563132,2.45112906 8.71632314,2.82853376 L9.72466395,4.05338917 L9.72466395,4.05338917 C10.1381953,3.9772668 10.5644523,3.93748822 11,3.93748822 C11.4355477,3.93748822 11.8618047,3.9772668 12.2753361,4.05338917 L13.2836769,2.82853376 C13.5943687,2.45112906 14.1323724,2.35365945 14.5557196,2.59807902 L16.552554,3.75095193 C16.9759011,3.99537151 17.1604919,4.51003124 16.9889957,4.9678006 L16.414679,6.50080638 L16.414679,6.50080638 C16.9231446,7.12062603 17.3272736,7.82931533 17.6002302,8.60003837 L19.164399,8.86073316 C19.646587,8.94109783 20,9.35828794 20,9.84712709 L20,12.1528729 C20,12.6417121 19.646587,13.0589022 19.164399,13.1392668 L17.5515443,13.408076 L17.5515443,13.408076 C17.2631876,14.1723594 16.8449299,14.8729186 16.3236942,15.4828303 L16.8807221,16.9696876 C17.0522183,17.427457 16.8676276,17.9421167 16.4442804,18.1865363 L14.447446,19.3394092 C14.0240989,19.5838288 13.4860951,19.4863592 13.1754033,19.1089545 L12.1355728,17.8458478 L12.1355728,17.8458478 Z M11,15 C13.209139,15 15,13.209139 15,11 C15,8.790861 13.209139,7 11,7 C8.790861,7 7,8.790861 7,11 C7,13.209139 8.790861,15 11,15 Z M11,13 C9.8954305,13 9,12.1045695 9,11 C9,9.8954305 9.8954305,9 11,9 C12.1045695,9 13,9.8954305 13,11 C13,12.1045695 12.1045695,13 11,13 Z"                                    id="Combined-Shape"></path>                            </g>                        </g>                    </g>                </g>            </g>        </g>    </g></svg>',o||(r=[P(e,"mouseenter",t[8]),P(e,"mouseleave",t[9])],o=!0)},p:function(t,i){var o=d(i,1)[0];t[2]?l?l.p(t,o):((l=ye(t)).c(),l.m(e,n)):l&&(l.d(1),l=null)},i:m,o:m,d:function(t){t&&_(e),l&&l.d(),o=!1,y(r)}}}function we(t,e,n){var i=e.playerType,o=void 0===i?"html5":i,r=e.onChange,l=!1,a=Qt(100),s=a.onEnter,u=a.onLeave;return t.$$set=function(t){"playerType"in t&&n(0,o=t.playerType),"onChange"in t&&n(1,r=t.onChange)},[o,r,l,s,u,function(){return"html5"!==o&&r("playerType","html5")},function(){o=this.__value,n(0,o)},[[]],function(){return s(function(){n(2,l=!0)})},function(){return u(function(){n(2,l=!1)})}]}var Ce=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),document.getElementById("svelte-1c429zu-style")||((r=V("style")).id="svelte-1c429zu-style",r.textContent=".setting.svelte-1c429zu.svelte-1c429zu{position:relative}.setting-panel.svelte-1c429zu.svelte-1c429zu{width:63px;padding:12px 20px}.player-type.svelte-1c429zu .label.svelte-1c429zu{margin-bottom:4px}.player-type.svelte-1c429zu label.svelte-1c429zu{white-space:nowrap;word-break:keep-all}",F(document.head,r)),Ht(s(o),t,we,be,w,{playerType:0,onChange:1}),o}return i}(),$e=Lt.document;function ke(t){var e,n,i,o,r,l,a,s,u,c,f=t[3](t[0])+"";return{c:function(){e=V("div"),n=V("div"),i=V("div"),o=Z(),r=V("div"),l=Z(),a=V("div"),s=T(f),X(i,"left",t[7]+"px"),R(i,"class","slider-handle svelte-19p8uhx"),Y(i,"left-trans",!t[6]),X(r,"width",(t[0]-t[2])/(t[1]-t[2])*100+"%"),R(r,"class","slider-track svelte-19p8uhx"),Y(r,"width-trans",!t[6]),R(n,"class","slider-rail svelte-19p8uhx"),R(a,"class","number svelte-19p8uhx"),R(e,"class","horizontal-slider-wrap svelte-19p8uhx")},m:function(d,f){H(d,e,f),F(e,n),F(n,i),t[13](i),F(n,o),F(n,r),t[14](n),F(e,l),F(e,a),F(a,s),u||(c=[P(i,"mousedown",t[10]),P(n,"mousedown",t[9]),P(e,"wheel",I(B(t[15])))],u=!0)},p:function(t,e){var n=d(e,1)[0];128&n&&X(i,"left",t[7]+"px"),64&n&&Y(i,"left-trans",!t[6]),7&n&&X(r,"width",(t[0]-t[2])/(t[1]-t[2])*100+"%"),64&n&&Y(r,"width-trans",!t[6]),9&n&&f!==(f=t[3](t[0])+"")&&O(s,f)},i:m,o:m,d:function(n){n&&_(e),t[13](null),t[14](null),u=!1,y(c)}}}function Le(t,e,n){var i,o,r,l,a,s=Number(null!==(r=getComputedStyle(document.documentElement).zoom)&&void 0!==r?r:1),u=e.max,c=void 0===u?100:u,d=e.min,f=void 0===d?0:d,p=e.value,v=void 0===p?c:p,m=e.onChange,h=void 0===m?null:m,g=e.valueFormater,x=void 0===g?function(t){return t}:g,y=!1,b=function(t){var e=Kt(t,f,c);h?h(e):n(0,v=e)};return t.$$set=function(t){"max"in t&&n(1,c=t.max),"min"in t&&n(2,f=t.min),"value"in t&&n(0,v=t.value),"onChange"in t&&n(11,h=t.onChange),"valueFormater"in t&&n(3,x=t.valueFormater)},t.$$.update=function(){16&t.$$.dirty&&n(12,i=(null==l?void 0:l.clientWidth)-12),4103&t.$$.dirty&&n(7,o=(v-f)/(c-f)*i)},[v,c,f,x,l,a,y,o,b,function(t){t.target!==a&&b((t.clientX/s-l.getBoundingClientRect().left)/i*(c-f)+f-(c-f)/i*6)},function(t){var e=t.clientX/s,o=v;n(6,y=!0);var r=function(t){var n=t.clientX/s-e;b(o+n*((c-f)/i))};document.addEventListener("mousemove",r),document.addEventListener("mouseup",function t(){n(6,y=!1),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",t)})},h,i,function(t){ot[t?"unshift":"push"](function(){n(5,a=t)})},function(t){ot[t?"unshift":"push"](function(){n(4,l=t)})},function(t){var e=t.deltaY;b(v+Math.ceil(e/10))}]}var Se=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),$e.getElementById("svelte-19p8uhx-style")||((r=V("style")).id="svelte-19p8uhx-style",r.textContent=".horizontal-slider-wrap.svelte-19p8uhx.svelte-19p8uhx{-webkit-box-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.horizontal-slider-wrap.svelte-19p8uhx .number.svelte-19p8uhx{width:31px;-ms-flex-negative:0;flex-shrink:0;margin-left:10px}.horizontal-slider-wrap.svelte-19p8uhx .slider-rail.svelte-19p8uhx{height:2px;-webkit-box-flex:1;-ms-flex:1;flex:1;position:relative;padding:5px 0;background:rgba(255, 255, 255, 0.2);background-clip:content-box;border-radius:10px;cursor:pointer}.horizontal-slider-wrap.svelte-19p8uhx .slider-handle.svelte-19p8uhx{width:12px;height:12px;position:absolute;top:0;z-index:1;border-radius:50%;background-color:#00a1d6}.horizontal-slider-wrap.svelte-19p8uhx .slider-handle.left-trans.svelte-19p8uhx{-webkit-transition:left 0.2s ease-in-out;transition:left 0.2s ease-in-out}.horizontal-slider-wrap.svelte-19p8uhx .slider-track.svelte-19p8uhx{position:absolute;height:2px;background-color:#00a1d6}.horizontal-slider-wrap.svelte-19p8uhx .slider-track.width-trans.svelte-19p8uhx{-webkit-transition:width 0.2s ease-in-out;transition:width 0.2s ease-in-out}",F($e.head,r)),Ht(s(o),t,Le,ke,w,{max:1,min:2,value:0,onChange:11,valueFormater:3}),o}return i}(),Me=Lt.document;function ze(t){var e,n,i,o,r,l,a,s,u,c,f,p;return{c:function(){e=V("div"),n=V("div"),i=Z(),(o=V("div")).innerHTML='<div class="title svelte-xpny31">1/4屏</div>',r=Z(),(l=V("div")).innerHTML='<div class="title svelte-xpny31">半屏</div>',a=Z(),(s=V("div")).innerHTML='<div class="title svelte-xpny31">3/4屏</div>',u=Z(),(c=V("div")).innerHTML='<div class="title svelte-xpny31">全屏</div>',R(n,"class","handle svelte-xpny31"),X(n,"left",t[1]+"px"),R(o,"class","step1 svelte-xpny31"),R(l,"class","step2 svelte-xpny31"),R(s,"class","step3 svelte-xpny31"),R(c,"class","step4 svelte-xpny31"),R(e,"class","steps svelte-xpny31")},m:function(d,v){H(d,e,v),F(e,n),F(e,i),F(e,o),F(e,r),F(e,l),F(e,a),F(e,s),F(e,u),F(e,c),t[6](e),f||(p=[P(n,"mousedown",t[3]),P(e,"click",t[2])],f=!0)},p:function(t,e){2&d(e,1)[0]&&X(n,"left",t[1]+"px")},i:m,o:m,d:function(n){n&&_(e),t[6](null),f=!1,y(p)}}}function qe(t,e,n){var i,o,r,l=e.value,a=void 0===l?4:l,s=e.onChange,u=void 0===s?null:s,c=Number(null!==(o=getComputedStyle(document.documentElement).zoom)&&void 0!==o?o:1),d=function(t){var e=Kt(Math.round(t)+1,1,4);e!==a&&(u?u(e):n(4,a=e))};return t.$$set=function(t){"value"in t&&n(4,a=t.value),"onChange"in t&&n(5,u=t.onChange)},t.$$.update=function(){17&t.$$.dirty&&n(1,i=((null==r?void 0:r.clientWidth)-12)*(Math.round(a-1)/3))},[r,i,function(t){d(3*(t.clientX/c-r.getBoundingClientRect().left)/r.clientWidth)},function(){var t=r.getBoundingClientRect().left,e=function(e){d(3*(e.clientX/c-t)/r.clientWidth)};document.addEventListener("mousemove",e),document.addEventListener("mouseup",function t(){document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",t)})},a,u,function(t){ot[t?"unshift":"push"](function(){n(0,r=t)})}]}var Fe=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),Me.getElementById("svelte-xpny31-style")||((r=V("style")).id="svelte-xpny31-style",r.textContent=".steps.svelte-xpny31.svelte-xpny31{-webkit-box-flex:1;-ms-flex:1;flex:1;display:-webkit-box;display:-ms-flexbox;display:flex;height:2px;background:rgba(255, 255, 255, 0.2);background-clip:content-box;padding:7px 0;position:relative;cursor:pointer}.step1.svelte-xpny31.svelte-xpny31,.step2.svelte-xpny31.svelte-xpny31,.step3.svelte-xpny31.svelte-xpny31,.step4.svelte-xpny31.svelte-xpny31{-webkit-box-flex:1;-ms-flex:1;flex:1;position:relative}.step1.svelte-xpny31.svelte-xpny31::before,.step2.svelte-xpny31.svelte-xpny31::before,.step3.svelte-xpny31.svelte-xpny31::before,.step4.svelte-xpny31.svelte-xpny31::before{content:'';width:2px;height:4px;background:rgba(255, 255, 255, 0.2);border-radius:2px;position:absolute;-webkit-transform:translateY(-1px);transform:translateY(-1px)}.step2.svelte-xpny31 .title.svelte-xpny31{left:33.333%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.step2.svelte-xpny31.svelte-xpny31::before{left:33.333%}.step3.svelte-xpny31 .title.svelte-xpny31{right:33.333%;-webkit-transform:translateX(50%);transform:translateX(50%)}.step3.svelte-xpny31.svelte-xpny31::before{right:33.333%}.step4.svelte-xpny31 .title.svelte-xpny31{right:0}.step4.step4.svelte-xpny31.svelte-xpny31::before{right:0}.title.svelte-xpny31.svelte-xpny31{position:absolute;top:-21px;color:rgba(255, 255, 255, 0.8)}.handle.svelte-xpny31.svelte-xpny31{position:absolute;top:2px;z-index:1;width:12px;height:12px;border-radius:50%;background:#00a1d6;-webkit-transition:left 0.2s ease-in-out;transition:left 0.2s ease-in-out}",F(Me.head,r)),Ht(s(o),t,qe,ze,w,{value:4,onChange:5}),o}return i}();function He(t){var e,n,i,o,r,l,a,s,u,c,d,f,p,v,m,h,g,x,y,b,w,C,$;l=new Se({props:{value:t[0].opacity,onChange:t[7],min:10,max:100,valueFormater:t[3]}}),d=new Se({props:{value:t[0].fontScale,onChange:t[8],min:10,max:200,valueFormater:t[3]}}),h=new Se({props:{value:t[0].density,onChange:t[9],min:10,max:100,valueFormater:t[3]}}),w=new Fe({props:{value:t[0].area,onChange:t[10]}});var k=t[0].showMaskOption&&_e(t);return{c:function(){e=V("div"),n=V("div"),i=V("div"),(o=V("div")).textContent="不透明度",r=Z(),Mt(l.$$.fragment),a=Z(),s=V("div"),(u=V("div")).textContent="字号缩放",c=Z(),Mt(d.$$.fragment),f=Z(),p=V("div"),(v=V("div")).textContent="同屏密度",m=Z(),Mt(h.$$.fragment),g=Z(),x=V("div"),(y=V("div")).textContent="显示区域",b=Z(),Mt(w.$$.fragment),C=Z(),k&&k.c(),R(o,"class","item-title svelte-15b8sms"),R(i,"class","item svelte-15b8sms"),R(u,"class","item-title svelte-15b8sms"),R(s,"class","item svelte-15b8sms"),R(v,"class","item-title svelte-15b8sms"),R(p,"class","item svelte-15b8sms"),R(n,"class","base-setting svelte-15b8sms"),R(y,"class","item-title svelte-15b8sms"),R(x,"class","area-setting svelte-15b8sms"),R(e,"class","panel danmaku-control svelte-15b8sms")},m:function(t,L){H(t,e,L),F(e,n),F(n,i),F(i,o),F(i,r),zt(l,i,null),F(n,a),F(n,s),F(s,u),F(s,c),zt(d,s,null),F(n,f),F(n,p),F(p,v),F(p,m),zt(h,p,null),F(e,g),F(e,x),F(x,y),F(x,b),zt(w,x,null),F(e,C),k&&k.m(e,null),$=!0},p:function(t,n){var i={};1&n&&(i.value=t[0].opacity),2&n&&(i.onChange=t[7]),l.$set(i);var o={};1&n&&(o.value=t[0].fontScale),2&n&&(o.onChange=t[8]),d.$set(o);var r={};1&n&&(r.value=t[0].density),2&n&&(r.onChange=t[9]),h.$set(r);var a={};1&n&&(a.value=t[0].area),2&n&&(a.onChange=t[10]),w.$set(a),t[0].showMaskOption?k?k.p(t,n):((k=_e(t)).c(),k.m(e,null)):k&&(k.d(1),k=null)},i:function(t){$||(wt(l.$$.fragment,t),wt(d.$$.fragment,t),wt(h.$$.fragment,t),wt(w.$$.fragment,t),$=!0)},o:function(t){Ct(l.$$.fragment,t),Ct(d.$$.fragment,t),Ct(h.$$.fragment,t),Ct(w.$$.fragment,t),$=!1},d:function(t){t&&_(e),qt(l),qt(d),qt(h),qt(w),k&&k.d()}}}function _e(t){var e,n,i,o,r,l,a;return{c:function(){e=V("div"),n=V("input"),o=Z(),(r=V("label")).textContent="智能防挡弹幕",R(n,"type","checkbox"),R(n,"id","mask"),n.checked=i=t[0].enableMask,R(r,"for","mask"),R(r,"class","svelte-15b8sms"),R(e,"class","other-setting svelte-15b8sms")},m:function(i,s){H(i,e,s),F(e,n),F(e,o),F(e,r),l||(a=P(n,"click",t[11]),l=!0)},p:function(t,e){1&e&&i!==(i=t[0].enableMask)&&(n.checked=i)},d:function(t){t&&_(e),l=!1,a()}}}function Ee(t){var e,n,i,o,r,l,a=t[2]&&He(t);return{c:function(){e=V("div"),a&&a.c(),n=Z(),R(i=V("span"),"class","icon"),R(e,"class","danmaku")},m:function(s,u){H(s,e,u),a&&a.m(e,null),F(e,n),F(e,i),i.innerHTML='<svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">    <path id="Combined-Shape"    d="M11,10.9,25,11a1.92,1.92,0,0,1,2,1.9V23a2,2,0,0,1-2,2H11a2,2,0,0,1-2-2V13A2.09,2.09,0,0,1,11,10.9ZM13,14a.94.94,0,0,0,1,1h8a1,1,0,0,0,1-1,.94.94,0,0,0-1-1H14A.94.94,0,0,0,13,14Zm-2,4.1a.94.94,0,0,0,1,1h4a1,1,0,0,0,1-1,.94.94,0,0,0-1-1H12C11.4,17,11,17.5,11,18.1ZM12,22a.94.94,0,0,0,1,1h5a1,1,0,0,0,1-1,.94.94,0,0,0-1-1H13A1,1,0,0,0,12,22Zm6-4a.94.94,0,0,0,1,1h1a1,1,0,0,0,0-2H19A.94.94,0,0,0,18,18Z"    style="fill-rule:evenodd;isolation:isolate" /></svg>',o=!0,r||(l=[P(e,"mouseenter",t[12]),P(e,"mouseleave",t[13])],r=!0)},p:function(t,i){var o=d(i,1)[0];t[2]?a?(a.p(t,o),4&o&&wt(a,1)):((a=He(t)).c(),wt(a,1),a.m(e,n)):a&&(yt(),Ct(a,1,1,function(){a=null}),bt())},i:function(t){o||(wt(a),o=!0)},o:function(t){Ct(a),o=!1},d:function(t){t&&_(e),a&&a.d(),r=!1,y(l)}}}function Ve(t,e,n){var i=e.options,o=e.onChange,r=!1,l=function(t){o("enableMask",t.target.checked)},a=Qt(100),s=a.onEnter,u=a.onLeave;return t.$$set=function(t){"options"in t&&n(0,i=t.options),"onChange"in t&&n(1,o=t.onChange)},[i,o,r,function(t){return"".concat(t,"%")},l,s,u,function(t){return o("opacity",t)},function(t){return o("fontScale",t)},function(t){return o("density",t)},function(t){return o("area",t)},function(t){return l(t)},function(){return s(function(){n(2,r=!0)})},function(){return u(function(){n(2,r=!1)})}]}var Te=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),document.getElementById("svelte-15b8sms-style")||((r=V("style")).id="svelte-15b8sms-style",r.textContent=".danmaku-control.panel.svelte-15b8sms.svelte-15b8sms{width:298px;padding:20px;-webkit-box-sizing:border-box;box-sizing:border-box;left:auto;right:12px;-webkit-transform:translate(0, -100%);transform:translate(0, -100%)}.base-setting.svelte-15b8sms .item.svelte-15b8sms{display:-webkit-box;display:-ms-flexbox;display:flex;margin-bottom:12px}.item-title.svelte-15b8sms.svelte-15b8sms{margin-right:10px}.area-setting.svelte-15b8sms.svelte-15b8sms{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-top:26px}.other-setting.svelte-15b8sms.svelte-15b8sms{margin-top:14px}.other-setting.svelte-15b8sms label.svelte-15b8sms{margin-right:20px}",F(document.head,r)),Ht(s(o),t,Ve,Ee,w,{options:0,onChange:1}),o}return i}();function Ze(t){var e,n,i,o,r,l,a;return{c:function(){e=V("div"),n=V("div"),i=V("input"),o=Z(),(r=V("div")).textContent="发送",R(i,"placeholder","发个弹幕呗~"),R(i,"class","send-panel-input svelte-1g87leh"),R(i,"maxlength","20"),R(n,"class","send-panel-container svelte-1g87leh"),R(r,"class","send-panel-btn svelte-1g87leh"),R(e,"class","send-panel-wrap svelte-1g87leh")},m:function(s,u){H(s,e,u),F(e,n),F(n,i),G(i,t[0]),F(e,o),F(e,r),l||(a=[P(i,"input",t[3]),P(i,"blur",t[4]),P(i,"focus",t[5]),P(r,"click",t[6])],l=!0)},p:function(t,e){1&d(e,1)[0]&&i.value!==t[0]&&G(i,t[0])},i:m,o:m,d:function(t){t&&_(e),l=!1,y(a)}}}function je(t,e,n){var i=e.dmMsg,o=e.onSend,r=e.foucsChange,l=function(t){13===t.keyCode&&o(i)};return et(function(){window.addEventListener("keydown",l)}),nt(function(){window.removeEventListener("keydown",l)}),t.$$set=function(t){"dmMsg"in t&&n(0,i=t.dmMsg),"onSend"in t&&n(1,o=t.onSend),"foucsChange"in t&&n(2,r=t.foucsChange)},[i,o,r,function(){i=this.value,n(0,i)},function(){r(!1)},function(){r(!0)},function(){o(i)}]}var Pe=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),document.getElementById("svelte-1g87leh-style")||((r=V("style")).id="svelte-1g87leh-style",r.textContent=".send-panel-wrap.svelte-1g87leh{position:absolute;height:32px;width:400px;left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}.send-panel-container.svelte-1g87leh{display:-webkit-box;display:-ms-flexbox;display:flex;width:400px;height:32px;background:rgba(255, 255, 255, 0.4);border-radius:15.5px}.send-panel-input.svelte-1g87leh{outline:none;border-radius:15.5px;background:0 0;border:0;width:100%;padding-left:26px;color:#FFFFFF;font-family:PingFang SC;font-style:normal;font-weight:normal;font-size:14px;line-height:20px}.send-panel-input.svelte-1g87leh::-webkit-input-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh::-moz-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh:-ms-input-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh::-ms-input-placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-input.svelte-1g87leh::placeholder{position:absolute;height:20px;top:calc(50% - 20px/2);font-size:14px;line-height:20px;color:#FFFFFF}.send-panel-btn.svelte-1g87leh{width:60px;height:24px;background:#23ade5;border-radius:19px;color:#FFFFFF;margin-top:4px;text-align:center;line-height:26px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;position:absolute;top:0;right:5px}",F(document.head,r)),Ht(s(o),t,je,Ze,w,{dmMsg:0,onSend:1,foucsChange:2}),o}return i}();function Be(t,e,n){var i=t.slice();return i[12]=e[n],i}function Ie(t){var e,n,i,o,r,l=t[12].label+"";function a(){return t[8](t[12])}return{c:function(){e=V("div"),n=T(l),i=Z(),R(e,"class","quality-select svelte-1ildxxc"),Y(e,"selected",t[12].value==t[0])},m:function(t,l){H(t,e,l),F(e,n),F(e,i),o||(r=P(e,"click",a),o=!0)},p:function(i,o){t=i,4&o&&l!==(l=t[12].label+"")&&O(n,l),5&o&&Y(e,"selected",t[12].value==t[0])},d:function(t){t&&_(e),o=!1,r()}}}function Re(t){for(var e,n,i,o,r,l,a,s,u,c=t[2],f=[],p=0;p<c.length;p+=1)f[p]=Ie(Be(t,c,p));return{c:function(){e=V("div"),n=V("div"),i=V("div");for(var s=0;s<f.length;s+=1)f[s].c();r=Z(),l=V("span"),a=T(t[5]),R(i,"class","quality-scroll svelte-1ildxxc"),R(n,"class",o=k(t[4]?"quality-container quality-container-show":"quality-container")+" svelte-1ildxxc"),R(l,"class","text")},m:function(o,c){H(o,e,c),F(e,n),F(n,i);for(var d=0;d<f.length;d+=1)f[d].m(i,null);t[9](n),F(e,r),F(e,l),F(l,a),s||(u=P(l,"click",t[10]),s=!0)},p:function(t,e){var r=d(e,1)[0];if(29&r){var l;for(c=t[2],l=0;l<c.length;l+=1){var s=Be(t,c,l);f[l]?f[l].p(s,r):(f[l]=Ie(s),f[l].c(),f[l].m(i,null))}for(;l<f.length;l+=1)f[l].d(1);f.length=c.length}16&r&&o!==(o=k(t[4]?"quality-container quality-container-show":"quality-container")+" svelte-1ildxxc")&&R(n,"class",o),32&r&&O(a,t[5])},i:m,o:m,d:function(n){n&&_(e),E(f,n),t[9](null),s=!1,u()}}}function Ae(t,e,n){var i,o,r=e.container,l=e.qualityList,a=void 0===l?[]:l,s=e.quality,u=void 0===s?"":s,c=e.onChange,d=!1,f=e.ref,p=function(t){null!=f&&(f.contains(t.target)||n(4,d=!1))};return et(function(){null!=r&&(r.append(f),r.addEventListener("touchstart",p))}),nt(function(){null!=r&&(r.removeChild(f),r.removeEventListener("touchstart",p))}),t.$$set=function(t){"container"in t&&n(6,r=t.container),"qualityList"in t&&n(2,a=t.qualityList),"quality"in t&&n(0,u=t.quality),"onChange"in t&&n(3,c=t.onChange),"ref"in t&&n(1,f=t.ref)},t.$$.update=function(){133&t.$$.dirty&&n(5,i=null===n(7,o=a.find(function(t){var e=t.value;return u===e}))||void 0===o?void 0:o.label)},[u,f,a,c,d,i,r,o,function(t){var e=t.value;console.error(e,u),e!==u&&(c?c("quality",e):n(0,u=e),n(4,d=!1),c("qualityPanelShow",d))},function(t){ot[t?"unshift":"push"](function(){n(1,f=t)})},function(){n(4,d=!0),c("qualityPanelShow",d)}]}var Oe=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),document.getElementById("svelte-1ildxxc-style")||((r=V("style")).id="svelte-1ildxxc-style",r.textContent=".quality-container.svelte-1ildxxc.svelte-1ildxxc{position:absolute;right:-160px;z-index:15;width:160px;top:0px;height:100%;-webkit-transition:right 0.5s;transition:right 0.5s;background-color:rgba(0, 0, 0, 0.8);display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.quality-container-show.svelte-1ildxxc.svelte-1ildxxc{right:0px}.quality-scroll.svelte-1ildxxc .svelte-1ildxxc::-webkit-scrollbar{display:none}.quality-scroll.svelte-1ildxxc.svelte-1ildxxc{position:absolute;width:100%;height:85%;overflow-y:scroll;padding-left:24px}.quality-select.svelte-1ildxxc.svelte-1ildxxc{color:#FFFFFF;font-size:14px;margin-bottom:20px}.quality-select.selected.svelte-1ildxxc.svelte-1ildxxc{color:#23ade5}",F(document.head,r)),Ht(s(o),t,Ae,Re,w,{container:6,qualityList:2,quality:0,onChange:3,ref:1}),o}return i}(),Ge=Lt.document;function Xe(t){var e,n,i,o,r,l,a,s,u,c,d,f,p,v,m,h,g,x,y,b,w,C,$=t[15].playStatus&&Ye(t),k=t[15].refresh&&Ne(t),L=t[15].volume&&Ue(t),S=t[15].time&&De(t),M=t[15].leftSetting&&Ke(t),z=t[15].dmSend&&Qe(t),q=t[15].fullScreen&&tn(t),E=t[15].webFullScreen&&!t[13]&&nn(t),T=t[15].webFullScreen&&t[13]&&rn(t),j=t[15].danmaku&&ln(t),P=t[15].rightSetting&&un(t),B=t[15].pip&&document.pictureInPictureEnabled&&cn(t),I=t[15].mirror&&pn(t),A=t[15].quality&&null!=t[8].value&&!t[13]&&mn(t),O=t[15].quality&&null!=t[8].value&&t[13]&&hn(t);return{c:function(){e=V("div"),n=V("div"),i=V("div"),$&&$.c(),o=Z(),k&&k.c(),r=Z(),L&&L.c(),l=Z(),S&&S.c(),a=Z(),M&&M.c(),s=Z(),z&&z.c(),u=Z(),c=V("div"),q&&q.c(),d=Z(),E&&E.c(),f=Z(),T&&T.c(),p=Z(),j&&j.c(),v=Z(),P&&P.c(),m=Z(),B&&B.c(),h=Z(),I&&I.c(),g=Z(),A&&A.c(),x=Z(),O&&O.c(),y=Z(),b=V("div"),R(i,"class","left-area svelte-1dsiks1"),R(b,"class","ext-nodes svelte-1dsiks1"),R(c,"class","right-area svelte-1dsiks1"),R(n,"class","control-area svelte-1dsiks1"),R(e,"class","live-web-player-controller svelte-1dsiks1"),R(e,"style",t[14])},m:function(w,_){H(w,e,_),F(e,n),F(n,i),$&&$.m(i,null),F(i,o),k&&k.m(i,null),F(i,r),L&&L.m(i,null),F(i,l),S&&S.m(i,null),F(i,a),M&&M.m(i,null),F(n,s),z&&z.m(n,null),F(n,u),F(n,c),q&&q.m(c,null),F(c,d),E&&E.m(c,null),F(c,f),T&&T.m(c,null),F(c,p),j&&j.m(c,null),F(c,v),P&&P.m(c,null),F(c,m),B&&B.m(c,null),F(c,h),I&&I.m(c,null),F(c,g),A&&A.m(c,null),F(c,x),O&&O.m(c,null),F(c,y),F(c,b),t[40](b),C=!0},p:function(t,s){t[15].playStatus?$?$.p(t,s):(($=Ye(t)).c(),$.m(i,o)):$&&($.d(1),$=null),t[15].refresh?k?k.p(t,s):((k=Ne(t)).c(),k.m(i,r)):k&&(k.d(1),k=null),t[15].volume?L?(L.p(t,s),32768&s[0]&&wt(L,1)):((L=Ue(t)).c(),wt(L,1),L.m(i,l)):L&&(yt(),Ct(L,1,1,function(){L=null}),bt()),t[15].time?S?(S.p(t,s),32768&s[0]&&wt(S,1)):((S=De(t)).c(),wt(S,1),S.m(i,a)):S&&(yt(),Ct(S,1,1,function(){S=null}),bt()),t[15].leftSetting?M?(M.p(t,s),32768&s[0]&&wt(M,1)):((M=Ke(t)).c(),wt(M,1),M.m(i,null)):M&&(yt(),Ct(M,1,1,function(){M=null}),bt()),t[15].dmSend?z?(z.p(t,s),32768&s[0]&&wt(z,1)):((z=Qe(t)).c(),wt(z,1),z.m(n,u)):z&&(yt(),Ct(z,1,1,function(){z=null}),bt()),t[15].fullScreen?q?(q.p(t,s),32768&s[0]&&wt(q,1)):((q=tn(t)).c(),wt(q,1),q.m(c,d)):q&&(yt(),Ct(q,1,1,function(){q=null}),bt()),t[15].webFullScreen&&!t[13]?E?(E.p(t,s),40960&s[0]&&wt(E,1)):((E=nn(t)).c(),wt(E,1),E.m(c,f)):E&&(yt(),Ct(E,1,1,function(){E=null}),bt()),t[15].webFullScreen&&t[13]?T?T.p(t,s):((T=rn(t)).c(),T.m(c,p)):T&&(T.d(1),T=null),t[15].danmaku?j?(j.p(t,s),32768&s[0]&&wt(j,1)):((j=ln(t)).c(),wt(j,1),j.m(c,v)):j&&(yt(),Ct(j,1,1,function(){j=null}),bt()),t[15].rightSetting?P?(P.p(t,s),32768&s[0]&&wt(P,1)):((P=un(t)).c(),wt(P,1),P.m(c,m)):P&&(yt(),Ct(P,1,1,function(){P=null}),bt()),t[15].pip&&document.pictureInPictureEnabled?B?(B.p(t,s),32768&s[0]&&wt(B,1)):((B=cn(t)).c(),wt(B,1),B.m(c,h)):B&&(yt(),Ct(B,1,1,function(){B=null}),bt()),t[15].mirror?I?(I.p(t,s),32768&s[0]&&wt(I,1)):((I=pn(t)).c(),wt(I,1),I.m(c,g)):I&&(yt(),Ct(I,1,1,function(){I=null}),bt()),t[15].quality&&null!=t[8].value&&!t[13]?A?(A.p(t,s),41216&s[0]&&wt(A,1)):((A=mn(t)).c(),wt(A,1),A.m(c,x)):A&&(yt(),Ct(A,1,1,function(){A=null}),bt()),t[15].quality&&null!=t[8].value&&t[13]?O?(O.p(t,s),41216&s[0]&&wt(O,1)):((O=hn(t)).c(),wt(O,1),O.m(c,y)):O&&(yt(),Ct(O,1,1,function(){O=null}),bt()),(!C||16384&s[0])&&R(e,"style",t[14])},i:function(t){C||(wt(L),wt(S),wt(M),wt(z),wt(q),wt(E),wt(j),wt(P),wt(B),wt(I),wt(A),wt(O),ut(function(){w||(w=kt(e,Vt,{duration:200},!0)),w.run(1)}),C=!0)},o:function(t){Ct(L),Ct(S),Ct(M),Ct(z),Ct(q),Ct(E),Ct(j),Ct(P),Ct(B),Ct(I),Ct(A),Ct(O),w||(w=kt(e,Vt,{duration:200},!1)),w.run(0),C=!1},d:function(n){n&&_(e),$&&$.d(),k&&k.d(),L&&L.d(),S&&S.d(),M&&M.d(),z&&z.d(),q&&q.d(),E&&E.d(),T&&T.d(),j&&j.d(),P&&P.d(),B&&B.d(),I&&I.d(),A&&A.d(),O&&O.d(),t[40](null),n&&w&&w.end()}}}function Ye(t){var e,n,i,o=(t[2]?Zt:jt)+"";return{c:function(){R(e=V("span"),"class","icon")},m:function(r,l){H(r,e,l),e.innerHTML=o,n||(i=P(e,"click",t[24]),n=!0)},p:function(t,n){4&n[0]&&o!==(o=(t[2]?Zt:jt)+"")&&(e.innerHTML=o)},d:function(t){t&&_(e),n=!1,i()}}}function Ne(t){var e,n,i;return{c:function(){R(e=V("span"),"class","icon")},m:function(o,r){H(o,e,r),e.innerHTML='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg"    xmlns:xlink="http://www.w3.org/1999/xlink">    \x3c!-- Generator: Sketch 63.1 (92452) - https://sketch.com --\x3e            <g id="终稿" stroke="none" stroke-width="1" fill-rule="evenodd" opacity="0.9">        <g id="图标切图" transform="translate(-475.000000, -74.000000)" fill-rule="nonzero">            <g id="编组-3" transform="translate(421.000000, 56.000000)">                <g id="编组-12" transform="translate(54.000000, 18.000000)">                    <g id="icon_刷新" transform="translate(11.000000, 9.000000)">                        <path                            d="M1.1040804,5.51795009 L2.56593636,6.98003284 C2.20442812,7.67167421 2,8.45841034 2,9.29289322 C2,12.054317 4.23857625,14.2928932 7,14.2928932 L7,12.5 C7,12.3673918 7.05267842,12.2402148 7.14644661,12.1464466 C7.34170876,11.9511845 7.65829124,11.9511845 7.85355339,12.1464466 L7.85355339,12.1464466 L10.6464466,14.9393398 C10.8417088,15.134602 10.8417088,15.4511845 10.6464466,15.6464466 L10.6464466,15.6464466 L7.85355339,18.4393398 C7.7597852,18.533108 7.63260824,18.5857864 7.5,18.5857864 C7.22385763,18.5857864 7,18.3619288 7,18.0857864 L7,18.0857864 L7,16.2928932 C3.13400675,16.2928932 0,13.1588865 0,9.29289322 C0,7.90269507 0.405257589,6.6071499 1.1040804,5.51795009 Z M6.85355339,0.146446609 C6.94732158,0.240214799 7,0.367391755 7,0.5 L7,2.29289322 C10.8659932,2.29289322 14,5.42689997 14,9.29289322 C14,10.682663 13.5949921,11.977838 12.8965656,13.0668293 L11.4343158,11.6052711 C11.7956669,10.9137463 12,10.127182 12,9.29289322 C12,6.53146947 9.76142375,4.29289322 7,4.29289322 L7,6.08578644 C7,6.36192881 6.77614237,6.58578644 6.5,6.58578644 C6.36739176,6.58578644 6.2402148,6.53310802 6.14644661,6.43933983 L3.35355339,3.64644661 C3.15829124,3.45118446 3.15829124,3.13460197 3.35355339,2.93933983 L6.14644661,0.146446609 C6.34170876,-0.0488155365 6.65829124,-0.0488155365 6.85355339,0.146446609 Z"                            id="Combined-Shape"></path>                    </g>                </g>            </g>        </g>    </g></svg>',n||(i=P(e,"click",t[25]),n=!0)},p:m,d:function(t){t&&_(e),n=!1,i()}}}function Ue(t){var e,n;return e=new se({props:{disabled:t[7].disabled,value:t[7].value,onChange:t[26]}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};128&n[0]&&(i.disabled=t[7].disabled),128&n[0]&&(i.value=t[7].value),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function De(t){var e,n;return e=new Dt({props:{text:t[17].tips,$$slots:{default:[Je]},$$scope:{ctx:t}}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};131072&n[0]&&(i.text=t[17].tips),139264&n[0]|4096&n[1]&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function We(t){var e,n,i=t[17].value+"";return{c:function(){e=V("span"),n=T(i),R(e,"class","text")},m:function(t,i){H(t,e,i),F(e,n)},p:function(t,e){131072&e[0]&&i!==(i=t[17].value+"")&&O(n,i)},d:function(t){t&&_(e)}}}function Je(t){var e,n=!t[13]&&We(t);return{c:function(){n&&n.c(),e=j()},m:function(t,i){n&&n.m(t,i),H(t,e,i)},p:function(t,i){t[13]?n&&(n.d(1),n=null):n?n.p(t,i):((n=We(t)).c(),n.m(e.parentNode,e))},d:function(t){n&&n.d(t),t&&_(e)}}}function Ke(t){var e,n;return e=new Ce({props:{onChange:t[19]}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:m,i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function Qe(t){var e,n,i;function o(e){t[29].call(null,e)}var r={foucsChange:t[27],onSend:t[28]};return void 0!==t[0]&&(r.dmMsg=t[0]),e=new Pe({props:r}),ot.push(function(){return St(e,"dmMsg",o)}),{c:function(){Mt(e.$$.fragment)},m:function(t,n){zt(e,t,n),i=!0},p:function(t,i){var o={};!n&&1&i[0]&&(n=!0,o.dmMsg=t[0],ct(function(){return n=!1})),e.$set(o)},i:function(t){i||(wt(e.$$.fragment,t),i=!0)},o:function(t){Ct(e.$$.fragment,t),i=!1},d:function(t){qt(e,t)}}}function tn(t){var e,n;return e=new Dt({props:{text:t[3]?"退出全屏":"全屏模式",style:"left: auto; right: -80%;",$$slots:{default:[en]},$$scope:{ctx:t}}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};8&n[0]&&(i.text=t[3]?"退出全屏":"全屏模式"),8&n[0]|4096&n[1]&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function en(t){var e,n,i;return{c:function(){R(e=V("span"),"class","icon")},m:function(o,r){H(o,e,r),e.innerHTML='<?xml version="1.0" encoding="UTF-8"?><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg"    xmlns:xlink="http://www.w3.org/1999/xlink">    \x3c!-- Generator: Sketch 63.1 (92452) - https://sketch.com --\x3e            <g id="终稿" stroke="none" stroke-width="1" fill-rule="evenodd" opacity="0.9">        <g id="图标切图" transform="translate(-439.000000, -166.000000)">            <g id="编组-3" transform="translate(421.000000, 56.000000)">                <g id="编组-4" transform="translate(18.000000, 110.000000)">                    <g id="icon_全屏" transform="translate(7.000000, 7.000000)">                        <g id="player_fullscreen">                            <path                                d="M11,14 C11.8082096,14 12.5417733,13.6804031 13.0812046,13.160696 L15.805943,18.6107695 C14.4154537,19.4906588 12.7672084,20 11,20 C9.23279163,20 7.58454627,19.4906588 6.19405697,18.6107695 L8.91879538,13.160696 C9.45822673,13.6804031 10.1917904,14 11,14 Z M11,10 C11.5522847,10 12,10.4477153 12,11 L12,11 L12,11.001 L11.9932723,11.1166211 C11.9355072,11.6139598 11.5128358,12 11,12 C10.4477153,12 10,11.5522847 10,11 C10,10.4477153 10.4477153,10 11,10 Z M20,11 L14,11 L14,11 C14,9.8257911 13.3254017,8.80914308 12.3426283,8.31647923 L15.0261034,2.94854495 C17.9753898,4.42620082 20,7.47666388 20,11 Z M6.97389656,2.94854495 L9.65737173,8.31647923 C8.67459834,8.80914308 8,9.8257911 8,11 L2,11 L2,11 C2,7.47666388 4.02461023,4.42620082 6.97389656,2.94854495 Z"                                id="Combined-Shape" fill-rule="nonzero"></path>                        </g>                    </g>                </g>            </g>        </g>    </g></svg>',n||(i=P(e,"click",t[30]),n=!0)},p:m,d:function(t){t&&_(e),n=!1,i()}}}function nn(t){var e,n;return e=new Dt({props:{text:"".concat(t[4]?"退出":"","网页全屏"),$$slots:{default:[on]},$$scope:{ctx:t}}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};16&n[0]&&(i.text="".concat(t[4]?"退出":"","网页全屏")),16&n[0]|4096&n[1]&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function on(t){var e,n,i,o=(t[4]?Bt:Pt)+"";return{c:function(){R(e=V("span"),"class","icon")},m:function(r,l){H(r,e,l),e.innerHTML=o,n||(i=P(e,"click",t[31]),n=!0)},p:function(t,n){16&n[0]&&o!==(o=(t[4]?Bt:Pt)+"")&&(e.innerHTML=o)},d:function(t){t&&_(e),n=!1,i()}}}function rn(t){var e,n,i,o=(t[4]?Bt:Pt)+"";return{c:function(){R(e=V("span"),"class","icon")},m:function(r,l){H(r,e,l),e.innerHTML=o,n||(i=P(e,"click",t[32]),n=!0)},p:function(t,n){16&n[0]&&o!==(o=(t[4]?Bt:Pt)+"")&&(e.innerHTML=o)},d:function(t){t&&_(e),n=!1,i()}}}function ln(t){var e,n,i,o=!t[13]&&t[15].danmakuPanel&&an(t);return n=new Dt({props:{text:t[13]?"":t[10].display?"关闭弹幕":"开启弹幕",$$slots:{default:[sn]},$$scope:{ctx:t}}}),{c:function(){o&&o.c(),e=Z(),Mt(n.$$.fragment)},m:function(t,r){o&&o.m(t,r),H(t,e,r),zt(n,t,r),i=!0},p:function(t,i){!t[13]&&t[15].danmakuPanel?o?(o.p(t,i),40960&i[0]&&wt(o,1)):((o=an(t)).c(),wt(o,1),o.m(e.parentNode,e)):o&&(yt(),Ct(o,1,1,function(){o=null}),bt());var r={};9216&i[0]&&(r.text=t[13]?"":t[10].display?"关闭弹幕":"开启弹幕"),1024&i[0]|4096&i[1]&&(r.$$scope={dirty:i,ctx:t}),n.$set(r)},i:function(t){i||(wt(o),wt(n.$$.fragment,t),i=!0)},o:function(t){Ct(o),Ct(n.$$.fragment,t),i=!1},d:function(t){o&&o.d(t),t&&_(e),qt(n,t)}}}function an(t){var e,n;return e=new Te({props:{options:t[10],onChange:t[33]}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};1024&n[0]&&(i.options=t[10]),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function sn(t){var e,n,i,o=(t[10].display?Gt:Xt)+"";return{c:function(){R(e=V("span"),"class","icon")},m:function(r,l){H(r,e,l),e.innerHTML=o,n||(i=P(e,"click",t[34]),n=!0)},p:function(t,n){1024&n[0]&&o!==(o=(t[10].display?Gt:Xt)+"")&&(e.innerHTML=o)},d:function(t){t&&_(e),n=!1,i()}}}function un(t){var e,n;return e=new Ce({props:{onChange:t[19]}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:m,i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function cn(t){var e,n;return e=new Dt({props:{text:t[5]?"退出画中画":"开启画中画",$$slots:{default:[fn]},$$scope:{ctx:t}}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};32&n[0]&&(i.text=t[5]?"退出画中画":"开启画中画"),8224&n[0]|4096&n[1]&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function dn(t){var e,n,i,o=(t[5]?It:Rt)+"";return{c:function(){R(e=V("span"),"class","icon")},m:function(r,l){H(r,e,l),e.innerHTML=o,n||(i=P(e,"click",t[35]),n=!0)},p:function(t,n){32&n[0]&&o!==(o=(t[5]?It:Rt)+"")&&(e.innerHTML=o)},d:function(t){t&&_(e),n=!1,i()}}}function fn(t){var e,n=!t[13]&&dn(t);return{c:function(){n&&n.c(),e=j()},m:function(t,i){n&&n.m(t,i),H(t,e,i)},p:function(t,i){t[13]?n&&(n.d(1),n=null):n?n.p(t,i):((n=dn(t)).c(),n.m(e.parentNode,e))},d:function(t){n&&n.d(t),t&&_(e)}}}function pn(t){var e,n;return e=new Dt({props:{text:t[6]?"关闭镜像模式":"开启镜像模式",$$slots:{default:[vn]},$$scope:{ctx:t}}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};64&n[0]&&(i.text=t[6]?"关闭镜像模式":"开启镜像模式"),64&n[0]|4096&n[1]&&(i.$$scope={dirty:n,ctx:t}),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function vn(t){var e,n,i,o=(t[6]?At:Ot)+"";return{c:function(){R(e=V("span"),"class","icon")},m:function(r,l){H(r,e,l),e.innerHTML=o,n||(i=P(e,"click",t[36]),n=!0)},p:function(t,n){64&n[0]&&o!==(o=(t[6]?At:Ot)+"")&&(e.innerHTML=o)},d:function(t){t&&_(e),n=!1,i()}}}function mn(t){var e,n;return e=new xe({props:{qualityList:t[8].list,quality:t[8].value,lineList:t[9].list,line:t[9].value,onChange:t[37]}}),{c:function(){Mt(e.$$.fragment)},m:function(t,i){zt(e,t,i),n=!0},p:function(t,n){var i={};256&n[0]&&(i.qualityList=t[8].list),256&n[0]&&(i.quality=t[8].value),512&n[0]&&(i.lineList=t[9].list),512&n[0]&&(i.line=t[9].value),e.$set(i)},i:function(t){n||(wt(e.$$.fragment,t),n=!0)},o:function(t){Ct(e.$$.fragment,t),n=!1},d:function(t){qt(e,t)}}}function hn(t){var e,n,i;function o(e){t[39].call(null,e)}var r={container:t[11],quality:t[8].value,qualityList:t[8].list,onChange:t[38]};return void 0!==t[1]&&(r.ref=t[1]),e=new Oe({props:r}),ot.push(function(){return St(e,"ref",o)}),{c:function(){Mt(e.$$.fragment)},m:function(t,n){zt(e,t,n),i=!0},p:function(t,i){var o={};2048&i[0]&&(o.container=t[11]),256&i[0]&&(o.quality=t[8].value),256&i[0]&&(o.qualityList=t[8].list),!n&&2&i[0]&&(n=!0,o.ref=t[1],ct(function(){return n=!1})),e.$set(o)},i:function(t){i||(wt(e.$$.fragment,t),i=!0)},o:function(t){Ct(e.$$.fragment,t),i=!1},d:function(t){qt(e,t)}}}function gn(t){var e,n,i=t[12]&&Xe(t);return{c:function(){i&&i.c(),e=j()},m:function(t,o){i&&i.m(t,o),H(t,e,o),n=!0},p:function(t,n){t[12]?i?(i.p(t,n),4096&n[0]&&wt(i,1)):((i=Xe(t)).c(),wt(i,1),i.m(e.parentNode,e)):i&&(yt(),Ct(i,1,1,function(){i=null}),bt())},i:function(t){n||(wt(i),n=!0)},o:function(t){Ct(i),n=!1},d:function(t){i&&i.d(t),t&&_(e)}}}function xn(t,e,n){var i,o=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function l(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(l,a)}s((i=i.apply(t,e||[])).next())})},r=e.onChange,l=e.container,a=e.show,s=e.isMobile,u=void 0!==s&&s,c=e.dmMsg,d=void 0===c?"":c,f=e.style,p=void 0===f?"":f,v=e.qualityPanelRef,m=e.ctrlItemVisibility,h=void 0===m?{playStatus:!0,volume:!0,time:!0,refresh:!0,leftSetting:!1,quality:!0,danmaku:!0,rightSetting:!1,fullScreen:!0,webFullScreen:!0,danmakuPanel:!0,pip:!0,mirror:!1,dmSend:!1}:m,g=e.playStatus,x=void 0!==g&&g,y=e.fullScreenStatus,b=void 0!==y&&y,w=e.webFullScreenStatus,C=void 0!==w&&w,$=e.pipStatus,k=void 0!==$&&$,L=e.mirrorStatus,S=void 0!==L&&L,M=e.onRefresh,z=e.time,q=void 0===z?{value:"",tips:""}:z,F=e.volume,H=void 0===F?{disabled:!1,value:50}:F,_=e.quality,E=e.line,V=e.danmakuPanel,T=void 0===V||V,Z=e.danmaku,j=void 0===Z?{display:!0,opacity:100,fontScale:100,density:100,enableMask:!0,showMaskOption:!1,area:4}:Z,P=e.playerType,B=void 0===P?"html5":P,I=new Set,R=function(t,e){return o(void 0,void 0,void 0,regeneratorRuntime.mark(function i(){return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,r(t,e);case 2:if(i.t0=i.sent,!1!==i.t0){i.next=5;break}return i.abrupt("return");case 5:i.t1=t,i.next="playStatus"===i.t1?8:"volume"===i.t1?10:"quality"===i.t1?12:"line"===i.t1?14:"playerType"===i.t1?16:"danmaku"===i.t1?18:"fullScreenStatus"===i.t1?20:"webFullScreenStatus"===i.t1?22:"danmakuPanel"===i.t1?24:"pipStatus"===i.t1?26:"mirrorStatus"===i.t1?28:30;break;case 8:return n(2,x=e),i.abrupt("break",30);case 10:return n(7,H=Object.assign({},H,e)),i.abrupt("break",30);case 12:return n(8,_.value=e,_),i.abrupt("break",30);case 14:return n(9,E.value=e,E),i.abrupt("break",30);case 16:return n(21,B=e),i.abrupt("break",30);case 18:return n(10,j=Object.assign({},j,e)),i.abrupt("break",30);case 20:return n(3,b=e),i.abrupt("break",30);case 22:return n(4,C=e),i.abrupt("break",30);case 24:return n(20,T=e),i.abrupt("break",30);case 26:return n(5,k=e),i.abrupt("break",30);case 28:return n(6,S=e),i.abrupt("break",30);case 30:case"end":return i.stop()}},i)}))};return t.$$set=function(t){"onChange"in t&&n(22,r=t.onChange),"container"in t&&n(11,l=t.container),"show"in t&&n(12,a=t.show),"isMobile"in t&&n(13,u=t.isMobile),"dmMsg"in t&&n(0,d=t.dmMsg),"style"in t&&n(14,p=t.style),"qualityPanelRef"in t&&n(1,v=t.qualityPanelRef),"ctrlItemVisibility"in t&&n(15,h=t.ctrlItemVisibility),"playStatus"in t&&n(2,x=t.playStatus),"fullScreenStatus"in t&&n(3,b=t.fullScreenStatus),"webFullScreenStatus"in t&&n(4,C=t.webFullScreenStatus),"pipStatus"in t&&n(5,k=t.pipStatus),"mirrorStatus"in t&&n(6,S=t.mirrorStatus),"onRefresh"in t&&n(16,M=t.onRefresh),"time"in t&&n(17,q=t.time),"volume"in t&&n(7,H=t.volume),"quality"in t&&n(8,_=t.quality),"line"in t&&n(9,E=t.line),"danmakuPanel"in t&&n(20,T=t.danmakuPanel),"danmaku"in t&&n(10,j=t.danmaku),"playerType"in t&&n(21,B=t.playerType)},t.$$.update=function(){t.$$.dirty[0],266240&t.$$.dirty[0]&&a&&i&&I.forEach(function(t){i.appendChild(t)})},[d,v,x,b,C,k,S,H,_,E,j,l,a,u,p,h,M,q,i,R,T,B,r,function(t){return I.add(t),i&&i.appendChild(t),function(){I.delete(t),t.remove()}},function(){return R("playStatus",!x)},function(){var t;return null===(t=M)||void 0===t?void 0:t()},function(t){return R("volume",t)},function(t){R("dmInputFocus",t)},function(t){R("dmSend",t)},function(t){n(0,d=t)},function(){return R("fullScreenStatus",!b)},function(){return R("webFullScreenStatus",!C)},function(){return R("webFullScreenStatus",!C)},function(t,e){return R("danmaku",(o=e,(i=t)in(n={})?Object.defineProperty(n,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[i]=o,n));var n,i,o},function(){R("danmaku",{display:!j.display})},function(){return R("pipStatus",!document.pictureInPictureElement)},function(){return R("mirrorStatus",!S)},function(t,e){return R(t,e)},function(t,e){return R(t,e)},function(t){n(1,v=t)},function(t){ot[t?"unshift":"push"](function(){n(18,i=t)})}]}var yn=function(t){r(i,_t);var e=c(i);function i(t){var o,r;return n(this,i),o=e.call(this),Ge.getElementById("svelte-1dsiks1-style")||((r=V("style")).id="svelte-1dsiks1-style",r.textContent=".live-web-player-controller.svelte-1dsiks1.svelte-1dsiks1{position:relative;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.live-web-player-controller.svelte-1dsiks1 .control-area.svelte-1dsiks1{position:absolute;bottom:3px;left:0;right:0;padding:0 12px;color:#fff;height:36px;font-size:12px;display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.live-web-player-controller.svelte-1dsiks1 .control-area .left-area.svelte-1dsiks1,.live-web-player-controller.svelte-1dsiks1 .control-area .right-area.svelte-1dsiks1{height:100%;display:-webkit-box;display:-ms-flexbox;display:flex}.live-web-player-controller.svelte-1dsiks1 .control-area .right-area.svelte-1dsiks1{-webkit-box-flex:1;-ms-flex:1;flex:1;-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.live-web-player-controller.svelte-1dsiks1 .control-area .ext-nodes.svelte-1dsiks1{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:center;-ms-flex-align:center;align-items:center}.live-web-player-controller.svelte-1dsiks1 .panel{position:absolute;left:50%;-webkit-transform:translate(-50%, -100%);transform:translate(-50%, -100%);opacity:0.9;background-color:rgba(33, 33, 33, 0.9);color:rgba(255, 255, 255, 0.9);border-radius:4px;z-index:100}.live-web-player-controller.svelte-1dsiks1 .icon{display:inline-block;width:36px;height:36px;cursor:pointer}.live-web-player-controller.svelte-1dsiks1 .icon svg{fill:rgba(255, 255, 255, 0.9)}.live-web-player-controller.svelte-1dsiks1 .icon svg:hover{fill:#fff}.live-web-player-controller.svelte-1dsiks1 .text{line-height:36px;padding:0 6px;color:rgba(255, 255, 255, 0.9);cursor:pointer}.live-web-player-controller.svelte-1dsiks1 .text:hover{color:#fff}.live-web-player-controller.svelte-1dsiks1 input[type='radio']{width:16px;height:16px;visibility:hidden;position:absolute;margin:0}.live-web-player-controller.svelte-1dsiks1 input[type='radio']+label{position:relative;margin:0 20px;line-height:16px;cursor:pointer}.live-web-player-controller.svelte-1dsiks1 input[type='radio']+label::before{display:inline-block;position:absolute;left:-20px;width:16px;height:16px;border-radius:50%;vertical-align:text-bottom;-webkit-box-sizing:border-box;box-sizing:border-box;background:rgba(227, 232, 236, 0.1);border:1px solid #757575;content:''}.live-web-player-controller.svelte-1dsiks1 input[type='radio']:checked+label::before{border:1px solid #23ade5;background-color:#23ade5}.live-web-player-controller.svelte-1dsiks1 input[type='radio']:checked+label::after{content:'';position:absolute;width:16px;height:16px;border:4px solid #212121;-webkit-box-sizing:border-box;box-sizing:border-box;left:-20px;-webkit-transform:scale(0.8);transform:scale(0.8);border-radius:50%}.live-web-player-controller.svelte-1dsiks1 input[type='checkbox']{width:12px;height:12px;visibility:hidden;position:absolute;margin:0}.live-web-player-controller.svelte-1dsiks1 input[type='checkbox']+label{position:relative;margin-left:18px;cursor:pointer}.live-web-player-controller.svelte-1dsiks1 input[type='checkbox']+label::before{content:'';position:absolute;top:50%;left:-18px;-webkit-transform:translateY(-50%);transform:translateY(-50%);height:12px;width:12px;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:rgba(0, 0, 0, 0);border:1px solid rgba(255, 255, 255, 0.9);border-radius:2px}.live-web-player-controller.svelte-1dsiks1 input[type='checkbox']:checked+label::before{background-color:#23ade5;border:none}.live-web-player-controller.svelte-1dsiks1 input[type='checkbox']:checked+label::after{content:'';position:absolute;left:-17px;top:calc(50% - 2px);width:2px;height:6px;border:solid #2b2b2b;border-width:0 2px 2px 0;-webkit-transform:rotate(45deg) translateY(-50%);transform:rotate(45deg) translateY(-50%);border-radius:2px}",F(Ge.head,r)),Ht(s(o),t,xn,gn,w,{onChange:22,container:11,show:12,isMobile:13,dmMsg:0,style:14,qualityPanelRef:1,ctrlItemVisibility:15,playStatus:2,fullScreenStatus:3,webFullScreenStatus:4,pipStatus:5,mirrorStatus:6,onRefresh:16,time:17,volume:7,quality:8,line:9,danmakuPanel:20,danmaku:10,playerType:21,appendCtrlItem:23},[-1,-1]),o}return o(i,[{key:"onChange",get:function(){return this.$$.ctx[22]},set:function(t){this.$set({onChange:t}),vt()}},{key:"container",get:function(){return this.$$.ctx[11]},set:function(t){this.$set({container:t}),vt()}},{key:"show",get:function(){return this.$$.ctx[12]},set:function(t){this.$set({show:t}),vt()}},{key:"isMobile",get:function(){return this.$$.ctx[13]},set:function(t){this.$set({isMobile:t}),vt()}},{key:"dmMsg",get:function(){return this.$$.ctx[0]},set:function(t){this.$set({dmMsg:t}),vt()}},{key:"style",get:function(){return this.$$.ctx[14]},set:function(t){this.$set({style:t}),vt()}},{key:"qualityPanelRef",get:function(){return this.$$.ctx[1]},set:function(t){this.$set({qualityPanelRef:t}),vt()}},{key:"ctrlItemVisibility",get:function(){return this.$$.ctx[15]},set:function(t){this.$set({ctrlItemVisibility:t}),vt()}},{key:"playStatus",get:function(){return this.$$.ctx[2]},set:function(t){this.$set({playStatus:t}),vt()}},{key:"fullScreenStatus",get:function(){return this.$$.ctx[3]},set:function(t){this.$set({fullScreenStatus:t}),vt()}},{key:"webFullScreenStatus",get:function(){return this.$$.ctx[4]},set:function(t){this.$set({webFullScreenStatus:t}),vt()}},{key:"pipStatus",get:function(){return this.$$.ctx[5]},set:function(t){this.$set({pipStatus:t}),vt()}},{key:"mirrorStatus",get:function(){return this.$$.ctx[6]},set:function(t){this.$set({mirrorStatus:t}),vt()}},{key:"onRefresh",get:function(){return this.$$.ctx[16]},set:function(t){this.$set({onRefresh:t}),vt()}},{key:"time",get:function(){return this.$$.ctx[17]},set:function(t){this.$set({time:t}),vt()}},{key:"volume",get:function(){return this.$$.ctx[7]},set:function(t){this.$set({volume:t}),vt()}},{key:"quality",get:function(){return this.$$.ctx[8]},set:function(t){this.$set({quality:t}),vt()}},{key:"line",get:function(){return this.$$.ctx[9]},set:function(t){this.$set({line:t}),vt()}},{key:"danmakuPanel",get:function(){return this.$$.ctx[20]},set:function(t){this.$set({danmakuPanel:t}),vt()}},{key:"danmaku",get:function(){return this.$$.ctx[10]},set:function(t){this.$set({danmaku:t}),vt()}},{key:"playerType",get:function(){return this.$$.ctx[21]},set:function(t){this.$set({playerType:t}),vt()}},{key:"appendCtrlItem",get:function(){return this.$$.ctx[23]}}]),i}(),bn=yn;exports.default=bn;
},{}],"kyLC":[function(require,module,exports) {
"use strict";function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(t)}function t(o){var t,e;return null!==(e=null===(t=RegExp("[;\\s]*".concat(o,"=([^;\\s]+)")).exec(document.cookie))||void 0===t?void 0:t[1])&&void 0!==e?e:""}function e(){return/ipad|iphone os|android/i.test(navigator.userAgent)}function n(){}function r(t,e){if(t===e)return!0;if("object"===o(t)){for(var n in t)if(!r(t[n],e[n]))return!1;return!0}return!1}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCookie=t,exports.isMobile=e,exports.noop=n,exports.deepEqual=r;
},{}],"wPfs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Formatter=void 0;var t=require("./utils"),e=function(t){var e,n;return["".concat(location.href),"".concat(null==t.spmId?"":t.spmId+".").concat(t.evtId),"",Date.now(),"","","".concat(screen.width,"x").concat(screen.height),"",JSON.stringify(Object.assign(Object.assign({},null!==(e=t.data)&&void 0!==e?e:{}),null!==(n=null==t?void 0:t.tags)&&void 0!==n?n:{}))]},n={"011778":e,"000527":e,"000358":function(e){var n,o;return["".concat(location.href),"".concat(null!==(n=document.referrer)&&void 0!==n?n:""),"".concat(null==e.spmId?"":e.spmId+".").concat(e.evtId),Date.now(),null!==(o=(0,t.getCookie)("fts"))&&void 0!==o?o:"","".concat(screen.width,"x").concat(screen.height),(0,t.isMobile)()?2:1,null==e.data?"":JSON.stringify(e.data),"",0]}};exports.Formatter=n;
},{"./utils":"kyLC"}],"EpHV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Tracker=void 0;var t=require("./formatter"),e=require("./utils");function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}var r,a,c,s,f,u,l,h,d,v,w=function(t,e,n,i){return new(n||(n=Promise))(function(o,r){function a(t){try{s(i.next(t))}catch(e){r(e)}}function c(t){try{s(i.throw(t))}catch(e){r(e)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,c)}s((i=i.apply(t,e||[])).next())})},p=function(t,e,n,i,o){if("m"===i)throw new TypeError("Private method is not writable");if("a"===i&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===i?o.call(t,n):o?o.value=n:e.set(t,n),n},m=function(t,e,n,i){if("a"===n&&!i)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?i:"a"===n?i.call(t):i?i.value:e.get(t)},b=new Promise(function(t){""===(0,e.getCookie)("buvid3")?window.fetch("//data.bilibili.com/v/",{credentials:"include"}).then(function(){return t()}).catch(function(){return t()}):t()});function y(t){var n,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return w(this,void 0,void 0,regeneratorRuntime.mark(function r(){var a,c;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==t.length){r.next=2;break}return r.abrupt("return");case 2:if(a="string"==typeof t?t:t.join(""),c="//data.bilibili.com/gol/postweb",!i){r.next=8;break}null===(n=navigator.sendBeacon)||void 0===n||n.call(navigator,c,a),r.next=11;break;case 8:return r.next=10,b;case 10:fetch(c,{method:"POST",body:a,credentials:"include"}).then(function(n){if(429===n.status){var i=[1e4,2e4,4e4][o];if(null==i)return;window.setTimeout(function(){y(t,!1,o+=1).catch(e.noop)},i)}}).catch(function(t){console.error(t)});case 11:case"end":return r.stop()}},r)}))}var g=!1,k=0;window.addEventListener("beforeunload",function(){g=!0,clearTimeout(k),k=window.setTimeout(function(){g=!1},5e3)});var T=function(){function i(o){var w,b,g=this,k=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(n(this,i),r.set(this,[]),a.set(this,void 0),c.set(this,void 0),s.set(this,function(){}),f.set(this,void 0),u.set(this,[]),l.set(this,(b=!1,function(){if(!b){b=!0;var t=window.setTimeout(function(){b=!1,m(g,d,"f").call(g)},6e4);p(g,s,function(){b=!1,clearTimeout(t)},"f")}})),h.set(this,function(t,n){var i=Math.random()*n,o=window.setTimeout(function(){p(g,u,m(g,u,"f").filter(function(t){return t.timer!==o}),"f"),y(t,i<10,0).catch(e.noop)},i),r={timer:o,data:t};m(g,u,"f").push(r)}),d.set(this,function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];m(g,s,"f").call(g),y(m(g,r,"f"),t).catch(e.noop),p(g,r,[],"f")}),v.set(this,function(){"hidden"===document.visibilityState&&(m(g,u,"f").forEach(function(t){var e=t.timer;return clearTimeout(e)}),y(m(g,u,"f").map(function(t){return t.data}),!0).catch(e.noop),p(g,u,[],"f"),m(g,d,"f").call(g,!0))}),p(this,a,o,"f"),p(this,f,null!==(w=k.formatter)&&void 0!==w?w:t.Formatter[o],"f"),null==m(this,f,"f"))throw new Error("Undefined Formatter for logId: ".concat(o));p(this,c,k,"f"),document.addEventListener("visibilitychange",m(this,v,"f"))}return o(i,[{key:"event",value:function(t,n){var i,o,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"!=typeof t||""===t)throw Error("evtId: ".concat(JSON.stringify(t)," not a string"));var u=null!==(o=null!==(i=s.sample)&&void 0!==i?i:m(this,c,"f").sample)&&void 0!==o?o:100,v=100*Math.random()>=u;if(!0===m(this,c,"f").debug&&console.log("live-web-track: evtId: ".concat(t,", 采样率 ").concat(u,"%, 本次是否上报 ").concat(JSON.stringify(!v))),!v){var w="".concat(m(this,a,"f")).concat(Date.now()).concat(m(this,f,"f").call(this,Object.assign({evtId:t,data:n},m(this,c,"f"))).join("|"));if(g)y(w,!0).catch(e.noop);else{if("number"==typeof s.randDelay)return void m(this,h,"f").call(this,w,s.randDelay);(0,e.isMobile)()?y(w,!0).catch(e.noop):m(this,r,"f").push(w)}m(this,r,"f").length>=10?m(this,d,"f").call(this):m(this,l,"f").call(this)}}},{key:"set",value:function(t){p(this,c,Object.assign({},m(this,c,"f"),t),"f")}},{key:"destroy",value:function(){m(this,d,"f").call(this),document.removeEventListener("visibilitychange",m(this,v,"f"))}}]),i}();exports.Tracker=T,r=new WeakMap,a=new WeakMap,c=new WeakMap,s=new WeakMap,f=new WeakMap,u=new WeakMap,l=new WeakMap,h=new WeakMap,d=new WeakMap,v=new WeakMap;
},{"./formatter":"wPfs","./utils":"kyLC"}],"jGuH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ExpUtils=void 0;var e=require("../utils");function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function n(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}var a,i,o,s=function(e,t,r,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?a.call(e,r):a?a.value=r:t.set(e,r),r},c=function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},l=function(){function e(r,n,c){t(this,e),a.set(this,!1),i.set(this,void 0),o.set(this,null),s(this,i,r,"f"),s(this,o,null,"f"),this.createObserver(n,c)}return n(e,[{key:"createObserver",value:function(e,t){var r=this;null!==c(this,o,"f")&&this.destroyObserver();var n=!1;s(this,a,!1,"f"),s(this,o,new IntersectionObserver(function(t){var i=t.some(function(e){return e.isIntersecting});i!==c(r,a,"f")&&(s(r,a,i,"f"),i&&(n||(n=!0,setTimeout(function(){n=!1},500),e.callback(),e.repeat||r.destroyObserver())))},{threshold:[.5]}),"f"),t.context.$nextTick(function(){var e;null===(e=c(r,o,"f"))||void 0===e||e.observe(c(r,i,"f"))})}},{key:"destroyObserver",value:function(){var e;null===(e=c(this,o,"f"))||void 0===e||e.disconnect(),s(this,o,null,"f")}}]),e}();a=new WeakMap,i=new WeakMap,o=new WeakMap;var u={bind:function(e,t,r){if(void 0===window.IntersectionObserver)console.warn("IntersectionObserver API is not available in your browser.");else{var n=new l(e,t,r);e.track_exp_state=n}},update:function(t,r,n){(0,e.deepEqual)(r.value,r.oldValue)||t.track_exp_state.createObserver({callback:r.callback,repeat:r.repeat},n)},unbind:function(e){e.track_exp_state.destroyObserver()}};exports.ExpUtils=u;
},{"../utils":"kyLC"}],"oQm6":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.genDirectives=u;var e=require("./exp");function t(e,t){return a(e)||o(e,t)||r(e,t)||n()}function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function r(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function o(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=e[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(c){i=!0,o=c}finally{try{r||null==u.return||u.return()}finally{if(i)throw o}}return n}}function a(e){if(Array.isArray(e))return e}function u(n){var r=new WeakMap;function i(e,t,i,o){function a(){n.event(i,o),e.removeEventListener("click",a)}if(t)r.set(e,{ck:a}),e.addEventListener("click",a);else{var u=function(){n.event(i,o)};r.set(e,{ck:u}),e.addEventListener("click",u)}}function o(e){var t,n=null===(t=r.get(e))||void 0===t?void 0:t.ck;null!=n&&e.removeEventListener("click",n)}return{bind:function(r,o,a,u){var c=o.value,l=o.arg,v=o.modifiers,f=t(c,2),s=f[0],d=f[1],p=v.repeat,y=v.once;"ck"===l?i(r,y,s,d):"exp"===l&&e.ExpUtils.bind(r,{callback:function(){return n.event(s,d)},repeat:p},a)},update:function(r,a,u){var c=a.value,l=a.arg,v=a.modifiers,f=t(c,2),s=f[0],d=f[1],p=v.repeat,y=v.once;"ck"===l?(o(r),i(r,y,s,d)):"exp"===l&&e.ExpUtils.update(r,{value:a.value,oldValue:a.oldValue,callback:function(){return n.event(s,d)},repeat:p},u)},unbind:function(t,n){var r=n.arg;"ck"===r?o(t):"exp"===r&&e.ExpUtils.unbind(t)}}}
},{"./exp":"jGuH"}],"HmVg":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getNavigationEntryFromPerformanceTiming=t,exports.getPerformanceTiming=n,exports.performTempalte=void 0;var e=["startTime","unloadEventStart","unloadEventEnd","redirectStart","redirectEnd","fetchStart","domainLookupStart","domainLookupEnd","connectStart","connectEnd","secureConnectionStart","requestStart","responseStart","responseEnd","domInteractive","domContentLoadedEventStart","domContentLoadedEventEnd","domComplete","loadEventStart","loadEventEnd","duration","redirectCount","decodedBodySize","encodedBodySize","transferSize"];function t(){try{var e=performance.timing,t=performance.navigation.type===performance.navigation.TYPE_BACK_FORWARD?"back_forward":performance.navigation.type===performance.navigation.TYPE_NAVIGATE?"navigate":performance.navigation.type===performance.navigation.TYPE_RELOAD?"reload":"prerender",n={entryType:"navigation",startTime:0,duration:e.loadEventEnd-e.navigationStart,redirectCount:performance.navigation.redirectCount,type:t};for(var r in e)"navigationStart"!==r&&"toJSON"!==r&&(n[r]=Math.max(e[r]-e.navigationStart,0));return n}catch(a){return{}}}function n(){var n;try{var r=null!==(n=null===performance||void 0===performance?void 0:performance.getEntriesByType("navigation")[0])&&void 0!==n?n:t(),a={};return e.forEach(function(e){var t;a[e]=Math.max(null!==(t=r[e])&&void 0!==t?t:0,0)}),a}catch(o){return{}}}exports.performTempalte=e;
},{}],"SCHR":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getDimension=u,exports.IDimensionOS=exports.IDimensionNavigationType=exports.IDimensionNetworkType=void 0;var n,o,e,i=require("./timing");function r(){return"hidden"===document.visibilityState||document.hidden?0:1}function t(){var o,e,i;return"4g"===(null===(o=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===o?void 0:o.effectiveType)?n["4g"]:"3g"===(null===(e=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===e?void 0:e.effectiveType)?n["3g"]:"2g"===(null===(i=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===i?void 0:i.effectiveType)?n["2g"]:n.other}function a(){var n;try{var e=(null!==(n=null===performance||void 0===performance?void 0:performance.getEntriesByType("navigation")[0])&&void 0!==n?n:(0,i.getNavigationEntryFromPerformanceTiming)()).type;return"navigate"===e?o.navigate:"reload"===e?o.reload:"back_forward"===e?o.backForward:o.other}catch(r){return o.other}}function v(){var n;return null!=(null===(n=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===n?void 0:n.controller)?1:0}function c(){var n="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform,o="Win32"===navigator.platform||"Windows"===navigator.platform,i="X11"===navigator.platform&&!o&&!n,r=String(navigator.platform).includes("Linux");return n?e.Mac:o?e.Windows:i?e.Unix:r?e.Linux:e.Other}function d(){try{return"h2"===performance.getEntriesByType("navigation")[0].nextHopProtocol?1:0}catch(n){return 0}}function l(){var n;return null!=(null===(n=null===window||void 0===window?void 0:window.PerformanceObserver)||void 0===n?void 0:n.supportedEntryTypes)&&["largest-contentful-paint","paint"].every(function(n){return window.PerformanceObserver.supportedEntryTypes.includes(n)})?1:0}function u(){return{OS:c(),VisibilityState:r(),NavigationType:a(),NetworkType:t(),ServiceWorkerState:v(),NextHopProtocol:d(),SupportedEntryTypes:l()}}exports.IDimensionNetworkType=n,function(n){n[n.other=0]="other",n[n["2g"]=2]="2g",n[n["3g"]=3]="3g",n[n["4g"]=4]="4g"}(n||(exports.IDimensionNetworkType=n={})),exports.IDimensionNavigationType=o,function(n){n[n.navigate=0]="navigate",n[n.reload=1]="reload",n[n.backForward=2]="backForward",n[n.other=255]="other"}(o||(exports.IDimensionNavigationType=o={})),exports.IDimensionOS=e,function(n){n[n.Other=0]="Other",n[n.Mac=1]="Mac",n[n.Windows=2]="Windows",n[n.Unix=3]="Unix",n[n.Linux=4]="Linux"}(e||(exports.IDimensionOS=e={}));
},{"./timing":"HmVg"}],"lNBA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BizCommonPerf=void 0;var e=require("./dimension"),t=require("./timing"),n=require(".."),r=require("../utils");function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&a(e.prototype,t),n&&a(e,n),e}var s,u,c,f,d,m,h,v,p,w=function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(e,n):o?o.value=n:t.set(e,n),n},g=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},b=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n},y=["url","refer_url","spm_id","timestamp","fts","browser_resolution","ptype","business_name","level","event_name","event_content","extra_info","arg1","arg2","arg3"],O=function(e){var t,n,o,i=null!==(t=e.data)&&void 0!==t?t:{},a=i.businessName,l=i.eventName,s=i.level,u=i.extraInfo,c=i.arg1,f=i.arg2,d=i.arg3,m=b(i,["businessName","eventName","level","extraInfo","arg1","arg2","arg3"]);return{url:encodeURIComponent(window.location.href),refer_url:""===document.referrer?"":encodeURIComponent(document.referrer),spm_id:null!==(n=e.spmId)&&void 0!==n?n:"",timestamp:Date.now(),fts:(0,r.getCookie)("fts"),browser_resolution:"".concat(window.innerWidth,"x").concat(window.innerHeight),ptype:(0,r.isMobile)()?2:1,business_name:null!=a?a:"live-performance-track",level:null!=s?s:"log",event_name:null!==(o=null!=l?l:e.evtId)&&void 0!==o?o:"performanceTrack",event_content:null==e.data?"":JSON.stringify(m).replace(/"/g,"%22"),extra_info:null!=u?u:"",arg1:null!=c?c:"",arg2:null!=f?f:"",arg3:null!=d?d:""}},_=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i(this,e),s.add(this),u.set(this,"000967"),c.set(this,void 0),f.set(this,void 0),d.set(this,void 0),m.set(this,null),w(this,c,t,"f"),w(this,f,n,"f"),w(this,d,r,"f"),g(this,s,"m",h).call(this),g(this,s,"m",v).call(this)}return l(e,[{key:"custom",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;g(this,s,"m",v).call(this,o({},e,t),{delay:n},!0)}}]),e}();exports.BizCommonPerf=_,u=new WeakMap,c=new WeakMap,f=new WeakMap,d=new WeakMap,m=new WeakMap,s=new WeakSet,h=function(){null==g(this,m,"f")&&w(this,m,new n.Tracker(g(this,u,"f"),{spmId:g(this,c,"f"),formatter:function(e){var t=O(e),n=[];return y.forEach(function(e){n.push(t[e])}),n}}),"f")},v=function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];null!=window.performance?"complete"===document.readyState?g(this,s,"m",p).call(this,t,n,r):window.addEventListener("load",function(){g(e,s,"m",p).call(e,t,n,r)}):console.error("window.performance is nonexistent")},p=function(){var n=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a="number"==typeof o.delay?o.delay:"number"==typeof g(this,f,"f").delay?g(this,f,"f").delay:0,l=Object.assign(Object.assign(Object.assign(Object.assign({},i?{}:(0,t.getPerformanceTiming)()),(0,e.getDimension)()),g(this,d,"f")),r),s=function(e){var t;return null===(t=g(n,m,"f"))||void 0===t?void 0:t.event("performanceTrack",e,{sample:100,randDelay:0})};a<=0?s(l):setTimeout(function(){s(l)},a)};
},{"./dimension":"SCHR","./timing":"HmVg","..":"BuDO","../utils":"kyLC"}],"BuDO":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.createDirective=i,Object.defineProperty(exports,"Tracker",{enumerable:!0,get:function(){return e.Tracker}}),Object.defineProperty(exports,"BizCommonPerf",{enumerable:!0,get:function(){return t.BizCommonPerf}});var e=require("./core"),r=require("./directives/directives"),t=require("./perf");function i(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=new e.Tracker(t,i);return(0,r.genDirectives)(n)}
},{"./core":"EpHV","./directives/directives":"oQm6","./perf":"lNBA"}],"ESUf":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var r,o=1,t=arguments.length;o<t;o++)for(var a in r=arguments[o])Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a]);return e}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.CustomCode=exports.OperationCode=exports.ErrorCode=exports.EventCode=exports.PerfCode=exports.Category=void 0;var r,o,t,a,n,i,l=require("@bilibili-live/live-web-track");!function(e){e[e.Perf=1]="Perf",e[e.Event=2]="Event",e[e.Error=3]="Error",e[e.Operation=4]="Operation",e[e.Custom=5]="Custom"}(r=exports.Category||(exports.Category={})),function(e){e[e.PlayerResLoad=1]="PlayerResLoad",e[e.FirstPacket=2]="FirstPacket",e[e.VideoMeta=3]="VideoMeta",e[e.FirstFrame=4]="FirstFrame",e[e.Api=5]="Api",e[e.DevicePerf=6]="DevicePerf"}(o=exports.PerfCode||(exports.PerfCode={})),function(e){e[e.RoomPlayerInit=1]="RoomPlayerInit",e[e.CreateVideo=2]="CreateVideo",e[e.HomePlayerInit=100]="HomePlayerInit",e[e.ActivityPlayerInit=200]="ActivityPlayerInit",e[e.MobilePlayerInit=300]="MobilePlayerInit"}(t=exports.EventCode||(exports.EventCode={})),function(e){e[e.UnsupportedPlayer=90001]="UnsupportedPlayer",e[e.NativeVideoError=90002]="NativeVideoError",e[e.ApiRequest=91001]="ApiRequest",e[e.ApiResponse=91002]="ApiResponse",e[e.ApiBiz=91003]="ApiBiz",e[e.FirstFrameNotEmit=92001]="FirstFrameNotEmit",e[e.RetryMaxTime=92002]="RetryMaxTime",e[e.SocketConnect=93001]="SocketConnect",e[e.PlayUrlNull=94001]="PlayUrlNull",e[e.RoomP0ApiFetchError=21001]="RoomP0ApiFetchError",e[e.RoomEnterLiveError=21003]="RoomEnterLiveError",e[e.RoomRoundUnknow=22e3]="RoomRoundUnknow",e[e.RoomUnSettingRound=22001]="RoomUnSettingRound",e[e.RoomCantRound=22002]="RoomCantRound",e[e.RoomEnterRoundError=22003]="RoomEnterRoundError"}(a=exports.ErrorCode||(exports.ErrorCode={})),function(e){e[e.Play=1]="Play",e[e.Pause=2]="Pause",e[e.Refresh=3]="Refresh",e[e.Mute=4]="Mute",e[e.Volume=5]="Volume",e[e.SwitchQuality=6]="SwitchQuality",e[e.SwitchLine=7]="SwitchLine",e[e.Feedback=8]="Feedback",e[e.TimeShift=9]="TimeShift",e[e.Danmaku=10]="Danmaku",e[e.FullScreen=11]="FullScreen",e[e.WebFullScreen=12]="WebFullScreen",e[e.PictureInPicture=13]="PictureInPicture",e[e.WebFullScreenWay=14]="WebFullScreenWay",e[e.Panorama=15]="Panorama"}(n=exports.OperationCode||(exports.OperationCode={})),function(e){e[e.Waiting=1]="Waiting",e[e.P2PData=2]="P2PData",e[e.UserFeedBack=3]="UserFeedBack",e[e.StreamErrWhenEnded=100]="StreamErrWhenEnded",e[e.SwitchLine=104]="SwitchLine",e[e.HangUp=105]="HangUp",e[e.NetSpeed=106]="NetSpeed",e[e.AutoDiscardFrame=107]="AutoDiscardFrame",e[e.MutedPlay=108]="MutedPlay",e[e.NotAutoPlay=109]="NotAutoPlay",e[e.VideoPlaybackQuality=110]="VideoPlaybackQuality"}(i=exports.CustomCode||(exports.CustomCode={}));var d,u=function(e){if(null==e.data)return[];var r=e.data,o=r.ctime,t=r.category,a=r.val,n=r.params;return[r.staticInfo,o,t,r.code,a,n]},s=new l.Tracker("009658",{formatter:u}),c=function(){var e=-1;return function(){return"v"+(e+=1)}}(),p={},m=c();function v(e){d=e.uvid+"|"+e.uid+"|"+e.version+"|"+e.roomId}function y(r,o){if(!0===o)return m=c(),void(p[m]=e({},r));null==p[m]&&(p[m]={}),p[m]=Object.assign({},p[m],r)}function f(e,o,t){var a=void 0===t?{}:t,n=a.extFields,i=a.params,l=a.sampleRate,d=void 0===l?1:l,u=a.randDelay;P({val:Math.round(o),category:r.Perf,code:e,params:null!=i?i:{}},{sample:100*d,randDelay:u,extFields:null!=n?n:["sHost","sProtocol","p2pType","sQuery","x-service-module"]})}function P(r,o){var t,a=Date.now(),n=r.category,i=r.val,l=r.params,u=r.code,c=o.sample,v=o.randDelay,y=o.dynamicFieldsVer,f=o.extFields,P=null!==(t=p[null!=y?y:m])&&void 0!==t?t:{};"all"===f?l=e(e({},l),P):Array.isArray(f)&&(l=f.reduce(function(r,o){var t;return o in P?e(e({},r),((t={})[o]=P[o],t)):r},e({},l)));var F="string"==typeof i?i:null==i?"":JSON.stringify(i),C=0===Object.keys(null!=l?l:{}).length?"":JSON.stringify(l);s.event("playerEvt",{code:u,val:F,ctime:a,category:n,params:C,staticInfo:d},{sample:c,randDelay:v})}function F(e,o,t){var a,n;P({val:o,category:r.Event,code:e},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:1),randDelay:null==t?void 0:t.randDelay,extFields:null!==(n=null==t?void 0:t.extFields)&&void 0!==n?n:["sProtocol","sHost","p2pType","sCodec","sFormat"]})}function C(o,t,a){var n,i,l;void 0===a&&(a={}),P({val:t,category:r.Error,code:o,params:e({},null!=a.apiUrl?{apiUrl:a.apiUrl}:{})},{sample:100*(null!==(n=null==a?void 0:a.sampleRate)&&void 0!==n?n:1),randDelay:null!==(i=null==a?void 0:a.randDelay)&&void 0!==i?i:5e3,extFields:null!==(l=a.extFields)&&void 0!==l?l:"all"})}function R(e,o,t){var a;P({val:o,code:e,category:r.Operation},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:.1),randDelay:null==t?void 0:t.randDelay,extFields:null==t?void 0:t.extFields})}function x(e,o,t){var a;P({val:o,category:r.Custom,code:e},{sample:100*(null!==(a=null==t?void 0:t.sampleRate)&&void 0!==a?a:1),randDelay:null==t?void 0:t.randDelay,extFields:null==t?void 0:t.extFields})}function E(){var e=m;return{custom:function(r,o,t){x(r,o,Object.assign({},t,{dynamicFieldsVer:e}))}}}exports.default={perf:f,event:F,error:C,custom:x,operation:R,PerfCode:o,EventCode:t,ErrorCode:a,OperationCode:n,CustomCode:i,fixedDynamicFieldsVerIns:E,initStaticInfo:v,updateDynamicInfo:y,formatter:u};
},{"@bilibili-live/live-web-track":"BuDO"}],"as8u":[function(require,module,exports) {
"use strict";var e,t,n,i,r,o,s,a,l,u,c,h,d,f=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(r,o){function s(e){try{l(i.next(e))}catch(t){o(t)}}function a(e){try{l(i.throw(e))}catch(t){o(t)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}l((i=i.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var n,i,r,o,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,i=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(r=(r=s.trys).length>0&&r[r.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){s.label=o[1];break}if(6===o[0]&&s.label<r[1]){s.label=r[1],r=o;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(o);break}r[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},v=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},y=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},w=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var b=w(require("@bilibili-live/web-player-controller")),m=require("@bilibili-live/web-player-common"),g=w(require("@bilibili-live/web-player-track")),S=function(){function w(w,g){var S=this;this.container=w,this.opts=g,e.set(this,void 0),t.set(this,void 0),n.set(this,void 0),i.set(this,new Set),r.set(this,new Set),o.set(this,void 0),s.set(this,!1),a.set(this,!1),l.set(this,0),u.set(this,0),c.set(this,function(){}),h.set(this,function(){if(m.logger.info("Controller onrefresh"),0!==y(S,r).size)for(var e=0,t=Array.from(y(S,r));e<t.length;e++){(0,t[e])()}}),this.getCtrlEl=function(){return y(S,e)},d.set(this,function(e,t){return f(S,void 0,Promise,function(){return p(this,function(n){switch(n.label){case 0:return m.logger.info("Controller onchange: type: "+e+", value: "+JSON.stringify(t)),0===y(this,i).size?[2,!1]:[4,Promise.all(Array.from(y(this,i)).map(function(n){return n(e,t)}))];case 1:return n.sent().includes(!1)?[2,!1]:[2]}})})}),this.changeCtrlVisible=function(n){n?(y(S,t).style.visibility="visible",y(S,e).style.visibility="visible"):(y(S,t).style.visibility="hidden",y(S,e).style.visibility="hidden")},v(this,e,C()),v(this,t,k()),g.enableCtrlUI&&(this.container.appendChild(y(this,t)),w.appendChild(y(this,e))),v(this,n,new b.default({target:y(this,e),props:{show:!1,playStatus:!1,quality:{list:[],value:null},line:{list:[],value:null},onRefresh:y(this,h),onChange:y(this,d),isMobile:this.opts.isMobile,container:w,dmMsg:""}})),this.opts.isMobile?v(this,o,E(w,this,y(this,e))):(v(this,o,W(w,this,y(this,e))),v(this,c,M(this)))}return w.prototype.triggerWebFullscreen=function(){var e,t=!(null!==(e=y(this,n).webFullScreenStatus)&&void 0!==e&&e);y(this,n).webFullScreenStatus=t,y(this,i).forEach(function(e){return e("webFullScreenStatus",t)}),g.default.operation(g.default.OperationCode.WebFullScreenWay,t?1:-1)},w.prototype.onChange=function(e){var t=this;return y(this,i).add(e),function(){y(t,i).delete(e)}},w.prototype.onRefresh=function(e){var t=this;return y(this,r).add(e),function(){y(t,r).delete(e)}},w.prototype.getCtrlUI=function(){return y(this,n)},w.prototype.setMiniMode=function(e){v(this,s,e)},w.prototype.show=function(){clearTimeout(y(this,l)),y(this,s)||y(this,n).show||(y(this,t).style.display="block",y(this,n).show=!0,y(this,i).forEach(function(e){return e("show",!0)}))},w.prototype.delayHide=function(e,t){var n=this;void 0===t&&(t=function(){}),clearTimeout(y(this,l)),v(this,l,window.setTimeout(function(){y(n,a)||(n.hide(),t())},e))},w.prototype.hide=function(){y(this,n).show&&(y(this,t).style.display="none",y(this,n).show=!1,y(this,i).forEach(function(e){return e("show",!1)}))},w.prototype.destroy=function(){v(this,i,new Set),v(this,r,new Set),y(this,o).call(this),y(this,n).$destroy(),y(this,e).remove(),y(this,t).remove(),clearTimeout(y(this,l)),clearTimeout(y(this,u)),y(this,c).call(this)},w.prototype.setDmSendIsFocus=function(e){v(this,a,e)},w.prototype.showCursor=function(){clearTimeout(y(this,u)),"default"!==this.container.style.cursor&&(this.container.style.cursor="default")},w.prototype.delayHideCursor=function(e){var t=this;clearTimeout(y(this,u)),v(this,u,window.setTimeout(function(){t.container.style.cursor="none"},e))},w}();function C(){var e=document.createElement("div");return e.style.cssText="\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 13;\n  ",e.classList.add("web-player-controller-wrap"),e.id="web-player-controller-wrap-el",e}function k(){var e=document.createElement("div");return e.classList.add("web-player-controller-bg"),e.style.cssText="\n    display: none;\n    position: absolute;\n    bottom: 0;\n    width: 100%;\n    z-index: 10;\n    height: 56px;\n    background-image: linear-gradient(180deg, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7));\n  ",e.classList.add("web-player-controller-wrap"),e}function M(e){var t=e.onChange(function(t,n){if("fullScreenStatus"===t||"webFullScreenStatus"===t){if(n)return void e.delayHideCursor(2e3);e.showCursor()}});return function(){t()}}function E(e,t,n){var i=!1,r=function(e){var r=t.getCtrlUI().qualityPanelRef;!i||!F(n,e,!0)&&!0!==(null==r?void 0:r.contains(e.target))?(i=!i)?(t.show(),t.delayHide(2e3,function(){i=!1})):t.hide():t.delayHide(2e3,function(){i=!1})};return t.onChange(function(e,n){"dmInputFocus"===e&&t.setDmSendIsFocus(n)}),e.addEventListener("touchstart",r),function(){e.removeEventListener("touchstart",r)}}function W(e,t,n){var i=this,r=function(e){if(t.show(),t.showCursor(),!F(n,e)){t.delayHide(2e3);var i=t.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||t.delayHideCursor(2e3)}},o=function(){t.hide(),t.showCursor()},s=function(e){if(!F(n,e)){t.delayHide(2e3);var i=t.getCtrlUI();!0!==i.webFullScreenStatus&&!0!==i.fullScreenStatus||(t.showCursor(),t.delayHideCursor(2e3))}};e.addEventListener("mousemove",r),e.addEventListener("mouseleave",o),e.addEventListener("click",s);var a=function(){f(i,void 0,Promise,function(){return p(this,function(e){return t.triggerWebFullscreen(),[2]})}).catch(function(e){m.logger.error(e)})};return e.addEventListener("dblclick",a),function(){e.removeEventListener("click",s),e.removeEventListener("mousemove",r),e.removeEventListener("mouseleave",o),e.removeEventListener("dblclick",a)}}function F(e,t,n){void 0===n&&(n=!1);var i=e.getBoundingClientRect().top-36-14-(n?52:0);return n?t.touches[0].clientY>i||e.contains(t.target):t.clientY>i||e.contains(t.target)}exports.default=S,e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,r=new WeakMap,o=new WeakMap,s=new WeakMap,a=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,h=new WeakMap,d=new WeakMap;
},{"@bilibili-live/web-player-controller":"MW6F","@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf"}],"FT5O":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"GTYV":[function(require,module,exports) {
var define;
var process = require("process");
var t,e=require("process"),n="2022-08-09 16:29:40";!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof t&&t.amd?t([],n):"object"==typeof exports?exports["sisters-player"]=n():e["sisters-player"]=n()}(window,function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var o=e[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(r,o,function(e){return t[e]}.bind(null,o));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=77)}([function(t,e,n){var r=n(168);t.exports=function(t,e,n){return e in t?r(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}},function(t,e,n){t.exports=n(186)},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e,n){t.exports=n(203)},function(t,e,n){t.exports=n(208)},function(t,e,n){var r=n(168);function o(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),r(t,o.key,o)}}t.exports=function(t,e,n){return e&&o(t.prototype,e),n&&o(t,n),t}},function(t,e,n){var r=n(187);function o(t,e,n,o,i,a,s){try{var c=t[a](s),u=c.value}catch(t){return void n(t)}c.done?e(u):r.resolve(u).then(o,i)}t.exports=function(t){return function(){var e=this,n=arguments;return new r(function(r,i){var a=t.apply(e,n);function s(t){o(a,r,i,s,c,"next",t)}function c(t){o(a,r,i,s,c,"throw",t)}s(void 0)})}}},function(t,e,n){"use strict";(function(t){n.d(e,"b",function(){return r}),n.d(e,"a",function(){return o}),n.d(e,"c",function(){return a}),n.d(e,"d",function(){return G});var r,o,i,a,s=n(78),c=n.n(s),u=n(62),l=n.n(u),h=n(97),f=n.n(h),p=n(98),d=n.n(p),v=n(99),g=n.n(v),y=n(42),C=n.n(y),x=n(24),w=n.n(x),m=n(35),k=n.n(m),S=n(12),b=n.n(S),P=n(9),E=n.n(P),A=n(22),R=n.n(A),I=n(4),D=n.n(I),T=n(2),L=n.n(T),F=n(5),O=n.n(F),M=n(0),U=n.n(M),N=n(19),B=n(121),_=n(10),z=n(77);function j(t,e){var n;if(void 0===d.a||null==f()(t)){if(l()(t)||(n=function(t,e){var n;if(t){if("string"==typeof t)return q(t,e);var r=C()(n=Object.prototype.toString.call(t)).call(n,8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?g()(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?q(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=c()(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}!function(t){t[t.SERVER=0]="SERVER",t[t.P2P=1]="P2P",t[t.TYPE_COUNT=2]="TYPE_COUNT"}(r||(r={})),function(t){t[t.SEED=0]="SEED",t[t.EXCHANGE=1]="EXCHANGE",t[t.LACKED=2]="LACKED",t[t.TYPE_COUNT=3]="TYPE_COUNT"}(o||(o={})),function(t){t[t.SUCCESS=0]="SUCCESS",t[t.REPEAT_SETTINGS=1]="REPEAT_SETTINGS",t[t.UNDEFINED=2]="UNDEFINED",t[t.DATALENGTH_ERROR=3]="DATALENGTH_ERROR",t[t.NULL=4]="NULL",t[t.REVERTED_DUE_P2P=5]="REVERTED_DUE_P2P"}(i||(i={})),function(t){t[t.END_SUCCESS=0]="END_SUCCESS",t[t.END_ERROR=1]="END_ERROR",t[t.NULL=2]="NULL"}(a||(a={}));var W=function(){function e(t){L()(this,e),U()(this,"data",void 0),U()(this,"status",void 0),U()(this,"future",void 0),U()(this,"dataSourceType",void 0),U()(this,"dataRoleType",void 0),U()(this,"dataSourcePeerId",void 0),U()(this,"sourceData",void 0),this.data=t,this.status=i.NULL,this.future=new N.b}return O()(e,[{key:"getGhostPeerId",value:function(){return this.dataSourcePeerId}},{key:"onDataResolved",value:function(t){this.future.onResolved(t)}},{key:"getSourceData",value:function(){return this.sourceData}},{key:"getDataSourceType",value:function(){return this.dataSourceType}},{key:"setData",value:function(e,n,r,o,a){return this.status==i.SUCCESS?i.REPEAT_SETTINGS:(void 0!==e&&e.byteLength==this.data.byteLength?(void 0!==a&&(this.sourceData=a),void 0!==o&&(this.dataSourcePeerId=o),this.status==i.REVERTED_DUE_P2P&&t.from(e.buffer).equals(t.from(this.data.buffer))&&(this.dataSourcePeerId=void 0),this.data.set(e),this.dataSourceType=n,this.dataRoleType=r,this.status=i.SUCCESS,this.future.setResult(this.data)):null==e?(this.status=i.UNDEFINED,this.future.setResult(void 0)):void 0!==e&&e.byteLength!==this.data.byteLength&&(this.status=i.DATALENGTH_ERROR),this.status)}},{key:"isSucceed",value:function(){return this.status==i.SUCCESS}},{key:"resetStatus",value:function(){return this.dataSourceType==r.P2P&&(this.status=i.REVERTED_DUE_P2P,!0)}}]),e}(),V=function t(){L()(this,t),U()(this,"startBlockId",void 0),U()(this,"nextFinishedBlockId",void 0),U()(this,"curCount",void 0),U()(this,"maxCount",void 0),U()(this,"sliceSize",void 0),U()(this,"shareSize",void 0),U()(this,"statArray",void 0),U()(this,"roleArray",void 0),this.statArray=new Array;for(var e=0;e<r.TYPE_COUNT;++e)this.statArray[e]=0;for(this.roleArray=new Array,e=0;e<o.TYPE_COUNT;++e)this.roleArray[e]=0},Y=function(){function t(e,n,i,s){L()(this,t),U()(this,"p2pContext",void 0),U()(this,"blockCount",void 0),U()(this,"fragmentName",void 0),U()(this,"fragmentSize",void 0),U()(this,"buffer",void 0),U()(this,"fragStat",void 0),U()(this,"fragEndErrorMsg",void 0),U()(this,"trustedCrc",void 0),U()(this,"blockSize",void 0),U()(this,"blocks",void 0),U()(this,"sliceProgressArray",void 0),U()(this,"blockFinishCount",void 0),U()(this,"future",void 0),U()(this,"statArray",void 0),U()(this,"roleArray",void 0),U()(this,"distances",void 0),U()(this,"shareSize",void 0),U()(this,"shareQuota",void 0),U()(this,"sliceBlockRangeRecord",{}),U()(this,"sliceIdsInCharge",void 0),U()(this,"ghostPeerIds",void 0),U()(this,"queryServerNum",void 0),U()(this,"crcErrorCallback",void 0),U()(this,"isCrcErrorToRefetch",!1),this.p2pContext=e,this.fragmentName=n,this.fragmentSize=i,this.trustedCrc=s,this.fragStat=a.NULL,this.blocks=new Array,this.statArray=new Array;for(var c=0;c<r.TYPE_COUNT;++c)this.statArray[c]=0;for(this.roleArray=new Array,c=0;c<o.TYPE_COUNT;++c)this.roleArray[c]=0;for(this.sliceProgressArray=new Array,c=0;c<this.p2pContext.Config.sliceCount;++c)this.sliceProgressArray[c]=new V;this.blockFinishCount=0,this.future=new N.b,this.shareSize=0,this.sliceIdsInCharge=new R.a,this.ghostPeerIds=new R.a,this.queryServerNum=0,this.initFragmentBySize(i)}return O()(t,[{key:"doOnceQueryServer",value:function(){this.queryServerNum++}},{key:"getQueryServerNum",value:function(){return this.queryServerNum}},{key:"setCrcErrorCallback",value:function(t){this.crcErrorCallback=t}},{key:"setSliceIds",value:function(t){var e=this;D()(t).call(t,function(t){e.sliceIdsInCharge.add(t)})}},{key:"getSliceIds",value:function(){return this.sliceIdsInCharge}},{key:"getStatArray",value:function(){return this.statArray}},{key:"getRoleArray",value:function(){return this.roleArray}},{key:"getDistances",value:function(){return this.distances}},{key:"getBlockCount",value:function(){return this.blockCount}},{key:"getBlockSize",value:function(){return this.blockSize}},{key:"getBlockByteRange",value:function(t){if(t<0||t>=this.blockCount)return new Array;var e=this.blockSize*t,n=Math.min(this.fragmentSize,e+this.blockSize);return new Array(e,n)}},{key:"getSliceBlockRange",value:function(t){var e=this.sliceBlockRangeRecord[t];return t<0||t>=this.p2pContext.Config.sliceCount||null==e?new Array:new Array(e.begin,e.end)}},{key:"getBlockBelongSlice",value:function(t){if(t<0||t>=this.blockCount)return-1;for(var e=0;e<this.p2pContext.Config.sliceCount;++e){var n=this.sliceBlockRangeRecord[e];if(null!=n&&t<n.end)return e}return-1}},{key:"getSliceByteRange",value:function(t){var e=this.getSliceBlockRange(t);if(2!==e.length||e[0]==e[1])return new Array(0,0);var n=this.getBlockByteRange(e[0]),r=this.getBlockByteRange(e[1]-1);return 0===n.length||0===r.length?new Array(0,0):new Array(n[0],r[1])}},{key:"getBlock",value:function(t){if(!(t<0||t>=this.blockCount||t>=this.blocks.length))return this.blocks[t]}}]),O()(t,[{key:"initFragmentBySize",value:function(t){t<this.p2pContext.Config.blockSize*this.p2pContext.Config.sliceCount?(this.blockCount=this.p2pContext.Config.sliceCount,this.blockSize=Math.ceil(this.fragmentSize/this.blockCount)):(this.blockSize=this.p2pContext.Config.blockSize,this.blockCount=Math.ceil(t/this.blockSize)),this.buffer=new Uint8Array(t),this.distances=new Uint8Array(this.blockCount);for(var e=0;e<this.blockCount;++e)this.distances[e]|=127;var n,r=j(this.getSliceIds());try{for(r.s();!(n=r.n()).done;)for(var o=n.value,i=this.getSliceBlockRange(o),a=i[0];a<i[1];++a)this.distances[a]|=128}catch(t){r.e(t)}finally{r.f()}var s=this.p2pContext.Config.fragmentShareOverride;!0===this.p2pContext.Config.multiTabsShareLimitEnable&&this.p2pContext.totalSistersCount>=1&&this.p2pContext.totalSistersCount<32&&(s/=this.p2pContext.totalSistersCount),this.shareQuota=this.fragmentSize*s,this.shareQuota>this.p2pContext.Config.fragmentShareOverrideMaxBytes&&(this.shareQuota=this.p2pContext.Config.fragmentShareOverrideMaxBytes);var c=this.p2pContext.P2P.P2PDataShareQuotaController.takeShareQuota(t*this.p2pContext.Config.fragmentExtraShareRatio);this.addShareQuotaBytes(c);for(var u=0;u<this.p2pContext.Config.sliceCount;++u){var l=Math.floor(this.blockCount/this.p2pContext.Config.sliceCount*u),h=Math.floor(this.blockCount/this.p2pContext.Config.sliceCount*(u+1));this.sliceBlockRangeRecord[u]={begin:l,end:h}}for(u=0;u<this.blockCount;++u){var f=this.getBlockByteRange(u);this.blocks.push(new W(this.buffer.subarray(f[0],f[1])))}for(u=0;u<this.p2pContext.Config.sliceCount;++u){var p=this.getSliceBlockRange(u);this.sliceProgressArray[u].curCount=0,this.sliceProgressArray[u].maxCount=p[1]-p[0],this.sliceProgressArray[u].startBlockId=p[0],this.sliceProgressArray[u].nextFinishedBlockId=p[0];var d=this.getSliceByteRange(u);this.sliceProgressArray[u].sliceSize=d[1]-d[0],this.sliceProgressArray[u].shareSize=0}}},{key:"getFragmentName",value:function(){return this.fragmentName}},{key:"getFragmentSize",value:function(){return this.fragmentSize}},{key:"getFragmentData",value:function(){return this.getFragStat()==a.END_SUCCESS?this.buffer:void 0}},{key:"setNonP2PFragmentData",value:function(t,e,n,o){if(null!=t)for(var i=0;i<this.blockCount;i++){var a=this.getBlockByteRange(i);if(a.length>0){var s=t.subarray(a[0],a[1]);this.setBlockData(i,s,r.SERVER,e,void 0,o)||this.p2pContext.P2PDataCollectionStatus.addWastedDataSize(s.byteLength,_.e.CDN_REPEAT)}}else this.setFragmentData(t,n,void 0,o)}},{key:"setBlockData",value:function(t,e,n,r,o,a){var s=this.getBlock(t);if(void 0===s)return!1;if(s.isSucceed())return!1;if(s.setData(e,n,r,o,a)==i.SUCCESS){this.statArray[n]+=e.byteLength,this.roleArray[r]+=e.byteLength,null!=this.p2pContext.P2PDataCollectionStatus&&this.p2pContext.P2PDataCollectionStatus.addDownloadSizeRealtime(e.byteLength,n);var c,u=this.getBlockBelongSlice(t);return++this.sliceProgressArray[u].curCount,this.sliceProgressArray[u].statArray[n]+=e.byteLength,this.sliceProgressArray[u].roleArray[r]+=e.byteLength,this.isCrcErrorToRefetch&&void 0!==s.getGhostPeerId()&&(this.p2pContext.GhostPeerIds.add(s.getGhostPeerId()),null===(c=this.p2pContext.PeerSched)||void 0===c||c.closePeer(s.getGhostPeerId())),this.distances[t]&=128,++this.blockFinishCount,this.blockFinishCount===this.blockCount&&this.setFragmentData(this.buffer,void 0,o,a),!0}return!1}},{key:"isBlockFinished",value:function(t){var e=this.getBlock(t);return void 0!==e&&e.isSucceed()}},{key:"isSliceFinished",value:function(t){return this.sliceProgressArray[t].curCount===this.sliceProgressArray[t].maxCount}},{key:"getRoleRatioForSlice",value:function(t,e){if(e<0||e>=this.p2pContext.Config.sliceCount)return 0;var n=this.sliceProgressArray[e];return 0==n.sliceSize?0:n.roleArray[t]/n.sliceSize}},{key:"getSourceRatioForSlice",value:function(t,e){if(e<0||e>=this.p2pContext.Config.sliceCount)return 0;var n=this.sliceProgressArray[e];return 0==n.sliceSize?0:n.statArray[t]/n.sliceSize}},{key:"getSliceSharedRatio",value:function(t){if(t<0||t>=this.p2pContext.Config.sliceCount)return 0;var e=this.sliceProgressArray[t];if(0==e.sliceSize)return 0;var n=e.shareSize/e.sliceSize,r=this.fragmentSize*this.p2pContext.Config.fragmentShareOverride;return r>this.p2pContext.Config.fragmentShareOverrideMaxBytes&&(n=n*r/this.p2pContext.Config.fragmentShareOverrideMaxBytes),n}},{key:"onBlockFinished",value:function(t,e){var n=this.getBlock(t);return void 0!==n&&(n.onDataResolved(e),!0)}},{key:"setFragmentData",value:function(t,e,n,i){var s=function(t){var e,n=new R.a;if(D()(e=t.blocks).call(e,function(t){var e=t.getDataSourceType(),o=t.getSourceData();e===r.SERVER&&void 0!==o&&n.add(o)}),t.p2pContext.printExtLog(0,"[SistersPlayer] Bad crc fragment with ".concat(n.size," server block")),t.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Bad crc fragment with ".concat(n.size," server block")),n.size>0){var o=new Array;D()(n).call(n,function(e){var n=B.a.crc32(e.data,t.p2pContext.Config.crc32Interval);o.push({range:e.range,length:e.data.length,crc:n})}),t.p2pContext.eventReportCallback(new z.EventReport.BadCRCDataReportEvent(o))}};if(null==t||0!==this.buffer.byteLength&&t.byteLength!==this.buffer.byteLength){if(this.fragStat!==a.NULL)return void this.p2pContext.P2PDataCollectionStatus.addFetchError(_.b.ERROR_NO_EFFECT);for(var c=0;c<this.getBlockCount();++c){var u,l;null!==(u=this.getBlock(c))&&void 0!==u&&u.isSucceed()||null===(l=this.getBlock(c))||void 0===l||l.setData(void 0,void 0,void 0,void 0,void 0)}this.fragStat=a.END_ERROR,this.fragEndErrorMsg=e}else if(t.byteLength==this.buffer.byteLength){if(null!=this.trustedCrc&&this.p2pContext.Config.crcVerifyEnable){var h=B.a.crc32(t,this.p2pContext.Config.crc32Interval);if(h!=this.trustedCrc){var f,p,d,v;if(s(this),this.p2pContext.printExtLog(0,E()(f=E()(p="frag name: ".concat(this.fragmentName," local crc: ")).call(p,h.toString(16)," trust crc: ")).call(f,this.trustedCrc.toString(16))),this.p2pContext.Config.allowPrintLog(0)&&console.warn(E()(d=E()(v="[SistersPlayer] frag name: ".concat(this.fragmentName," local crc: ")).call(v,h.toString(16)," trust crc: ")).call(d,this.trustedCrc.toString(16))),this.statArray[r.P2P]>0){this.isCrcErrorToRefetch=!0;for(var g=0;g<this.p2pContext.Config.sliceCount;++g)if(!this.sliceIdsInCharge.has(g)){var y=this.getSliceBlockRange(g);this.statArray[r.P2P]-=this.sliceProgressArray[g].statArray[r.P2P],this.p2pContext.P2PDataCollectionStatus.addWastedDataSize(this.sliceProgressArray[g].statArray[r.P2P],_.e.ERROR_DATA),this.sliceProgressArray[g].statArray[r.P2P]=0;for(var C=y[1]-1;C>=y[0];--C)this.getBlock(C).resetStatus()&&(--this.blockFinishCount,--this.sliceProgressArray[g].curCount)}return void this.crcErrorCallback()}s(this),this.p2pContext.printExtLog(1,"frag name: ".concat(this.fragmentName," --- all from server , but crc is still error")),this.p2pContext.Config.allowPrintLog(1)&&console.warn("[SistersPlayer] frag name: ".concat(this.fragmentName," --- all from server , but crc is still error"))}}this.fragStat=a.END_SUCCESS,this.buffer.set(t)}else if(0==this.buffer.byteLength){for(this.fragmentSize=t.byteLength,this.initFragmentBySize(this.fragmentSize),g=0;g<this.blockCount;++g){var x=this.getBlockByteRange(g);this.setBlockData(g,t.subarray(x[0],x[1]),r.SERVER,o.SEED,n,i)}return}this.future.setResult(this)}},{key:"onFinished",value:function(t){this.future.onResolved(t)}},{key:"isFinished",value:function(){return this.fragStat==a.END_SUCCESS}},{key:"getFragStat",value:function(){return this.fragStat}},{key:"getFragEndErrorMsg",value:function(){return this.fragEndErrorMsg}},{key:"addShareData",value:function(t,e){var n=this.getBlockBelongSlice(t);this.sliceProgressArray[n].shareSize+=e,this.shareSize+=e}},{key:"canShare",value:function(){return this.shareSize<this.shareQuota}},{key:"addShareQuotaBytes",value:function(t){this.shareQuota+=t}},{key:"getRemainingShareQuotaBytes",value:function(){return Math.max(0,this.shareQuota-this.shareSize)}},{key:"getShareSize",value:function(){return this.shareSize}},{key:"getSharedRatio",value:function(){return 0==this.fragmentSize?0:this.shareSize/this.fragmentSize}},{key:"destroy",value:function(){this.fragStat==a.NULL&&this.setFragmentData(void 0,void 0,void 0,void 0)}}]),t}(),G=function(){function t(e){L()(this,t),U()(this,"p2pContext",void 0),U()(this,"collection",new b.a),U()(this,"queue",new Array),U()(this,"sliceIdController",void 0),this.p2pContext=e}return O()(t,[{key:"setSliceIdController",value:function(t){this.sliceIdController=t}},{key:"addFragment",value:function(t,e,n){var r=this.collection.get(t);if(void 0!==r)return r.getFragmentSize()===e?r:void 0;r=new Y(this.p2pContext,t,e,n),this.collection.set(t,r),this.queue.push(t)}},{key:"getFragment",value:function(t){return this.collection.get(t)}},{key:"deleteFragment",value:function(t){var e,n,r=k()(e=this.queue).call(e,t);if(r>=0&&w()(n=this.queue).call(n,r,1),this.collection.has(t)){var o=this.collection.get(t);return null==o||o.destroy(),this.collection.delete(t),!0}return!1}},{key:"deleteFragmentUntil",value:function(t){for(var e,n=k()(e=this.queue).call(e,t);n>this.p2pContext.Config.fragmentCountOutdated;){var r=this.queue.shift();if(void 0!==r){var o=this.collection.get(r);void 0!==o&&(null!=this.p2pContext.P2PDataCollectionStatus&&(this.p2pContext.P2PDataCollectionStatus.addFragmentDataCollection(o),this.p2pContext.P2P.P2PDataShareQuotaController.addFragmentDataCollection(o)),void 0!==this.sliceIdController&&void 0!==o&&this.sliceIdController.addFragmentShareData(o),o.destroy()),this.collection.delete(r)}--n}}},{key:"destroy",value:function(){var t;D()(t=this.collection).call(t,function(t){t.destroy()})}}]),t}()}).call(this,n(294).Buffer)},function(t,e,n){"use strict";var r=n(14),o=n(84).f,i=n(125),a=n(15),s=n(46),c=n(30),u=n(26),l=function(t){var e=function(e,n,r){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(e);case 2:return new t(e,n)}return new t(e,n,r)}return t.apply(this,arguments)};return e.prototype=t.prototype,e};t.exports=function(t,e){var n,h,f,p,d,v,g,y,C=t.target,x=t.global,w=t.stat,m=t.proto,k=x?r:w?r[C]:(r[C]||{}).prototype,S=x?a:a[C]||(a[C]={}),b=S.prototype;for(f in e)n=!i(x?f:C+(w?".":"#")+f,t.forced)&&k&&u(k,f),d=S[f],n&&(v=t.noTargetGet?(y=o(k,f))&&y.value:k[f]),p=n&&v?v:e[f],n&&typeof d==typeof p||(g=t.bind&&n?s(p,r):t.wrap&&n?l(p):m&&"function"==typeof p?s(Function.call,p):p,(t.sham||p&&p.sham||d&&d.sham)&&c(g,"sham",!0),S[f]=g,m&&(u(a,h=C+"Prototype")||c(a,h,{}),a[h][f]=p,t.real&&b&&!b[f]&&c(b,f,p)))}},function(t,e,n){t.exports=n(306)},function(t,e,n){"use strict";n.d(e,"e",function(){return r}),n.d(e,"b",function(){return o}),n.d(e,"d",function(){return i}),n.d(e,"c",function(){return m});var r,o,i,a=n(57),s=n.n(a),c=n(16),u=n.n(c),l=n(4),h=n.n(l),f=n(22),p=n.n(f),d=n(2),v=n.n(d),g=n(5),y=n.n(g),C=n(0),x=n.n(C),w=n(7);n.d(e,"a",function(){return w.a}),function(t){t[t.P2P_LATE=0]="P2P_LATE",t[t.ERROR_DATA=1]="ERROR_DATA",t[t.CDN_REPEAT=2]="CDN_REPEAT",t[t.TYPE_COUNT=3]="TYPE_COUNT"}(r||(r={})),function(t){t[t.ERROR_TO_RELOAD=0]="ERROR_TO_RELOAD",t[t.ERROR_NO_EFFECT=1]="ERROR_NO_EFFECT",t[t.TYPE_COUNT=2]="TYPE_COUNT"}(o||(o={})),function(t){t[t.TX_PEER=0]="TX_PEER",t[t.RX_PEER=1]="RX_PEER",t[t.LAG_PEER=2]="LAG_PEER",t[t.TX_SEEDBOX=3]="TX_SEEDBOX",t[t.RX_SEEDBOX=4]="RX_SEEDBOX",t[t.LAG_SEEDBOX=5]="LAG_SEEDBOX"}(i||(i={}));var m=function(){function t(){v()(this,t),x()(this,"statArray",new Array),x()(this,"roleArray",new Array),x()(this,"shareSize",0),x()(this,"lastestDeleteFragName","--"),x()(this,"statRealtimeArray",new Array),x()(this,"p2pSendSizeRealtime",0),x()(this,"lastestFragName","--"),x()(this,"lastestSaveRatio","0.000"),x()(this,"lastestShareRatio","0.000"),x()(this,"wastedDataArray",new Array),x()(this,"fetchRepeatFragmentNameList",new p.a),x()(this,"fetchErrorArray",new Array),x()(this,"queryServerInfo",{fragNum:0,queryNum:0,largestQPF:0}),x()(this,"trackerInfo",{reqSuccCount:0,reqFailCount:0,reqCostTimeMs:0,conSuccCount:0,conFailCount:0}),x()(this,"peerConnectionInfo",{conSuccCount:0,conFailCount:0,conAbortCount:0}),x()(this,"peerMessageInfo",{pmTxP:0,pmRxP:0,pmLagP:0,pmTxS:0,pmRxS:0,pmLagS:0}),this.initToEmpty()}return y()(t,[{key:"initToEmpty",value:function(){for(var t=0;t<w.b.TYPE_COUNT;++t)this.statArray[t]=0;for(this.shareSize=0,t=0;t<w.b.TYPE_COUNT;++t)this.statRealtimeArray[t]=0;for(this.p2pSendSizeRealtime=0,t=0;t<r.TYPE_COUNT;++t)this.wastedDataArray[t]=0;for(t=0;t<o.TYPE_COUNT;++t)this.fetchErrorArray[t]=0;for(t=0;t<w.a.TYPE_COUNT;++t)this.roleArray[t]=0;this.fetchRepeatFragmentNameList.clear(),this.queryServerInfo.fragNum=0,this.queryServerInfo.queryNum=0,this.queryServerInfo.largestQPF=0,this.trackerInfo.reqSuccCount=0,this.trackerInfo.reqFailCount=0,this.trackerInfo.reqCostTimeMs=0,this.trackerInfo.conSuccCount=0,this.trackerInfo.conFailCount=0,this.peerConnectionInfo.conSuccCount=0,this.peerConnectionInfo.conFailCount=0,this.peerConnectionInfo.conAbortCount=0,this.peerMessageInfo={pmTxP:0,pmRxP:0,pmLagP:0,pmTxS:0,pmRxS:0,pmLagS:0}}},{key:"addPeerMessageDataCollection",value:function(t,e){switch(t){case i.TX_PEER:this.peerMessageInfo.pmTxP+=e;break;case i.RX_PEER:this.peerMessageInfo.pmRxP+=e;break;case i.LAG_PEER:this.peerMessageInfo.pmLagP+=e;break;case i.TX_SEEDBOX:this.peerMessageInfo.pmTxS+=e;break;case i.RX_SEEDBOX:this.peerMessageInfo.pmRxS+=e;break;case i.LAG_SEEDBOX:this.peerMessageInfo.pmLagS+=e}}},{key:"addFragmentDataCollection",value:function(t){var e,n,r=this;h()(e=t.getStatArray()).call(e,function(t,e){r.statArray[e]+=t}),h()(n=t.getRoleArray()).call(n,function(t,e){r.roleArray[e]+=t}),this.shareSize+=t.getShareSize(),this.lastestDeleteFragName=t.getFragmentName()}},{key:"addPeerConnectCount",value:function(t,e){t?this.peerConnectionInfo.conAbortCount++:e?this.peerConnectionInfo.conSuccCount++:this.peerConnectionInfo.conFailCount++}},{key:"getExtendReportInfo",value:function(){return{seedSize:this.roleArray[w.a.SEED],xchgSize:this.roleArray[w.a.EXCHANGE],lackSize:this.roleArray[w.a.LACKED],peerConSucc:this.peerConnectionInfo.conSuccCount,peerConAvail:this.peerConnectionInfo.conSuccCount+this.peerConnectionInfo.conFailCount,peerConTotal:this.peerConnectionInfo.conSuccCount+this.peerConnectionInfo.conFailCount+this.peerConnectionInfo.conAbortCount,pmTxP:this.peerMessageInfo.pmTxP,pmRxP:this.peerMessageInfo.pmRxP,pmLagP:this.peerMessageInfo.pmLagP,pmTxS:this.peerMessageInfo.pmTxS,pmRxS:this.peerMessageInfo.pmRxS,pmLagS:this.peerMessageInfo.pmLagS}}},{key:"addDownloadSizeDataCollection",value:function(t,e,n){this.statArray[e]+=t}},{key:"getP2PDownload",value:function(){return this.statArray[w.b.P2P]}},{key:"getServerDownload",value:function(){return this.statArray[w.b.SERVER]}},{key:"getP2PSend",value:function(){return this.shareSize}},{key:"getP2PSaveRatio",value:function(){var t=this.statArray[w.b.P2P]+this.statArray[w.b.SERVER];return 0==t?"0.000":(this.statArray[w.b.P2P]/t*100).toFixed(3)}},{key:"getP2PShareRatio",value:function(){var t=this.statArray[w.b.P2P]+this.statArray[w.b.SERVER];return 0==t?"0.000":(this.shareSize/t*100).toFixed(3)}},{key:"addDownloadSizeRealtime",value:function(t,e){this.statRealtimeArray[e]+=t}},{key:"addP2PSendSizeRealtime",value:function(t){this.p2pSendSizeRealtime+=t}},{key:"getServerSizeRealtime",value:function(){return this.statRealtimeArray[w.b.SERVER]}},{key:"getP2PSendSizeRealtime",value:function(){return this.p2pSendSizeRealtime}},{key:"getP2PDownloadSizeRealtime",value:function(){return this.statRealtimeArray[w.b.P2P]}},{key:"addLastestFragmentDataCollection",value:function(t){if(this.lastestFragName=t.getFragmentName(),0==t.getFragmentSize())this.lastestShareRatio="0.000",this.lastestSaveRatio="0.000";else{var e=t.getShareSize()/t.getFragmentSize();this.lastestShareRatio=(100*e).toFixed(3);var n=t.getStatArray()[w.b.P2P]/t.getFragmentSize();this.lastestSaveRatio=(100*n).toFixed(3)}this.queryServerInfo.fragNum++,this.queryServerInfo.queryNum+=t.getQueryServerNum(),t.getQueryServerNum()>this.queryServerInfo.largestQPF&&(this.queryServerInfo.largestQPF=t.getQueryServerNum())}},{key:"getLastestFragmentDataCollection",value:function(){return{lastestFragName:this.lastestFragName,lastestShareRatio:this.lastestShareRatio,lastestSaveRatio:this.lastestSaveRatio}}},{key:"getLastestDeleteFragmentName",value:function(){return this.lastestDeleteFragName}},{key:"addWastedDataSize",value:function(t,e,n){this.wastedDataArray[e]+=t,void 0!==n&&e==r.CDN_REPEAT&&this.fetchRepeatFragmentNameList.add(n.fragname+" , "+u()(s()(n.sliceIds)))}},{key:"getWastedDataSize",value:function(t){return this.wastedDataArray[t]}},{key:"getFetchRepeatFragnameListInfo",value:function(){return u()(s()(this.fetchRepeatFragmentNameList))}},{key:"addFetchError",value:function(t){this.fetchErrorArray[t]++}},{key:"getFetchErrorNum",value:function(t){return this.fetchErrorArray[t]}},{key:"addTrackerConnect",value:function(t){t?this.trackerInfo.conSuccCount+=1:this.trackerInfo.conFailCount+=1}},{key:"addTrackerResponse",value:function(t,e){t?this.trackerInfo.reqSuccCount+=1:this.trackerInfo.reqFailCount+=1,this.trackerInfo.reqCostTimeMs+=e}},{key:"getTrackerInfo",value:function(){return this.trackerInfo}},{key:"getQueryServerInfo",value:function(){return this.queryServerInfo}},{key:"clearP2PDataInfo",value:function(){this.initToEmpty()}}]),t}()},function(t,e,n){t.exports=n(207)},function(t,e,n){t.exports=n(252)},function(t,e,n){var r=n(14),o=n(108),i=n(26),a=n(89),s=n(111),c=n(134),u=o("wks"),l=r.Symbol,h=c?l:l&&l.withoutSetter||a;t.exports=function(t){return i(u,t)||(s&&i(l,t)?u[t]=l[t]:u[t]=h("Symbol."+t)),u[t]}},function(t,e,n){(function(e){var n=function(t){return t&&t.Math==Math&&t};t.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof e&&e)||function(){return this}()||Function("return this")()}).call(this,n(83))},function(t,e){t.exports={}},function(t,e,n){t.exports=n(249)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e,n){var r=n(15),o=n(26),i=n(118),a=n(31).f;t.exports=function(t){var e=r.Symbol||(r.Symbol={});o(e,t)||a(e,t,{value:i.f(t)})}},function(t,e,n){"use strict";n.d(e,"d",function(){return P}),n.d(e,"b",function(){return E}),n.d(e,"c",function(){return A}),n.d(e,"a",function(){return R});var r=n(9),o=n.n(r),i=n(57),a=n.n(i),s=n(24),c=n.n(s),u=n(1),l=n.n(u),h=n(3),f=n.n(h),p=n(6),d=n.n(p),v=n(4),g=n.n(v),y=n(12),C=n.n(y),x=n(2),w=n.n(x),m=n(5),k=n.n(m),S=n(0),b=n.n(S),P=function(){function t(){w()(this,t),b()(this,"notifyList",void 0),b()(this,"notifyId",0),this.notifyList=new C.a}return k()(t,[{key:"connect",value:function(t){var e=this.notifyId++;return this.notifyList.set(e,t),e}},{key:"disconnect",value:function(t){return this.notifyList.delete(t)}},{key:"call",value:function(t){var e;g()(e=this.notifyList).call(e,function(e){e(t)})}}]),t}(),E=function(){function t(){w()(this,t),b()(this,"result",void 0),b()(this,"callbacks_res",new Array)}return k()(t,[{key:"setResult",value:function(t){if(this.result=t,void 0!==this.callbacks_res){for(var e=0;e<this.callbacks_res.length;++e)this.callbacks_res[e](t);this.callbacks_res=void 0}}},{key:"onResolved",value:function(t){return void 0===this.callbacks_res?t(this.result):this.callbacks_res.push(t),this}},{key:"isResolved",value:function(){return void 0===this.callbacks_res}}]),t}(),A=function(){function t(){w()(this,t),b()(this,"waitingList_",void 0),b()(this,"isLocked_",void 0),b()(this,"mutexId_",void 0),this.waitingList_=new Array,this.isLocked_=!1,this.mutexId_=++t.maxMutexId_}return k()(t,[{key:"lock",value:function(){var t=this;return!0===this.isLocked_?new f.a(function(e){return t.waitingList_.push(e)}):(this.isLocked_=!0,f.a.resolve())}},{key:"unlock",value:function(){var t=this.waitingList_.shift();void 0!==t?t():this.isLocked_=!1}},{key:"isLocked",value:function(){return this.isLocked_}},{key:"getId",value:function(){return this.mutexId_}}]),t}();b()(A,"maxMutexId_",0);var R=function(){function t(){w()(this,t),b()(this,"notifyList",void 0),b()(this,"notifyingList",void 0),this.notifyList=new Array,this.notifyingList=new Array}var e;return k()(t,[{key:"waitUntilAsync",value:(e=d()(l.a.mark(function t(e,n){var r,o,i=this;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.unlock(),t.next=3,new f.a(function(t){return i.notifyList.push(t)});case 3:return r=t.sent,t.next=6,e.lock();case 6:if(o=n(),!0!==r&&!1!==o||this.notify(r),!0!==o){t.next=10;break}return t.abrupt("break",12);case 10:t.next=0;break;case 12:case"end":return t.stop()}},t,this)})),function(t,n){return e.apply(this,arguments)})},{key:"waitUntil",value:function(t,e){return!0===e()?f.a.resolve():this.waitUntilAsync(t,e)}},{key:"prepareNotify",value:function(){var t,e,n,r;(e=c()(t=this.notifyingList)).call.apply(e,o()(n=[t,this.notifyingList.length,0]).call(n,a()(this.notifyList))),c()(r=this.notifyList).call(r,0,this.notifyList.length)}},{key:"notify",value:function(t){var e=this.notifyingList.shift();void 0!==e&&e(t)}},{key:"notifyOne",value:function(){this.prepareNotify(),this.notify(!1)}},{key:"notifyAll",value:function(){this.prepareNotify(),this.notify(!0)}}]),t}()},function(t,n,r){"use strict";r.r(n),r.d(n,"PeerRole",function(){return Q}),r.d(n,"PeerExtensionData",function(){return ct}),r.d(n,"PeerRequest",function(){return lt}),r.d(n,"PeerResponse",function(){return ht}),r.d(n,"PeerMessage",function(){return ft}),r.d(n,"NyaPeer",function(){return dt});var o=r(175),i=r.n(o),a=r(65),s=r.n(a),c=r(24),u=r.n(c),l=r(1),h=r.n(l),f=r(6),p=r.n(f),d=r(4),v=r.n(d),g=r(22),y=r.n(g),C=r(12),x=r.n(C),w=r(11),m=r.n(w),k=r(5),S=r.n(k),b=r(3),P=r.n(b),E=r(2),A=r.n(E),R=r(0),I=r.n(R),D=void 0!==e&&"undefined"!=typeof TextEncoder&&"undefined"!=typeof TextDecoder;function T(t){for(var e=t.length,n=0,r=0;r<e;){var o=t.charCodeAt(r++);if(0!=(4294967168&o))if(0==(4294965248&o))n+=2;else{if(o>=55296&&o<=56319&&r<e){var i=t.charCodeAt(r);56320==(64512&i)&&(++r,o=((1023&o)<<10)+(1023&i)+65536)}n+=0==(4294901760&o)?3:4}else n++}return n}var L=D?new TextEncoder:void 0,F=D?void 0!==e?200:0:4294967295,O=(null==L?void 0:L.encodeInto)?function(t,e,n){L.encodeInto(t,e.subarray(n))}:function(t,e,n){e.set(L.encode(t),n)};function M(t,e,n){for(var r=e,o=r+n,i=[],a="";r<o;){var s=t[r++];if(0==(128&s))i.push(s);else if(192==(224&s)){var c=63&t[r++];i.push((31&s)<<6|c)}else if(224==(240&s)){c=63&t[r++];var u=63&t[r++];i.push((31&s)<<12|c<<6|u)}else if(240==(248&s)){var l=(7&s)<<18|(c=63&t[r++])<<12|(u=63&t[r++])<<6|63&t[r++];l>65535&&(l-=65536,i.push(l>>>10&1023|55296),l=56320|1023&l),i.push(l)}else i.push(s);i.length>=4096&&(a+=String.fromCharCode.apply(String,i),i.length=0)}return i.length>0&&(a+=String.fromCharCode.apply(String,i)),a}var U=D?new TextDecoder:null,N=D?void 0!==e?200:0:4294967295,B=function(t,e){this.type=t,this.data=e};function _(t,e,n){var r=Math.floor(n/4294967296),o=n;t.setUint32(e,r),t.setUint32(e+4,o)}function z(t,e){return 4294967296*t.getInt32(e)+t.getUint32(e+4)}var j={type:-1,encode:function(t){var e,n,r,o;return t instanceof Date?function(t){var e,n=t.sec,r=t.nsec;if(n>=0&&r>=0&&n<=17179869183){if(0===r&&n<=4294967295){var o=new Uint8Array(4);return(e=new DataView(o.buffer)).setUint32(0,n),o}var i=n/4294967296,a=4294967295&n;return o=new Uint8Array(8),(e=new DataView(o.buffer)).setUint32(0,r<<2|3&i),e.setUint32(4,a),o}return o=new Uint8Array(12),(e=new DataView(o.buffer)).setUint32(0,r),_(e,4,n),o}((r=1e6*((e=t.getTime())-1e3*(n=Math.floor(e/1e3))),{sec:n+(o=Math.floor(r/1e9)),nsec:r-1e9*o})):null},decode:function(t){var e=function(t){var e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:var n=e.getUint32(0);return{sec:4294967296*(3&n)+e.getUint32(4),nsec:n>>>2};case 12:return{sec:z(e,4),nsec:e.getUint32(0)};default:throw new Error("Unrecognized data size for timestamp: "+t.length)}}(t);return new Date(1e3*e.sec+e.nsec/1e6)}},q=function(){function t(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(j)}return t.prototype.register=function(t){var e=t.type,n=t.encode,r=t.decode;if(e>=0)this.encoders[e]=n,this.decoders[e]=r;else{var o=1+e;this.builtInEncoders[o]=n,this.builtInDecoders[o]=r}},t.prototype.tryToEncode=function(t,e){for(var n=0;n<this.builtInEncoders.length;n++)if(null!=(r=this.builtInEncoders[n])&&null!=(o=r(t,e)))return new B(-1-n,o);for(n=0;n<this.encoders.length;n++){var r,o;if(null!=(r=this.encoders[n])&&null!=(o=r(t,e)))return new B(n,o)}return t instanceof B?t:null},t.prototype.decode=function(t,e,n){var r=e<0?this.builtInDecoders[-1-e]:this.decoders[e];return r?r(t,e,n):new B(e,t)},t.defaultCodec=new t,t}();function W(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Uint8Array.from(t)}var V=function(){function t(t,e,n,r,o,i,a,s){void 0===t&&(t=q.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=100),void 0===r&&(r=2048),void 0===o&&(o=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===s&&(s=!1),this.extensionCodec=t,this.context=e,this.maxDepth=n,this.initialBufferSize=r,this.sortKeys=o,this.forceFloat32=i,this.ignoreUndefined=a,this.forceIntegerToFloat=s,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return t.prototype.getUint8Array=function(){return this.bytes.subarray(0,this.pos)},t.prototype.reinitializeState=function(){this.pos=0},t.prototype.encode=function(t){return this.reinitializeState(),this.doEncode(t,1),this.getUint8Array()},t.prototype.doEncode=function(t,e){if(e>this.maxDepth)throw new Error("Too deep objects in depth "+e);null==t?this.encodeNil():"boolean"==typeof t?this.encodeBoolean(t):"number"==typeof t?this.encodeNumber(t):"string"==typeof t?this.encodeString(t):this.encodeObject(t,e)},t.prototype.ensureBufferSizeToWrite=function(t){var e=this.pos+t;this.view.byteLength<e&&this.resizeBuffer(2*e)},t.prototype.resizeBuffer=function(t){var e=new ArrayBuffer(t),n=new Uint8Array(e),r=new DataView(e);n.set(this.bytes),this.view=r,this.bytes=n},t.prototype.encodeNil=function(){this.writeU8(192)},t.prototype.encodeBoolean=function(t){!1===t?this.writeU8(194):this.writeU8(195)},t.prototype.encodeNumber=function(t){Number.isSafeInteger(t)&&!this.forceIntegerToFloat?t>=0?t<128?this.writeU8(t):t<256?(this.writeU8(204),this.writeU8(t)):t<65536?(this.writeU8(205),this.writeU16(t)):t<4294967296?(this.writeU8(206),this.writeU32(t)):(this.writeU8(207),this.writeU64(t)):t>=-32?this.writeU8(224|t+32):t>=-128?(this.writeU8(208),this.writeI8(t)):t>=-32768?(this.writeU8(209),this.writeI16(t)):t>=-2147483648?(this.writeU8(210),this.writeI32(t)):(this.writeU8(211),this.writeI64(t)):this.forceFloat32?(this.writeU8(202),this.writeF32(t)):(this.writeU8(203),this.writeF64(t))},t.prototype.writeStringHeader=function(t){if(t<32)this.writeU8(160+t);else if(t<256)this.writeU8(217),this.writeU8(t);else if(t<65536)this.writeU8(218),this.writeU16(t);else{if(!(t<4294967296))throw new Error("Too long string: "+t+" bytes in UTF-8");this.writeU8(219),this.writeU32(t)}},t.prototype.encodeString=function(t){if(t.length>F){var e=T(t);this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),O(t,this.bytes,this.pos),this.pos+=e}else e=T(t),this.ensureBufferSizeToWrite(5+e),this.writeStringHeader(e),function(t,e,n){for(var r=t.length,o=n,i=0;i<r;){var a=t.charCodeAt(i++);if(0!=(4294967168&a)){if(0==(4294965248&a))e[o++]=a>>6&31|192;else{if(a>=55296&&a<=56319&&i<r){var s=t.charCodeAt(i);56320==(64512&s)&&(++i,a=((1023&a)<<10)+(1023&s)+65536)}0==(4294901760&a)?(e[o++]=a>>12&15|224,e[o++]=a>>6&63|128):(e[o++]=a>>18&7|240,e[o++]=a>>12&63|128,e[o++]=a>>6&63|128)}e[o++]=63&a|128}else e[o++]=a}}(t,this.bytes,this.pos),this.pos+=e},t.prototype.encodeObject=function(t,e){var n=this.extensionCodec.tryToEncode(t,this.context);if(null!=n)this.encodeExtension(n);else if(Array.isArray(t))this.encodeArray(t,e);else if(ArrayBuffer.isView(t))this.encodeBinary(t);else{if("object"!=typeof t)throw new Error("Unrecognized object: "+Object.prototype.toString.apply(t));this.encodeMap(t,e)}},t.prototype.encodeBinary=function(t){var e=t.byteLength;if(e<256)this.writeU8(196),this.writeU8(e);else if(e<65536)this.writeU8(197),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large binary: "+e);this.writeU8(198),this.writeU32(e)}var n=W(t);this.writeU8a(n)},t.prototype.encodeArray=function(t,e){var n=t.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else{if(!(n<4294967296))throw new Error("Too large array: "+n);this.writeU8(221),this.writeU32(n)}for(var r=0,o=t;r<o.length;r++){var i=o[r];this.doEncode(i,e+1)}},t.prototype.countWithoutUndefined=function(t,e){for(var n=0,r=0,o=e;r<o.length;r++)void 0!==t[o[r]]&&n++;return n},t.prototype.encodeMap=function(t,e){var n=Object.keys(t);this.sortKeys&&n.sort();var r=this.ignoreUndefined?this.countWithoutUndefined(t,n):n.length;if(r<16)this.writeU8(128+r);else if(r<65536)this.writeU8(222),this.writeU16(r);else{if(!(r<4294967296))throw new Error("Too large map object: "+r);this.writeU8(223),this.writeU32(r)}for(var o=0,i=n;o<i.length;o++){var a=i[o],s=t[a];this.ignoreUndefined&&void 0===s||(this.encodeString(a),this.doEncode(s,e+1))}},t.prototype.encodeExtension=function(t){var e=t.data.length;if(1===e)this.writeU8(212);else if(2===e)this.writeU8(213);else if(4===e)this.writeU8(214);else if(8===e)this.writeU8(215);else if(16===e)this.writeU8(216);else if(e<256)this.writeU8(199),this.writeU8(e);else if(e<65536)this.writeU8(200),this.writeU16(e);else{if(!(e<4294967296))throw new Error("Too large extension object: "+e);this.writeU8(201),this.writeU32(e)}this.writeI8(t.type),this.writeU8a(t.data)},t.prototype.writeU8=function(t){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,t),this.pos++},t.prototype.writeU8a=function(t){var e=t.length;this.ensureBufferSizeToWrite(e),this.bytes.set(t,this.pos),this.pos+=e},t.prototype.writeI8=function(t){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,t),this.pos++},t.prototype.writeU16=function(t){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,t),this.pos+=2},t.prototype.writeI16=function(t){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,t),this.pos+=2},t.prototype.writeU32=function(t){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,t),this.pos+=4},t.prototype.writeI32=function(t){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,t),this.pos+=4},t.prototype.writeF32=function(t){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,t),this.pos+=4},t.prototype.writeF64=function(t){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,t),this.pos+=8},t.prototype.writeU64=function(t){this.ensureBufferSizeToWrite(8),function(t,e,n){var r=n/4294967296,o=n;t.setUint32(e,r),t.setUint32(e+4,o)}(this.view,this.pos,t),this.pos+=8},t.prototype.writeI64=function(t){this.ensureBufferSizeToWrite(8),_(this.view,this.pos,t),this.pos+=8},t}(),Y={};function G(t){return(t<0?"-":"")+"0x"+Math.abs(t).toString(16).padStart(2,"0")}var Q,H=function(){function t(t,e){void 0===t&&(t=16),void 0===e&&(e=16),this.maxKeyLength=t,this.maxLengthPerKey=e,this.hit=0,this.miss=0,this.caches=[];for(var n=0;n<this.maxKeyLength;n++)this.caches.push([])}return t.prototype.canBeCached=function(t){return t>0&&t<=this.maxKeyLength},t.prototype.get=function(t,e,n){var r=this.caches[n-1],o=r.length;t:for(var i=0;i<o;i++){for(var a=r[i],s=a.bytes,c=0;c<n;c++)if(s[c]!==t[e+c])continue t;return a.value}return null},t.prototype.store=function(t,e){var n=this.caches[t.length-1],r={bytes:t,value:e};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=r:n.push(r)},t.prototype.decode=function(t,e,n){var r=this.get(t,e,n);if(null!=r)return this.hit++,r;this.miss++;var o=M(t,e,n),i=Uint8Array.prototype.slice.call(t,e,e+n);return this.store(i,o),o},t}(),X=function(t,e){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},K=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise(function(r,o){!function(t,e,n,r){Promise.resolve(r).then(function(e){t({value:e,done:n})},e)}(r,o,(e=t[n](e)).done,e.value)})}}},J=function(t){return this instanceof J?(this.v=t,this):new J(t)},$=new DataView(new ArrayBuffer(0)),Z=new Uint8Array($.buffer),tt=function(){try{$.getInt8(0)}catch(t){return t.constructor}throw new Error("never reached")}(),et=new tt("Insufficient data"),nt=new H,rt=function(){function t(t,e,n,r,o,i,a,s){void 0===t&&(t=q.defaultCodec),void 0===e&&(e=void 0),void 0===n&&(n=4294967295),void 0===r&&(r=4294967295),void 0===o&&(o=4294967295),void 0===i&&(i=4294967295),void 0===a&&(a=4294967295),void 0===s&&(s=nt),this.extensionCodec=t,this.context=e,this.maxStrLength=n,this.maxBinLength=r,this.maxArrayLength=o,this.maxMapLength=i,this.maxExtLength=a,this.keyDecoder=s,this.totalPos=0,this.pos=0,this.view=$,this.bytes=Z,this.headByte=-1,this.stack=[]}return t.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=-1},t.prototype.setBuffer=function(t){this.bytes=W(t),this.view=function(t){if(t instanceof ArrayBuffer)return new DataView(t);var e=W(t);return new DataView(e.buffer,e.byteOffset,e.byteLength)}(this.bytes),this.pos=0},t.prototype.appendBuffer=function(t){if(-1!==this.headByte||this.hasRemaining()){var e=this.bytes.subarray(this.pos),n=W(t),r=new Uint8Array(e.length+n.length);r.set(e),r.set(n,e.length),this.setBuffer(r)}else this.setBuffer(t)},t.prototype.hasRemaining=function(t){return void 0===t&&(t=1),this.view.byteLength-this.pos>=t},t.prototype.createExtraByteError=function(t){var e=this.view,n=this.pos;return new RangeError("Extra "+(e.byteLength-n)+" of "+e.byteLength+" byte(s) found at buffer["+t+"]")},t.prototype.decode=function(t){this.reinitializeState(),this.setBuffer(t);var e=this.doDecodeSync();if(this.hasRemaining())throw this.createExtraByteError(this.pos);return e},t.prototype.decodeAsync=function(t){var e,n,r,o;return function(t,e,n,r){return new(n||(n=Promise))(function(o,i){function a(t){try{c(r.next(t))}catch(t){i(t)}}function s(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(a,s)}c((r=r.apply(t,e||[])).next())})}(this,void 0,void 0,function(){var i,a,s,c,u,l,h,f;return X(this,function(p){switch(p.label){case 0:i=!1,p.label=1;case 1:p.trys.push([1,6,7,12]),e=K(t),p.label=2;case 2:return[4,e.next()];case 3:if((n=p.sent()).done)return[3,5];if(s=n.value,i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s);try{a=this.doDecodeSync(),i=!0}catch(t){if(!(t instanceof tt))throw t}this.totalPos+=this.pos,p.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return c=p.sent(),r={error:c},[3,12];case 7:return p.trys.push([7,,10,11]),n&&!n.done&&(o=e.return)?[4,o.call(e)]:[3,9];case 8:p.sent(),p.label=9;case 9:return[3,11];case 10:if(r)throw r.error;return[7];case 11:return[7];case 12:if(i){if(this.hasRemaining())throw this.createExtraByteError(this.totalPos);return[2,a]}throw l=(u=this).headByte,h=u.pos,f=u.totalPos,new RangeError("Insufficient data in parsing "+G(l)+" at "+f+" ("+h+" in the current buffer)")}})})},t.prototype.decodeArrayStream=function(t){return this.decodeMultiAsync(t,!0)},t.prototype.decodeStream=function(t){return this.decodeMultiAsync(t,!1)},t.prototype.decodeMultiAsync=function(t,e){return function(t,e,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=n.apply(t,e||[]),i=[];return r={},a("next"),a("throw"),a("return"),r[Symbol.asyncIterator]=function(){return this},r;function a(t){o[t]&&(r[t]=function(e){return new Promise(function(n,r){i.push([t,e,n,r])>1||s(t,e)})})}function s(t,e){try{(n=o[t](e)).value instanceof J?Promise.resolve(n.value.v).then(c,u):l(i[0][2],n)}catch(t){l(i[0][3],t)}var n}function c(t){s("next",t)}function u(t){s("throw",t)}function l(t,e){t(e),i.shift(),i.length&&s(i[0][0],i[0][1])}}(this,arguments,function(){var n,r,o,i,a,s,c,u,l;return X(this,function(h){switch(h.label){case 0:n=e,r=-1,h.label=1;case 1:h.trys.push([1,13,14,19]),o=K(t),h.label=2;case 2:return[4,J(o.next())];case 3:if((i=h.sent()).done)return[3,12];if(a=i.value,e&&0===r)throw this.createExtraByteError(this.totalPos);this.appendBuffer(a),n&&(r=this.readArraySize(),n=!1,this.complete()),h.label=4;case 4:h.trys.push([4,9,,10]),h.label=5;case 5:return[4,J(this.doDecodeSync())];case 6:return[4,h.sent()];case 7:return h.sent(),0==--r?[3,8]:[3,5];case 8:return[3,10];case 9:if(!((s=h.sent())instanceof tt))throw s;return[3,10];case 10:this.totalPos+=this.pos,h.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return c=h.sent(),u={error:c},[3,19];case 14:return h.trys.push([14,,17,18]),i&&!i.done&&(l=o.return)?[4,J(l.call(o))]:[3,16];case 15:h.sent(),h.label=16;case 16:return[3,18];case 17:if(u)throw u.error;return[7];case 18:return[7];case 19:return[2]}})})},t.prototype.doDecodeSync=function(){t:for(;;){var t=this.readHeadByte(),e=void 0;if(t>=224)e=t-256;else if(t<192)if(t<128)e=t;else if(t<144){if(0!=(r=t-128)){this.pushMapState(r),this.complete();continue t}e={}}else if(t<160){if(0!=(r=t-144)){this.pushArrayState(r),this.complete();continue t}e=[]}else{var n=t-160;e=this.decodeUtf8String(n,0)}else if(192===t)e=null;else if(194===t)e=!1;else if(195===t)e=!0;else if(202===t)e=this.readF32();else if(203===t)e=this.readF64();else if(204===t)e=this.readU8();else if(205===t)e=this.readU16();else if(206===t)e=this.readU32();else if(207===t)e=this.readU64();else if(208===t)e=this.readI8();else if(209===t)e=this.readI16();else if(210===t)e=this.readI32();else if(211===t)e=this.readI64();else if(217===t)n=this.lookU8(),e=this.decodeUtf8String(n,1);else if(218===t)n=this.lookU16(),e=this.decodeUtf8String(n,2);else if(219===t)n=this.lookU32(),e=this.decodeUtf8String(n,4);else if(220===t){if(0!==(r=this.readU16())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(221===t){if(0!==(r=this.readU32())){this.pushArrayState(r),this.complete();continue t}e=[]}else if(222===t){if(0!==(r=this.readU16())){this.pushMapState(r),this.complete();continue t}e={}}else if(223===t){if(0!==(r=this.readU32())){this.pushMapState(r),this.complete();continue t}e={}}else if(196===t){var r=this.lookU8();e=this.decodeBinary(r,1)}else if(197===t)r=this.lookU16(),e=this.decodeBinary(r,2);else if(198===t)r=this.lookU32(),e=this.decodeBinary(r,4);else if(212===t)e=this.decodeExtension(1,0);else if(213===t)e=this.decodeExtension(2,0);else if(214===t)e=this.decodeExtension(4,0);else if(215===t)e=this.decodeExtension(8,0);else if(216===t)e=this.decodeExtension(16,0);else if(199===t)r=this.lookU8(),e=this.decodeExtension(r,1);else if(200===t)r=this.lookU16(),e=this.decodeExtension(r,2);else{if(201!==t)throw new Error("Unrecognized type byte: "+G(t));r=this.lookU32(),e=this.decodeExtension(r,4)}this.complete();for(var o=this.stack;o.length>0;){var i=o[o.length-1];if(0===i.type){if(i.array[i.position]=e,i.position++,i.position!==i.size)continue t;o.pop(),e=i.array}else{if(1===i.type){if(void 0,"string"!=(a=typeof e)&&"number"!==a)throw new Error("The type of key must be string or number but "+typeof e);i.key=e,i.type=2;continue t}if(i.map[i.key]=e,i.readCount++,i.readCount!==i.size){i.key=null,i.type=1;continue t}o.pop(),e=i.map}}return e}var a},t.prototype.readHeadByte=function(){return-1===this.headByte&&(this.headByte=this.readU8()),this.headByte},t.prototype.complete=function(){this.headByte=-1},t.prototype.readArraySize=function(){var t=this.readHeadByte();switch(t){case 220:return this.readU16();case 221:return this.readU32();default:if(t<160)return t-144;throw new Error("Unrecognized array type byte: "+G(t))}},t.prototype.pushMapState=function(t){if(t>this.maxMapLength)throw new Error("Max length exceeded: map length ("+t+") > maxMapLengthLength ("+this.maxMapLength+")");this.stack.push({type:1,size:t,key:null,readCount:0,map:{}})},t.prototype.pushArrayState=function(t){if(t>this.maxArrayLength)throw new Error("Max length exceeded: array length ("+t+") > maxArrayLength ("+this.maxArrayLength+")");this.stack.push({type:0,size:t,array:new Array(t),position:0})},t.prototype.decodeUtf8String=function(t,e){var n;if(t>this.maxStrLength)throw new Error("Max length exceeded: UTF-8 byte length ("+t+") > maxStrLength ("+this.maxStrLength+")");if(this.bytes.byteLength<this.pos+e+t)throw et;var r,o=this.pos+e;return r=this.stateIsMapKey()&&(null===(n=this.keyDecoder)||void 0===n?void 0:n.canBeCached(t))?this.keyDecoder.decode(this.bytes,o,t):t>N?function(t,e,n){var r=t.subarray(e,e+n);return U.decode(r)}(this.bytes,o,t):M(this.bytes,o,t),this.pos+=e+t,r},t.prototype.stateIsMapKey=function(){return this.stack.length>0&&1===this.stack[this.stack.length-1].type},t.prototype.decodeBinary=function(t,e){if(t>this.maxBinLength)throw new Error("Max length exceeded: bin length ("+t+") > maxBinLength ("+this.maxBinLength+")");if(!this.hasRemaining(t+e))throw et;var n=this.pos+e,r=this.bytes.subarray(n,n+t);return this.pos+=e+t,r},t.prototype.decodeExtension=function(t,e){if(t>this.maxExtLength)throw new Error("Max length exceeded: ext length ("+t+") > maxExtLength ("+this.maxExtLength+")");var n=this.view.getInt8(this.pos+e),r=this.decodeBinary(t,e+1);return this.extensionCodec.decode(r,n,this.context)},t.prototype.lookU8=function(){return this.view.getUint8(this.pos)},t.prototype.lookU16=function(){return this.view.getUint16(this.pos)},t.prototype.lookU32=function(){return this.view.getUint32(this.pos)},t.prototype.readU8=function(){var t=this.view.getUint8(this.pos);return this.pos++,t},t.prototype.readI8=function(){var t=this.view.getInt8(this.pos);return this.pos++,t},t.prototype.readU16=function(){var t=this.view.getUint16(this.pos);return this.pos+=2,t},t.prototype.readI16=function(){var t=this.view.getInt16(this.pos);return this.pos+=2,t},t.prototype.readU32=function(){var t=this.view.getUint32(this.pos);return this.pos+=4,t},t.prototype.readI32=function(){var t=this.view.getInt32(this.pos);return this.pos+=4,t},t.prototype.readU64=function(){var t,e,n=(t=this.view,e=this.pos,4294967296*t.getUint32(e)+t.getUint32(e+4));return this.pos+=8,n},t.prototype.readI64=function(){var t=z(this.view,this.pos);return this.pos+=8,t},t.prototype.readF32=function(){var t=this.view.getFloat32(this.pos);return this.pos+=4,t},t.prototype.readF64=function(){var t=this.view.getFloat64(this.pos);return this.pos+=8,t},t}(),ot={},it=r(19),at=r(10),st=r(101);!function(t){t[t.Peer=0]="Peer",t[t.Leech=1]="Leech",t[t.Seedbox=2]="Seedbox"}(Q||(Q={}));var ct=function t(){A()(this,t),I()(this,"peerId",""),I()(this,"isDownloadBlockReport",!1),I()(this,"isAnswerAccepted",!1),I()(this,"candidate_resolver",void 0)},ut=function t(e){var n=this;A()(this,t),I()(this,"buf",void 0),I()(this,"promise",void 0),I()(this,"resolver",void 0),this.buf=e,this.promise=new P.a(function(t){n.resolver=t})},lt=function t(){A()(this,t),I()(this,"action",""),I()(this,"data",void 0)},ht=function t(){A()(this,t),I()(this,"requestId",-1),I()(this,"status","not_implemented"),I()(this,"data",void 0)},ft=function t(){A()(this,t),I()(this,"type",""),I()(this,"requestId",-1),I()(this,"action_type",""),I()(this,"action",""),I()(this,"data",void 0)},pt=function(){function t(e,n){var r=this;A()(this,t),I()(this,"p2pContext",void 0),I()(this,"dc",void 0),I()(this,"sendQueue",new Array),I()(this,"isSending",!1),this.p2pContext=e,this.dc=n,this.dc.binaryType="arraybuffer",this.dc.bufferedAmountLowThreshold=262144,this.dc.onbufferedamountlow=function(){return r.onDCWritable()}}return S()(t,[{key:"onDCWritable",value:function(){var t=this;this.isSending=!0;for(var e,n,r=this.dc.bufferedAmount;r<1048576;){var o,i=this.sendQueue.shift();if(void 0===i){this.isSending=!1;break}void 0!==i.buf.data&&null!==i.buf.data&&void 0!==i.buf.data.length&&i.buf.data.length>1024||(this.p2pContext.printExtLog(6,"send: "+i.buf),this.p2pContext.Config.allowPrintLog(6)&&console.log("send: "+i.buf));try{if("open"===this.dc.readyState){var a=(e=i.buf,void 0===(n=void 0)&&(n=Y),new V(n.extensionCodec,n.context,n.maxDepth,n.initialBufferSize,n.sortKeys,n.forceFloat32,n.ignoreUndefined,n.forceIntegerToFloat).encode(e));this.dc.send(a),r+=a.length}}catch(t){this.p2pContext.printExtLog(0,"One sister forcibly disconnected from the Misaka Network. QwQ"),this.p2pContext.Config.allowPrintLog(0)&&console.info("[SistersPlayer] One sister forcibly disconnected from the Misaka Network. QwQ")}null===(o=i.resolver)||void 0===o||o.call(i)}this.sendQueue.length>0&&r>1048576&&this.dc.bufferedAmount<this.dc.bufferedAmountLowThreshold&&m()(function(){return t.onDCWritable()},0)}}]),S()(t,[{key:"dataChannel",value:function(){return this.dc}},{key:"send",value:function(t){var e=new ut(t);return this.sendQueue.push(e),!1===this.isSending&&this.onDCWritable(),e.promise}}]),t}(),dt=function(){function t(e,n,r){var o,i=this;A()(this,t),I()(this,"p2pContext",void 0),I()(this,"peerSched",void 0),I()(this,"incoming",void 0),I()(this,"pc",void 0),I()(this,"dc",void 0),I()(this,"requestId",0),I()(this,"pendingRequests",new x.a),I()(this,"dc_resolver",void 0),I()(this,"dc_future",void 0),I()(this,"extData",new ct),I()(this,"onCandidate",void 0),I()(this,"candidates",new Array),I()(this,"role_",Q.Peer),I()(this,"seedSliceIds_",new y.a),I()(this,"seedScore",100),this.p2pContext=e,this.incoming=r,this.peerSched=n;var a=[];if(v()(o=this.p2pContext.Config.stunServers).call(o,function(t){var e={urls:t};a.push(e)}),this.pc=new RTCPeerConnection({iceServers:a,iceCandidatePoolSize:this.p2pContext.Config.iceCandidatePoolSize,iceTransportPolicy:"all"}),!this.pc)throw"Emtpy RTCPeerConnection object after creating.";this.pc.addEventListener("datachannel",function(t){"misaka-denpa"===t.channel.label&&(i.dc=new pt(i.p2pContext,t.channel),i.dc.dataChannel().onmessage=function(t){return i.onMessageReceived(t.data)},void 0!==i.dc_resolver&&i.dc_resolver())}),this.pc.addEventListener("icegatheringstatechange",function(t){switch(i.p2pContext.printExtLog(4,"peer "+i.extData.peerId+" icegatheringstatechange state: "+i.pc.iceGatheringState),i.p2pContext.Config.allowPrintLog(4)&&console.log("peer "+i.extData.peerId+" icegatheringstatechange state: "+i.pc.iceGatheringState),i.pc.iceGatheringState){case"new":case"gathering":break;case"complete":i.extData.candidate_resolver&&i.extData.candidate_resolver(!0)}}),this.pc.addEventListener("iceconnectionstatechange",function(t){switch(i.p2pContext.printExtLog(4,"peer "+i.extData.peerId+" iceconnection state: "+i.pc.iceConnectionState),i.p2pContext.Config.allowPrintLog(4)&&console.log("peer "+i.extData.peerId+" iceconnection state: "+i.pc.iceConnectionState),i.pc.iceConnectionState){case"new":case"checking":case"connected":case"completed":break;case"disconnected":i.peerSched.onPeerDisConnected(i);break;case"failed":i.peerSched.onPeerConnectComplete(i,!1);break;case"closed":i.peerSched.onPeerDisConnected(i)}}),this.pc.addEventListener("signalingstatechange",function(t){i.p2pContext.printExtLog(4,"peer "+i.extData.peerId+" signaling state: "+i.pc.iceConnectionState),i.p2pContext.Config.allowPrintLog(4)&&console.log("peer "+i.extData.peerId+" signaling state: "+i.pc.iceConnectionState),i.pc.signalingState}),this.pc.addEventListener("icecandidate",function(t){null!=t.candidate&&i.onCandidate(t.candidate)}),this.onCandidate=function(t){null!=t&&null!=t.candidate&&""!=t.candidate&&i.candidates.push(t)}}var e,n,r,o,a,c,l;return S()(t,[{key:"peerRole",get:function(){return this.role_}},{key:"seedSliceIds",get:function(){return this.seedSliceIds_}}]),S()(t,[{key:"close",value:function(){var t,e,n;0==this.extData.isDownloadBlockReport&&(1==this.extData.isAnswerAccepted?null===(e=this.p2pContext.PeerSched)||void 0===e||e.reportDownloadBlockAwaysFail(this):null===(n=this.p2pContext.PeerSched)||void 0===n||n.reportConnectionAbort(this)),null===(t=this.dc)||void 0===t||t.dataChannel().close(),"closed"!=this.pc.signalingState&&this.pc.close()}},{key:"isIncoming",value:function(){return this.incoming}},{key:"setCandidateCallback",value:function(t){var e=this;new P.a(function(t){return t(e.candidates)}).then(function(e){v()(e).call(e,function(e){return t(e)})}),this.onCandidate=t,this.candidates=new Array}},{key:"createNyaOffer",value:(l=p()(h.a.mark(function t(e){var n,r=this;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.dc=new pt(this.p2pContext,this.pc.createDataChannel("misaka-denpa",{ordered:!1,negotiated:!1,maxPacketLifeTime:this.p2pContext.Config.peerPacketLifeTime})),this.dc_future=P.a.resolve(),this.dc.dataChannel().onmessage=function(t){return r.onMessageReceived(t.data)},t.next=5,this.pc.createOffer({iceRestart:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1});case 5:return n=t.sent,this.pc.setLocalDescription(n),t.abrupt("return",this.waitForCandidate(e,n));case 8:case"end":return t.stop()}},t,this)})),function(t){return l.apply(this,arguments)})},{key:"answerNyaOffer",value:(c=p()(h.a.mark(function t(e,n){var r,o=this;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.dc_future=new P.a(function(t){return o.dc_resolver=t}),t.next=3,this.pc.setRemoteDescription(e);case 3:return t.next=5,this.pc.createAnswer({iceRestart:!0,offerToReceiveAudio:!1,offerToReceiveVideo:!1});case 5:return r=t.sent,this.pc.setLocalDescription(r),t.abrupt("return",this.waitForCandidate(n,r));case 8:case"end":return t.stop()}},t,this)})),function(t,e){return c.apply(this,arguments)})},{key:"waitForCandidate",value:(a=p()(h.a.mark(function t(e,n){var r,o,i,a,s=this;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new P.a(function(t){return s.extData.candidate_resolver=t}),t.next=3,P.a.race(new Array(new P.a(function(t){return o=m()(function(){return t(!0)},s.p2pContext.Config.candidateWaitMaxTimeMs)}),r));case 3:clearTimeout(o),i=void 0;try{i=this.pc.localDescription}catch(t){this.p2pContext.Config.allowPrintLog(3)&&console.log("localDescription get erreo: ",t)}return null==i?i=new RTCSessionDescription(n):u()(a=this.candidates).call(a,0,this.candidates.length),this.setCandidateCallback(e),t.abrupt("return",i);case 9:case"end":return t.stop()}},t,this)})),function(t,e){return a.apply(this,arguments)})},{key:"acceptNyaAnswer",value:(o=p()(h.a.mark(function t(e){var n=this;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.pc.setRemoteDescription(e).catch(function(t){n.p2pContext.printExtLog(2,"accept answer failed: "+t.message),n.p2pContext.Config.allowPrintLog(2)&&console.warn("accept answer failed: "+t.message),n.extData.isAnswerAccepted=!1}),this.extData.isAnswerAccepted=!0,t.next=4,this.waitForConnected();case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"addRemoteCandidate",value:(r=p()(h.a.mark(function t(e){return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.pc.addIceCandidate(e);case 3:return t.abrupt("return",t.sent);case 6:return t.prev=6,t.t0=t.catch(0),t.abrupt("return");case 9:case"end":return t.stop()}},t,this,[[0,6]])})),function(t){return r.apply(this,arguments)})},{key:"waitForConnected",value:(n=p()(h.a.mark(function t(){var e,n,r,o,i,a=this;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=new it.b,void 0===this.dc_future){t.next=6;break}return n=void 0,t.next=5,P.a.race([this.dc_future,new P.a(function(t){n=m()(t,a.p2pContext.Config.peerConnectionTimeoutMs)})]);case 5:void 0!==n&&clearTimeout(n);case 6:if(void 0!==this.dc){t.next=8;break}return t.abrupt("return",!1);case 8:if(r=void 0,"open"!==this.dc.dataChannel().readyState&&(r=new P.a(function(t){if(void 0!==a.dc){a.dc.dataChannel().onopen=function(e){return t(!0)},a.dc.dataChannel().onerror=function(e){return t(!1)};var n=function(e){"failed"===a.pc.iceConnectionState&&(a.p2pContext.printExtLog(2,"ice connection state failed when wait for connected."),a.p2pContext.Config.allowPrintLog(2)&&console.log("ice connection state failed when wait for connected."),t(!1))};a.pc.addEventListener("iceconnectionstatechange",n),e.onResolved(function(){return a.pc.removeEventListener("iceconnectionstatechange",n)})}})),o=!1,void 0===r){t.next=24;break}if(!(this.p2pContext.Config.peerConnectionTimeoutMs>0)){t.next=19;break}return t.next=15,P.a.race(new Array(r,new P.a(function(t){i=m()(function(){return t(!1)},a.p2pContext.Config.peerConnectionTimeoutMs)})));case 15:o=t.sent,clearTimeout(i),t.next=22;break;case 19:return t.next=21,r;case 21:o=t.sent;case 22:t.next=25;break;case 24:o=!0;case 25:return!0===o&&(this.dc.dataChannel().onclose=function(t){return a.peerSched.onPeerDisConnected(a)}),e.setResult(1),t.abrupt("return",o);case 28:case"end":return t.stop()}},t,this)})),function(){return n.apply(this,arguments)})},{key:"sendRequestMessage",value:function(t){return this.sendMessage(function(){var e=t();if(void 0!==e)return{type:"request",requestId:-1,action_type:"action",action:e.action,data:e.data}})}},{key:"sendResponseMessage",value:function(t){return this.sendMessage(function(){var e=t();if(void 0!==e)return{type:"response",requestId:e.requestId,action_type:"status",action:e.status,data:e.data}})}},{key:"sendMessage",value:(e=p()(h.a.mark(function t(e){var n,r,o,i,a,s,c,u=this;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if("open"!=(null===(n=this.dc)||void 0===n?void 0:n.dataChannel().readyState)){t.next=16;break}if(void 0!==(r=e())){t.next=4;break}return t.abrupt("return",void 0);case 4:return o=r.requestId<0,r.requestId<0&&(++this.requestId,r.requestId=this.requestId),(i={type:r.type,requestId:r.requestId,data:r.data})[r.action_type]=r.action,a=this.pendingRequests,s=this.dc,t.next=12,new P.a(function(t){if(o){a.has(i.requestId)&&console.log("duplicated request id!");var e=void 0;u.p2pContext.Config.peerTimeoutMs>0&&(e=m()(function(){a.delete(i.requestId),t(!1)},u.p2pContext.Config.peerTimeoutMs)),void 0!==e?a.set(i.requestId,function(n){clearTimeout(e),t(n)}):a.set(i.requestId,t)}else t(!0);null==s||s.send(i)});case 12:return c=t.sent,t.abrupt("return",c);case 16:return t.abrupt("return",void 0);case 17:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"terminateAllPendingRequests",value:function(){var t;v()(t=this.pendingRequests).call(t,function(t,e){t(void 0)}),this.pendingRequests.clear()}},{key:"onMessageReceived",value:function(t){try{var e=(n=t,void 0===r&&(r=ot),new rt(r.extensionCodec,r.context,r.maxStrLength,r.maxBinLength,r.maxArrayLength,r.maxMapLength,r.maxExtLength).decode(n));null!==e.data&&void 0!==e.data&&void 0!==e.data.length&&e.data.length>1024||(this.p2pContext.printExtLog(6,this.extData.peerId+" recv: "+e),this.p2pContext.Config.allowPrintLog(6)&&console.log(this.extData.peerId+" recv: ",e)),"response"==e.type&&s()(e.requestId)&&e.requestId>0?this.dispatchResponse(e):"request"==e.type&&s()(e.requestId)&&this.peerSched.onPeerRequestMessage(this,e)}catch(t){void 0!==e&&this.p2pContext.P2PDataCollectionStatus.addWastedDataSize(e.byteLength,at.e.ERROR_DATA),this.p2pContext.GhostPeerIds.add(this.extData.peerId),this.close(),console.log(t)}var n,r}},{key:"dispatchResponse",value:function(t){var e,n=this.pendingRequests.get(t.requestId);void 0!==n?(this.pendingRequests.delete(t.requestId),n(t)):"ok"===t.status&&void 0!==(null===(e=t.data)||void 0===e?void 0:e.length)&&(this.p2pContext.printExtLog(4,"no request for received response "+t.data.byteLength),this.p2pContext.Config.allowPrintLog(4)&&console.log("no request for received response "+t.data.byteLength),this.peerSched.getP2PContext().P2PDataCollectionStatus.addWastedDataSize(t.data.byteLength,at.e.P2P_LATE))}},{key:"parsePeerRole",value:function(t){var e;null!=t&&("leech"!==t.type?"seed"===t.type&&t.sliceProvider instanceof Array&&i()(e=t.sliceProvider).call(e,function(t,e){return t&&"number"==typeof e},!0)&&(this.role_=Q.Seedbox,this.seedSliceIds_=new y.a(t.sliceProvider)):this.role_=Q.Leech)}},{key:"onDownloadBlockFailed",value:function(){this.peerRole==Q.Seedbox&&(this.seedScore-=this.p2pContext.Config.seedScoreDown,this.seedScore<=0&&this.close())}},{key:"onDownloadBlockSucceed",value:function(){this.peerRole==Q.Seedbox&&this.seedScore<this.p2pContext.Config.seedBoxScoreMax&&(this.seedScore+=this.p2pContext.Config.seedScoreUp)}},{key:"shouldUsedAsSeed",value:function(){return Object(st.b)(100)<this.seedScore}}]),t}()},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,n){t.exports=n(271)},function(t,e,n){var r=n(15);t.exports=function(t){return r[t+"Prototype"]}},function(t,e,n){t.exports=n(302)},function(t,e,n){var r=n(17);t.exports=!r(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})},function(t,e){var n={}.hasOwnProperty;t.exports=function(t,e){return n.call(t,e)}},function(t,e,n){var r=n(21);t.exports=function(t){if(!r(t))throw TypeError(String(t)+" is not an object");return t}},function(t,e,n){var r=n(80),o=Math.min;t.exports=function(t){return t>0?o(r(t),9007199254740991):0}},function(t,e,n){"use strict";n.r(e),n.d(e,"Configuration",function(){return u});var r=n(2),o=n.n(r),i=n(5),a=n.n(i),s=n(0),c=n.n(s),u=function(){function t(){o()(this,t),c()(this,"trackerServers",["wss://tracker.chat.bilibili.com/"]),c()(this,"stunServers",["stun:stun6.chat.bilibili.com:3478","stun:stun.chat.bilibili.com:3478"]),c()(this,"natCheckStunServers",["stun:stun-1.chat.bilibili.com:3478","stun:stun-2.chat.bilibili.com:3478"]),c()(this,"allowedChangeBooleanValues",["p2pTransferSecondhandDataEnable","multiTabsShareLimitEnable","useSeedBox","enableReverseOrder","enableHideOwner"]),c()(this,"nonP2PFragmentCountAllowedRange",[0,8]),c()(this,"nonP2PFragmentCount",4),c()(this,"p2pBufferLengthSecAllowedRange",[0,8]),c()(this,"p2pBufferLengthSec",2.5),c()(this,"iceCandidatePoolSizeAllowedRange",[0,10]),c()(this,"iceCandidatePoolSize",10),c()(this,"serverTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"serverTimeoutMs",3e3),c()(this,"peerConnectionTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"peerConnectionTimeoutMs",5e3),c()(this,"peerTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"peerTimeoutMs",3e3),c()(this,"uploadMaxWaitTimeoutMsAllowedRange",[1e3,1e4]),c()(this,"uploadMaxWaitTimeoutMs",2700),c()(this,"peerPacketLifetimeAllowedRange",[1e3,1e4]),c()(this,"peerPacketLifeTime",2500),c()(this,"refreshPeerProgressIntervalMsAllowedRange",[100,1e3]),c()(this,"refreshPeerProgressIntervalMs",200),c()(this,"sliceCount",4),c()(this,"blockSize",61440),c()(this,"inConnectingLimitAllowedRange",[1,64]),c()(this,"inConnectingLimit",8),c()(this,"outConnectingLimitAllowedRange",[1,64]),c()(this,"outConnectingLimit",8),c()(this,"connectedLimitAllowedRange",[0,64]),c()(this,"connectedLimit",12),c()(this,"leechConnectNumAllowedRange",[0,64]),c()(this,"leechConnectNum",4),c()(this,"seedboxConnectNumBySliceIdAllowedRange",[0,64]),c()(this,"seedboxConnectNumBySliceId",1),c()(this,"revisibleMarkAllowedRange",[1,64]),c()(this,"revisibleMark",8),c()(this,"reconnectWaitTimeSecAllowedRange",[1,120]),c()(this,"reconnectWaitTimeSec",10),c()(this,"fragmentCountOutdatedAllowedRange",[2,120]),c()(this,"fragmentCountOutdated",8),c()(this,"fragmentShareOverrideAllowedRange",[0,100]),c()(this,"fragmentShareOverride",1),c()(this,"fragmentShareOverrideMaxBytesAllowedRange",[0,1e7]),c()(this,"fragmentShareOverrideMaxBytes",125e4),c()(this,"fragmentExtraShareRatioAllowedRange",[0,50]),c()(this,"fragmentExtraShareRatio",this.fragmentShareOverride/2),c()(this,"totalDownloadInstancesAllowedRange",[2,48]),c()(this,"totalDownloadInstances",1.5*this.connectedLimit),c()(this,"minDownloadInstancesPerPeer",1),c()(this,"maxDownloadInstancesPerPeerAllowedRange",[1,32]),c()(this,"maxDownloadInstancesPerPeer",4),c()(this,"cdnFetchInstancesAllowedRange",[1,32]),c()(this,"cdnFetchInstances",2),c()(this,"fallbackCDNFetchInstancesAllowedRange",[1,64]),c()(this,"fallbackCDNFetchInstances",4),c()(this,"fetchCDNTimeoutMsAllowedRange",[500,6e4]),c()(this,"fetchCDNTimeoutMs",7e3),c()(this,"crcVerifyEnable",!0),c()(this,"crc32Interval",1),c()(this,"developmentLogLevel",2),c()(this,"productionLogLevel",0),c()(this,"developmentExtLogLevel",2),c()(this,"productionExtLogLevel",1),c()(this,"p2pSafeBufferDurationForDelayStopMsAllowedRange",[0,15e3]),c()(this,"p2pSafeBufferDurationForDelayStopMs",2e3),c()(this,"p2pDelayStopMaxMsAllowedRange",[0,15e3]),c()(this,"p2pDelayStopMaxMs",1e3),c()(this,"p2pFetchDataObCycleCountAllowedRange",[1,32]),c()(this,"p2pFetchDataObCycleCount",4),c()(this,"p2pShareDataObCycleCountAllowedRange",[1,32]),c()(this,"p2pShareDataObCycleCount",3),c()(this,"p2pSliceIdControlFetchCheckIntervalMsAllowedRange",[2e3,3e4]),c()(this,"p2pSliceIdControlFetchCheckIntervalMs",4e3),c()(this,"p2pSliceIdControlShareCheckIntervalMsAllowedRange",[2e3,3e4]),c()(this,"p2pSliceIdControlShareCheckIntervalMs",3e3),c()(this,"p2pFetchLowestRatioAllowedRange",[.2,1]),c()(this,"p2pFetchLowestRatio",.6),c()(this,"p2pShareLargestAllowedFetchRatioAllowedRange",[.2,1]),c()(this,"p2pShareLargestAllowedFetchRatio",.8),c()(this,"p2pShareLowestRatioAllowedRange",[.2,1]),c()(this,"p2pShareLowestRatio",.6),c()(this,"p2pAddSliceProbabilityAllowedRange",[0,1]),c()(this,"p2pAddSliceProbability",.25),c()(this,"p2pDeleteSliceProbabilityAllowedRange",[0,1]),c()(this,"p2pDeleteSliceProbability",.33),c()(this,"reportPeerSuccessProbabilityAllowedRange",[0,1]),c()(this,"reportPeerSuccessProbability",1),c()(this,"reportPeerFailedProbabilityAllowedRange",[0,1]),c()(this,"reportPeerFailedProbability",.05),c()(this,"trackerClosedReportProbabilityAllowedRange",[0,1]),c()(this,"trackerClosedReportProbability",.01),c()(this,"badCRCReportProbabilityAllowedRange",[0,1]),c()(this,"badCRCReportProbability",1),c()(this,"p2pTransferSecondhandDataEnable",!0),c()(this,"multiTabsShareLimitEnable",!0),c()(this,"useSeedBox",!0),c()(this,"seedScoreUpAllowedRange",[1,20]),c()(this,"seedScoreUp",1),c()(this,"seedScoreDownAllowedRange",[1,50]),c()(this,"seedScoreDown",12),c()(this,"seedBoxScoreMaxAllowedRange",[100,1e3]),c()(this,"seedBoxScoreMax",200),c()(this,"coneVisibleMaxTimeMsAllowedRange",[0,864e5]),c()(this,"coneVisibleMaxTimeMs",36e5),c()(this,"symmetricVisibleMaxTimeMsAllowedRange",[0,864e5]),c()(this,"symmetricVisibleMaxTimeMs",48e4),c()(this,"nonnatVisibleMaxTimeMsAllowedRange",[0,864e5]),c()(this,"nonnatVisibleMaxTimeMs",36e5),c()(this,"multiCheckBasicNatMinCountAllowedRange",[1,16]),c()(this,"multiCheckBasicNatMinCount",3),c()(this,"getPeersIntervalMsAllowedRange",[0,36e5]),c()(this,"getPeersIntervalMs",1e4),c()(this,"candidateWaitMaxTimeMsAllowedRange",[0,3e4]),c()(this,"candidateWaitMaxTimeMs",150),c()(this,"maxDistanceAllowedRange",[0,16]),c()(this,"maxDistance",1),c()(this,"enableReverseOrder",!1),c()(this,"enableHideOwner",!0)}return a()(t,[{key:"allowPrintLog",value:function(e){return"development"===t.curNodeEnv?e<=this.developmentLogLevel:e<=this.productionLogLevel}},{key:"allowPrintExtLog",value:function(e){return"development"===t.curNodeEnv?e<=this.developmentExtLogLevel:e<=this.productionExtLogLevel}}]),t}();c()(u,"curNodeEnv","production"),c()(u,"ProtocolVersion",10),c()(u,"failbackFetchCDNTimeoutMs",7e3)},function(t,e,n){var r=n(25),o=n(31),i=n(50);t.exports=r?function(t,e,n){return o.f(t,e,i(1,n))}:function(t,e,n){return t[e]=n,t}},function(t,e,n){var r=n(25),o=n(124),i=n(27),a=n(87),s=Object.defineProperty;e.f=r?s:function(t,e,n){if(i(t),e=a(e,!0),i(n),o)try{return s(t,e,n)}catch(t){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},function(t,e,n){var r=n(60);t.exports=function(t){return Object(r(t))}},function(t,e,n){"use strict";n.d(e,"a",function(){return gt}),n.d(e,"c",function(){return Ut}),n.d(e,"b",function(){return Mt});var r=n(1),o=n.n(r),i=n(64),a=n.n(i),s=n(3),c=n.n(s),u=n(6),l=n.n(u),h=n(96),f=n.n(h),p=n(22),d=n.n(p),v=n(63),g=n.n(v),y=n(102),C=n.n(y),x=n(35),w=n.n(x),m=n(79),k=n.n(m),S=n(4),b=n.n(S),P=n(34),E=n.n(P),A=n(55),R=n.n(A),I=n(56),D=n.n(I),T=n(16),L=n.n(T),F=n(120),O=n.n(F),M=n(2),U=n.n(M),N=n(5),B=n.n(N),_=n(0),z=n.n(_),j=n(7),q=n(43),W=n(11),V=n.n(W),Y=n(100),G=n.n(Y),Q=n(12),H=n.n(Q),X=n(78),K=n.n(X),J=n(62),$=n.n(J),Z=n(97),tt=n.n(Z),et=n(98),nt=n.n(et),rt=n(99),ot=n.n(rt),it=n(42),at=n.n(it),st=n(58),ct=n.n(st),ut=n(37),lt=n.n(ut),ht=n(19),ft=n(20),pt=n(10);function dt(t,e){var n;if(void 0===nt.a||null==tt()(t)){if($()(t)||(n=function(t,e){var n;if(t){if("string"==typeof t)return vt(t,e);var r=at()(n=Object.prototype.toString.call(t)).call(n,8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?ot()(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){n=K()(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw i}}}}function vt(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var gt,yt=function(){function t(e,n){U()(this,t),z()(this,"localDistanceChanged",Array()),z()(this,"p2pCtx",void 0),z()(this,"frag",void 0),z()(this,"blockMinDistances",void 0),this.frag=n,this.p2pCtx=e;var r=n.getBlockCount();this.blockMinDistances=new Uint8Array(r);for(var o=0;o<r;++o)this.blockMinDistances[o]=e.Config.maxDistance}return B()(t,[{key:"updateLocalDistances",value:function(t){t(this.frag.getDistances());var e,n=dt(this.localDistanceChanged);try{for(n.s();!(e=n.n()).done;)(0,e.value)()}catch(t){n.e(t)}finally{n.f()}}}]),t}(),Ct=function(){function t(e,n){var r=this;U()(this,t),z()(this,"ctx",void 0),z()(this,"peer",void 0),z()(this,"updateDistancesTS",null),z()(this,"distancesUpdateLock",new ht.c),z()(this,"distances",null),z()(this,"isDistanceFinal",!1),z()(this,"taskAvailableMutex",new ht.c),z()(this,"taskAvailableCV",new ht.a),z()(this,"blockIds",void 0),z()(this,"abandoned",!1),this.ctx=e,this.peer=n,e.frag.onFinished(function(){r.stopAllInstance()}),e.localDistanceChanged.push(function(){r.wakeUpWorkers()});var o=!1;if(e.p2pCtx.Config.enableReverseOrder){var i=this.peer.extData.peerId;i.length>0&&i.charCodeAt(i.length-1)%2==0&&(o=!0)}var a=e.frag.getBlockCount();if(this.blockIds=new Uint8Array(a),o)for(var s=0;s<a;++s)this.blockIds[s]=a-1-s;else for(var c=0;c<a;++c)this.blockIds[c]=c}var e,n,r,i,a,s,u,h,f;return B()(t,[{key:"wakeUpWorkers",value:(f=l()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.taskAvailableMutex.lock();case 2:this.taskAvailableCV.notifyAll(),this.taskAvailableMutex.unlock();case 4:case"end":return t.stop()}},t,this)})),function(){return f.apply(this,arguments)})},{key:"suspendCurrentWorker",value:(h=l()(o.a.mark(function t(){var e;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=0,t.next=3,this.taskAvailableMutex.lock();case 3:return t.next=5,this.taskAvailableCV.waitUntil(this.taskAvailableMutex,function(){return e++>0});case 5:this.taskAvailableMutex.unlock();case 6:case"end":return t.stop()}},t,this)})),function(){return h.apply(this,arguments)})},{key:"launchInstance",value:(u=l()(o.a.mark(function t(){var e,n,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:this.ctx.p2pCtx.Config.allowPrintLog(5)&&console.log("start process peer "+this.peer.extData.peerId+" for "+this.ctx.frag.getFragmentName()),e=0;case 2:if(this.abandoned||this.ctx.frag.isFinished()){t.next=31;break}if(!(++e>100)){t.next=7;break}return console.warn("p2pdownloader instance: loop too many times"),t.abrupt("return");case 7:return t.next=9,this.updateDistance(!1);case 9:if(!((n=t.sent)<0)){t.next=12;break}return t.abrupt("return");case 12:return t.next=14,this.runDownloadLoop();case 14:if(!((r=t.sent)<0)){t.next=17;break}return t.abrupt("return");case 17:if(0!=n||0!=r){t.next=28;break}return t.next=20,this.updateDistance(!0);case 20:if(!((n=t.sent)<0)){t.next=25;break}return t.abrupt("return");case 25:if(0!=n){t.next=28;break}return t.next=28,this.suspendCurrentWorker();case 28:t.next=2;break;case 31:case"end":return t.stop()}},t,this)})),function(){return u.apply(this,arguments)})},{key:"stopAllInstance",value:function(){this.abandoned=!0,this.wakeUpWorkers()}},{key:"sendRequest",value:(s=l()(o.a.mark(function t(e){var n,r=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.peer.sendRequestMessage(function(){if(!r.abandoned)return e()});case 2:return n=t.sent,t.abrupt("return",n);case 4:case"end":return t.stop()}},t,this)})),function(t){return s.apply(this,arguments)})},{key:"ban",value:function(){var t;this.ctx.p2pCtx.Config.allowPrintLog(1)&&console.log("ban peer "+this.peer.extData.peerId),this.ctx.p2pCtx.GhostPeerIds.add(this.peer.extData.peerId),null===(t=this.ctx.p2pCtx.PeerSched)||void 0===t||t.closePeer(this.peer.extData.peerId),this.stopAllInstance()}},{key:"setRemoteDistance",value:function(t){var e=!1;if(null==this.distances)e=!0;else{var n=this.distances.length;if(t.length!=n)return!1;for(var r=0;r<n&&t[r]==this.distances[r];++r);r<n&&(e=!0)}return t.length==lt()(t).call(t,function(t){return 0==(127&t)}).length&&(this.isDistanceFinal=!0),this.distances=t,this.updateDistancesTS=performance.now(),e&&this.wakeUpWorkers(),!0}},{key:"sendGetProgress",value:(a=l()(o.a.mark(function t(){var e=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRequest(function(){return{action:"downloadAndStat",data:{frag:e.ctx.frag.getFragmentName(),blockId:-1,nonblocking:!0}}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})),function(){return a.apply(this,arguments)})},{key:"sendDownloadBlock",value:(i=l()(o.a.mark(function t(e){var n=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.sendRequest(function(){return{action:"downloadAndStat",data:{frag:n.ctx.frag.getFragmentName(),blockId:e,nonblocking:!1}}});case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})),function(t){return i.apply(this,arguments)})},{key:"updateDistance",value:(r=l()(o.a.mark(function t(e){var n,r,i,a;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.distancesUpdateLock.isLocked()){t.next=2;break}return t.abrupt("return",0);case 2:return t.next=4,this.distancesUpdateLock.lock();case 4:if(t.prev=4,!this.abandoned){t.next=7;break}return t.abrupt("return",-1);case 7:if(null==this.updateDistancesTS){t.next=16;break}if(n=this.updateDistancesTS+this.ctx.p2pCtx.Config.refreshPeerProgressIntervalMs-performance.now(),!((n=Math.min(n,this.ctx.p2pCtx.Config.refreshPeerProgressIntervalMs))>0)||e){t.next=14;break}return t.abrupt("return",0);case 14:return t.next=16,new c.a(function(t){return V()(t,n)});case 16:if(!this.abandoned){t.next=18;break}return t.abrupt("return",-1);case 18:if(!this.isDistanceFinal){t.next=20;break}return t.abrupt("return",0);case 20:return t.next=22,this.sendGetProgress();case 22:if(null!=(r=t.sent)&&"overload"!=r.status){t.next=27;break}return t.abrupt("return",-1);case 27:if("not_found"!=r.status){t.next=31;break}this.updateDistancesTS=performance.now(),t.next=36;break;case 31:if("ok"!=r.status){t.next=36;break}if(a=null===(i=r.data)||void 0===i?void 0:i.distances,this.setRemoteDistance(a)){t.next=36;break}return this.ban(),t.abrupt("return",-1);case 36:return t.abrupt("return",1);case 37:return t.prev=37,this.distancesUpdateLock.unlock(),t.finish(37);case 40:case"end":return t.stop()}},t,this,[[4,,37,40]])})),function(t){return r.apply(this,arguments)})},{key:"doDownload",value:(n=l()(o.a.mark(function t(e,n){var r,i,a,s,c,u,l,h,f,p,d,v,g,y,C,x,w,m;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=this.peer.peerRole==ft.PeerRole.Seedbox?pt.d.TX_SEEDBOX:pt.d.TX_PEER,i=this.peer.peerRole==ft.PeerRole.Seedbox?pt.d.RX_SEEDBOX:pt.d.RX_PEER,a=this.peer.peerRole==ft.PeerRole.Seedbox?pt.d.LAG_SEEDBOX:pt.d.LAG_PEER,s=this.peer.peerRole==ft.PeerRole.Seedbox?pt.a.SEED:pt.a.EXCHANGE,(c=this.ctx.frag.getDistances())[e]=128&c[e]|n,u=!1,t.prev=7,l=performance.now(),t.next=11,this.sendDownloadBlock(e);case 11:if(void 0===(h=t.sent)||(!1===h?this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(r,1):(this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(a,Math.round(performance.now()-l)),this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(r,1),this.ctx.p2pCtx.P2PDataCollectionStatus.addPeerMessageDataCollection(i,1))),null!=h&&"overload"!=h.status&&"not_found"!=h.status){t.next=17;break}return t.abrupt("return",!1);case 17:if("ok"!=h.status){t.next=38;break}if(y=null!==(f=null===(p=h.data)||void 0===p||null===(d=p.block)||void 0===d?void 0:d.byteLength)&&void 0!==f?f:0,null==(C=null===(v=h.data)||void 0===v?void 0:v.distances)||this.setRemoteDistance(C)){t.next=24;break}return this.ctx.p2pCtx.P2PDataCollectionStatus.addWastedDataSize(y,pt.e.ERROR_DATA),this.ban(),t.abrupt("return",!1);case 24:if(null!=(x=null===(g=h.data)||void 0===g?void 0:g.block)&&null!=x){t.next=27;break}return t.abrupt("return",!1);case 27:if((w=this.ctx.frag.getBlockByteRange(e))[1]-w[0]==x.length){t.next=32;break}return this.ctx.p2pCtx.P2PDataCollectionStatus.addWastedDataSize(y,pt.e.ERROR_DATA),this.ban(),t.abrupt("return",!1);case 32:return this.ctx.frag.setBlockData(e,x,j.b.P2P,s,this.peer.extData.peerId,void 0)||this.ctx.p2pCtx.P2PDataCollectionStatus.addWastedDataSize(y,pt.e.P2P_LATE),u=!0,t.abrupt("return",!0);case 38:return t.abrupt("return",!1);case 39:return t.prev=39,u?(null===(m=this.ctx.p2pCtx.PeerSched)||void 0===m||m.reportDownloadBlockSuccess(this.peer),this.peer.onDownloadBlockSucceed()):(this.ctx.updateLocalDistances(function(t){return t[e]|=127}),this.peer.onDownloadBlockFailed()),t.finish(39);case 42:case"end":return t.stop()}},t,this,[[7,,39,42]])})),function(t,e){return n.apply(this,arguments)})},{key:"runDownloadLoop",value:(e=l()(o.a.mark(function t(){var e,n,r,i,a,s,c,u,l,h;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=0,null!=this.distances){t.next=3;break}return t.abrupt("return",e);case 3:n=this.ctx.frag.getDistances(),r=this.distances;case 5:if(this.abandoned||this.ctx.frag.isFinished()){t.next=54;break}i=-1,a=127,s=0;case 9:if(!(s<2)){t.next=42;break}c=dt(this.blockIds),t.prev=11,c.s();case 13:if((u=c.n()).done){t.next=27;break}if(l=u.value,0!=s||128!=(128&r[l])){t.next=17;break}return t.abrupt("continue",25);case 17:if(127==(127&n[l])){t.next=19;break}return t.abrupt("continue",25);case 19:if(!((h=127&r[l])>this.ctx.blockMinDistances[l])){t.next=22;break}return t.abrupt("continue",25);case 22:if(h<a&&(i=l,a=h),0!=a){t.next=25;break}return t.abrupt("break",27);case 25:t.next=13;break;case 27:t.next=32;break;case 29:t.prev=29,t.t0=t.catch(11),c.e(t.t0);case 32:return t.prev=32,c.f(),t.finish(32);case 35:if(!(i>=0)){t.next=37;break}return t.abrupt("break",42);case 37:if(0!=a){t.next=39;break}return t.abrupt("break",42);case 39:++s,t.next=9;break;case 42:if(!(i<0)){t.next=44;break}return t.abrupt("break",54);case 44:return this.ctx.blockMinDistances[i]=Math.max(3,127&r[i]),t.next=47,this.doDownload(i,a+2);case 47:if(!t.sent){t.next=51;break}++e,t.next=52;break;case 51:return t.abrupt("return",-1);case 52:t.next=5;break;case 54:return t.abrupt("return",e);case 55:case"end":return t.stop()}},t,this,[[11,29,32,35]])})),function(){return e.apply(this,arguments)})}]),t}(),xt=function(){function t(e){U()(this,t),z()(this,"peerFragWorkers",new Array),z()(this,"frag",void 0),this.frag=e}var e;return B()(t,[{key:"startDownload",value:(e=l()(o.a.mark(function t(e,n){var r,i,a,s,u,l,h,f,p,d,v,g,y,C,x,w,m,k,S,b,P,E=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:l=this.frag.getDistances(),h=new Array,f=dt(this.frag.getSliceIds());try{for(f.s();!(p=f.n()).done;)for(d=p.value,h.push(d),v=this.frag.getSliceBlockRange(d),g=v[0];g<v[g];++g)l[g]=128&l[g]|1}catch(t){f.e(t)}finally{f.f()}for(y=new yt(e.getP2PContext(),this.frag),C=lt()(r=lt()(i=e.getConnectedPeers()).call(i,function(t){return t.peerRole==ft.PeerRole.Seedbox})).call(r,function(t){return t.shouldUsedAsSeed()}),h=ct()(a=lt()(s=ct()(h).call(h,function(t){return{sliceid:t,seedboxes:lt()(C).call(C,function(e){return e.seedSliceIds.has(t)})}})).call(s,function(t){if(t.seedboxes.length>0){var e=E.frag.getSliceBlockRange(t.sliceid);if(2==e.length&&e[1]-e[0]>0)for(var n=new Array(t.seedboxes.length),r=e[0];r<e[1];++r){var o,i=r%n.length;null==n[i]&&(n[i]=new Ct(y,t.seedboxes[i])),null===(o=n[i])||void 0===o||o.doDownload(r,1)}return!1}return!0})).call(a,function(t){return t.sliceid}),n(h),x=lt()(u=e.getConnectedPeers()).call(u,function(t){return t.peerRole==ft.PeerRole.Peer}),w=e.getP2PContext().Config,m=Math.min(w.totalDownloadInstances,x.length),k=Math.min(w.totalDownloadInstances,x.length*w.maxDownloadInstancesPerPeer),S=0;S<m;++S)this.peerFragWorkers.push(new Ct(y,x[S]));for(b=[],P=0;P<k;++P)b.push(this.peerFragWorkers[P%m].launchInstance());return t.next=17,c.a.all(b);case 17:return t.abrupt("return");case 18:case"end":return t.stop()}},t,this)})),function(t,n){return e.apply(this,arguments)})},{key:"stopDownload",value:function(){var t,e=dt(this.peerFragWorkers);try{for(e.s();!(t=e.n()).done;)t.value.stopAllInstance()}catch(t){e.e(t)}finally{e.f()}}}]),t}(),wt=function(){function t(e){U()(this,t),z()(this,"url",void 0),this.url=e}return B()(t,[{key:"GetUrl",value:function(){return this.url}},{key:"FetchSize",value:function(t){var e=this;return null==t&&(t=!1),new c.a(function(n){fetch(e.url,{method:"HEAD",cache:t?"default":"no-store"}).then(function(t){if(t.ok&&null!=t.headers.get("Content-Length")){var e=a()(t.headers.get("Content-Length"));n(null!=e?e:void 0)}else n(void 0)}).catch(function(t){n(void 0)})})}},{key:"FetchPart",value:function(t){var e,n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;null==i&&(i=!1);var a={};r>=0&&o>0&&(a.Range="bytes="+r+"-"+(o-1));var s,u={data:new Uint8Array,url:this.url,range:null!==(e=a.Range)&&void 0!==e?e:""},l=!!window.AbortController,h={mode:"cors",method:"GET",headers:a,cache:i?"default":"no-store"};return l&&(s=new AbortController,h.signal=s.signal),new c.a(function(e){var r=V()(function(){s&&s.abort(),e({state:{ok:!1,msg:"HTTP Part fetch response timeout "+t+" ms, aborted when CDN fetching"},data:void 0,sourceData:u})},t);fetch(n.url,h).then(function(t){if(t.ok){if(clearTimeout(r),null!=t.body)return t.arrayBuffer();e({state:{ok:!1,msg:"HTTP Part fetch empty body, status code: "+t.status.toString()+" ("+t.statusText+")"},data:void 0,sourceData:u})}else e({state:{ok:!1,msg:"HTTP Part fetch error, status code: "+t.status.toString()+" ("+t.statusText+")"},data:void 0,sourceData:u})}).then(function(t){var n=new Uint8Array(t);u.data=n,e({state:{ok:!0,msg:"ok"},data:n,sourceData:u})}).catch(function(t){e({state:{ok:!1,msg:"HTTP Part fetch error, message: "+t.toString()},data:void 0,sourceData:u})})})}},{key:"FetchPartByBlock",value:function(t,e,n,r,o,i){var a,s=this;if(r==o)return new c.a(function(t){t({ok:!0,msg:"ok"})});null==i&&(i=!1);var u={};r>=0&&o>0&&(u.Range="bytes="+r+"-"+(o-1));var l,h={data:new Uint8Array,url:this.url,range:null!==(a=u.Range)&&void 0!==a?a:""},f=!!window.AbortController,p={mode:"cors",method:"GET",headers:u,cache:i?"default":"no-store"},d=!1;return f&&(l=new AbortController,p.signal=l.signal),new c.a(function(r){var o=V()(function(){l&&l.abort(),d=!0,r({ok:!1,msg:"HTTP Stream fetch response timeout "+t+" ms, aborted when CDN fetching"})},t);fetch(s.url,p).then(function(t){if(t.ok){if(null!=t.body)return clearTimeout(o),t.body;r({ok:!1,msg:"HTTP Stream fetch empty body, status code: "+t.status.toString()+" ("+t.statusText+")"})}else r({ok:!1,msg:"HTTP Stream fetch error, status code: "+t.status.toString()+" ("+t.statusText+")"})}).then(function(t){var o=null==t?void 0:t.getReader(),i=new Uint8Array(0),a=0;null==o||o.read().then(function t(s){if(!1===d)if(void 0!==s.value){var c=s.value;if(p=c,(v=new Uint8Array(h.data.length+p.length)).set(h.data,0),v.set(p,h.data.length),h.data=v,i.length>0){var u=new Uint8Array(i.length+c.length);u.set(i,0),u.set(c,i.length),c=u}for(var l,f=0;;){if(!((l=c.subarray(f,f+n)).length>=n)){i=l;break}e(l,a++,!1,h),i=new Uint8Array(0),f+=n}s.done?(e(i,a++,!0,h),r({ok:!0,msg:"ok"})):null==o||o.read().then(t).catch(function(t){r({ok:!1,msg:"HTTP Stream fetch reader error, message: "+t.toString()})})}else s.done&&(e(i,a++,!0,h),r({ok:!0,msg:"ok"}));var p,v}).catch(function(t){r({ok:!1,msg:"HTTP Stream fetch reader error, message: "+t.toString()})})}).catch(function(t){r({ok:!1,msg:"HTTP Stream fetch error, message: "+t.toString()})})})}}]),t}(),mt=function(){function t(e){U()(this,t),z()(this,"p2pContext",void 0),z()(this,"fragMan",void 0),z()(this,"downloadForceStopArray",new H.a),this.p2pContext=e,this.fragMan=new j.d(this.p2pContext)}return B()(t,[{key:"addDownloadTask",value:function(t,e,n){return this.fragMan.addFragment(t,e,n),void 0!==this.fragMan.getFragment(t)}},{key:"startDownload",value:function(t,e,n,r){var i=this,a=this.fragMan.getFragment(n);if(null!=a){var s=a;void 0!==t&&s.setSliceIds(t.getSliceIds());var u=new wt(e);if(s.setCrcErrorCallback(function(){i.checkFragmentData(s,u)}),0!=s.getFragmentSize())if(null==t||void 0!==t&&0==t.getConnectedPeers().length)this.p2pContext.CDNFetchTaskWorker.post(function(){return s.doOnceQueryServer(),u.FetchPartByBlock(i.p2pContext.Config.fetchCDNTimeoutMs,function(t,e,n,r){e>=0&&e<s.getBlockCount()&&s.setBlockData(e,t,j.b.SERVER,j.a.SEED,void 0,r)||i.p2pContext.P2PDataCollectionStatus.addWastedDataSize(t.byteLength,pt.e.CDN_REPEAT,{fragname:s.getFragmentName(),sliceIds:s.getSliceIds()})},s.getBlockSize(),0,s.getFragmentSize())},!1).then(function(t){null!=t&&t.ok||s.setNonP2PFragmentData(void 0,j.a.SEED,null==t?void 0:t.msg,void 0)});else{var h=function(t){if(t.length>1){var e=G()(t).call(t),n=new Array;b()(e).call(e,function(t){var e=s.getSliceBlockRange(t);n.push(e[0]),n.push(e[1])});for(var r=-1,o=-1,a=0;a<n.length;a+=2)-1==r?(r=n[a],o=n[a+1]):(o==n[a]||(null!=o&&r!=o&&o-1>=0&&i.pullFragmentData(s,u,r,o-1,j.a.SEED),r=n[a]),o=n[a+1]);null!=r&&null!=o&&r!=o&&o-1>=0&&i.pullFragmentData(s,u,r,o-1,j.a.SEED)}else b()(t).call(t,function(t){var e=s.getSliceBlockRange(t);e[0]>=0&&e[1]>0&&e[0]!=e[1]&&e[1]-1>=0&&i.pullFragmentData(s,u,e[0],e[1]-1,j.a.SEED)})},f=new xt(s),p=Array();if(null!=r){var d=new c.a(function(t){V()(function(){t(!1)},r)});p.push(d)}var v=new c.a(function(t){i.downloadForceStopArray.set(n,t)});p.push(v);var g=new c.a(function(t){s.onFinished(function(e){t(!0)})});p.push(g);var y=new c.a(function(){var e=l()(o.a.mark(function e(n){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.startDownload(t,h);case 2:n(!1);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}());p.push(y),c.a.race(p).then(function(t){i.stopDownload(s.getFragmentName()),t||(f.stopDownload(),i.checkFragmentData(s,u))})}else this.p2pContext.FallbackFetchTaskWorker.post(function(){return s.doOnceQueryServer(),u.FetchPart(i.p2pContext.Config.fetchCDNTimeoutMs)},!1).then(function(t){null!=t&&t.state.ok?s.setNonP2PFragmentData(t.data,j.a.LACKED,void 0,t.sourceData):s.setNonP2PFragmentData(void 0,j.a.LACKED,null==t?void 0:t.state.msg,void 0)})}}},{key:"checkFragmentData",value:function(t,e){for(var n=void 0,r=0;r<t.getBlockCount();++r)t.isBlockFinished(r)&&null!=n?(this.pullFragmentData(t,e,n,r-1,j.a.LACKED),n=void 0):t.isBlockFinished(r)||null!=n||(n=r);null!=n&&this.pullFragmentData(t,e,n,t.getBlockCount()-1,j.a.LACKED)}},{key:"pullFragmentData",value:function(t,e,n,r,o){var i=this;this.p2pContext.FallbackFetchTaskWorker.post(function(){return t.getBlockByteRange(n)[0]==t.getBlockByteRange(r)[1]?new c.a(function(t){t({ok:!0,msg:"ok"})}):(t.doOnceQueryServer(),e.FetchPartByBlock(i.p2pContext.Config.fetchCDNTimeoutMs,function(e,a,s,c){(a+=n)>=n&&a<=r&&t.setBlockData(a,e,j.b.SERVER,o,void 0,c)||i.p2pContext.P2PDataCollectionStatus.addWastedDataSize(e.byteLength,pt.e.CDN_REPEAT,{fragname:t.getFragmentName(),sliceIds:t.getSliceIds()})},t.getBlockSize(),t.getBlockByteRange(n)[0],t.getBlockByteRange(r)[1]))},!1).then(function(e){null!=e&&e.ok||t.setNonP2PFragmentData(void 0,o,null==e?void 0:e.msg,void 0)})}},{key:"stopDownload",value:function(t){var e=this.downloadForceStopArray.get(t);null!=e&&(this.downloadForceStopArray.delete(t),e(!1))}},{key:"destroy",value:function(){var t;b()(t=this.downloadForceStopArray).call(t,function(t){t(!1)}),this.downloadForceStopArray.clear()}}]),t}(),kt=n(119),St=n.n(kt),bt=n(24),Pt=n.n(bt),Et=n(9),At=n.n(Et),Rt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:255,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];U()(this,t),z()(this,"maxLine",255),z()(this,"logBuffer",[]),z()(this,"isStart",!1),this.maxLine=e,this.isStart=n}return B()(t,[{key:"formatTime",value:function(t){var e,n,r,o,i,a=function(t,e){for(var n=t.toString();n.length<e;)n="0"+n;return n};return At()(e=At()(n=At()(r=At()(o=At()(i="".concat(a(t.getMonth()+1,2),"-")).call(i,a(t.getDate(),2)," ")).call(o,a(t.getHours(),2),":")).call(r,a(t.getMinutes(),2),":")).call(n,a(t.getSeconds(),2),".")).call(e,a(t.getMilliseconds(),3))}},{key:"log",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";if(this.isStart)for(this.logBuffer.push(this.formatTime(new Date)+" : "+t);this.logBuffer.length>this.maxLine;)this.logBuffer.shift()}},{key:"start",value:function(){this.isStart=!0}},{key:"stop",value:function(){this.isStart=!1}},{key:"clear",value:function(){var t;Pt()(t=this.logBuffer).call(t,0,this.logBuffer.length)}},{key:"get",value:function(){var t,e="";return b()(t=this.logBuffer).call(t,function(t){e+=t+"\n"}),e}},{key:"download",value:function(){var t=document.createElement("a");t.href=St.a.createObjectURL(new Blob([this.get()])),t.download="logfile.log",t.click(),window.URL.revokeObjectURL(t.href)}}]),t}(),It=n(176),Dt=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;U()(this,t),z()(this,"latestWorkerId",-1),z()(this,"minAllowRunningWorkerId",0),z()(this,"tasks",[]),z()(this,"mutex",new ht.c),z()(this,"cv",new ht.a),e<0&&(e=0),this.addWorker(e)}var e,n,r;return B()(t,[{key:"post",value:(r=l()(o.a.mark(function t(e){var n,r=this,i=arguments;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],t.next=3,this.mutex.lock();case 3:return t.abrupt("return",new c.a(function(t){var i,a={task:(i=l()(o.a.mark(function t(){return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e();case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t)})),function(){return i.apply(this,arguments)}),r:function(e){return t(e)}};n?r.tasks.unshift(a):r.tasks.push(a),r.cv.notifyOne(),r.mutex.unlock()}));case 4:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"getTask",value:(n=l()(o.a.mark(function t(e){var n,r,i=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=!1,t.next=3,this.mutex.lock();case 3:return t.next=5,this.cv.waitUntil(this.mutex,function(){return e<i.minAllowRunningWorkerId?(n=!0,!0):i.tasks.length>0});case 5:return!1===n&&(r=this.tasks.shift()),this.mutex.unlock(),t.abrupt("return",r);case 8:case"end":return t.stop()}},t,this)})),function(t){return n.apply(this,arguments)})},{key:"workerCoroutine",value:(e=l()(o.a.mark(function t(e){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getTask(e);case 2:if(null==(n=t.sent)){t.next=11;break}return t.t0=n,t.next=7,n.task();case 7:t.t1=t.sent,t.t0.r.call(t.t0,t.t1),t.next=12;break;case 11:return t.abrupt("break",14);case 12:t.next=0;break;case 14:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"getWorkerNum",value:function(){return this.latestWorkerId-this.minAllowRunningWorkerId+1}},{key:"addWorker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t<0&&(t=0);for(var e=0;e<t;e++)this.latestWorkerId++,this.workerCoroutine(this.latestWorkerId);return this.getWorkerNum()}},{key:"removeWorker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;t<0&&(t=0);for(var e=this.getWorkerNum(),n=0;n<t&&e>0;n++)this.minAllowRunningWorkerId++,this.cv.notifyAll(),e=this.getWorkerNum();return e}},{key:"removeAllTask",value:function(){for(;this.tasks.length>0;){var t=this.tasks.pop();null!=t&&t.r(void 0)}}},{key:"removeAllWorker",value:function(){this.minAllowRunningWorkerId=this.latestWorkerId+1,this.cv.notifyAll()}},{key:"setWorkerNum",value:function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)-this.getWorkerNum();t>0&&this.addWorker(t),t<0&&this.removeWorker(0-t)}}]),t}(),Tt=n(66),Lt=n(101),Ft=function(){function t(){U()(this,t),z()(this,"remainingShareQuotaQueue",new Tt.a(10))}return B()(t,[{key:"addFragmentDataCollection",value:function(t){this.remainingShareQuotaQueue.push(new Lt.a(t.getRemainingShareQuotaBytes()))}},{key:"takeShareQuota",value:function(t){for(var e=0;!(this.remainingShareQuotaQueue.empty()||e>=t);){var n=t-e;if(n>0){var r=n,o=this.remainingShareQuotaQueue.front();r>o.data&&(r=o.data),e+=r,o.data-=r,o.data<=0&&this.remainingShareQuotaQueue.pop()}}return e}}]),t}(),Ot=n(36);!function(t){t[t.DONE=0]="DONE",t[t.ERROR=1]="ERROR",t[t.NOTFOUND=2]="NOTFOUND"}(gt||(gt={}));var Mt,Ut=function(){function t(e,n,r){var o=this;U()(this,t),z()(this,"Config",void 0),z()(this,"CDNFetchTaskWorker",new Dt),z()(this,"FallbackFetchTaskWorker",new Dt),z()(this,"P2PDataCollectionStatus",new pt.c),z()(this,"LogFile",new Rt(Number.MAX_VALUE)),z()(this,"P2P",void 0),z()(this,"CurPeerId",""),z()(this,"DataFetch",void 0),z()(this,"FragMan",void 0),z()(this,"PeerSched",void 0),z()(this,"GhostPeerIds",new d.a),z()(this,"printExtLog",void 0),z()(this,"eventReportCallback",void 0),z()(this,"sliceIdAutoChangeIntervalSignal",new ht.d),z()(this,"totalSistersCount",1),z()(this,"trackerPositionInServers",0),z()(this,"tabsCheckInterval",3e3),z()(this,"tabsCheckTimer",null),this.Config=e,this.printExtLog=n,this.eventReportCallback=r,this.compatibleRTC(),this.P2P=new Nt(this),this.DataFetch=new mt(this),this.FragMan=this.DataFetch.fragMan,this.tabsCheckTimer=f()(function(){return o.checkMultipleTabs()},this.tabsCheckInterval+100*Math.random())}return B()(t,[{key:"onConfigurationUpdate",value:function(t){O()(t).call(t,"cdnFetchInstances")&&this.CDNFetchTaskWorker.getWorkerNum()>0&&(this.printExtLog(1,"[Notify] cdnFetchInstances: "+this.CDNFetchTaskWorker.getWorkerNum()+" -> "+this.Config.cdnFetchInstances),this.Config.allowPrintLog(1)&&console.log("[Notify] cdnFetchInstances: "+this.CDNFetchTaskWorker.getWorkerNum()+" -> "+this.Config.cdnFetchInstances),this.CDNFetchTaskWorker.setWorkerNum(this.Config.cdnFetchInstances)),O()(t).call(t,"fallbackCDNFetchInstances")&&this.FallbackFetchTaskWorker.getWorkerNum()>0&&(this.printExtLog(1,"[Notify] fallbackCDNFetchInstances: "+this.FallbackFetchTaskWorker.getWorkerNum()+" -> "+this.Config.fallbackCDNFetchInstances),this.Config.allowPrintLog(1)&&console.log("[Notify] fallbackCDNFetchInstances: "+this.FallbackFetchTaskWorker.getWorkerNum()+" -> "+this.Config.fallbackCDNFetchInstances),this.FallbackFetchTaskWorker.setWorkerNum(this.Config.fallbackCDNFetchInstances)),null!=this.PeerSched&&this.PeerSched.onConnectionStatusChanged()}},{key:"setConfiguration",value:function(t){var e=this,n=function(t,n,r){if(1==r){var o="Config: "+t+" = "+L()(n);e.printExtLog(1,o),e.Config.allowPrintLog(2)&&console.log(o),e.sliceIdAutoChangeIntervalSignal.call()}else{var i="[Warning] Config: "+t+" = "+L()(n)+" not allowed.";e.printExtLog(1,i),e.Config.allowPrintLog(2)&&console.log(i)}};try{for(var r=JSON.parse(t),o=function(){var t,r=R()(a[i],2),o=r[0],s=r[1];if(E()(o)==E()(""))switch(o){case"trackerServers":var c=[];s instanceof Array?(b()(s).call(s,function(t){E()(t)==E()("")&&(k()(t).call(t,"wss://")||k()(t).call(t,"ws://"))&&0==(k()(t).call(t,"wss:///")||k()(t).call(t,"ws:///"))?c.push(t):(e.printExtLog(1,"Value: "+s+" not tracker server address."),e.Config.allowPrintLog(1)&&console.log("Value: "+s+" not tracker server address."))}),c.length>0&&(e.Config[o]=c,e.trackerPositionInServers=0,n(o,s,!0))):n(o,s,!1);break;case"stunServers":case"natCheckStunServers":var u=[];s instanceof Array?(b()(s).call(s,function(t){E()(t)==E()("")&&new RegExp("^(stun|turn):.+?:[0-9]{1,5}$").exec(t)?u.push(t):(e.printExtLog(1,"Value: "+s+" not stun/turn server address."),e.Config.allowPrintLog(1)&&console.log("Value: "+s+" not stun/turn server address."))}),u.length>0&&(e.Config[o]=u,n(o,s,!0),"natCheckStunServers"==o&&e.P2P.tryToCheckNatType())):n(o,s,!1);break;default:if(e.Config.hasOwnProperty(o+"AllowedRange")&&e.Config.hasOwnProperty(o)){var l=e.Config[o+"AllowedRange"][0],h=e.Config[o+"AllowedRange"][1];e.printExtLog(2,"Key: "+o+" found range."),e.Config.allowPrintLog(2)&&console.log("Key: "+o+" found range."),E()(s)==E()(0)&&s>=l&&s<=h?(e.Config[o]=s,n(o,s,!0)):n(o,s,!1)}else e.Config.hasOwnProperty(o)&&E()(s)==E()(!0)&&w()(t=e.Config.allowedChangeBooleanValues).call(t,o)>-1?(e.Config[o]=s,n(o,s,!0)):n(o,s,!1)}},i=0,a=D()(r);i<a.length;i++)o();this.onConfigurationUpdate(C()(r)),this.eventReportCallback(new Ot.ConfigUpdateEvent(r))}catch(t){this.printExtLog(1,"Parse / Set Configuration Fail: "+t),this.Config.allowPrintLog(1)&&console.warn("Parse / Set Configuration Fail: "+t)}}},{key:"destroy",value:function(){this.GhostPeerIds.clear(),this.P2P.destroy(),this.DataFetch.destroy(),this.FragMan.destroy(),this.CDNFetchTaskWorker.removeAllWorker(),this.CDNFetchTaskWorker.removeAllTask(),this.FallbackFetchTaskWorker.removeAllWorker(),this.FallbackFetchTaskWorker.removeAllTask(),null!==this.tabsCheckTimer&&clearInterval(this.tabsCheckTimer)}},{key:"compatibleRTC",value:function(){var t=window.RTCDataChannel||window.DataChannel;t&&(window.RTCDataChannel||(window.RTCDataChannel=t),window.DataChannel||(window.DataChannel=t));var e=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;e&&(window.RTCPeerConnection||(window.RTCPeerConnection=e),window.mozRTCPeerConnection||(window.mozRTCPeerConnection=e),window.webkitRTCPeerConnection||(window.webkitRTCPeerConnection=e))}},{key:"checkMultipleTabs",value:function(){var t=window.localStorage;if(void 0!==t){var e=void 0,n=t.getItem("sistersInstances");if(null!==n)try{e=JSON.parse(n)}catch(t){}void 0===e&&(e=new Object);var r=g()();e[this.CurPeerId]=r;var o=[],i=0;for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var s=e[a];Math.abs(s-r)>2.5*this.tabsCheckInterval?o.push(a):++i}for(var c=0;c<o.length;++c)delete e[o[c]];t.setItem("sistersInstances",L()(e)),this.totalSistersCount=i}}}]),t}();!function(t){t[t.NON_NAT=-1]="NON_NAT",t[t.CONE=0]="CONE",t[t.SYMMETRIC=1]="SYMMETRIC"}(Mt||(Mt={}));var Nt=function(){function t(e){U()(this,t),z()(this,"p2pContext",void 0),z()(this,"cancelToken",{hasCancel:!1}),z()(this,"sliceIdController",void 0),z()(this,"P2PDataShareQuotaController",new Ft),this.p2pContext=e,this.tryToCheckNatType()}var e,n;return B()(t,[{key:"tryToCheckNatType",value:function(){var t,e,n=this;this.p2pContext.Config.natCheckStunServers.length<=1&&(null===(t=this.p2pContext.PeerSched)||void 0===t||null===(e=t.getTracker())||void 0===e||e.onNatTypeUpdated(Mt.CONE)),this.checkNatType(this.p2pContext.Config.natCheckStunServers[0],this.p2pContext.Config.natCheckStunServers[1]).then(function(t){var e,r;null===(e=n.p2pContext.PeerSched)||void 0===e||null===(r=e.getTracker())||void 0===r||r.onNatTypeUpdated(t)})}},{key:"checkNatType",value:(n=l()(o.a.mark(function t(e,n){var r=this;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new c.a(function(t){try{var o={},i=new RTCPeerConnection({iceServers:[{urls:e},{urls:n}]});i.createDataChannel("MisakaNetwork-NAT-Check"),i.onicecandidate=function(e){var n;if(e.candidate&&-1!==w()(n=e.candidate.candidate).call(n,"srflx")){var r=function(t){for(var e,n={foundation:(e=0===w()(t).call(t,"a=candidate:")?t.substring(12).split(" "):t.substring(10).split(" "))[0],component:e[1],protocol:e[2].toLowerCase(),priority:a()(e[3],10),ip:e[4],port:a()(e[5],10),type:e[7],relatedAddress:"",relatedPort:NaN,tcpType:"unknown"},r=8;r<e.length;r+=2)switch(e[r]){case"raddr":n.relatedAddress=e[r+1];break;case"rport":n.relatedPort=a()(e[r+1],10);break;case"tcptype":n.tcpType=e[r+1]}return n}(e.candidate.candidate);o[r.relatedPort]||(o[r.relatedPort]=[]),o[r.relatedPort].push(r.port)}else if(!e.candidate)if(i.close(),1===C()(o).length){var s=o[C()(o)[0]];t(1===s.length?Mt.CONE:Mt.SYMMETRIC)}else t(Mt.NON_NAT)},i.createOffer().then(function(t){return i.setLocalDescription(t)})}catch(e){r.p2pContext.printExtLog(0,"Failed to check NAT type."),r.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Failed to check NAT type."),t(Mt.SYMMETRIC)}}));case 1:case"end":return t.stop()}},t)})),function(t,e){return n.apply(this,arguments)})},{key:"initPeers",value:(e=l()(o.a.mark(function t(e){var n;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,q.a.create(this.p2pContext,this.cancelToken,e);case 2:n=t.sent,this.p2pContext.printExtLog(0,"Last Order is Connected."),this.p2pContext.Config.allowPrintLog(0)&&console.info("[SistersPlayer] Last Order is Connected."),1==this.cancelToken.hasCancel?n.destroy():(this.p2pContext.PeerSched=n,this.sliceIdController=new It.a(this.p2pContext,this.p2pContext.PeerSched),this.p2pContext.FragMan.setSliceIdController(this.sliceIdController),this.p2pContext.PeerSched.beginConnectPeers());case 6:case"end":return t.stop()}},t,this)})),function(t){return e.apply(this,arguments)})},{key:"createDownloadFragment",value:function(t,e,n){void 0!==this.p2pContext.FragMan.getFragment(t)&&this.p2pContext.FragMan.deleteFragment(t),this.p2pContext.DataFetch.addDownloadTask(t,null!=e&&e>=0?e:0,n)}},{key:"startDownloadFragment",value:function(t,e,n,r){this.createDownloadFragment(t,n,r),this.p2pContext.DataFetch.startDownload(this.p2pContext.PeerSched,e,t)}},{key:"stopDownloadFragment",value:function(t){this.p2pContext.DataFetch.stopDownload(t),this.p2pContext.FragMan.deleteFragmentUntil(t)}},{key:"onFragmentFinished",value:function(t,e){var n=this;c.a.resolve().then(function(){var r=n.p2pContext.FragMan.getFragment(t);null!=r?r.onFinished(function(t){var o;void 0!==t&&t.getFragStat()==j.c.END_SUCCESS?(e(gt.DONE,t.getFragmentData()),null!=n.p2pContext.P2PDataCollectionStatus&&null!=r&&n.p2pContext.P2PDataCollectionStatus.addLastestFragmentDataCollection(r),null===(o=n.sliceIdController)||void 0===o||o.addFragmentFetchData(t)):(n.p2pContext.P2PDataCollectionStatus.addFetchError(pt.b.ERROR_TO_RELOAD),e(gt.ERROR,void 0,null==r?void 0:r.getFragEndErrorMsg()))}):e(gt.NOTFOUND)})}},{key:"destroy",value:function(){var t,e,n,r=this;null===(t=this.sliceIdController)||void 0===t||t.destroy(),null===(e=this.p2pContext.PeerSched)||void 0===e||e.destroy(),this.cancelToken.hasCancel=!0,null===(n=this.p2pContext.PeerSched)||void 0===n||n.getConnectMutex().lock().then(function(){var t,e;null===(t=r.p2pContext.PeerSched)||void 0===t||t.getConnectCV().notifyAll(),null===(e=r.p2pContext.PeerSched)||void 0===e||e.getConnectMutex().unlock()})}}]),t}()},function(t,e,n){var r=n(285),o=n(117);function i(e){return t.exports=i="function"==typeof o&&"symbol"==typeof r?function(t){return typeof t}:function(t){return t&&"function"==typeof o&&t.constructor===o&&t!==o.prototype?"symbol":typeof t},i(e)}t.exports=i},function(t,e,n){t.exports=n(182)},function(t,e,n){"use strict";n.r(e),n.d(e,"EventReportType",function(){return r}),n.d(e,"DataReportTypeCode",function(){return o}),n.d(e,"ConfigUpdateEvent",function(){return u}),n.d(e,"TrackerClosedDataReportEvent",function(){return l}),n.d(e,"BadCRCDataReportEvent",function(){return h});var r,o,i=n(2),a=n.n(i),s=n(0),c=n.n(s);!function(t){t[t.DataReport=0]="DataReport",t[t.ConfigUpdate=1]="ConfigUpdate"}(r||(r={})),function(t){t[t.TrackerClosedReport=0]="TrackerClosedReport",t[t.BadCRCReport=1]="BadCRCReport"}(o||(o={}));var u=function t(e){a()(this,t),c()(this,"type",r.ConfigUpdate),c()(this,"body",void 0),this.body=e},l=function t(e,n){a()(this,t),c()(this,"type",r.DataReport),c()(this,"body",void 0),this.body={code:o.TrackerClosedReport,data:{statusCode:e,hostname:n}}},h=function t(e){a()(this,t),c()(this,"type",r.DataReport),c()(this,"body",void 0),this.body={code:o.BadCRCReport,data:e}}},function(t,e,n){t.exports=n(329)},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},function(t,e,n){var r=n(15),o=n(14),i=function(t){return"function"==typeof t?t:void 0};t.exports=function(t,e){return arguments.length<2?i(r[t])||i(o[t]):r[t]&&r[t][e]||o[t]&&o[t][e]}},function(t,e,n){"use strict";var r=n(146).charAt,o=n(49),i=n(115),a=o.set,s=o.getterFor("String Iterator");i(String,"String",function(t){a(this,{type:"String Iterator",string:String(t),index:0})},function(){var t,e=s(this),n=e.string,o=e.index;return o>=n.length?{value:void 0,done:!0}:(t=r(n,o),e.index+=t.length,{value:t,done:!1})})},function(t,e,n){n(94);var r=n(198),o=n(14),i=n(53),a=n(30),s=n(52),c=n(13)("toStringTag");for(var u in r){var l=o[u],h=l&&l.prototype;h&&i(h)!==c&&a(h,c,u),s[u]=s.Array}},function(t,e,n){t.exports=n(204)},function(t,e,n){"use strict";n.d(e,"b",function(){return r}),n.d(e,"a",function(){return G});var r,o=n(103),i=n.n(o),a=n(173),s=n.n(a),c=n(11),u=n.n(c),l=n(9),h=n.n(l),f=n(42),p=n.n(f),d=n(100),v=n.n(d),g=n(58),y=n.n(g),C=n(174),x=n.n(C),w=n(16),m=n.n(w),k=n(4),S=n.n(k),b=n(1),P=n.n(b),E=n(3),A=n.n(E),R=n(6),I=n.n(R),D=n(37),T=n.n(D),L=n(22),F=n.n(L),O=n(12),M=n.n(O),U=n(2),N=n.n(U),B=n(5),_=n.n(B),z=n(0),j=n.n(z),q=n(20),W=n(122),V=n(19),Y=n(29);!function(t){t[t.GONE=0]="GONE",t[t.HIDDEN=1]="HIDDEN",t[t.BROADCAST=2]="BROADCAST"}(r||(r={}));var G=function(){function t(e,n,r,o){N()(this,t),j()(this,"p2pContext",void 0),j()(this,"pendingIncomingPeers",new M.a),j()(this,"pendingOutcomingPeers",new M.a),j()(this,"connectedPeers",new M.a),j()(this,"curSliceIds",void 0),j()(this,"cancelToken",void 0),j()(this,"trackerSourceParam",void 0),j()(this,"sliceId",void 0),j()(this,"allSeedboxConnectNumBySlice",new M.a),j()(this,"tracker",void 0),j()(this,"trackerConnecting",!1),j()(this,"connectMutex",new V.c),j()(this,"connectCV",new V.a),this.trackerSourceParam=r,this.sliceId=o,this.p2pContext=e,this.cancelToken=n,this.curSliceIds=new F.a,this.updateAllSeedboxConnectNumBySlice()}var e,n,o,a,c;return _()(t,[{key:"allowedInConnectNewPeer",value:function(){var t=this.pendingIncomingPeers.size<this.p2pContext.Config.inConnectingLimit,e=this.connectedPeers.size<this.p2pContext.Config.connectedLimit;return t&&e}},{key:"getConnectMutex",value:function(){return this.connectMutex}},{key:"getConnectCV",value:function(){return this.connectCV}},{key:"getLeechNeedConnectNum",value:function(){var t;return this.p2pContext.Config.leechConnectNum-T()(t=this.getConnectedPeers()).call(t,function(t){return t.peerRole==q.PeerRole.Leech}).length}},{key:"getSeedboxNeedConnectNum",value:function(t){var e=this.allSeedboxConnectNumBySlice.get(t);return e||(e=0),this.p2pContext.Config.seedboxConnectNumBySliceId-e}},{key:"recreateTracker",value:(c=I()(P.a.mark(function t(){var e=this;return P.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new A.a(function(t){null!=e.tracker?(e.p2pContext.printExtLog(2,"Misaka will reconnect to the Last Order. (Service Redirect)"),e.p2pContext.Config.allowPrintLog(2)&&console.warn("Misaka will reconnect to the Last Order. (Service Redirect)"),e.tracker.destroy(),e.tracker=void 0,e.trackerConnecting=!0,W.a.connect(e.p2pContext,e.trackerSourceParam,e,e.sliceId).then(function(n){e.tracker=n,e.trackerConnecting=!0,t(!0)}).catch(function(e){t(!1)})):t(!1)}));case 1:case"end":return t.stop()}},t)})),function(){return c.apply(this,arguments)})},{key:"getTracker",value:function(){return this.tracker}},{key:"getP2PContext",value:function(){return this.p2pContext}},{key:"updateAllSeedboxConnectNumBySlice",value:function(){for(var t,e=new M.a,n=0;n<this.p2pContext.Config.sliceCount;n++)e.set(n,0);S()(t=this.connectedPeers).call(t,function(t){S()(t).call(t,function(t){var n;t.peerRole==q.PeerRole.Seedbox&&S()(n=t.seedSliceIds).call(n,function(t){var n=e.get(t);e.set(t,(n||0)+1)})})}),this.allSeedboxConnectNumBySlice=e;var r="Update Seedbox Connect Number By Slice: \n"+m()(x()(e));this.p2pContext.printExtLog(3,r),this.p2pContext.Config.allowPrintLog(3)&&console.log(r)}},{key:"checkVisibilityStateNeedChange",value:(a=I()(P.a.mark(function t(){var e=this;return P.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new A.a(function(t){var n=e.connectedPeers.size<e.p2pContext.Config.connectedLimit,o=e.connectedPeers.size<=e.p2pContext.Config.revisibleMark;null!=e.tracker&&0==e.trackerConnecting?1==n&&1==o&&e.tracker.getVisibilityState()==r.GONE?(e.p2pContext.printExtLog(0,"Misaka will broadcast."),e.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka will broadcast."),e.tracker.setSelfVisible(r.BROADCAST),t()):(0!=n||0!=o||e.tracker.getVisibilityState()!=r.BROADCAST&&e.tracker.getVisibilityState()!=r.HIDDEN||(e.p2pContext.printExtLog(0,"Misaka will gone."),e.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka will gone."),e.tracker.setSelfVisible(r.GONE)),t()):t()}));case 1:case"end":return t.stop()}},t)})),function(){return a.apply(this,arguments)})},{key:"doConnect",value:function(t){var e=this;if(this.tracker){if(this.p2pContext.GhostPeerIds.has(t))return this.p2pContext.printExtLog(2,"has a ghost peerId: "+t),void(this.p2pContext.Config.allowPrintLog(2)&&console.warn("has a ghost peerId: "+t));if(this.pendingOutcomingPeers.has(t)||this.pendingIncomingPeers.has(t))return;if(this.connectedPeers.has(t)&&this.connectedPeers.get(t).length>0)return;if(this.p2pContext.CurPeerId===t)return;return new A.a(function(n){e.tracker?e.tracker.connectPeer(t,function(r){e.pendingOutcomingPeers.set(t,r),n()}):n()})}return A.a.resolve()}},{key:"createConnectPeerTask",value:function(t){var e=this;return I()(P.a.mark(function n(){return P.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,e.connectMutex.lock();case 2:return n.next=4,e.connectCV.waitUntil(e.connectMutex,function(){return!!e.cancelToken.hasCancel||!(e.p2pContext.Config.connectedLimit<e.connectedPeers.size)&&(e.p2pContext.Config.connectedLimit-e.connectedPeers.size-e.pendingIncomingPeers.size-e.pendingOutcomingPeers.size>0||e.pendingOutcomingPeers.size<e.p2pContext.Config.outConnectingLimit)});case 4:if(!1!==e.cancelToken.hasCancel){n.next=7;break}return n.next=7,e.doConnect(t);case 7:e.connectMutex.unlock();case 8:case"end":return n.stop()}},n)}))}},{key:"beginConnectPeers",value:(o=I()(P.a.mark(function t(){var e,n=this;return P.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=P.a.mark(function t(){var e,o,i,a,s,c,l,f,d,g,C,x,w,k,b,E,R,I,D;return P.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=performance.now(),t.next=3,n.connectMutex.lock();case 3:return t.next=5,n.connectCV.waitUntil(n.connectMutex,function(){return!(null!=n.tracker&&!n.cancelToken.hasCancel)||n.tracker.getVisibilityState()!=r.GONE});case 5:if(n.connectMutex.unlock(),null==n.tracker){t.next=32;break}return o=function(t){var e,n;return y()(e=v()(n=y()(t).call(t,function(t){return[Math.random(),t]})).call(n,function(t,e){return t[0]-e[0]})).call(e,function(t){return t[1]})},t.next=10,n.tracker.getPeers();case 10:if(i=t.sent,a=(a=i.peers)?o(a):new Array,s=i.leeches,c=n.getLeechNeedConnectNum(),s=s?p()(l=o(s)).call(l,0,c):new Array,n.p2pContext.printExtLog(2,"ready to connect leeches: "+m()(s)),n.p2pContext.Config.allowPrintLog(2)&&console.warn("ready to connect leeches: "+m()(s)),f=new Array,n.p2pContext.Config.useSeedBox){for(d=0;d<n.p2pContext.Config.sliceCount;d++)(g=i.seedboxes.get(d.toString()))&&(C=n.getSeedboxNeedConnectNum(d))>0&&(f=h()(f).call(f,p()(x=o(g)).call(x,0,C)));n.p2pContext.printExtLog(2,"ready to connect seedboxes: "+m()(f)),n.p2pContext.Config.allowPrintLog(2)&&console.warn("ready to connect seedboxes: "+m()(f))}w=new Array,S()(f).call(f,function(t){var e=n.createConnectPeerTask(t);null!=e&&w.push(e)}),S()(s).call(s,function(t){var e=n.createConnectPeerTask(t);null!=e&&w.push(e)}),S()(a).call(a,function(t){var e=n.createConnectPeerTask(t);null!=e&&w.push(e)}),k=0,b=w;case 25:if(!(k<b.length)){t.next=32;break}return E=b[k],t.next=29,E();case 29:k++,t.next=25;break;case 32:return R=performance.now(),I=R-e,(D=n.p2pContext.Config.getPeersIntervalMs-I)<0&&(D=0),t.next=38,new A.a(function(t){return u()(function(){return t()},D)});case 38:case"end":return t.stop()}},t)});case 1:if(this.cancelToken.hasCancel){t.next=5;break}return t.delegateYield(e(),"t0",3);case 3:t.next=1;break;case 5:case"end":return t.stop()}},t,this)})),function(){return o.apply(this,arguments)})},{key:"IteratorToArray",value:function(t){for(var e=new Array;;){var n=t.next();if(n.done)break;e.push(n.value)}return e}},{key:"getConnectedPeers",value:function(){var t,e;return s()(t=this.IteratorToArray(i()(e=this.connectedPeers).call(e))).call(t,function(t){return t})}},{key:"getConnectingPeers",value:function(){var t,e,n;return h()(t=this.IteratorToArray(i()(e=this.pendingIncomingPeers).call(e))).call(t,this.IteratorToArray(i()(n=this.pendingOutcomingPeers).call(n)))}},{key:"onConnectionStatusChanged",value:function(){this.updateAllSeedboxConnectNumBySlice(),this.checkVisibilityStateNeedChange(),this.connectCV.notifyAll()}},{key:"onPeerConnectComplete",value:function(t,e){try{if(!1===t.isIncoming()?this.pendingOutcomingPeers.delete(t.extData.peerId):this.pendingIncomingPeers.delete(t.extData.peerId),!1===e)return void t.close();if(this.cancelToken.hasCancel)return this.p2pContext.printExtLog(2,"Cancel connect. target peerId: "+t.extData.peerId+" when cur peerId: "+this.p2pContext.CurPeerId),this.p2pContext.Config.allowPrintLog(2)&&console.warn("Cancel connect. target peerId: "+t.extData.peerId+" when cur peerId: "+this.p2pContext.CurPeerId),void this.onPeerDisConnected(t);try{this.p2pContext.printExtLog(2,"peer connected: id:"+t.extData.peerId),this.p2pContext.Config.allowPrintLog(2)&&console.log("peer connected: id:"+t.extData.peerId),!1===this.connectedPeers.has(t.extData.peerId)&&this.connectedPeers.set(t.extData.peerId,new Array),this.connectedPeers.get(t.extData.peerId).push(t)}catch(t){console.log(t)}}finally{this.onConnectionStatusChanged()}}},{key:"onPeerDisConnected",value:function(t){try{t.close(),t.terminateAllPendingRequests();var e=this.connectedPeers.get(t.extData.peerId);if(void 0!==e){var n=T()(e).call(e,function(e){return e!=t});n.length>0?(this.p2pContext.printExtLog(2,"remove peerId ".concat(t.extData.peerId," connect.")),this.p2pContext.Config.allowPrintLog(2)&&console.log("remove peerId ".concat(t.extData.peerId," connect.")),this.connectedPeers.set(t.extData.peerId,n)):(this.p2pContext.printExtLog(2,"clear empty peerId ".concat(t.extData.peerId," connect from connectedPeers.")),this.p2pContext.Config.allowPrintLog(2)&&console.log("clear empty peerId ".concat(t.extData.peerId," connect from connectedPeers.")),this.connectedPeers.delete(t.extData.peerId))}}finally{this.onConnectionStatusChanged()}}},{key:"closePeer",value:function(t){var e=this,n=this.connectedPeers.get(t);void 0!==n&&S()(n).call(n,function(t){e.onPeerDisConnected(t)})}},{key:"initSliceId",value:function(t){void 0!==t&&this.curSliceIds.add(t)}},{key:"addSliceId",value:function(t){this.curSliceIds.add(t)}},{key:"deleteSliceId",value:function(t){this.curSliceIds.delete(t)}},{key:"getSliceIds",value:function(){return this.curSliceIds}},{key:"onPeerRelayMessage",value:(n=I()(P.a.mark(function t(e,n,r){var o,i,a,s,c,u,l,h,f,p=this;return P.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.tracker){t.next=29;break}if("connect"!=(null==n?void 0:n.action)){t.next=28;break}if(!(void 0!==this.connectedPeers.get(e)&&this.connectedPeers.get(e).length>0||1==this.cancelToken.hasCancel||0==this.allowedInConnectNewPeer()||this.p2pContext.GhostPeerIds.has(e))){t.next=7;break}1==this.cancelToken.hasCancel&&(this.p2pContext.printExtLog(2,"refused connection, because exiting from the Misaka Network."),this.p2pContext.Config.allowPrintLog(2)&&console.warn("refused connection, because exiting from the Misaka Network.")),this.tracker.sendPeerResponse(e,r,"refused"),t.next=26;break;case 7:if((null==n||null===(o=n.data)||void 0===o?void 0:o.protocol)===Y.Configuration.ProtocolVersion){t.next=11;break}this.tracker.sendPeerResponse(e,r,"protocol_incompatible"),t.next=26;break;case 11:try{i=new q.NyaPeer(this.p2pContext,this,!0)}catch(t){this.p2pContext.printExtLog(0,"create peer failed: "+t),this.p2pContext.Config.allowPrintLog(0)&&console.warn("create peer failed: "+t)}if(void 0===i){t.next=26;break}return i.extData.peerId=e,this.pendingIncomingPeers.set(e,i),s=null==n||null===(a=n.data)||void 0===a?void 0:a.offer,i.answerNyaOffer(s,function(t){null!=p.tracker&&p.tracker.sendPeerCandidate(e,"answer",t)}).then(function(t){if(void 0!==p.tracker&&void 0!==i){var o=function(){p.tracker&&p.tracker.sendPeerResponse(e,r,"ok",{answer:t,role:{type:"peer"}})};if(i.parsePeerRole(n.data.role),i.peerRole==q.PeerRole.Seedbox){var a,s=!1;S()(a=i.seedSliceIds).call(a,function(t){p.getSeedboxNeedConnectNum(t)>0&&(s=!0)}),1==s?o():(p.p2pContext.printExtLog(2,"not need this seedbox: "+e),p.p2pContext.Config.allowPrintLog(2)&&console.log("not need this seedbox: "+e))}else o()}}).catch(function(t){p.p2pContext.printExtLog(0,"answerNyaOffer failed: "+t),p.p2pContext.Config.allowPrintLog(0)&&console.warn("answerNyaOffer failed: "+t)}),t.next=19,i.waitForConnected();case 19:if(!t.sent){t.next=23;break}this.onPeerConnectComplete(i,!0),t.next=26;break;case 23:this.onPeerConnectComplete(i,!1),this.p2pContext.printExtLog(2,"peer connect timeout "+e),this.p2pContext.Config.allowPrintLog(2)&&console.log("peer connect timeout "+e);case 26:t.next=29;break;case 28:"candidate"==(null==n?void 0:n.action)?(l=null===(c=n.data)||void 0===c?void 0:c.cand,h=null===(u=n.data)||void 0===u?void 0:u.direction,f=void 0,"offer"==h?f=this.pendingIncomingPeers.get(e):"answer"==h&&(f=this.pendingOutcomingPeers.get(e)),void 0!==f&&f.addRemoteCandidate(l)):this.tracker.sendPeerResponse(e,r,"not_implemented");case 29:case"end":return t.stop()}},t,this)})),function(t,e,r){return n.apply(this,arguments)})},{key:"onPeerRequestMessage",value:function(t,e){var n=this,r=e.requestId;switch(e.action){case"downloadAndStat":var o=e.data.frag,i=this.p2pContext.FragMan.getFragment(o),a=e.data.blockId,s=null==i?void 0:i.getBlock(a);if(null==i)t.sendResponseMessage(function(){return{requestId:r,status:"not_found"}});else if(a>=0&&void 0===s)t.sendResponseMessage(function(){return{requestId:r,status:"not_found"}});else if(i.canShare()){var c=performance.now(),u=e.data.nonblocking,l=function(){if(null==i)return null;var t=i.getDistances();return n.p2pContext.Config.enableHideOwner&&(t=y()(t).call(t,function(t){return 127&t})),t};if(void 0===s||!s.isSucceed()&&u)t.sendResponseMessage(function(){return{requestId:r,status:"ok",data:{block:null,distances:l()}}});else{var h=i.getBlockByteRange(a);i.addShareData(a,h[1]-h[0]),s.onDataResolved(function(e){null!=i&&null!=e&&t.sendResponseMessage(function(){var t;if(null!=i)return performance.now()-c>n.p2pContext.Config.uploadMaxWaitTimeoutMs?(n.p2pContext.printExtLog(2,"drop datablock response due to timeout"),void(n.p2pContext.Config.allowPrintLog(2)&&console.log("drop datablock response due to timeout"))):(null===(t=n.p2pContext.P2PDataCollectionStatus)||void 0===t||t.addP2PSendSizeRealtime(e.byteLength),{requestId:r,status:"ok",data:{block:e,distances:l()}})})})}}else this.p2pContext.printExtLog(2,(null==i?void 0:i.getFragmentName())+" is overload"),this.p2pContext.Config.allowPrintLog(2)&&console.warn((null==i?void 0:i.getFragmentName())+" is overload"),t.sendResponseMessage(function(){return{requestId:r,status:"overload"}})}}},{key:"reportDownloadBlockSuccess",value:function(t){var e;t.extData.isDownloadBlockReport||(this.p2pContext.P2PDataCollectionStatus.addPeerConnectCount(!1,!0),Math.random()<this.p2pContext.Config.reportPeerSuccessProbability&&(null===(e=this.tracker)||void 0===e||e.reportDownloadBlockSuccessOrAwaysFail(t.extData.peerId,!0)),t.extData.isDownloadBlockReport=!0)}},{key:"reportDownloadBlockAwaysFail",value:function(t){var e;this.p2pContext.P2PDataCollectionStatus.addPeerConnectCount(!1,!1),Math.random()<this.p2pContext.Config.reportPeerFailedProbability&&(null===(e=this.tracker)||void 0===e||e.reportDownloadBlockSuccessOrAwaysFail(t.extData.peerId,!1))}},{key:"reportConnectionAbort",value:function(t){this.p2pContext.P2PDataCollectionStatus.addPeerConnectCount(!0,!1)}},{key:"destroy",value:function(){var t,e,n,r=this;null!=this.tracker&&(this.tracker.destroy(),this.tracker=void 0),S()(t=this.pendingIncomingPeers).call(t,function(t){t.close()}),S()(e=this.pendingOutcomingPeers).call(e,function(t){t.close()}),S()(n=this.getConnectedPeers()).call(n,function(t){r.onPeerDisConnected(t)})}}],[{key:"create",value:(e=I()(P.a.mark(function e(n,r,o,i){var a,s;return P.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new t(n,r,o,i)).trackerConnecting=!0,e.next=4,W.a.connect(n,o,a,i);case 4:return s=e.sent,a.tracker=s,a.trackerConnecting=!1,e.abrupt("return",a);case 8:case"end":return e.stop()}},e)})),function(t,n,r,o){return e.apply(this,arguments)})}]),t}()},function(t,e,n){var r=n(86),o=n(60);t.exports=function(t){return r(o(t))}},function(t,e,n){var r=n(25),o=n(17),i=n(26),a=Object.defineProperty,s={},c=function(t){throw t};t.exports=function(t,e){if(i(s,t))return s[t];e||(e={});var n=[][t],u=!!i(e,"ACCESSORS")&&e.ACCESSORS,l=i(e,0)?e[0]:c,h=i(e,1)?e[1]:void 0;return s[t]=!!n&&!o(function(){if(u&&!r)return!0;var t={length:-1};u?a(t,1,{enumerable:!0,get:c}):t[1]=1,n.call(t,l,h)})}},function(t,e,n){var r=n(38);t.exports=function(t,e,n){if(r(t),void 0===e)return t;switch(n){case 0:return function(){return t.call(e)};case 1:return function(n){return t.call(e,n)};case 2:return function(n,r){return t.call(e,n,r)};case 3:return function(n,r,o){return t.call(e,n,r,o)}}return function(){return t.apply(e,arguments)}}},function(t,e){t.exports=!0},function(t,e,n){var r=n(112),o=n(31).f,i=n(30),a=n(26),s=n(193),c=n(13)("toStringTag");t.exports=function(t,e,n,u){if(t){var l=n?t:t.prototype;a(l,c)||o(l,c,{configurable:!0,value:e}),u&&!r&&i(l,"toString",s)}}},function(t,e,n){var r,o,i,a=n(196),s=n(14),c=n(21),u=n(30),l=n(26),h=n(109),f=n(88),p=n(70),d=s.WeakMap;if(a){var v=h.state||(h.state=new d),g=v.get,y=v.has,C=v.set;r=function(t,e){return e.facade=t,C.call(v,t,e),e},o=function(t){return g.call(v,t)||{}},i=function(t){return y.call(v,t)}}else{var x=f("state");p[x]=!0,r=function(t,e){return e.facade=t,u(t,x,e),e},o=function(t){return l(t,x)?t[x]:{}},i=function(t){return l(t,x)}}t.exports={set:r,get:o,has:i,enforce:function(t){return i(t)?o(t):r(t,{})},getterFor:function(t){return function(e){var n;if(!c(e)||(n=o(e)).type!==t)throw TypeError("Incompatible receiver, "+t+" required");return n}}}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e,n){var r=n(27),o=n(133),i=n(28),a=n(46),s=n(71),c=n(135),u=function(t,e){this.stopped=t,this.result=e};t.exports=function(t,e,n){var l,h,f,p,d,v,g,y=n&&n.that,C=!(!n||!n.AS_ENTRIES),x=!(!n||!n.IS_ITERATOR),w=!(!n||!n.INTERRUPTED),m=a(e,y,1+C+w),k=function(t){return l&&c(l),new u(!0,t)},S=function(t){return C?(r(t),w?m(t[0],t[1],k):m(t[0],t[1])):w?m(t,k):m(t)};if(x)l=t;else{if("function"!=typeof(h=s(t)))throw TypeError("Target is not iterable");if(o(h)){for(f=0,p=i(t.length);p>f;f++)if((d=S(t[f]))&&d instanceof u)return d;return new u(!1)}l=h.call(t)}for(v=l.next;!(g=v.call(l)).done;){try{d=S(g.value)}catch(t){throw c(l),t}if("object"==typeof d&&d&&d instanceof u)return d}return new u(!1)}},function(t,e){t.exports={}},function(t,e,n){var r=n(112),o=n(67),i=n(13)("toStringTag"),a="Arguments"==o(function(){return arguments}());t.exports=r?o:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=Object(t),i))?n:a?o(e):"Object"==(r=o(e))&&"function"==typeof e.callee?"Arguments":r}},function(t,e,n){var r=n(30);t.exports=function(t,e,n,o){o&&o.enumerable?t[e]=n:r(t,e,n)}},function(t,e,n){var r=n(256),o=n(257),i=n(163),a=n(259);t.exports=function(t,e){return r(t)||o(t,e)||i(t,e)||a()}},function(t,e,n){t.exports=n(260)},function(t,e,n){var r=n(213),o=n(216),i=n(163),a=n(248);t.exports=function(t){return r(t)||o(t)||i(t)||a()}},function(t,e,n){t.exports=n(322)},function(t,e,n){t.exports=n(179)},function(t,e){t.exports=function(t){if(null==t)throw TypeError("Can't call method on "+t);return t}},function(t,e,n){var r=n(67);t.exports=Array.isArray||function(t){return"Array"==r(t)}},function(t,e,n){t.exports=n(298)},function(t,e,n){t.exports=n(274)},function(t,e,n){t.exports=n(267)},function(t,e,n){t.exports=n(338)},function(t,e,n){"use strict";n.d(e,"a",function(){return h});var r=n(4),o=n.n(r),i=n(2),a=n.n(i),s=n(5),c=n.n(s),u=n(0),l=n.n(u),h=function(){function t(e){a()(this,t),l()(this,"elements",void 0),l()(this,"_size",void 0),this.elements=new Array,this._size=e}return c()(t,[{key:"push",value:function(t){return this.elements.length==this._size&&this.pop(),this.elements.push(t),!0}},{key:"pop",value:function(){return this.elements.shift()}},{key:"front",value:function(){return this.elements.length>0?this.elements[0]:void 0}},{key:"forEach",value:function(t,e){var n;o()(n=this.elements).call(n,t)}},{key:"size",value:function(){return this.elements.length}},{key:"empty",value:function(){return 0==this.size()}},{key:"clear",value:function(){this.elements=new Array}}]),t}()},function(t,e){var n={}.toString;t.exports=function(t){return n.call(t).slice(8,-1)}},function(t,e,n){var r,o=n(27),i=n(130),a=n(110),s=n(70),c=n(132),u=n(104),l=n(88)("IE_PROTO"),h=function(){},f=function(t){return"<script>"+t+"<\/script>"},p=function(){try{r=document.domain&&new ActiveXObject("htmlfile")}catch(t){}var t,e;p=r?function(t){t.write(f("")),t.close();var e=t.parentWindow.Object;return t=null,e}(r):((e=u("iframe")).style.display="none",c.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(f("document.F=Object")),t.close(),t.F);for(var n=a.length;n--;)delete p.prototype[a[n]];return p()};s[l]=!0,t.exports=Object.create||function(t,e){var n;return null!==t?(h.prototype=o(t),n=new h,h.prototype=null,n[l]=t):n=p(),void 0===e?n:i(n,e)}},function(t,e,n){var r=n(131),o=n(110);t.exports=Object.keys||function(t){return r(t,o)}},function(t,e){t.exports={}},function(t,e,n){var r=n(53),o=n(52),i=n(13)("iterator");t.exports=function(t){if(null!=t)return t[i]||t["@@iterator"]||o[r(t)]}},function(t,e){t.exports=function(t,e,n){if(!(t instanceof e))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return t}},function(t,e,n){"use strict";var r=n(38),o=function(t){var e,n;this.promise=new t(function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r}),this.resolve=r(e),this.reject=r(n)};t.exports.f=function(t){return new o(t)}},function(t,e,n){"use strict";var r=n(87),o=n(31),i=n(50);t.exports=function(t,e,n){var a=r(e);a in t?o.f(t,a,i(0,n)):t[a]=n}},function(t,e,n){var r=n(17),o=n(13),i=n(93),a=o("species");t.exports=function(t){return i>=51||!r(function(){var e=[];return(e.constructor={})[a]=function(){return{foo:1}},1!==e[t](Boolean).foo})}},function(t,e,n){var r=n(46),o=n(86),i=n(32),a=n(28),s=n(95),c=[].push,u=function(t){var e=1==t,n=2==t,u=3==t,l=4==t,h=6==t,f=7==t,p=5==t||h;return function(d,v,g,y){for(var C,x,w=i(d),m=o(w),k=r(v,g,3),S=a(m.length),b=0,P=y||s,E=e?P(d,S):n||f?P(d,0):void 0;S>b;b++)if((p||b in m)&&(x=k(C=m[b],b,w),t))if(e)E[b]=x;else if(x)switch(t){case 3:return!0;case 5:return C;case 6:return b;case 2:c.call(E,C)}else switch(t){case 4:return!1;case 7:c.call(E,C)}return h?-1:u||l?l:E}};t.exports={forEach:u(0),map:u(1),filter:u(2),some:u(3),every:u(4),find:u(5),findIndex:u(6),filterOut:u(7)}},function(t,e,n){"use strict";n.r(e),n.d(e,"SistersPlayerContext",function(){return q});var r,o=n(59),i=n.n(o),a=n(35),s=n.n(a),c=n(1),u=n.n(c),l=n(6),h=n.n(l),f=n(3),p=n.n(f),d=n(42),v=n.n(d),g=n(11),y=n.n(g),C=n(4),x=n.n(C),w=n(57),m=n.n(w),k=n(16),S=n.n(k),b=n(12),P=n.n(b),E=n(55),A=n.n(E),R=n(56),I=n.n(R),D=n(2),T=n.n(D),L=n(5),F=n.n(L),O=n(0),M=n.n(O),U=n(33),N=n(29),B=n(82),_=n(7),z=n(36),j=n(10);n.d(e,"WastedDataType",function(){return j.e}),n.d(e,"FetchErrorType",function(){return j.b}),n.d(e,"DataRoleType",function(){return j.a}),n.d(e,"EventReport",function(){return z}),function(t){t[t.ErrorNetworkTimeout=11e3]="ErrorNetworkTimeout",t[t.ErrorNetworkFetch=11001]="ErrorNetworkFetch",t[t.ErrorNetworkRead=11002]="ErrorNetworkRead",t[t.ErrorMseOpen=11003]="ErrorMseOpen",t[t.ErrorMseAppend=11004]="ErrorMseAppend",t[t.ErrorPlayList=11010]="ErrorPlayList"}(r||(r={}));var q=function(){function t(e,n){var r=this;T()(this,t),M()(this,"extLogCallback",function(){}),M()(this,"p2pContext",void 0),M()(this,"trackerSourceParam",void 0),M()(this,"preloadPlaylistItems",new P.a),M()(this,"p2pEnable",!1),M()(this,"realtimeData",{lastFetchItem:"--",lastPlaylistItem:"--"}),M()(this,"canStartP2PTask",!1),M()(this,"onRealtimeDataUpdate",function(){}),M()(this,"onEventReport",function(t){}),null!=e&&(this.extLogCallback=e);var o,i,a,s=new N.Configuration;if(this.trackerSourceParam=t.getTrackerParamsString(n.trackerParams),this.p2pContext=new U.c(s,function(t,e){return r.printExtLog(t,e)},function(t){return r.eventReportCallback(t)}),null!=n.sdkParams){var c=S()(n.sdkParams);c.length>2&&(this.printExtLog(1,"-> Init Configuration Start <-"),this.p2pContext.Config.allowPrintLog(2)&&console.log("[SistersPlayer] -> Init Configuration Start <-"),this.p2pContext.setConfiguration(c),this.printExtLog(1,"-> Init Configuration Done. <-"),this.p2pContext.Config.allowPrintLog(2)&&console.log("[SistersPlayer] -> Init Configuration Done. <-"))}this.p2pContext.P2P.initPeers(this.trackerSourceParam),this.p2pContext.CDNFetchTaskWorker.setWorkerNum(this.p2pContext.Config.cdnFetchInstances),this.p2pContext.FallbackFetchTaskWorker.setWorkerNum(this.p2pContext.Config.fallbackCDNFetchInstances),this.p2pEnable=!0,this.preloadPlaylistItems.clear(),null!=(null===(o=Object({env:"production",buildtime:"2022-08-09 16:29:40",version:"1.4.24-6d00a813-master",packageVersion:"1.4.24-6d00a813",git:Object({version:"sistersplayer-next-168-g6d00a81",commithash:"6d00a813e4ee1f2f4a3eab6959d3fd162622e7ca",branch:"master"})}))||void 0===o?void 0:o.env)&&(this.printExtLog(0,"Environment: production"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Environment: production")),null!=(null===(i=Object({env:"production",buildtime:"2022-08-09 16:29:40",version:"1.4.24-6d00a813-master",packageVersion:"1.4.24-6d00a813",git:Object({version:"sistersplayer-next-168-g6d00a81",commithash:"6d00a813e4ee1f2f4a3eab6959d3fd162622e7ca",branch:"master"})}))||void 0===i?void 0:i.buildtime)&&(this.printExtLog(0,"Build Time: 2022-08-09 16:29:40"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Build Time: 2022-08-09 16:29:40")),null!=(null===(a=Object({env:"production",buildtime:"2022-08-09 16:29:40",version:"1.4.24-6d00a813-master",packageVersion:"1.4.24-6d00a813",git:Object({version:"sistersplayer-next-168-g6d00a81",commithash:"6d00a813e4ee1f2f4a3eab6959d3fd162622e7ca",branch:"master"})}))||void 0===a?void 0:a.version)&&(this.printExtLog(0,"Version: 1.4.24-6d00a813-master"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Version: 1.4.24-6d00a813-master")),this.printExtLog(0,"Misaka has been created. >w<"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka has been created. >w<")}return F()(t,null,[{key:"checkP2PSupport",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,n=!!e.WebSocket,r=!!(e.MediaSource||e.WebKitMediaSource),o=!!(e.RTCPeerConnection||e.mozRTCPeerConnection||e.webkitRTCPeerConnection),i=e.RTCDataChannel||e.DataChannel,a=!!i,s=!!a&&(null==i||null===(t=i.prototype)||void 0===t?void 0:t.hasOwnProperty("onbufferedamountlow")),c=!!e.ReadableStream,u=n&&r&&o&&a&&s&&c,l="Misaka Network Check: ".concat(u?"Supported":"Unsupported");if("development"==N.Configuration.curNodeEnv){var h="[SistersPlayer] ".concat(l,"\n\t")+"WebSocket: ".concat(n,"\n\t")+"MediaSource: ".concat(r,"\n\t")+"RTCPeerConnection: ".concat(o,"\n\t")+"RTCDataChannel: ".concat(a,"\n\t")+"RTCDataChannel onbufferedamountlow: ".concat(s,"\n\t")+"Fetch API ReadableStream: ".concat(c);console.log(h)}else console.log("[SistersPlayer] ".concat(l));return u}},{key:"checkP2PSupportBypass",value:function(){var t=document.createElement("iframe");t.src="about:blank",t.hidden=!0,document.body.appendChild(t);var e=!1;return t.contentWindow&&(e=this.checkP2PSupport(t.contentWindow)),document.body.removeChild(t),e}},{key:"checkIsCheater",value:function(){var t=!1;return 0==this.checkP2PSupport()&&1==this.checkP2PSupportBypass()&&(t=!0),t}},{key:"getTrackerParamsString",value:function(t){var e="?protocol="+N.Configuration.ProtocolVersion.toString();if(null!=t)for(var n=0,r=I()(t);n<r.length;n++){var o=A()(r[n],2),i=o[0],a=o[1];null!=a&&(e=e+"&"+encodeURIComponent(i)+"="+encodeURIComponent(a.toString()))}return e}}]),F()(t,[{key:"eventReportCallback",value:function(t){var e,n=!0;if(t.type==z.EventReportType.DataReport)switch(null===(e=t.body)||void 0===e?void 0:e.code){case z.DataReportTypeCode.TrackerClosedReport:Math.random()<this.p2pContext.Config.trackerClosedReportProbability&&(n=!1);break;case z.DataReportTypeCode.BadCRCReport:Math.random()<this.p2pContext.Config.badCRCReportProbability&&(n=!1);break;default:n=!1}else n=!1;if(0==n)try{this.onEventReport(t)}catch(t){console.info("[SistersPlayer] Event Report Error: ",t)}}},{key:"printExtLog",value:function(t,e){e="[SistersPlayer] "+e,this.p2pContext.Config.allowPrintExtLog(t)&&this.extLogCallback(t,e)}},{key:"destroy",value:function(){1==this.p2pEnable&&(this.p2pEnable=!1,this.p2pContext.destroy(),this.printExtLog(0,"Misaka has been destroyed. OxO"),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Misaka has been destroyed. OxO"))}},{key:"getDestroyState",value:function(){return 0==this.p2pEnable}},{key:"getP2PDataCollectionStatus",value:function(){return 1==this.p2pEnable?this.p2pContext.P2PDataCollectionStatus:void 0}},{key:"getP2PInfo",value:function(){return{p2pEnable:this.p2pEnable,protocolVersion:N.Configuration.ProtocolVersion}}},{key:"getCurPeerIdInfo",value:function(){if(null!=this.p2pContext.PeerSched){var t=this.p2pContext.CurPeerId,e=S()(m()(this.p2pContext.PeerSched.getSliceIds()));return null!=this.p2pContext.PeerSched.getTracker()?"当前 PeerId: "+t+" , SliceIds: "+e:"当前 PeerId (已主动断开): "+t+" , SliceIds: "+e}return"正在连接..."}},{key:"getPeerIdList",value:function(){var t,e,n=Array();return null!=this.p2pContext.PeerSched&&(x()(t=this.p2pContext.PeerSched.getConnectedPeers()).call(t,function(t){n.push({incoming:t.isIncoming(),connected:!0,peerId:t.extData.peerId,peerRole:t.peerRole})}),x()(e=this.p2pContext.PeerSched.getConnectingPeers()).call(e,function(t){n.push({incoming:t.isIncoming(),connected:!1,peerId:t.extData.peerId,peerRole:t.peerRole})})),n}},{key:"mergeChunkToDownloadFragment",value:function(t,e){var n=B.UrlHelper.getFileName(t);if(null!=n){var r=this.preloadPlaylistItems.get(n);if(null!=r&&r.fileSize>0){var o=this.p2pContext.FragMan.getFragment(n);if(null!=o){var i=r.fileSize,a=new Uint8Array(i),s=0;x()(e).call(e,function(t){a.set(t,s),s+=t.length});var c={data:new Uint8Array,url:t,range:""};o.setNonP2PFragmentData(a,_.a.LACKED,void 0,c)}}}}},{key:"cdnFetchAsBuffer",value:function(t,e,n,o){var i=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(window.fetch){var c,u=!!window.AbortController,l={method:"GET",cache:a?"default":"no-store"},h=!1;u&&(c=new AbortController,l.signal=c.signal);var f=y()(function(){c&&c.abort(),h=!0,t(n,r.ErrorNetworkTimeout,"Failback HTTP fetch response timeout "+N.Configuration.failbackFetchCDNTimeoutMs+" ms, aborted.")},N.Configuration.failbackFetchCDNTimeoutMs);fetch(n,l).then(function(a){if(a.ok)if(clearTimeout(f),a.body){if(!1===h)if(window.ReadableStream){var c=new Array,u=a.body.getReader(),l=function(){},p=function(t){var r;null!=t.value?(c.push(v()(r=t.value).call(r)),e(n,t.value.buffer,t.done),t.done&&i.mergeChunkToDownloadFragment(n,c)):(e(n,new ArrayBuffer(0),t.done),t.done&&i.mergeChunkToDownloadFragment(n,c)),t.done||l()};(l=function(){u.read().then(p).catch(function(e){t(n,r.ErrorNetworkRead,e.toString())})})()}else a.arrayBuffer().then(function(t){1==s&&1==i.p2pEnable&&null!=i.p2pContext.P2PDataCollectionStatus&&i.p2pContext.P2PDataCollectionStatus.addDownloadSizeDataCollection(t.byteLength,_.b.SERVER,o),e(n,t,!0)}).catch(function(e){t(n,r.ErrorNetworkRead,e.toString())})}else t(n,r.ErrorNetworkRead,"response.body is empty.");else t(n,r.ErrorNetworkRead,"response.ok is false.")}).catch(function(e){t(n,r.ErrorNetworkFetch,e.toString())})}else{var p=new XMLHttpRequest;p.onreadystatechange=function(t){2===p.readyState&&p.status>=200&&p.status},p.onload=function(t){p.status>=200&&p.status<=299&&(null!=p.response&&1==s&&1==i.p2pEnable&&null!=i.p2pContext.P2PDataCollectionStatus&&i.p2pContext.P2PDataCollectionStatus.addDownloadSizeDataCollection(p.response.byteLength,_.b.SERVER,o),e(n,p.response,!0))},p.onerror=function(e){t(n,p.readyState>2?r.ErrorNetworkRead:r.ErrorNetworkFetch,e.toString())},p.open("GET",n),p.responseType="arraybuffer",p.send()}}},{key:"p2pFetchAsBuffer",value:function(t,e,n,r){var o=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1==this.p2pEnable){!1===this.canStartP2PTask&&n()>500&&this.preloadPlaylistItems.size>this.p2pContext.Config.nonP2PFragmentCount&&(this.canStartP2PTask=!0);var a=this.p2pContext,s=B.UrlHelper.getFileName(r);if(null!=s&&!1===this.preloadPlaylistItems.has(s)){var c=s;this.realtimeData.lastFetchItem=c,this.onRealtimeDataUpdate();var u=Math.floor(n())-this.p2pContext.Config.p2pSafeBufferDurationForDelayStopMs;u>0?(u=Math.min(u,this.p2pContext.Config.p2pDelayStopMaxMs),y()(function(){a.P2P.stopDownloadFragment(c)},u)):a.P2P.stopDownloadFragment(c);a.P2P.onFragmentFinished(c,function(n,a,s){switch(n){case U.a.DONE:null!=a?e(r,a.buffer,!0):(1==o.p2pEnable&&(o.printExtLog(0,"Fetch Error: p2p download data lost. URL: "+r),o.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Fetch Error: p2p download data lost. URL: "+r)),o.cdnFetchAsBuffer(t,e,r,_.a.LACKED,i,!1));break;case U.a.ERROR:1==o.p2pEnable&&(null!=s?(o.printExtLog(0,"Fetch Error: "+s+". on "+r),o.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Fetch Error: "+s+". URL: "+r)):(o.printExtLog(0,"Fetch Error: p2p download error, no message. URL: "+r),o.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Fetch Error: p2p download error, no message. URL: "+r))),o.cdnFetchAsBuffer(t,e,r,_.a.LACKED,i,!1);break;case U.a.NOTFOUND:o.cdnFetchAsBuffer(t,e,r,_.a.LACKED,i,!0)}})}else this.cdnFetchAsBuffer(t,e,r,_.a.SEED,i,!1)}else this.cdnFetchAsBuffer(t,e,r,_.a.SEED,i,!1)}},{key:"downloadExtraFile",value:function(t,e,n,r,o){var i,a=this.p2pContext;return new p.a((i=h()(u.a.mark(function i(s,c){return u.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return a.P2P.startDownloadFragment(t,e,n,r),a.P2P.onFragmentFinished(t,function(e,n,r){var o=!1;if(e==U.a.DONE&&null!=n){var i=a.FragMan.getFragment(t);if(null!=i){var c=i.getRoleArray();s({data:n,p2pBytes:c[_.a.EXCHANGE],seedBytes:c[_.a.SEED],lackBytes:c[_.a.LACKED]}),o=!0}}o||s(void 0)}),i.next=4,new p.a(function(t){return y()(t,o)});case 4:a.P2P.stopDownloadFragment(t);case 5:case"end":return i.stop()}},i)})),function(t,e){return i.apply(this,arguments)}))}},{key:"parsePlaylistItem",value:function(t){var e=B.UrlHelper.getFileName(t.uri),n=[],r=0,o=void 0;if(null!=t.title){var a,c=void 0;s()(a=t.title).call(a,"|")>=0?(n=t.title.split("|"),c=16):(n=t.title.split(";"),c=10),null!=n[0]&&(r=i()(n[0],c)),null!=n[1]&&(o=i()(n[1],c))}return{uri:t.uri,duration:t.duration,title:t.title,crc:o,fileSize:r,fragName:e}}},{key:"updatePlaylist",value:function(t,e){if(1==this.p2pEnable){var n=this.parsePlaylistItem(e);if(null!=n.fragName)if(this.realtimeData.lastPlaylistItem=n.fragName,this.onRealtimeDataUpdate(),t||!n.title);else{var r=n.fragName,o=n.uri,i=n.fileSize,a=n.crc;this.preloadPlaylistItems.size<=this.p2pContext.Config.nonP2PFragmentCount&&(this.preloadPlaylistItems.set(r,n),this.p2pContext.P2P.createDownloadFragment(r,i,a)),!0===this.canStartP2PTask&&this.p2pContext.P2P.startDownloadFragment(r,o,i,a)}}}}]),t}()},function(t,e,n){t.exports=n(258)},function(t,e,n){t.exports=n(280)},function(t,e){var n=Math.ceil,r=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?r:n)(t)}},function(t,e,n){"use strict";var r=n(17);t.exports=function(t,e){var n=[][t];return!!n&&r(function(){n.call(null,e||function(){throw 1},1)})}},function(t,e,n){"use strict";n.r(e),n.d(e,"UrlHelper",function(){return s});var r=n(2),o=n.n(r),i=n(5),a=n.n(i),s=function(){function t(){o()(this,t)}return a()(t,null,[{key:"urlElementGet",value:function(t,e){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return null!==(n=t.exec(e))&&n[r]?n[r]:void 0}},{key:"getFileName",value:function(t){return this.urlElementGet(/.+[\\|\/](.*?)(?=\?|$)/gm,t)}},{key:"getUrlWithoutArguments",value:function(t){return this.urlElementGet(/^(.*?)(?=\?|$)/gm,t)}},{key:"getStreamName",value:function(t){return this.urlElementGet(/\/(live_.*?)(\/|\.(flv|m3u8|mpd))/gm,t,1)}}]),t}()},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var r=n(25),o=n(85),i=n(50),a=n(44),s=n(87),c=n(26),u=n(124),l=Object.getOwnPropertyDescriptor;e.f=r?l:function(t,e){if(t=a(t),e=s(e,!0),u)try{return l(t,e)}catch(t){}if(c(t,e))return i(!o.f.call(t,e),t[e])}},function(t,e,n){"use strict";var r={}.propertyIsEnumerable,o=Object.getOwnPropertyDescriptor,i=o&&!r.call({1:2},1);e.f=i?function(t){var e=o(this,t);return!!e&&e.enumerable}:r},function(t,e,n){var r=n(17),o=n(67),i="".split;t.exports=r(function(){return!Object("z").propertyIsEnumerable(0)})?function(t){return"String"==o(t)?i.call(t,""):Object(t)}:Object},function(t,e,n){var r=n(21);t.exports=function(t,e){if(!r(t))return t;var n,o;if(e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;if("function"==typeof(n=t.valueOf)&&!r(o=n.call(t)))return o;if(!e&&"function"==typeof(n=t.toString)&&!r(o=n.call(t)))return o;throw TypeError("Can't convert object to primitive value")}},function(t,e,n){var r=n(108),o=n(89),i=r("keys");t.exports=function(t){return i[t]||(i[t]=o(t))}},function(t,e){var n=0,r=Math.random();t.exports=function(t){return"Symbol("+String(void 0===t?"":t)+")_"+(++n+r).toString(36)}},function(t,e){},function(t,e,n){var r=n(67),o=n(14);t.exports="process"==r(o.process)},function(t,e){t.exports=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}}},function(t,e,n){var r,o,i=n(14),a=n(114),s=i.process,c=s&&s.versions,u=c&&c.v8;u?o=(r=u.split("."))[0]+r[1]:a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(o=r[1]),t.exports=o&&+o},function(t,e,n){"use strict";var r=n(44),o=n(116),i=n(52),a=n(49),s=n(115),c=a.set,u=a.getterFor("Array Iterator");t.exports=s(Array,"Array",function(t,e){c(this,{type:"Array Iterator",target:r(t),index:0,kind:e})},function(){var t=u(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}},"values"),i.Arguments=i.Array,o("keys"),o("values"),o("entries")},function(t,e,n){var r=n(21),o=n(61),i=n(13)("species");t.exports=function(t,e){var n;return o(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!o(n.prototype)?r(n)&&null===(n=n[i])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===e?0:e)}},function(t,e,n){t.exports=n(270)},function(t,e,n){t.exports=n(299)},function(t,e,n){t.exports=n(300)},function(t,e,n){t.exports=n(301)},function(t,e,n){t.exports=n(318)},function(t,e,n){"use strict";n.d(e,"b",function(){return s}),n.d(e,"a",function(){return c}),n(96),n(63);var r=n(2),o=n.n(r),i=(n(5),n(0)),a=n.n(i);function s(t){return Math.floor(Math.random()*Math.floor(t))}var c=function t(e){o()(this,t),a()(this,"data",void 0),this.data=e}},function(t,e,n){t.exports=n(277)},function(t,e,n){t.exports=n(309)},function(t,e,n){var r=n(14),o=n(21),i=r.document,a=o(i)&&o(i.createElement);t.exports=function(t){return a?i.createElement(t):{}}},function(t,e,n){var r=n(44),o=n(28),i=n(106),a=function(t){return function(e,n,a){var s,c=r(e),u=o(c.length),l=i(a,u);if(t&&n!=n){for(;u>l;)if((s=c[l++])!=s)return!0}else for(;u>l;l++)if((t||l in c)&&c[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:a(!0),indexOf:a(!1)}},function(t,e,n){var r=n(80),o=Math.max,i=Math.min;t.exports=function(t,e){var n=r(t);return n<0?o(n+e,0):i(n,e)}},function(t,e,n){var r=n(26),o=n(32),i=n(88),a=n(190),s=i("IE_PROTO"),c=Object.prototype;t.exports=a?Object.getPrototypeOf:function(t){return t=o(t),r(t,s)?t[s]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?c:null}},function(t,e,n){var r=n(47),o=n(109);(t.exports=function(t,e){return o[t]||(o[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.8.0",mode:r?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},function(t,e,n){var r=n(14),o=n(189),i=r["__core-js_shared__"]||o("__core-js_shared__",{});t.exports=i},function(t,e){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},function(t,e,n){var r=n(17);t.exports=!!Object.getOwnPropertySymbols&&!r(function(){return!String(Symbol())})},function(t,e,n){var r={};r[n(13)("toStringTag")]="z",t.exports="[object z]"===String(r)},function(t,e,n){var r=n(54);t.exports=function(t,e,n){for(var o in e)n&&n.unsafe&&t[o]?t[o]=e[o]:r(t,o,e[o],n);return t}},function(t,e,n){var r=n(39);t.exports=r("navigator","userAgent")||""},function(t,e,n){"use strict";var r=n(8),o=n(147),i=n(107),a=n(129),s=n(48),c=n(30),u=n(54),l=n(13),h=n(47),f=n(52),p=n(148),d=p.IteratorPrototype,v=p.BUGGY_SAFARI_ITERATORS,g=l("iterator"),y=function(){return this};t.exports=function(t,e,n,l,p,C,x){o(n,e,l);var w,m,k,S=function(t){if(t===p&&R)return R;if(!v&&t in E)return E[t];switch(t){case"keys":case"values":case"entries":return function(){return new n(this,t)}}return function(){return new n(this)}},b=e+" Iterator",P=!1,E=t.prototype,A=E[g]||E["@@iterator"]||p&&E[p],R=!v&&A||S(p),I="Array"==e&&E.entries||A;if(I&&(w=i(I.call(new t)),d!==Object.prototype&&w.next&&(h||i(w)===d||(a?a(w,d):"function"!=typeof w[g]&&c(w,g,y)),s(w,b,!0,!0),h&&(f[b]=y))),"values"==p&&A&&"values"!==A.name&&(P=!0,R=function(){return A.call(this)}),h&&!x||E[g]===R||c(E,g,R),f[e]=R,p)if(m={values:S("values"),keys:C?R:S("keys"),entries:S("entries")},x)for(k in m)(v||P||!(k in E))&&u(E,k,m[k]);else r({target:e,proto:!0,forced:v||P},m);return m}},function(t,e){t.exports=function(){}},function(t,e,n){t.exports=n(222)},function(t,e,n){var r=n(13);e.f=r},function(t,e,n){t.exports=n(342)},function(t,e,n){t.exports=n(288)},function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n(2),o=n.n(r),i=n(5),a=n.n(i),s=n(0),c=n.n(s),u=function(){function t(){o()(this,t)}return a()(t,null,[{key:"crc32",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new Uint32Array(1);new Uint32Array(1)[0]=e;var r=new Uint32Array(1);for(r[0]=0,r[0]^=4294967295,n[0]=0;n[0]<t.length;n[0]+=e)r[0]=this.crc32_tab[255&(r[0]^t[n[0]])]^r[0]>>8&16777215;return r[0]=4294967295^r[0],r[0]<0&&(r[0]+=4294967296),r[0]}}]),t}();c()(u,"crc32_tab",new Uint32Array([0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117]))},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return z});var r=n(9),o=n.n(r),i=n(62),a=n.n(i),s=n(55),c=n.n(s),u=n(56),l=n.n(u),h=n(65),f=n.n(h),p=n(16),d=n.n(p),v=n(11),g=n.n(v),y=n(4),C=n.n(y),x=n(3),w=n.n(x),m=n(1),k=n.n(m),S=n(6),b=n.n(S),P=n(12),E=n.n(P),A=n(2),R=n.n(A),I=n(5),D=n.n(I),T=n(0),L=n.n(T),F=n(20),O=n(43),M=n(33),U=n(19),N=n(36),B=n(29),_=function(){function t(e,n,r){R()(this,t),L()(this,"p2pContext",void 0),L()(this,"needDestroy",!1),L()(this,"ws",void 0),L()(this,"requestId",0),L()(this,"pendingRequests",new E.a),L()(this,"messageSink",void 0),L()(this,"trackerSourceParam",void 0),L()(this,"onReconnected",function(){}),this.p2pContext=e,this.trackerSourceParam=n,this.messageSink=r}var e,n,r,o,i;return D()(t,[{key:"trackerConnect",value:(i=b()(k.a.mark(function t(){var e,n=this;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.p2pContext.printExtLog(0,"Last Order (re)connecting."),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order (re)connecting."),!1!==this.needDestroy){t.next=20;break}return t.next=5,this.newTrackerConnect();case 5:if(void 0!==(e=t.sent)){t.next=11;break}return this.p2pContext.P2PDataCollectionStatus.addTrackerConnect(!1),t.abrupt("return",void 0);case 11:return this.p2pContext.P2PDataCollectionStatus.addTrackerConnect(!0),this.ws=e,this.ws.onmessage=function(t){n.onMessageReceived(t.data)},this.onReconnected(),this.p2pContext.printExtLog(0,"Last Order (re)connect done."),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order (re)connect done."),t.abrupt("return",e);case 18:t.next=22;break;case 20:this.p2pContext.printExtLog(0,"Last Order (re)connect cancel."),this.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order (re)connect cancel.");case 22:case"end":return t.stop()}},t,this)})),function(){return i.apply(this,arguments)})},{key:"newTrackerConnect",value:(o=b()(k.a.mark(function t(){var e=this;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new w.a(function(t){var n=e.p2pContext.Config.trackerServers[e.p2pContext.trackerPositionInServers],r=new WebSocket(n+e.trackerSourceParam);e.p2pContext.trackerPositionInServers=++e.p2pContext.trackerPositionInServers%e.p2pContext.Config.trackerServers.length,r.onopen=function(n){e.needDestroy?(r.close(),t(void 0)):t(r)},r.onclose=function(r){var o;e.p2pContext.eventReportCallback(new N.TrackerClosedDataReportEvent(r.code,n)),e.p2pContext.printExtLog(0,"Last Order connection is closed. (code: "+r.code+"), url: "+n),e.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Last Order connection is closed. (code: "+r.code+"), url: "+n),C()(o=e.pendingRequests).call(o,function(t,e){return t(void 0)}),e.pendingRequests.clear(),0==e.needDestroy?0==e.p2pContext.trackerPositionInServers?(e.p2pContext.printExtLog(0,"Misaka will reconnect to the Last Order in "+e.p2pContext.Config.reconnectWaitTimeSec+" seconds."),e.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Misaka will reconnect to the Last Order in "+e.p2pContext.Config.reconnectWaitTimeSec+" seconds."),g()(function(){e.trackerConnect()},1e3*e.p2pContext.Config.reconnectWaitTimeSec)):(e.p2pContext.printExtLog(0,"Misaka will reconnect to the Last Order immediately."),e.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] Misaka will reconnect to the Last Order immediately."),e.trackerConnect()):(e.p2pContext.printExtLog(0,"Last Order reconnect cancel."),e.p2pContext.Config.allowPrintLog(0)&&console.log("[SistersPlayer] Last Order reconnect cancel.")),t(void 0)}}));case 1:case"end":return t.stop()}},t)})),function(){return o.apply(this,arguments)})},{key:"dispatchResponse",value:function(t){var e=this.pendingRequests.get(t.requestId);void 0!==e&&(this.pendingRequests.delete(t.requestId),e(t))}},{key:"sendMessage",value:function(t,e,n,r,o,i){var a=this,s=this.ws;if(null!=s&&s.readyState==s.OPEN){0==n&&(++this.requestId,n=this.requestId);var c={type:e,requestId:n};c[r]=o,null!==t&&(c.from=this.p2pContext.CurPeerId,c.to=t),void 0!==i&&(c.data=i);var u=this.pendingRequests;return new w.a(function(t){null!=s&&s.readyState==s.OPEN?(a.p2pContext.Config.allowPrintLog(7)&&console.log("send: ",c),u.set(n,t),s.send(d()(c))):t(void 0)})}return new w.a(function(t){return t(void 0)})}},{key:"sendServerRequest",value:(r=b()(k.a.mark(function t(e,n,r){var o,i,a,s,c,u=this;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return o=performance.now(),i=this.sendMessage(null,"request",n,"action",e,r),t.next=4,w.a.race(new Array(new w.a(function(t){return a=g()(function(){return t(void 0)},u.p2pContext.Config.serverTimeoutMs)}),i));case 4:if(s=t.sent,clearTimeout(a),!(n<0)){t.next=8;break}return t.abrupt("return",s);case 8:return c=performance.now(),void 0===s?this.p2pContext.P2PDataCollectionStatus.addTrackerResponse(!1,c-o):this.p2pContext.P2PDataCollectionStatus.addTrackerResponse(!0,c-o),t.abrupt("return",s);case 11:case"end":return t.stop()}},t,this)})),function(t,e,n){return r.apply(this,arguments)})},{key:"sendPeerRequest",value:(n=b()(k.a.mark(function t(e,n,r,o){var i,a,s,c=this;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.sendMessage(e,"request",r,"action",n,o),t.next=3,w.a.race(new Array(new w.a(function(t){return a=g()(function(){return t(void 0)},c.p2pContext.Config.peerConnectionTimeoutMs)}),i));case 3:return s=t.sent,clearTimeout(a),t.abrupt("return",s);case 6:case"end":return t.stop()}},t,this)})),function(t,e,r,o){return n.apply(this,arguments)})},{key:"sendPeerResponse",value:function(t,e,n,r){return this.sendMessage(t,"response",e,"status",n,r)}},{key:"onPeerRequest",value:function(t){this.messageSink.onPeerMessage(this,t.from,t,t.requestId)}},{key:"onServerRequest",value:function(t){this.messageSink.onServerMessage(this,t)}},{key:"onMessageReceived",value:function(t){if(0==this.needDestroy)try{var e=JSON.parse(t);this.p2pContext.Config.allowPrintLog(7)&&console.log("recv: ",e),"response"==e.type&&f()(e.requestId)&&e.requestId>0?this.dispatchResponse(e):"request"==e.type&&f()(e.requestId)&&(null==e.from?this.onServerRequest(e):this.onPeerRequest(e))}catch(t){console.log(t)}}},{key:"destroy",value:function(){var t;this.needDestroy=!0,null!=this.ws&&(this.ws.close(),this.ws=void 0),C()(t=this.pendingRequests).call(t,function(t,e){return t(void 0)}),this.pendingRequests.clear()}}],[{key:"connect",value:(e=b()(k.a.mark(function e(n,r,o,i){var a;return k.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=new t(n,r,o),e.next=3,new w.a(function(t){a.onReconnected=function(){t()},a.trackerConnect()});case 3:return a.onReconnected=i,e.abrupt("return",a);case 5:case"end":return e.stop()}},e)})),function(t,n,r,o){return e.apply(this,arguments)})}]),t}(),z=function(){function e(t,n){R()(this,e),L()(this,"curVisibilityState",O.b.BROADCAST),L()(this,"needDestroy",!1),L()(this,"p2pContext",void 0),L()(this,"tracker",void 0),L()(this,"peerSched",void 0),L()(this,"natType",M.b.CONE),L()(this,"autoSelfInvisibleTimeoutId",void 0),this.p2pContext=t,this.peerSched=n}var n,r,i,s,u;return D()(e,[{key:"initTracker",value:function(t){this.tracker=t,1==this.needDestroy&&this.destroy()}},{key:"onTrackerReconnected",value:function(){var t=this;this.setSelfVisible(this.curVisibilityState).then(function(e){t.p2pContext.printExtLog(0,"SetVisible after reconnect."),t.p2pContext.Config.allowPrintLog(0)&&console.warn("[SistersPlayer] SetVisible after reconnect.")})}},{key:"getPeers",value:(u=b()(k.a.mark(function t(){var e;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e={peers:[],leeches:[],seedboxes:new E.a},null==this.tracker){t.next=7;break}return t.next=4,this.tracker.sendServerRequest("getPeers",0,{roles:["peer","leech","seedbox"]}).then(function(t){if(null!=t&&t.data&&(t.data.peers&&(e.peers=t.data.peers),t.data.leeches&&(e.leeches=t.data.leeches),t.data.seedboxes))for(var n=0,r=l()(t.data.seedboxes);n<r.length;n++){var o=c()(r[n],2),i=o[0],s=o[1];a()(s)&&e.seedboxes.set(i,s)}return e});case 4:return t.abrupt("return",t.sent);case 7:return t.abrupt("return",new w.a(function(t){return t(e)}));case 8:case"end":return t.stop()}},t,this)})),function(){return u.apply(this,arguments)})},{key:"sendPeerCandidate",value:(s=b()(k.a.mark(function t(e,n,r){var o;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(null==this.tracker){t.next=11;break}return t.next=3,this.tracker.sendPeerRequest(e,"candidate",-1,{direction:n,cand:r});case 3:if("ok"!=(null==(o=t.sent)?void 0:o.status)){t.next=8;break}return t.abrupt("return",!0);case 8:return t.abrupt("return",!1);case 9:t.next=12;break;case 11:return t.abrupt("return",!1);case 12:case"end":return t.stop()}},t,this)})),function(t,e,n){return s.apply(this,arguments)})},{key:"connectPeer",value:(i=b()(k.a.mark(function t(e,n){var r,o,i,a,s,c,u,l,h=this;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=new F.NyaPeer(this.p2pContext,this.peerSched,!1),null==n||n(r),r.extData.peerId=e,o=new U.c,t.next=6,o.lock();case 6:return t.next=8,r.createNyaOffer(function(t){o.lock().then(function(){h.sendPeerCandidate(e,"offer",t),o.unlock()})});case 8:if(i=t.sent,a=void 0,null==this.tracker){t.next=14;break}return t.next=13,this.tracker.sendPeerRequest(e,"connect",0,{protocol:B.Configuration.ProtocolVersion,offer:i,role:{type:"peer"}});case 13:a=t.sent;case 14:if(o.unlock(),null!=a){t.next=18;break}return this.peerSched.onPeerConnectComplete(r,!1),t.abrupt("return");case 18:if(t.prev=18,"ok"===a.status){t.next=23;break}this.peerSched.onPeerConnectComplete(r,!1),t.next=51;break;case 23:if(s=a.data,c=s.answer,this.p2pContext.printExtLog(3,"peer connecting "+e),this.p2pContext.Config.allowPrintLog(3)&&console.log("peer connecting "+e),r.parsePeerRole(s.role),r.peerRole!=F.PeerRole.Seedbox){t.next=45;break}if(l=!1,C()(u=r.seedSliceIds).call(u,function(t){h.peerSched.getSeedboxNeedConnectNum(t)>0&&(l=!0)}),1!=l){t.next=40;break}return t.t0=this.peerSched,t.t1=r,t.next=36,r.acceptNyaAnswer(c);case 36:t.t2=t.sent,t.t0.onPeerConnectComplete.call(t.t0,t.t1,t.t2),t.next=43;break;case 40:this.p2pContext.printExtLog(2,"not need this seedbox: "+e),this.p2pContext.Config.allowPrintLog(2)&&console.log("not need this seedbox: "+e),this.peerSched.onPeerConnectComplete(r,!1);case 43:t.next=51;break;case 45:return t.t3=this.peerSched,t.t4=r,t.next=49,r.acceptNyaAnswer(c);case 49:t.t5=t.sent,t.t3.onPeerConnectComplete.call(t.t3,t.t4,t.t5);case 51:t.next=57;break;case 53:t.prev=53,t.t6=t.catch(18),console.log(t.t6),this.peerSched.onPeerConnectComplete(r,!1);case 57:case"end":return t.stop()}},t,this,[[18,53]])})),function(t,e){return i.apply(this,arguments)})},{key:"getVisibilityState",value:function(){return this.curVisibilityState}},{key:"setSelfVisible",value:(r=b()(k.a.mark(function t(e){var n,r,o,i,a,s;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!1,e==O.b.HIDDEN||e==O.b.GONE?r=!1:e==O.b.BROADCAST&&(r=!0),this.tracker){t.next=4;break}return t.abrupt("return",!1);case 4:return t.next=6,null===(n=this.tracker)||void 0===n?void 0:n.sendServerRequest("setVisible",0,{value:r});case 6:if("ok"!==(null==(o=t.sent)?void 0:o.status)){t.next=17;break}return t.next=10,null===(i=this.p2pContext.PeerSched)||void 0===i?void 0:i.getConnectMutex().lock();case 10:return this.curVisibilityState=e,null===(a=this.p2pContext.PeerSched)||void 0===a||a.getConnectCV().notifyAll(),null===(s=this.p2pContext.PeerSched)||void 0===s||s.getConnectMutex().unlock(),r?this.delaySetInvisible():this.cancelDelaySetInvisible(),t.abrupt("return",!0);case 17:return t.abrupt("return",!1);case 18:case"end":return t.stop()}},t,this)})),function(t){return r.apply(this,arguments)})},{key:"delaySetInvisible",value:function(){var e=this;void 0!==this.autoSelfInvisibleTimeoutId&&(clearTimeout(this.autoSelfInvisibleTimeoutId),this.autoSelfInvisibleTimeoutId=void 0);var n=this.p2pContext.Config,r=n.coneVisibleMaxTimeMs;this.natType==M.b.CONE?r=n.coneVisibleMaxTimeMs:this.natType==M.b.NON_NAT?r=n.nonnatVisibleMaxTimeMs:this.natType==M.b.SYMMETRIC&&(r=n.symmetricVisibleMaxTimeMs),this.autoSelfInvisibleTimeoutId=t.setTimeout(function(){e.setSelfVisible(O.b.HIDDEN)},r)}},{key:"cancelDelaySetInvisible",value:function(){void 0!==this.autoSelfInvisibleTimeoutId&&(clearTimeout(this.autoSelfInvisibleTimeoutId),this.autoSelfInvisibleTimeoutId=void 0)}},{key:"onNatTypeUpdated",value:function(t){this.natType=t,this.p2pContext.printExtLog(0,"NAT TYPE: ".concat(t,".")),this.p2pContext.Config.allowPrintLog(0)&&console.info("[SistersPlayer] NAT TYPE: ".concat(t,".")),this.delaySetInvisible()}},{key:"reportDownloadBlockSuccessOrAwaysFail",value:function(t,e){var n,r,i,a;return this.p2pContext.printExtLog(3,o()(n="peerId ".concat(t," report ")).call(n,e?"peerConnected":"peerConnectFailed"," to tracker.")),this.p2pContext.Config.allowPrintLog(3)&&console.log(o()(a="peerId ".concat(t," report ")).call(a,e?"peerConnected":"peerConnectFailed"," to tracker.")),null!==(r=null===(i=this.tracker)||void 0===i?void 0:i.sendServerRequest("report",-1,{id:e?"peerConnected":"peerConnectFailed",remote:t}).then(function(t){return void 0!==t&&"ok"===(null==t?void 0:t.status)}))&&void 0!==r?r:w.a.resolve(!1)}},{key:"onPeerMessage",value:function(t,e,n,r){return this.peerSched.onPeerRelayMessage(e,n,r)}},{key:"onServerMessage",value:function(t,e){switch(e.action){case"setPeerId":this.p2pContext.CurPeerId=e.data.id;break;case"updateConfig":this.p2pContext.setConfiguration(e.data.jsonstr);break;case"move":this.p2pContext.setConfiguration(d()({trackerServers:[e.data.target]})),this.peerSched.recreateTracker()}}},{key:"sendPeerResponse",value:function(t,e,n,r){return null!=this.tracker?this.tracker.sendPeerResponse(t,e,n,r):new w.a(function(t){return t(void 0)})}},{key:"destroy",value:function(){var t;this.needDestroy=!0,this.cancelDelaySetInvisible(),null===(t=this.tracker)||void 0===t||t.destroy()}}],[{key:"connect",value:(n=b()(k.a.mark(function t(n,r,o,i){var a,s;return k.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=new e(n,o),t.next=3,_.connect(n,r,a,function(){a.onTrackerReconnected()});case 3:return s=t.sent,a.initTracker(s),a.setSelfVisible(O.b.BROADCAST),t.abrupt("return",a);case 7:case"end":return t.stop()}},t)})),function(t,e,r,o){return n.apply(this,arguments)})}]),e}()}).call(this,n(83))},function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},function(t,e,n){var r=n(25),o=n(17),i=n(104);t.exports=!r&&!o(function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a})},function(t,e,n){var r=n(17),o=/#|\.prototype\./,i=function(t,e){var n=s[a(t)];return n==u||n!=c&&("function"==typeof e?r(e):!!e)},a=i.normalize=function(t){return String(t).replace(o,".").toLowerCase()},s=i.data={},c=i.NATIVE="N",u=i.POLYFILL="P";t.exports=i},function(t,e,n){var r=n(14),o=n(177).trim,i=n(123),a=r.parseInt,s=/^[+-]?0[Xx]/,c=8!==a(i+"08")||22!==a(i+"0x16");t.exports=c?function(t,e){var n=o(String(t));return a(n,e>>>0||(s.test(n)?16:10))}:a},function(t,e,n){n(128),n(90),n(192),n(144),n(145),n(197),n(40),n(41);var r=n(15);t.exports=r.Promise},function(t,e,n){"use strict";var r=n(8),o=n(107),i=n(129),a=n(68),s=n(30),c=n(50),u=n(51),l=function(t,e){var n=this;if(!(n instanceof l))return new l(t,e);i&&(n=i(new Error(void 0),o(n))),void 0!==e&&s(n,"message",String(e));var r=[];return u(t,r.push,{that:r}),s(n,"errors",r),n};l.prototype=a(Error.prototype,{constructor:c(5,l),message:c(5,""),name:c(5,"AggregateError")}),r({global:!0},{AggregateError:l})},function(t,e,n){var r=n(27),o=n(191);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),e=n instanceof Array}catch(t){}return function(n,i){return r(n),o(i),e?t.call(n,i):n.__proto__=i,n}}():void 0)},function(t,e,n){var r=n(25),o=n(31),i=n(27),a=n(69);t.exports=r?Object.defineProperties:function(t,e){i(t);for(var n,r=a(e),s=r.length,c=0;s>c;)o.f(t,n=r[c++],e[n]);return t}},function(t,e,n){var r=n(26),o=n(44),i=n(105).indexOf,a=n(70);t.exports=function(t,e){var n,s=o(t),c=0,u=[];for(n in s)!r(a,n)&&r(s,n)&&u.push(n);for(;e.length>c;)r(s,n=e[c++])&&(~i(u,n)||u.push(n));return u}},function(t,e,n){var r=n(39);t.exports=r("document","documentElement")},function(t,e,n){var r=n(13),o=n(52),i=r("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(o.Array===t||a[i]===t)}},function(t,e,n){var r=n(111);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},function(t,e,n){var r=n(27);t.exports=function(t){var e=t.return;if(void 0!==e)return r(e.call(t)).value}},function(t,e,n){var r=n(14);t.exports=r.Promise},function(t,e,n){"use strict";var r=n(39),o=n(31),i=n(13),a=n(25),s=i("species");t.exports=function(t){var e=r(t),n=o.f;a&&e&&!e[s]&&n(e,s,{configurable:!0,get:function(){return this}})}},function(t,e,n){var r=n(109),o=Function.toString;"function"!=typeof r.inspectSource&&(r.inspectSource=function(t){return o.call(t)}),t.exports=r.inspectSource},function(t,e,n){var r=n(13)("iterator"),o=!1;try{var i=0,a={next:function(){return{done:!!i++}},return:function(){o=!0}};a[r]=function(){return this},Array.from(a,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!o)return!1;var n=!1;try{var i={};i[r]=function(){return{next:function(){return{done:n=!0}}}},t(i)}catch(t){}return n}},function(t,e,n){var r=n(27),o=n(38),i=n(13)("species");t.exports=function(t,e){var n,a=r(t).constructor;return void 0===a||null==(n=r(a)[i])?e:o(n)}},function(t,e,n){var r,o,i,a=n(14),s=n(17),c=n(46),u=n(132),l=n(104),h=n(142),f=n(91),p=a.location,d=a.setImmediate,v=a.clearImmediate,g=a.process,y=a.MessageChannel,C=a.Dispatch,x=0,w={},m=function(t){if(w.hasOwnProperty(t)){var e=w[t];delete w[t],e()}},k=function(t){return function(){m(t)}},S=function(t){m(t.data)},b=function(t){a.postMessage(t+"",p.protocol+"//"+p.host)};d&&v||(d=function(t){for(var e=[],n=1;arguments.length>n;)e.push(arguments[n++]);return w[++x]=function(){("function"==typeof t?t:Function(t)).apply(void 0,e)},r(x),x},v=function(t){delete w[t]},f?r=function(t){g.nextTick(k(t))}:C&&C.now?r=function(t){C.now(k(t))}:y&&!h?(i=(o=new y).port2,o.port1.onmessage=S,r=c(i.postMessage,i,1)):a.addEventListener&&"function"==typeof postMessage&&!a.importScripts&&p&&"file:"!==p.protocol&&!s(b)?(r=b,a.addEventListener("message",S,!1)):r="onreadystatechange"in l("script")?function(t){u.appendChild(l("script")).onreadystatechange=function(){u.removeChild(this),m(t)}}:function(t){setTimeout(k(t),0)}),t.exports={set:d,clear:v}},function(t,e,n){var r=n(114);t.exports=/(iphone|ipod|ipad).*applewebkit/i.test(r)},function(t,e,n){var r=n(27),o=n(21),i=n(73);t.exports=function(t,e){if(r(t),o(e)&&e.constructor===t)return e;var n=i.f(t);return(0,n.resolve)(e),n.promise}},function(t,e,n){"use strict";var r=n(8),o=n(38),i=n(73),a=n(92),s=n(51);r({target:"Promise",stat:!0},{allSettled:function(t){var e=this,n=i.f(e),r=n.resolve,c=n.reject,u=a(function(){var n=o(e.resolve),i=[],a=0,c=1;s(t,function(t){var o=a++,s=!1;i.push(void 0),c++,n.call(e,t).then(function(t){s||(s=!0,i[o]={status:"fulfilled",value:t},--c||r(i))},function(t){s||(s=!0,i[o]={status:"rejected",reason:t},--c||r(i))})}),--c||r(i)});return u.error&&c(u.value),n.promise}})},function(t,e,n){"use strict";var r=n(8),o=n(38),i=n(39),a=n(73),s=n(92),c=n(51);r({target:"Promise",stat:!0},{any:function(t){var e=this,n=a.f(e),r=n.resolve,u=n.reject,l=s(function(){var n=o(e.resolve),a=[],s=0,l=1,h=!1;c(t,function(t){var o=s++,c=!1;a.push(void 0),l++,n.call(e,t).then(function(t){c||h||(h=!0,r(t))},function(t){c||h||(c=!0,a[o]=t,--l||u(new(i("AggregateError"))(a,"No one promise resolved")))})}),--l||u(new(i("AggregateError"))(a,"No one promise resolved"))});return l.error&&u(l.value),n.promise}})},function(t,e,n){var r=n(80),o=n(60),i=function(t){return function(e,n){var i,a,s=String(o(e)),c=r(n),u=s.length;return c<0||c>=u?t?"":void 0:(i=s.charCodeAt(c))<55296||i>56319||c+1===u||(a=s.charCodeAt(c+1))<56320||a>57343?t?s.charAt(c):i:t?s.slice(c,c+2):a-56320+(i-55296<<10)+65536}};t.exports={codeAt:i(!1),charAt:i(!0)}},function(t,e,n){"use strict";var r=n(148).IteratorPrototype,o=n(68),i=n(50),a=n(48),s=n(52),c=function(){return this};t.exports=function(t,e,n){var u=e+" Iterator";return t.prototype=o(r,{next:i(1,n)}),a(t,u,!1,!0),s[u]=c,t}},function(t,e,n){"use strict";var r,o,i,a=n(107),s=n(30),c=n(26),u=n(13),l=n(47),h=u("iterator"),f=!1;[].keys&&("next"in(i=[].keys())?(o=a(a(i)))!==Object.prototype&&(r=o):f=!0),null==r&&(r={}),l||c(r,h)||s(r,h,function(){return this}),t.exports={IteratorPrototype:r,BUGGY_SAFARI_ITERATORS:f}},function(t,e,n){var r=n(205),o=Array.prototype;t.exports=function(t){var e=t.slice;return t===o||t instanceof Array&&e===o.slice?r:e}},function(t,e,n){var r=n(8),o=n(14),i=n(114),a=[].slice,s=function(t){return function(e,n){var r=arguments.length>2,o=r?a.call(arguments,2):void 0;return t(r?function(){("function"==typeof e?e:Function(e)).apply(this,o)}:e,n)}};r({global:!0,bind:!0,forced:/MSIE .\./.test(i)},{setTimeout:s(o.setTimeout),setInterval:s(o.setInterval)})},function(t,e,n){t.exports=n(214)},function(t,e,n){n(215);var r=n(15);t.exports=r.Array.isArray},function(t,e){t.exports=function(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}},function(t,e,n){t.exports=n(217)},function(t,e,n){n(40),n(218);var r=n(15);t.exports=r.Array.from},function(t,e,n){"use strict";var r=n(46),o=n(32),i=n(219),a=n(133),s=n(28),c=n(74),u=n(71);t.exports=function(t){var e,n,l,h,f,p,d=o(t),v="function"==typeof this?this:Array,g=arguments.length,y=g>1?arguments[1]:void 0,C=void 0!==y,x=u(d),w=0;if(C&&(y=r(y,g>2?arguments[2]:void 0,2)),null==x||v==Array&&a(x))for(n=new v(e=s(d.length));e>w;w++)p=C?y(d[w],w):d[w],c(n,w,p);else for(f=(h=x.call(d)).next,n=new v;!(l=f.call(h)).done;w++)p=C?i(h,y,[l.value,w],!0):l.value,c(n,w,p);return n.length=w,n}},function(t,e,n){t.exports=n(220)},function(t,e,n){n(159),n(90),n(223),n(225),n(226),n(227),n(228),n(162),n(229),n(230),n(231),n(232),n(233),n(234),n(235),n(236),n(237),n(238),n(239),n(240);var r=n(15);t.exports=r.Symbol},function(t,e,n){"use strict";var r=n(8),o=n(17),i=n(61),a=n(21),s=n(32),c=n(28),u=n(74),l=n(95),h=n(75),f=n(13),p=n(93),d=f("isConcatSpreadable"),v=p>=51||!o(function(){var t=[];return t[d]=!1,t.concat()[0]!==t}),g=h("concat"),y=function(t){if(!a(t))return!1;var e=t[d];return void 0!==e?!!e:i(t)};r({target:"Array",proto:!0,forced:!v||!g},{concat:function(t){var e,n,r,o,i,a=s(this),h=l(a,0),f=0;for(e=-1,r=arguments.length;e<r;e++)if(y(i=-1===e?a:arguments[e])){if(f+(o=c(i.length))>9007199254740991)throw TypeError("Maximum allowed index exceeded");for(n=0;n<o;n++,f++)n in i&&u(h,f,i[n])}else{if(f>=9007199254740991)throw TypeError("Maximum allowed index exceeded");u(h,f++,i)}return h.length=f,h}})},function(t,e,n){var r=n(131),o=n(110).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,o)}},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,n){n(18)("iterator")},function(t,e,n){var r=n(154),o=n(246),i=n(153);t.exports=function(t,e){var n;if(t){if("string"==typeof t)return i(t,e);var a=o(n=Object.prototype.toString.call(t)).call(n,8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?r(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(t,e):void 0}}},function(t,e,n){"use strict";var r=n(8),o=n(14),i=n(165),a=n(17),s=n(30),c=n(51),u=n(72),l=n(21),h=n(48),f=n(31).f,p=n(76).forEach,d=n(25),v=n(49),g=v.set,y=v.getterFor;t.exports=function(t,e,n){var v,C=-1!==t.indexOf("Map"),x=-1!==t.indexOf("Weak"),w=C?"set":"add",m=o[t],k=m&&m.prototype,S={};if(d&&"function"==typeof m&&(x||k.forEach&&!a(function(){(new m).entries().next()}))){v=e(function(e,n){g(u(e,v,t),{type:t,collection:new m}),null!=n&&c(n,e[w],{that:e,AS_ENTRIES:C})});var b=y(t);p(["add","clear","delete","forEach","get","has","set","keys","values","entries"],function(t){var e="add"==t||"set"==t;!(t in k)||x&&"clear"==t||s(v.prototype,t,function(n,r){var o=b(this).collection;if(!e&&x&&!l(n))return"get"==t&&void 0;var i=o[t](0===n?0:n,r);return e?this:i})}),x||f(v.prototype,"size",{configurable:!0,get:function(){return b(this).collection.size}})}else v=n.getConstructor(e,t,C,w),i.REQUIRED=!0;return h(v,t,!1,!0),S[t]=v,r({global:!0,forced:!0},S),x||n.setStrong(v,t,C),v}},function(t,e,n){var r=n(70),o=n(21),i=n(26),a=n(31).f,s=n(89),c=n(255),u=s("meta"),l=0,h=Object.isExtensible||function(){return!0},f=function(t){a(t,u,{value:{objectID:"O"+ ++l,weakData:{}}})},p=t.exports={REQUIRED:!1,fastKey:function(t,e){if(!o(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,u)){if(!h(t))return"F";if(!e)return"E";f(t)}return t[u].objectID},getWeakData:function(t,e){if(!i(t,u)){if(!h(t))return!0;if(!e)return!1;f(t)}return t[u].weakData},onFreeze:function(t){return c&&p.REQUIRED&&h(t)&&!i(t,u)&&f(t),t}};r[u]=!0},function(t,e,n){"use strict";var r=n(31).f,o=n(68),i=n(113),a=n(46),s=n(72),c=n(51),u=n(115),l=n(137),h=n(25),f=n(165).fastKey,p=n(49),d=p.set,v=p.getterFor;t.exports={getConstructor:function(t,e,n,u){var l=t(function(t,r){s(t,l,e),d(t,{type:e,index:o(null),first:void 0,last:void 0,size:0}),h||(t.size=0),null!=r&&c(r,t[u],{that:t,AS_ENTRIES:n})}),p=v(e),g=function(t,e,n){var r,o,i=p(t),a=y(t,e);return a?a.value=n:(i.last=a={index:o=f(e,!0),key:e,value:n,previous:r=i.last,next:void 0,removed:!1},i.first||(i.first=a),r&&(r.next=a),h?i.size++:t.size++,"F"!==o&&(i.index[o]=a)),t},y=function(t,e){var n,r=p(t),o=f(e);if("F"!==o)return r.index[o];for(n=r.first;n;n=n.next)if(n.key==e)return n};return i(l.prototype,{clear:function(){for(var t=p(this),e=t.index,n=t.first;n;)n.removed=!0,n.previous&&(n.previous=n.previous.next=void 0),delete e[n.index],n=n.next;t.first=t.last=void 0,h?t.size=0:this.size=0},delete:function(t){var e=p(this),n=y(this,t);if(n){var r=n.next,o=n.previous;delete e.index[n.index],n.removed=!0,o&&(o.next=r),r&&(r.previous=o),e.first==n&&(e.first=r),e.last==n&&(e.last=o),h?e.size--:this.size--}return!!n},forEach:function(t){for(var e,n=p(this),r=a(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.next:n.first;)for(r(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!y(this,t)}}),i(l.prototype,n?{get:function(t){var e=y(this,t);return e&&e.value},set:function(t,e){return g(this,0===t?0:t,e)}}:{add:function(t){return g(this,t=0===t?0:t,t)}}),h&&r(l.prototype,"size",{get:function(){return p(this).size}}),l},setStrong:function(t,e,n){var r=e+" Iterator",o=v(e),i=v(r);u(t,e,function(t,e){d(this,{type:r,target:t,state:o(t),kind:e,last:void 0})},function(){for(var t=i(this),e=t.kind,n=t.last;n&&n.removed;)n=n.previous;return t.target&&(t.last=n=n?n.next:t.state.first)?"keys"==e?{value:n.key,done:!1}:"values"==e?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(t.target=void 0,{value:void 0,done:!0})},n?"entries":"values",!n,!0),l(e)}}},function(t,e,n){var r=n(27),o=n(71);t.exports=function(t){var e=o(t);if("function"!=typeof e)throw TypeError(String(t)+" is not iterable");return r(e.call(t))}},function(t,e,n){t.exports=n(264)},function(t,e,n){var r=n(284);t.exports=function(t){if(r(t))throw TypeError("The method doesn't accept regular expressions");return t}},function(t,e,n){var r=n(13)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(n){try{return e[r]=!1,"/./"[t](e)}catch(t){}}return!1}},function(t,e,n){var r=n(17),o=n(13),i=n(47),a=o("iterator");t.exports=!r(function(){var t=new URL("b?a=1&b=2&c=3","http://a"),e=t.searchParams,n="";return t.pathname="c%20d",e.forEach(function(t,r){e.delete("b"),n+=r+t}),i&&!t.toJSON||!e.sort||"http://a/c%20d?a=1&c=3"!==t.href||"3"!==e.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!e[a]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://тест").host||"#%D0%B1"!==new URL("http://a#б").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host})},function(t,e,n){"use strict";n(94);var r=n(8),o=n(39),i=n(171),a=n(54),s=n(113),c=n(48),u=n(147),l=n(49),h=n(72),f=n(26),p=n(46),d=n(53),v=n(27),g=n(21),y=n(68),C=n(50),x=n(167),w=n(71),m=n(13),k=o("fetch"),S=o("Headers"),b=m("iterator"),P=l.set,E=l.getterFor("URLSearchParams"),A=l.getterFor("URLSearchParamsIterator"),R=/\+/g,I=Array(4),D=function(t){return I[t-1]||(I[t-1]=RegExp("((?:%[\\da-f]{2}){"+t+"})","gi"))},T=function(t){try{return decodeURIComponent(t)}catch(e){return t}},L=function(t){var e=t.replace(R," "),n=4;try{return decodeURIComponent(e)}catch(t){for(;n;)e=e.replace(D(n--),T);return e}},F=/[!'()~]|%20/g,O={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},M=function(t){return O[t]},U=function(t){return encodeURIComponent(t).replace(F,M)},N=function(t,e){if(e)for(var n,r,o=e.split("&"),i=0;i<o.length;)(n=o[i++]).length&&(r=n.split("="),t.push({key:L(r.shift()),value:L(r.join("="))}))},B=function(t){this.entries.length=0,N(this.entries,t)},_=function(t,e){if(t<e)throw TypeError("Not enough arguments")},z=u(function(t,e){P(this,{type:"URLSearchParamsIterator",iterator:x(E(t).entries),kind:e})},"Iterator",function(){var t=A(this),e=t.kind,n=t.iterator.next(),r=n.value;return n.done||(n.value="keys"===e?r.key:"values"===e?r.value:[r.key,r.value]),n}),j=function(){h(this,j,"URLSearchParams");var t,e,n,r,o,i,a,s,c,u=arguments.length>0?arguments[0]:void 0,l=[];if(P(this,{type:"URLSearchParams",entries:l,updateURL:function(){},updateSearchParams:B}),void 0!==u)if(g(u))if("function"==typeof(t=w(u)))for(n=(e=t.call(u)).next;!(r=n.call(e)).done;){if((a=(i=(o=x(v(r.value))).next).call(o)).done||(s=i.call(o)).done||!i.call(o).done)throw TypeError("Expected sequence with length 2");l.push({key:a.value+"",value:s.value+""})}else for(c in u)f(u,c)&&l.push({key:c,value:u[c]+""});else N(l,"string"==typeof u?"?"===u.charAt(0)?u.slice(1):u:u+"")},q=j.prototype;s(q,{append:function(t,e){_(arguments.length,2);var n=E(this);n.entries.push({key:t+"",value:e+""}),n.updateURL()},delete:function(t){_(arguments.length,1);for(var e=E(this),n=e.entries,r=t+"",o=0;o<n.length;)n[o].key===r?n.splice(o,1):o++;e.updateURL()},get:function(t){_(arguments.length,1);for(var e=E(this).entries,n=t+"",r=0;r<e.length;r++)if(e[r].key===n)return e[r].value;return null},getAll:function(t){_(arguments.length,1);for(var e=E(this).entries,n=t+"",r=[],o=0;o<e.length;o++)e[o].key===n&&r.push(e[o].value);return r},has:function(t){_(arguments.length,1);for(var e=E(this).entries,n=t+"",r=0;r<e.length;)if(e[r++].key===n)return!0;return!1},set:function(t,e){_(arguments.length,1);for(var n,r=E(this),o=r.entries,i=!1,a=t+"",s=e+"",c=0;c<o.length;c++)(n=o[c]).key===a&&(i?o.splice(c--,1):(i=!0,n.value=s));i||o.push({key:a,value:s}),r.updateURL()},sort:function(){var t,e,n,r=E(this),o=r.entries,i=o.slice();for(o.length=0,n=0;n<i.length;n++){for(t=i[n],e=0;e<n;e++)if(o[e].key>t.key){o.splice(e,0,t);break}e===n&&o.push(t)}r.updateURL()},forEach:function(t){for(var e,n=E(this).entries,r=p(t,arguments.length>1?arguments[1]:void 0,3),o=0;o<n.length;)r((e=n[o++]).value,e.key,this)},keys:function(){return new z(this,"keys")},values:function(){return new z(this,"values")},entries:function(){return new z(this,"entries")}},{enumerable:!0}),a(q,b,q.entries),a(q,"toString",function(){for(var t,e=E(this).entries,n=[],r=0;r<e.length;)t=e[r++],n.push(U(t.key)+"="+U(t.value));return n.join("&")},{enumerable:!0}),c(j,"URLSearchParams"),r({global:!0,forced:!i},{URLSearchParams:j}),i||"function"!=typeof k||"function"!=typeof S||r({global:!0,enumerable:!0,forced:!0},{fetch:function(t){var e,n,r,o=[t];return arguments.length>1&&(g(e=arguments[1])&&(n=e.body,"URLSearchParams"===d(n)&&((r=e.headers?new S(e.headers):new S).has("content-type")||r.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),e=y(e,{body:C(0,String(n)),headers:C(0,r)}))),o.push(e)),k.apply(this,o)}}),t.exports={URLSearchParams:j,getState:E}},function(t,e,n){t.exports=n(312)},function(t,e,n){t.exports=n(326)},function(t,e,n){t.exports=n(333)},function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return v});var r=n(4),o=n.n(r),i=n(22),a=n.n(i),s=n(2),c=n.n(s),u=n(5),l=n.n(u),h=n(0),f=n.n(h),p=n(66),d=n(10),v=function(){function e(t,n){var r=this;c()(this,e),f()(this,"p2pContext",void 0),f()(this,"lackedDataArray",void 0),f()(this,"currentShareDataLMQueue",void 0),f()(this,"lastestShareDataArray",void 0),f()(this,"sched",void 0),f()(this,"fetchControlIntervalId",void 0),f()(this,"shareControlIntervalId",void 0),f()(this,"lastestShareSliceIds",new a.a),f()(this,"intervalMSChangeId",void 0),this.p2pContext=t,this.sched=n,this.lackedDataArray=new Array(this.p2pContext.Config.sliceCount),this.currentShareDataLMQueue=new p.a(this.p2pContext.Config.p2pFetchDataObCycleCount),this.lastestShareDataArray=new Array(this.p2pContext.Config.sliceCount);for(var o=0;o<this.p2pContext.Config.sliceCount;++o)this.lackedDataArray[o]=new p.a(this.p2pContext.Config.p2pFetchDataObCycleCount),this.lastestShareDataArray[o]=new p.a(this.p2pContext.Config.p2pShareDataObCycleCount);this.startSliceIdControl(),this.intervalMSChangeId=t.sliceIdAutoChangeIntervalSignal.connect(function(){r.startSliceIdControl()})}return l()(e,[{key:"startSliceIdControl",value:function(){var e=this;this.stopSliceIdControl(),this.fetchControlIntervalId=t.setInterval(function(){e.checkFetch()},this.p2pContext.Config.p2pSliceIdControlFetchCheckIntervalMs),this.shareControlIntervalId=t.setInterval(function(){e.checkShare()},this.p2pContext.Config.p2pSliceIdControlShareCheckIntervalMs)}},{key:"stopSliceIdControl",value:function(){void 0!==this.fetchControlIntervalId&&(clearInterval(this.fetchControlIntervalId),this.fetchControlIntervalId=void 0),void 0!==this.shareControlIntervalId&&(clearInterval(this.shareControlIntervalId),this.shareControlIntervalId=void 0),this.currentShareDataLMQueue.clear();for(var t=0;t<this.p2pContext.Config.sliceCount;++t)this.lackedDataArray[t].clear(),this.lastestShareDataArray[t].clear()}},{key:"addFragmentFetchData",value:function(t){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){if(!this.isSame(this.sched.getSliceIds(),t.getSliceIds())){void 0!==this.fetchControlIntervalId&&this.checkFetch();for(var e=0;e<this.p2pContext.Config.sliceCount;++e)this.lackedDataArray[e].clear(),this.currentShareDataLMQueue.clear()}for(e=0;e<this.p2pContext.Config.sliceCount;++e)this.lackedDataArray[e].push(t.getRoleRatioForSlice(d.a.LACKED,e));this.currentShareDataLMQueue.push(t.getSharedRatio())}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"isSame",value:function(t,e){if(t.size==e.size){var n=!0;return o()(t).call(t,function(t){e.has(t)||(n=!1)}),n}return!1}},{key:"addFragmentShareData",value:function(t){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){var e=!0;if(void 0!==this.lastestShareSliceIds&&(e=this.isSame(this.lastestShareSliceIds,t.getSliceIds())),!e){void 0!==this.shareControlIntervalId&&this.checkShare();for(var n=0;n<this.p2pContext.Config.sliceCount;++n)this.lastestShareDataArray[n].clear()}for(n=0;n<this.p2pContext.Config.sliceCount;++n)this.lastestShareDataArray[n].push(t.getSliceSharedRatio(n));this.lastestShareSliceIds=t.getSliceIds()}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"checkFetch",value:function(){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){if(!(this.lackedDataArray[0].size()<this.p2pContext.Config.p2pFetchDataObCycleCount))for(var t=0;t<this.p2pContext.Config.sliceCount;++t){var e,n,r=0;o()(e=this.lackedDataArray[t]).call(e,function(t){r+=t}),r/=this.lackedDataArray[t].size();var i=0;o()(n=this.currentShareDataLMQueue).call(n,function(t){i+=t}),i/=this.currentShareDataLMQueue.size(),!this.sched.getSliceIds().has(t)&&i<this.p2pContext.Config.p2pShareLargestAllowedFetchRatio*this.p2pContext.Config.fragmentShareOverride&&r>=this.p2pContext.Config.p2pFetchLowestRatio&&(this.p2pContext.printExtLog(4,"fetch: want to add "+t),this.p2pContext.Config.allowPrintLog(4)&&console.log("fetch: want to add "+t),Math.random()<this.p2pContext.Config.p2pAddSliceProbability&&this.sched.addSliceId(t))}}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"checkShare",value:function(){if(void 0===this.p2pContext.PeerSched||0!=this.p2pContext.PeerSched.getConnectedPeers().length){if(!(this.lastestShareDataArray[0].size()<this.p2pContext.Config.p2pShareDataObCycleCount))for(var t=0;t<this.p2pContext.Config.sliceCount;++t){var e,n=0;o()(e=this.lastestShareDataArray[t]).call(e,function(t){n+=t}),n/=this.lastestShareDataArray[t].size(),this.lastestShareSliceIds.has(t)&&n<=this.p2pContext.Config.p2pShareLowestRatio&&(this.p2pContext.printExtLog(4,"share: want to delete "+t),this.p2pContext.Config.allowPrintLog(4)&&console.log("share: want to delete "+t),Math.random()<this.p2pContext.Config.p2pDeleteSliceProbability&&this.sched.deleteSliceId(t))}}else this.p2pContext.PeerSched.getSliceIds().clear()}},{key:"destroy",value:function(){this.stopSliceIdControl(),void 0!==this.intervalMSChangeId&&this.p2pContext.sliceIdAutoChangeIntervalSignal.disconnect(this.intervalMSChangeId)}}]),e}()}).call(this,n(83))},function(t,e,n){var r=n(60),o="["+n(123)+"]",i=RegExp("^"+o+o+"*"),a=RegExp(o+o+"*$"),s=function(t){return function(e){var n=String(r(e));return 1&t&&(n=n.replace(i,"")),2&t&&(n=n.replace(a,"")),n}};t.exports={start:s(1),end:s(2),trim:s(3)}},,function(t,e,n){var r=n(180);t.exports=r},function(t,e,n){n(181);var r=n(15);t.exports=r.Number.parseInt},function(t,e,n){var r=n(8),o=n(126);r({target:"Number",stat:!0,forced:Number.parseInt!=o},{parseInt:o})},function(t,e,n){var r=n(183);t.exports=r},function(t,e,n){var r=n(184),o=Array.prototype;t.exports=function(t){var e=t.indexOf;return t===o||t instanceof Array&&e===o.indexOf?r:e}},function(t,e,n){n(185);var r=n(23);t.exports=r("Array").indexOf},function(t,e,n){"use strict";var r=n(8),o=n(105).indexOf,i=n(81),a=n(45),s=[].indexOf,c=!!s&&1/[1].indexOf(1,-0)<0,u=i("indexOf"),l=a("indexOf",{ACCESSORS:!0,1:0});r({target:"Array",proto:!0,forced:c||!u||!l},{indexOf:function(t){return c?s.apply(this,arguments)||0:o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var r=function(t){"use strict";var e=Object.prototype,n=e.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",a=r.toStringTag||"@@toStringTag";function s(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,n){return t[e]=n}}function c(t,e,n,r){var o=e&&e.prototype instanceof h?e:h,i=Object.create(o.prototype),a=new S(r||[]);return i._invoke=function(t,e,n){var r="suspendedStart";return function(o,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===o)throw i;return{value:void 0,done:!0}}for(n.method=o,n.arg=i;;){var a=n.delegate;if(a){var s=w(a,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var c=u(t,e,n);if("normal"===c.type){if(r=n.done?"completed":"suspendedYield",c.arg===l)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r="completed",n.method="throw",n.arg=c.arg)}}}(t,n,a),i}function u(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(t){return{type:"throw",arg:t}}}t.wrap=c;var l={};function h(){}function f(){}function p(){}var d={};d[o]=function(){return this};var v=Object.getPrototypeOf,g=v&&v(v(b([])));g&&g!==e&&n.call(g,o)&&(d=g);var y=p.prototype=h.prototype=Object.create(d);function C(t){["next","throw","return"].forEach(function(e){s(t,e,function(t){return this._invoke(e,t)})})}function x(t,e){var r;this._invoke=function(o,i){function a(){return new e(function(r,a){!function r(o,i,a,s){var c=u(t[o],t,i);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==typeof h&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){r("next",t,a,s)},function(t){r("throw",t,a,s)}):e.resolve(h).then(function(t){l.value=t,a(l)},function(t){return r("throw",t,a,s)})}s(c.arg)}(o,i,r,a)})}return r=r?r.then(a,a):a()}}function w(t,e){var n=t.iterator[e.method];if(void 0===n){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,w(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=u(n,t.iterator,e.arg);if("throw"===r.type)return e.method="throw",e.arg=r.arg,e.delegate=null,l;var o=r.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function m(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function k(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function S(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(m,this),this.reset(!0)}function b(t){if(t){var e=t[o];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,i=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return i.next=i}}return{next:P}}function P(){return{value:void 0,done:!0}}return f.prototype=y.constructor=p,p.constructor=f,f.displayName=s(p,a,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,p):(t.__proto__=p,s(t,a,"GeneratorFunction")),t.prototype=Object.create(y),t},t.awrap=function(t){return{__await:t}},C(x.prototype),x.prototype[i]=function(){return this},t.AsyncIterator=x,t.async=function(e,n,r,o,i){void 0===i&&(i=Promise);var a=new x(c(e,n,r,o),i);return t.isGeneratorFunction(n)?a:a.next().then(function(t){return t.done?t.value:a.next()})},C(y),s(y,a,"Generator"),y[o]=function(){return this},y.toString=function(){return"[object Generator]"},t.keys=function(t){var e=[];for(var n in t)e.push(n);return e.reverse(),function n(){for(;e.length;){var r=e.pop();if(r in t)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=b,S.prototype={constructor:S,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(k),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),c=n.call(i,"finallyLoc");if(s&&c){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),k(n),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var o=r.arg;k(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:b(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},t}(t.exports);try{regeneratorRuntime=r}catch(t){Function("r","regeneratorRuntime = r")(r)}},function(t,e,n){t.exports=n(188)},function(t,e,n){var r=n(127);n(199),n(200),n(201),n(202),t.exports=r},function(t,e,n){var r=n(14),o=n(30);t.exports=function(t,e){try{o(r,t,e)}catch(n){r[t]=e}return e}},function(t,e,n){var r=n(17);t.exports=!r(function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})},function(t,e,n){var r=n(21);t.exports=function(t){if(!r(t)&&null!==t)throw TypeError("Can't set "+String(t)+" as a prototype");return t}},function(t,e,n){"use strict";var r,o,i,a,s=n(8),c=n(47),u=n(14),l=n(39),h=n(136),f=n(54),p=n(113),d=n(48),v=n(137),g=n(21),y=n(38),C=n(72),x=n(138),w=n(51),m=n(139),k=n(140),S=n(141).set,b=n(194),P=n(143),E=n(195),A=n(73),R=n(92),I=n(49),D=n(125),T=n(13),L=n(91),F=n(93),O=T("species"),M="Promise",U=I.get,N=I.set,B=I.getterFor(M),_=h,z=u.TypeError,j=u.document,q=u.process,W=l("fetch"),V=A.f,Y=V,G=!!(j&&j.createEvent&&u.dispatchEvent),Q="function"==typeof PromiseRejectionEvent,H=D(M,function(){if(x(_)===String(_)){if(66===F)return!0;if(!L&&!Q)return!0}if(c&&!_.prototype.finally)return!0;if(F>=51&&/native code/.test(_))return!1;var t=_.resolve(1),e=function(t){t(function(){},function(){})};return(t.constructor={})[O]=e,!(t.then(function(){})instanceof e)}),X=H||!m(function(t){_.all(t).catch(function(){})}),K=function(t){var e;return!(!g(t)||"function"!=typeof(e=t.then))&&e},J=function(t,e){if(!t.notified){t.notified=!0;var n=t.reactions;b(function(){for(var r=t.value,o=1==t.state,i=0;n.length>i;){var a,s,c,u=n[i++],l=o?u.ok:u.fail,h=u.resolve,f=u.reject,p=u.domain;try{l?(o||(2===t.rejection&&et(t),t.rejection=1),!0===l?a=r:(p&&p.enter(),a=l(r),p&&(p.exit(),c=!0)),a===u.promise?f(z("Promise-chain cycle")):(s=K(a))?s.call(a,h,f):h(a)):f(r)}catch(t){p&&!c&&p.exit(),f(t)}}t.reactions=[],t.notified=!1,e&&!t.rejection&&Z(t)})}},$=function(t,e,n){var r,o;G?((r=j.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),u.dispatchEvent(r)):r={promise:e,reason:n},!Q&&(o=u["on"+t])?o(r):"unhandledrejection"===t&&E("Unhandled promise rejection",n)},Z=function(t){S.call(u,function(){var e,n=t.facade,r=t.value;if(tt(t)&&(e=R(function(){L?q.emit("unhandledRejection",r,n):$("unhandledrejection",n,r)}),t.rejection=L||tt(t)?2:1,e.error))throw e.value})},tt=function(t){return 1!==t.rejection&&!t.parent},et=function(t){S.call(u,function(){var e=t.facade;L?q.emit("rejectionHandled",e):$("rejectionhandled",e,t.value)})},nt=function(t,e,n){return function(r){t(e,r,n)}},rt=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,J(t,!0))},ot=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw z("Promise can't be resolved itself");var r=K(e);r?b(function(){var n={done:!1};try{r.call(e,nt(ot,n,t),nt(rt,n,t))}catch(e){rt(n,e,t)}}):(t.value=e,t.state=1,J(t,!1))}catch(e){rt({done:!1},e,t)}}};H&&(_=function(t){C(this,_,M),y(t),r.call(this);var e=U(this);try{t(nt(ot,e),nt(rt,e))}catch(t){rt(e,t)}},(r=function(t){N(this,{type:M,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=p(_.prototype,{then:function(t,e){var n=B(this),r=V(k(this,_));return r.ok="function"!=typeof t||t,r.fail="function"==typeof e&&e,r.domain=L?q.domain:void 0,n.parent=!0,n.reactions.push(r),0!=n.state&&J(n,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new r,e=U(t);this.promise=t,this.resolve=nt(ot,e),this.reject=nt(rt,e)},A.f=V=function(t){return t===_||t===i?new o(t):Y(t)},c||"function"!=typeof h||(a=h.prototype.then,f(h.prototype,"then",function(t,e){var n=this;return new _(function(t,e){a.call(n,t,e)}).then(t,e)},{unsafe:!0}),"function"==typeof W&&s({global:!0,enumerable:!0,forced:!0},{fetch:function(t){return P(_,W.apply(u,arguments))}}))),s({global:!0,wrap:!0,forced:H},{Promise:_}),d(_,M,!1,!0),v(M),i=l(M),s({target:M,stat:!0,forced:H},{reject:function(t){var e=V(this);return e.reject.call(void 0,t),e.promise}}),s({target:M,stat:!0,forced:c||H},{resolve:function(t){return P(c&&this===i?_:this,t)}}),s({target:M,stat:!0,forced:X},{all:function(t){var e=this,n=V(e),r=n.resolve,o=n.reject,i=R(function(){var n=y(e.resolve),i=[],a=0,s=1;w(t,function(t){var c=a++,u=!1;i.push(void 0),s++,n.call(e,t).then(function(t){u||(u=!0,i[c]=t,--s||r(i))},o)}),--s||r(i)});return i.error&&o(i.value),n.promise},race:function(t){var e=this,n=V(e),r=n.reject,o=R(function(){var o=y(e.resolve);w(t,function(t){o.call(e,t).then(n.resolve,r)})});return o.error&&r(o.value),n.promise}})},function(t,e,n){"use strict";var r=n(112),o=n(53);t.exports=r?{}.toString:function(){return"[object "+o(this)+"]"}},function(t,e,n){var r,o,i,a,s,c,u,l,h=n(14),f=n(84).f,p=n(141).set,d=n(142),v=n(91),g=h.MutationObserver||h.WebKitMutationObserver,y=h.document,C=h.process,x=h.Promise,w=f(h,"queueMicrotask"),m=w&&w.value;m||(r=function(){var t,e;for(v&&(t=C.domain)&&t.exit();o;){e=o.fn,o=o.next;try{e()}catch(t){throw o?a():i=void 0,t}}i=void 0,t&&t.enter()},!d&&!v&&g&&y?(s=!0,c=y.createTextNode(""),new g(r).observe(c,{characterData:!0}),a=function(){c.data=s=!s}):x&&x.resolve?(u=x.resolve(void 0),l=u.then,a=function(){l.call(u,r)}):a=v?function(){C.nextTick(r)}:function(){p.call(h,r)}),t.exports=m||function(t){var e={fn:t,next:void 0};i&&(i.next=e),o||(o=e,a()),i=e}},function(t,e,n){var r=n(14);t.exports=function(t,e){var n=r.console;n&&n.error&&(1===arguments.length?n.error(t):n.error(t,e))}},function(t,e,n){var r=n(14),o=n(138),i=r.WeakMap;t.exports="function"==typeof i&&/native code/.test(o(i))},function(t,e,n){"use strict";var r=n(8),o=n(47),i=n(136),a=n(17),s=n(39),c=n(140),u=n(143),l=n(54);r({target:"Promise",proto:!0,real:!0,forced:!!i&&a(function(){i.prototype.finally.call({then:function(){}},function(){})})},{finally:function(t){var e=c(this,s("Promise")),n="function"==typeof t;return this.then(n?function(n){return u(e,t()).then(function(){return n})}:t,n?function(n){return u(e,t()).then(function(){throw n})}:t)}}),o||"function"!=typeof i||i.prototype.finally||l(i.prototype,"finally",s("Promise").prototype.finally)},function(t,e){t.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},function(t,e,n){n(128)},function(t,e,n){n(144)},function(t,e,n){"use strict";var r=n(8),o=n(73),i=n(92);r({target:"Promise",stat:!0},{try:function(t){var e=o.f(this),n=i(t);return(n.error?e.reject:e.resolve)(n.value),e.promise}})},function(t,e,n){n(145)},function(t,e,n){var r=n(127);t.exports=r},function(t,e,n){var r=n(149);t.exports=r},function(t,e,n){n(206);var r=n(23);t.exports=r("Array").slice},function(t,e,n){"use strict";var r=n(8),o=n(21),i=n(61),a=n(106),s=n(28),c=n(44),u=n(74),l=n(13),h=n(75),f=n(45),p=h("slice"),d=f("slice",{ACCESSORS:!0,0:0,1:2}),v=l("species"),g=[].slice,y=Math.max;r({target:"Array",proto:!0,forced:!p||!d},{slice:function(t,e){var n,r,l,h=c(this),f=s(h.length),p=a(t,f),d=a(void 0===e?f:e,f);if(i(h)&&("function"!=typeof(n=h.constructor)||n!==Array&&!i(n.prototype)?o(n)&&null===(n=n[v])&&(n=void 0):n=void 0,n===Array||void 0===n))return g.call(h,p,d);for(r=new(void 0===n?Array:n)(y(d-p,0)),l=0;p<d;p++,l++)p in h&&u(r,l,h[p]);return r.length=l,r}})},function(t,e,n){n(150);var r=n(15);t.exports=r.setTimeout},function(t,e,n){n(41);var r=n(209),o=n(53),i=Array.prototype,a={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var e=t.forEach;return t===i||t instanceof Array&&e===i.forEach||a.hasOwnProperty(o(t))?r:e}},function(t,e,n){var r=n(210);t.exports=r},function(t,e,n){n(211);var r=n(23);t.exports=r("Array").forEach},function(t,e,n){"use strict";var r=n(8),o=n(212);r({target:"Array",proto:!0,forced:[].forEach!=o},{forEach:o})},function(t,e,n){"use strict";var r=n(76).forEach,o=n(81),i=n(45),a=o("forEach"),s=i("forEach");t.exports=a&&s?[].forEach:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}},function(t,e,n){var r=n(151),o=n(153);t.exports=function(t){if(r(t))return o(t)}},function(t,e,n){var r=n(152);t.exports=r},function(t,e,n){n(8)({target:"Array",stat:!0},{isArray:n(61)})},function(t,e,n){var r=n(154),o=n(157),i=n(117);t.exports=function(t){if(void 0!==i&&o(Object(t)))return r(t)}},function(t,e,n){var r=n(155);t.exports=r},function(t,e,n){var r=n(8),o=n(156);r({target:"Array",stat:!0,forced:!n(139)(function(t){Array.from(t)})},{from:o})},function(t,e,n){var r=n(27),o=n(135);t.exports=function(t,e,n,i){try{return i?e(r(n)[0],n[1]):e(n)}catch(e){throw o(t),e}}},function(t,e,n){n(41),n(40);var r=n(221);t.exports=r},function(t,e,n){var r=n(53),o=n(13),i=n(52),a=o("iterator");t.exports=function(t){var e=Object(t);return void 0!==e[a]||"@@iterator"in e||i.hasOwnProperty(r(e))}},function(t,e,n){var r=n(158);n(241),n(242),n(243),n(244),n(245),t.exports=r},function(t,e,n){"use strict";var r=n(8),o=n(14),i=n(39),a=n(47),s=n(25),c=n(111),u=n(134),l=n(17),h=n(26),f=n(61),p=n(21),d=n(27),v=n(32),g=n(44),y=n(87),C=n(50),x=n(68),w=n(69),m=n(160),k=n(224),S=n(161),b=n(84),P=n(31),E=n(85),A=n(30),R=n(54),I=n(108),D=n(88),T=n(70),L=n(89),F=n(13),O=n(118),M=n(18),U=n(48),N=n(49),B=n(76).forEach,_=D("hidden"),z=F("toPrimitive"),j=N.set,q=N.getterFor("Symbol"),W=Object.prototype,V=o.Symbol,Y=i("JSON","stringify"),G=b.f,Q=P.f,H=k.f,X=E.f,K=I("symbols"),J=I("op-symbols"),$=I("string-to-symbol-registry"),Z=I("symbol-to-string-registry"),tt=I("wks"),et=o.QObject,nt=!et||!et.prototype||!et.prototype.findChild,rt=s&&l(function(){return 7!=x(Q({},"a",{get:function(){return Q(this,"a",{value:7}).a}})).a})?function(t,e,n){var r=G(W,e);r&&delete W[e],Q(t,e,n),r&&t!==W&&Q(W,e,r)}:Q,ot=function(t,e){var n=K[t]=x(V.prototype);return j(n,{type:"Symbol",tag:t,description:e}),s||(n.description=e),n},it=u?function(t){return"symbol"==typeof t}:function(t){return Object(t)instanceof V},at=function(t,e,n){t===W&&at(J,e,n),d(t);var r=y(e,!0);return d(n),h(K,r)?(n.enumerable?(h(t,_)&&t[_][r]&&(t[_][r]=!1),n=x(n,{enumerable:C(0,!1)})):(h(t,_)||Q(t,_,C(1,{})),t[_][r]=!0),rt(t,r,n)):Q(t,r,n)},st=function(t,e){d(t);var n=g(e),r=w(n).concat(ht(n));return B(r,function(e){s&&!ct.call(n,e)||at(t,e,n[e])}),t},ct=function(t){var e=y(t,!0),n=X.call(this,e);return!(this===W&&h(K,e)&&!h(J,e))&&(!(n||!h(this,e)||!h(K,e)||h(this,_)&&this[_][e])||n)},ut=function(t,e){var n=g(t),r=y(e,!0);if(n!==W||!h(K,r)||h(J,r)){var o=G(n,r);return!o||!h(K,r)||h(n,_)&&n[_][r]||(o.enumerable=!0),o}},lt=function(t){var e=H(g(t)),n=[];return B(e,function(t){h(K,t)||h(T,t)||n.push(t)}),n},ht=function(t){var e=t===W,n=H(e?J:g(t)),r=[];return B(n,function(t){!h(K,t)||e&&!h(W,t)||r.push(K[t])}),r};c||(R((V=function(){if(this instanceof V)throw TypeError("Symbol is not a constructor");var t=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,e=L(t),n=function(t){this===W&&n.call(J,t),h(this,_)&&h(this[_],e)&&(this[_][e]=!1),rt(this,e,C(1,t))};return s&&nt&&rt(W,e,{configurable:!0,set:n}),ot(e,t)}).prototype,"toString",function(){return q(this).tag}),R(V,"withoutSetter",function(t){return ot(L(t),t)}),E.f=ct,P.f=at,b.f=ut,m.f=k.f=lt,S.f=ht,O.f=function(t){return ot(F(t),t)},s&&(Q(V.prototype,"description",{configurable:!0,get:function(){return q(this).description}}),a||R(W,"propertyIsEnumerable",ct,{unsafe:!0}))),r({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:V}),B(w(tt),function(t){M(t)}),r({target:"Symbol",stat:!0,forced:!c},{for:function(t){var e=String(t);if(h($,e))return $[e];var n=V(e);return $[e]=n,Z[n]=e,n},keyFor:function(t){if(!it(t))throw TypeError(t+" is not a symbol");if(h(Z,t))return Z[t]},useSetter:function(){nt=!0},useSimple:function(){nt=!1}}),r({target:"Object",stat:!0,forced:!c,sham:!s},{create:function(t,e){return void 0===e?x(t):st(x(t),e)},defineProperty:at,defineProperties:st,getOwnPropertyDescriptor:ut}),r({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:lt,getOwnPropertySymbols:ht}),r({target:"Object",stat:!0,forced:l(function(){S.f(1)})},{getOwnPropertySymbols:function(t){return S.f(v(t))}}),Y&&r({target:"JSON",stat:!0,forced:!c||l(function(){var t=V();return"[null]"!=Y([t])||"{}"!=Y({a:t})||"{}"!=Y(Object(t))})},{stringify:function(t,e,n){for(var r,o=[t],i=1;arguments.length>i;)o.push(arguments[i++]);if(r=e,(p(e)||void 0!==t)&&!it(t))return f(e)||(e=function(t,e){if("function"==typeof r&&(e=r.call(this,t,e)),!it(e))return e}),o[1]=e,Y.apply(null,o)}}),V.prototype[z]||A(V.prototype,z,V.prototype.valueOf),U(V,"Symbol"),T[_]=!0},function(t,e,n){var r=n(44),o=n(160).f,i={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return a&&"[object Window]"==i.call(t)?function(t){try{return o(t)}catch(t){return a.slice()}}(t):o(r(t))}},function(t,e,n){n(18)("asyncIterator")},function(t,e){},function(t,e,n){n(18)("hasInstance")},function(t,e,n){n(18)("isConcatSpreadable")},function(t,e,n){n(18)("match")},function(t,e,n){n(18)("matchAll")},function(t,e,n){n(18)("replace")},function(t,e,n){n(18)("search")},function(t,e,n){n(18)("species")},function(t,e,n){n(18)("split")},function(t,e,n){n(18)("toPrimitive")},function(t,e,n){n(18)("toStringTag")},function(t,e,n){n(18)("unscopables")},function(t,e,n){var r=n(14);n(48)(r.JSON,"JSON",!0)},function(t,e){},function(t,e){},function(t,e,n){n(18)("asyncDispose")},function(t,e,n){n(18)("dispose")},function(t,e,n){n(18)("observable")},function(t,e,n){n(18)("patternMatch")},function(t,e,n){n(18)("replaceAll")},function(t,e,n){t.exports=n(247)},function(t,e,n){var r=n(149);t.exports=r},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){var r=n(250);t.exports=r},function(t,e,n){n(251);var r=n(15);r.JSON||(r.JSON={stringify:JSON.stringify}),t.exports=function(t,e,n){return r.JSON.stringify.apply(null,arguments)}},function(t,e,n){var r=n(8),o=n(39),i=n(17),a=o("JSON","stringify"),s=/[\uD800-\uDFFF]/g,c=/^[\uD800-\uDBFF]$/,u=/^[\uDC00-\uDFFF]$/,l=function(t,e,n){var r=n.charAt(e-1),o=n.charAt(e+1);return c.test(t)&&!u.test(o)||u.test(t)&&!c.test(r)?"\\u"+t.charCodeAt(0).toString(16):t},h=i(function(){return'"\\udf06\\ud834"'!==a("\udf06\ud834")||'"\\udead"'!==a("\udead")});a&&r({target:"JSON",stat:!0,forced:h},{stringify:function(t,e,n){var r=a.apply(null,arguments);return"string"==typeof r?r.replace(s,l):r}})},function(t,e,n){var r=n(253);t.exports=r},function(t,e,n){n(254),n(90),n(40),n(41);var r=n(15);t.exports=r.Map},function(t,e,n){"use strict";var r=n(164),o=n(166);t.exports=r("Map",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},o)},function(t,e,n){var r=n(17);t.exports=!r(function(){return Object.isExtensible(Object.preventExtensions({}))})},function(t,e,n){var r=n(151);t.exports=function(t){if(r(t))return t}},function(t,e,n){var r=n(78),o=n(157),i=n(117);t.exports=function(t,e){if(void 0!==i&&o(Object(t))){var n=[],a=!0,s=!1,c=void 0;try{for(var u,l=r(t);!(a=(u=l.next()).done)&&(n.push(u.value),!e||n.length!==e);a=!0);}catch(t){s=!0,c=t}finally{try{a||null==l.return||l.return()}finally{if(s)throw c}}return n}}},function(t,e,n){n(41),n(40);var r=n(167);t.exports=r},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(t,e,n){var r=n(261);t.exports=r},function(t,e,n){n(262);var r=n(15);t.exports=r.Object.entries},function(t,e,n){var r=n(8),o=n(263).entries;r({target:"Object",stat:!0},{entries:function(t){return o(t)}})},function(t,e,n){var r=n(25),o=n(69),i=n(44),a=n(85).f,s=function(t){return function(e){for(var n,s=i(e),c=o(s),u=c.length,l=0,h=[];u>l;)n=c[l++],r&&!a.call(s,n)||h.push(t?[n,s[n]]:s[n]);return h}};t.exports={entries:s(!0),values:s(!1)}},function(t,e,n){var r=n(265);t.exports=r},function(t,e,n){n(266);var r=n(15).Object,o=t.exports=function(t,e,n){return r.defineProperty(t,e,n)};r.defineProperty.sham&&(o.sham=!0)},function(t,e,n){var r=n(8),o=n(25);r({target:"Object",stat:!0,forced:!o,sham:!o},{defineProperty:n(31).f})},function(t,e,n){var r=n(268);t.exports=r},function(t,e,n){n(269);var r=n(15);t.exports=r.parseInt},function(t,e,n){var r=n(8),o=n(126);r({global:!0,forced:parseInt!=o},{parseInt:o})},function(t,e,n){n(150);var r=n(15);t.exports=r.setInterval},function(t,e,n){var r=n(272);t.exports=r},function(t,e,n){n(273),n(90),n(40),n(41);var r=n(15);t.exports=r.Set},function(t,e,n){"use strict";var r=n(164),o=n(166);t.exports=r("Set",function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},o)},function(t,e,n){var r=n(275);t.exports=r},function(t,e,n){n(276);var r=n(15);t.exports=r.Date.now},function(t,e,n){n(8)({target:"Date",stat:!0},{now:function(){return(new Date).getTime()}})},function(t,e,n){var r=n(278);t.exports=r},function(t,e,n){n(279);var r=n(15);t.exports=r.Object.keys},function(t,e,n){var r=n(8),o=n(32),i=n(69);r({target:"Object",stat:!0,forced:n(17)(function(){i(1)})},{keys:function(t){return i(o(t))}})},function(t,e,n){var r=n(281);t.exports=r},function(t,e,n){var r=n(282),o=String.prototype;t.exports=function(t){var e=t.startsWith;return"string"==typeof t||t===o||t instanceof String&&e===o.startsWith?r:e}},function(t,e,n){n(283);var r=n(23);t.exports=r("String").startsWith},function(t,e,n){"use strict";var r,o=n(8),i=n(84).f,a=n(28),s=n(169),c=n(60),u=n(170),l=n(47),h="".startsWith,f=Math.min,p=u("startsWith");o({target:"String",proto:!0,forced:!(!l&&!p&&(r=i(String.prototype,"startsWith"),r&&!r.writable)||p)},{startsWith:function(t){var e=String(c(this));s(t);var n=a(f(arguments.length>1?arguments[1]:void 0,e.length)),r=String(t);return h?h.call(e,r,n):e.slice(n,n+r.length)===r}})},function(t,e,n){var r=n(21),o=n(67),i=n(13)("match");t.exports=function(t){var e;return r(t)&&(void 0!==(e=t[i])?!!e:"RegExp"==o(t))}},function(t,e,n){t.exports=n(286)},function(t,e,n){var r=n(287);t.exports=r},function(t,e,n){n(162),n(40),n(41);var r=n(118);t.exports=r.f("iterator")},function(t,e,n){var r=n(289);t.exports=r},function(t,e,n){var r=n(290),o=n(292),i=Array.prototype,a=String.prototype;t.exports=function(t){var e=t.includes;return t===i||t instanceof Array&&e===i.includes?r:"string"==typeof t||t===a||t instanceof String&&e===a.includes?o:e}},function(t,e,n){n(291);var r=n(23);t.exports=r("Array").includes},function(t,e,n){"use strict";var r=n(8),o=n(105).includes,i=n(116);r({target:"Array",proto:!0,forced:!n(45)("indexOf",{ACCESSORS:!0,1:0})},{includes:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),i("includes")},function(t,e,n){n(293);var r=n(23);t.exports=r("String").includes},function(t,e,n){"use strict";var r=n(8),o=n(169),i=n(60);r({target:"String",proto:!0,forced:!n(170)("includes")},{includes:function(t){return!!~String(i(this)).indexOf(o(t),arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){"use strict";(function(t){var r=n(295),o=n(296),i=n(297);function a(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(a()<e)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=c.prototype:(null===t&&(t=new c(e)),t.length=e),t}function c(t,e,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return h(this,t)}return u(this,t,e,n)}function u(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");return e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r),c.TYPED_ARRAY_SUPPORT?(t=e).__proto__=c.prototype:t=f(t,e),t}(t,e,n,r):"string"==typeof e?function(t,e,n){if("string"==typeof n&&""!==n||(n="utf8"),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(e,n),o=(t=s(t,r)).write(e,n);return o!==r&&(t=t.slice(0,o)),t}(t,e,n):function(t,e){if(c.isBuffer(e)){var n=0|p(e.length);return 0===(t=s(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?s(t,0):f(t,e);if("Buffer"===e.type&&i(e.data))return f(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function h(t,e){if(l(e),t=s(t,e<0?0:0|p(e)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<e;++n)t[n]=0;return t}function f(t,e){var n=e.length<0?0:0|p(e.length);t=s(t,n);for(var r=0;r<n;r+=1)t[r]=255&e[r];return t}function p(t){if(t>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|t}function d(t,e){if(c.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return _(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return z(t).length;default:if(r)return _(t).length;e=(""+e).toLowerCase(),r=!0}}function v(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function g(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=c.from(e,r)),c.isBuffer(e))return 0===e.length?-1:y(t,e,n,r,o);if("number"==typeof e)return e&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):y(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function y(t,e,n,r,o){var i,a=1,s=t.length,c=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;a=2,s/=2,c/=2,n/=2}function u(t,e){return 1===a?t[e]:t.readUInt16BE(e*a)}if(o){var l=-1;for(i=n;i<s;i++)if(u(t,i)===u(e,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===c)return l*a}else-1!==l&&(i-=i-l),l=-1}else for(n+c>s&&(n=s-c),i=n;i>=0;i--){for(var h=!0,f=0;f<c;f++)if(u(t,i+f)!==u(e,f)){h=!1;break}if(h)return i}return-1}function C(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;var i=e.length;if(i%2!=0)throw new TypeError("Invalid hex string");r>i/2&&(r=i/2);for(var a=0;a<r;++a){var s=parseInt(e.substr(2*a,2),16);if(isNaN(s))return a;t[n+a]=s}return a}function x(t,e,n,r){return j(_(e,t.length-n),t,n,r)}function w(t,e,n,r){return j(function(t){for(var e=[],n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}(e),t,n,r)}function m(t,e,n,r){return w(t,e,n,r)}function k(t,e,n,r){return j(z(e),t,n,r)}function S(t,e,n,r){return j(function(t,e){for(var n,r,o,i=[],a=0;a<t.length&&!((e-=2)<0);++a)r=(n=t.charCodeAt(a))>>8,o=n%256,i.push(o),i.push(r);return i}(e,t.length-n),t,n,r)}function b(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function P(t,e,n){n=Math.min(t.length,n);for(var r=[],o=e;o<n;){var i,a,s,c,u=t[o],l=null,h=u>239?4:u>223?3:u>191?2:1;if(o+h<=n)switch(h){case 1:u<128&&(l=u);break;case 2:128==(192&(i=t[o+1]))&&(c=(31&u)<<6|63&i)>127&&(l=c);break;case 3:i=t[o+1],a=t[o+2],128==(192&i)&&128==(192&a)&&(c=(15&u)<<12|(63&i)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:i=t[o+1],a=t[o+2],s=t[o+3],128==(192&i)&&128==(192&a)&&128==(192&s)&&(c=(15&u)<<18|(63&i)<<12|(63&a)<<6|63&s)>65535&&c<1114112&&(l=c)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),o+=h}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);for(var n="",r=0;r<e;)n+=String.fromCharCode.apply(String,t.slice(r,r+=4096));return n}(r)}function E(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(127&t[o]);return r}function A(t,e,n){var r="";n=Math.min(t.length,n);for(var o=e;o<n;++o)r+=String.fromCharCode(t[o]);return r}function R(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=B(t[i]);return o}function I(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function D(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function T(t,e,n,r,o,i){if(!c.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<i)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function L(t,e,n,r){e<0&&(e=65535+e+1);for(var o=0,i=Math.min(t.length-n,2);o<i;++o)t[n+o]=(e&255<<8*(r?o:1-o))>>>8*(r?o:1-o)}function F(t,e,n,r){e<0&&(e=4294967295+e+1);for(var o=0,i=Math.min(t.length-n,4);o<i;++o)t[n+o]=e>>>8*(r?o:3-o)&255}function O(t,e,n,r,o,i){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function M(t,e,n,r,i){return i||O(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function U(t,e,n,r,i){return i||O(t,0,n,8),o.write(t,e,n,r,52,8),n+8}e.Buffer=c,e.SlowBuffer=function(t){return+t!=t&&(t=0),c.alloc(+t)},e.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=a(),c.poolSize=8192,c._augment=function(t){return t.__proto__=c.prototype,t},c.from=function(t,e,n){return u(null,t,e,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(t,e,n){return function(t,e,n,r){return l(e),e<=0?s(t,e):void 0!==n?"string"==typeof r?s(t,e).fill(n,r):s(t,e).fill(n):s(t,e)}(null,t,e,n)},c.allocUnsafe=function(t){return h(null,t)},c.allocUnsafeSlow=function(t){return h(null,t)},c.isBuffer=function(t){return!(null==t||!t._isBuffer)},c.compare=function(t,e){if(!c.isBuffer(t)||!c.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var n=t.length,r=e.length,o=0,i=Math.min(n,r);o<i;++o)if(t[o]!==e[o]){n=t[o],r=e[o];break}return n<r?-1:r<n?1:0},c.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(t,e){if(!i(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return c.alloc(0);var n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;var r=c.allocUnsafe(e),o=0;for(n=0;n<t.length;++n){var a=t[n];if(!c.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,o),o+=a.length}return r},c.byteLength=d,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},c.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},c.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},c.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):function(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return R(this,e,n);case"utf8":case"utf-8":return P(this,e,n);case"ascii":return E(this,e,n);case"latin1":case"binary":return A(this,e,n);case"base64":return b(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}.apply(this,arguments)},c.prototype.equals=function(t){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===c.compare(this,t)},c.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},c.prototype.compare=function(t,e,n,r,o){if(!c.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;for(var i=(o>>>=0)-(r>>>=0),a=(n>>>=0)-(e>>>=0),s=Math.min(i,a),u=this.slice(r,o),l=t.slice(e,n),h=0;h<s;++h)if(u[h]!==l[h]){i=u[h],a=l[h];break}return i<a?-1:a<i?1:0},c.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},c.prototype.indexOf=function(t,e,n){return g(this,t,e,n,!0)},c.prototype.lastIndexOf=function(t,e,n){return g(this,t,e,n,!1)},c.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return C(this,t,e,n);case"utf8":case"utf-8":return x(this,t,e,n);case"ascii":return w(this,t,e,n);case"latin1":case"binary":return m(this,t,e,n);case"base64":return k(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},c.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=c.prototype;else{var o=e-t;n=new c(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+t]}return n},c.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},c.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},c.prototype.readUInt8=function(t,e){return e||D(t,1,this.length),this[t]},c.prototype.readUInt16LE=function(t,e){return e||D(t,2,this.length),this[t]|this[t+1]<<8},c.prototype.readUInt16BE=function(t,e){return e||D(t,2,this.length),this[t]<<8|this[t+1]},c.prototype.readUInt32LE=function(t,e){return e||D(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},c.prototype.readUInt32BE=function(t,e){return e||D(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},c.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*e)),r},c.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||D(t,e,this.length);for(var r=e,o=1,i=this[t+--r];r>0&&(o*=256);)i+=this[t+--r]*o;return i>=(o*=128)&&(i-=Math.pow(2,8*e)),i},c.prototype.readInt8=function(t,e){return e||D(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},c.prototype.readInt16LE=function(t,e){e||D(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(t,e){e||D(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(t,e){return e||D(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},c.prototype.readInt32BE=function(t,e){return e||D(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},c.prototype.readFloatLE=function(t,e){return e||D(t,4,this.length),o.read(this,t,!0,23,4)},c.prototype.readFloatBE=function(t,e){return e||D(t,4,this.length),o.read(this,t,!1,23,4)},c.prototype.readDoubleLE=function(t,e){return e||D(t,8,this.length),o.read(this,t,!0,52,8)},c.prototype.readDoubleBE=function(t,e){return e||D(t,8,this.length),o.read(this,t,!1,52,8)},c.prototype.writeUIntLE=function(t,e,n,r){t=+t,e|=0,n|=0,r||T(this,t,e,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},c.prototype.writeUIntBE=function(t,e,n,r){t=+t,e|=0,n|=0,r||T(this,t,e,n,Math.pow(2,8*n)-1,0);var o=n-1,i=1;for(this[e+o]=255&t;--o>=0&&(i*=256);)this[e+o]=t/i&255;return e+n},c.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,1,255,0),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},c.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},c.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},c.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):F(this,t,e,!0),e+4},c.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):F(this,t,e,!1),e+4},c.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);T(this,t,e,n,o-1,-o)}var i=0,a=1,s=0;for(this[e]=255&t;++i<n&&(a*=256);)t<0&&0===s&&0!==this[e+i-1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+n},c.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);T(this,t,e,n,o-1,-o)}var i=n-1,a=1,s=0;for(this[e+i]=255&t;--i>=0&&(a*=256);)t<0&&0===s&&0!==this[e+i+1]&&(s=1),this[e+i]=(t/a>>0)-s&255;return e+n},c.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,1,127,-128),c.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},c.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):L(this,t,e,!0),e+2},c.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):L(this,t,e,!1),e+2},c.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):F(this,t,e,!0),e+4},c.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||T(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),c.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):F(this,t,e,!1),e+4},c.prototype.writeFloatLE=function(t,e,n){return M(this,t,e,!0,n)},c.prototype.writeFloatBE=function(t,e,n){return M(this,t,e,!1,n)},c.prototype.writeDoubleLE=function(t,e,n){return U(this,t,e,!0,n)},c.prototype.writeDoubleBE=function(t,e,n){return U(this,t,e,!1,n)},c.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var o,i=r-n;if(this===t&&n<e&&e<r)for(o=i-1;o>=0;--o)t[o+e]=this[o+n];else if(i<1e3||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<i;++o)t[o+e]=this[o+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+i),e);return i},c.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var o=t.charCodeAt(0);o<256&&(t=o)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{var a=c.isBuffer(t)?t:_(new c(t,r).toString()),s=a.length;for(i=0;i<n-e;++i)this[i+e]=a[i%s]}return this};var N=/[^+\/0-9A-Za-z-_]/g;function B(t){return t<16?"0"+t.toString(16):t.toString(16)}function _(t,e){var n;e=e||1/0;for(var r=t.length,o=null,i=[],a=0;a<r;++a){if((n=t.charCodeAt(a))>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&i.push(239,191,189);continue}if(a+1===r){(e-=3)>-1&&i.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&i.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&i.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;i.push(n)}else if(n<2048){if((e-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function z(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(N,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function j(t,e,n,r){for(var o=0;o<r&&!(o+n>=e.length||o>=t.length);++o)e[o+n]=t[o];return o}}).call(this,n(83))},function(t,e,n){"use strict";e.byteLength=function(t){var e=u(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,n,r=u(t),a=r[0],s=r[1],c=new i(3*(a+s)/4-s),l=0,h=s>0?a-4:a;for(n=0;n<h;n+=4)e=o[t.charCodeAt(n)]<<18|o[t.charCodeAt(n+1)]<<12|o[t.charCodeAt(n+2)]<<6|o[t.charCodeAt(n+3)],c[l++]=e>>16&255,c[l++]=e>>8&255,c[l++]=255&e;return 2===s&&(e=o[t.charCodeAt(n)]<<2|o[t.charCodeAt(n+1)]>>4,c[l++]=255&e),1===s&&(e=o[t.charCodeAt(n)]<<10|o[t.charCodeAt(n+1)]<<4|o[t.charCodeAt(n+2)]>>2,c[l++]=e>>8&255,c[l++]=255&e),c},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,i=[],a=0,s=n-o;a<s;a+=16383)i.push(l(t,a,a+16383>s?s:a+16383));return 1===o?(e=t[n-1],i.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],i.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),i.join("")};for(var r=[],o=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,c=a.length;s<c;++s)r[s]=a[s],o[a.charCodeAt(s)]=s;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function l(t,e,n){for(var o,i,a=[],s=e;s<n;s+=3)o=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),a.push(r[(i=o)>>18&63]+r[i>>12&63]+r[i>>6&63]+r[63&i]);return a.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},function(t,e){e.read=function(t,e,n,r,o){var i,a,s=8*o-r-1,c=(1<<s)-1,u=c>>1,l=-7,h=n?o-1:0,f=n?-1:1,p=t[e+h];for(h+=f,i=p&(1<<-l)-1,p>>=-l,l+=s;l>0;i=256*i+t[e+h],h+=f,l-=8);for(a=i&(1<<-l)-1,i>>=-l,l+=r;l>0;a=256*a+t[e+h],h+=f,l-=8);if(0===i)i=1-u;else{if(i===c)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),i-=u}return(p?-1:1)*a*Math.pow(2,i-r)},e.write=function(t,e,n,r,o,i){var a,s,c,u=8*i-o-1,l=(1<<u)-1,h=l>>1,f=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-a))<1&&(a--,c*=2),(e+=a+h>=1?f/c:f*Math.pow(2,1-h))*c>=2&&(a++,c/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(e*c-1)*Math.pow(2,o),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,o),a=0));o>=8;t[n+p]=255&s,p+=d,s/=256,o-=8);for(a=a<<o|s,u+=o;u>0;t[n+p]=255&a,p+=d,a/=256,u-=8);t[n+p-d]|=128*v}},function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},function(t,e,n){var r=n(152);t.exports=r},function(t,e,n){n(41),n(40);var r=n(71);t.exports=r},function(t,e,n){var r=n(158);t.exports=r},function(t,e,n){var r=n(155);t.exports=r},function(t,e,n){var r=n(303);t.exports=r},function(t,e,n){var r=n(304),o=Array.prototype;t.exports=function(t){var e=t.splice;return t===o||t instanceof Array&&e===o.splice?r:e}},function(t,e,n){n(305);var r=n(23);t.exports=r("Array").splice},function(t,e,n){"use strict";var r=n(8),o=n(106),i=n(80),a=n(28),s=n(32),c=n(95),u=n(74),l=n(75),h=n(45),f=l("splice"),p=h("splice",{ACCESSORS:!0,0:0,1:2}),d=Math.max,v=Math.min;r({target:"Array",proto:!0,forced:!f||!p},{splice:function(t,e){var n,r,l,h,f,p,g=s(this),y=a(g.length),C=o(t,y),x=arguments.length;if(0===x?n=r=0:1===x?(n=0,r=y-C):(n=x-2,r=v(d(i(e),0),y-C)),y+n-r>9007199254740991)throw TypeError("Maximum allowed length exceeded");for(l=c(g,r),h=0;h<r;h++)(f=C+h)in g&&u(l,h,g[f]);if(l.length=r,n<r){for(h=C;h<y-r;h++)p=h+n,(f=h+r)in g?g[p]=g[f]:delete g[p];for(h=y;h>y-r+n;h--)delete g[h-1]}else if(n>r)for(h=y-r;h>C;h--)p=h+n-1,(f=h+r-1)in g?g[p]=g[f]:delete g[p];for(h=0;h<n;h++)g[h+C]=arguments[h+2];return g.length=y-r+n,l}})},function(t,e,n){var r=n(307);t.exports=r},function(t,e,n){var r=n(308),o=Array.prototype;t.exports=function(t){var e=t.concat;return t===o||t instanceof Array&&e===o.concat?r:e}},function(t,e,n){n(159);var r=n(23);t.exports=r("Array").concat},function(t,e,n){n(41);var r=n(310),o=n(53),i=Array.prototype,a={DOMTokenList:!0,NodeList:!0};t.exports=function(t){var e=t.values;return t===i||t instanceof Array&&e===i.values||a.hasOwnProperty(o(t))?r:e}},function(t,e,n){var r=n(311);t.exports=r},function(t,e,n){n(94);var r=n(23);t.exports=r("Array").values},function(t,e,n){var r=n(313);t.exports=r},function(t,e,n){var r=n(314),o=Array.prototype;t.exports=function(t){var e=t.flatMap;return t===o||t instanceof Array&&e===o.flatMap?r:e}},function(t,e,n){n(315),n(317);var r=n(23);t.exports=r("Array").flatMap},function(t,e,n){"use strict";var r=n(8),o=n(316),i=n(32),a=n(28),s=n(38),c=n(95);r({target:"Array",proto:!0},{flatMap:function(t){var e,n=i(this),r=a(n.length);return s(t),(e=c(n,0)).length=o(e,n,n,r,0,1,t,arguments.length>1?arguments[1]:void 0),e}})},function(t,e,n){"use strict";var r=n(61),o=n(28),i=n(46),a=function(t,e,n,s,c,u,l,h){for(var f,p=c,d=0,v=!!l&&i(l,h,3);d<s;){if(d in n){if(f=v?v(n[d],d,e):n[d],u>0&&r(f))p=a(t,e,f,o(f.length),p,u-1)-1;else{if(p>=9007199254740991)throw TypeError("Exceed the acceptable array length");t[p]=f}p++}d++}return p};t.exports=a},function(t,e,n){n(116)("flatMap")},function(t,e,n){var r=n(319);t.exports=r},function(t,e,n){var r=n(320),o=Array.prototype;t.exports=function(t){var e=t.sort;return t===o||t instanceof Array&&e===o.sort?r:e}},function(t,e,n){n(321);var r=n(23);t.exports=r("Array").sort},function(t,e,n){"use strict";var r=n(8),o=n(38),i=n(32),a=n(17),s=n(81),c=[],u=c.sort,l=a(function(){c.sort(void 0)}),h=a(function(){c.sort(null)}),f=s("sort");r({target:"Array",proto:!0,forced:l||!h||!f},{sort:function(t){return void 0===t?u.call(i(this)):u.call(i(this),o(t))}})},function(t,e,n){var r=n(323);t.exports=r},function(t,e,n){var r=n(324),o=Array.prototype;t.exports=function(t){var e=t.map;return t===o||t instanceof Array&&e===o.map?r:e}},function(t,e,n){n(325);var r=n(23);t.exports=r("Array").map},function(t,e,n){"use strict";var r=n(8),o=n(76).map,i=n(75),a=n(45),s=i("map"),c=a("map");r({target:"Array",proto:!0,forced:!s||!c},{map:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var r=n(327);t.exports=r},function(t,e,n){n(94),n(328);var r=n(15);t.exports=r.Object.fromEntries},function(t,e,n){var r=n(8),o=n(51),i=n(74);r({target:"Object",stat:!0},{fromEntries:function(t){var e={};return o(t,function(t,n){i(e,t,n)},{AS_ENTRIES:!0}),e}})},function(t,e,n){var r=n(330);t.exports=r},function(t,e,n){var r=n(331),o=Array.prototype;t.exports=function(t){var e=t.filter;return t===o||t instanceof Array&&e===o.filter?r:e}},function(t,e,n){n(332);var r=n(23);t.exports=r("Array").filter},function(t,e,n){"use strict";var r=n(8),o=n(76).filter,i=n(75),a=n(45),s=i("filter"),c=a("filter");r({target:"Array",proto:!0,forced:!s||!c},{filter:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var r=n(334);t.exports=r},function(t,e,n){var r=n(335),o=Array.prototype;t.exports=function(t){var e=t.reduce;return t===o||t instanceof Array&&e===o.reduce?r:e}},function(t,e,n){n(336);var r=n(23);t.exports=r("Array").reduce},function(t,e,n){"use strict";var r=n(8),o=n(337).left,i=n(81),a=n(45),s=n(93),c=n(91),u=i("reduce"),l=a("reduce",{1:0});r({target:"Array",proto:!0,forced:!u||!l||!c&&s>79&&s<83},{reduce:function(t){return o(this,t,arguments.length,arguments.length>1?arguments[1]:void 0)}})},function(t,e,n){var r=n(38),o=n(32),i=n(86),a=n(28),s=function(t){return function(e,n,s,c){r(n);var u=o(e),l=i(u),h=a(u.length),f=t?h-1:0,p=t?-1:1;if(s<2)for(;;){if(f in l){c=l[f],f+=p;break}if(f+=p,t?f<0:h<=f)throw TypeError("Reduce of empty array with no initial value")}for(;t?f>=0:h>f;f+=p)f in l&&(c=n(c,l[f],f,u));return c}};t.exports={left:s(!1),right:s(!0)}},function(t,e,n){var r=n(339);t.exports=r},function(t,e,n){n(340);var r=n(15);t.exports=r.Number.isInteger},function(t,e,n){n(8)({target:"Number",stat:!0},{isInteger:n(341)})},function(t,e,n){var r=n(21),o=Math.floor;t.exports=function(t){return!r(t)&&isFinite(t)&&o(t)===t}},function(t,e,n){var r=n(343);t.exports=r},function(t,e,n){n(344),n(347),n(172);var r=n(15);t.exports=r.URL},function(t,e,n){"use strict";n(40);var r,o=n(8),i=n(25),a=n(171),s=n(14),c=n(130),u=n(54),l=n(72),h=n(26),f=n(345),p=n(156),d=n(146).codeAt,v=n(346),g=n(48),y=n(172),C=n(49),x=s.URL,w=y.URLSearchParams,m=y.getState,k=C.set,S=C.getterFor("URL"),b=Math.floor,P=Math.pow,E=/[A-Za-z]/,A=/[\d+-.A-Za-z]/,R=/\d/,I=/^(0x|0X)/,D=/^[0-7]+$/,T=/^\d+$/,L=/^[\dA-Fa-f]+$/,F=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,O=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,M=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,U=/[\u0009\u000A\u000D]/g,N=function(t,e){var n,r,o;if("["==e.charAt(0)){if("]"!=e.charAt(e.length-1))return"Invalid host";if(!(n=_(e.slice(1,-1))))return"Invalid host";t.host=n}else if(Q(t)){if(e=v(e),F.test(e))return"Invalid host";if(null===(n=B(e)))return"Invalid host";t.host=n}else{if(O.test(e))return"Invalid host";for(n="",r=p(e),o=0;o<r.length;o++)n+=Y(r[o],j);t.host=n}},B=function(t){var e,n,r,o,i,a,s,c=t.split(".");if(c.length&&""==c[c.length-1]&&c.pop(),(e=c.length)>4)return t;for(n=[],r=0;r<e;r++){if(""==(o=c[r]))return t;if(i=10,o.length>1&&"0"==o.charAt(0)&&(i=I.test(o)?16:8,o=o.slice(8==i?1:2)),""===o)a=0;else{if(!(10==i?T:8==i?D:L).test(o))return t;a=parseInt(o,i)}n.push(a)}for(r=0;r<e;r++)if(a=n[r],r==e-1){if(a>=P(256,5-e))return null}else if(a>255)return null;for(s=n.pop(),r=0;r<n.length;r++)s+=n[r]*P(256,3-r);return s},_=function(t){var e,n,r,o,i,a,s,c=[0,0,0,0,0,0,0,0],u=0,l=null,h=0,f=function(){return t.charAt(h)};if(":"==f()){if(":"!=t.charAt(1))return;h+=2,l=++u}for(;f();){if(8==u)return;if(":"!=f()){for(e=n=0;n<4&&L.test(f());)e=16*e+parseInt(f(),16),h++,n++;if("."==f()){if(0==n)return;if(h-=n,u>6)return;for(r=0;f();){if(o=null,r>0){if(!("."==f()&&r<4))return;h++}if(!R.test(f()))return;for(;R.test(f());){if(i=parseInt(f(),10),null===o)o=i;else{if(0==o)return;o=10*o+i}if(o>255)return;h++}c[u]=256*c[u]+o,2!=++r&&4!=r||u++}if(4!=r)return;break}if(":"==f()){if(h++,!f())return}else if(f())return;c[u++]=e}else{if(null!==l)return;h++,l=++u}}if(null!==l)for(a=u-l,u=7;0!=u&&a>0;)s=c[u],c[u--]=c[l+a-1],c[l+--a]=s;else if(8!=u)return;return c},z=function(t){var e,n,r,o;if("number"==typeof t){for(e=[],n=0;n<4;n++)e.unshift(t%256),t=b(t/256);return e.join(".")}if("object"==typeof t){for(e="",r=function(t){for(var e=null,n=1,r=null,o=0,i=0;i<8;i++)0!==t[i]?(o>n&&(e=r,n=o),r=null,o=0):(null===r&&(r=i),++o);return o>n&&(e=r,n=o),e}(t),n=0;n<8;n++)o&&0===t[n]||(o&&(o=!1),r===n?(e+=n?":":"::",o=!0):(e+=t[n].toString(16),n<7&&(e+=":")));return"["+e+"]"}return t},j={},q=f({},j,{" ":1,'"':1,"<":1,">":1,"`":1}),W=f({},q,{"#":1,"?":1,"{":1,"}":1}),V=f({},W,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),Y=function(t,e){var n=d(t,0);return n>32&&n<127&&!h(e,t)?t:encodeURIComponent(t)},G={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Q=function(t){return h(G,t.scheme)},H=function(t){return""!=t.username||""!=t.password},X=function(t){return!t.host||t.cannotBeABaseURL||"file"==t.scheme},K=function(t,e){var n;return 2==t.length&&E.test(t.charAt(0))&&(":"==(n=t.charAt(1))||!e&&"|"==n)},J=function(t){var e;return t.length>1&&K(t.slice(0,2))&&(2==t.length||"/"===(e=t.charAt(2))||"\\"===e||"?"===e||"#"===e)},$=function(t){var e=t.path,n=e.length;!n||"file"==t.scheme&&1==n&&K(e[0],!0)||e.pop()},Z=function(t){return"."===t||"%2e"===t.toLowerCase()},tt={},et={},nt={},rt={},ot={},it={},at={},st={},ct={},ut={},lt={},ht={},ft={},pt={},dt={},vt={},gt={},yt={},Ct={},xt={},wt={},mt=function(t,e,n,o){var i,a,s,c,u,l=n||tt,f=0,d="",v=!1,g=!1,y=!1;for(n||(t.scheme="",t.username="",t.password="",t.host=null,t.port=null,t.path=[],t.query=null,t.fragment=null,t.cannotBeABaseURL=!1,e=e.replace(M,"")),e=e.replace(U,""),i=p(e);f<=i.length;){switch(a=i[f],l){case tt:if(!a||!E.test(a)){if(n)return"Invalid scheme";l=nt;continue}d+=a.toLowerCase(),l=et;break;case et:if(a&&(A.test(a)||"+"==a||"-"==a||"."==a))d+=a.toLowerCase();else{if(":"!=a){if(n)return"Invalid scheme";d="",l=nt,f=0;continue}if(n&&(Q(t)!=h(G,d)||"file"==d&&(H(t)||null!==t.port)||"file"==t.scheme&&!t.host))return;if(t.scheme=d,n)return void(Q(t)&&G[t.scheme]==t.port&&(t.port=null));d="","file"==t.scheme?l=pt:Q(t)&&o&&o.scheme==t.scheme?l=rt:Q(t)?l=st:"/"==i[f+1]?(l=ot,f++):(t.cannotBeABaseURL=!0,t.path.push(""),l=Ct)}break;case nt:if(!o||o.cannotBeABaseURL&&"#"!=a)return"Invalid scheme";if(o.cannotBeABaseURL&&"#"==a){t.scheme=o.scheme,t.path=o.path.slice(),t.query=o.query,t.fragment="",t.cannotBeABaseURL=!0,l=wt;break}l="file"==o.scheme?pt:it;continue;case rt:if("/"!=a||"/"!=i[f+1]){l=it;continue}l=ct,f++;break;case ot:if("/"==a){l=ut;break}l=yt;continue;case it:if(t.scheme=o.scheme,a==r)t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query=o.query;else if("/"==a||"\\"==a&&Q(t))l=at;else if("?"==a)t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query="",l=xt;else{if("#"!=a){t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.path.pop(),l=yt;continue}t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,t.path=o.path.slice(),t.query=o.query,t.fragment="",l=wt}break;case at:if(!Q(t)||"/"!=a&&"\\"!=a){if("/"!=a){t.username=o.username,t.password=o.password,t.host=o.host,t.port=o.port,l=yt;continue}l=ut}else l=ct;break;case st:if(l=ct,"/"!=a||"/"!=d.charAt(f+1))continue;f++;break;case ct:if("/"!=a&&"\\"!=a){l=ut;continue}break;case ut:if("@"==a){v&&(d="%40"+d),v=!0,s=p(d);for(var C=0;C<s.length;C++){var x=s[C];if(":"!=x||y){var w=Y(x,V);y?t.password+=w:t.username+=w}else y=!0}d=""}else if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&Q(t)){if(v&&""==d)return"Invalid authority";f-=p(d).length+1,d="",l=lt}else d+=a;break;case lt:case ht:if(n&&"file"==t.scheme){l=vt;continue}if(":"!=a||g){if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&Q(t)){if(Q(t)&&""==d)return"Invalid host";if(n&&""==d&&(H(t)||null!==t.port))return;if(c=N(t,d))return c;if(d="",l=gt,n)return;continue}"["==a?g=!0:"]"==a&&(g=!1),d+=a}else{if(""==d)return"Invalid host";if(c=N(t,d))return c;if(d="",l=ft,n==ht)return}break;case ft:if(!R.test(a)){if(a==r||"/"==a||"?"==a||"#"==a||"\\"==a&&Q(t)||n){if(""!=d){var m=parseInt(d,10);if(m>65535)return"Invalid port";t.port=Q(t)&&m===G[t.scheme]?null:m,d=""}if(n)return;l=gt;continue}return"Invalid port"}d+=a;break;case pt:if(t.scheme="file","/"==a||"\\"==a)l=dt;else{if(!o||"file"!=o.scheme){l=yt;continue}if(a==r)t.host=o.host,t.path=o.path.slice(),t.query=o.query;else if("?"==a)t.host=o.host,t.path=o.path.slice(),t.query="",l=xt;else{if("#"!=a){J(i.slice(f).join(""))||(t.host=o.host,t.path=o.path.slice(),$(t)),l=yt;continue}t.host=o.host,t.path=o.path.slice(),t.query=o.query,t.fragment="",l=wt}}break;case dt:if("/"==a||"\\"==a){l=vt;break}o&&"file"==o.scheme&&!J(i.slice(f).join(""))&&(K(o.path[0],!0)?t.path.push(o.path[0]):t.host=o.host),l=yt;continue;case vt:if(a==r||"/"==a||"\\"==a||"?"==a||"#"==a){if(!n&&K(d))l=yt;else if(""==d){if(t.host="",n)return;l=gt}else{if(c=N(t,d))return c;if("localhost"==t.host&&(t.host=""),n)return;d="",l=gt}continue}d+=a;break;case gt:if(Q(t)){if(l=yt,"/"!=a&&"\\"!=a)continue}else if(n||"?"!=a)if(n||"#"!=a){if(a!=r&&(l=yt,"/"!=a))continue}else t.fragment="",l=wt;else t.query="",l=xt;break;case yt:if(a==r||"/"==a||"\\"==a&&Q(t)||!n&&("?"==a||"#"==a)){if(".."===(u=(u=d).toLowerCase())||"%2e."===u||".%2e"===u||"%2e%2e"===u?($(t),"/"==a||"\\"==a&&Q(t)||t.path.push("")):Z(d)?"/"==a||"\\"==a&&Q(t)||t.path.push(""):("file"==t.scheme&&!t.path.length&&K(d)&&(t.host&&(t.host=""),d=d.charAt(0)+":"),t.path.push(d)),d="","file"==t.scheme&&(a==r||"?"==a||"#"==a))for(;t.path.length>1&&""===t.path[0];)t.path.shift();"?"==a?(t.query="",l=xt):"#"==a&&(t.fragment="",l=wt)}else d+=Y(a,W);break;case Ct:"?"==a?(t.query="",l=xt):"#"==a?(t.fragment="",l=wt):a!=r&&(t.path[0]+=Y(a,j));break;case xt:n||"#"!=a?a!=r&&("'"==a&&Q(t)?t.query+="%27":t.query+="#"==a?"%23":Y(a,j)):(t.fragment="",l=wt);break;case wt:a!=r&&(t.fragment+=Y(a,q))}f++}},kt=function(t){var e,n,r=l(this,kt,"URL"),o=arguments.length>1?arguments[1]:void 0,a=String(t),s=k(r,{type:"URL"});if(void 0!==o)if(o instanceof kt)e=S(o);else if(n=mt(e={},String(o)))throw TypeError(n);if(n=mt(s,a,null,e))throw TypeError(n);var c=s.searchParams=new w,u=m(c);u.updateSearchParams(s.query),u.updateURL=function(){s.query=String(c)||null},i||(r.href=bt.call(r),r.origin=Pt.call(r),r.protocol=Et.call(r),r.username=At.call(r),r.password=Rt.call(r),r.host=It.call(r),r.hostname=Dt.call(r),r.port=Tt.call(r),r.pathname=Lt.call(r),r.search=Ft.call(r),r.searchParams=Ot.call(r),r.hash=Mt.call(r))},St=kt.prototype,bt=function(){var t=S(this),e=t.scheme,n=t.username,r=t.password,o=t.host,i=t.port,a=t.path,s=t.query,c=t.fragment,u=e+":";return null!==o?(u+="//",H(t)&&(u+=n+(r?":"+r:"")+"@"),u+=z(o),null!==i&&(u+=":"+i)):"file"==e&&(u+="//"),u+=t.cannotBeABaseURL?a[0]:a.length?"/"+a.join("/"):"",null!==s&&(u+="?"+s),null!==c&&(u+="#"+c),u},Pt=function(){var t=S(this),e=t.scheme,n=t.port;if("blob"==e)try{return new URL(e.path[0]).origin}catch(t){return"null"}return"file"!=e&&Q(t)?e+"://"+z(t.host)+(null!==n?":"+n:""):"null"},Et=function(){return S(this).scheme+":"},At=function(){return S(this).username},Rt=function(){return S(this).password},It=function(){var t=S(this),e=t.host,n=t.port;return null===e?"":null===n?z(e):z(e)+":"+n},Dt=function(){var t=S(this).host;return null===t?"":z(t)},Tt=function(){var t=S(this).port;return null===t?"":String(t)},Lt=function(){var t=S(this),e=t.path;return t.cannotBeABaseURL?e[0]:e.length?"/"+e.join("/"):""},Ft=function(){var t=S(this).query;return t?"?"+t:""},Ot=function(){return S(this).searchParams},Mt=function(){var t=S(this).fragment;return t?"#"+t:""},Ut=function(t,e){return{get:t,set:e,configurable:!0,enumerable:!0}};if(i&&c(St,{href:Ut(bt,function(t){var e=S(this),n=String(t),r=mt(e,n);if(r)throw TypeError(r);m(e.searchParams).updateSearchParams(e.query)}),origin:Ut(Pt),protocol:Ut(Et,function(t){var e=S(this);mt(e,String(t)+":",tt)}),username:Ut(At,function(t){var e=S(this),n=p(String(t));if(!X(e)){e.username="";for(var r=0;r<n.length;r++)e.username+=Y(n[r],V)}}),password:Ut(Rt,function(t){var e=S(this),n=p(String(t));if(!X(e)){e.password="";for(var r=0;r<n.length;r++)e.password+=Y(n[r],V)}}),host:Ut(It,function(t){var e=S(this);e.cannotBeABaseURL||mt(e,String(t),lt)}),hostname:Ut(Dt,function(t){var e=S(this);e.cannotBeABaseURL||mt(e,String(t),ht)}),port:Ut(Tt,function(t){var e=S(this);X(e)||(""==(t=String(t))?e.port=null:mt(e,t,ft))}),pathname:Ut(Lt,function(t){var e=S(this);e.cannotBeABaseURL||(e.path=[],mt(e,t+"",gt))}),search:Ut(Ft,function(t){var e=S(this);""==(t=String(t))?e.query=null:("?"==t.charAt(0)&&(t=t.slice(1)),e.query="",mt(e,t,xt)),m(e.searchParams).updateSearchParams(e.query)}),searchParams:Ut(Ot),hash:Ut(Mt,function(t){var e=S(this);""!=(t=String(t))?("#"==t.charAt(0)&&(t=t.slice(1)),e.fragment="",mt(e,t,wt)):e.fragment=null})}),u(St,"toJSON",function(){return bt.call(this)},{enumerable:!0}),u(St,"toString",function(){return bt.call(this)},{enumerable:!0}),x){var Nt=x.createObjectURL,Bt=x.revokeObjectURL;Nt&&u(kt,"createObjectURL",function(t){return Nt.apply(x,arguments)}),Bt&&u(kt,"revokeObjectURL",function(t){return Bt.apply(x,arguments)})}g(kt,"URL"),o({global:!0,forced:!a,sham:!i},{URL:kt})},function(t,e,n){"use strict";var r=n(25),o=n(17),i=n(69),a=n(161),s=n(85),c=n(32),u=n(86),l=Object.assign,h=Object.defineProperty;t.exports=!l||o(function(){if(r&&1!==l({b:1},l(h({},"a",{enumerable:!0,get:function(){h(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol();return t[n]=7,"abcdefghijklmnopqrst".split("").forEach(function(t){e[t]=t}),7!=l({},t)[n]||"abcdefghijklmnopqrst"!=i(l({},e)).join("")})?function(t,e){for(var n=c(t),o=arguments.length,l=1,h=a.f,f=s.f;o>l;)for(var p,d=u(arguments[l++]),v=h?i(d).concat(h(d)):i(d),g=v.length,y=0;g>y;)p=v[y++],r&&!f.call(d,p)||(n[p]=d[p]);return n}:l},function(t,e,n){"use strict";var r=/[^\0-\u007E]/,o=/[.\u3002\uFF0E\uFF61]/g,i="Overflow: input needs wider integers to process",a=Math.floor,s=String.fromCharCode,c=function(t){return t+22+75*(t<26)},u=function(t,e,n){var r=0;for(t=n?a(t/700):t>>1,t+=a(t/e);t>455;r+=36)t=a(t/35);return a(r+36*t/(t+38))},l=function(t){var e,n,r=[],o=(t=function(t){for(var e=[],n=0,r=t.length;n<r;){var o=t.charCodeAt(n++);if(o>=55296&&o<=56319&&n<r){var i=t.charCodeAt(n++);56320==(64512&i)?e.push(((1023&o)<<10)+(1023&i)+65536):(e.push(o),n--)}else e.push(o)}return e}(t)).length,l=128,h=0,f=72;for(e=0;e<t.length;e++)(n=t[e])<128&&r.push(s(n));var p=r.length,d=p;for(p&&r.push("-");d<o;){var v=2147483647;for(e=0;e<t.length;e++)(n=t[e])>=l&&n<v&&(v=n);var g=d+1;if(v-l>a((2147483647-h)/g))throw RangeError(i);for(h+=(v-l)*g,l=v,e=0;e<t.length;e++){if((n=t[e])<l&&++h>2147483647)throw RangeError(i);if(n==l){for(var y=h,C=36;;C+=36){var x=C<=f?1:C>=f+26?26:C-f;if(y<x)break;var w=y-x,m=36-x;r.push(s(c(x+w%m))),y=a(w/m)}r.push(s(c(y))),f=u(h,g,d==p),h=0,++d}}++h,++l}return r.join("")};t.exports=function(t){var e,n,i=[],a=t.toLowerCase().replace(o,".").split(".");for(e=0;e<a.length;e++)n=a[e],i.push(r.test(n)?"xn--"+l(n):n);return i.join(".")}},function(t,e){}])});
},{"process":"FT5O"}],"ryqy":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.bindBili=exports.getTrackerParamsString=void 0;var r=require("@bilibili-live/web-player-common"),i=t(require("@bilibili-live/fmp4.js")),a=require("@bilibili-live/sisters-p2p"),n=function(e,t){var r,i=null!==(r=s(e))&&void 0!==r?r:{},n=i.streamName,l=i.timeshift;return a.SistersPlayerContext.getTrackerParamsString({stream:n,roomid:t,timeshift:l})};function l(e){var t,n=e.corePlayer,l=e.videoEl,u=e.src,d=e.roomId,m=e.trackerServer;if(!(n instanceof i.default.Hls7Player))return r.logger.error("bilibili p2p must use be Hls7Player instance"),null;var f=null!==(t=s(u))&&void 0!==t?t:{},c=f.streamName,v=f.timeshift;if(null==c)return r.logger.error("can't detect stream name in url"),null;if(!a.SistersPlayerContext.checkP2PSupport())return r.logger.error("unsupported bilibili p2p"),null;var p=new a.SistersPlayerContext(function(e,t){r.logger.info(t)},{trackerParams:{stream:c,roomid:d,timeshift:v},sdkParams:{trackerServers:m}});if(void 0!==p.getStatisticsData)throw new Error("getStatisticsData is exist, cannot be extended");return p.getStatisticsData=o(p,{timeshift:v,streamName:c}),n.setP2PContext({P2PBufferLength:3,P2PFetchAsStream:function(e,t){void 0===t&&(t=!1),p.p2pFetchAsBuffer(this._onError,this._onResult,function(){return 1e3*r.remainBufferLength(l)},e,t)},onPlaylistUpdate:function(e,t){p.updatePlaylist(e,t)}}),p}function o(t,r){var i=r.timeshift,n=r.streamName;return function(){var r,l,o,s,u,d,m,f,c,v,p=t.getP2PDataCollectionStatus();if(null==p)return null;var g=null!==(r=p.getQueryServerInfo())&&void 0!==r?r:{},P=g.fragNum,h=void 0===P?0:P,S=g.queryNum,D=void 0===S?0:S,b=e(e({cdnDownloadValidSize:null!==(l=p.getServerDownload())&&void 0!==l?l:0,cdnDownloadInvalidSize:null!==(o=p.getWastedDataSize(a.WastedDataType.CDN_REPEAT))&&void 0!==o?o:0,fetchErrorNum:null!==(s=p.getFetchErrorNum(a.FetchErrorType.ERROR_TO_RELOAD))&&void 0!==s?s:0,p2pDownloadValidSize:null!==(u=p.getP2PDownload())&&void 0!==u?u:0,p2pDownloadInvalidSize:null!==(d=p.getWastedDataSize(a.WastedDataType.P2P_LATE))&&void 0!==d?d:0,p2pErrorSize:null!==(m=p.getWastedDataSize(a.WastedDataType.ERROR_DATA))&&void 0!==m?m:0,p2pUploadSize:null!==(f=p.getP2PSend())&&void 0!==f?f:0,fragNum:h,queryNum:D,timeshift:i,streamName:n},null!==(c=p.getExtendReportInfo())&&void 0!==c?c:{}),null!==(v=p.getTrackerInfo())&&void 0!==v?v:{});return p.clearP2PDataInfo(),b}}function s(e){var t=/\/live-bvc\/\d{3,9}\/(live_.+?)[/.]/.exec(e);if(null==t)return{timeshift:0,streamName:null};var r=Number(new URL(e).searchParams.get("tmshift"));return{streamName:t[1],timeshift:r}}exports.getTrackerParamsString=n,exports.bindBili=l;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/fmp4.js":"lV3a","@bilibili-live/sisters-p2p":"GTYV"}],"p0fG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@bilibili-live/web-player-common"),t=function(){function t(e,t,o){this._element=null,this._loader=null,this._responsed=!1,this._onResponse=e,this._onData=t,this._onError=o,this._onStateChangeBinder=this._onStateChange.bind(this),this.QVBP2P=window.QVBP2P}return t.prototype.destroy=function(){null!=this._loader&&(this._loader.destroy(),this._loader=null),this._responsed=!1},Object.defineProperty(t.prototype,"videoElement",{get:function(){return this._element},set:function(e){this._element=e},enumerable:!1,configurable:!0}),t.prototype.fetchAsStream=function(e){null!=this._element&&(null!=this._loader&&this._loader.close(),this._loader=new this.QVBP2P({debug:!1}),this._loader.listen(this.QVBP2P.ComEvents.STATE_CHANGE,this._onStateChangeBinder),this._loader.loadSource({src:e}),this._loader.setMediaElement(this._element))},t.prototype._onStateChange=function(t,o){switch(o.code){case this.QVBP2P.ComCodes.RECEIVE_BUFFER:this._responsed||(this._responsed=!0,this._onResponse(200,"video/x-flv")),null!=o.payload?this._onData(new Uint8Array(o.payload)):e.logger.warn("QVBP2P no payload");break;case this.QVBP2P.ComCodes.ROLLBACK:e.logger.error("TX P2P error: "+t),"function"==typeof this._onError&&this._onError(11001,t)}},t.isSupported=function(){var e;return null===(e=window.QVBP2P)||void 0===e?void 0:e.isSupported()},t}();exports.default=t;
},{"@bilibili-live/web-player-common":"KGHo"}],"V6Hm":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@bilibili-live/web-player-common"),t=e(require("@bilibili-live/fmp4.js")),i=e(require("./qvb-fetcher")),n=!1;function o(e){var o=e.corePlayer,u=e.videoEl;return o instanceof t.default.fMp4Player?i.default.isSupported()?n?(r.logger.warn("p2p P2P_ERROR_FLAG fallback"),!1):(o.createFetcher=function(e,t,o){var l=new i.default(function(r){e(new a(r))},t,function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];n=!0,r.logger.error("third fetcher Error: "+JSON.stringify(e)),o.apply(void 0,e)});return l.videoElement=u,l},!0):(r.logger.error("QVB unsupported or sdk not loaded"),!1):(r.logger.error("QVB p2p must use be fMp4Player instance"),!1)}exports.default=o;var u=function(){function e(){this.map={}}return e.prototype.get=function(e){return this.map[e]},e.prototype.set=function(e,r){this.map[e]=r},e}(),a=function(){return function(e){this.status=e,this.ok=e>=200&&e<=299,this.headers=new u}}();
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/fmp4.js":"lV3a","./qvb-fetcher":"p0fG"}],"R6Co":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("./bili-p2p"),i=e(require("./qvb-p2p"));exports.default={bindBili:r.bindBili,getTrackerParamsString:r.getTrackerParamsString,bindQVB:i.default};
},{"./bili-p2p":"ryqy","./qvb-p2p":"V6Hm"}],"A6uK":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++)for(var i in r=arguments[t])Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i]);return e}).apply(this,arguments)},r=this&&this.__awaiter||function(e,r,t,n){return new(t||(t=Promise))(function(i,o){function a(e){try{u(n.next(e))}catch(r){o(r)}}function l(e){try{u(n.throw(e))}catch(r){o(r)}}function u(e){var r;e.done?i(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(a,l)}u((n=n.apply(e,r||[])).next())})},t=this&&this.__generator||function(e,r){var t,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=r.call(e,a)}catch(l){o=[6,l],n=0}finally{t=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var i=require("@bilibili-live/web-player-common"),o=require("@bilibili-live/web-player-video"),a=n(require("@bilibili-live/web-player-p2p")),l=n(require("@bilibili-live/web-player-track"));function u(e){var n=e.video,l=e.type,u=e.roomId,d=e.interval;return r(this,void 0,Promise,function(){var e;return t(this,function(r){switch(r.label){case 0:return i.logger.info("launch p2p: "+l),l!==i.P2PType.FLV_QVB?[3,4]:(n.delyLoad(),null!=window.QVBP2P?[3,2]:[4,i.loadScript("//s1.hdslb.com/bfs/static/blive/web-player/p2p/qvbp2p_bilibili_v1.8.16.min.js").catch(function(){i.logger.error("qvb script loading failed")})]);case 1:r.sent(),r.label=2;case 2:return[4,new Promise(function(e,r){n.once(o.EventType.LoadStart,function(t){var n=t.corePlayer,i=t.videoEl;a.default.bindQVB({corePlayer:n,videoEl:i})?e():r(new Error("launch flv_qvb failed"))}),n.load()})];case 3:return[2,r.sent()];case 4:return l!==i.P2PType.HLS_BILI?[3,6]:(n.delyLoad(),[4,f(u,n.getSrc()).catch(function(e){return i.logger.error(e),null})]);case 5:return null==(e=r.sent())||0===e.length?(n.load(),[2]):[2,new Promise(function(r,t){n.once(o.EventType.CorePlayerCreated,function(i){var l=i.corePlayer,f=i.videoEl,p=i.src,v=a.default.bindBili({corePlayer:l,videoEl:f,src:p,roomId:u,trackerServer:e});if(null!=v){v.onEventReport=function(e){c(e,l)};var b=s(v,f,d);n.once(o.EventType.Destroyed,function(){b(),v.destroy()}),r()}else t(new Error("launch bili_p2p failed"))}),n.load()})];case 6:return[2]}})})}function c(e,r){switch(e.type){case 1:"number"==typeof e.body.p2pBufferLengthSec&&e.body.p2pBufferLengthSec>=0&&(r.minBufferLength=e.body.p2pBufferLengthSec,i.logger.info("Change P2PBufferLength: "+e.body.p2pBufferLengthSec));break;case 0:l.default.custom(e.body.code+1e4,e.body.data),i.logger.warn("sister p2p emit: code: "+e.type)}}function s(r,t,n){void 0===n&&(n=30);var o=0,a=l.default.fixedDynamicFieldsVerIns();function u(){var n=i.remainBufferLength(t);n=n<0?0:n;var u=Math.round(1e3*(t.currentTime+n)),c=i.roundNumber((u<0?0:u)-o,0);o=u;var s=r.getStatisticsData();null!=s&&a.custom(l.default.CustomCode.P2PData,e(e({},s),{duration:c}),{randDelay:5e3,extFields:"all"})}var c=setInterval(u,1e3*(n>=10||n<=300?n:30)),s=function(){clearInterval(c),u()};return window.addEventListener("beforeunload",s),function(){clearInterval(c),window.removeEventListener("beforeunload",s),u()}}exports.default=u;var f=function(){var e={};return function(n,o){return r(void 0,void 0,void 0,function(){var r,l;return t(this,function(t){switch(t.label){case 0:if(r=a.default.getTrackerParamsString(o,n),null!=e[r])return[2,e[r]];l=[],t.label=1;case 1:return t.trys.push([1,4,,5]),[4,i.ajax("/xlive/open-interface/v2/tracker/conf"+r)];case 2:return[4,t.sent().domains];case 3:return l=t.sent(),[3,5];case 4:return t.sent(),i.logger.error("track server url parsed error"),[3,5];case 5:return e[r]=l,[2,l]}})})}}();
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-p2p":"R6Co","@bilibili-live/web-player-track":"ESUf"}],"KY4m":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,n,t){return new(n||(n=Promise))(function(o,i){function u(e){try{a(t.next(e))}catch(r){i(r)}}function c(e){try{a(t.throw(e))}catch(r){i(r)}}function a(e){var r;e.done?o(e.value):(r=e.value,r instanceof n?r:new n(function(e){e(r)})).then(u,c)}a((t=t.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var n,t,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,t&&(o=2&i[0]?t.return:i[0]?t.throw||((o=t.return)&&o.call(t),0):t.next)&&!(o=o.call(t,i[1])).done)return o;switch(t=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,t=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){u.label=i[1];break}if(6===i[0]&&u.label<o[1]){u.label=o[1],o=i;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(i);break}o[2]&&u.ops.pop(),u.trys.pop();continue}i=r.call(e,u)}catch(c){i=[6,c],t=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.maxRetryChecker=exports.blockStream=exports.loadingOrCoverImg=exports.backoffById=exports.retry=void 0;var n=require("@bilibili-live/web-player-common"),t=require("@bilibili-live/web-player-video");function o(t,o){var i=this,u=-1;return function(){for(var c=[],a=0;a<arguments.length;a++)c[a]=arguments[a];return e(i,void 0,void 0,function(){return r(this,function(i){switch(i.label){case 0:return[4,new Promise(function(i,a){(function t(i){return e(this,void 0,Promise,function(){var e,c,a;return r(this,function(r){switch(r.label){case 0:return-1!==u?[3,1]:(u+=1,[3,3]);case 1:return e=o[u],n.logger.error("retry times: "+u+", delay: "+e),u+=1,[4,n.sleep(e)];case 2:r.sent(),r.label=3;case 3:return r.trys.push([3,5,,9]),[4,i()];case 4:return c=r.sent(),u=-1,[2,c];case 5:return a=r.sent(),n.logger.error(a),u<o.length?[4,t(i)]:[3,7];case 6:return[2,r.sent()];case 7:throw n.logger.error("retry failed"),a;case 8:return[3,9];case 9:return[2]}})})})(function(){return t.apply(void 0,c)}).then(function(e){i(e)}).catch(function(e){a(e)})})];case 1:return[2,i.sent()]}})})}}function i(e,r){var t;return null==r||""===r?(t=n.loading(e),n.coverImg(null,e)):n.coverImg(r,e),function(){null==t||t()}}function u(e,r){null==e||e.destroy(!0);var n=null==e?void 0:e.getVideoEl();if(null!=n){n.addEventListener("play",function e(){n.removeEventListener("play",e),r()})}}exports.retry=o,exports.backoffById=function(){var t=[[0,0],[.5,2],[2,4],[4,6]].map(function(e){return e.map(function(e){return 1e3*e})}),o=new Map;return function(i,u){return e(void 0,void 0,void 0,function(){var e,c,a,l,s,f;return r(this,function(r){switch(r.label){case 0:if(u=u>4?4:u,null==(e=o.get(i))&&(e={count:0,removeTimer:0},o.set(i,e)),clearTimeout(e.removeTimer),(c=e.count)>=u)throw o.delete(i),new Error("backoff failed");return e.removeTimer=window.setTimeout(function(){o.delete(i)},2*t[t.length-1][1]),e.count+=1,a=t[c],l=a[0],s=a[1],f=Math.round(Math.random()*(s-l)+l),n.logger.warn("backoff delay: sleepTime: "+f+", count: "+e.count),[4,n.sleep(f)];case 1:return r.sent(),[2,e.count]}})})}}(),exports.loadingOrCoverImg=i,exports.blockStream=u,exports.maxRetryChecker=function(){var e=0,r=function(){e>0||(e=performance.now())};return function(n){return n.once(t.EventType.FirstFrame,function(){e=0}),n.once(t.EventType.Error,r),n.once(t.EventType.Ended,r),function(){return!(e>0&&performance.now()-e>6e4)}}}();
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58"}],"rPou":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function a(e){try{l(r.next(e))}catch(t){i(t)}}function u(e){try{l(r.throw(e))}catch(t){i(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(a,u)}l((r=r.apply(e,t||[])).next())})},t=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(u){i=[6,u],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createVideoTracker=void 0;var r=require("@bilibili-live/web-player-video"),o=n(require("@bilibili-live/web-player-track")),i=o.default.PerfCode,a=o.default.EventCode,u=o.default.CustomCode;function l(){var n=this,l=!1,c=!1,s=!1;return window.addEventListener("unload",function(){s=!0}),function(f){o.default.event(a.CreateVideo,null,{sampleRate:.1,extFields:["sProtocol","sHost","p2pType","sCodec","sName","sFormat"],randDelay:0}),f.once(r.EventType.NetworkResponse,function(e){var t,n=e.headers.get("x-service-module");null!=n&&o.default.updateDynamicInfo(((t={})["x-service-module"]=n,t))}),f.once(r.EventType.FirstFrame,function(e){o.default.perf(i.FirstFrame,e,{sampleRate:.1,extFields:"all"})}),f.once(r.EventType.FirstPacket,function(e){o.default.perf(i.FirstPacket,e,{sampleRate:.05})}),f.once(r.EventType.MetaData,function(e){o.default.perf(i.VideoMeta,e,{sampleRate:.05})}),f.once(r.EventType.Ended,function(){return e(n,void 0,void 0,function(){return t(this,function(e){return l=!0,[2]})})}),f.once(r.EventType.FirstFrame,function(){l=!1,c=!1}),f.once(r.EventType.Error,function(e){s||c||(c=!0,l||o.default.error(e.code,JSON.stringify(e.errInfo)))});var d=o.default.fixedDynamicFieldsVerIns();f.on(r.EventType.WaitReport,function(e){d.custom(u.Waiting,e,{randDelay:5e3,extFields:"all"})})}}exports.createVideoTracker=l;
},{"@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-track":"ESUf"}],"XQD5":[function(require,module,exports) {
module.exports={webPlayerReplayContainer:"_web-player-replay-container_87470",replayShow:"_replay-show_87470",replayHidden:"_replay-hidden_87470",webPlayerReplayElement:"_web-player-replay-element_87470",progressShow:"_progress-show_87470",progressHidden:"_progress-hidden_87470",webPlayerReplayProgress:"_web-player-replay-progress_87470",webPlayerReplayCurrentPoint:"_web-player-replay-current-point_87470",webPlayerReplayBar:"_web-player-replay-bar_87470",webPlayerReplayHighlightsHidden:"_web-player-replay-highlights-hidden_87470",highlightItem:"_highlight-item_87470",highlightPot:"_highlight-pot_87470",highlightIcon:"_highlight-icon_87470",webPlayerReplayHighlightsShow:"_web-player-replay-highlights-show_87470",webPlayerReplayHighlights:"_web-player-replay-highlights_87470",highlightImg:"_highlight-img_87470",backliveBtnContainer:"_backlive-btn-container_87470",backliveBtn:"_backlive-btn_87470",backliveDot:"_backlive-dot_87470"};var e='._web-player-replay-container_87470{z-index:12;position:absolute;bottom:0;width:100%;height:3px;user-select:none;-webkit-touch-callout:none}._web-player-replay-container_87470 div._replay-show_87470{bottom:40px}._web-player-replay-container_87470 div._replay-hidden_87470{bottom:0}@media screen and (max-width:850px){._web-player-replay-container_87470 div._replay-show_87470{bottom:30px;height:50px;display:flex;align-items:center}}._web-player-replay-container_87470 ._web-player-replay-element_87470{opacity:.8;bottom:0;left:7px;right:7px;position:absolute}._web-player-replay-container_87470 ._web-player-replay-element_87470 div._progress-show_87470{height:4px;padding:2px 0}._web-player-replay-container_87470 ._web-player-replay-element_87470 div._progress-hidden_87470{height:3px;padding:0}@media screen and (max-width:850px){._web-player-replay-container_87470 ._web-player-replay-element_87470 div._progress-show_87470{height:2px;padding:2px 0}._web-player-replay-container_87470 ._web-player-replay-element_87470 div._progress-hidden_87470{height:2px;padding:0}}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-progress_87470{height:3px;padding:0;position:relative;width:100%;background:hsla(0,0%,100%,.3);cursor:pointer;opacity:.9;background-clip:content-box}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-progress_87470 ._web-player-replay-current-point_87470{position:absolute;left:100%;margin-left:-7px;margin-top:-6px;width:14px;height:14px;background-size:100%;z-index:1;display:none;background-image:url(https://i0.hdslb.com/bfs/activity-plat/static/20210315/d0411babbbf77c49ca42a3320eb804ae/F7QzSyeFMa.png)}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-progress_87470 ._web-player-replay-bar_87470{width:100%;height:100%;background:#00a1d6}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-hidden_87470 ._highlight-item_87470{top:0}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-hidden_87470 ._highlight-item_87470 ._highlight-pot_87470{width:3px;height:3px}@media screen and (max-width:850px){._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-hidden_87470 ._highlight-item_87470 ._highlight-pot_87470{width:2px;height:2px}}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-hidden_87470 ._highlight-icon_87470{display:none}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-show_87470 ._highlight-item_87470{top:2px}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-show_87470 ._highlight-item_87470 ._highlight-pot_87470{width:4px;height:4px}@media screen and (max-width:850px){._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-show_87470 ._highlight-item_87470 ._highlight-pot_87470{width:2px;height:2px}}@media screen and (max-width:850px){._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-show_87470 ._highlight-item_87470{top:calc(50% - 1px)}}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights-show_87470 ._highlight-icon_87470{display:block}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights_87470 ._highlight-item_87470{position:absolute}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights_87470 ._highlight-item_87470 ._highlight-pot_87470{position:absolute;left:0;border-radius:50%;background-color:#fff;cursor:pointer}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights_87470 ._highlight-item_87470 ._highlight-icon_87470{position:absolute;width:36px;height:36px;top:-50px;left:-16px;border-radius:50%;background:#00a1d6;cursor:pointer}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights_87470 ._highlight-item_87470 ._highlight-icon_87470 ._highlight-img_87470{position:absolute;left:2px;top:2px;width:32px;height:32px;border-radius:50%;overflow:hidden;background-size:cover;z-index:1}._web-player-replay-container_87470 ._web-player-replay-element_87470 ._web-player-replay-highlights_87470 ._highlight-item_87470 ._highlight-icon_87470:after{content:"";position:absolute;left:13px;bottom:-3px;width:10px;height:10px;transform:rotate(45deg);background-color:#00a1d6}._backlive-btn-container_87470{display:flex;height:22px}._backlive-btn-container_87470 ._backlive-btn_87470{padding:0 8px;margin:0 9px;color:#fff;background-color:rgba(51,51,51,.8);border-radius:12px;font-size:12px;cursor:pointer;display:flex;align-items:center}._backlive-btn-container_87470 ._backlive-btn_87470 ._backlive-dot_87470{display:inline-block;margin-right:6px;width:6px;height:6px;font-size:0;border-radius:50%;background:#ff5243;vertical-align:middle}',l=document.createElement("style");l.type="text/css",l.appendChild(document.createTextNode(e)),document.head.appendChild(l);
},{}],"EfpE":[function(require,module,exports) {
var define;
var t;function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}!function(n,o){"object"==("undefined"==typeof exports?"undefined":e(exports))&&"object"==("undefined"==typeof module?"undefined":e(module))?module.exports=o():"function"==typeof t&&t.amd?t([],o):"object"==("undefined"==typeof exports?"undefined":e(exports))?exports.DanmakuWebSocket=o():n.DanmakuWebSocket=o()}("undefined"!=typeof self?self:this,function(){return function(t){function e(o){if(n[o])return n[o].exports;var i=n[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,o){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e,n){"use strict";e.a={WS_OP_HEARTBEAT:2,WS_OP_HEARTBEAT_REPLY:3,WS_OP_MESSAGE:5,WS_OP_USER_AUTHENTICATION:7,WS_OP_CONNECT_SUCCESS:8,WS_PACKAGE_HEADER_TOTAL_LENGTH:16,WS_PACKAGE_OFFSET:0,WS_HEADER_OFFSET:4,WS_VERSION_OFFSET:6,WS_OPERATION_OFFSET:8,WS_SEQUENCE_OFFSET:12,WS_BODY_PROTOCOL_VERSION_NORMAL:0,WS_BODY_PROTOCOL_VERSION_BROTLI:3,WS_HEADER_DEFAULT_VERSION:1,WS_HEADER_DEFAULT_OPERATION:1,WS_HEADER_DEFAULT_SEQUENCE:1,WS_AUTH_OK:0,WS_AUTH_TOKEN_ERROR:-101}},function(t,e,n){var o=n(2).default;t.exports=o},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),i=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),r=function(){function t(e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),"development"===t.CONFIG.bundleType&&(console.clear(),console.dir(t.CONFIG)),this.initialize(e)}return t.prototype.initialize=function(e){var n=this;"development"===t.CONFIG.bundleType&&console.log("App Initialized.");var i=document.createElement("script");return i.src="//activity.hdslb.com/blackboard/static/20210425/d0411babbbf77c49ca42a3320eb804ae/0NCT06vruR.js",i.onload=function(){n.ws=new o.a(e)},window.document.head.append(i),this.getReturn()},t.prototype.getReturn=function(){return"development"===t.CONFIG.bundleType?this:{destroy:this.destroy.bind(this),send:this.send.bind(this),getAuthInfo:this.getAuthInfo.bind(this),getRetryCount:this.getRetryCount.bind(this),getState:this.getState.bind(this)}},t.prototype.destroy=function(){this.ws&&this.ws.destroy()},t.prototype.getState=function(){return this.ws&&this.ws.getState()},t.prototype.send=function(t){this.ws&&this.ws.send(t)},t.prototype.getAuthInfo=function(){return this.ws&&this.ws.getAuthInfo()},t.prototype.getRetryCount=function(){return this.ws&&this.ws.getRetryCount()},i(t,null,[{key:"CONFIG",get:function(){return{version:"1.4.4",gitHash:"31c446ee",build:"34",bundleType:"release"}}}]),t}();e.default=r},function(t,e,n){"use strict";var o=n(0),i=n(4),r=n(5),s=function(){function t(e){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.checkOptions(e)){var n={url:"",urlList:[],rid:0,aid:0,uid:0,from:-1,retry:!0,retryMaxCount:0,retryInterval:5,retryThreadCount:10,connectTimeout:5e3,retryConnectCount:3,retryconnectTimeout:1e4,retryRoundInterval:Math.floor(2*Math.random())+3,customAuthParam:[],fallback:function(){},heartBeatInterval:30,onReceivedMessage:function(){},onReceiveAuthRes:function(){},onHeartBeatReply:function(){},onInitialized:function(){},onOpen:function(){},onClose:function(){},onError:function(){},onListConnectError:function(){},onLogger:function(){}};this.options=r.a.extend({},n,e),this.wsBinaryHeaderList=r.a.extend([],i.a),this.authInfo={origin:"",encode:""},0!==this.options.urlList.length&&0!==this.options.retryMaxCount&&this.options.retryMaxCount<this.options.urlList.length&&(this.options.retryMaxCount=this.options.urlList.length-1),this.state={retryCount:0,listConnectFinishedCount:0,index:0,connectTimeoutTimes:0,url:""},this.callbackQueueList={onInitializedQueue:[],onOpenQueue:[],onCloseQueue:[],onErrorQueue:[],onReceivedMessageQueue:[],onHeartBeatReplyQueue:[],onRetryFallbackQueue:[],onListConnectErrorQueue:[],onReceiveAuthResQueue:[]},this.HEART_BEAT_INTERVAL=0,this.CONNECT_TIMEOUT=0,this.mixinCallback().initialize(this.options.urlList.length>0?this.options.urlList[0]:this.options.url)}}return t.prototype.initialize=function(t){var e=this,n="MozWebSocket"in window?window.MozWebSocket:window.WebSocket,o=this.options;try{this.state.url=t,this.ws=new n(t),this.ws.binaryType="arraybuffer",this.ws.onopen=this.onOpen.bind(this),this.ws.onmessage=this.onMessage.bind(this),this.ws.onclose=this.onClose.bind(this),this.ws.onerror=this.onError.bind(this),r.a.callFunction(this.callbackQueueList.onInitializedQueue),this.callbackQueueList.onInitializedQueue=[];var i=this.state.connectTimeoutTimes>=3?o.retryconnectTimeout:o.connectTimeout;this.CONNECT_TIMEOUT=setTimeout(function(){e.state.connectTimeoutTimes+=1,e.options.onLogger("connect timeout "+e.state.connectTimeoutTimes),e.ws.close()},i)}catch(t){"function"==typeof o.fallback&&o.fallback()}return this},t.prototype.onOpen=function(){return r.a.callFunction(this.callbackQueueList.onOpenQueue),this.state.connectTimeoutTimes=0,this.CONNECT_TIMEOUT&&clearTimeout(this.CONNECT_TIMEOUT),this.userAuthentication(),this},t.prototype.userAuthentication=function(){var t,e=this,n=this.options,i={uid:parseInt(n.uid,10),roomid:parseInt(n.rid,10),protover:3};n.aid&&(i.aid=parseInt(n.aid,10)),n.from>0&&(i.from=parseInt(n.from,10)||7);for(var r=0;r<n.customAuthParam.length;r++){var s=n.customAuthParam[r],a=s.type||"string";switch(void 0!==i[s.key]&&this.options.onLogger("Token has the same key already! 【"+s.key+"】"),s.key.toString()&&s.value.toString()||this.options.onLogger("Invalid customAuthParam, missing key or value! 【"+s.key+"】-【"+s.value+"】"),a){case"string":i[s.key]=s.value;break;case"number":i[s.key]=parseInt(s.value,10);break;case"boolean":i[s.key]=!!i[s.value];break;default:return void this.options.onLogger("Unsupported customAuthParam type!【"+a+"】")}}t=this.convertToArrayBuffer(JSON.stringify(i),o.a.WS_OP_USER_AUTHENTICATION),this.authInfo.origin=i,this.authInfo.encode=t,setTimeout(function(){e.ws.send(t)},0)},t.prototype.getAuthInfo=function(){return this.authInfo},t.prototype.getState=function(){return this.state},t.prototype.heartBeat=function(){var t=this;clearTimeout(this.HEART_BEAT_INTERVAL);var e=this.convertToArrayBuffer({},o.a.WS_OP_HEARTBEAT);this.ws.send(e),this.HEART_BEAT_INTERVAL=setTimeout(function(){t.heartBeat()},1e3*this.options.heartBeatInterval)},t.prototype.onMessage=function(t){var e=this;try{var n=this.convertToObject(t.data);if(n instanceof Array)n.forEach(function(t){e.onMessage(t)});else if(n instanceof Object)switch(n.op){case o.a.WS_OP_HEARTBEAT_REPLY:this.onHeartBeatReply(n.body);break;case o.a.WS_OP_MESSAGE:this.onMessageReply(n.body,n.seq);break;case o.a.WS_OP_CONNECT_SUCCESS:if(0!==n.body.length&&n.body[0])switch(n.body[0].code){case o.a.WS_AUTH_OK:this.heartBeat();break;case o.a.WS_AUTH_TOKEN_ERROR:this.options.retry=!1,"function"==typeof this.options.onReceiveAuthRes&&this.options.onReceiveAuthRes(n.body);break;default:this.onClose()}else this.heartBeat()}}catch(t){this.options.onLogger("WebSocket Error: ",t)}return this},t.prototype.onMessageReply=function(t,e){var n=this;try{t instanceof Array?t.forEach(function(t){n.onMessageReply(t,e)}):t instanceof Object&&"function"==typeof this.options.onReceivedMessage&&this.options.onReceivedMessage(t,e)}catch(t){this.options.onLogger("On Message Resolve Error: ",t)}},t.prototype.onHeartBeatReply=function(t){r.a.callFunction(this.callbackQueueList.onHeartBeatReplyQueue,t)},t.prototype.onClose=function(){var t=this,e=this.options.urlList.length;return r.a.callFunction(this.callbackQueueList.onCloseQueue),clearTimeout(this.HEART_BEAT_INTERVAL),this.options.retry?(this.checkRetryState()?setTimeout(function(){t.options.onLogger("Danmaku Websocket Retry .",t.state.retryCount),t.state.index+=1,0===e||t.state.retryCount>t.options.retryThreadCount?setTimeout(function(){t.initialize(t.options.url)},1e3*t.options.retryRoundInterval):0!==e&&t.state.index>e-1?(t.state.index=0,t.state.listConnectFinishedCount+=1,1===t.state.listConnectFinishedCount&&r.a.callFunction(t.callbackQueueList.onListConnectErrorQueue),setTimeout(function(){t.initialize(t.options.urlList[t.state.index])},1e3*t.options.retryRoundInterval)):t.initialize(t.options.urlList[t.state.index])},1e3*this.options.retryInterval):(this.options.onLogger("Danmaku Websocket Retry Failed."),r.a.callFunction(this.callbackQueueList.onRetryFallbackQueue)),this):this},t.prototype.onError=function(t){return this.options.onLogger("Danmaku Websocket On Error.",t),r.a.callFunction(this.callbackQueueList.onErrorQueue,t),this},t.prototype.destroy=function(){this.HEART_BEAT_INTERVAL&&clearTimeout(this.HEART_BEAT_INTERVAL),this.CONNECT_TIMEOUT&&clearTimeout(this.CONNECT_TIMEOUT),this.options.retry=!1,this.ws&&this.ws.close(),this.ws=null},t.prototype.convertToArrayBuffer=function(t,e){this.encoder||(this.encoder=r.a.getEncoder());var n=new ArrayBuffer(o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH),i=new DataView(n,o.a.WS_PACKAGE_OFFSET),s=this.encoder.encode(t);return i.setInt32(o.a.WS_PACKAGE_OFFSET,o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH+s.byteLength),this.wsBinaryHeaderList[2].value=e,this.wsBinaryHeaderList.forEach(function(t){4===t.bytes?i.setInt32(t.offset,t.value):2===t.bytes&&i.setInt16(t.offset,t.value)}),r.a.mergeArrayBuffer(n,s)},t.prototype.convertToObject=function(t){var e=new DataView(t),n={body:[]};if(n.packetLen=e.getInt32(o.a.WS_PACKAGE_OFFSET),this.wsBinaryHeaderList.forEach(function(t){4===t.bytes?n[t.key]=e.getInt32(t.offset):2===t.bytes&&(n[t.key]=e.getInt16(t.offset))}),n.packetLen<t.byteLength&&this.convertToObject(t.slice(0,n.packetLen)),this.decoder||(this.decoder=r.a.getDecoder()),!n.op||o.a.WS_OP_MESSAGE!==n.op&&n.op!==o.a.WS_OP_CONNECT_SUCCESS)n.op&&o.a.WS_OP_HEARTBEAT_REPLY===n.op&&(n.body={count:e.getInt32(o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH)});else for(var i=o.a.WS_PACKAGE_OFFSET,s=n.packetLen,a="",u="";i<t.byteLength;i+=s){s=e.getInt32(i),a=e.getInt16(i+o.a.WS_HEADER_OFFSET);try{if(n.ver===o.a.WS_BODY_PROTOCOL_VERSION_NORMAL){var c=this.decoder.decode(t.slice(i+a,i+s));u=0!==c.length?JSON.parse(c):null}else if(n.ver===o.a.WS_BODY_PROTOCOL_VERSION_BROTLI){var l=t.slice(i+a,i+s),h=window.BrotliDecode(new Uint8Array(l));u=this.convertToObject(h.buffer).body}u&&n.body.push(u)}catch(e){this.options.onLogger("decode body error:",new Uint8Array(t),n,e)}}return n},t.prototype.send=function(t){this.ws&&this.ws.send(t)},t.prototype.addCallback=function(t,e){return"function"==typeof t&&e instanceof Array&&e.push(t),this},t.prototype.mixinCallback=function(){var t=this.options,e=this.callbackQueueList;return this.addCallback(t.onReceivedMessage,e.onReceivedMessageQueue).addCallback(t.onHeartBeatReply,e.onHeartBeatReplyQueue).addCallback(t.onInitialized,e.onInitializedQueue).addCallback(t.onOpen,e.onOpenQueue).addCallback(t.onClose,e.onCloseQueue).addCallback(t.onError,e.onErrorQueue).addCallback(t.onRetryFallback,e.onRetryFallbackQueue).addCallback(t.onListConnectError,e.onListConnectErrorQueue).addCallback(t.onReceiveAuthRes,e.onReceiveAuthResQueue),this},t.prototype.getRetryCount=function(){return this.state.retryCount},t.prototype.checkRetryState=function(){var t=this.options,e=!1;return(0===t.retryMaxCount||this.state.retryCount<t.retryMaxCount)&&(this.state.retryCount+=1,e=!0),e},t.checkOptions=function(t){return t||t instanceof Object?t.url?null!=t.rid||(console.error("WebSocket Initialize options rid(cid) missing."),!1):(this.options.onLogger("WebSocket Initialize options url missing."),!1):(this.options.onLogger("WebSocket Initialize options missing or error.",t),!1)},t}();e.a=s},function(t,e,n){"use strict";var o=n(0),i=[{name:"Header Length",key:"headerLen",bytes:2,offset:o.a.WS_HEADER_OFFSET,value:o.a.WS_PACKAGE_HEADER_TOTAL_LENGTH},{name:"Protocol Version",key:"ver",bytes:2,offset:o.a.WS_VERSION_OFFSET,value:o.a.WS_HEADER_DEFAULT_VERSION},{name:"Operation",key:"op",bytes:4,offset:o.a.WS_OPERATION_OFFSET,value:o.a.WS_HEADER_DEFAULT_OPERATION},{name:"Sequence Id",key:"seq",bytes:4,offset:o.a.WS_SEQUENCE_OFFSET,value:o.a.WS_HEADER_DEFAULT_SEQUENCE}];e.a=i},function(t,e,n){"use strict";var o={getDecoder:function(){return window.TextDecoder?new window.TextDecoder:{decode:function(t){return decodeURIComponent(window.escape(String.fromCharCode.apply(String,new Uint8Array(t))))}}},getEncoder:function(){return window.TextEncoder?new window.TextEncoder:{encode:function(t){for(var e=new ArrayBuffer(t.length),n=new Uint8Array(e),o=0,i=t.length;o<i;o++)n[o]=t.charCodeAt(o);return e}}},mergeArrayBuffer:function(t,e){var n=new Uint8Array(t),o=new Uint8Array(e),i=new Uint8Array(n.byteLength+o.byteLength);return i.set(n,0),i.set(o,n.byteLength),i.buffer},callFunction:function(t,e){return t instanceof Array&&t.length?(t.forEach(function(t){return"function"==typeof t&&t(e)}),null):"function"==typeof t&&t(e)},extend:function(t){for(var e=arguments.length,n=Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];var i=t||{};return i instanceof Object&&n.forEach(function(t){t instanceof Object&&Object.keys(t).forEach(function(e){i[e]=t[e]})}),i}};e.a=o}])});
},{}],"MWvE":[function(require,module,exports) {
"use strict";var e,t,n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(t){i(t)}}function a(e){try{c(r.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})},r=this&&this.__generator||function(e,t){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=(o=s.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(a){i=[6,a],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},o=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},i=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SocketMsgType=void 0;var a,c=s(require("../sdk/socket-core.min.js")),u=require("@bilibili-live/web-player-common"),l=s(require("@bilibili-live/web-player-track"));function f(e){return n(this,void 0,Promise,function(){return r(this,function(t){switch(t.label){case 0:return[4,u.ajax("/xlive/web-room/v1/index/getDanmuInfo?id="+e+"&type=0")];case 1:return[2,t.sent()]}})})}!function(e){e.Danmaku="DANMU_MSG",e.SysMsg="SYS_MSG",e.SysGift="SYS_GIFT",e.GuardMsg="GUARD_MSG",e.SendGift="SEND_GIFT",e.Live="LIVE",e.Preparing="PREPARING",e.End="END",e.Close="CLOSE",e.Block="BLOCK",e.Round="ROUND",e.Welcome="WELCOME",e.Refresh="REFRESH",e.ActivityRedPacket="ACTIVITY_RED_PACKET",e.AreaBlock="ROOM_LIMIT",e.PkPre="PK_PRE",e.PkEnd="PK_END",e.PkSettle="PK_SETTLE",e.PkMicEnd="PK_MIC_END",e.HotRoomNotify="HOT_ROOM_NOTIFY",e.PLAY_TAG="PLAY_TAG",e.PLAY_PROGRESS_BAR="PLAY_PROGRESS_BAR",e.PlayerLogRecycle="LIVE_PLAYER_LOG_RECYCLE"}(a=exports.SocketMsgType||(exports.SocketMsgType={}));var h=function(){function s(n){this.opts=n,e.set(this,null),t.set(this,new u.EventBus),this.on=o(this,t).on,this.emit=o(this,t).emit,this.init().catch(function(e){u.logger.error(e)})}return s.prototype.init=function(){var t;return n(this,void 0,Promise,function(){var n,s,a=this;return r(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,f(this.opts.roomId)];case 1:return n=r.sent(),[3,3];case 2:return s=r.sent(),u.logger.error("get danmainfo failed "+u.any2Str(s)),n={host_list:[],token:"",max_delay:5e3},[3,3];case 3:return u.logger.info("Socket init, serverInfo: "+JSON.stringify(n)),i(this,e,new c.default({rid:this.opts.roomId,uid:null!==(t=this.opts.userId)&&void 0!==t?t:0,url:"wss://broadcastlv.chat.bilibili.com:443/sub",urlList:n.host_list.map(function(e){return"wss://"+e.host+":"+e.wss_port+"/sub"}),retry:!0,retryMaxCount:n.host_list.length,protover:3,customAuthParam:[{type:"string",key:"platform",value:"web"},{type:"number",key:"type",value:2},{type:"string",key:"key",value:n.token}],onOpen:function(){u.logger.info("WebSocket On Open")},onClose:function(){u.logger.info("WebSocket On Close.")},onError:function(t){u.logger.warn("WebSocket On Error. url: "+JSON.stringify(t.code)),d({type:1,evt:t.code,url:o(a,e).getState().url})},onInitialized:function(){u.logger.info("WebSocket Initialized.")},onReceivedMessage:function(e,t){u.wpd.SocketMsg2Console&&console.debug("socket onReceivedMessage: "+t,e),t>1&&p(t),[].concat(e).forEach(function(e){a.emit("message",e)})},onHeartBeatReply:function(e){a.emit("heartbeat",e)},onReceiveAuthRes:function(t){var n;u.logger.warn("token expired, reconnect."),null===(n=o(a,e))||void 0===n||n.destroy(),a.init().catch(function(e){u.logger.error(e)})},onListConnectError:function(){u.logger.info("WebSocket On List Connect Error."),d({type:2})},fallback:function(){u.logger.info("WebSocket Supporting Error.")},onLogger:function(e){u.logger.error(e)}})),[2]}})})},s.prototype.destroy=function(){var n;null===(n=o(this,e))||void 0===n||n.destroy(),o(this,t).destroy()},s}();function p(e){u.ajax("/xlive/open-interface/v1/dm/message_ack",{method:"POST",data:{terminal:0,sequence:e}}).catch(function(e){u.logger.error(e)})}function d(e){l.default.error(l.default.ErrorCode.SocketConnect,JSON.stringify(e))}exports.default=h,e=new WeakMap,t=new WeakMap;
},{"../sdk/socket-core.min.js":"EfpE","@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf"}],"xqO8":[function(require,module,exports) {
"use strict";var e,t,i,n,a,s,l,r,o,u,d,c,h,p,f,v,m,y,w,g,b,k,M,L,E,W,C,S,P,_,R,I,H,D,A,T,x,B,O=this&&this.__assign||function(){return(O=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},N=this&&this.__awaiter||function(e,t,i,n){return new(i||(i=Promise))(function(a,s){function l(e){try{o(n.next(e))}catch(t){s(t)}}function r(e){try{o(n.throw(e))}catch(t){s(t)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(l,r)}o((n=n.apply(e,t||[])).next())})},U=this&&this.__generator||function(e,t){var i,n,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function r(s){return function(r){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;l;)try{if(i=1,n&&(a=2&s[0]?n.return:s[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,s[1])).done)return a;switch(n=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return l.label++,{value:s[1],done:!1};case 5:l.label++,n=s[1],s=[0];continue;case 7:s=l.ops.pop(),l.trys.pop();continue;default:if(!(a=(a=l.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){l=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){l.label=s[1];break}if(6===s[0]&&l.label<a[1]){l.label=a[1],a=s;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(s);break}a[2]&&l.ops.pop(),l.trys.pop();continue}s=t.call(e,l)}catch(r){s=[6,r],n=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,r])}}},j=this&&this.__classPrivateFieldSet||function(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i},q=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},F=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var V=F(require("./replay.less")),G=require("@bilibili-live/web-player-common"),Y=require("@bilibili-live/web-player-socket"),z=F(require("@bilibili-live/web-player-track")),X=function(){return function(F,X,$,J){var K=this;this.ctrl=J,e.set(this,3600),t.set(this,300),i.set(this,document.createElement("div")),n.set(this,document.createElement("div")),a.set(this,document.createElement("div")),s.set(this,document.createElement("div")),l.set(this,document.createElement("div")),r.set(this,document.createElement("div")),o.set(this,null),u.set(this,new Map),d.set(this,0),c.set(this,void 0),h.set(this,void 0),p.set(this,[]),f.set(this,[]),v.set(this,0),m.set(this,{}),this.isReplay=!1,y.set(this,new G.EventBus),this.on=q(this,y).on,this.emit=q(this,y).emit,w.set(this,0),g.set(this,!0),b.set(this,!1),this.bakState={},k.set(this,!1),this.init=function(){var e,i=K.ctrl.onChange(function(e,t){return N(K,void 0,void 0,function(){return U(this,function(i){return"show"===e&&(this.changeReplayStyle(t),t||this.removeMouseMoveListener()),[2]})})}),n=q(K,M).call(K);n.addEventListener("touchstart",q(K,W)),n.addEventListener("mousedown",q(K,L));var a=0,s=function(){return N(K,void 0,Promise,function(){var e,t=this;return U(this,function(i){switch(i.label){case 0:return[4,q(this,T).call(this)];case 1:return i.sent()?(q(this,B).call(this),null===(e=q(this,o))||void 0===e||e.appendChild(n),a=window.setInterval(function(){q(t,D).call(t)},1e3),window.addEventListener("message",q(this,A)),[2]):[2]}})})};if(Date.now()/1e3-q(K,d)>=q(K,t))s().catch(function(e){G.logger.error(e)});else{var l=window.setInterval(function(){Date.now()/1e3-q(K,d)>=q(K,t)&&(s().catch(function(e){G.logger.error(e)}),clearInterval(l))},5e3);q(K,p).push(function(){return clearInterval(l)})}var r=null===(e=q(K,o))||void 0===e?void 0:e.getElementsByClassName("web-player-controller-wrap"),u=Date.now();null!=r&&r[0].classList.add("web-player-controller-"+u.toString()),q(K,p).push(i,function(){clearInterval(a)})},this.removeReplay=function(){q(K,p).forEach(function(e){return null==e?void 0:e()}),j(K,p,[]),window.removeEventListener("message",q(K,A)),q(K,n).remove(),q(K,n).removeEventListener("mousedown",q(K,L))},this.removeHighlight=function(e){var t=!1;return q(K,u).forEach(function(i,n){i.tag_id===e&&(q(K,u).delete(n),t=!0,n.remove())}),t},this.handleHighlight=function(e){K.removeHighlight(e.tag_id),"ADD"===e.type&&q(K,H).call(K,e),"DEL_ALL"===e.type&&q(K,u).forEach(function(e,t){q(K,u).delete(t),t.remove()})},this.changeReplayStyle=function(e){e?(q(K,i).classList.remove(V.default.replayHidden),q(K,i).classList.add(V.default.replayShow),q(K,l).classList.remove(V.default.progressHidden),q(K,l).classList.add(V.default.progressShow),q(K,a).style.display="block",q(K,s).classList.add(V.default.webPlayerReplayHighlightsShow),q(K,s).classList.remove(V.default.webPlayerReplayHighlightsHidden)):(q(K,i).classList.remove(V.default.replayShow),q(K,i).classList.add(V.default.replayHidden),q(K,l).classList.remove(V.default.progressShow),q(K,l).classList.add(V.default.progressHidden),q(K,a).style.display="none",q(K,s).classList.remove(V.default.webPlayerReplayHighlightsShow),q(K,s).classList.add(V.default.webPlayerReplayHighlightsHidden))},this.setProgress=function(e){q(K,r).style.width=e,q(K,a).style.left=e},this.removeMouseMoveListener=function(e){var t,i;if(null===(t=q(K,o))||void 0===t||t.removeEventListener("mousemove",q(K,E)),null!=e){var n=q(K,_).call(K,q(K,a).style.left);if(K.isReplay=0!==n,0===q(K,v)){var s=K.ctrl.getCtrlUI();j(K,g,Boolean(null===(i=s.danmaku)||void 0===i?void 0:i.display))}j(K,v,n),K.reload(n),window.removeEventListener("mouseup",K.removeMouseMoveListener),z.default.operation(z.default.OperationCode.TimeShift,{type:!0,timeShiftDuration:0}),j(K,w,performance.now())}},M.set(this,function(){return q(K,n).classList.add(V.default.webPlayerReplayContainer),q(K,i).classList.add(V.default.webPlayerReplayElement),q(K,l).classList.add(V.default.webPlayerReplayProgress),q(K,a).classList.add(V.default.webPlayerReplayCurrentPoint),q(K,r).classList.add(V.default.webPlayerReplayBar),q(K,s).classList.add(V.default.webPlayerReplayHighlights,V.default.webPlayerReplayHighlightsHidden),q(K,l).appendChild(q(K,a)),q(K,l).appendChild(q(K,r)),q(K,i).appendChild(q(K,l)),q(K,i).appendChild(q(K,s)),q(K,n).appendChild(q(K,i)),q(K,n)}),L.set(this,function(e){var t;if(!e.target.className.includes("highlight")){var i=q(K,P).call(K,e);K.setProgress(i),window.addEventListener("mouseup",K.removeMouseMoveListener),null===(t=q(K,o))||void 0===t||t.addEventListener("mousemove",q(K,E))}}),E.set(this,function(e){var t=q(K,P).call(K,e);q(K,r).style.width=t,q(K,a).style.left=t}),W.set(this,function(e){j(K,k,!1),q(K,n).addEventListener("touchmove",q(K,S)),q(K,n).addEventListener("touchend",q(K,C))}),C.set(this,function(e){q(K,n).removeEventListener("touchmove",q(K,S)),q(K,n).removeEventListener("touchend",q(K,C)),q(K,k)&&(j(K,k,!1),K.removeMouseMoveListener(e.changedTouches[0]))}),S.set(this,function(e){j(K,k,!0);var t=q(K,P).call(K,e.touches[0]);q(K,r).style.width=t,q(K,a).style.left=t}),P.set(this,function(e){var t,n=Number(null!==(t=getComputedStyle(document.documentElement).zoom)&&void 0!==t?t:1),a=e.clientX/n-q(K,i).getBoundingClientRect().left;a=a<0?0:a;var s=q(K,i).clientWidth;return(a/s>1?100:a/s*100).toFixed(2)+"%"}),_.set(this,function(t){var i=parseFloat(t.split("%")[0]),n=Date.now()/1e3-q(K,d);return n=n>q(K,e)?q(K,e):n,Math.round(n*(100-i)/100)}),R.set(this,function(t){var i=Date.now()/1e3,n=i-q(K,d);n=n>q(K,e)?q(K,e):n;var a=Math.round(i-t);return{timeShift:a,left:(100-100*a/n).toFixed(2)+"%"}}),I.set(this,function(){var e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div");return e.classList.add(V.default.backliveBtnContainer),t.classList.add(V.default.backliveBtn),i.classList.add(V.default.backliveDot),t.appendChild(i),t.append("返回直播"),t.onclick=function(){K.setProgress("100%"),K.returnLive(),K.emit("timeShiftChange",0),z.default.operation(z.default.OperationCode.TimeShift,{type:!1,timeShiftDuration:Math.round(performance.now()-q(K,w))}),j(K,w,0)},e.appendChild(t),e}),H.set(this,function(e){var t=document.createElement("div");t.classList.add(V.default.highlightItem);var i='<div class="'+V.default.highlightPot+'"></div>';null!=e.pic&&""!==e.pic&&(i+='\n      <div class="'+V.default.highlightIcon+'">\n        <div class="'+V.default.highlightImg+'" style="background-image: url('+e.pic+')">\n        </div>\n      </div>\n      '),t.innerHTML=i,t.onclick=function(){var t,i=q(K,R).call(K,e.timestamp),n=i.timeShift,a=i.left;if(K.setProgress(a),0===q(K,v)){var s=K.ctrl.getCtrlUI();j(K,g,Boolean(null===(t=s.danmaku)||void 0===t?void 0:t.display))}j(K,v,n),K.isReplay=0!==n,K.reload(n),z.default.operation(z.default.OperationCode.TimeShift,{type:!0,isHighlight:!0,timeShiftDuration:0}),j(K,w,performance.now())},q(K,u).set(t,O(O({},e),{isAppend:!1,left:""}))}),D.set(this,function(){q(K,u).forEach(function(e,t){var i=q(K,R).call(K,e.timestamp);i.left.includes("-")?(t.remove(),q(K,u).delete(t)):(t.style.left=i.left,q(K,u).set(t,O(O({},e),i)),e.isAppend||(q(K,u).set(t,O(O({},e),{isAppend:!0})),q(K,s).appendChild(t)))})}),A.set(this,function(e){var t=e.origin.split("://");if(t.length>=2&&/^(?:uat-)?mlive\.bilibili\.co(?::\d+)?$/.test(t[1].split("/")[0])||"production".includes("dev")){var i=e.data;"previewPlaybackTimelineAnchor"===i.type&&K.handleHighlight({tag_id:0,timestamp:i.data.time,pic:i.data.iconUrl,type:"ADD"})}}),T.set(this,function(){return N(K,void 0,Promise,function(){var e,t=this;return U(this,function(i){switch(i.label){case 0:return q(this,u).forEach(function(e,i){q(t,u).delete(i),i.remove()}),[4,G.ajax("/xlive/web-room/v1/index/getProgressBarInfo?roomid="+q(this,h)+"&platform=web")];case 1:return e=i.sent(),q(this,b)?[2,!1]:(null!=e.play_tag_list&&"ENABLE"===e.bar_status&&e.play_tag_list.forEach(function(e){t.handleHighlight(O(O({},e),{type:"ADD"}))}),[2,"ENABLE"===e.bar_status])}})})}),x.set(this,function(e){return e.on("message",function(e){switch(e.cmd){case Y.SocketMsgType.PLAY_TAG:K.handleHighlight(e.data);break;case Y.SocketMsgType.PLAY_PROGRESS_BAR:var t=e.data,i=t.platform,n=t.type;if(!i.includes("web"))return;if(["DISABLE","LIMIT"].includes(n)){if(K.isReplay){var a=K.on("timeShiftChange",function(e){0===e&&(K.removeReplay(),a())});return void q(K,p).push(a)}K.removeReplay()}else if(null!=q(K,h)){var s=Number(e.data.scatter.min),l=Number(e.data.scatter.max),r=setTimeout(function(){K.init()},Math.floor(1e3*(Math.random()*(l-s)+s)));q(K,p).push(function(){clearTimeout(r)})}}})}),this.destroy=function(){j(K,b,!0),K.removeReplay()},this.returnLive=function(){q(K,f).forEach(function(e){return e()}),j(K,f,[]),K.setProgress("100%"),K.emit("backLive");var e=K.ctrl.getCtrlUI();e.ctrlItemVisibility=O(O({},e.ctrlItemVisibility),q(K,m)),e.onChange("danmaku",{display:q(K,g)}),K.isReplay=!1,j(K,v,0)},this.reload=function(e){if(void 0===e&&(e=q(K,v)),q(K,f).forEach(function(e){return e()}),j(K,f,[]),0!==e){var t=K.ctrl.getCtrlUI();t.onChange("danmaku",{display:!1}),0===Object.keys(q(K,m)).length&&j(K,m,O({},t.ctrlItemVisibility)),t.ctrlItemVisibility=O(O({},t.ctrlItemVisibility),{rightSetting:!1,quality:!1,danmaku:!1}),q(K,f).push(t.appendCtrlItem(q(K,c))),K.isReplay=!0}else K.returnLive();K.emit("timeShiftChange",e)},B.set(this,function(){var e=K.ctrl.getCtrlUI();q(K,n).style.visibility="hidden",q(K,p).push(K.ctrl.onChange(function(e,t){"show"===e&&(!1===t&&0===q(K,v)?q(K,n).style.visibility="hidden":q(K,n).style.visibility="visible")}),K.on("timeShiftChange",function(t){0!==t||e.show?q(K,n).style.visibility="visible":q(K,n).style.visibility="hidden"}))}),j(this,o,F),j(this,d,X.live_time),j(this,h,X.rid),q(this,u).clear(),j(this,c,q(this,I).call(this)),q(this,p).push(q(this,x).call(this,$))}}();exports.default=X,e=new WeakMap,t=new WeakMap,i=new WeakMap,n=new WeakMap,a=new WeakMap,s=new WeakMap,l=new WeakMap,r=new WeakMap,o=new WeakMap,u=new WeakMap,d=new WeakMap,c=new WeakMap,h=new WeakMap,p=new WeakMap,f=new WeakMap,v=new WeakMap,m=new WeakMap,y=new WeakMap,w=new WeakMap,g=new WeakMap,b=new WeakMap,k=new WeakMap,M=new WeakMap,L=new WeakMap,E=new WeakMap,W=new WeakMap,C=new WeakMap,S=new WeakMap,P=new WeakMap,_=new WeakMap,R=new WeakMap,I=new WeakMap,H=new WeakMap,D=new WeakMap,A=new WeakMap,T=new WeakMap,x=new WeakMap,B=new WeakMap;
},{"./replay.less":"XQD5","@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-socket":"MWvE","@bilibili-live/web-player-track":"ESUf"}],"blC7":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.connectMirror=exports.connectVideoPip=exports.connectVideoLoading=exports.connectUIandVideo=void 0;var t=require("@bilibili-live/web-player-common"),n=require("@bilibili-live/web-player-video"),r=e(require("@bilibili-live/web-player-track"));function i(e,n){var r=e.getCtrlUI(),i=n.getVideoEl();if(null==i||null==r)return function(){};var o=t.userSetting.getVolume();null!=o&&(i.volume=o.value/100,i.muted=o.disabled,r.volume={disabled:i.muted,value:100*i.volume});var u=function(){r.playStatus=!0},a=function(){r.playStatus=!1},l=function(){n.getVideoEl().paused&&e.show()},c=function(e){null!=r.volume&&(r.volume={disabled:i.muted,value:100*i.volume})};i.addEventListener("playing",u),i.addEventListener("pause",a),i.addEventListener("loadeddata",l),i.addEventListener("volumechange",c);var d=e.onChange(function(e,n){if("playStatus"===e)n?i.play().catch(function(e){t.logger.error(e)}):i.pause();else if("volume"===e){var r=n,o=r.disabled,u=r.value;i.muted=o,i.volume=u/100}});return function(){d(),i.removeEventListener("playing",u),i.removeEventListener("pause",a),i.removeEventListener("loadeddata",l),i.removeEventListener("volumechange",c)}}function o(e,r,i){var o,u=function(){o=t.loading(r)},a=function(){null==o||o()},l=e.on(n.EventType.WaitStart,function(){u()}),c=e.on(n.EventType.WaitEnd,a);return e.once(n.EventType.FirstFrame,function(){a(),t.coverImg(null,r)}),null==i||""===i?(u(),t.coverImg(null,r)):t.coverImg(i,r),function(){l(),c(),a()}}function u(e,i){var o=function(){null!=document.pictureInPictureElement&&document.exitPictureInPicture().catch(function(e){t.logger.error(e)})},u=e.on(n.EventType.Destroyed,function(){o(),c.pipStatus=!1,u()}),a=i.onChange(function(t,n){if("pipStatus"===t&&document.pictureInPictureEnabled){if(n){var r=e.getVideoEl();return o(),void r.requestPictureInPicture()}o()}}),l=e.getVideoEl(),c=i.getCtrlUI(),d=0,v=function(){r.default.operation(r.default.OperationCode.PictureInPicture,Math.floor((performance.now()-d)/1e3),{sampleRate:1})},s=function(){c.pipStatus=!1,v()},p=function(){d=performance.now()},f=function(){null!=document.pictureInPictureElement&&v()};return l.addEventListener("leavepictureinpicture",s),l.addEventListener("enterpictureinpicture",p),window.addEventListener("beforeunload",f),function(){a(),l.removeEventListener("leavepictureinpicture",s),l.removeEventListener("enterpictureinpicture",p),window.removeEventListener("beforeunload",f),o()}}function a(e,t){!0===t.getCtrlUI().mirrorStatus&&(e.getVideoEl().style.transform="rotateY(180deg)");var n=t.onChange(function(t,n){if("mirrorStatus"===t){var r=e.getVideoEl();r.style.transform=!0!==n?"":"rotateY(180deg)"}});return function(){n()}}exports.connectUIandVideo=i,exports.connectVideoLoading=o,exports.connectVideoPip=u,exports.connectMirror=a;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-track":"ESUf"}],"fyPa":[function(require,module,exports) {
"use strict";var t,e,i,r,n,s,o,h,a,l,c,d,p,g,f,u,w,_,m,b,k,v,y=this&&this.__assign||function(){return(y=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)},x=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(n,s){function o(t){try{a(r.next(t))}catch(e){s(e)}}function h(t){try{a(r.throw(t))}catch(e){s(e)}}function a(t){var e;t.done?n(t.value):(e=t.value,e instanceof i?e:new i(function(t){t(e)})).then(o,h)}a((r=r.apply(t,e||[])).next())})},T=this&&this.__generator||function(t,e){var i,r,n,s,o={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return s={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function h(s){return function(h){return function(s){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(n=2&s[0]?r.return:s[0]?r.throw||((n=r.return)&&n.call(r),0):r.next)&&!(n=n.call(r,s[1])).done)return n;switch(r=0,n&&(s=[2&s[0],n.value]),s[0]){case 0:case 1:n=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(n=(n=o.trys).length>0&&n[n.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!n||s[1]>n[0]&&s[1]<n[3])){o.label=s[1];break}if(6===s[0]&&o.label<n[1]){o.label=n[1],n=s;break}if(n&&o.label<n[2]){o.label=n[2],o.ops.push(s);break}n[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(h){s=[6,h],r=0}finally{i=n=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,h])}}},M=this&&this.__classPrivateFieldSet||function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},E=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var W,R=require("@bilibili-live/web-player-common");!function(t){t[t.Normal=1]="Normal",t[t.Text=2]="Text"}(W||(W={}));var B=R.isWebPSupported(),S=function(){return function(S){var I=this;this.container=S,t.set(this,void 0),e.set(this,void 0),i.set(this,null),r.set(this,0),n.set(this,0),s.set(this,new Map),o.set(this,new Map),h.set(this,[]),a.set(this,0),l.set(this,[]),c.set(this,!1),this.onSei=function(t){E(I,w).call(I,t).catch(function(t){throw R.logger.error("贴纸加载失败"),new Error(t)})},this.onVideoInfo=function(i){i.width!==E(I,t).width&&i.height!==E(I,t).height&&(M(I,t,i),M(I,e,{width:0,height:0}))},d.set(this,function(t){var e,i;E(I,s).has(t.sticker_id)||E(I,c)||(M(I,c,!0),t.sticker_type===W.Text?(null===(e=E(I,s).get(t.sticker_id))||void 0===e||e.el.remove(),E(I,s).set(t.sticker_id,E(I,p).call(I,t))):(null===(i=E(I,s).get(t.sticker_id))||void 0===i||i.el.remove(),E(I,s).set(t.sticker_id,E(I,g).call(I,t))))}),p.set(this,function(t){R.logger.info("create text sticker, id: "+t.sticker_id);var i=new Image,s=document.createElement("div"),h=E(I,o).get(t.sticker_id);return i.onload=function(){I.container.append(i),h.stretch.top_margin=(i.height-3)/2,h.stretch.bottom_margin=i.height/2,E(I,o).set(t.sticker_id,y(y({},h),{width:i.width,height:i.height}));var a=E(I,f).call(I,h,i.getBoundingClientRect(),t),l=document.createElement("span");l.innerText=t.sticker_title,l.style.cssText="\n        color: "+t.sticker_title_color+";\n        font-size: "+(a.borderBottom+a.borderTop)+"px;\n        position: absolute;\n        z-index: 4;\n        visibility: hidden;\n        word-break: keep-all;\n        white-space: no-wrap;\n        transform: scale(0.3);\n        transform-origin: 0 0;\n        white-space: nowrap;\n        cursor: default;\n        user-select: none;\n      ",I.container.append(l),l.style.cssText+="\n        top: -"+2.2*h.title.bottom_margin/i.height*(a.borderBottom+a.borderTop)+"px;\n        left: -"+(3*h.title.right_margin/i.width*a.width-.3*a.height)+"px;\n      ",s.style.cssText="\n        transition: all .1s ease-in-out;\n        position: absolute;\n        z-index: 4;\n        border-style: solid;\n        border-color: transparent;\n        border-left-width: "+a.borderLeft+"px;\n        border-right-width: "+a.borderRight+"px;\n        border-top-width: "+a.borderTop+"px;\n        border-bottom-width: "+a.borderBottom+"px;\n        width: "+(l.getBoundingClientRect().width-a.borderRight+.5*a.height)+"px;\n        border-image-source: url("+h.url+");\n        border-image-repeat: stretch stretch;\n        border-image-slice: "+h.stretch.top_margin+" "+h.stretch.right_margin+" "+h.stretch.bottom_margin+" "+h.stretch.left_margin+" fill;\n      ",s.append(l),I.container.append(s);var d=E(I,e).width,p=E(I,e).height;d-=s.getBoundingClientRect().width,p=p-a.borderBottom-a.borderTop-l.getBoundingClientRect().height,t.display_width-t.sticker_right_offset<2?s.style.cssText+="\n            left: "+(E(I,n)+d)+"px;\n            top: "+(E(I,r)+Math.min(t.sticker_top_offset*E(I,e).height/t.display_height,p))+"px;\n          ":s.style.cssText+="\n            left: "+(E(I,n)+Math.min(t.sticker_left_offset*E(I,e).width/t.display_width,d))+"px;\n            top: "+(E(I,r)+Math.min(t.sticker_top_offset*E(I,e).height/t.display_height,p))+"px;\n          ",l.style.visibility="visible",i.remove(),M(I,c,!1)},i.src=B?h.url:h.url.replace(".webp",".gif"),i.style.visibility="hidden",{el:s,sei:t,width:0,height:0}}),g.set(this,function(t){R.logger.info("create img sticker, id: "+t.sticker_id);var i=new Image,s=E(I,o).get(t.sticker_id);return I.container.append(i),i.onload=function(){var h=E(I,e).width,a=E(I,e).height,l=E(I,f).call(I,s,i.getBoundingClientRect(),t);a-=l.height,h-=l.width,i.style.cssText="\n          transition: all .1s ease-in-out;\n          position: absolute;\n          z-index: 4;\n        ",t.display_width-t.sticker_right_offset<2?i.style.cssText+="\n            left: "+(E(I,n)+h)+"px;\n            top: "+(E(I,r)+Math.min(t.sticker_top_offset*E(I,e).height/t.display_height,a))+"px;\n          ":i.style.cssText+="\n            left: "+(E(I,n)+Math.min(t.sticker_left_offset*E(I,e).width/t.display_width,h))+"px;\n            top: "+(E(I,r)+Math.min(t.sticker_top_offset*E(I,e).height/t.display_height,a))+"px;\n          ",E(I,o).set(t.sticker_id,y(y({},s),{width:i.width,height:i.height})),i.width=l.width,M(I,c,!1)},i.src=B?s.url:s.url.replace(".webp",".gif"),{el:i,sei:t,width:0,height:0}}),this.batchUpdateStickerElement=function(){E(I,s).forEach(function(t,e){E(I,u).call(I,e)})},f.set(this,function(t,i,r){var n={width:0,height:0,top:0,left:0,borderLeft:0,borderRight:0,borderTop:0,borderBottom:0};if(n.height=E(I,e).height*(r.sticker_bottom_offset-r.sticker_top_offset)/r.display_height/1.1,n.width=n.height*i.width/i.height,t.sticker_type===W.Text){var s=t,o=s.stretch,h=o.top_margin,a=o.left_margin,l=o.right_margin,c=o.bottom_margin,d=s.title,p=d.top_margin,g=d.left_margin;n.borderBottom=n.height/(c+h)*c,n.borderLeft=n.width/(a+l)*a,n.borderRight=n.width/(a+l)*l,n.borderTop=n.height/(c+h)*h,n.left=g*n.width/i.width,n.top=p*n.width/i.width}return n}),u.set(this,function(t){var i=E(I,s).get(t),h=E(I,o).get(t);if(null!=i&&null!=h){var a=E(I,f).call(I,h,{width:h.width,height:h.height},i.sei),l=E(I,e).width,c=E(I,e).height;if(i.sei.sticker_type===W.Text){var d=h,p=i.el,g=p.firstElementChild;if(null==g)return void E(I,v).call(I);var u=a.borderBottom+a.borderTop;g.style.fontSize=u.toString()+"px",g.innerText=String(i.sei.sticker_title);var w=g.getBoundingClientRect().width-a.borderRight+.5*a.height;w=w>0?w:0,p.style.cssText+="\n          border-left-width: "+a.borderLeft+"px;\n          border-right-width: "+a.borderRight+"px;\n          border-top-width: "+a.borderTop+"px;\n          border-bottom-width: "+a.borderBottom+"px;\n          width: "+w+"px;\n        ",g.style.cssText+="\n          top: -"+2.2*d.title.bottom_margin/d.height*(a.borderBottom+a.borderTop)+"px;\n          color: "+i.sei.sticker_title_color+";\n          left: -"+(3*d.title.right_margin/h.width*a.width-.3*a.height)+"px;\n        ",l=l-a.borderLeft-a.borderRight-w,c=c-a.borderBottom-a.borderTop-g.getBoundingClientRect().height}else i.el.width=a.width,c-=a.height,l-=a.width;i.el.style.cssText+="\n        display: block;\n      ",i.sei.display_width-i.sei.sticker_right_offset<2?i.el.style.cssText+="\n          left: "+(E(I,n)+l)+"px;\n          top: "+(E(I,r)+Math.min(i.sei.sticker_top_offset*E(I,e).height/i.sei.display_height,c))+"px;\n        ":i.el.style.cssText+="\n          left: "+(E(I,n)+Math.min(i.sei.sticker_left_offset*E(I,e).width/i.sei.display_width,l))+"px;\n          top: "+(E(I,r)+Math.min(i.sei.sticker_top_offset*E(I,e).height/i.sei.display_height,c))+"px;\n        "}}),w.set(this,function(i){return x(I,void 0,Promise,function(){var r,n,h,c,p,g=this;return T(this,function(f){if(0===E(this,t).width)return[2];if(!i.includes("LIVE_STICKER"))return[2];if(r=JSON.parse(i),0===E(this,e).width&&(E(this,m).call(this,r.LIVE_STICKER[0]),this.batchUpdateStickerElement()),clearTimeout(E(this,a)),0===r.LIVE_STICKER.length)return E(this,v).call(this),[2];for(E(this,s).forEach(function(t,e){for(var i,n=!0,o=0,h=r.LIVE_STICKER;o<h.length;o++)h[o].sticker_id===e&&(n=!1);n&&(null===(i=t.el)||void 0===i||i.remove(),R.logger.info("remove sticker id: "+t.sei.sticker_id),E(g,s).delete(e))}),n=0,h=r.LIVE_STICKER;n<h.length;n++)if(c=h[n],E(this,s).has(c.sticker_id))(null==(p=E(this,s).get(c.sticker_id))?void 0:p.sei.hash)!==c.hash&&(null!=p?(E(this,s).set(c.sticker_id,y(y({},p),{sei:c})),E(this,u).call(this,c.sticker_id)):(R.logger.info("2remove sticker id: "+c.sticker_id),E(this,s).delete(c.sticker_id)));else if(E(this,o).has(c.sticker_id))E(this,d).call(this,c);else{if(E(this,l).includes(c.group_id))return[2];E(this,l).push(c.group_id),E(this,k).call(this,c.group_id,c).catch(function(t){R.logger.error(t)})}return[2]})})}),_.set(this,function(){window.addEventListener("resize",E(I,b)),document.addEventListener("fullscreenchange",E(I,b)),E(I,h).push(function(){window.removeEventListener("resize",E(I,b)),document.removeEventListener("fullscreenchange",E(I,b))})}),this.calcDisplayInfo=function(){if(null!=E(I,i)){var s=I.container.getBoundingClientRect().height,o=I.container.getBoundingClientRect().width,h=E(I,t).width,a=E(I,t).height;s/a<o/h?(M(I,e,{width:s*h/a,height:s*h/a*E(I,i).display_height/E(I,i).display_width}),M(I,r,E(I,e).width*E(I,i).display_height/E(I,i).display_width*.2),M(I,n,(o-E(I,e).width)/2)):(M(I,n,0),M(I,e,{width:o,height:o*E(I,i).display_height/E(I,i).display_width}),M(I,r,(s-E(I,e).width/7*4)/2+E(I,e).width/14))}},m.set(this,function(t){M(I,i,t),null!=t&&I.calcDisplayInfo()}),this.destroy=function(){E(I,v).call(I),M(I,c,!1),E(I,h).forEach(function(t){return t()}),M(I,h,[]),M(I,t,{width:0,height:0}),M(I,e,{width:0,height:0}),M(I,l,[])},b.set(this,function(){I.calcDisplayInfo(),I.batchUpdateStickerElement()}),k.set(this,function(t,e){return x(I,void 0,Promise,function(){var i=this;return T(this,function(r){return R.ajax.disperse("/xlive/web-room/v1/stickers/getStickers",{scope:1e3*e.request_random_sec_range,expiresTime:performance.now()+1e3*e.request_random_sec_range}),R.ajax("/xlive/web-room/v1/stickers/getStickers?id="+t).then(function(t){for(var r=0,n=t.pic_stickers;r<n.length;r++){var s=n[r];E(i,o).has(s.id)||E(i,o).set(s.id,s)}for(var h=0,a=t.text_stickers;h<a.length;h++){var l=a[h];E(i,o).has(l.id)||(l.stretch.top_margin*=3,l.stretch.left_margin*=3,l.stretch.right_margin*=3,l.stretch.bottom_margin*=3,E(i,o).set(l.id,l))}E(i,d).call(i,e)}).catch(function(t){R.logger.error(t)}),[2]})})}),v.set(this,function(){E(I,s).forEach(function(t){var e=t.el;null==e||e.remove()}),E(I,s).clear()}),M(this,t,{width:0,height:0}),M(this,e,{width:0,height:0}),E(this,_).call(this)}}();exports.default=S,t=new WeakMap,e=new WeakMap,i=new WeakMap,r=new WeakMap,n=new WeakMap,s=new WeakMap,o=new WeakMap,h=new WeakMap,a=new WeakMap,l=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,g=new WeakMap,f=new WeakMap,u=new WeakMap,w=new WeakMap,_=new WeakMap,m=new WeakMap,b=new WeakMap,k=new WeakMap,v=new WeakMap;
},{"@bilibili-live/web-player-common":"KGHo"}],"OKfi":[function(require,module,exports) {
var define;
var e;!function(r,o){"object"==typeof exports&&"object"==typeof module?module.exports=o():"function"==typeof e&&e.amd?e([],o):"object"==typeof exports?exports.WasmPlayerLoader=o():r.WasmPlayerLoader=o()}(self,function(){return function(){"use strict";var e={d:function(r,o){for(var n in o)e.o(o,n)&&!e.o(r,n)&&Object.defineProperty(r,n,{enumerable:!0,get:o[n]})},o:function(e,r){return Object.prototype.hasOwnProperty.call(e,r)}},r={};function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}e.d(r,{default:function(){return E}});var n=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11]);function t(){try{return"undefined"!=typeof MessageChannel&&(new MessageChannel).port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(n)}catch(e){return!1}}var a=new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11]);function i(){try{return WebAssembly.validate(a)}catch(e){return!1}}function s(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"video/mp4",n=document.createElement("video");if("function"!=typeof n.canPlayType||"function"!=typeof(null===(r=window.MediaSource)||void 0===r?void 0:r.isTypeSupported))return!1;var t="".concat(o,'; codecs="').concat(e,'"'),a=n.canPlayType(t).toLowerCase();return!("maybe"!==a&&"probably"!==a||!window.MediaSource.isTypeSupported(t))}function c(){var e,r,o=document.createElement("canvas"),n="",t="";try{(e=o.getContext("webgl")||o.getContext("webgl2")||o.getContext("experimental-webgl"))&&(r=e.getExtension("WEBGL_debug_renderer_info"))&&(n=e.getParameter(r.UNMASKED_VENDOR_WEBGL),t=e.getParameter(r.UNMASKED_RENDERER_WEBGL))}catch(e){return null}return{vendor:n,renderer:t}}var u="name",w="version";function l(e,r){for(var n,t,a,i,s,c={},u=0;u<r.length;u+=2){n=r[u],a=r[u+1];for(var w=0;w<n.length;w++)if(s=n[w].exec(e)){for(var l=0;l<a.length;l++)i=s[l+1],"object"===o(t=a[l])&&t.length>0?2===t.length?c[t[0]]=t[1]:console.error("[Browser] [rgxMapper] not support arg count!"):c[t]=i||void 0;return c}}return c}var d=function(){var e="undefined"!=typeof window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:null,r="other",o="other",n="0";if(null!==e){r=function(e){var r=l(e,[[/microsoft (windows) (vista|xp)/i],"",[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[/ ]?([\d.\w ]*)/i,/(windows)[/ ]?([ntce\d. ]+\w)(?!.+xbox)/i],[u],[/(win(?=3|9|n)|win 9x )([nt\d.]+)/i],"Windows",[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[u,"iOS"]],[/(mac os x) ?([\w. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[u,"Mac OS"]]]).name;return{Windows:!0,"Mac OS":!0}[r]?r:"other"}(e);var a=function(e){var r=l(e,[[/edg(?:e|ios|a)?\/([\w.]+)/i],[w,[u,"Edge"]],[/\bopr\/([\w.]+)/i],[w,[u,"Opera"]],[/(kindle)\/([\w.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[/ ]?([\w.]*)/i,/(avant |iemobile|slim)(?:browser)?[/ ]?([\w.]*)/i,/(ba?idubrowser)[/ ]?([\w.]+)/i,/(?:ms|\()(ie) ([\w.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale|qqbrowserlite|qq)\/([-\w.]+)/i,/(weibo)__([\d.]+)/i],[u,w],[/(?:\buc? ?browser|(?:juc.+)ucweb)[/ ]?([\w.]+)/i],[w,[u,"UCBrowser"]],[/\bqbcore\/([\w.]+)/i],[w,[u,"WeChat(Win) Desktop"]],[/micromessenger\/([\w.]+)/i],[w,[u,"WeChat"]],[/konqueror\/([\w.]+)/i],[w,[u,"Konqueror"]],[/trident.+rv[: ]([\w.]{1,9})\b.+like gecko/i],[w,[u,"IE"]],[/yabrowser\/([\w.]+)/i],[w,[u,"Yandex"]],[/(avast|avg)\/([\w.]+)/i],[[u,"Avast/AVG Secure Browser"],w],[/coc_coc\w+\/([\w.]+)/i],[w,[u,"Coc Coc"]],[/dolfin\/([\w.]+)/i],[w,[u,"Dolphin"]],[/slbrowser\/([\w.]+)/i],[w,[u,"Lenovo"]],[/115browser\/([\w.]+)/i],[w,[u,"115 Browser"]],[/\bqihu|(qi?ho?o?|360)browser/i],[[u,"360 Browser"]],[/(comodo_dragon)\/([\w.]+)/i],[[u,"Comodo Dragon"],w],[/(electron)\/([\w.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[/ ]?([\w.]+)/i],[u,w],[/(metasr)[/ ]?([\w.]+)/i,/(lbbrowser)/i],[u],[/headlesschrome(?:\/([\w.]+)| )/i],[w,[u,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w.]+)/i],[[u,"Chrome WebView"],w],[/(chrome)\/v?([\w.]+)/i],[[u,"Chrome"],w]]);return{browser:{Chrome:!0,Edge:!0}[r.name]?r.name:"other",version:r.version||"0"}}(e);o=a.browser,n=a.version}return{ua:e||"",os:r,browser:o,version:n,gpuInfo:c,hardwareConcurrency:window.navigator.hardwareConcurrency||0,isSIMDSupported:i,isPThreadSupported:t,isSupportHEVC:s("hvc1.1.6.L123")}},p="5.0.5",f="1"===window.localStorage.getItem("_wasm_player_debug_")||!1,m={BROWSER_LIST:{Chrome:{min:80,blackList:[]},Edge:{min:80,blackList:[]}},OS_LIST:{Windows:!0,"Mac OS":!0},GPU_LIST:[],BASE_CPU_CORE_NUMBER:4};function b(){if(f){for(var e,r=arguments.length,o=new Array(r),n=0;n<r;n++)o[n]=arguments[n];(e=console).log.apply(e,["[WasmPlayerLoader]"].concat(o))}}var y=navigator.userAgent,v="wasm_player_supported",h=!1,g=null,S={browser:!1,browserHEVC:!1,cpu:!1,gpu:!1,gpuInfo:null,simd:!1,pthread:!1,hardwareConcurrency:0};function C(){if(null!==g)return g;var e=JSON.parse(localStorage.getItem(v)||"null"),r=(null==e?void 0:e.version)===p;if(e&&r&&e.ua===y)null!=e&&e.supported?(g=!0,null!=e&&e.cached?(b("SUPPORT! Already cached!"),h=!0):(b("SUPPORT! But not cache done!"),S=e.supportInfo,h=!1)):g=!1;else{h=Boolean(e&&e.cached&&r);var o=function(){var e=+new Date,r=!1,o=d(),n=m.BROWSER_LIST[o.browser],t=!!m.OS_LIST[o.os]&&!!n&&parseFloat("".concat(o.version))>=n.min,a=o.isSupportHEVC,i=o.hardwareConcurrency>=m.BASE_CPU_CORE_NUMBER;a&&"Chrome"===o.browser&&(b("use browser HEVC!"),r=!0,t=!0);var s=r?null:o.gpuInfo(),c=!r&&!!o.gpuInfo(),u=!r&&o.isPThreadSupported(),w=!r&&o.isSIMDSupported(),l=!!r||!!(u&&i&&c&&t);return b("supportedChecker end spent: ".concat(+new Date-e,"ms")),{pass:l,supportInfo:{browser:t,browserHEVC:a,cpu:i,gpu:c,gpuInfo:s,simd:w,pthread:u,hardwareConcurrency:o.hardwareConcurrency},isUseNativeHEVC:r}}();S=o.supportInfo,g=o.pass,b("supportInfo:",S),o.isUseNativeHEVC&&(b("IsUseNativeHEVC set cached true!"),h=!0),function(e){var r=JSON.stringify({version:p,ua:y,supported:e,supportInfo:S,cached:h,date:+new Date});localStorage.setItem(v,r)}(g)}return g||!1}var E={loadWasmPlayer:function(){return new Promise(function(e,r){C()?function(e,r){b("start load WasmPlayer SDK");var o=+new Date,n=function(){window.WasmPlayer?(b("load done WasmPlayer SDK, spent: ".concat(+new Date-o," ms")),h?e():window.WasmPlayer.preloadBwp(function(o){o?e():r(new Error("Cache WasmPlayer lib error, please retry!"))})):r(new Error("Can not get WasmPlayer Instance!"))};if(window.WasmPlayer)n();else{var t=document.createElement("script");t.type="text/javascript",t.setAttribute("async","async"),t.src="//s1.hdslb.com/bfs/static/wasm-player/wasm-player-5.0.5.min.js",document.body.appendChild(t),t.addEventListener("load",n),t.addEventListener("error",function(){r(new Error("load SDK error!"))})}}(e,r):r(new Error("Not Support!"))})},isHEVCSupported:C,isBwpSupported:C};return r.default}()});
},{}],"lCVI":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,r,t,o){return new(t||(t=Promise))(function(n,i){function u(e){try{s(o.next(e))}catch(r){i(r)}}function a(e){try{s(o.throw(e))}catch(r){i(r)}}function s(e){var r;e.done?n(e.value):(r=e.value,r instanceof t?r:new t(function(e){e(r)})).then(u,a)}s((o=o.apply(e,r||[])).next())})},r=this&&this.__generator||function(e,r){var t,o,n,i,u={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(t)throw new TypeError("Generator is already executing.");for(;u;)try{if(t=1,o&&(n=2&i[0]?o.return:i[0]?o.throw||((n=o.return)&&n.call(o),0):o.next)&&!(n=n.call(o,i[1])).done)return n;switch(o=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return u.label++,{value:i[1],done:!1};case 5:u.label++,o=i[1],i=[0];continue;case 7:i=u.ops.pop(),u.trys.pop();continue;default:if(!(n=(n=u.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){u=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){u.label=i[1];break}if(6===i[0]&&u.label<n[1]){u.label=n[1],n=i;break}if(n&&u.label<n[2]){u.label=n[2],u.ops.push(i);break}n[2]&&u.ops.pop(),u.trys.pop();continue}i=r.call(e,u)}catch(a){i=[6,a],o=0}finally{t=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},t=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.loadWASMDecoder=exports.isWASMSupportHEVC=exports.destroy=exports.once=exports.on=exports.maybe360Browser=exports.isHardSupportHEVC=exports.isBwpSupported=void 0;var o=require("@bilibili-live/web-player-common"),n=t(require("@bilibili/wasmplayer-loader")),i=require("@bilibili/wasmplayer-loader");function u(e,r){var t;void 0===r&&(r="video/mp4");var o=document.createElement("video");if("function"!=typeof o.canPlayType||"function"!=typeof(null===(t=window.MediaSource)||void 0===t?void 0:t.isTypeSupported))return!1;var n=r+'; codecs="'+e+'"',i=o.canPlayType(n).toLowerCase();return!("maybe"!==i&&"probably"!==i||!window.MediaSource.isTypeSupported(n))}function a(){return o.ua.isIOS()||o.ua.isSafari()&&u("hvc1.1.6.L123")}function s(){return o.ua.isChrome()&&!o.ua.isEdg()&&u("hvc1.1.6.L123")}Object.defineProperty(exports,"isBwpSupported",{enumerable:!0,get:function(){return i.isBwpSupported}}),exports.isHardSupportHEVC=a,exports.maybe360Browser=s;var p=new o.EventBus;exports.on=p.on,exports.once=p.once,exports.destroy=p.destroy;var c=!1;function l(){return c}function f(){return e(this,void 0,Promise,function(){return r(this,function(e){switch(e.label){case 0:return[4,n.default.loadWasmPlayer().then(function(){c=!0})];case 1:return[2,e.sent()]}})})}exports.isWASMSupportHEVC=l,exports.loadWASMDecoder=f,o.wpd.SupportHEVC&&f().catch(function(e){o.logger.error(e)});
},{"@bilibili-live/web-player-common":"KGHo","@bilibili/wasmplayer-loader":"OKfi"}],"yABZ":[function(require,module,exports) {
"use strict";function e(e,r){if(r.some(function(r){return r.value===e.code.toString()}))return e.code.toString();for(var t=r[r.length-1],n=r.length-1;n>=0;n-=1){if(Number(r[n].value)>e.code&&null!=t)return String(t.value);t=r[n]}return String(t.value)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.getHEVCDowngradeQn=void 0,exports.getHEVCDowngradeQn=e;
},{}],"H7b7":[function(require,module,exports) {
"use strict";var e=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},t=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n};Object.defineProperty(exports,"__esModule",{value:!0}),exports.SwitchBetterLine=void 0;var n=5,i=8e3,r=6e4,a=1e4,o=5e3,s=0,c=function(){function c(d,m){var l=this;this.video=d,this.opts=m,u.set(this,!1),h.set(this,[]),f.set(this,0),p.set(this,0),w.set(this,[]),this.getNeedSwitchLine=function(){return e(l,u)},this.destroy=function(){e(l,w).forEach(function(e){return e()}),t(l,w,[])},v.set(this,function(v){var d=0;s=performance.now();var m=function(){e(l,u)?c.switchNum+=1:d=performance.now()},g=function(){if(!(s+a>performance.now()||0===d||e(l,p)+o>=performance.now())){var c={duration:performance.now()-d,waitingStartTime:d};e(l,h).push(c),t(l,h,e(l,h).filter(function(n){return n.waitingStartTime+r<performance.now()&&t(l,f,e(l,f)-n.duration),n.waitingStartTime+r>=performance.now()})),t(l,f,e(l,h).reduce(function(e,t){return e+t.duration},0)),(e(l,f)>i||e(l,h).length>=n)&&t(l,u,!0)}},E=function(){t(l,p,performance.now())};v.addEventListener("playing",g),v.addEventListener("seeking",E),v.addEventListener("waiting",m),e(l,w).push(function(){v.removeEventListener("seeking",E),v.removeEventListener("playing",g),v.removeEventListener("waiting",m)})}),c.switchNum+1!==this.opts.lineNum&&e(this,v).call(this,d)}var u,h,f,p,w,v;return u=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,w=new WeakMap,v=new WeakMap,c.switchNum=0,c.lastSwitchTime=0,c}();exports.SwitchBetterLine=c;
},{}],"z0Gg":[function(require,module,exports) {
"use strict";var e,r;Object.defineProperty(exports,"__esModule",{value:!0}),exports.useRetryStrategy=exports.RetryStrategies=void 0;var t,o=require("@bilibili-live/web-player-common"),P=((e={})[o.P2PType.HLS_BILI]=o.P2PType.NONE,e[o.P2PType.FLV_QVB]=o.P2PType.HLS_BILI,e[o.P2PType.NONE]=o.P2PType.HLS_NOT_P2P,e[o.P2PType.HLS_NOT_P2P]=o.P2PType.NONE,e);!function(e){e[e.Retry=0]="Retry",e[e.SwitchLine=1]="SwitchLine",e[e.ChangeProtocol=2]="ChangeProtocol",e[e.Failed=3]="Failed"}(t=exports.RetryStrategies||(exports.RetryStrategies={}));var y=((r={})[o.ProtocolType.HTTP_HLS]=[o.P2PType.HLS_BILI,o.P2PType.HLS_NOT_P2P],r[o.ProtocolType.HTTP_STREAM]=[o.P2PType.FLV_QVB,o.P2PType.NONE],r);function T(e,r,T){if(null==e)return t.Retry;var p=e.getCurP2PType();switch(T-r){case 1:case 2:case 3:return o.logger.error("maxRetryTimes: "+T+" retry count: "+r+", auto change line"),e.setCurLine(e.getCurLine()+1),t.SwitchLine;case 0:if(null!=o.wpd.P2PType)return t.Retry;if(o.logger.error("retry count: "+r+", auto change Protocol"),y[o.ProtocolType.HTTP_STREAM].includes(p)&&!e.hasHLSPlayerSupportStream())return t.Failed;var a=P[p];return y[o.ProtocolType.HTTP_HLS].includes(a)?e.useStream({protocol:o.ProtocolType.HTTP_HLS,expectP2PType:a}):e.useStream({protocol:o.ProtocolType.HTTP_STREAM,expectP2PType:a}),t.ChangeProtocol;default:return o.logger.error("maxRetryTimes: "+T+" retry count: "+r+", retry"),t.Retry}}exports.useRetryStrategy=T;
},{"@bilibili-live/web-player-common":"KGHo"}],"XBQm":[function(require,module,exports) {
"use strict";var e,t,n,a,i,o,r,s,l,p,c,d,u,h,m,v,f,w,x,g,M,E,k,y,b,T=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},W=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},L=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.showPanoramaTip=exports.Panorama=void 0;var P=require("@bilibili-live/web-player-common"),C=L(require("@bilibili-live/web-player-track")),_=function(){return function(L,_,R){var H=this;this.container=L,this.videoEl=_,e.set(this,document.createElement("div")),t.set(this,!1),n.set(this,0),a.set(this,0),i.set(this,0),o.set(this,0),r.set(this,!1),s.set(this,0),l.set(this,0),p.set(this,0),c.set(this,void 0),d.set(this,[]),this.destroy=function(){W(H,t,!0),T(H,b).call(H),T(H,e).remove(),T(H,d).forEach(function(e){return null==e?void 0:e()})},u.set(this,function(e,t,n){var a=n.getBoundingClientRect(),i=new e.PerspectiveCamera(75,a.width/a.height,1,1100);T(H,h).call(H,i);var o=new e.Scene,r=new e.SphereGeometry(500,100,80);r.scale(-1,1,1);var s=new e.VideoTexture(t),l=new e.MeshBasicMaterial({map:s}),p=new e.Mesh(r,l);o.add(p);var c=new e.WebGLRenderer;return c.setPixelRatio(window.devicePixelRatio),c.setSize(a.width,a.height),{camera:i,renderer:c,scene:o}}),h.set(this,function(e){W(H,l,Math.max(-85,Math.min(85,T(H,l))));var t=window.THREE.MathUtils.degToRad(90-T(H,l)),n=window.THREE.MathUtils.degToRad(T(H,s));e.position.x=10*Math.sin(t)*Math.cos(n),e.position.y=10*Math.cos(t),e.position.z=10*Math.sin(t)*Math.sin(n),e.lookAt(0,0,0)}),m.set(this,function(){var t=window.THREE,n=T(H,u).call(H,t,H.videoEl,H.container),a=n.camera,i=n.renderer,o=n.scene;W(H,c,a);var r=i.domElement;H.videoEl.style.cssText+="\n      z-index: -1;\n    ",P.ua.isSafari()&&(H.videoEl.crossOrigin="anonymous"),r.style.cssText="\n      position: absolute;\n      top: 0;\n      left: 0;\n      overflow: hidden;\n      z-index: 1;\n    ",r.style.width="100%",r.style.height="100%",H.container.appendChild(r),T(H,d).push(T(H,v).call(H,a)),H.container.appendChild(T(H,e)),function e(){i.render(o,a),l=requestAnimationFrame(e)}();var s=T(H,w).call(H,a,H.container),l=0;return function(){s(),cancelAnimationFrame(l),r.remove(),T(H,e).remove()}}),v.set(this,function(t){C.default.operation(C.default.OperationCode.Panorama,{type:"pv"}),T(H,e).style.cssText="\n    position: absolute;\n    opacity: 0.4;\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    z-index: 39;\n    outline: none;\n    left: 10px;\n    top: 60px;\n    background-color: #fff;\n    cursor: pointer;\n  ",T(H,e).appendChild(T(H,x).call(H)),T(H,e).appendChild(T(H,g).call(H)),T(H,e).appendChild(T(H,E).call(H)),T(H,e).appendChild(T(H,k).call(H));var n=function(e){e.stopPropagation()};return T(H,e).addEventListener("dblclick",n),T(H,e).onmouseenter=function(){T(H,e).style.opacity="1"},T(H,e).onmouseleave=function(){T(H,e).style.opacity="0.4"},function(){T(H,e).removeEventListener("dblclick",n)}}),f.set(this,function(t){T(H,e).contains(t.target)||(W(H,r,!0),C.default.operation(C.default.OperationCode.Panorama,{type:"mouse"},{sampleRate:.1}),W(H,n,t.clientX),W(H,a,t.clientY),W(H,i,T(H,s)),W(H,o,T(H,l)))}),w.set(this,function(t,p){var c=function(p){T(H,e).contains(p.target)||T(H,r)&&(W(H,s,.1*(T(H,n)-p.clientX)+T(H,i)),W(H,l,.1*(T(H,a)-p.clientY)+T(H,o)),T(H,h).call(H,t))},d=function(){W(H,r,!1)};return p.addEventListener("pointerdown",T(H,f)),p.addEventListener("pointermove",c),p.addEventListener("pointerup",d),p.addEventListener("mouseleave",d),p.addEventListener("mouseout",d),function(){p.removeEventListener("pointerdown",T(H,f)),p.removeEventListener("pointermove",c),p.removeEventListener("pointerup",d),p.removeEventListener("mouseleave",d),p.removeEventListener("mouseout",d)}}),x.set(this,function(){var e=document.createElement("span");return e.innerHTML=S,e.style.cssText+=z,e.style.cssText+="\n    left: 50%;\n    margin: -4px 0 0 -8px;\n    top: 0;\n    transform: rotate(-90deg);\n  ",T(H,y).call(H,e,"top"),e}),g.set(this,function(){var e=document.createElement("span");return e.innerHTML=S,e.style.cssText+=z,e.style.cssText+="\n    top: 50%;\n    margin: -10px -4px 0 -4px;\n    left: 1px;\n    transform: rotate(-180deg);\n  ",T(H,y).call(H,e,"left"),e}),M.set(this,function(e){if(null!=T(H,c)){switch(T(H,h).call(H,T(H,c)),e){case"top":W(H,l,T(H,l)-1);break;case"left":W(H,s,T(H,s)-1);break;case"bottom":W(H,l,T(H,l)+1);break;case"right":W(H,s,T(H,s)+1)}W(H,p,requestAnimationFrame(function(){T(H,M).call(H,e)}))}}),E.set(this,function(){var e=document.createElement("span");return e.innerHTML=S,e.style.cssText+=z,e.style.cssText+="\n    left: 50%;\n    margin: -7px 0px -5px -10px;\n    bottom: 0px;\n    transform: rotate(90deg);\n  ",T(H,y).call(H,e,"bottom"),e}),k.set(this,function(){var e=document.createElement("span");return e.innerHTML=S,e.style.cssText+=z,e.style.cssText+="\n    top: 50%;\n    margin: -8px -1px 0 0;\n    right: -2px;\n  ",T(H,y).call(H,e,"right"),e}),y.set(this,function(e,t){e.onmousedown=function(){C.default.operation(C.default.OperationCode.Panorama,{type:t},{sampleRate:.1}),T(H,M).call(H,t)},e.onmouseup=T(H,b),e.onmouseout=T(H,b)}),b.set(this,function(){cancelAnimationFrame(T(H,p))}),null==window.THREE?P.loadScript("//s1.hdslb.com/bfs/live-pkg/live-web-player/three-0.141.0.min.js").then(function(){T(H,t)||T(H,d).push(T(H,m).call(H))}).catch(function(e){P.logger.error(e),R()}):T(this,d).push(T(this,m).call(this))}}();exports.Panorama=_,e=new WeakMap,t=new WeakMap,n=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,r=new WeakMap,s=new WeakMap,l=new WeakMap,p=new WeakMap,c=new WeakMap,d=new WeakMap,u=new WeakMap,h=new WeakMap,m=new WeakMap,v=new WeakMap,f=new WeakMap,w=new WeakMap,x=new WeakMap,g=new WeakMap,M=new WeakMap,E=new WeakMap,k=new WeakMap,y=new WeakMap,b=new WeakMap;var R=function(e,t){var n="bili_panorama_roomId_list",a=localStorage.getItem(n);if(!0===(null==a?void 0:a.includes(t)))return null;if(null==a)localStorage.setItem(n,t);else{var i=a.split(",");100===i.length&&(i=i.slice(1)),i.push(t),localStorage.setItem(n,i.join(","))}C.default.operation(C.default.OperationCode.Panorama,{type:"tip"});var o=H();e.appendChild(o);var r=setTimeout(function(){o.remove()},1e4);return function(){o.remove(),clearTimeout(r)}};exports.showPanoramaTip=R;var z="\n  position: absolute;\n  width: 18px;\n  cursor: pointer;\n  transition: fill .3s;\n  vertical-align: middle;\n  display: inline-block;\n  font-size: 0;\n",S='\n<svg viewBox="0 0 14 16" xmlns="http://www.w3.org/2000/svg">\n  <path d="M2.65 11.634a.75.75 0 01-.073-.976l.072-.085L6.185 7.03 2.65 3.483a.75.75 0 01-.071-.977l.072-.084a.75.75 0 01.977-.071l.084.073L7.776 6.5a.75.75 0 01.072.975l-.072.084-4.065 4.074a.75.75 0 01-1.06.001z" fill="#999"></path>\n</svg>\n',H=function(){var e=document.createElement("div");e.style.cssText="\n    position: absolute;\n    z-index: 40;\n    bottom: 40px;\n    right: 160px;\n    cursor: pointer;\n    background-color: #23ADE5;\n    color: white;\n    height: 30px;\n    text-align: center;\n    vertical-align: middle;\n    line-height: 30px;\n    border-radius: 4px;\n    padding: 0 12px 0 12px;\n    font-size: 14px;\n  ";var t=document.createElement("span");return t.style.cssText+="\n    border: 8px solid transparent;\n    border-top-color: #23ADE5;\n    width: 0;\n    position: absolute;\n    height: 0;\n    bottom: -14px;\n    right: 8px;\n  ",e.innerText="快来体验下沉浸式全景直播吧!",e.appendChild(t),e};
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf"}],"pBr6":[function(require,module,exports) {
"use strict";var e,t,r,i,n,o,l,a,s,u,c,d,p,h,y,f,v,g,m,w,P,E,S,C,T,I=this&&this.__assign||function(){return(I=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},b=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,o){function l(e){try{s(i.next(e))}catch(t){o(t)}}function a(e){try{s(i.throw(e))}catch(t){o(t)}}function s(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(l,a)}s((i=i.apply(e,t||[])).next())})},_=this&&this.__generator||function(e,t){var r,i,n,o,l={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,i&&(n=2&o[0]?i.return:o[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,o[1])).done)return n;switch(i=0,n&&(o=[2&o[0],n.value]),o[0]){case 0:case 1:n=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,i=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(n=(n=l.trys).length>0&&n[n.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!n||o[1]>n[0]&&o[1]<n[3])){l.label=o[1];break}if(6===o[0]&&l.label<n[1]){l.label=n[1],n=o;break}if(n&&l.label<n[2]){l.label=n[2],l.ops.push(o);break}n[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(a){o=[6,a],i=0}finally{r=n=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},L=this&&this.__classPrivateFieldSet||function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},V=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},k=this&&this.__spreadArray||function(e,t){for(var r=0,i=t.length,n=e.length;r<i;r++,n++)e[n]=t[r];return e},U=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.LivePlayer=exports.LivePlayerEvent=exports.isBwpSupported=void 0;var M,H=require("@bilibili-live/web-player-common"),N=require("@bilibili-live/web-player-video"),D=U(require("@bilibili-live/web-player-playurl-parser")),Q=U(require("../common/controller")),x=U(require("./p2p-adapter")),F=require("../common/utils"),q=require("../common/track-video"),W=U(require("@bilibili-live/web-player-track")),B=U(require("./replay")),O=require("../common/connects"),A=U(require("./sticker")),R=require("./hevc-adapter"),j=require("./live-player-tool"),K=require("./switch-better-line"),J=require("./retry-strategy"),G=require("./panorama"),z=require("./hevc-adapter");Object.defineProperty(exports,"isBwpSupported",{enumerable:!0,get:function(){return z.isBwpSupported}}),function(e){e.Failed="liveplayer-failed",e.LiveStatusChange="liveplayer-status-change",e.Destroyed="liveplayer-destroyed"}(M=exports.LivePlayerEvent||(exports.LivePlayerEvent={}));var X=function(){function U(k,U,D){var x,O=this;this.container=k,this.opts=U,this.socket=D,e.set(this,""),t.set(this,""),r.set(this,null),i.set(this,null),this.playUrlParser=null,n.set(this,0),this.replay=null,o.set(this,[]),l.set(this,[]),a.set(this,null),s.set(this,!1),u.set(this,null),c.set(this,null),d.set(this,"Fetch"),p.set(this,void 0),h.set(this,null),y.set(this,function(){}),f.set(this,!1),v.set(this,new H.EventBus),this.on=V(this,v).on,this.once=V(this,v).once,this.emit=V(this,v).emit,g.set(this,new Set),m.set(this,function(e){return b(O,void 0,Promise,function(){var t,r,o,a,s=this;return _(this,function(u){switch(u.label){case 0:return L(this,n,e),this.opts.roomId=e,H.logger.info("live player init roomId: "+e),null!=this.opts.roomInfo?[3,2]:[4,V(this,E).call(this)];case 1:return u.sent(),[3,3];case 2:if(L(this,i,this.opts.roomInfo),null==V(this,i).playurl_info.playurl)return this.emit(M.Failed,W.default.ErrorCode.PlayUrlNull),H.logger.error("playUrlInfo.playurl is null"),[2];this.playUrlParser=oe(V(this,i).playurl_info,{userId:this.opts.userId,ownerId:V(this,i).uid,isMobile:null!==(t=this.opts.isMobile)&&void 0!==t&&t}),u.label=3;case 3:return this.reload(),null!=(null===(r=V(this,i))||void 0===r?void 0:r.live_time)&&V(this,l).push($(V(this,i).live_time,this.ctrl.getCtrlUI())),null!=V(this,i)&&!0!==this.opts.isMobile&&this.opts.enableCtrlUI&&(this.replay=new B.default(this.container,{live_time:null===(o=V(this,i))||void 0===o?void 0:o.live_time,rid:null===(a=V(this,i))||void 0===a?void 0:a.room_id},this.socket,this.ctrl),this.replay.on("timeShiftChange",function(e){s.tmShiftHandler(e),s.reload()}),this.enableReplay()&&this.replay.init()),[2]}})})}),this.tmShiftHandler=function(e){var t,r,i,n=O.playUrlParser;if(null!=O.replay&&null!=n){var o=n.getCurP2PType(),l=n.getCurStreamInfo().protocol,a=H.ProtocolType.HTTP_HLS,s=H.P2PType.HLS_NOT_P2P,u=n.getCurStreamInfo().timeshift;0!==e?(0===u&&(O.replay.bakState={p2pType:o,protocol:l}),(null!==(t=O.replay.bakState.p2pType)&&void 0!==t?t:o)>0&&(n.setCurP2PType(H.P2PType.HLS_BILI),s=H.P2PType.HLS_BILI)):(s=null!==(r=O.replay.bakState.p2pType)&&void 0!==r?r:o,n.setCurP2PType(s),a=null!==(i=O.replay.bakState.protocol)&&void 0!==i?i:l,O.replay.bakState={}),n.setTimeShift(e),n.useStream({protocol:a,expectP2PType:s})}},w.set(this,function(e){var t,r,i=null!==(r=null===(t=O.playUrlParser)||void 0===t?void 0:t.getLineCandidates().length)&&void 0!==r?r:0,n=new K.SwitchBetterLine(e.getVideoEl(),{lineNum:i}),l=e.on(N.EventType.WaitStart,function(){var t,r,i;if(!0!==(null===(t=O.replay)||void 0===t?void 0:t.isReplay)&&n.getNeedSwitchLine()){var o=performance.now(),l=navigator.connection;O.switchLine(K.SwitchBetterLine.switchNum,!1),W.default.custom(W.default.CustomCode.SwitchLine,{switchNum:K.SwitchBetterLine.switchNum,videoCurrentTime:e.getVideoEl().currentTime,interval:Math.floor((o-K.SwitchBetterLine.lastSwitchTime)/1e3),downlink:null!==(r=null==l?void 0:l.downlink)&&void 0!==r?r:-1,rtt:null!==(i=null==l?void 0:l.rtt)&&void 0!==i?i:-1}),H.logger.warn("waiting auto switch line to "+K.SwitchBetterLine.switchNum)}});V(O,o).push(n.destroy),V(O,o).push(l)}),P.set(this,function(){V(O,o).forEach(function(e){return e()}),L(O,o,[])}),E.set(this,F.retry(function(e){return b(O,void 0,Promise,function(){var t,r,o,l,a,s,c,d,p,h,y,f,v,g=this;return _(this,function(m){switch(m.label){case 0:return t=this.playUrlParser,r=null!==(c=null===(s=null==t?void 0:t.getQualityDesc(t.getCurQuality()))||void 0===s?void 0:s.code)&&void 0!==c?c:0,null!=e&&(r=e),F.loadingOrCoverImg(this.container,V(this,u)),o=null!==(p=null===(d=this.playUrlParser)||void 0===d?void 0:d.getCurLine())&&void 0!==p?p:0,l=(null!==(y=null===(h=this.playUrlParser)||void 0===h?void 0:h.getCurStreamInfo())&&void 0!==y?y:{}).timeshift,H.logger.info("updateRoomInfo quality: "+r+", line: "+o),[4,new Promise(function(e,t){H.ajax(Z(V(g,n),r,g.opts.isMobile),{handleRes:function(t){t.code!==H.ApiErrorCode.AreaBlock?e(t.data):g.emit(M.Failed,H.ApiErrorCode.AreaBlock,t.message)}}).catch(t)})];case 1:return 1!==(a=m.sent()).live_status?(H.unloading(),this.emit(M.LiveStatusChange,a.live_status),[2]):null==a.playurl_info?(H.unloading(),this.playUrlParser=null,H.logger.info("playUrlInfo is null"),[2]):(L(this,i,a),H.logger.debug("room info: "+JSON.stringify(a)),null==a.playurl_info.playurl?(this.emit(M.Failed,W.default.ErrorCode.PlayUrlNull),H.logger.error("playUrlInfo.playurl is null"),[2]):(this.playUrlParser=oe(V(this,i).playurl_info,{userId:this.opts.userId,ownerId:a.uid,isMobile:null!==(f=this.opts.isMobile)&&void 0!==f&&f}),null===(v=this.playUrlParser)||void 0===v||v.setCurLine(o),this.tmShiftHandler(null!=l?l:0),[2]))}})})},[0,1,3,5,10,20,30,60,90,120].map(function(e){return 1e3*e}))),S.set(this,function(i,n){i.once(N.EventType.FirstFrame,function(){var l,u,c=null;if(V(O,o).push(function(){null==c||c.remove()}),V(O,g).forEach(function(e){e!==i&&(e.destroy(),V(O,g).delete(e))}),L(O,e,H.uuid()),L(O,t,n),V(O,s))i.destroy();else{null===(l=V(O,r))||void 0===l||l.removeVideoEl();var d=i.getVideoEl();!0===O.opts.isMobile&&(d.setAttribute("webkit-playsinline","true"),d.setAttribute("playsinline","true")),O.container.appendChild(d),L(O,r,i),!0!==O.opts.isMobile&&(c=N.checkVideoRate(i.getVideoEl())),null===(u=V(O,a))||void 0===u||u.success(),V(O,y).call(O),L(O,y,te(i,V(O,h)))}})}),C.set(this,function(e){var t,r,i,n,o=F.maxRetryChecker(e);e.once(N.EventType.Ended,function(){return b(O,void 0,void 0,function(){return _(this,function(t){return e.destroy(),o()?(a(function(){}).catch(function(e){H.logger.error(e)}),[2]):(H.logger.error("retry over 1 min"),this.emit(M.Failed,W.default.ErrorCode.RetryMaxTime),[2])})})}),e.once(N.EventType.Error,function(t){return b(O,void 0,void 0,function(){var r,i;return _(this,function(n){return e.destroy(),H.logger.error(t),o()?(r=F.loadingOrCoverImg(this.container,V(this,u)),!0===(null===(i=this.replay)||void 0===i?void 0:i.isReplay)?[2]:(a(r).catch(function(e){H.logger.error(e),r()}),[2])):(this.emit(M.Failed,W.default.ErrorCode.RetryMaxTime),[2])})})}),H.logger.debug("max retry times："+(null!==(r=null===(t=O.playUrlParser)||void 0===t?void 0:t.getPlayUrlCandates().length)&&void 0!==r?r:0));var l=Math.min(null!==(n=null===(i=O.playUrlParser)||void 0===i?void 0:i.getPlayUrlCandates().length)&&void 0!==n?n:0,4),a=function(e){return b(O,void 0,Promise,function(){var t,r,i,n;return _(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,7]),[4,F.backoffById(this.playUrlParser,l)];case 1:if(t=o.sent(),null!=this.playUrlParser)if((r=J.useRetryStrategy(this.playUrlParser,t,l))===J.RetryStrategies.SwitchLine)this.emit(H.ExternalEventType.SwitchLine,this.playUrlParser.getCurLine());else if(r===J.RetryStrategies.Failed)throw new Error("not supported hls protocol stream");return e(),[3,7];case 2:i=o.sent(),e(),H.logger.error(i),o.label=3;case 3:return o.trys.push([3,5,,6]),[4,V(this,E).call(this)];case 4:return o.sent(),[3,6];case 5:throw n=o.sent(),this.emit(M.Failed,W.default.ErrorCode.RoomP0ApiFetchError),this.destroy(),n;case 6:return[3,7];case 7:return this.reload(),[2]}})})}}),T.set(this,function(e){var t=H.seiKeyComparator(H.SEIType.LIVE_SEI_CHANNEL),r=H.seiKeyComparator(H.SEIType.B_LIVE_VIBRATION),i=H.seiKeyComparator(H.SEIType.LIVE_SEI_PC_LINK);return e.once(N.EventType.Destroyed,function(){O.emit(N.EventType.Destroyed)}),[H.EventBus.forwardEvent(e,V(O,v),[N.EventType.Play,N.EventType.Pause,N.EventType.LoadStart,N.EventType.MetaData,N.EventType.FirstFrame,N.EventType.WaitStart,N.EventType.NotAutoPlay,N.EventType.MutePlay]),e.on(N.EventType.VideoInfo,function(e){var t,r;O.emit(N.EventType.VideoInfo,{mediaInfo:I(I({},e.mediaInfo),{corePlayerType:(null!==(r=null===(t=e.mediaInfo)||void 0===t?void 0:t.corePlayerType)&&void 0!==r?r:"")+" ("+V(O,d)+")"}),realtimeInfo:e.realtimeInfo})}),e.on(N.EventType.SEIData,function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(t(e[2])){var o=H.uint8ArrayToString(e[3]);O.emit(H.ExternalEventType.SEIParseData,H.SEIType.LIVE_SEI_CHANNEL,o)}else r(e[2])?O.emit(H.ExternalEventType.SEIParseData,H.SEIType.B_LIVE_VIBRATION,e[1],e[3]):i(e[2])?O.emit(H.ExternalEventType.SEIParseData,H.SEIType.LIVE_SEI_PC_LINK,e):O.emit(N.EventType.SEIData,e)}),e.once(N.EventType.WASMDecoderDegrade,function(){var e=O.playUrlParser;if(null!=e){var t=e.getQualityDesc();if((null==t?void 0:t.codec)===H.CodecType.HEVC){var r=j.getHEVCDowngradeQn(t,e.getAVCQnCandidates());O.switchQuality(r,"CPU负载较高，")}}})]}),this.play=function(){var e;null===(e=V(O,r))||void 0===e||e.play().catch(function(){})},this.pause=function(){var e;null===(e=V(O,r))||void 0===e||e.pause()},this.volume=function(e){var t;null===(t=V(O,r))||void 0===t||t.volume(e)},this.mute=function(e){var t;null===(t=V(O,r))||void 0===t||t.mute(e)},this.enableReplay=function(){return null!=V(O,i)&&null!=O.playUrlParser&&!(!V(O,i).all_special_types.includes(19)||!O.playUrlParser.hasHLSPlayerSupportStream())},!0!==U.isMobile&&(k.style.overflow="hidden"),this.ctrl=new Q.default(k,{userId:U.userId,isMobile:null!==(x=this.opts.isMobile)&&void 0!==x&&x,enableCtrlUI:U.enableCtrlUI}),Y(this.ctrl,this,k),L(this,p,q.createVideoTracker()),V(this,m).call(this,this.opts.roomId).catch(function(e){H.logger.error(e),W.default.error(W.default.ErrorCode.RoomEnterLiveError,e)})}return U.prototype.reload=function(){var e,t,r,l=this;if(!V(this,s)){H.logger.info("live player load roomId: "+V(this,n));var a=V(this,n);if(null!=V(this,i)&&0!==a&&null!=this.playUrlParser){var h,y=this.playUrlParser;null==V(this,c)&&L(this,c,y.getCurQuality());try{h=y.getCurPlayUrl()}catch(b){return H.logger.error(b),void V(this,E).call(this).then(function(){l.reload()}).catch(function(e){H.logger.error(e)})}if(!V(this,s)){var v=this.playUrlParser.getCurStreamInfo();W.default.updateDynamicInfo({p2pType:v.p2pType,sHost:v.host,sQuery:v.query,sProtocol:v.protocol,sCodec:v.codec,sName:v.name,quality:v.quality,sFormat:null!==(r=v.format)&&void 0!==r?r:"",line:this.playUrlParser.getCurLine()},!0),H.logger.info("current stream info: "+JSON.stringify(v)),V(this,P).call(this);var m=new N.Video(h,{wasmDecode:y.getCurCodecType()===H.CodecType.HEVC&&!R.isHardSupportHEVC()&&!R.maybe360Browser()&&R.isWASMSupportHEVC(),forceNativePlayer:"panorama"===y.getCurStreamInfo().curAttrName||navigator.userAgent.includes("PlayStation")});v.codec===H.CodecType.HEVC&&W.default.updateDynamicInfo({videoTag:m.getVideoEl().tagName}),(e=V(this,o)).push.apply(e,le(this.playUrlParser,this.container,a.toString(),m.getVideoEl(),this.ctrl)),V(this,g).add(m),ie(this.ctrl.getCtrlUI(),y,H.wpd.SupportHEVC||R.isHardSupportHEVC()||V(this,f)),V(this,w).call(this,m),ne(m,this,this.container),V(this,S).call(this,m,h),V(this,C).call(this,m),V(this,p).call(this,m),(t=V(this,o)).push.apply(t,k([O.connectUIandVideo(this.ctrl,m),ee(m),O.connectVideoLoading(m,this.container,V(this,u)),O.connectVideoPip(m,this.ctrl),O.connectMirror(m,this.ctrl)],V(this,T).call(this,m)));var I=y.getCurP2PType();x.default({video:m,type:I,roomId:a,interval:y.getDynamicConfig().report_interval_sec}).then(function(){var e;L(l,d,(e={},e[H.P2PType.HLS_BILI]="SistersFetcher",e[H.P2PType.FLV_QVB]="QVBFetcher",e[H.P2PType.HLS_NOT_P2P]="Fetch",e[H.P2PType.NONE]="Fetch",e)[I])}).catch(function(e){var t;L(l,d,"Fetch");var r=((t={})[H.P2PType.HLS_BILI]=H.P2PType.HLS_NOT_P2P,t[H.P2PType.FLV_QVB]=H.P2PType.NONE,t);y.setCurP2PType(r[I]),W.default.updateDynamicInfo({p2pType:r[I]}),H.logger.error(e)})}}}},U.prototype.setTitlePageImg=function(e){L(this,u,e)},U.prototype.setAutoSyncCfg=function(e){/chrome\/91/g.test(navigator.userAgent.toLowerCase())||(L(this,h,e),null!=V(this,r)&&(V(this,y).call(this),L(this,y,te(V(this,r),e))))},U.prototype.getPlayerInfo=function(){var i,n,o,l,a,s;return{guid:V(this,e),playingStatus:!(null===(n=null===(i=V(this,r))||void 0===i?void 0:i.getVideoEl().paused)||void 0===n||n),playSrc:V(this,t),quality:null!==(l=null===(o=this.playUrlParser)||void 0===o?void 0:o.getCurQuality())&&void 0!==l?l:"",qualityCandidates:null!==(s=null===(a=this.playUrlParser)||void 0===a?void 0:a.getQnCandidates())&&void 0!==s?s:[]}},U.prototype.getVideoEl=function(){var e;return null===(e=V(this,r))||void 0===e?void 0:e.getVideoEl()},U.prototype.blockStream=function(){var e=this;F.blockStream(V(this,r),function(){e.emit(N.EventType.Play)})},U.prototype.discardFrame=function(e){var t,i=null===(t=V(this,r))||void 0===t?void 0:t.getVideoEl();null!=i&&(i.currentTime+=e)},U.prototype.remainBufferLength=function(){var e,t=null===(e=V(this,r))||void 0===e?void 0:e.getVideoEl();return null==t?0:H.remainBufferLength(t)},U.prototype.showHEVCQuality=function(e){var t=this;if(!R.isHardSupportHEVC()){var r=this.playUrlParser;if(null!=r)if(e)R.loadWASMDecoder().then(function(){null!=t.playUrlParser&&(L(t,f,!0),ie(t.ctrl.getCtrlUI(),t.playUrlParser,V(t,f)||H.wpd.SupportHEVC||R.isHardSupportHEVC()))}).catch(function(e){H.logger.error(e)});else{L(this,f,!1);var i=r.getQualityDesc();if((null==i?void 0:i.codec)!==H.CodecType.HEVC)return void ie(this.ctrl.getCtrlUI(),r,!1);var n=j.getHEVCDowngradeQn(i,r.getAVCQnCandidates());this.switchQuality(n)}}},U.prototype.destroy=function(e){var t,i;H.logger.info("live player destroy, holdLastFrame: "+String(e)),null===(t=V(this,r))||void 0===t||t.destroy(e),V(this,s)||(L(this,s,!0),this.emit(M.Destroyed),null===(i=this.replay)||void 0===i||i.destroy(),V(this,P).call(this),this.ctrl.destroy(),V(this,v).destroy(),V(this,l).forEach(function(e){return e()}),L(this,l,[]))},U.prototype.switchQuality=function(e,t){var r,i,n=this;void 0===t&&(t=""),H.logger.info("switchQuality to "+e);var o=this.playUrlParser;if(null!=o){var l=o.getQualityDesc(e),s=o.getQualityDesc(o.getCurQuality()),u=o.getQualityDesc(null!==(r=V(this,c))&&void 0!==r?r:"0");if(null!=l&&null!=u&&null!=s){if(0===this.opts.userId&&l.code>u.code)return H.logger.warn("user not login, reject switch quality"),this.emit(H.ExternalEventType.SwitchQualityNotLogin,{newQn:{qn:e,text:l.label},oldQn:{qn:s.value,text:s.label}}),!1;if(H.toast(t+"清晰度即将切换至"+l.label,this.container),L(this,a,{success:function(){H.toast(t+"清晰度已经切换至"+l.label,n.container),L(n,a,null),n.emit(H.ExternalEventType.SwitchQuality,e,s.value,o.getQnCandidates().map(function(e){var t=e.label;return{qn:e.value,desc:t}}))}}),s.code===l.code)return null===(i=this.playUrlParser)||void 0===i||i.useStream({codec:l.codec}),void this.reload();V(this,E).call(this,l.code).then(function(){var e,t=3e4===l.code?H.ProtocolType.HTTP_HLS:void 0;null===(e=n.playUrlParser)||void 0===e||e.useStream({codec:l.codec,protocol:t}),n.reload()}).catch(function(e){H.logger.error(e)})}else H.logger.error("switchQuality: quality parser error. "+JSON.stringify({targetQnDesc:l,curQnDesc:s,defQnDesc:u}))}},U.prototype.switchLine=function(e,t){var r,i,n,o=this;void 0===t&&(t=!0);var l=this.playUrlParser;null!=l&&(t&&H.toast("线路即将切换至"+(null!==(i=null===(r=l.getLineCandidates().find(function(t){return t.value===e}))||void 0===r?void 0:r.label)&&void 0!==i?i:""),this.container),L(this,a,{success:function(){t&&H.toast("线路已经切换至"+l.getCurLineDesc().label,o.container),L(o,a,null),o.emit(H.ExternalEventType.SwitchLine,e)}}),null===(n=this.playUrlParser)||void 0===n||n.setCurLine(e),this.reload())},U.prototype.capturePic=function(e,t){var i,n;return null!==(n=null===(i=V(this,r))||void 0===i?void 0:i.capturePic(e,t))&&void 0!==n?n:null},U}();function Y(e,t,r){var i=this,n=!1,o=e.onRefresh(function(){var e,i;t.once(N.EventType.FirstFrame,function(){n&&(H.toast("刷新成功",r),n=!1)}),H.toast("正在刷新",r),n=!0,!0===(null===(e=t.replay)||void 0===e?void 0:e.isReplay)&&(null===(i=t.replay)||void 0===i||i.returnLive()),t.tmShiftHandler(0),t.reload(),t.emit(H.ExternalEventType.Reload),W.default.operation(W.default.OperationCode.Refresh)}),l=e.onChange(function(e,r){return b(i,void 0,void 0,function(){return _(this,function(i){return"quality"===e?[2,t.switchQuality(r)]:("line"===e&&t.switchLine(r),re(e,r),[2])})})});return function(){o(),l()}}function Z(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=!1),"//api.live.bilibili.com/xlive/web-room/v2/index/getRoomPlayInfo?room_id="+e+"&protocol=0,1&format=0,1,2&codec=0,1&qn="+t+"&platform=web&ptype=8&dolby=5"+(r?"":"&panorama=1")}function $(e,t){var r=Date.now()/1e3-e-performance.now()/1e3,i=window.setInterval(function(){t.time={value:H.formatTime(performance.now()/1e3+r),tips:"直播持续时间"}},1e3);return function(){clearInterval(i)}}function ee(e){var t=[],r=e.getVideoEl(),i=0;return H.logger.info("start monitor buffer length"),e.on(N.EventType.VideoInfo,function(e){var n=e.realtimeInfo;if(!(r.paused||r.currentTime<=0)){var o=n.videoBufferLength;(o>10||i===r.currentTime&&o>5)&&(r.currentTime+=o/2,H.logger.warn("auto discard frame, current time: "+r.currentTime),t.length<3&&((t=t.filter(function(e){return performance.now()-e<5e3})).push(performance.now()),3===t.length&&W.default.custom(W.default.CustomCode.AutoDiscardFrame,null,{extFields:"all"}))),i=r.currentTime}})}function te(e,t){if(null===t)return function(){};if(!H.ua.isChrome()&&!H.ua.isEdg())return function(){};var r=t.auto_sync_enable,i=t.auto_sync_high_speed,n=t.auto_sync_low_speed,o=t.auto_sync_max_threshold,l=t.auto_sync_min_threshold;return 1!==r?function(){}:(H.logger.info("live player start auto sync video progress"),e.on(N.EventType.VideoInfo,function(t){var r=1e3*t.realtimeInfo.videoBufferLength;if(!(r<0||isNaN(r))){var a=e.getVideoEl(),s=1;r<l?s=n:r>o&&(s=i),(s<=0||s>2)&&(s=1),s!==a.playbackRate&&(a.playbackRate=s)}}))}function re(e,t){"quality"===e?W.default.operation(W.default.OperationCode.SwitchQuality,{quality:t}):"line"===e?W.default.operation(W.default.OperationCode.SwitchLine,{line:t}):"danmaku"===e?W.default.operation(W.default.OperationCode.Danmaku,I({},t)):"volume"===e?!0===t.disabled?W.default.operation(W.default.OperationCode.Mute):W.default.operation(W.default.OperationCode.Volume,{value:t.value}):"playStatus"===e?!0===t?W.default.operation(W.default.OperationCode.Play):W.default.operation(W.default.OperationCode.Pause):"fullScreenStatus"===e?W.default.operation(W.default.OperationCode.FullScreen,{value:t}):"webFullScreenStatus"===e&&W.default.operation(W.default.OperationCode.WebFullScreen,{value:t})}function ie(e,t,r){var i,n,o,l={list:null!==(i=t.getLineCandidates())&&void 0!==i?i:[],value:null!==(n=t.getCurLine())&&void 0!==n?n:0};e.line=l;var a=t.getQnCandidates();r||(a=t.getAVCQnCandidates());var s={list:a,value:null!==(o=t.getCurQuality())&&void 0!==o?o:"0"};e.quality=s}function ne(e,t,r){H.logger.debug("listen sticker SEI");var i=null,n=!1,o=t.on(H.ExternalEventType.SEIParseData,function(e,t){e===H.SEIType.LIVE_SEI_CHANNEL&&(n||(n=!0,i=new A.default(r)),null==i||i.onSei(t))}),l=e.on(N.EventType.MetaData,function(e){n&&(H.logger.info("destroy sticker when metadata"),null==i||i.destroy(),n=!1)}),a=0,s=t.ctrl.onChange(function(e,t){"webFullScreenStatus"!==e&&"fullScreenStatus"!==e||(clearTimeout(a),a=window.setTimeout(function(){null==i||i.calcDisplayInfo(),null==i||i.batchUpdateStickerElement()},"webFullScreenStatus"===e?10:300))}),u=e.on(N.EventType.VideoInfo,function(e){null==i||i.onVideoInfo({width:e.mediaInfo.width,height:e.mediaInfo.height})});t.once(M.Destroyed,d),e.once(N.EventType.Destroyed,d);var c=!1;function d(){c||(c=!0,H.logger.info("destroy sticker..."),clearTimeout(a),null==i||i.destroy(),s(),o(),l(),u())}}function oe(e,t){var r=t.userId,i=t.ownerId,n=t.isMobile,o=new D.default(e);return(r===i||n)&&(o.setCurP2PType(H.P2PType.NONE),W.default.updateDynamicInfo({p2pType:H.P2PType.NONE})),R.isHardSupportHEVC()&&o.useStream({codec:H.CodecType.HEVC,expectP2PType:o.getCurP2PType()}),o}exports.LivePlayer=X,e=new WeakMap,t=new WeakMap,r=new WeakMap,i=new WeakMap,n=new WeakMap,o=new WeakMap,l=new WeakMap,a=new WeakMap,s=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,p=new WeakMap,h=new WeakMap,y=new WeakMap,f=new WeakMap,v=new WeakMap,g=new WeakMap,m=new WeakMap,w=new WeakMap,P=new WeakMap,E=new WeakMap,S=new WeakMap,C=new WeakMap,T=new WeakMap;var le=function(e,t,r,i,n){var o=[];if(null!=e.getQnCandidates().find(function(e){return e.label.includes("全景")})){var l=G.showPanoramaTip(t,r);if(null!=l){n.show();var a=setTimeout(function(){n.hide()},1e4);o.push(l,function(){clearTimeout(a)});var s=n.onChange(function(e,t){"qualityPanelShow"===e&&!0===t&&(l(),s(),clearTimeout(a))})}}if("panorama"===e.getCurStreamInfo().curAttrName){var u=new G.Panorama(t,i,function(){H.toast("资源加载失败，无法进行全景交互",t)});o.push(u.destroy)}return o};
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58","@bilibili-live/web-player-playurl-parser":"uCDP","../common/controller":"as8u","./p2p-adapter":"A6uK","../common/utils":"KY4m","../common/track-video":"rPou","@bilibili-live/web-player-track":"ESUf","./replay":"xqO8","../common/connects":"blC7","./sticker":"fyPa","./hevc-adapter":"lCVI","./live-player-tool":"yABZ","./switch-better-line":"H7b7","./retry-strategy":"z0Gg","./panorama":"XBQm"}],"W75V":[function(require,module,exports) {
"use strict";var e,t,n,r,i,o,l,a,u,s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))(function(i,o){function l(e){try{u(r.next(e))}catch(t){o(t)}}function a(e){try{u(r.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,a)}u((r=r.apply(e,t||[])).next())})},c=this&&this.__generator||function(e,t){var n,r,i,o,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;l;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return l.label++,{value:o[1],done:!1};case 5:l.label++,r=o[1],o=[0];continue;case 7:o=l.ops.pop(),l.trys.pop();continue;default:if(!(i=(i=l.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){l=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){l.label=o[1];break}if(6===o[0]&&l.label<i[1]){l.label=i[1],i=o;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(o);break}i[2]&&l.ops.pop(),l.trys.pop();continue}o=t.call(e,l)}catch(a){o=[6,a],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}},d=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoundPlayer=exports.NonRoundStatus=void 0;var f,v=require("@bilibili-live/web-player-common"),y=require("@bilibili-live/web-player-video"),m=require("../common/connects"),b=p(require("../common/controller")),g=require("../common/utils"),w=p(require("@bilibili-live/web-player-track"));!function(e){e[e.Preround=-1]="Preround",e[e.Failed=-2]="Failed",e[e.Nonenabled=-3]="Nonenabled"}(f=exports.NonRoundStatus||(exports.NonRoundStatus={}));var E=function(){function p(p,E){var _=this;this.container=p,this.opts=E,e.set(this,""),t.set(this,null),n.set(this,""),r.set(this,!1),i.set(this,[]),o.set(this,null),l.set(this,new v.EventBus),this.on=d(this,l).on,this.emit=d(this,l).emit,a.set(this,function(){return s(_,void 0,Promise,function(){var p,b,E,_,R,k,S,M,V,q,C=this;return c(this,function(F){switch(F.label){case 0:return d(this,r)?[2]:(v.logger.info("round player start loop playing"),null===(V=d(this,t))||void 0===V||V.destroy(),p=v.loading(this.container),[4,P(this.opts.roomId)]);case 1:return b=F.sent(),p(),b.cid===f.Failed?[2]:b.cid<=0?(E=void 0,b.cid===f.Nonenabled&&(E=w.default.ErrorCode.RoomUnSettingRound),v.logger.warn("exit round cause: "+f[b.cid]),this.emit("failed",b.cid,b.play_time,E),this.destroy(),[2]):(this.emit(v.ExternalEventType.StartPlayRound,b),[4,x(b.cid,b.bvid)]);case 2:if(_=F.sent(),null==(R=T(_,b.play_time)))throw new Error("can't find round segment");return d(this,r)?[2]:(k=new y.Video(R.url,{startTime:R.startTime}),h(this,e,v.uuid()),h(this,n,R.url),d(this,i).forEach(function(e){return e()}),h(this,i,[]),k.once(y.EventType.Destroyed,function(){C.emit(y.EventType.Destroyed)}),d(this,i).push(d(this,u).call(this,b.title),m.connectUIandVideo(this.ctrl,k),m.connectVideoLoading(k,this.container,d(this,o)),m.connectVideoPip(k,this.ctrl),m.connectMirror(k,this.ctrl),v.EventBus.forwardEvent(k,d(this,l),[y.EventType.Play,y.EventType.Pause,y.EventType.LoadStart,y.EventType.MetaData,y.EventType.VideoInfo,y.EventType.FirstFrame])),S=null,M=function(){return s(C,void 0,Promise,function(){var e,t;return c(this,function(n){switch(n.label){case 0:e=new URL(R.url),n.label=1;case 1:return n.trys.push([1,3,,4]),t=v.loading(this.container),[4,g.backoffById(""+e.origin+e.pathname,4)];case 2:return n.sent(),null==t||t(),[3,4];case 3:return n.sent(),null==t||t(),[3,4];case 4:return d(this,a).call(this).catch(function(e){v.logger.error(e),w.default.error(w.default.ErrorCode.RoomEnterRoundError,e)}),null==S||S.remove(),[2]}})})},k.once(y.EventType.Ended,M),k.once(y.EventType.Error,M),k.once(y.EventType.FirstFrame,function(){S=y.checkVideoRate(k.getVideoEl())}),h(this,t,k),null===(q=d(this,t))||void 0===q||q.removeVideoEl(),this.container.appendChild(k.getVideoEl()),[2])}})})}),u.set(this,function(e){var t,n="web-player-round-title";null===(t=document.querySelector("."+n))||void 0===t||t.remove();var r=document.createElement("div");return r.classList.add(n),r.textContent=e,r.style.cssText="\n      z-index: 2;\n      position: absolute;\n      right: 20px;\n      bottom: 20px;\n      pointer-events: none;\n      color: #aaa;\n      font-size: 14px;\n    ",_.container.appendChild(r),function(){r.remove()}}),this.play=function(){var e;null===(e=d(_,t))||void 0===e||e.play().catch(function(){})},this.pause=function(){var e;null===(e=d(_,t))||void 0===e||e.pause()},this.volume=function(e){var n;null===(n=d(_,t))||void 0===n||n.volume(e)},this.mute=function(e){var n;null===(n=d(_,t))||void 0===n||n.mute(e)},v.logger.info("enter round"),this.ctrl=new b.default(p,{userId:E.userId,isMobile:!1,enableCtrlUI:E.enableCtrlUI}),this.ctrl.onRefresh(function(){d(_,a).call(_).catch(function(e){v.logger.error(e),w.default.error(w.default.ErrorCode.RoomEnterRoundError,e)})}),d(this,a).call(this).catch(function(e){v.logger.error(e),w.default.error(w.default.ErrorCode.RoomEnterRoundError,e)})}return p.prototype.setTitlePageImg=function(e){h(this,o,e)},p.prototype.getVideoEl=function(){var e;return null===(e=d(this,t))||void 0===e?void 0:e.getVideoEl()},p.prototype.getPlayerInfo=function(){var r,i;return{guid:d(this,e),playingStatus:!(null!==(i=null===(r=d(this,t))||void 0===r?void 0:r.getVideoEl().paused)&&void 0!==i&&i),playSrc:d(this,n),quality:"0",qualityCandidates:[]}},p.prototype.blockStream=function(){var e=this;g.blockStream(d(this,t),function(){e.emit(y.EventType.Play)})},p.prototype.destroy=function(e){var n;v.logger.info("round player destroy, holdLastFrame: "+String(e)),null===(n=d(this,t))||void 0===n||n.destroy(e),d(this,r)||(h(this,r,!0),d(this,i).forEach(function(e){return e()}),h(this,i,[]),this.ctrl.destroy(),d(this,l).destroy())},p.prototype.capturePic=function(e,n){var r,i;return null!==(i=null===(r=d(this,t))||void 0===r?void 0:r.capturePic(e,n))&&void 0!==i?i:null},p}();function P(e){return s(this,void 0,Promise,function(){var t;return c(this,function(n){switch(n.label){case 0:return[4,v.ajax("/live/getRoundPlayVideo?room_id="+e+"&a="+Date.now()+"&type=flv")];case 1:if(t=n.sent(),Object.values(f).includes(t.cid))return[2,{play_time:t.play_time,cid:t.cid,bvid:t.bvid,title:t.title}];if(t.cid<=0)throw new Error("getRoundPlayVideo result parse failed: "+JSON.stringify(t));return[2,{play_time:t.play_time,cid:t.cid,bvid:t.bvid,title:t.title}]}})})}function x(e,t){var n,r;return s(this,void 0,Promise,function(){var i,o;return c(this,function(l){switch(l.label){case 0:return[4,v.ajax("//api.bilibili.com/x/player/playurl?cid="+e+"&bvid="+t+"&qn=0&platform=web")];case 1:if(i=l.sent(),"number"!=typeof(o=null===(n=null==i?void 0:i.durl)||void 0===n?void 0:n.length)||0===o)throw new Error(null!==(r=null==i?void 0:i.message)&&void 0!==r?r:"round play url parse error");return[2,i.durl.map(function(e){return{url:e.url,length:e.length}})]}})})}function T(e,t){for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(n<o.length/1e3)return{url:o.url,startTime:n};n-=o.length/1e3}return null}exports.RoundPlayer=E,e=new WeakMap,t=new WeakMap,n=new WeakMap,r=new WeakMap,i=new WeakMap,o=new WeakMap,l=new WeakMap,a=new WeakMap,u=new WeakMap;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-video":"ao58","../common/connects":"blC7","../common/controller":"as8u","../common/utils":"KY4m","@bilibili-live/web-player-track":"ESUf"}],"DfF7":[function(require,module,exports) {
"use strict";var e=this&&this.__createBinding||(Object.create?function(e,r,t,i){void 0===i&&(i=t),Object.defineProperty(e,i,{enumerable:!0,get:function(){return r[t]}})}:function(e,r,t,i){void 0===i&&(i=t),e[i]=r[t]}),r=this&&this.__exportStar||function(r,t){for(var i in r)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||e(t,r,i)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.VideoEventType=void 0;var t=require("@bilibili-live/web-player-video");r(require("./live-player/live-player"),exports),r(require("./round-player/round-player"),exports),exports.VideoEventType=t.EventType;
},{"@bilibili-live/web-player-video":"ao58","./live-player/live-player":"pBr6","./round-player/round-player":"W75V"}],"jM0N":[function(require,module,exports) {
window.requestIdleCallback=window.requestIdleCallback||function(e){var n=Date.now();return setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-n))}})},1)},window.cancelIdleCallback=window.cancelIdleCallback||function(e){clearTimeout(e)};
},{}],"NApx":[function(require,module,exports) {
var define;
var t;!function(e,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof t&&t.amd?t([],n):"object"==typeof exports?exports.DanmakuBridge=n():e.DanmakuBridge=n()}(self,function(){return function(){"use strict";var t={};!function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}(t);var e=function(t,e){for(var n=0,o=e.length,a=t.length;n<o;n++,a++)t[a]=e[n];return t},n="//s1.hdslb.com/bfs/live-pkg/danmaku/danmaku-v1.js",o=function(){function t(t,e){this.cacheConfig=t,this.tasks=[],this.errorTimes=0,this.initDanmaku(e)}return Object.defineProperty(t.prototype,"config",{get:function(){var t;return(null===(t=this.Danmaku)||void 0===t?void 0:t.config)||this.cacheConfig},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"container",{get:function(){var t;return null===(t=this.Danmaku)||void 0===t?void 0:t.container},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"manager",{get:function(){var t;return null===(t=this.Danmaku)||void 0===t?void 0:t.manager},enumerable:!1,configurable:!0}),t.prototype.initDanmaku=function(t){if(!this.Danmaku){var e=new URL(window.location.href).searchParams.get("danmakuEnv"),o={dev:"//uat-s1.hdslb.com/bfs/live-pkg/danmaku/danmaku-v1.js",prod:n}[e]||t||n;this.loadDanmaku(o)}},t.prototype.asyncCallMethod=function(t){for(var n,o=this,a=[],r=1;r<arguments.length;r++)a[r-1]=arguments[r];return this.Danmaku?(n=this.Danmaku[t]).call.apply(n,e([this.Danmaku],a)):new Promise(function(n){var r=setTimeout(function(){n(null)},15e3);o.tasks.push(function(){var i;clearTimeout(r),r=null,n((i=o.Danmaku[t]).call.apply(i,e([o.Danmaku],a)))})})},t.prototype.callMethod=function(t){for(var n,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];if(this.Danmaku)return(n=this.Danmaku[t]).call.apply(n,e([this.Danmaku],o))},t.prototype.callTasks=function(){this.tasks.length>0&&(this.tasks.forEach(function(t){t&&t()}),this.tasks.length=0)},t.prototype.play=function(){this.asyncCallMethod("play")},t.prototype.add=function(t){this.callMethod("add",t)},t.prototype.searchAreaDanmaku=function(t,e){return this.asyncCallMethod("searchAreaDanmaku",t,e)},t.prototype.option=function(t,e){return this.asyncCallMethod("option",t,e)},t.prototype.visible=function(t){return this.asyncCallMethod("visible",t)},t.prototype.resize=function(){this.asyncCallMethod("resize")},t.prototype.clear=function(){this.asyncCallMethod("clear")},t.prototype.destroy=function(){this.asyncCallMethod("destroy")},t.prototype.loadDanmaku=function(t){var e=this,n=document.createElement("script");n.type="text/javascript",n.onload=function(){e.Danmaku=new window.LiveDanmakuEngine.default(e.config),e.callTasks()},n.onerror=function(){e.errorTimes>=2||(e.errorTimes++,console.error("[Danmaku Core Error]","Times: "+e.errorTimes,"Url: "+t),e.loadDanmaku(t))},n.src=t,document.getElementsByTagName("body")[0].appendChild(n)},t}();return t.default=o,t}()});
},{}],"QxLc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=10;function e(t,e){for(var i=0,n=0,r=0,o=0,u=0,f=0,l=0,h="",v=0,m=0,c=0,b=0,g=0,p=0,k=new DataView(t.buffer,0,e);i<e;){var d=s(t,i,e);switch(i=d.bufPos,d.value){case 1:i=(d=s(t,i,e)).bufPos;break;case 2:i=(d=a(k,i,e)).bufPos,n=d.value,i=(d=a(k,i,e)).bufPos,r=d.value,i=(d=a(k,i,e)).bufPos,o=d.value,i=(d=a(k,i,e)).bufPos,u=d.value,i=(d=a(k,i,e)).bufPos,f=d.value,i=(d=a(k,i,e)).bufPos,l=d.value;break;case 3:h+="z ";break;case 4:i=(d=s(t,i,e)).bufPos,v=d.value,i=(d=s(t,i,e)).bufPos,m=d.value,h+="M"+v.toString()+" "+m.toString()+" ";break;case 5:i=(d=s(t,i,e)).bufPos,v=d.value,i=(d=s(t,i,e)).bufPos,m=d.value,h+="m"+v.toString()+" "+m.toString()+" ";break;case 6:i=(d=s(t,i,e)).bufPos,v=d.value,i=(d=s(t,i,e)).bufPos,m=d.value,h+="L"+v.toString()+" "+m.toString()+" ";break;case 7:i=(d=s(t,i,e)).bufPos,v=d.value,i=(d=s(t,i,e)).bufPos,m=d.value,h+="l"+v.toString()+" "+m.toString()+" ";break;case 8:i=(d=s(t,i,e)).bufPos,v=d.value,i=(d=s(t,i,e)).bufPos,m=d.value,i=(d=s(t,i,e)).bufPos,c=d.value,i=(d=s(t,i,e)).bufPos,b=d.value,i=(d=s(t,i,e)).bufPos,g=d.value,i=(d=s(t,i,e)).bufPos,p=d.value,h+="C"+v.toString()+" "+m.toString()+" "+c.toString()+" "+b.toString()+" "+g.toString()+" "+p.toString()+" ";break;case 9:i=(d=s(t,i,e)).bufPos,v=d.value,i=(d=s(t,i,e)).bufPos,m=d.value,i=(d=s(t,i,e)).bufPos,c=d.value,i=(d=s(t,i,e)).bufPos,b=d.value,i=(d=s(t,i,e)).bufPos,g=d.value,i=(d=s(t,i,e)).bufPos,p=d.value,h+="c"+v.toString()+" "+m.toString()+" "+c.toString()+" "+b.toString()+" "+g.toString()+" "+p.toString()+" "}}return 0===h.length?"":'<?xml version="1.0" standalone="no"?>\n  <svg version="1.0" xmlns="http://www.w3.org/2000/svg"\n      width="'+n+'px" height="'+r+'px" viewBox="0 0 '+n+" "+r+'"\n      preserveAspectRatio="xMidYMid meet">\n      <g transform="translate('+o+", "+u+") scale("+f+", "+l+')"\n      fill="#000000" stroke="none" shape-rendering="optimizeSpeed">\n      <path d="'+h+'"></path>\n      </g>\n  </svg>'}function s(e,s,a){for(var n=0,r=0;s<a&&n<t;){var o=e[s],u=127&o;if(r+=u<<=7*n,n++,s++,0==(128&o))return{bufPos:s,value:i(r)}}return{bufPos:-1,value:-1}}function i(t){return t>>1^1+~(1&t)}function a(t,e,s){return e+4>s?{bufPos:-1,value:-1}:{bufPos:e+4,value:t.getFloat32(e)}}var n=function(){function t(){this.currentTime=0,this.currentMask="",this.hasVideoInfo=!1,this.videoInfo={direction:"",padding:0},this._masks=[]}return t.prototype.clear=function(){this._masks.splice(0,this._masks.length)},t.prototype.input=function(t,s){var i=e(s,s.length);""!==i&&this._addMask({timestamp:t,mask:i})},t.prototype.output=function(t){if(0===this._masks.length)return null;for(var e=0,s=t-this._masks[0].timestamp,i=Math.abs(s),a=1;a<this._masks.length;++a){var n=Math.abs(t-this._masks[a].timestamp),r=Math.abs(n);if(!(r<=i))break;e=a,s=n,i=r}var o=this._masks[e];return this._masks.splice(0,e),o},t.prototype._addMask=function(t){if(0===this._masks.length)this._masks.push(t);else{for(var e=this._masks.length-1;e>=0;--e){if(this._masks[e].timestamp<t.timestamp){e+=1;break}}this._masks.splice(e,0,t),e>0&&this._masks[e].timestamp<this._masks[e-1].timestamp&&this._masks.splice(0,e)}},t.equalsUuid=function(t,e){if(16!==t.length||16!==e.length)return!1;for(var s=0;s<16;++s)if(t[s]!==e[s])return!1;return!0},t.prototype.onUpdateMask=function(t,e){var s=t.currentTime;this.getVideoInfo(t);var i=this.output(s);if(null!=this.currentTime&&this.currentTime-s>1&&e.style.removeProperty("-webkit-mask-image"),null==i||null==i.mask||i.mask===this.currentMask)return this.currentMask="",void(this.currentTime=0);var a=i.mask;if(null===a||a===this.currentMask)return this.currentMask="",void(this.currentTime=0);if(i.timestamp-s<=1&&this.hasVideoInfo){var n="data:image/svg+xml;base64,"+btoa(a),r="linear-gradient(\n        to "+this.videoInfo.direction+",\n        rgb(0,0,0,1),\n        rgb(0,0,0,1) "+this.videoInfo.padding+"%,\n        rgb(0,0,0,0) "+this.videoInfo.padding+"%,\n        rgba(0,0,0,0) "+(100-this.videoInfo.padding)+"%,\n        rgba(0,0,0,1) "+(100-this.videoInfo.padding)+"%,\n        rgba(0,0,0,1)),\n        url("+n+")";e.style.cssText+="\n        -webkit-mask-image: "+r+";\n        -webkit-mask-size: contain;\n        mask-size: contain;\n        -webkit-mask-repeat: no-repeat;\n        mask-repeat: no-repeat;\n        -webkit-mask-position: center center;\n        mask-position: center center;\n      ",this.currentMask=a,this.currentTime=i.timestamp}},t.prototype.destroy=function(){this._masks=[]},t.prototype.getVideoInfo=function(t){var e,s,i=t.videoHeight,a=t.videoWidth,n=t.clientHeight,r=t.clientWidth,o=t.clientHeight,u=t.clientWidth;if(0===i||0===a)return!1;a/i>r/n?(s="bottom",e=Math.ceil((n-i*r/a)/(2*o)*100*100)/100):(s="right",e=Math.ceil((r-a*n/i)/(2*u)*100*100)/100),this.hasVideoInfo=!0,this.videoInfo={direction:s,padding:e}},t}();exports.default=n;
},{}],"uyEh":[function(require,module,exports) {
"use strict";var e,t,n,i,o,a,r,s,l,u,c,d,h,f=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function r(e){try{l(i.next(e))}catch(t){a(t)}}function s(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,s)}l((i=i.apply(e,t||[])).next())})},p=this&&this.__generator||function(e,t){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},m=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},v=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},w=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DmType=void 0,require("requestidlecallback-polyfill");var y,g=w(require("@bilibili-live/live-danmaku-engine-v2")),k=w(require("./mask-decoder")),b=require("@bilibili-live/web-player-common"),E=b.isWebPSupported(),M=150;!function(e){e[e.Text=0]="Text",e[e.Emoji=1]="Emoji",e[e.Voice=2]="Voice"}(y=exports.DmType||(exports.DmType={}));var x="web-player-danmaku",T="danmaku-item-container",W=function(){function w(w,g){var b=this;this.container=w,this.opts=g,e.set(this,void 0),t.set(this,void 0),n.set(this,[]),i.set(this,!1),o.set(this,void 0),a.set(this,void 0),r.set(this,void 0),s.set(this,void 0),l.set(this,null),u.set(this,[]),c.set(this,void 0),d.set(this,void 0),h.set(this,0),this.parseEmoticon=function(e,t){return f(b,void 0,Promise,function(){var n,i;return p(this,function(o){switch(o.label){case 0:return!1,e.dmType!==y.Emoji?[3,2]:(n=new Image,i=t.url,n.style.width="100%",n.style.height="100%",n.src=i+(E?"@56h.webp":"@56h.png"),[4,new Promise(function(e){n.onerror=function(){e(!0)},n.onload=function(){e(!1)}})]);case 1:return o.sent()?[2,""]:[2,n.outerHTML];case 2:return[2,""];case 3:return[2]}})})},this.getEmoticonInfo=function(e){return f(b,void 0,Promise,function(){var t,n,i,o;return p(this,function(a){switch(a.label){case 0:return t=null!==(o=e.emoticonOptions)&&void 0!==o?o:{width:1,height:1,url:"",emoji:""},[4,this.parseEmoticon(e,t)];case 1:return n=a.sent(),i=e.dmType===y.Emoji?Number((t.width/t.height).toFixed(1)):1,[2,{html:n,emojiRatio:i}]}})})},this.add=function(e,i){void 0===i&&(i=!1),null!=v(b,t)&&(i?e.dmType===y.Emoji?b.getEmoticonInfo(e).then(function(n){v(b,t).add(Object.assign({},e,{html:n.html,emojiRatio:n.emojiRatio}))}).finally(function(){}):v(b,t).add(e):(v(b,n).length>20&&v(b,n).shift(),v(b,n).push(e),null==v(b,l)&&b.render()))},this.onPlay=function(e){m(b,o,e)},this.onPause=function(e){m(b,a,e)},this.offPlay=function(){m(b,o,void 0)},this.offPause=function(){m(b,a,void 0)},this.onSelect=function(e){b.offSelect(),m(b,r,e),m(b,s,function(n){var i,o=b.container.getBoundingClientRect(),a=Number(null!==(i=getComputedStyle(document.documentElement).zoom)&&void 0!==i?i:1),r=n.clientX/a-o.left,s=n.clientY/a-o.top,l=v(b,t).searchAreaDanmaku(r,s);l.length>0&&(e(l.map(function(e){return e.textData})),n.preventDefault())}),b.container.addEventListener("contextmenu",v(b,s),!0)},this.offSelect=function(){var e;null!=v(b,s)&&(null===(e=b.container)||void 0===e||e.removeEventListener("contextmenu",v(b,s),!0),m(b,s,void 0))},this.play=function(){var e;v(b,i)||(m(b,i,!0),null===(e=v(b,t))||void 0===e||e.play(),null!=v(b,o)&&v(b,o).call(b))},this.pause=function(){var e;v(b,i)&&(m(b,i,!1),null===(e=v(b,t))||void 0===e||e.pause(),null!=v(b,a)&&v(b,a).call(b))},this.setRenderType=function(n){var i;null===(i=v(b,t))||void 0===i||i.setType(n),null!=v(b,e)&&b.setBackGroundImage(v(b,e)),null!=v(b,s)&&(b.offSelect(),null!=v(b,r)&&b.onSelect(v(b,r)))},this.resize=function(){var e,n=v(b,t).config.container;return null!=n&&(n.style.width=v(b,c).clientWidth+"px",n.style.height=v(b,c).clientHeight+"px",null===(e=v(b,t))||void 0===e||e.resize()),b},this.show=function(){var e;null===(e=v(b,t))||void 0===e||e.visible(!0)},this.hide=function(){var e;null===(e=v(b,t))||void 0===e||e.visible(!1)},this.setBackGroundImage=function(t){if(null==v(b,c))throw new Error("danmakuWrapNode must be HTMLElement");t!==v(b,e)&&m(b,e,t),v(b,c).style.backgroundImage="url("+t+")",v(b,c).style.backgroundRepeat="no-repeat",v(b,c).style.backgroundPosition="center",v(b,c).style.backgroundSize="contain"},this.set=function(e){var n=v(b,t);if(null!=n)for(var i in e){var o=e[i];switch(i){case"type":b.setRenderType(o);break;case"backgroundImage":b.setBackGroundImage(o);break;case"maxCount":i="danmakuNumber",n.option(i,o);break;default:n.option(i,o)}}},this.clear=function(){var e;null===(e=v(b,t))||void 0===e||e.clear()},this.destroy=function(){var e;v(b,c).remove(),null===(e=v(b,t))||void 0===e||e.destroy(),m(b,t,null),v(b,d).destroy(),null!=v(b,l)&&(window.cancelIdleCallback(v(b,l)),m(b,l,null)),m(b,n,[]),v(b,u).forEach(function(e){return window.clearTimeout(e)}),window.removeEventListener("resize",b.resize),cancelAnimationFrame(v(b,h))},this.addMaskSVG=function(e){v(b,d).input(e[1],e[3])},this.clearMask=function(){v(b,d)._masks=[]},this.addMaskToWrap=function(e){var t=v(b,c),n=v(b,d);cancelAnimationFrame(v(b,h));m(b,h,window.requestAnimationFrame(function i(o){o>performance.now()-5&&n.onUpdateMask(e,t),m(b,h,window.requestAnimationFrame(i))}))},this.fullscreenDM=function(){v(b,c).style.position="fixed"},this.offsetDM=function(e){v(b,c).style.transform="translate3d("+e+"px, "+e+"px, 0)"},m(this,e,null==g?void 0:g.backgroundImage),m(this,c,document.createElement("div")),v(this,c).classList.add(x),v(this,c).style.cssText="\n        width: 100%;\n        height: 100%;\n        position: relative;\n        top: 0;\n        left: 0;\n        z-index: 8;\n        pointer-events: none;\n      ",w.appendChild(v(this,c)),this.initialize(),m(this,d,new k.default)}return w.prototype.render=function(){var e=this;m(this,l,window.requestIdleCallback(function(i){if(null!=i.timeRemaining)for(var o=function(){var i=v(e,n).shift(),o=100*v(e,u).length,a=setTimeout(function(){try{(null==i?void 0:i.dmType)===y.Emoji?e.getEmoticonInfo(i).then(function(n){v(e,t).add(Object.assign({},i,{html:n.html,emojiRatio:n.emojiRatio}))}).finally(function(){}):v(e,t).add(i)}catch(n){}v(e,u).shift()},o);v(e,u).push(a)};(i.timeRemaining()>0||i.didTimeout)&&v(e,n).length>0&&v(e,u).length<10;)o();if(v(e,n).length>0)return e.render();null!=v(e,l)&&(window.cancelIdleCallback(v(e,l)),m(e,l,null))},{timeout:1e3}))},w.prototype.initialize=function(){var n,i,o=document.createElement("div");o.classList.add(T);var a=document.createElement("style");a.innerHTML="\n        ."+x+" ."+T+"{\n          width: "+v(this,c).clientWidth+"px;\n          height: "+v(this,c).clientHeight+"px;\n          position: relative;\n          overflow: hidden;\n        }",document.getElementsByTagName("HEAD")[0].appendChild(a),v(this,c).appendChild(o),m(this,t,new g.default({container:o,isLive:!0,type:"div",opacity:1,fontSize:1,duration:6,danmakuArea:100,danmakuNumber:M,isRecycling:!0,isMobile:null!==(i=null===(n=this.opts)||void 0===n?void 0:n.isMobile)&&void 0!==i&&i})),null!=v(this,e)&&this.setBackGroundImage(v(this,e)),window.addEventListener("resize",this.resize)},w.prototype.closeMask=function(e){cancelAnimationFrame(v(this,h)),e||v(this,c).style.removeProperty("-webkit-mask-image")},w.prototype.getDanmakuElement=function(){return v(this,c)},w}();exports.default=W,e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakMap,r=new WeakMap,s=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,h=new WeakMap;
},{"requestidlecallback-polyfill":"jM0N","@bilibili-live/live-danmaku-engine-v2":"NApx","./mask-decoder":"QxLc","@bilibili-live/web-player-common":"KGHo"}],"Rr2x":[function(require,module,exports) {
"use strict";var o,t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EPlatform=exports.RoomStatus=void 0,function(o){o[o.Preparing=0]="Preparing",o[o.Live=1]="Live",o[o.Round=2]="Round"}(o=exports.RoomStatus||(exports.RoomStatus={})),function(o){o[o.Web=1]="Web",o[o.Android=2]="Android",o[o.Ios=3]="Ios",o[o.H5=4]="H5"}(t=exports.EPlatform||(exports.EPlatform={}));
},{}],"E90K":[function(require,module,exports) {
"use strict";function e(e,n,r){var t=null!=r?r:"直播时空次元异常，正在努力恢复中",l=document.createElement("div"),i=document.createElement("div"),a=document.createElement("div"),o=document.createElement("div"),s=document.createElement("div");l.className="web-player-error-panel",a.className="web-player-error-code",o.className="web-player-error-image",s.className="web-player-error-tip";i.style.cssText="\n    display: block;\n    max-width: 80%;\n    display: inline-block;\n    font-size: 16px;\n    color: #eee;\n    line-height: 24px;\n    padding: 10px;\n    cursor: default;\n  ",o.style.cssText="\n    display: block;\n    width: 30%;\n    height: 30%;\n    background: url(//s1.hdslb.com/bfs/static/player/live/html5/images/error.png) no-repeat 50% 0;\n    background-size: contain;\n  ",l.style.cssText="\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    box-sizing: border-box;\n    z-index: 18;\n    background: #000;\n    cursor: default;\n    display: flex;\n    flex-flow: column;\n    justify-content: center;\n    align-items: center;\n  ";var c="\n    font-size: 24px;\n    margin-top: 12px;\n    color: #999999;\n    height: 33px;\n    line-height: 33px;\n    text-align: center;\n  ";return a.style.cssText=c,s.style.cssText=c,i.innerHTML='直播已断开\n    <div style="\n    display: block;\n    font-size: 13px;\n    color: #fff;\n  " class="web-player-error-operation">\n      ( 请尝试\n        <a style="\n    color: #fd9ccc;\n    display: inline-block;\n    position: relative;\n    margin: 0 3px;\n  " class="web-player-error-reload" href="javascript:void(0);">刷新</a>\n      )\n    </div>\n  ',l.appendChild(i),l.appendChild(o),s.innerHTML=t,a.innerText="status: "+n,i.style.display="none",l.appendChild(a),l.appendChild(s),e.appendChild(l),function(){l.remove()}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createErrorPanel=void 0,exports.createErrorPanel=e;
},{}],"Rvqf":[function(require,module,exports) {
"use strict";var t=this&&this.__classPrivateFieldSet||function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},e=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.WebHaptic=void 0;var n=!1,i=function t(){n=!0,window.removeEventListener("touchstart",t),window.removeEventListener("click",t)};window.addEventListener("touchstart",i),window.addEventListener("click",i);var a=function(){function i(k){var b=this;void 0===k&&(k=!0),a.set(this,!1),o.set(this,0),s.set(this,0),r.set(this,!1),c.set(this,!0),d.set(this,[]),l.set(this,void 0),p.set(this,void 0),u.set(this,1e3),w.set(this,-1),this.enableControllerHaptic=function(){t(b,c,!0)},this.disableControllerHaptic=function(){t(b,c,!1)},this.dispose=function(){b.setState(0,0),e(b,r)&&(window.removeEventListener("gamepadconnected",e(b,l)),window.removeEventListener("gamepaddisconnected",e(b,p)))},this.setState=function(n,i){clearTimeout(e(b,w)),e(b,v).call(b,n,i),e(b,h).call(b,n,i),(n>0||i>0)&&t(b,w,window.setTimeout(function(){t(b,w,-1),b.setState(0,0)},e(b,u)))},v.set(this,function(r,c){if(i.IsSupportWebHaptic()){var d=Math.max(r,.5*c);if(d!==e(b,o)){if(t(b,o,d),t(b,s,d/65535),!n)return;d>0?e(b,a)||(t(b,a,!0),e(b,m).call(b,b)):(t(b,a,!1),window.navigator.vibrate(0))}}}),h.set(this,function(t,n){var i,a;if(e(b,r))for(var o=t/65535,s=n/65535,c=0,l=Object.entries(e(b,d));c<l.length;c++){var p=l[c],u=(p[0],p[1]);null!=u&&(null===(a=null===(i=u)||void 0===i?void 0:i.vibrationActuator)||void 0===a||a.playEffect("dual-rumble",{duration:1e3,strongMagnitude:o,weakMagnitude:s}))}}),this.getMotorPercent=function(){return e(b,s)},f.set(this,function(){t(b,d,navigator.getGamepads())}),m.set(this,function(t){n&&e(t,o)>0&&e(t,a)&&(e(t,s)<.075?e(t,W).call(t,t,e(t,s)):e(b,s)<.88?e(t,M).call(t,t,e(t,s)):e(t,g).call(t,t,e(t,s)))}),g.set(this,function(t,n){var i=100*n;window.navigator.vibrate(i),setTimeout(function(){e(t,m).call(t,t)},i)}),M.set(this,function(t,n){var i=50*n;window.navigator.vibrate(i),setTimeout(function(){e(t,m).call(t,t)},i)}),W.set(this,function(t,n){var i=100-n/.025*100;window.navigator.vibrate(2),setTimeout(function(){e(t,m).call(t,t)},i)}),t(this,c,k),e(this,c)&&t(this,r,i.IsSupportControllerHaptic()),t(this,l,function(t){console.log("A gamepad was connected:"+t.gamepad.id),e(b,f).call(b)}),t(this,p,function(t){console.log("A gamepad was disconnected:"+t.gamepad.id),e(b,f).call(b)}),e(this,r)&&(window.addEventListener("gamepadconnected",e(this,l)),window.addEventListener("gamepaddisconnected",e(this,p)),e(this,f).call(this))}var a,o,s,r,c,d,l,p,u,w,v,h,f,m,g,M,W;return a=new WeakMap,o=new WeakMap,s=new WeakMap,r=new WeakMap,c=new WeakMap,d=new WeakMap,l=new WeakMap,p=new WeakMap,u=new WeakMap,w=new WeakMap,v=new WeakMap,h=new WeakMap,f=new WeakMap,m=new WeakMap,g=new WeakMap,M=new WeakMap,W=new WeakMap,i.IsSupportControllerHaptic=function(){var t,e;return!(null==window.Gamepad||null==window.GamepadHapticActuator||null===(e=null===(t=window.GamepadHapticActuator)||void 0===t?void 0:t.prototype)||void 0===e||!e.hasOwnProperty("playEffect"))},i.IsSupportWebHaptic=function(){return null!=window.navigator.vibrate},i.IsSupport=function(){return i.IsSupportControllerHaptic()||i.IsSupportWebHaptic()},i}();exports.WebHaptic=a;
},{}],"rPeE":[function(require,module,exports) {
"use strict";var t,e,i,a,n,s,r,o,c,p=this&&this.__classPrivateFieldSet||function(t,e,i){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,i),i},h=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.VibrateTask=void 0;var u=require("@bilibili-live/web-player-common"),l=require("./haptic"),m=!0,f=function(){function f(f,d){var b=this;this.dmBiz=d,t.set(this,[]),e.set(this,new l.WebHaptic),i.set(this,void 0),a.set(this,0),n.set(this,null),s.set(this,-1),r.set(this,{shiftLimit:2,curLocation:0,speed:.4,direction:"top"}),this.clear=function(){h(b,t).splice(0,h(b,t).length)},this.input=function(t,e){var i=u.uint8ArrayToString(e),a=JSON.parse(i);b.addVibrateData({timestamp:t,vibrate:a})},this.output=function(e){if(0!==h(b,t).length){for(var i=0,a=e-h(b,t)[0].timestamp,n=Math.abs(a),s=1;s<h(b,t).length;++s){var r=Math.abs(e-h(b,t)[s].timestamp),o=Math.abs(r);if(!(o<=n))break;i=s,a=r,n=o}var c=h(b,t)[i];return h(b,t).splice(0,i),c}},this.addVibrateData=function(e){if(0===h(b,t).length)h(b,t).push(e);else{for(var i=h(b,t).length-1;i>=0;--i){if(h(b,t)[i].timestamp<e.timestamp){i+=1;break}}h(b,t).splice(i,0,e)}},this.onUpdateVibrate=function(){var t=h(b,i).currentTime,e=b.output(t);if(null!=h(b,a)&&t-h(b,a)>1&&m&&b.webXInputSetState(0,0),null!=e&&null!=e.vibrate&&e.vibrate!==h(b,n)){var s=e.timestamp-t;if(Math.abs(s)<=1){if(m){var r=Math.max(0,s);setTimeout(function(){b.webXInputSetState(e.vibrate.l,e.vibrate.r)},1e3*r)}p(b,n,e.vibrate),p(b,a,e.timestamp)}}},this.onFrameCallback=function(t){t>performance.now()-5&&b.onUpdateVibrate(),p(b,s,window.requestAnimationFrame(b.onFrameCallback))},this.destroy=function(){cancelAnimationFrame(h(b,s)),p(b,t,[]),b.webXInputSetState(0,0),h(b,e).dispose()},o.set(this,function(t){0===t?(h(b,r).shiftLimit=0,h(b,r).curLocation=0):t<.075?h(b,r).shiftLimit=2:t<=.88?h(b,r).shiftLimit=5:t>.88&&(h(b,r).shiftLimit=7),h(b,r).speed=4*t,h(b,c).call(b)}),c.set(this,function(){"top"===h(b,r).direction?(h(b,r).curLocation+=h(b,r).speed,h(b,r).curLocation+=h(b,r).speed):(h(b,r).curLocation-=h(b,r).speed,h(b,r).curLocation-=h(b,r).speed),Math.abs(h(b,r).curLocation)>h(b,r).shiftLimit&&("top"===h(b,r).direction?(h(b,r).direction="bottom",h(b,r).curLocation=h(b,r).shiftLimit):(h(b,r).direction="top",h(b,r).curLocation=h(b,r).shiftLimit)),null!=b.dmBiz&&b.dmBiz.offsetDM(h(b,r).curLocation)}),p(this,t,[]),p(this,i,f),this.onFrameCallback(0)}return f.prototype.webXInputSetState=function(t,i){h(this,e).setState(t,i),h(this,o).call(this,h(this,e).getMotorPercent())},f}();exports.VibrateTask=f,t=new WeakMap,e=new WeakMap,i=new WeakMap,a=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,c=new WeakMap;
},{"@bilibili-live/web-player-common":"KGHo","./haptic":"Rvqf"}],"YQ89":[function(require,module,exports) {
"use strict";var e,r,o=this&&this.__awaiter||function(e,r,o,t){return new(o||(o=Promise))(function(n,i){function a(e){try{u(t.next(e))}catch(r){i(r)}}function l(e){try{u(t.throw(e))}catch(r){i(r)}}function u(e){var r;e.done?n(e.value):(r=e.value,r instanceof o?r:new o(function(e){e(r)})).then(a,l)}u((t=t.apply(e,r||[])).next())})},t=this&&this.__generator||function(e,r){var o,t,n,i,a={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(o)throw new TypeError("Generator is already executing.");for(;a;)try{if(o=1,t&&(n=2&i[0]?t.return:i[0]?t.throw||((n=t.return)&&n.call(t),0):t.next)&&!(n=n.call(t,i[1])).done)return n;switch(t=0,n&&(i=[2&i[0],n.value]),i[0]){case 0:case 1:n=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,t=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(n=(n=a.trys).length>0&&n[n.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!n||i[1]>n[0]&&i[1]<n[3])){a.label=i[1];break}if(6===i[0]&&a.label<n[1]){a.label=n[1],n=i;break}if(n&&a.label<n[2]){a.label=n[2],a.ops.push(i);break}n[2]&&a.ops.pop(),a.trys.pop();continue}i=r.call(e,a)}catch(l){i=[6,l],t=0}finally{o=n=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.dmVisualVibrate=exports.pressToOpenVideoInfoListener=exports.pause10SecBlockStream=exports.getUserId=exports.updateDanmakuSetting=exports.createContextmenuHandler=exports.ajaxWatcher=exports.loadRoomInfo=exports.initPlayer=exports.commonLogInfo=exports.downloadFile=exports.isSupported=exports.PlayerEnv=exports.ENV=void 0;var i,a=require("@bilibili-live/web-player-common"),l=n(require("@bilibili-live/web-player-track")),u=require("./ui-components/error-panel"),c=require("@bilibili-live/web-player"),s=require("./vibrate/vibrate_task");function d(){var e;return null!=Object.entries&&null!=Element.prototype.prepend&&("fetch"in window&&"ReadableStream"in window&&Boolean(null===(e=window.MediaSource)||void 0===e?void 0:e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'))||a.ua.isIOS())}function p(r,o){try{var t=document.createElement("a");t.download=o,t.style.display="none";var n=new Blob([r]);t.href=window.URL.createObjectURL(n),document.body.appendChild(t),t.click(),document.body.removeChild(t)}catch(e){a.logger.error("Failed to download file")}}function f(e){a.logger.info(e+" version: "+exports.ENV.VERSION+", current date: "+(new Date).toLocaleDateString()+", build time: "+exports.ENV.BUILD_TIME),a.logger.info("user agent: "+navigator.userAgent),setTimeout(function(){a.ajax("/xlive/web-room/v1/index/getIpInfo").then(function(e){a.logger.info("client ip info: "+JSON.stringify(e))}).catch(a.logger.error)},100)}function v(e,r){var o=a.uuid(),t=x();return a.logger.info("userId: "+t),l.default.initStaticInfo({uvid:o,uid:t,version:r+exports.ENV.VERSION,roomId:e}),a.userSetting.init(t),d()||(l.default.error(l.default.ErrorCode.UnsupportedPlayer,"UnsupportedPlayer"),a.logger.error("Unsupported Player")),{userId:t,uvid:o}}function m(e,r,n){return void 0===n&&(n=!1),o(this,void 0,Promise,function(){return t(this,function(o){switch(o.label){case 0:return[4,new Promise(function(o,t){a.ajax("//api.live.bilibili.com/xlive/web-room/v2/index/getRoomPlayInfo?room_id="+e+"&protocol=0,1&format=0,1,2&codec=0,1&qn=0&platform=web&ptype=8&dolby=5"+(n?"":"&panorama=1"),{handleRes:function(e){if(e.code===a.ApiErrorCode.AreaBlock)throw u.createErrorPanel(r,a.ApiErrorCode.AreaBlock,"Sorry, bilibili is currently not available in your country according to copyright restrictions<br/>非常抱歉，根据版权方要求，您所在的地区无法观看本直播"),new Error("RoomAreaBlock");o(e.data)}}).catch(t)})];case 1:return[2,o.sent()]}})})}function y(e,r){var o=r.duration,t=void 0===o?0:o,n=r.errMsg,i=void 0===n?"ApiError":n,a=r.apiUrl,u=void 0===a?"":a;"apiBizErr"===e?l.default.error(l.default.ErrorCode.ApiBiz,i,{apiUrl:u,extFields:[]}):"requestErr"===e?l.default.error(l.default.ErrorCode.ApiRequest,i,{apiUrl:u,extFields:[],sampleRate:.01}):"responseErr"===e?l.default.error(l.default.ErrorCode.ApiResponse,i,{apiUrl:u,extFields:[]}):"perf"===e&&l.default.perf(l.default.PerfCode.Api,t,{params:{apiUrl:u},extFields:[],sampleRate:.01})}function h(e,r){return{handleLogger:function(r){var o,t=a.logger.dump();switch(r){case"copy":return void(null===(o=navigator.clipboard)||void 0===o||o.writeText(t).catch(function(){}));case"download":return void p(t,"Bilibili-Live-HTML5-Player-EventLog-"+Date.now()+".txt");case"show":e.show()}},handleVideoInfo:function(){r.show()}}}function b(e,r){var o={area:"danmakuArea",fontScale:"fontSize"},t=function(e){return e/100},n={opacity:t,fontScale:t,density:t,area:function(e){return e/4*100}};Object.entries(e).map(function(e){var r,t,i=e[0],a=e[1];return[null!==(r=o[i])&&void 0!==r?r:i,(null!==(t=n[i])&&void 0!==t?t:function(e){return e})(a)]}).forEach(function(e){var o,t=e[0],n=e[1];"display"===t?r[n?"show":"hide"]():r.set(((o={})[t]=n,o))})}function x(){return Number(a.getCookie("DedeUserID"))}function g(e,r){var o=0,t=!1;a.mediaAction.on("play",function(){n()}),a.mediaAction.on("pause",function(){u()});var n=function(){var n,i;if(clearTimeout(o),t){t=!1;var l=e instanceof c.LivePlayer&&!0===(null===(n=e.replay)||void 0===n?void 0:n.isReplay);a.logger.info("reload when blocked stream, isReplay?: "+String(l)),l?null===(i=e.replay)||void 0===i||i.reload():(e.destroy(),r.reload().catch(function(e){a.logger.error(e)}))}},i=e.on(c.VideoEventType.Play,n),l=e.ctrl.onChange(function(e,r){"playStatus"===e&&(r?n():u())}),u=function(){o=window.setTimeout(function(){a.logger.info("block stream because paused 10 sec"),t=!0,e.blockStream()},1e4)};return function(){i(),l(),clearTimeout(o),t=!1,a.mediaAction.destroy()}}function w(e){var r=[],o=function(o){r.push(performance.now()),(r=r.filter(function(e){return performance.now()-e<50})).length>=2&&(r=[],e.dispatchEvent(new MouseEvent("contextmenu",{clientX:o.changedTouches[0].clientX,clientY:o.changedTouches[0].clientY})))};return e.addEventListener("touchend",o),function(){e.removeEventListener("touchend",o)}}exports.ENV={VERSION:null!==(e="3.6.73")&&void 0!==e?e:"unknown",BUILD_TIME:null!==(r="2022/8/10 下午4:06:52")&&void 0!==r?r:"unknown",NODE_ENV:"production"},function(e){e.Activity="A",e.Room="R",e.Home="H",e.Mobile="M"}(i=exports.PlayerEnv||(exports.PlayerEnv={})),exports.isSupported=d,exports.downloadFile=p,exports.commonLogInfo=f,exports.initPlayer=v,exports.loadRoomInfo=m,exports.ajaxWatcher=y,exports.createContextmenuHandler=h,exports.updateDanmakuSetting=b,exports.getUserId=x,exports.pause10SecBlockStream=g,exports.pressToOpenVideoInfoListener=w;var E=function(e,r){var o=null;return e.on(a.ExternalEventType.SEIParseData,function(t,n,i){if(t===a.SEIType.B_LIVE_VIBRATION){var l=e.getVideoEl();null!=l&&(null==o&&(o=new s.VibrateTask(l,r)),o.input(n,i))}}),e.on(c.VideoEventType.Destroyed,function(){null==o||o.destroy(),o=null}),e.on(c.VideoEventType.WaitStart,function(){null==o||o.webXInputSetState(0,0)}),function(){null==o||o.destroy(),o=null}};exports.dmVisualVibrate=E;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-track":"ESUf","./ui-components/error-panel":"E90K","@bilibili-live/web-player":"DfF7","./vibrate/vibrate_task":"rPeE"}],"ipbQ":[function(require,module,exports) {
"use strict";async function e(e){const t=document.createElement("script"),n=document.getElementsByTagName("head")[0],a=new Promise((e,n)=>{t.onload=(()=>{e()}),t.onerror=n});t.src=e,null!=n&&n.appendChild(t),await a}function t(e,t){let n;return function(...a){void 0!==n&&window.clearTimeout(n),n=window.setTimeout(()=>{e.apply(this,a)},t)}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createFlowerRain=m,exports.bodyMaskDetector=void 0;let n=null;const a={isSupported(){var e,t;return"OffscreenCanvas"in window&&(null!=(e=navigator.hardwareConcurrency)?e:-1)>4&&(null!=(t=navigator.deviceMemory)?t:-1)>4},async start(t,a,r){let i=window.LiveShadow;if(null==i&&(null==n&&(n=e("//s1.hdslb.com/bfs/blive-engineer-pkg/live-shadow/detect-body-mask.473689a2.umd.js")),await n,null==(i=window.LiveShadow)))throw Error("LiveShadow load failed");let d=await i.detectBodyMask(t,a,r),c=!1;async function l(){d(),null!=i&&(d=await i.detectBodyMask(t,a,r),c&&d())}const h=s(t,l),v=o(t,l);return()=>{c||(c=!0,h(),v(),d())}}};function o(e,t){if(!(e instanceof HTMLVideoElement))return()=>{};let n=e.videoWidth,a=e.videoHeight;const o=setInterval(async()=>{const{videoWidth:o,videoHeight:s}=e;o===n&&s===a||(n=o,a=s,t())},1e3);return()=>{clearInterval(o)}}function s(e,n){let{width:a,height:o}=e.getBoundingClientRect();const s=new ResizeObserver(t(async e=>{const t=e[0].contentRect;t.width===a&&t.height===o||(a=t.width,o=t.height,n())},1e3));return s.observe(e),()=>{s.disconnect()}}exports.bodyMaskDetector=a;const r=()=>{let e;self.onmessage=(t=>{"start"===t.data.event&&(self.clearInterval(e),e=self.setInterval(()=>{self.postMessage({})},16.7)),"stop"===t.data.event&&self.clearInterval(e)})},i=()=>{const e=new Blob([`(${r.toString()})()`]),t=URL.createObjectURL(e);return new Worker(t)},d=new Map;let c=1;const l=i();l.onmessage=(()=>{c+=1;for(const[e,t]of d.entries())c%e==0&&t.forEach(e=>e())});const h=(e,t=1)=>{var n;const a=null!=(n=d.get(t))?n:new Set;return a.add(e),d.set(t,a),1===d.size&&1===a.size&&l.postMessage({event:"start"}),()=>{a.delete(e),0===a.size&&d.delete(t),0===d.size&&(c=0,l.postMessage({event:"stop"}))}},v=new Image;v.src="https://i0.hdslb.com/bfs/activity-plat/static/20220801/6ad1a552c5f99f6be0ff1b0072d86e59/KhLcCEjHmx.png",v.crossOrigin="anymouse";const p=[[0,0,72,63],[75,0,51,67],[139,0,70,62]],u=()=>{};function m(e,t){const{width:n,height:o}=e,s=document.createElement("canvas");s.width=n,s.height=o;let r=0,i=22,d=!0,c=u,l=u,v=u,p=null;const m=s.getContext("2d"),g=[];async function M(){v==u&&a.isSupported()&&(v=await a.start(e,e=>{p=e},{type:"bitmap"}))}(async()=>{await M(),v(),v=u})();let y=u;return{canvas:s,sprinkle(){d=!1,c==u&&(l(),l=h(()=>w(m,g,{width:n,height:o,bodyMaskBitmap:p}),2),c=h(()=>{r+=1,d||r%i!=0||g.push(f({width:n,height:o}));for(let e=0;e<g.length;e+=1){const a=g[e];a.y.v>o?(g.splice(e,1),0===g.length&&(c(),c=u,m.clearRect(0,0,n,o),l(),l=u,v(),v=u,r=0,i=22,t.onEnded())):(a.x.v+=a.x.spd,a.y.v+=a.y.spd,a.rz.v=r*a.rz.spd*a.rz.d,a.rx.v=Math.sin(r*a.rx.spd)*a.rx.d,a.z.v=(Math.sin(r*a.z.spd)+3)/a.z.scaleRate)}},2)),M(),y(),y=h(()=>{d=!0,y()},300);const e=i-4;e<2||(i=e)}}}function w(e,t,n){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,n.width,n.height),e.globalCompositeOperation="source-over";for(const a of t){const[t,n,o,s]=p[a.type];e.setTransform(1,0,0,1,a.x.v+o/2,a.y.v+s/2),e.rotate(a.rz.v),e.scale(1,a.rx.v),e.drawImage(v,t,n,o,s,-o/a.z.v/2,-s/a.z.v/2,o/a.z.v,s/a.z.v)}null!=n.bodyMaskBitmap&&(e.setTransform(1,0,0,1,0,0),e.globalCompositeOperation="destination-in",e.drawImage(n.bodyMaskBitmap,0,0,n.width,n.height))}function f(e){const t=e.height/720;return{x:{v:Math.random()*e.width-80,spd:(Math.random()+.5)*t},y:{v:-70,spd:(3*Math.random()+2)*t},z:{v:0,d:Math.random()>.5?1:-1,spd:Math.random()/30,scaleRate:t},rz:{v:2*Math.random()*Math.PI,d:Math.random()>.5?1:-1,spd:Math.random()/20},rx:{v:2*Math.random()*Math.PI,d:Math.random()>.5?1:-1,spd:Math.random()/40},type:Math.floor(3*Math.random())}}
},{}],"ZWNU":[function(require,module,exports) {
"use strict";var e,t,n,i,o,a,r,s,l,u,c,d,h,f,p,m,y=this&&this.__assign||function(){return(y=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},k=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),v=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),b=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&k(t,e,n);return v(t,e),t},g=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(o,a){function r(e){try{l(i.next(e))}catch(t){a(t)}}function s(e){try{l(i.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,s)}l((i=i.apply(e,t||[])).next())})},w=this&&this.__generator||function(e,t){var n,i,o,a,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(o=2&a[0]?i.return:a[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,a[1])).done)return o;switch(i=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,i=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(!(o=(o=r.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(s){a=[6,s],i=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}},_=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},M=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.roomBlockAdapter=exports.DanmakuBiz=void 0;var S=require("@bilibili-live/web-player-common"),D=b(require("@bilibili-live/web-player-danmaku")),B=require("./biz-interface"),T=require("./biz-common"),x=require("@bilibili-live/live-shadow"),O={mode:1,size:25,color:16777215},j=function(){function k(y,k){var v=this;this.container=y,this.opts=k,e.set(this,void 0),t.set(this,[]),n.set(this,[]),i.set(this,{rank:!1,verify:!1,level:0}),o.set(this,[]),a.set(this,[]),r.set(this,null),s.set(this,!1),l.set(this,{}),u.set(this,0),c.set(this,{mode:O.mode,color:O.color,length:20}),d.set(this,{type:"level",level:0,second:0}),h.set(this,!0),this.bodyMaskDetectorStatus=!1,f.set(this,[]),p.set(this,!1),this.maskState=!1,this.isBlocked=function(e){var r;return!!M(v,o).includes(e.type)||(!!M(v,a).includes(e.dmType)||(M(v,i).level>e.user.level||(!!(M(v,i).rank&&e.user.rank<1e4)||(!(null===(r=M(v,i))||void 0===r||!r.verify||e.user.verify)||(!!M(v,n).some(function(t){return e.text.includes(t)})||!!M(v,t).some(function(t){return t.id===e.uid}))))))},m.set(this,function(e){if(null!=e&&(Array.isArray(e.keyword_list)&&e.keyword_list.forEach(function(e){v.blockKeyword(e,"add")}),Array.isArray(e.shield_user_list)&&e.shield_user_list.forEach(function(e){var t=e.uid,n=e.uname;v.blockUser({uid:t,uname:n},"add")}),null!=(null==e?void 0:e.shield_rules))){var t=e.shield_rules;M(v,i).level=Number(t.level),M(v,i).rank=Boolean(t.rank),M(v,i).verify=Boolean(t.verify)}}),this.getDanmakuElement=function(){return M(v,e).getDanmakuElement()},this.fullscreenDM=function(){M(v,e).fullscreenDM()},this.offsetDM=function(t){M(v,e).offsetDM(t)},_(this,e,new D.default(this.container,k)),this.danmakuStateHandler=C(this),T.updateDanmakuSetting(S.userSetting.getDanmaku(),this)}return k.prototype.onSei=function(t){M(this,e).addMaskSVG(t)},k.prototype.clearMask=function(){M(this,e).clearMask()},k.prototype.changeMaskState=function(t,n,i){void 0===i&&(i=!1),this.maskState=n,n?M(this,e).addMaskToWrap(t):M(this,e).closeMask(i)},k.prototype.connectSocket=function(t,n){_(this,r,L(M(this,e),this,t,y(y({},this.opts),{isBlocked:this.isBlocked,emitDanmaku:n})))},k.prototype.initDanmakuConfig=function(e){_(this,s,!0),null!=e.userBlockInfo&&M(this,m).call(this,e.userBlockInfo),null!=e.danmakuInfo&&_(this,c,Object.assign(M(this,c),e.danmakuInfo)),null!=e.roomBlockInfo&&_(this,d,Object.assign(M(this,d),e.roomBlockInfo))},k.prototype.getBlockList=function(){return M(this,n).concat(M(this,t).map(function(e){return e.id+"_"+e.name}))},k.prototype.setBlockTypes=function(e){Array.isArray(e)&&_(this,o,e)},k.prototype.setBlockSpecialDanmakuTypes=function(e){Array.isArray(e)&&_(this,a,e)},k.prototype.blockUser=function(e,n){"add"===n&&null!=e.uid&&null!=e.uname?(M(this,l)[M(this,u)]={type:"user",value:e.uid},_(this,u,M(this,u)+1),M(this,t).push({id:e.uid,name:e.uname})):"del"===n&&_(this,t,M(this,t).filter(function(t){return t.id!==e.uid}))},k.prototype.supportMaskDanmaku=function(){return x.bodyMaskDetector.isSupported()},k.prototype.setDanmakuMask=function(t){var n=M(this,e).getDanmakuElement();""!==t?(n.style.webkitMaskImage="url("+t+")",n.style.webkitMaskSize="100%, 100%"):(n.style.webkitMaskImage="",n.style.webkitMaskSize="")},k.prototype.enableMaskDanmaku=function(e){var t,n=this;null===(t=this.stopBodyMaskDetector)||void 0===t||t.call(this),S.logger.debug("enable MaskDanmaku"),M(this,h)&&(this.bodyMaskDetectorStatus=!0,x.bodyMaskDetector.start(e,function(e){M(n,p)?n.setDanmakuMask(""):"string"==typeof e&&n.setDanmakuMask(e)},{type:"base64"}).then(function(e){S.logger.info("stop resolved");var t=function(){S.logger.info("clear trigger, "+M(n,f).length),M(n,f).forEach(function(e){return null==e?void 0:e()}),_(n,f,[])};t(),M(n,f).push(e),n.stopBodyMaskDetector=function(){S.logger.info("stop trigger"),n.setDanmakuMask(""),n.stopBodyMaskDetector=void 0,n.bodyMaskDetectorStatus=!1,t()},n.bodyMaskDetectorStatus||n.stopBodyMaskDetector()}).catch(function(e){n.setDanmakuMask(""),S.logger.error(e)}))},k.prototype.blockKeyword=function(e,t){"add"!==t||M(this,n).includes(e)?"del"===t&&_(this,n,M(this,n).filter(function(t){return t!==e})):(M(this,l)[M(this,u)]={type:"keyword",value:e},_(this,u,M(this,u)+1),M(this,n).push(e))},k.prototype.findBlockKwOrUserByIdx=function(e){return M(this,l)[e]},k.prototype.blockBatchUsers=function(e,t){"level"===e?M(this,i).level=t:["rank","verify"].includes(e)&&(M(this,i)[e]=Boolean(t))},k.prototype.clear=function(){M(this,e).clear()},k.prototype.userSendDanmaku=function(t){var n,i,o,a;return g(this,void 0,Promise,function(){var r,s=this;return w(this,function(l){switch(l.label){case 0:return r={stime:-1,mode:null!==(n=t.mode)&&void 0!==n?n:O.mode,size:null!==(i=t.fontsize)&&void 0!==i?i:O.size,color:null!==(o=t.color)&&void 0!==o?o:O.color,date:performance.now(),uid:this.opts.userId,dmid:this.opts.rnd,text:t.msg,border:!0,borderColor:"66FFFF",uname:"",isMaster:!0,dmType:D.DmType.Text},t.dm_type===D.DmType.Emoji&&(r=Object.assign({},r,{emoticonOptions:t.emoticonOptions,text:null===(a=t.emoticonOptions)||void 0===a?void 0:a.emoji,dmType:D.DmType.Emoji}),delete t.emoticonOptions),delete t.isIgnore,delete t.uniqueID,[4,new Promise(function(n,i){P(y(y({},t),{color:r.color,fontsize:r.size,mode:r.mode,rnd:r.dmid,roomid:s.opts.roomId}),function(i){var o,a,l;if(0===i.code&&M(s,h)){var u=null===(o=i.data)||void 0===o?void 0:o.mode_info;r.modeInfo=u,r.dmType===D.DmType.Emoji&&1!==(null!==(l=null===(a=t.emoticonOptions)||void 0===a?void 0:a.inPlayerArea)&&void 0!==l?l:1)||M(s,e).add(r,!0)}n(i)}).catch(function(e){i(e)})})];case 1:return[2,l.sent()]}})})},k.prototype.onSelect=function(t){M(this,e).onSelect(t)},k.prototype.offSelect=function(){M(this,e).offSelect()},k.prototype.getDanmakuConfig=function(){var e=M(this,c).color.toString(16);return e=(Array(6).join("0")+e).slice(-6),{ready:M(this,s),level:M(this,i).level,shield_list:this.getBlockList(),shield_keyword:M(this,n),shield_users:M(this,t).map(function(e){return e.id+"_"+e.name}),danmu_color:"0x"+e,danmu_length:M(this,c).length,danmu_mode:M(this,c).mode,room_silent_type:M(this,d).type,room_silent_level:M(this,d).level,room_silent_second:M(this,d).second,user_silent_level:M(this,i).level,user_silent_rank:M(this,i).rank,user_silent_verify:M(this,i).verify}},k.prototype.fetchBlockRules=function(){var e=this;S.ajax("/banned_service/v1/shield/get_shield_info").then(function(t){M(e,m).call(e,t)}).catch(function(e){S.logger.error(e)})},k.prototype.show=function(){_(this,h,!0),M(this,e).show(),this.danmakuStateHandler.dmSwitch(!0)},k.prototype.hide=function(){_(this,h,!1),M(this,e).hide(),this.danmakuStateHandler.dmSwitch(!1)},k.prototype.resize=function(){M(this,e).resize()},k.prototype.set=function(){for(var t,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];(t=M(this,e)).set.apply(t,n)},k.prototype.destroy=function(){var t,n;null===(t=M(this,r))||void 0===t||t.call(this),M(this,e).destroy(),null===(n=this.stopBodyMaskDetector)||void 0===n||n.call(this),this.danmakuStateHandler.destroy()},k.prototype.updateDanmakuExtraConfig=function(e,t){var n,i,o;void 0===t&&(t=!1),_(this,p,e.dm_tag>0&&e.platform.includes(t?B.EPlatform.H5:B.EPlatform.Web)),this.set({extra:{type:M(this,p)?e.dm_tag:0,useMode:null!==(n=null==e?void 0:e.dm_mode)&&void 0!==n?n:[],config:null!==(i=null==e?void 0:e.dm_chronos_extra)&&void 0!==i?i:"",material:null!==(o=null==e?void 0:e.material_conf)&&void 0!==o?o:[]}})},k}();function E(e,t,n,i){if("block"===e.component){var o=e.action,a=e.data,r=e.callback;switch(o){case"addShieldUser":t.blockUser(null!=a?a:{},"add"),i("addShieldList",{code:0,msg:a.uid+"_"+a.uname+"]}"});break;case"addShieldWord":A("add",a,function(e){0===e.code?(t.blockKeyword(a,"add"),i("addShieldList",{code:0,msg:a})):i("addShieldList",Object.assign({},e,{msg:e.message}))});break;case"deleteShieldId":Array.isArray(a)&&a.forEach(function(e){var o=t.findBlockKwOrUserByIdx(e),a=o.type,r=o.value;"keyword"===a?A("del",r,function(n){0===n.code?(t.blockKeyword(r,"del"),i("deleteShieldList",{code:0,msg:[e]})):i("deleteShieldList",Object.assign({},n,{msg:n.message}))}):"user"===a&&W("del",r,n,function(n){0===n.code?(t.blockUser({uid:r},"del"),i("deleteShieldList",{code:0,msg:[e]})):i("deleteShieldList",n)})});break;case"blockDanmaku":t.setBlockTypes(a.type);break;case"blockSpecialDanmaku":t.setBlockSpecialDanmakuTypes(a.type);break;case"roomListShield":I(Boolean(a),n).then(function(){i("roomListShield",Boolean(a))}).catch(function(e){S.logger.error(e)});break;case"globalShield":if(null==(null==a?void 0:a.type))break;z({type:a.type,level:a.level,minute:a.minutes},n,function(e){i("globalShield",e)});break;case"setUserShield":U({type:a.type,level:a.level,callback:function(e){null==r||r(e),0===e.code&&t.blockBatchUsers(a.type,a.level)}}).catch(function(e){S.logger.error(e)})}}}function P(e,t){return g(this,void 0,Promise,function(){return w(this,function(n){switch(n.label){case 0:return[4,S.ajax("/msg/send",{method:"POST",data:e,handleRes:t})];case 1:return[2,n.sent()]}})})}function A(e,t,n){var i="/xlive/web-ucenter/v1/banned/DelShieldKeyword";"add"===e&&(i="/xlive/web-ucenter/v1/banned/AddShieldKeyword"),S.ajax(i,{method:"POST",data:{keyword:t},handleRes:n}).catch(function(e){S.logger.error(e)})}function W(e,t,n,i){S.ajax("/liveact/shield_user",{method:"POST",data:{uid:t,roomid:n,type:"add"===e?1:0},handleRes:i}).catch(function(e){S.logger.error(e)})}function I(e,t){return g(this,void 0,Promise,function(){return w(this,function(n){switch(n.label){case 0:return[4,S.ajax("/liveact/set_room_shield",{method:"POST",data:{roomid:t,type:e}})];case 1:return n.sent(),[2]}})})}function z(e,t,n){var i=e.type,o=e.level,a=e.minute;S.ajax("/liveact/room_silent",{method:"POST",data:{room_id:t,type:i,level:o,minute:a},handleRes:n}).catch(function(e){S.logger.error(e)})}function U(e){var t=e.type,n=e.level,i=e.callback;return g(this,void 0,Promise,function(){return w(this,function(e){switch(e.label){case 0:return[4,S.ajax("/liveact/user_silent",{method:"POST",data:{type:t,level:n},handleRes:i})];case 1:return e.sent(),[2]}})})}function L(e,t,n,i){var o=i.userId,a=i.rnd,r=i.isBlocked,s=i.emitDanmaku,l=i.isMobile;return e.clear(),e.play(),n.on("message",function(n){var i,u;if("DANMU_TAG_CHANGE"===n.cmd&&t.updateDanmakuExtraConfig(n.data,l),n.cmd.startsWith("DANMU_MSG")){var c=N(n.cmd),d=c.web,h=c.h5;if(n.info[2][0]!==o||n.info[0][5]!==a){var f=K(n.info);if(!r(f)){var p=!0===l?h:d;p.danmaku&&(f.dmType===D.DmType.Emoji&&1!==(null!==(u=null===(i=n.info[0][13])||void 0===i?void 0:i.in_player_area)&&void 0!==u?u:1)||(e.add(f),t.danmakuStateHandler.dmMsg())),p.panel&&s(y(y({},n),{cmd:"DANMU_MSG"}))}}}})}function N(e){if(!e.includes(":"))return{h5:{danmaku:!0,panel:!0},web:{danmaku:!0,panel:!0}};var t=e.split(":"),n=t[4],i=t[5];return{web:{panel:0==(1&Number(n)),danmaku:0==(Number(n)>>1&1)},h5:{panel:0==(1&Number(i)),danmaku:0==(Number(i)>>1&1)}}}function K(e){var t=e[0][12],n=e[0][14],i=e[0][13],o={stime:-1,mode:e[0][1],size:e[0][2],color:e[0][3],date:performance.now(),uid:e[2][0],dmid:e[0][5],text:e[1],uname:e[2][1],user:{level:e[4][0],rank:e[2][5],verify:Boolean(e[2][6])},checkInfo:{ts:e[9].ts,ct:e[9].ct},type:e[0][9],dmType:D.DmType.Text,modeInfo:e[0][15]};return t===D.DmType.Emoji?Object.assign({},o,{emoticonOptions:i,dmType:D.DmType.Emoji}):t===D.DmType.Voice?Object.assign({},o,{dmType:D.DmType.Voice,voiceConfig:n}):o}exports.DanmakuBiz=j,e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,o=new WeakMap,a=new WeakMap,r=new WeakMap,s=new WeakMap,l=new WeakMap,u=new WeakMap,c=new WeakMap,d=new WeakMap,h=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,exports.roomBlockAdapter=E;var C=function(e){var t=null,n=-1,i=!1,o=!1,a=!1,r=!0,s=function(){var n;o&&a&&i&&null!=t?r||(r=!0,e.enableMaskDanmaku(t)):(r=!1,null===(n=e.stopBodyMaskDetector)||void 0===n||n.call(e))};return{dmSwitch:function(e){i=e,s()},updateVideoEl:function(e){t=e,s()},maskSwitch:function(e){o=e,s()},dmMsg:function(){clearTimeout(n),a=!0,n=window.setTimeout(function(){a=!1,s()},2e4),s()},destroy:function(){clearTimeout(n)}}};
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player-danmaku":"uyEh","./biz-interface":"Rr2x","./biz-common":"YQ89","@bilibili-live/live-shadow":"ipbQ"}],"vDPq":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var o in n=arguments[t])Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o]);return e}).apply(this,arguments)},n=this&&this.__awaiter||function(e,n,t,i){return new(t||(t=Promise))(function(o,r){function a(e){try{s(i.next(e))}catch(n){r(n)}}function l(e){try{s(i.throw(e))}catch(n){r(n)}}function s(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(a,l)}s((i=i.apply(e,n||[])).next())})},t=this&&this.__generator||function(e,n){var t,i,o,r,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return r={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function l(r){return function(l){return function(r){if(t)throw new TypeError("Generator is already executing.");for(;a;)try{if(t=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o;switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,i=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){a=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1];break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r);break}o[2]&&a.ops.pop(),a.trys.pop();continue}r=n.call(e,a)}catch(l){r=[6,l],i=0}finally{t=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,l])}}},i=this&&this.__spreadArray||function(e,n){for(var t=0,i=n.length,o=e.length;t<i;t++,o++)e[o]=n[t];return e};Object.defineProperty(exports,"__esModule",{value:!0}),exports.endRecommendPanel=void 0;var o,r,a=require("@bilibili-live/web-player-common");function l(e,n,t,i,o){n.classList.add("web-player-ending-panel"),n.style.cssText="\n    z-index: 3;\n    color: #fff;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    left: 0;\n    background: #000;\n  ",n.appendChild(s(t,i,o))}function s(e,n,t){var i=document.createElement("div"),a=document.createElement("div");return i.style.cssText="\n    width: 606px;\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    -webkit-transform: translate3d(-50%, -50%, 0);\n    -moz-transform: translate3d(-50%, -50%, 0);\n    -ms-transform: translate3d(-50%, -50%, 0);\n    -o-transform: translate3d(-50%, -50%, 0);\n    transform: translate3d(-50%, -50%, 0);\n  ",e.style.cssText="\n    font-size: 28px;\n    color: #aaa;\n    text-align: center;\n    line-height: 50px;\n    height: 50px;\n    margin-bottom: 20px;\n  ",i.appendChild(e),n.classList.add("web-player-ending-panel-recommendList"),t.forEach(function(e,t){t<6&&r("info",{type:o.recommendListShow,data:e}),n.appendChild(d(e))}),n.style.cssText="\n    display: "+(t.length>0?"block":"none")+";\n    height: 236px;\n    overflow: hidden;\n  ",a.innerText="闲置中",a.style.cssText="display: none;",i.appendChild(n),i.appendChild(a),i}function d(e){var n,t,i=document.createElement("a"),l=document.createElement("div"),s=document.createElement("div");l.style.cssText="\n    position: relative;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n  ",s.style.cssText="\n    width: 100%;\n    position: absolute;\n    height: 50px;\n    bottom: -20px;\n    z-index: 3;\n    background-image: linear-gradient(-180deg, rgba(0, 0, 0, 0) 0%, #000000 100%);\n    color: #fffff;\n    -webkit-transition: bottom 0.3s ease-in-out;\n    -moz-transition: bottom 0.3s ease-in-out;\n    -ms-transition: bottom 0.3s ease-in-out;\n    -o-transition: bottom 0.3s ease-in-out;\n    transition: bottom 0.3s ease-in-out;\n  ";var d=document.createElement("div");d.style.cssText="\n    margin-top: 8px;\n    height: 16px;\n    position: relative;\n    line-height: 16px;\n    color: '#fff\n  ";var c=document.createElement("div");c.innerText=e.title,c.style.cssText="\n    padding: 0 8px;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    color: #fff;\n  ";var p=document.createElement("div");p.style.cssText="\n    padding: 6px 8px;\n    color: #969696;\n    height: 16px;\n    position: relative;\n    line-height: 16px;\n  ";var u=document.createElement("div");u.style.cssText="\n    width: 60%;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    overflow: hidden;\n    float: left;\n  ",u.innerText=e.uname;var h=document.createElement("span");h.style.cssText="\n    float: right;\n  ","online"in e&&(e.online>1e4?h.innerHTML=Math.floor(e.online/1e4).toString()+"万":h.innerText=e.online.toString()),!0===(null===(n=e.watched_show)||void 0===n?void 0:n.switch)&&null!=(null===(t=e.watched_show)||void 0===t?void 0:t.text_small)&&(h.innerText=e.watched_show.text_small),p.appendChild(u),p.appendChild(h),d.appendChild(c),s.appendChild(d),s.appendChild(p);var m=document.createElement("img");if(m.alt=e.title,m.src=e.cover+(a.isWebPSupported()?"@384w_240h.webp":"@384w_240h.jpg"),m.style.cssText="\n    width: 100%;\n    height: 100%;\n    border: none;\n  ",l.appendChild(m),i.appendChild(l),i.appendChild(s),i.style.cssText="\n    width: 192px;\n    height: 108px;\n    -webkit-border-radius: 2px;\n    -moz-border-radius: 2px;\n    border-radius: 2px;\n    float: left;\n    overflow: hidden;\n    display: inline-block;\n    position: relative;\n    margin: 5px;\n    text-decoration: none;\n    outline: none;\n    color: #444;\n    font-size: 12px;\n    cursor: pointer;\n  ",i.href="javascript:void(0);",i.addEventListener("mouseover",function(){s.style.bottom="0px"}),i.addEventListener("mouseout",function(){s.style.bottom="-20px"}),i.onclick=function(){var n="";n="text"in e?"//www.bilibili.com/video/"+e.bvid:"//live.bilibili.com/"+e.roomid,window.open(n),r("info",{type:o.recommendListClick,data:e}),r("redirect",{type:o.recommendListClick,data:n})},i.onmouseenter=function(){r("info",{type:o.recommendListMoveEnter,data:e})},"text"in e){var f=document.createElement("div");f.innerText=e.text,f.style.cssText="\n      background: #4fc1e9;\n      position: absolute;\n      top: 4px;\n      right: 5px;\n      height: 16px;\n      line-height: 16px;\n      width: 48px;\n      padding: 1px 4px;\n      color: #fff;\n      border-radius: 2px;\n    ",l.appendChild(f)}return i}function c(e,n,t,i,o){var s=t.roomId,d=t.rnd,c=t.showRecommend;void 0===o&&(o=""),r=i;var u=document.createElement("div"),h=document.createElement("div"),m=c;if(c){var f=a.loading(e);p(s,d).then(function(t){if(f(),m){var i=t.tips,r=void 0===i?"主播已关播":i,a=t.recommend,s=void 0===a?[]:a;h.innerText=r,""!==o&&(h.innerText=o),l(e,n,h,u,s)}else h.innerText="主播已关播",l(e,n,h,u,[])}).catch(function(e){a.logger.error(e),f()})}else h.innerText="主播已关播",l(e,n,h,u,[]);return function(){m=!1,h.innerText="主播已关播",u.style.display="none"}}function p(l,s){return n(this,void 0,Promise,function(){var n,d;return t(this,function(t){switch(t.label){case 0:return[4,a.ajax("/xlive/web-room/v1/index/getOffLiveList?room_id="+l+"&count=8&rnd="+s.toFixed(0))];case 1:return null!=(n=t.sent())&&Array.isArray(n.recommend)||r("info",{type:o.recommendListNull}),d=n.record_list.map(function(n){return e(e({},n),{roomid:n.rid,text:"主播推荐"})}),n.recommend=i(i([],d),n.recommend).sort(function(e,n){return e.global_order-n.global_order}),[2,n]}})})}!function(e){e.recommendListNull="nolive",e.recommendListClick="click",e.recommendListMoveEnter="move",e.recommendListShow="show"}(o||(o={})),exports.endRecommendPanel=c;
},{"@bilibili-live/web-player-common":"KGHo"}],"vS7T":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var a=require("../biz-interface"),l='\n  <svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 157 45">\n    <defs>\n      <style>\n        .cls-1,\n        .cls-2 {\n          fill: #fff;\n          opacity: 0.4;\n          filter: url(#shadow);\n        }\n\n        .cls-2 {\n          fill-rule: evenodd;\n        }\n      </style>\n    </defs>\n    <defs>\n      <filter id="shadow">\n        <feDropShadow dx="1" dy="2" stdDeviation="1" />\n      </filter>\n    </defs>\n    <path class="cls-1 xxx"\n      d="M124.92,10.08h-9.28l.86-2a.31.31,0,0,0-.28-.43h-4a.62.62,0,0,0-.56.38l-.88,2.07H99.8a.3.3,0,0,0-.3.31v1.23a.29.29,0,0,0,.3.3H110L108.66,15H102a.3.3,0,0,0-.31.3v23H99.8a.29.29,0,0,0-.3.3V39.8a.3.3,0,0,0,.3.31h25.12a.31.31,0,0,0,.31-.31V38.57a.3.3,0,0,0-.31-.3h-1.84V16.21A1.21,1.21,0,0,0,121.86,15h-8.3l1.3-3.07h10.06a.3.3,0,0,0,.31-.3V10.39A.31.31,0,0,0,124.92,10.08Zm-6.74,28.19H106.54V34.59h11.64Zm0-5.52H106.54V28.46h11.64Zm0-6.12H106.54V22.34h11.64Zm-.61-9.81a.61.61,0,0,1,.61.62V20.5H106.54V16.82Z" />\n    <path class="cls-1"\n      d="M137.06,26.83l-1.42.59V15.6h1.54a.3.3,0,0,0,.3-.31V14.07a.3.3,0,0,0-.3-.31h-1.54V7.94a.3.3,0,0,0-.3-.31h-4.29a.31.31,0,0,0-.31.31v5.82h-1.53a.31.31,0,0,0-.31.31v1.22a.31.31,0,0,0,.31.31h1.53V29.51l-1.46.62a.61.61,0,0,0-.38.56v1a.31.31,0,0,0,.43.28l1.41-.6v6.93a.61.61,0,0,1-.61.61h-.76a.3.3,0,0,0-.28.43l.44,1a.6.6,0,0,0,.56.37h4.33a1.22,1.22,0,0,0,1.22-1.23V29.26l1.47-.62a.61.61,0,0,0,.37-.56v-1A.3.3,0,0,0,137.06,26.83Z" />\n    <path class="cls-1"\n      d="M138.49,17.44h5.82v6.12a.31.31,0,0,0,.31.31h3.68a.3.3,0,0,0,.3-.31V17.44h5.82a.31.31,0,0,0,.31-.31V15.9a.31.31,0,0,0-.31-.3H148.6V10.7h4a1.25,1.25,0,0,0,1.13-.75l.8-1.89a.31.31,0,0,0-.28-.43h-3.42a.62.62,0,0,0-.57.38l-.2.48a.62.62,0,0,1-.56.37h-11a.3.3,0,0,0-.3.31v1.22a.3.3,0,0,0,.3.31h5.82v4.9h-5.82a.3.3,0,0,0-.3.3v1.23A.3.3,0,0,0,138.49,17.44Z" />\n    <path class="cls-1"\n      d="M154.36,11.62h-3.42a.59.59,0,0,0-.56.37l-1,2.26a.31.31,0,0,0,.29.43h3.62a.3.3,0,0,0,.28-.19l1-2.45A.3.3,0,0,0,154.36,11.62Z" />\n    <path class="cls-1"\n      d="M155.68,23.44l-2.08-4.9a.31.31,0,0,0-.28-.18H149.7a.31.31,0,0,0-.29.42l2.16,5.09h3.83A.3.3,0,0,0,155.68,23.44Z" />\n    <path class="cls-1"\n      d="M139.25,14.31a.63.63,0,0,0,.57.37h3.42a.3.3,0,0,0,.28-.43l-1-2.26a.61.61,0,0,0-.56-.37h-3.42a.31.31,0,0,0-.29.42Z" />\n    <path class="cls-1"\n      d="M143.52,18.78a.3.3,0,0,0-.28-.42h-3.62a.31.31,0,0,0-.29.18l-2.08,4.9a.31.31,0,0,0,.29.43h3.82Z" />\n    <path class="cls-1"\n      d="M153.2,25.4H138.8a.31.31,0,0,0-.31.31V39.8a.31.31,0,0,0,.31.31h15.32a.3.3,0,0,0,.3-.31V26.63A1.22,1.22,0,0,0,153.2,25.4Zm-8.89,12.87h-1.53v-4.9h1.53Zm0-6.74h-1.53V27.24h1.53Zm5.82,6.74H148.6v-4.9h1.53Zm0-6.74H148.6V27.24h.92a.61.61,0,0,1,.61.61Z" />\n    <path class="cls-1"\n      d="M32.47,5.09l4.14-.51a.23.23,0,0,1,.25.21l2.66,31.36a.22.22,0,0,1-.22.24h-3a.25.25,0,0,1-.24-.21L32.27,5.35A.24.24,0,0,1,32.47,5.09Z" />\n    <path class="cls-2"\n      d="M26.84,21.69l4.62-.57a.24.24,0,0,1,.27.2l2,16.42a.21.21,0,0,1-.19.24l-3.41.43a.21.21,0,0,1-.23-.17L26.64,22A.23.23,0,0,1,26.84,21.69Z" />\n    <path class="cls-2"\n      d="M41.21,21.44h4.55a.22.22,0,0,1,.22.22V38.25a.21.21,0,0,1-.21.21H42.48a.23.23,0,0,1-.23-.21L41,21.68A.22.22,0,0,1,41.21,21.44Z" />\n    <path class="cls-2"\n      d="M25.36,13.32l2-.24a.22.22,0,0,1,.25.19l.79,5.92a.22.22,0,0,1-.19.25l-1.56.19a.22.22,0,0,1-.25-.18l-1.18-5.89A.19.19,0,0,1,25.36,13.32Z" />\n    <path class="cls-2"\n      d="M28.44,13.16l.73,5.94a.22.22,0,0,0,.24.19l1.82-.23a.22.22,0,0,0,.19-.24l-.73-6a.21.21,0,0,0-.23-.18l-1.83.23A.21.21,0,0,0,28.44,13.16Z" />\n    <path class="cls-2"\n      d="M40.35,13.21l.46,6a.21.21,0,0,0,.2.19h1.61a.21.21,0,0,0,.21-.21l-.13-6a.22.22,0,0,0-.22-.21H40.56A.2.2,0,0,0,40.35,13.21Z" />\n    <path class="cls-2"\n      d="M43.5,13.21l.13,6a.22.22,0,0,0,.22.22h1.71a.22.22,0,0,0,.22-.22v-6a.21.21,0,0,0-.21-.21H43.71A.21.21,0,0,0,43.5,13.21Z" />\n    <path class="cls-2"\n      d="M52.21,40.3a.25.25,0,0,0,.22.23,26.47,26.47,0,0,0,17.13-3.72c2.65-1.63,6.3-5.58,1-8.59a24.15,24.15,0,0,0-14.72-3.06.25.25,0,0,1-.28-.22A138.25,138.25,0,0,1,54.67.58a.2.2,0,0,0-.27-.2L47.51,2.89a.23.23,0,0,0-.15.26A354.89,354.89,0,0,1,52.21,40.3Zm13.51-8.11a27.14,27.14,0,0,1-6,4.23.22.22,0,0,1-.32-.14c-.11-.55-.59-4-.87-6.63a.22.22,0,0,1,.25-.24,22.53,22.53,0,0,1,6.85,2.41C65.83,31.92,65.83,32.09,65.72,32.19Z" />\n    <path class="cls-2"\n      d="M6.14,40.3a.26.26,0,0,0,.23.23,26.44,26.44,0,0,0,17.12-3.72c2.65-1.63,6.3-5.58,1-8.59A24.14,24.14,0,0,0,9.81,25.16a.26.26,0,0,1-.28-.22A138.68,138.68,0,0,1,8.61.5.21.21,0,0,0,8.34.29L1.45,2.8a.23.23,0,0,0-.15.26A362.8,362.8,0,0,1,6.14,40.3Zm13.52-8.11a27.39,27.39,0,0,1-6,4.23.22.22,0,0,1-.32-.14c-.12-.55-.6-4-.88-6.63a.22.22,0,0,1,.26-.24,22.79,22.79,0,0,1,6.85,2.41A.22.22,0,0,1,19.66,32.19Z" />\n    <path class="cls-1"\n      d="M78.63,5.09l4.14-.51a.23.23,0,0,1,.25.21l2.66,31.36a.22.22,0,0,1-.22.24h-3a.25.25,0,0,1-.24-.21L78.43,5.35A.24.24,0,0,1,78.63,5.09Z" />\n    <path class="cls-2"\n      d="M73,21.69l4.62-.57a.24.24,0,0,1,.27.2l2,16.42a.21.21,0,0,1-.19.24l-3.41.43a.21.21,0,0,1-.23-.17L72.8,22A.23.23,0,0,1,73,21.69Z" />\n    <path class="cls-2"\n      d="M87.37,21.44h4.55a.22.22,0,0,1,.22.22V38.25a.21.21,0,0,1-.21.21H88.64a.23.23,0,0,1-.23-.21L87.15,21.68A.22.22,0,0,1,87.37,21.44Z" />\n    <path class="cls-2"\n      d="M71.52,13.32l2-.24a.22.22,0,0,1,.25.19l.79,5.92a.22.22,0,0,1-.19.25l-1.56.19a.22.22,0,0,1-.25-.18l-1.18-5.89A.2.2,0,0,1,71.52,13.32Z" />\n    <path class="cls-2"\n      d="M74.6,13.16l.73,5.94a.22.22,0,0,0,.24.19l1.82-.23a.22.22,0,0,0,.19-.24l-.73-6a.21.21,0,0,0-.23-.18l-1.83.23A.22.22,0,0,0,74.6,13.16Z" />\n    <path class="cls-2"\n      d="M86.51,13.21l.46,6a.21.21,0,0,0,.2.19h1.61a.21.21,0,0,0,.21-.21l-.13-6a.22.22,0,0,0-.22-.21H86.72A.2.2,0,0,0,86.51,13.21Z" />\n    <path class="cls-2"\n      d="M89.66,13.21l.13,6a.22.22,0,0,0,.22.22h1.71a.22.22,0,0,0,.22-.22v-6a.21.21,0,0,0-.21-.21H89.87A.21.21,0,0,0,89.66,13.21Z" />\n  </svg>\n',n="https://i0.hdslb.com/bfs/activity-plat/static/20210309/d0411babbbf77c49ca42a3320eb804ae/xUd8TRdAk.png";function s(a,l){void 0===l&&(l=!1);var n=document.createElement("div");return n.className="web-player-icon-roomStatus",n.style.cssText="\n    position: absolute;\n    left: 10px;\n    top: 10px;\n    z-index: 2;\n    pointer-events: none;\n  ",a.appendChild(n),{destroy:function(){n.remove()},setRoomStatus:function(a){t(n,a,l)},el:n}}function t(s,t,h){t===a.RoomStatus.Round?(s.innerHTML="",s.style.cssText+="\n      background-size: 78px 50px;\n      width: 78px;\n      height: 50px;\n      opacity: 0.8;\n      background: url("+n+") no-repeat 0 0;\n    "):(s.innerHTML=l,s.style.cssText+="\n      width: 122px;\n      height: 43px;\n      opacity: 0.4;\n      background: none;\n      "+(h?"transform: scale(0.7);transform-origin: 0 0;":"")+"\n    ")}exports.default=s;
},{"../biz-interface":"Rr2x"}],"EORf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e='\n  <svg id="图层_1" data-name="图层 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 36 36">\n    <defs>\n      <style>\n        .feed-back-cls-1 {\n          fill: #fff;\n          fill-rule: evenodd;\n          filter: url(#shadow);\n        }\n      </style>\n    </defs>\n    <defs>\n      <filter id="shadow">\n        <feDropShadow dx="0.3" dy="0.3" stdDeviation="0.6" />\n      </filter>\n    </defs>\n    <path class="feed-back-cls-1"\n      d="M24,10H12a2,2,0,0,0-2,2V26l3-3H24a2,2,0,0,0,2-2V12A2,2,0,0,0,24,10ZM19,21H17V19h2Zm1.19-4.38a2,2,0,0,0-.18.15l-.37.31c-.49.4-.64.58-.64.92H17c0-1.84,2-1.76,2-3a1,1,0,0,0-1-1,1,1,0,0,0-.81.41.9.9,0,0,0-.11.24.5.5,0,0,1-.48.35h-1a.5.5,0,0,1-.5-.5.28.28,0,0,1,0-.09,3.17,3.17,0,0,1,.21-.72A3,3,0,0,1,21,15,2.14,2.14,0,0,1,20.19,16.62Z" />\n  </svg>\n';function n(n,t){var o=document.createElement("div"),i=0;function s(e){e.stopPropagation(),clearTimeout(i),i=0,o.style.opacity="1.0"}function a(){clearTimeout(i),i=window.setTimeout(function(){o.style.opacity="0"},1e3),o.style.opacity="0.8"}function r(){i=window.setTimeout(function(){o.style.opacity="0"},1e3)}return o.className="web-player-icon-feedback",o.innerHTML=e,o.style.cssText="\n    position: absolute;\n    top: 0px;\n    right: 12px;\n    z-index: 100;\n    width: 36px;\n    height: 36px;\n    cursor: pointer;\n    transition: opacity 0.5s ease 0s;\n    opacity: 0;\n  ",n.appendChild(o),n.addEventListener("mousemove",a),n.addEventListener("mouseleave",r),o.addEventListener("click",t),o.addEventListener("mousemove",s),function(){o.remove(),n.removeEventListener("mousemove",a),n.removeEventListener("mouseleave",r),o.removeEventListener("click",t),o.removeEventListener("mousemove",s),clearTimeout(i)}}exports.default=n;
},{}],"weyG":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@bilibili-live/web-player-common");function n(n,o,a){void 0===a&&(a=300),e.logger.info("start round count down");var i=n.getElementsByClassName("web-player-video-round-counter");1===i.length&&i[0].remove();var l=document.createElement("div");l.innerHTML='\n    <p style="'+r(20)+'">\n      <span>'+t(a)+'</span>\n      后\n      </p>\n    <p style="'+r(30)+'">主播的投稿视频将轮流播放</p>\n  ',l.classList.add("web-player-video-round-counter"),l.style.cssText="\n    width: 400px;\n    position: absolute;\n    z-index: 10;\n    pointer-events: none;\n    left: 50%;\n    top: 50%;\n    margin-left: -200px;\n    margin-top: -66px;\n    color: #aaa;\n  ";var s=l.getElementsByTagName("span");s[0].style.fontSize="50px",n.append(l);var p=window.setInterval(function(){a>1?s[0].innerText=t(--a):(clearInterval(p),l.remove(),o().catch(function(n){e.logger.error(n)}))},1e3);return function(){clearInterval(p),l.remove()}}function t(e){var n=Math.floor(e/60),t=Math.floor(e%60);return"0"+n+":"+(t<10?"0"+t.toString():t)}function r(e){return"\n    text-align: center;\n    line-height: 50px;\n    letter-spacing: 3px;\n    font-weight: normal;\n    font-size: "+e+"px;\n    line-height: 1;\n  "}exports.default=n;
},{"@bilibili-live/web-player-common":"KGHo"}],"ntSr":[function(require,module,exports) {
module.exports={"web-player-context-menu":"_web-player-context-menu_860e6","context-menu-item":"_context-menu-item_860e6",disabled:"_disabled_860e6","context-sub-menu":"_context-sub-menu_860e6","menu-item-hr":"_menu-item-hr_860e6","context-menu-right-arrow":"_context-menu-right-arrow_860e6","context-menu-text":"_context-menu-text_860e6","context-sub-menu-item":"_context-sub-menu-item_860e6","left-sub-menu":"_left-sub-menu_860e6","blp-icon-show":"_blp-icon-show_860e6","blp-icon-copy":"_blp-icon-copy_860e6","blp-icon-download":"_blp-icon-download_860e6"};var e='._web-player-context-menu_860e6 li,ul._web-player-context-menu_860e6{list-style:none;margin:0;padding:0}ul._web-player-context-menu_860e6{position:absolute;left:-9999px;top:-9999px;padding:3px;min-width:80px;font-size:12px;color:#eee;background:rgba(28,28,28,.9);border-radius:3px;opacity:0;text-shadow:0 0 2px rgba(0,0,0,.5);transition:opacity .1s cubic-bezier(0,0,.2,1);z-index:99;font-family:PingFang SC,Microsoft YaHei;outline:none}ul._web-player-context-menu_860e6 ._context-menu-item_860e6{position:relative;padding:3px 20px;width:200px;line-height:22px;cursor:pointer}ul._web-player-context-menu_860e6 ._context-menu-item_860e6._disabled_860e6{color:#777;cursor:default}ul._web-player-context-menu_860e6 ._context-menu-item_860e6:not(._disabled_860e6):hover{background:hsla(0,0%,100%,.1)}ul._web-player-context-menu_860e6 ._context-menu-item_860e6:not(._disabled_860e6):hover ._context-sub-menu_860e6{width:auto;opacity:1}ul._web-player-context-menu_860e6 ._context-menu-item_860e6._menu-item-hr_860e6:before{content:"";position:absolute;bottom:0;left:9px;right:9px;height:1px;background-color:#aaa}ul._web-player-context-menu_860e6 ._context-menu-item_860e6 ._context-menu-right-arrow_860e6{position:absolute;right:4px;top:10px;width:8px;height:8px}ul._web-player-context-menu_860e6 ._context-menu-item_860e6 ._context-menu-right-arrow_860e6:before{content:"";position:absolute;top:0;left:0;border:4px solid transparent;border-left-color:#eee;opacity:.8}ul._web-player-context-menu_860e6 ._context-menu-item_860e6 ._context-menu-text_860e6{display:inline-block;width:100%;text-overflow:ellipsis;white-space:nowrap;vertical-align:middle;overflow:hidden}ul._web-player-context-menu_860e6 ._context-sub-menu_860e6{list-style:none;outline:none;margin:0;padding:0;position:absolute;left:100%;top:0;width:0;color:#eee;background:rgba(28,28,28,.9);border-radius:3px;opacity:0;overflow:hidden}ul._web-player-context-menu_860e6 ._context-sub-menu_860e6 ._context-sub-menu-item_860e6{padding:3px 20px;width:120px;height:22px;line-height:22px;text-align:left;white-space:nowrap;text-overflow:ellipsis;overflow:hidden;transition:all .3s ease-in-out}ul._web-player-context-menu_860e6 ._context-sub-menu_860e6 ._context-sub-menu-item_860e6._disabled_860e6{color:#777;cursor:default}ul._web-player-context-menu_860e6 ._context-sub-menu_860e6 ._context-sub-menu-item_860e6:not(._disabled_860e6):hover{background:hsla(0,0%,100%,.1)}ul._web-player-context-menu_860e6._left-sub-menu_860e6 ._context-sub-menu_860e6{left:0;transform:translate(-100%)}ul._web-player-context-menu_860e6 ._blp-icon-copy_860e6,ul._web-player-context-menu_860e6 ._blp-icon-download_860e6,ul._web-player-context-menu_860e6 ._blp-icon-show_860e6{width:12px;height:12px;margin-right:6px;display:inline-block;position:relative;top:2px;margin-left:2px;pointer-events:none}ul._web-player-context-menu_860e6 ._blp-icon-copy_860e6:after,ul._web-player-context-menu_860e6 ._blp-icon-copy_860e6:before,ul._web-player-context-menu_860e6 ._blp-icon-download_860e6:after,ul._web-player-context-menu_860e6 ._blp-icon-download_860e6:before,ul._web-player-context-menu_860e6 ._blp-icon-show_860e6:after,ul._web-player-context-menu_860e6 ._blp-icon-show_860e6:before{content:"";position:absolute}ul._web-player-context-menu_860e6 ._blp-icon-show_860e6:before{width:14px;height:10px;border-radius:14px/10px;background:#aaa;top:1px;left:-1px}ul._web-player-context-menu_860e6 ._blp-icon-show_860e6:after{width:6px;height:10px;border-radius:6px/10px;background:#777;left:3px;top:1px}ul._web-player-context-menu_860e6 ._blp-icon-copy_860e6:after,ul._web-player-context-menu_860e6 ._blp-icon-copy_860e6:before{width:5px;height:5px;border:2px solid #aaa;top:0;left:0;border-radius:1px}ul._web-player-context-menu_860e6 ._blp-icon-copy_860e6:after{top:4px;left:4px;background:#1c1c1c;background:rgba(28,28,28,.8);-webkit-box-shadow:-1px 0 0 rgba(28,28,28,.8),0 -1px 0 rgba(28,28,28,.8);-moz-box-shadow:-1px 0 0 rgba(28,28,28,.8),0 -1px 0 rgba(28,28,28,.8);box-shadow:-1px 0 0 rgba(28,28,28,.8),0 -1px 0 rgba(28,28,28,.8)}ul._web-player-context-menu_860e6 ._blp-icon-download_860e6:before{width:6px;height:8px;background:#aaa;top:1px;left:3px;border-radius:1px}ul._web-player-context-menu_860e6 ._blp-icon-download_860e6:after{border:5px solid transparent;border-top-color:#aaa;top:7px;left:1px}',t=document.createElement("style");t.type="text/css",t.appendChild(document.createTextNode(e)),document.head.appendChild(t);
},{}],"wERC":[function(require,module,exports) {
"use strict";var e,t=this&&this.__assign||function(){return(t=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},n=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},a=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@bilibili-live/web-player-common"),u=i(require("./index.less")),o=function(){function i(){this.menuContainer=null,e.set(this,{})}return i.prototype.show=function(e,t){void 0===t&&(t=!1),t?this.menuContainer.classList.add(u.default["left-sub-menu"]):this.menuContainer.classList.remove(u.default["left-sub-menu"]);var n=this.menuContainer.style;n.top=e.top+"px",n.left=e.left+"px",n.opacity="1"},i.prototype.hide=function(){var e=this.menuContainer.style;e.top="",e.left="",e.opacity="0"},i.prototype.initContextmenu=function(e){this.menuContainer=this.createMenuUl(u.default["web-player-context-menu"]);var t=this.createContextmenuList(e);this.menuContainer.appendChild(t)},i.prototype.prependMenuItem=function(e,n){var a=t(t({},n),{name:e}),i=this.createMenuElement(a);return this.menuContainer.prepend(i),function(){i.remove()}},i.prototype.resetSubmenu=function(t,a,i,r){var o;void 0===r&&(r=-1);var l=n(this,e)[t];if(null!=l){var s=null!==(o=l.querySelector(u.default["context-sub-menu"]))&&void 0!==o?o:this.createMenuUl(u.default["context-sub-menu"]);s.innerHTML="";var c=a.map(function(e){return{label:e.label,value:e.value,disable:e.value===r,click:i.bind(null,e.value)}}),d=this.createSubmenuFragment(c);s.appendChild(d),l.appendChild(s)}},i.prototype.submenuActive=function(t,a){var i,r=n(this,e)[t];if(null!=r){for(var o=0,l=r.getElementsByClassName(u.default["context-sub-menu-item"]);o<l.length;o++){l[o].classList.remove(u.default.disabled)}null===(i=r.getElementsByClassName(u.default["context-sub-menu-item"])[a])||void 0===i||i.classList.add(u.default.disabled)}},i.prototype.createMenuUl=function(e){return void 0===e&&(e=""),r.createElement("ul",{classname:e})},i.prototype.createArrow=function(){return r.createElement("div",{classname:u.default["context-menu-right-arrow"]})},i.prototype.createMenuLi=function(e){var n=t({disable:!1,hr:!1,remove:!1},e),a=u.default.disabled,i=u.default["menu-item-hr"];return r.createElement("li",{classname:e.classname+(n.disable?" "+a:"")+(n.hr?" "+i:""),text:"",attributes:n.remove?[["data-auto-remove","1"]]:[]})},i.prototype.createSubmenuLi=function(e){var n=t({disable:!1,icon:""},e),a=u.default.disabled,i=r.createElement("li",{classname:n.classname+(n.disable?" "+a:""),text:n.text});if(""!==n.icon){var o=r.createElement("span",{classname:u.default[n.icon]});i.prepend(o)}return i.onclick=function(){!i.className.includes(u.default.disabled)&&n.click(n.index)},i},i.prototype.createContextmenuList=function(e){var t=this,n=document.createDocumentFragment();return e.forEach(function(e){n.appendChild(t.createMenuElement(e))}),n},i.prototype.createMenuElement=function(t){var a=this,i=t.name,o=t.label,l=t.click,s=t.hr,c=void 0!==s&&s,d=t.submenu,m=void 0===d?null:d,p=t.autoRemove,f=void 0!==p&&p,h=this.createMenuLi({text:o,classname:u.default["context-menu-item"],disable:"function"!=typeof l&&null==m,remove:f,hr:c}),v=r.createElement("span",{text:o,classname:u.default["context-menu-text"]});if(h.appendChild(v),null!=l&&h.addEventListener("click",function(){l(),a.hide()}),null!=m){h.appendChild(this.createArrow());var b=this.createMenuUl(u.default["context-sub-menu"]),y=this.createSubmenuFragment(m);b.appendChild(y),h.appendChild(b)}return f||(n(this,e)[i]=h),h},i.prototype.createSubmenuFragment=function(e){var t=this,n=document.createDocumentFragment();return e.forEach(function(e,a){var i,r=t.createSubmenuLi({text:e.label,classname:u.default["context-sub-menu-item"],disable:e.disable,icon:null!==(i=e.icon)&&void 0!==i?i:"",index:a,click:function(){e.click(),t.hide()}});n.appendChild(r)}),n},i.prototype.removeMenuItems=function(){for(var e=this.menuContainer.querySelectorAll('[data-auto-remove="1"]'),t=e.length-1;t>=0;t--){var n=e[t];this.menuContainer.removeChild(n)}},i.prototype.destroy=function(){this.menuContainer.innerHTML="",a(this,e,{})},i}();e=new WeakMap,exports.default=o;
},{"@bilibili-live/web-player-common":"KGHo","./index.less":"ntSr"}],"x9fc":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.EMenuType=void 0,function(e){e.DANMU="danmu",e.LINE="line",e.LOGGER="logger",e.VIDEO_INFO="videoInfo",e.VERSION="version",e.COPYRIGHT="copyright",e.CLOSE="close"}(e=exports.EMenuType||(exports.EMenuType={}));
},{}],"YNoa":[function(require,module,exports) {
"use strict";var e,t,n,i,o,l,a,r,u=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},s=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.IDanmuInfo=void 0;var h,d=p(require("./contextmenu")),f=require("./type");Object.defineProperty(exports,"IDanmuInfo",{enumerable:!0,get:function(){return f.IDanmuInfo}}),function(e){e.DANMU="danmu",e.LINE="line",e.LOGGER="logger",e.VIDEO_INFO="videoInfo",e.VERSION="version",e.COPYRIGHT="copyright",e.CLOSE="close"}(h||(h={}));var m=function(p){function d(u,s){var h=p.call(this)||this;return e.set(h,void 0),t.set(h,void 0),n.set(h,[]),i.set(h,[]),o.set(h,null),l.set(h,!1),a.set(h,function(e){e.preventDefault(),p.prototype.removeMenuItems.call(h),h.danmuPreCheck(),h.showContextmenu(h.computePosition(e))}),r.set(h,function(e){h.menuContainer.contains(e.target)||(h.removeMenuItems(),p.prototype.hide.call(h))}),c(h,t,u),c(h,e,s),h.init(),h}return u(d,p),d.prototype.setLines=function(e,t,n){var l;if(null===(l=s(this,o))||void 0===l||l.call(this),0!==e.length){var a={label:"观看卡顿？切换备线试试",submenu:e.map(function(e){return{value:e.value,label:e.label,disable:e.value===t,click:n.bind(null,e.value)}})};c(this,i,e),c(this,o,this.prependMenuItem(h.LINE,a))}},d.prototype.changeLine=function(e){var t=s(this,i).findIndex(function(t){return t.value===e});null!=t&&this.submenuActive(h.LINE,t)},d.prototype.updateDanmuInfo=function(e){c(this,n,e)},d.prototype.setAdmin=function(){c(this,l,!0)},d.prototype.destroy=function(){p.prototype.destroy.call(this),this.removeListener(),s(this,t).removeChild(this.menuContainer)},d.prototype.init=function(){var e=this.getInitialConfig();p.prototype.initContextmenu.call(this,e),s(this,t).appendChild(this.menuContainer),this.addListener()},d.prototype.getInitialConfig=function(){var t=s(this,e);return[{name:h.LOGGER,label:"播放器日志信息",submenu:[{value:1,icon:"blp-icon-show",label:"显示日志",click:t.click.handleLogger.bind(null,"show")},{value:2,icon:"blp-icon-copy",label:"复制日志",click:t.click.handleLogger.bind(null,"copy")},{value:3,icon:"blp-icon-download",label:"下载日志",click:t.click.handleLogger.bind(null,"download")}]},{name:h.VIDEO_INFO,label:"视频统计信息",click:t.click.handleVideoInfo},{name:h.VERSION,label:"Bilibili HTML5 Live Player "+t.version},{name:h.COPYRIGHT,label:"Copyright bilibili "+(new Date).getFullYear()},{name:h.CLOSE,label:"关闭",click:function(){}}]},d.prototype.showContextmenu=function(e){p.prototype.show.call(this,{top:e.top,left:e.left},e.mainAxiosRight<160)},d.prototype.danmuPreCheck=function(){var e=this,t=s(this,n);t.length>0&&t.forEach(function(t,n){e.prependDanmu(t,0===n)}),c(this,n,[])},d.prototype.getDanmuConfig=function(t,n){var i=this,o=t.text.trim(),a=t.uid,r=a===s(this,e).uid,u={hr:n,autoRemove:!0,label:o,submenu:[{value:1,label:"举报选中弹幕",disable:r,click:s(this,e).click.handleDanmu.bind(this,"report",t)},{value:2,label:"屏蔽此用户的弹幕",disable:r,click:s(this,e).click.handleDanmu.bind(this,"shield",t)},{value:4,label:"复制弹幕",click:function(){var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(o).catch(function(){})}},{value:5,label:"去TA的个人空间",click:function(){var t="//space.bilibili.com/"+a;window.open(t),s(i,e).click.handleEvent(t)}}]};return s(this,l)&&u.submenu.splice(2,0,{value:3,label:"添加进黑名单",disable:r,click:s(this,e).click.handleDanmu.bind(this,"addBlackList",t)}),u},d.prototype.prependDanmu=function(e,t){var n=this.getDanmuConfig(e,t);p.prototype.prependMenuItem.call(this,h.DANMU,n)},d.prototype.computePosition=function(e){var n,i=Number(null!==(n=getComputedStyle(document.documentElement).zoom)&&void 0!==n?n:1),o=s(this,t).getBoundingClientRect(),l=this.menuContainer.getBoundingClientRect(),a=e.clientX,r=e.clientY,u=Math.min(a/i-o.left,o.width-l.width);return{left:u,top:Math.min(r/i-o.top,o.height-l.height),mainAxiosRight:o.width-u-l.width}},d.prototype.addListener=function(){s(this,t).addEventListener("contextmenu",s(this,a)),window.addEventListener("click",s(this,r))},d.prototype.removeListener=function(){s(this,t).removeEventListener("contextmenu",s(this,a)),window.removeEventListener("click",s(this,r))},d}(d.default);e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,o=new WeakMap,l=new WeakMap,a=new WeakMap,r=new WeakMap,exports.default=m;
},{"./contextmenu":"wERC","./type":"x9fc"}],"RYhb":[function(require,module,exports) {
"use strict";var t,i,e,s,h,n,r,a=this&&this.__classPrivateFieldSet||function(t,i,e){if(!i.has(t))throw new TypeError("attempted to set private field on non-instance");return i.set(t,e),e},o=this&&this.__classPrivateFieldGet||function(t,i){if(!i.has(t))throw new TypeError("attempted to get private field on non-instance");return i.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var p=require("@bilibili-live/web-player-common"),l=function(){function l(o){t.set(this,0),i.set(this,0),e.set(this,[]),s.set(this,[]),h.set(this,0),n.set(this,0),r.set(this,0),a(this,t,o.width),a(this,i,o.height),this.initGraph()}return l.prototype.updateGraph=function(t){o(this,e).shift(),o(this,e).push(t),a(this,s,[]),a(this,n,o(this,e).length>0?Math.max.apply(this,o(this,e)):1);try{a(this,r,o(this,i)/(o(this,n)-o(this,h)))}catch(c){p.logger.error(c)}for(var l=0,u=o(this,e).length;l<u;l++){var f=o(this,e)[l];o(this,s).push([2*l,o(this,i)-(f-o(this,h))*o(this,r)])}},l.prototype.getGraph=function(){for(var e="",h=o(this,s),n=0,r=h.length;n<r;n++)e+=h[n].join(",")+" ";return e.includes("NaN")&&(e="0"),'<svg width="'+o(this,t)+'" height="'+o(this,i)+'" viewBox="0 0 '+o(this,t)+" "+o(this,i)+'">\n                <g>\n                  <polyline stroke="white" fill="none" points="'+e+'">\n                  </polyline>\n                </g>\n              </svg>'},l.prototype.destroy=function(){a(this,e,[]),a(this,s,[]),a(this,h,0),a(this,n,0),a(this,r,0),this.initGraph()},l.prototype.initGraph=function(){for(var h=0,n=o(this,t)/2;h<n;h++)o(this,e).push(0),o(this,s).push([2*h,o(this,i)])},l}();t=new WeakMap,i=new WeakMap,e=new WeakMap,s=new WeakMap,h=new WeakMap,n=new WeakMap,r=new WeakMap,exports.default=l;
},{"@bilibili-live/web-player-common":"KGHo"}],"E7iI":[function(require,module,exports) {
"use strict";var t,e,n,i,s=this&&this.__assign||function(){return(s=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var s in e=arguments[n])Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s]);return t}).apply(this,arguments)},o=this&&this.__classPrivateFieldSet||function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,n),n},r=this&&this.__classPrivateFieldGet||function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};Object.defineProperty(exports,"__esModule",{value:!0});var a=require("@bilibili-live/web-player-common"),l="web-player-show-videoinfo",p=function(){function p(p,h){t.set(this,void 0),e.set(this,0),n.set(this,{style:{},scope:null}),i.set(this,a.createElement("div",{classname:"web-player-video-info-panel",attributes:[["style","display: none;\n        position: absolute;\n        padding: 15px 36px 15px 15px;\n        text-align: left;\n        color: #fff;\n        background-color: rgba(28, 28, 28, 0.8);\n        border-radius: 4px;\n        font-size: 12px;\n        z-index: 102;\n        cursor: text;\n        user-select: text;\n      "]]})),o(this,t,p),o(this,n,s(s({},r(this,n)),h)),this.initPanel(),p.appendChild(r(this,i)),"1"===localStorage.getItem(l)&&(this.status=1)}return Object.defineProperty(p.prototype,"status",{get:function(){return r(this,e)},set:function(t){o(this,e,t),r(this,i).style.display=1===t?"block":"none",localStorage.setItem(l,""+t)},enumerable:!1,configurable:!0}),p.prototype.destroy=function(){r(this,t).removeChild(r(this,i))},p.prototype.initPanel=function(){var t=this,e=r(this,n).style;Object.keys(e).forEach(function(n){r(t,i).style[n]=e[n]});var s=this.createCloseBtn();r(this,i).appendChild(s),null!=r(this,n).scope&&r(this,i).appendChild(r(this,n).scope)},p.prototype.createCloseBtn=function(){var t=this,e=a.createElement("div",{text:"[x]",attributes:[["style","position: absolute;\n        top: 10px;\n        right: 10px;\n        width: 14px;\n        height: 14px;\n        line-height: 14px;\n        text-align: center;\n        cursor: pointer;"]]});return e.addEventListener("click",function(e){e.stopPropagation(),t.status=0}),e},p}();t=new WeakMap,e=new WeakMap,n=new WeakMap,i=new WeakMap,exports.default=p;
},{"@bilibili-live/web-player-common":"KGHo"}],"SR9Z":[function(require,module,exports) {
"use strict";var e,t,i,a,r,n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++)for(var r in t=arguments[i])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},o=this&&this.__classPrivateFieldSet||function(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i},s=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var p=require("@bilibili-live/web-player-common"),l=d(require("./wave-graph")),h=d(require("./panel")),u="p-video-info-",c=function(){function d(d){var u=this;e.set(this,void 0),t.set(this,void 0),i.set(this,void 0),a.set(this,0),r.set(this,void 0),this.videoTemplate={mimeType:{label:"Mime Type",data:""},playerCore:{label:"Player Core",data:""},videoInfo:{label:"Video Info",data:""},audioInfo:{label:"Audio Info",data:""},encoder:{label:"Encoder",data:""},streamHost:{label:"Stream Host",data:""},bufferLength:{label:"Buffer Length",data:""},droppedFrames:{label:"Decoded Frames",data:""},networkActivity:{label:"Download Bitrate",data:""}},this.template=Object.keys(this.videoTemplate).map(function(e){var t;return(t={})[e]=u.videoTemplate[e].data,t}).reduce(function(e,t){return n(n({},e),t)}),this.templateProxy=this.createTemplateProxy(),o(this,e,d),o(this,i,p.createElement("div")),o(this,r,new l.default({width:180,height:14})),s(this,i).appendChild(this.combineDataElement()),o(this,t,new h.default(s(this,e),{scope:s(this,i),style:{top:"10px",left:"10px"}}))}return d.prototype.show=function(){s(this,t).status=1,this.repaintGraph()},d.prototype.hide=function(){s(this,t).status=0},d.prototype.destroy=function(){for(var e in o(this,i,null),this.templateProxy)this.templateProxy[e]="";s(this,t).destroy(),s(this,r).destroy()},d.prototype.updateVideoTemplate=function(e){if(0!==s(this,t).status){var i=e.mediaInfo,n=e.realtimeInfo,d=Math.floor(n.videoNetworkActivity/1024),l=this.templateProxy;l.mimeType=i.mimeType,l.playerCore=i.corePlayerType,l.videoInfo=i.width+"x"+i.height+", "+i.fps+"FPS",l.audioInfo=i.audioSampleRate/1e3+"KHz, "+i.audioChannel+", "+this.computeBps(i.audioDataRate),l.encoder=i.encoder,l.streamHost=i.videoSrc.split("://")[1].split("/")[0],l.networkActivity=p.roundNumber(d/1024*8,2)+"Mbps",l.bufferLength=n.videoBufferLength+"s",l.droppedFrames=n.droppedFrames+"/"+n.decodedFrames+", "+(n.decodedFrames-s(this,a)<0?0:n.decodedFrames-s(this,a))+"FPS",o(this,a,n.decodedFrames),n.decodedFrames>0&&s(this,r).updateGraph(d),this.repaintGraph()}},d.prototype.createTemplateProxy=function(){return new Proxy(this.template,{get:function(e,t,i){if(t in e)return e[t];throw new ReferenceError('Prop name "'+t+'" does not exist.')},set:function(e,t,i,a){var r;if(e[t]!==i){e[t]=i;var n=null===(r=document.getElementById(""+u+t))||void 0===r?void 0:r.querySelector(".web-player-line-data");null!=n&&(n.textContent=i)}return!0}})},d.prototype.repaintGraph=function(){if(0!==s(this,t).status){var e=s(this,r).getGraph(),i=document.querySelector(".web-player-info-graph");null!=i&&(i.innerHTML=e)}},d.prototype.combineDataElement=function(){var e=this,t=document.createDocumentFragment();return Object.keys(this.videoTemplate).forEach(function(i){var a=document.createElement("div");a.id=""+u+i,a.style.cssText+="\n          min-width: 290px;\n          line-height: 18px;\n          font-size: 12px;\n        ",a.innerHTML='\n          <div style="display: inline-block;\n          white-space: nowrap;\n          width: 100px;\n          text-align: right;\n          font-weight: 500;\n          margin-right: 10px;">'+e.videoTemplate[i].label+":</div>\n          "+("networkActivity"===i?'<div style="display: inline-block; margin-right: 10px;" class="web-player-info-graph">'+s(e,r).getGraph()+"</div>":"")+'\n          <div style="display: inline-block; min-width: 58px" class="web-player-line-data">'+e.videoTemplate[i].data+"</div>\n        ",t.appendChild(a)}),t},d.prototype.computeBps=function(e){return e<1e3?p.roundNumber(e,0)+"Kbps":p.roundNumber(e/1e3,1)+"Mbps"},d}();e=new WeakMap,t=new WeakMap,i=new WeakMap,a=new WeakMap,r=new WeakMap,exports.default=c;
},{"@bilibili-live/web-player-common":"KGHo","./wave-graph":"RYhb","./panel":"E7iI"}],"qhQO":[function(require,module,exports) {
var o='.blp-plugin-modal{position:absolute;top:100px;left:0;padding:15px;z-index:99;display:none;background:#fff;border-radius:4px}.blp-plugin-modal.active{display:block}.blp-plugin-modal-header{font-size:16px;color:#4fc1e9;height:26px;line-height:20px}.blp-plugin-modal-body{margin:10px 0;font-size:14px}.blp-plugin-modal-footer{text-align:center;position:relative}.blp-plugin-modal-btn{border:none;display:inline-block;margin:0 2px;font-size:14px;padding:6px 10px;cursor:pointer;outline:none;border-radius:4px}.blp-plugin-modal-btn.submit-btn{color:#fff;background:#4fc1e9}.blp-plugin-modal-btn.submit-btn:hover{background:#61c7eb}.blp-plugin-modal-btn.cancel-btn{color:#4fc1e9;background:#e0f4fb}.blp-plugin-modal-btn.cancel-btn:hover{background:#ceeef9}.blp-plugin-modal-close{position:absolute;width:30px;height:30px;top:9px;right:9px;cursor:pointer;border-radius:100%;transition:transform .3s ease-in-out;display:none}.blp-plugin-modal-close:hover{transform:rotate(180deg)}.blp-plugin-modal-close:before{content:"";position:absolute;width:22px;height:22px;left:4px;top:4px;border-radius:100%}.blp-plugin-modal-close i{font-size:14px;color:#999;position:absolute;z-index:10;text-align:center;top:9px;left:9px}.blp-plugin-modal-close.active{display:block}',e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(o)),document.head.appendChild(e);
},{}],"ywxt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@bilibili-live/web-player-common");require("./modal.less");var e=function(){function e(t,i){this.container=t,this._snippet=['<div class="blp-plugin-modal-header"></div>','<div class="blp-plugin-modal-body"></div>','<div class="blp-plugin-modal-footer clearfix"></div>','<div class="blp-plugin-modal-close"><i class="live-icon-close"></i></div>'],this._opts=Object.assign({},e._DEFAULT_OPTIONS,i),this._initialize()}return e.prototype.show=function(){var t=this._opts,e=this._template;this._freshPos(),e._container.classList.add("active"),"function"==typeof t.onShow&&t.onShow()},e.prototype.hide=function(){var t=this._opts;this._template._container.classList.remove("active"),"function"==typeof t.onHide&&t.onHide(),t.autoRemove&&this.destroy()},e.prototype.destroy=function(){this._template._container.remove()},e.prototype._initialize=function(){this._create()._bindEvents(),this._opts.autoShow&&this.show()},e.prototype._create=function(){var e=t.createElement("div",{classname:"blp-plugin-modal"});e.innerHTML=this._snippet.join(""),this._template={_container:e,_header:e.querySelector(".blp-plugin-modal-header"),_body:e.querySelector(".blp-plugin-modal-body"),_footer:e.querySelector(".blp-plugin-modal-footer"),_close:e.querySelector(".blp-plugin-modal-close")};var i=this._template,n=this._opts;return i._header.innerText=n.title,i._body.innerHTML=""!==n.html?n.html:n.text,this._createBtn(i._footer,n.btns,n),n.hideBtn&&i._close.classList.add("active"),this.container.appendChild(e),null!=n.width&&0!==n.width&&(e.style.width=n.width+"px"),this},e.prototype._createBtn=function(e,i,n){var o=this;if(i instanceof Array)i.forEach(function(t){o._createBtn(e,t,n)});else{var l=null;switch(i.type){case"submit":(l=t.createElement("button",{classname:"blp-plugin-modal-btn submit-btn"})).innerHTML=i.text,"function"==typeof i.click&&l.addEventListener("click",function(t){i.click(t),o.hide()});break;case"cancel":(l=t.createElement("button",{classname:"blp-plugin-modal-btn cancel-btn"})).innerHTML=i.text,"flex-report"===n.btnPostion&&l.classList.add("live-bilibili-player-report-cancel"),l.addEventListener("click",function(){var t;null===(t=i.click)||void 0===t||t.call(i),o.hide()})}null!=l&&e.append(l)}},e.prototype._bindEvents=function(){var t=this;return this._opts.hideBtn&&this._template._close.addEventListener("click",function(){t.hide()}),this},e.prototype._freshPos=function(){var t=this._opts,e=this._template._container,i=this._template._footer,n="",o="",l=0,s=0,a=e.style;switch(t.btnPostion){case"flex-report":i.style.cssText="\n          display: flex;\n          justify-content: space-around;\n          margin-top: 69px;\n        ",a.height="190px",a.padding="20px"}switch(t.position){case"center-center":n="50%",o="50%",l=-1*parseInt(a.width)/2,s=-1*parseInt(a.height)/2}a.left=n,a.top=o,a.marginLeft=l+"px",a.marginTop=s+"px"},e._DEFAULT_OPTIONS={title:"Bilibili HTML5 Live Player Modal",theme:"white",text:"Are you confirm the operation?",html:"",btns:[{type:"submit",text:"Confirm",click:function(){}},{type:"cancel",text:"Cancel",click:function(){}}],mask:!0,position:"center-center",hideBtn:!0,autoShow:!1,autoRemove:!1},e}();exports.default=e;
},{"@bilibili-live/web-player-common":"KGHo","./modal.less":"qhQO"}],"lmPI":[function(require,module,exports) {
var e='.web-player-report-msg{color:#4fc1e9;font-size:12px;line-height:2}.web-player-report-msg img{height:25px}.web-player-report-uname{font-size:12px;color:#666;line-height:2}.web-player-report-select-input{height:32px;position:relative;border:1px solid #e3e8ec;font-size:12px;background:#fff;cursor:pointer;border-radius:4px;margin:10px 0 25px}.web-player-report-select-wrap{position:absolute;height:34px;width:360px}.web-player-report-select-wrap:hover .bilibili-live-player-report-icon:after{transform-origin:center;transform:rotate(-135deg);transition:transform .3s}.web-player-report-icon{display:inline-block;width:40px;height:30px;margin-right:20px}.web-player-report-icon:after{display:inline-block;content:" ";height:6px;width:6px;border-color:#999;border-style:solid;border-width:0 2px 2px 0;transform:matrix(.71,.71,-.71,.71,0,0);transform-origin:center;transition:transform .3s;position:absolute;top:50%;right:10px;margin-top:-4px}.web-player-report-curt{padding-left:8px;height:32px;line-height:32px;color:#646c7a}.web-player-report-ul{display:none;position:relative;top:-27px;width:358px;height:160px;padding:0;margin:0;font-size:inherit;border:1px solid #ddd;border-top:0;background:#fff;overflow-y:auto;-webkit-box-shadow:0 1px 2px 0 rgba(105,115,133,.22);box-shadow:0 1px 2px 0 rgba(105,115,133,.22);border-radius:0 0 4px 4px;z-index:1;cursor:pointer}.web-player-report-ul li{padding:10px 0 10px 8px;color:#999;font-size:12px;height:24px;line-height:24px}.web-player-report-ul li:hover{background:#eef9fd}',r=document.createElement("style");r.type="text/css",r.appendChild(document.createTextNode(e)),document.head.appendChild(r);
},{}],"wafJ":[function(require,module,exports) {
"use strict";var e,t,r=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(i,o){function s(e){try{a(n.next(e))}catch(t){o(t)}}function l(e){try{a(n.throw(e))}catch(t){o(t)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,l)}a((n=n.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var r,n,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,n=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(l){o=[6,l],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},i=this&&this.__classPrivateFieldSet||function(e,t,r){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,r),r},o=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},s=this&&this.__spreadArray||function(e,t){for(var r=0,n=t.length,i=e.length;r<n;r++,i++)e[i]=t[r];return e},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var a=l(require("./modal")),u=require("@bilibili-live/web-player-common");require("./index.less");var c={reportReason:"/xlive/web-ucenter/v1/dMReport/ForReason",reportDanmaku:"/xlive/web-ucenter/v1/dMReport/Report"},d=function(){function l(r){e.set(this,null),t.set(this,void 0),i(this,t,r)}return l._createModalHtml=function(e,t){var r=t.reduce(function(e,t){return e+"<li>"+t.reason+"</li>"},'<li class="web-player-report-item-default" style="display: none">请选择举报理由喔~</li>');return'\n      <div class="web-player-report-wrap">\n        <div class="web-player-report-uname">'+e.uname+'</div>\n        <div class="web-player-report-msg">'+e.msg+'</div>\n        <div class="web-player-report-select-wrap">\n          <div class="web-player-report-select-input">\n            <div class="web-player-report-curt">请选择举报理由喔~</div>\n            <div class="web-player-report-icon"></div>\n          </div>\n          <ul class="web-player-report-ul">'+r+"</ul>\n        </div>\n      </div>\n    "},l.prototype.show=function(e){return r(this,void 0,Promise,function(){var t,r;return n(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,u.ajax(c.reportReason)];case 1:return r=n.sent(),t=null!=r?r.data:[{id:1,reason:"违法违规"},{id:2,reason:"低俗色情"},{id:3,reason:"垃圾广告"},{id:4,reason:"辱骂引战"},{id:5,reason:"政治敏感"},{id:6,reason:"青少年不良信息"},{id:7,reason:"其他"}],[3,3];case 2:return n.sent(),t=[{id:1,reason:"违法违规"},{id:2,reason:"低俗色情"},{id:3,reason:"垃圾广告"},{id:4,reason:"辱骂引战"},{id:5,reason:"政治敏感"},{id:6,reason:"青少年不良信息"},{id:7,reason:"其他"}],[3,3];case 3:return this.handleReport(e,t),[2]}})})},l.prototype.resetReasonVisible=function(e){s([],e.children).forEach(function(e){e instanceof HTMLElement&&(e.style.display="block")})},l.prototype.checkReportState=function(){var e=document.querySelector(".live-bilibili-player-report-cancel");null==e||e.click()},l.prototype.handleReport=function(s,u){var c=this;this.checkReportState();var d=l._createModalHtml(s,u);null==o(this,e)&&i(this,e,new a.default(o(this,t),{title:"举报弹幕",html:d,btns:[{type:"submit",text:"警察叔叔就是他",click:function(){return r(c,void 0,void 0,function(){return n(this,function(e){switch(e.label){case 0:return[4,this._submitFunction(s,u)];case 1:return e.sent(),x(),[2]}})})}},{type:"cancel",text:"饶他一命",click:function(){x()}}],width:360,btnPostion:"flex-report"}));var p=document.querySelector(".web-player-report-uname"),f=document.querySelector(".web-player-report-msg");p.innerText=s.uname,s.img_url?f.innerHTML="<img src="+s.img_url+">":f.innerText=s.msg,o(this,e).show();var h=document.querySelector(".web-player-report-ul"),y=document.querySelector(".web-player-report-curt"),v=document.querySelector(".web-player-report-select-wrap"),b=document.querySelector(".blp-plugin-modal-btn"),m=document.querySelector(".web-player-report-item-default"),w=function(e){c.resetReasonVisible(h);var t=e.target.innerText;b.disabled="请选择举报理由喔~"===t&&"获取不到举报理由，请尝试刷新后举报喔~"===t,y.innerText=t,h.style.display="none",m.style.display="block",e.target.style.display="none"}.bind(this),_=function(){h.style.display="none"}.bind(this),g=function(){h.style.display="block"}.bind(this),x=function(){var t;y.innerText="请选择举报理由喔~",m.style.display="none",c.resetReasonVisible(h),h.removeEventListener("click",w),null==v||v.removeEventListener("mouseover",g),null==v||v.removeEventListener("mouseout",_),null===(t=o(c,e))||void 0===t||t.destroy(),i(c,e,null)};b.disabled=!0,h.addEventListener("click",w),null==v||v.addEventListener("mouseover",g),null==v||v.addEventListener("mouseout",_)},l.prototype._submitFunction=function(i,s){var l;return r(this,void 0,Promise,function(){var r,a,d,p,f,h;return n(this,function(n){switch(n.label){case 0:if(r=o(this,t).querySelector(".web-player-report-curt"),a=r.innerText,d=i.checkInfo,p=0,null!=(f=s.filter(function(e){return e.reason===a}))&&0!==f.length&&(p=f[0].id),""===a)return[2];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,u.ajax(c.reportDanmaku,{method:"POST",data:{reason:a,roomid:i.roomid,msg:i.msg,tuid:i.uid,ts:d.ts,sign:d.ct,reason_id:p,dm_type:i.type,file_id:i.file_id,img_url:i.img_url}})];case 2:return n.sent(),null===(l=o(this,e))||void 0===l||l.hide(),[3,4];case 3:return h=n.sent(),u.logger.error(h),[3,4];case 4:return[2]}})})},l}();e=new WeakMap,t=new WeakMap,exports.default=d;
},{"./modal":"ywxt","@bilibili-live/web-player-common":"KGHo","./index.less":"lmPI"}],"jLTy":[function(require,module,exports) {
module.exports={webPlayerLogPanel:"_web-player-log-panel_43651",log0:"_log-0_43651",log2:"_log-2_43651",log3:"_log-3_43651",closeBtn:"_close-btn_43651"};var e="._web-player-log-panel_43651{display:none;position:absolute;top:10px;right:10px;padding:0 5px 0 10px;text-align:left;color:#fff;background-color:rgba(28,28,28,.8);border-radius:4px;font-size:12px;z-index:101;cursor:text;user-select:text}._web-player-log-panel_43651 pre::-webkit-scrollbar{background-color:transparent;width:4px}._web-player-log-panel_43651 pre::-webkit-scrollbar-thumb{background-color:hsla(0,0%,100%,.5);border-radius:8px}._web-player-log-panel_43651 pre{overflow-y:scroll;word-break:break-all;white-space:break-spaces;width:240px;height:310px}._web-player-log-panel_43651 pre ._log-0_43651{color:#999}._web-player-log-panel_43651 pre ._log-2_43651{color:#f90}._web-player-log-panel_43651 pre ._log-3_43651{color:#f3323e}._web-player-log-panel_43651 pre code{font-family:PingFang SC,Microsoft YaHei}._web-player-log-panel_43651 ._close-btn_43651{position:absolute;top:8px;right:8px;width:14px;height:14px;line-height:14px;text-align:center;cursor:pointer}",l=document.createElement("style");l.type="text/css",l.appendChild(document.createTextNode(e)),document.head.appendChild(l);
},{}],"MY3w":[function(require,module,exports) {
"use strict";var e,t,n,i,o=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},a=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});var s=require("@bilibili-live/web-player-common"),l=r(require("./log-panel.less")),c="web-player-show-log",h=function(){function r(a){e.set(this,s.createElement("div",{classname:l.default.webPlayerLogPanel})),t.set(this,s.createElement("pre")),n.set(this,!1),i.set(this,null),this.initPanel(),a.appendChild(o(this,e)),"1"===localStorage.getItem(c)&&this.show()}return r.prototype.show=function(){o(this,e).style.display="block",o(this,n)||a(this,i,this.syncLogger()),localStorage.setItem(c,"1")},r.prototype.destroy=function(){var t;null===(t=o(this,i))||void 0===t||t.call(this),o(this,e).remove()},r.prototype.initPanel=function(){var t=this.createCloseBtn();o(this,e).appendChild(t)},r.prototype.createCloseBtn=function(){var t=this,n=s.createElement("div",{text:"[x]",classname:l.default.closeBtn});return n.addEventListener("click",function(n){n.stopPropagation(),o(t,e).style.display="none",localStorage.setItem(c,"0")}),n},r.prototype.syncLogger=function(){var i=this;a(this,n,!0);var r=document.createDocumentFragment();return s.logger.history().forEach(function(e){r.appendChild(c(e))}),o(this,t).appendChild(r),o(this,e).appendChild(o(this,t)),s.logger.watch(function(e){o(i,t).appendChild(c(e))});function c(e){var t=document.createElement("code");return t.classList.add(l.default["log"+e.level]),t.textContent=s.logger.stringify(e,{tag:!1,time:!1})+"\n",t}},r}();e=new WeakMap,t=new WeakMap,n=new WeakMap,i=new WeakMap,exports.default=h;
},{"@bilibili-live/web-player-common":"KGHo","./log-panel.less":"jLTy"}],"PTXm":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,n,t,r){return new(t||(t=Promise))(function(l,u){function o(e){try{i(r.next(e))}catch(n){u(n)}}function c(e){try{i(r.throw(e))}catch(n){u(n)}}function i(e){var n;e.done?l(e.value):(n=e.value,n instanceof t?n:new t(function(e){e(n)})).then(o,c)}i((r=r.apply(e,n||[])).next())})},n=this&&this.__generator||function(e,n){var t,r,l,u,o={label:0,sent:function(){if(1&l[0])throw l[1];return l[1]},trys:[],ops:[]};return u={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function c(u){return function(c){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;o;)try{if(t=1,r&&(l=2&u[0]?r.return:u[0]?r.throw||((l=r.return)&&l.call(r),0):r.next)&&!(l=l.call(r,u[1])).done)return l;switch(r=0,l&&(u=[2&u[0],l.value]),u[0]){case 0:case 1:l=u;break;case 4:return o.label++,{value:u[1],done:!1};case 5:o.label++,r=u[1],u=[0];continue;case 7:u=o.ops.pop(),o.trys.pop();continue;default:if(!(l=(l=o.trys).length>0&&l[l.length-1])&&(6===u[0]||2===u[0])){o=0;continue}if(3===u[0]&&(!l||u[1]>l[0]&&u[1]<l[3])){o.label=u[1];break}if(6===u[0]&&o.label<l[1]){o.label=l[1],l=u;break}if(l&&o.label<l[2]){o.label=l[2],o.ops.push(u);break}l[2]&&o.ops.pop(),o.trys.pop();continue}u=n.call(e,o)}catch(c){u=[6,c],r=0}finally{t=l=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,c])}}};function t(t){return e(this,void 0,Promise,function(){var e;return n(this,function(n){switch(n.label){case 0:return!0!==(null==(e=o())?void 0:e.contains(t))?[3,2]:[4,u()];case 1:return n.sent(),[3,4];case 2:return[4,l(t)];case 3:n.sent(),n.label=4;case 4:return[2]}})})}function r(e){for(var n=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],t=0,r=n;t<r.length;t++){var l=r[t];document.addEventListener(l,e)}return function(){for(var t=0,r=n;t<r.length;t++){var l=r[t];document.removeEventListener(l,e)}}}function l(t){return e(this,void 0,Promise,function(){var e,r,l;return n(this,function(n){for(e=0,r=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"];e<r.length;e++)if("function"==typeof t[l=r[e]])return[2,t[l]()];throw new Error("browser unsupported fullscreen")})})}function u(){return e(this,void 0,Promise,function(){var e,t,r;return n(this,function(n){if(null==o())return[2];for(e=0,t=["exitFullscreen","webkitExitFullscreen","webkitCancelFullScreen","mozCancelFullScreen","msExitFullscreen"];e<t.length;e++)if("function"==typeof(r=document[t[e]]))return[2,r.call(document)];return[2]})})}function o(){for(var e=0,n=["fullscreenElement","webkitFullscreenElement","webkitCurrentFullScreenElement","mozFullScreenElement","msFullscreenElement"];e<n.length;e++){var t=document[n[e]];if(null!=t)return t}return null}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default={onChange:r,toggleFullScreen:t,getFullscreenElement:o,exitFullscreen:u};
},{}],"n8Xe":[function(require,module,exports) {
"use strict";var e,t,r,n,o,i,s,u,a,c,d=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function s(e){try{a(n.next(e))}catch(t){i(t)}}function u(e){try{a(n.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,u)}a((n=n.apply(e,t||[])).next())})},h=this&&this.__classPrivateFieldSet||function(e,t,r,n,o){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?o.call(e,r):o?o.value=r:t.set(e,r),r},f=this&&this.__classPrivateFieldGet||function(e,t,r,n){if("a"===r&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(exports,"__esModule",{value:!0}),exports.DBCore=void 0;const l=null!==(r=null!==(t=null!==(e=window.indexedDB)&&void 0!==e?e:window.mozIndexedDB)&&void 0!==t?t:window.webkitIndexedDB)&&void 0!==r?r:window.msIndexedDB;function v(e){return console.error(e),!1}function p(e){return"[object Object]"===Object.prototype.toString.call(e)}function w(e,t){for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){if(t[r]!==e[r])return!1}return!0}function g(e){const t=null!=e?e:"++id",[r,...n]=t.split(",").map(e=>e.trim()),o=r.includes("++");return{keyPath:r.replace("++",""),autoIncrement:o,indexKeys:n}}function m(e){return new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",i)},o=()=>{t(e.result),n()},i=()=>{r(e.error),v(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",i)})}function y(){return d(this,void 0,void 0,function*(){const e=l.databases;if(!(!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent))||void 0===e)return;let t;return yield new Promise(r=>{const n=()=>{e().then(r).catch(r)};t=window.setInterval(n,100),n()}).finally(()=>clearInterval(t))})}function P(e,t,r={}){return new Promise((n,o)=>{y().then(()=>{const i=l.open(e,t);i.onupgradeneeded=(e=>{const t=i.result;"function"==typeof r.upgrade&&r.upgrade(t)}),i.onsuccess=(e=>{const t=i.result;n(t)}),i.onerror=(e=>{v(i.error),o(i.error)}),i.onblocked=(e=>{var t,s;if(e instanceof IDBVersionChangeEvent){const o=e,u=e=>{const t=i.result;"function"==typeof r.upgrade&&r.upgrade(t),c()},a=()=>{const e=i.result;n(e),c()},c=()=>{var e,t;null===(e=o.target)||void 0===e||e.removeEventListener("upgradeneeded",u),null===(t=o.target)||void 0===t||t.removeEventListener("success",a)};return null===(t=o.target)||void 0===t||t.addEventListener("upgradeneeded",u),void(null===(s=o.target)||void 0===s||s.addEventListener("success",a))}o(i.error)})}).catch(o)})}function b(e){return m(l.deleteDatabase(e))}function S(e,t){const r={};if(!p(t))return r;for(const n in t)if(!e.objectStoreNames.contains(n)){const{keyPath:o,autoIncrement:i,indexKeys:s}=g(t[n]),u=e.createObjectStore(n,{keyPath:o,autoIncrement:i});s.forEach(e=>{u.createIndex(e,e,{unique:!1})}),r[n]=u}return r}class E{constructor(e){n.set(this,void 0),o.set(this,{}),i.set(this,{}),s.set(this,void 0),u.set(this,void 0),a.set(this,{status:"close"}),h(this,s,e,"f")}getDatabase(){return d(this,void 0,void 0,function*(){return void 0!==f(this,n,"f")?f(this,n,"f"):yield P(f(this,s,"f"))})}version(e){if(isNaN(e)||e<.1)throw Error("Given version is not a positive number");return h(this,u,e,"f"),this}getVersion(){return d(this,void 0,void 0,function*(){if("number"==typeof f(this,u,"f"))return f(this,u,"f");return(yield this.getDatabase()).version})}stores(e){return d(this,void 0,void 0,function*(){if(void 0===f(this,u,"f"))throw Error("Please use version() brefore stores()");const t=`${f(this,s,"f")}-${f(this,u,"f")}`;void 0===f(this,o,"f")[t]&&(f(this,o,"f")[t]=e),void 0!==f(this,n,"f")&&(f(this,a,"f").status="closeing",f(this,n,"f").close());try{h(this,n,yield P(f(this,s,"f"),f(this,u,"f"),{upgrade:t=>{S(t,e),f(this,a,"f").status="opened"}}),"f"),f(this,a,"f").status="opened"}catch(r){throw Error(r)}return this})}getStoreOption(){var e;const t=`${f(this,s,"f")}-${null!==(e=f(this,u,"f"))&&void 0!==e?e:""}`;return f(this,o,"f")[`${t}`]}getStore(e){var t;if(void 0===f(this,o,"f")[`${f(this,s,"f")}-${null!==(t=f(this,u,"f"))&&void 0!==t?t:""}`])throw Error("Please use stores() brefore getStore()");if(void 0===f(this,n,"f"))throw Error("DB is not ready, Please await stores()");return void 0!==f(this,i,"f")[e]?f(this,i,"f")[e]:(f(this,i,"f")[e]=new j(f(this,n,"f"),e),f(this,i,"f")[e])}getStoreNames(){return d(this,void 0,void 0,function*(){const e=yield this.getDatabase();return Array.from(e.objectStoreNames)})}close(){var e;null===(e=f(this,n,"f"))||void 0===e||e.close()}}exports.default=E,n=new WeakMap,o=new WeakMap,i=new WeakMap,s=new WeakMap,u=new WeakMap,a=new WeakMap,E.delete=b;class j{constructor(e,t){c.set(this,10),this.db=e,this.storeName=t}transaction(e){return this.db.transaction(e,"readwrite")}getStore(){if(f(this,c,"f")<=0){v(Error("getStore error"))}else try{return this.transaction([this.storeName]).objectStore(this.storeName)}catch(e){return"function"==typeof e.toString&&e.toString().indexOf("closing")>-1?h(this,c,0,"f"):h(this,c,f(this,c,"f")-1,"f"),void v(e)}}clear(){return d(this,void 0,void 0,function*(){const e=this.getStore();return e?m(e.clear()):Promise.reject(e)})}add(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.add(e)):Promise.reject(t)})}put(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.put(e)):Promise.reject(t)})}delete(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.delete(e)):Promise.reject(t)})}count(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.count(e)):Promise.reject(t)})}get(e){return d(this,void 0,void 0,function*(){const t=this.getStore();return t?m(t.get(e)):Promise.reject(t)})}getAll(){return d(this,void 0,void 0,function*(){const e=this.getStore();return e?m(e.getAll()):Promise.reject(e)})}queryWithIndex(e,t){return d(this,void 0,void 0,function*(){const r=this.getStore();return r?new Promise((n,o)=>{const i=[],s=r.index(e).openCursor(t);s.onsuccess=(e=>{const t=s.result;null!==t?(i.push(t.value),t.continue()):n(i)}),s.onerror=(()=>{v(s.error),o(s.error)})}):Promise.reject(r)})}each(e,t){return d(this,void 0,void 0,function*(){const r=this.getStore();return r?new Promise((n,o)=>{let i=0;const s=r.openCursor(e);s.onsuccess=(e=>{const r=s.result;null!==r?(t(r.value,i++),r.continue()):n()}),s.onerror=(()=>{v(s.error),o(s.error)})}):Promise.reject(r)})}query(e){return d(this,void 0,void 0,function*(){const t=[];return this.each(null,r=>{w(r,e)&&t.push(r)}).then(()=>t)})}}exports.DBCore=j,c=new WeakMap;
},{}],"cQRo":[function(require,module,exports) {
"use strict";function t(t){var e,r;const{cookie:o}=document;return null==o?"":null!==(r=null===(e=o.split(";").filter(t=>t.trim().length>0).map(t=>t.split("=")).map(([t,e])=>[t.trim(),e.trim()]).find(([e])=>e===t))||void 0===e?void 0:e[1])&&void 0!==r?r:""}function e(t){return new Promise(e=>{setTimeout(e,t)})}function r(){return Number(t("DedeUserID"))}function o(){return n(8)}function n(t=12){const e=[];for(let r=0;r<t;r++)e.push(Math.floor(10*Math.random()));return Number(e.join(""))}function s(t){return void 0===t?2:t.replace(/[\u0391-\uFFF5]/g,"aa").length}function i(t){let e=null;return s(e="string"==typeof t?t:JSON.stringify(t))}function p(t){const e=new FormData;for(const r in t)if(Object.prototype.hasOwnProperty.call(t,r)){const o=t[r];e.append(r,o)}return e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Object2FormData=exports.getSizeInBytes=exports.getStringLength=exports.UUID=exports.shortUUID=exports.getUserId=exports.sleep=exports.getCookie=void 0,exports.getCookie=t,exports.sleep=e,exports.getUserId=r,exports.shortUUID=o,exports.UUID=n,exports.getStringLength=s,exports.getSizeInBytes=i,exports.Object2FormData=p;
},{}],"gT7a":[function(require,module,exports) {
"use strict";var t=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(a,r){function i(t){try{c(o.next(t))}catch(e){r(e)}}function s(t){try{c(o.throw(t))}catch(e){r(e)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(i,s)}c((o=o.apply(t,e||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.ajax=void 0;const e=require("./utils"),n="//api.live.bilibili.com",o=new Map;function a(a,r){return t(this,void 0,void 0,function*(){let t=a;/^(https?:)?\/\//.test(a)||(t=`${n}/${a.replace(/^\//,"")}`);const i=new URL(t,location.href),s=o.get(i.host+i.pathname);if(null!=s&&s.expiresTime>performance.now()){const t=Math.random()*s.scope;yield(0,e.sleep)(t)}const c=(0,e.getCookie)("bili_jct");if(""!==c&&"POST"===(null==r?void 0:r.method)&&null!=(null==r?void 0:r.data)){const t={csrf:c,csrf_token:c},e=Object.keys(t);r.data instanceof FormData?(e.forEach(e=>{var n;null===(n=r.data)||void 0===n||n.append(e,t[e])}),r.body=r.data):r.data&&(e.forEach(e=>{r.data[e]=t[e]}),r.body=JSON.stringify(r.data)),delete r.data}let l;try{l=yield fetch(t,Object.assign({credentials:"include"},null!=r?r:{}))}catch(p){const t=String(p);throw new Error(t)}if(!l.ok){const t=`url: ${a}, status: ${l.status}`;throw new Error(t)}const d=yield l.json(),{code:u,data:f,message:h}=d;if(0!==u)throw new Error(h);return f})}exports.ajax=a,a.disperse=((t,e)=>{const a=/^(https?:)?\/\//.test(t)?t:`${n}/${t.replace(/^\//,"")}`;o.set(a.replace(/^(https?:)?\/\//,""),e)});
},{"./utils":"cQRo"}],"NwTf":[function(require,module,exports) {
"use strict";var e=this&&this.__awaiter||function(e,t,o,a){return new(o||(o=Promise))(function(r,i){function n(e){try{u(a.next(e))}catch(t){i(t)}}function c(e){try{u(a.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?r(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(n,c)}u((a=a.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.reportLog=void 0;const t=require("./ajax"),o=require("./utils");function a(a,r=""){return e(this,void 0,void 0,function*(){const e=new Blob(["--"+JSON.stringify(a.data)]);"prod"===r&&(r=""),r&&(r=`ff-${r}-`);try{const{location:n}=yield(0,t.ajax)(`//${r?"uat-":""}api.bilibili.com/x/upload/web/image`,{method:"POST",data:(0,o.Object2FormData)({bucket:"live-log-ttl",dir:a.appName,file:e})});if(null==n||""===n)return!1;const c={appName:a.appName,userID:(0,o.getUserId)(),source:a.sourceType,url:n.replace(".txt","")};return null!=a.appId&&(c.appID=a.appId),null!=a.msgId&&(c.msgID=a.msgId),yield(0,t.ajax)(`//${r}api.live.bilibili.com/xlive/open-interface/v1/webLogAgent/setWebAppLogRecord`,{method:"POST",data:(0,o.Object2FormData)(c)}),!0}catch(i){return console.warn(i),!1}})}exports.reportLog=a;
},{"./ajax":"gT7a","./utils":"cQRo"}],"wAJK":[function(require,module,exports) {
"use strict";var e,t,i,s,a,o,n,r,d=this&&this.__awaiter||function(e,t,i,s){return new(i||(i=Promise))(function(a,o){function n(e){try{d(s.next(e))}catch(t){o(t)}}function r(e){try{d(s.throw(e))}catch(t){o(t)}}function d(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,r)}d((s=s.apply(e,t||[])).next())})},c=this&&this.__classPrivateFieldGet||function(e,t,i,s){if("a"===i&&!s)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?s:"a"===i?s.call(e):s?s.value:t.get(e)},h=this&&this.__classPrivateFieldSet||function(e,t,i,s,a){if("m"===s)throw new TypeError("Private method is not writable");if("a"===s&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,i):a?a.value=i:t.set(e,i),i},l=this&&this.__rest||function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(i[s[a]]=e[s[a]])}return i},p=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.multitask=exports.GoldMiner=void 0;const f=p(require("./idb")),u=require("./report"),m=require("./utils"),$=(0,m.getSizeInBytes)({$mainId:(0,m.shortUUID)(),$id:(0,m.UUID)(),$createTime:Date.now(),$expire:-1,$content:"",$type:"xxxx"}),g={expire:432e6,maxSpace:15,dbVersion:1},v={main:"$id",logList:"$id, $mainId"};class y{constructor(d){e.set(this,{}),t.set(this,{main:[],logList:[]}),i.set(this,void 0),s.set(this,"closed"),a.set(this,void 0),o.set(this,void 0),n.set(this,void 0),r.set(this,void 0),Object.assign(c(this,e,"f"),g,d),h(this,i,`GM-${c(this,e,"f").appName}`,"f"),this.idb=new f.default(c(this,i,"f")).version(c(this,e,"f").dbVersion),h(this,a,{$id:(0,m.shortUUID)()},"f"),d.init&&this.init(d.init,!1)}static recieveMsg(e,t){return void 0===y.GoldMinerCahce[t.appName]&&(y.GoldMinerCahce[t.appName]=new y({appName:t.appName,env:t.env})),y.GoldMinerCahce[t.appName].reportManyLog({timeRage:[e.data.start_timestamp,e.data.end_timestamp],sourceType:t.source,msgId:e.data.msg_id,appId:e.data.app_id,appName:e.data.app_name,latestCount:t.latestCount}).catch(console.error)}init(i,s=!0){var o;(null===(o=c(this,a,"f"))||void 0===o?void 0:o.$createTime)?(c(this,t,"f").main=[],c(this,t,"f").logList=[],h(this,a,Object.assign(Object.assign({$id:(0,m.shortUUID)()},i),{$expire:Date.now()+c(this,e,"f").expire,$createTime:Date.now(),$updateTime:Date.now()}),"f")):Object.assign(c(this,a,"f"),Object.assign(Object.assign({},i),{$expire:Date.now()+c(this,e,"f").expire,$createTime:Date.now(),$updateTime:Date.now()})),c(this,a,"f").$space=(0,m.getSizeInBytes)(c(this,a,"f")),c(this,t,"f").main.push(c(this,a,"f")),s&&this.initStore().then(()=>{this.startQueueTask("main")})}initStore(){return d(this,void 0,void 0,function*(){"opening"!==c(this,s,"f")&&"opened"!==c(this,s,"f")&&(h(this,s,"opening","f"),yield this.idb.stores(v),h(this,o,this.idb.getStore("main"),"f"),h(this,n,this.idb.getStore("logList"),"f"),h(this,s,"opened","f"),this.startQueueTask("logList"),setTimeout(()=>this.checkSpaceAndClear(),200))})}destroy(){this.idb.close(),c(this,s,"f")}startQueueTask(e){if(!Array.isArray(c(this,t,"f")[e])||"opened"!=c(this,s,"f"))return;const i=this.idb.getStore(e),n=()=>{var s,r;if("logList"===e&&c(this,t,"f")[e].length&&c(this,a,"f")){const r=c(this,t,"f")[e].shift();if(!r)return;c(this,a,"f").$updateTime=r.$createTime,c(this,a,"f").$space=(c(this,a,"f").$space||0)+(0,m.getSizeInBytes)(r.$content)+$,null===(s=c(this,o,"f"))||void 0===s||s.put(c(this,a,"f")),i.add(r),setTimeout(n,0)}else"main"===e&&(null===(r=c(this,o,"f"))||void 0===r||r.put(c(this,a,"f")))};n()}log(e){var i;c(this,o,"f")||this.initStore();const s=Date.now(),n={$id:(0,m.UUID)(),$mainId:c(this,a,"f").$id,$content:e,$createTime:s,$expire:-1};"object"==typeof e&&(n.$content=e.content,n.$createTime=null!==(i=e.ts)&&void 0!==i?i:s,void 0!==e.type&&(n.$type=e.type)),c(this,t,"f").logList.push(n),this.startQueueTask("logList")}checkSpaceAndClear(){return d(this,void 0,void 0,function*(){if(!c(this,n,"f")||!c(this,o,"f"))return;const t=yield c(this,o,"f").getAll();let i=0;const s=[],a={};if(t.forEach(e=>{Date.now()-e.$createTime>e.$expire?s.push(e.$id):(i+=Number(e.$space),a[e.$id]=e)}),yield this.removeLogList(s),i/1048576>=c(this,e,"f").maxSpace){const e=yield c(this,n,"f").getAll(),t=Date.now(),i=6e4;e.forEach((s,o)=>{var r,d,h;a[s.$mainId]?t-s.$createTime>a[s.$mainId].$expire/2?null===(r=c(this,n,"f"))||void 0===r||r.delete(s.$id):o<e.length/2&&t-s.$createTime>i&&(null===(d=c(this,n,"f"))||void 0===d||d.delete(s.$id)):null===(h=c(this,n,"f"))||void 0===h||h.delete(s.$id)})}})}removeLogList(e){var t;return d(this,void 0,void 0,function*(){if(c(this,n,"f")&&c(this,o,"f"))for(const i of e){if(i===(null===(t=c(this,a,"f"))||void 0===t?void 0:t.$id))continue;const e=yield c(this,n,"f").queryWithIndex("$mainId",i);for(const t of e)yield c(this,n,"f").delete(t.$id);yield c(this,o,"f").delete(i)}})}recieveMsg(t,i){switch(t.cmd){case"LIVE_PLAYER_LOG_RECYCLE":w(t.data.msg_id,()=>d(this,void 0,void 0,function*(){t.data.user_id===(0,m.getUserId)()&&t.data.app_name===c(this,e,"f").appName&&(yield this.reportManyLog({timeRage:[t.data.start_timestamp,t.data.end_timestamp],sourceType:i.source,msgId:t.data.msg_id,appId:t.data.app_id,appName:t.data.app_name,latestCount:i.latestCount}).catch(console.error))}))}}report(t){let i;return t.startTime&&t.endTime&&(i=[t.startTime,t.endTime]),this.reportManyLog({timeRage:i,sourceType:t.source,appName:c(this,e,"f").appName,latestCount:t.latestCount,msgId:t.msgId})}reportManyLog(t){return d(this,void 0,void 0,function*(){const i=yield this.getLogs({timeRange:t.timeRage,latestCount:t.latestCount||10}),s=[];for(const a of i){const{$id:i,$expire:o,$space:n,$createTime:r,$updateTime:d}=a,h=l(a,["$id","$expire","$space","$createTime","$updateTime"]);(yield(0,u.reportLog)({data:Object.assign({createTime:r,updateTime:d},h),appName:t.appName,sourceType:t.sourceType,msgId:t.msgId,appId:t.appId},c(this,e,"f").env))&&s.push(i)}yield this.removeLogList(s)})}getLogs({timeRange:e,latestCount:t=40}){var i,s;return d(this,void 0,void 0,function*(){if(!c(this,n,"f")||!c(this,o,"f"))return yield this.initStore(),yield(0,m.sleep)(200),this.getLogs({timeRange:e,latestCount:t});const a=[];let d=(yield c(this,o,"f").getAll()).sort((e,t)=>t.$createTime-e.$createTime);if(Array.isArray(e)){const t=null!==(i=e[0])&&void 0!==i?i:Date.now()-3e3,a=null!==(s=e[1])&&void 0!==s?s:Date.now();d=d.filter(e=>e.$createTime>=t&&e.$createTime<=a)}t>0&&(d=d.slice(0,t));const h=c(this,r,"f")?e=>c(this,r,"f")(e):function(e){var t;let i,s=e.$createTime;"object"==typeof e.$content&&null!==e.$content&&(i=e.$content.color,s=null!==(t=e.$content.ts)&&void 0!==t?t:s,delete e.$content.color,delete e.$content.ts);const a={content:e.$content,ts:s};return e.$type&&(a.type=e.$type),i&&(a.color=i),a};for(const e of d){const t=yield c(this,n,"f").queryWithIndex("$mainId",e.$id);a.push(Object.assign(Object.assign({},e),{logList:t.map(h)}))}return a})}formatter(e){h(this,r,e,"f")}}function w(e,t){return d(this,void 0,void 0,function*(){yield new Promise(e=>{setTimeout(()=>{e()},300*Math.random()|0)});const i=void 0===e?"":`live-log-report-${e}`;if(""!==i){if(null!==localStorage.getItem(i))return;localStorage.setItem(i,"1")}yield t(),""!==i&&localStorage.removeItem(i)})}exports.GoldMiner=y,e=new WeakMap,t=new WeakMap,i=new WeakMap,s=new WeakMap,a=new WeakMap,o=new WeakMap,n=new WeakMap,r=new WeakMap,y.GoldMinerCahce={},exports.multitask=w;
},{"./idb":"n8Xe","./report":"NwTf","./utils":"cQRo"}],"zRQJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.GoldMiner=exports.multitask=void 0;const e=require("./GoldMiner");Object.defineProperty(exports,"GoldMiner",{enumerable:!0,get:function(){return e.GoldMiner}}),Object.defineProperty(exports,"multitask",{enumerable:!0,get:function(){return e.multitask}}),exports.default=e.GoldMiner;
},{"./GoldMiner":"wAJK"}],"hY1T":[function(require,module,exports) {
"use strict";var e;Object.defineProperty(exports,"__esModule",{value:!0}),exports.logStorageConfig=exports.goldMiner=exports.logLevelColos=void 0;var o=require("@bilibili-live/web-player-common"),r=require("@bilibili-live/gold-miner"),t=require("./biz-common");exports.logLevelColos=((e={})[o.LogLevel.Error]="red",e[o.LogLevel.Info]="blue",e[o.LogLevel.Warn]="orange",e[o.LogLevel.Debug]="gray",e);var n,i="indexedDB"in window||"webkitIndexedDB"in window||"mozIndexedDB"in window;function l(e){i&&exports.goldMiner.recieveMsg(e,{source:"socket-report",latestCount:20})}function s(e){i&&(exports.goldMiner.init({roomId:e.roomId,uid:t.getUserId(),ref:window.location.href,createTime:Date.now(),updateTime:Date.now()}),null!=e.socket&&(null!=n&&n(),n=e.socket.on("message",l)))}exports.goldMiner=new r.GoldMiner({appName:"live-web-player"}),exports.goldMiner.formatter(function(e){return{content:e.$content,ts:e.$createTime,color:exports.logLevelColos[e.$type]}}),i&&o.logger.watch(function(e){exports.goldMiner.log({content:e.content,ts:e.ts,type:e.level})}),exports.logStorageConfig=s;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/gold-miner":"zRQJ","./biz-common":"YQ89"}],"z9tw":[function(require,module,exports) {
module.exports={notAutoPlayTipContainer:"_not-auto-play-tip-container_18442",tipImg:"_tip-img_18442",tipText:"_tip-text_18442",textTipEmphasize:"_text-tip-emphasize_18442",tipBtn:"_tip-btn_18442",mutePlayTipContainer:"_mute-play-tip-container_18442"};var t="._not-auto-play-tip-container_18442{width:100%;height:100%;display:flex;align-items:center;flex-direction:column;justify-content:center;position:absolute;top:0;left:0;background:rgba(0,0,0,.5);z-index:40}._not-auto-play-tip-container_18442 ._tip-img_18442{margin-top:-10%;width:230px}._not-auto-play-tip-container_18442 ._tip-text_18442{font-family:PingFang SC;font-style:normal;font-weight:400;font-size:18px;line-height:34px;color:#fff;margin-bottom:20px;margin-top:0}._not-auto-play-tip-container_18442 ._tip-text_18442 ._text-tip-emphasize_18442{color:#23ade5}._not-auto-play-tip-container_18442 ._tip-btn_18442{width:135px;height:45px;background:#23ade5;border-radius:4px;color:#fff;font-family:PingFang SC;font-style:normal;font-weight:500;font-size:18px;text-align:center;vertical-align:middle;line-height:45px;cursor:pointer}._mute-play-tip-container_18442{position:absolute;width:150px;height:32px;background:#23ade5;border-radius:4px;z-index:40;bottom:40;left:30px;bottom:10px;cursor:pointer}._mute-play-tip-container_18442 ._tip-img_18442{width:18px;height:18px;line-height:28px;position:absolute;top:6px;left:11px;margin-right:9px}._mute-play-tip-container_18442 ._tip-text_18442{position:absolute;font-family:PingFang SC;font-style:normal;font-weight:500;font-size:16px;line-height:32px;color:#fff;top:0;left:41px;white-space:nowrap;margin:0}",i=document.createElement("style");i.type="text/css",i.appendChild(document.createTextNode(t)),document.head.appendChild(i);
},{}],"QivA":[function(require,module,exports) {
"use strict";var e=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.createMutePlayTip=exports.createNotAutoPlayTip=void 0;var t=e(require("./not-auto-play.less"));function a(e,a){var i=document.createElement("div"),n=document.createElement("div"),d=document.createElement("p"),c=document.createElement("img");return i.classList.add(t.default.notAutoPlayTipContainer),n.classList.add(t.default.tipBtn),n.innerHTML="点击播放",d.classList.add(t.default.tipText),d.innerHTML='\n    你的浏览器<a class="'+t.default.textTipEmphasize+'">不支持</a>自动播放\n  ',c.classList.add(t.default.tipImg),c.src="//i0.hdslb.com/bfs/activity-plat/static/20211217/d0411babbbf77c49ca42a3320eb804ae/OqYjEF1uIM.png",n.onclick=function(){i.remove(),a()},i.appendChild(c),i.appendChild(d),i.appendChild(n),e.appendChild(i),function(){i.remove()}}function i(e,a){var i=document.createElement("div"),n=document.createElement("img"),d=document.createElement("p");return n.src="//i0.hdslb.com/bfs/activity-plat/static/20211220/d0411babbbf77c49ca42a3320eb804ae/hDsUctDb2f.png",i.appendChild(n),d.innerText="点击取消静音",i.appendChild(n),i.appendChild(d),i.classList.add(t.default.mutePlayTipContainer),d.classList.add(t.default.tipText),n.classList.add(t.default.tipImg),e.appendChild(i),i.onclick=function(){i.remove(),a()},{destroy:function(){i.remove()},change:function(e){i.style.bottom=e?"50px":"10px"}}}exports.createNotAutoPlayTip=a,exports.createMutePlayTip=i;
},{"./not-auto-play.less":"z9tw"}],"nuNG":[function(require,module,exports) {
"use strict";var e=this&&this.__assign||function(){return(e=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},t=this&&this.__createBinding||(Object.create?function(e,t,n,i){void 0===i&&(i=n),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,i){void 0===i&&(i=n),e[i]=t[n]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var i={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&t(i,e,a);return n(i,e),i},a=this&&this.__awaiter||function(e,t,n,i){return new(n||(n=Promise))(function(a,o){function r(e){try{u(i.next(e))}catch(t){o(t)}}function l(e){try{u(i.throw(e))}catch(t){o(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,l)}u((i=i.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(o){return function(l){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,i&&(a=2&o[0]?i.return:o[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,o[1])).done)return a;switch(i=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return r.label++,{value:o[1],done:!1};case 5:r.label++,i=o[1],o=[0];continue;case 7:o=r.ops.pop(),r.trys.pop();continue;default:if(!(a=(a=r.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){r=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){r.label=o[1];break}if(6===o[0]&&r.label<a[1]){r.label=a[1],a=o;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(o);break}a[2]&&r.ops.pop(),r.trys.pop();continue}o=t.call(e,r)}catch(l){o=[6,l],i=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,l])}}},r=this&&this.__classPrivateFieldGet||function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)},l=this&&this.__classPrivateFieldSet||function(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n},u=this&&this.__spreadArray||function(e,t){for(var n=0,i=t.length,a=e.length;n<i;n++,a++)e[a]=t[n];return e},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.RoomPlayer=void 0;var c,d=require("@bilibili-live/web-player-common"),v=require("@bilibili-live/web-player"),f=i(require("@bilibili-live/web-player-socket")),p=require("./danmaku-biz"),h=require("./biz-common"),m=require("./biz-interface"),y=s(require("@bilibili-live/web-player-track")),g=require("./ui-components/end-recommend-panel"),E=s(require("./ui-components/video-logo")),k=s(require("./ui-components/feedback")),S=require("./ui-components/error-panel"),b=s(require("./ui-components/preround-conuter")),w=s(require("@bilibili-live/web-player-contextmenu")),T=s(require("@bilibili-live/web-player-video-info")),I=s(require("@bilibili-live/web-player-danmaku-report")),M=s(require("./ui-components/log-panel")),P=s(require("./browser-fullscreen")),C=require("./log-storage"),x=require("./ui-components/not-auto-play");d.logger.printToConsole=d.wpd.Log2Console,h.commonLogInfo("RoomPlayer"),function(e){e[e.Click=1]="Click",e[e.Esc=2]="Esc",e[e.DBClick=3]="DBClick",e[e.Other=4]="Other"}(c||(c={}));var V=function(){function t(t,Ee){var ke,Se,be,we,Te=this;this.container=t,this.opts=Ee,n.set(this,void 0),i.set(this,void 0),s.set(this,void 0),x.set(this,null),V.set(this,void 0),q.set(this,void 0),B.set(this,void 0),H.set(this,void 0),z.set(this,void 0),j.set(this,[]),G.set(this,null),Q.set(this,null),J.set(this,!1),K.set(this,new d.EventBus),Y.set(this,null),X.set(this,[]),Z.set(this,0),$.set(this,!1),ee.set(this,void 0),te.set(this,void 0),ne.set(this,null),ie.set(this,function(){}),this.reload=function(){return a(Te,void 0,Promise,function(){var e,t,i,a;return o(this,function(o){switch(o.label){case 0:if(r(this,$))return[2];l(this,$,!0),null===(i=r(this,ne))||void 0===i||i.remove(),l(this,ne,null),o.label=1;case 1:return o.trys.push([1,,4,5]),e=r(this,s),null!=(t=r(this,n))?[3,3]:[4,h.loadRoomInfo(e,this.container)];case 2:t=o.sent(),o.label=3;case 3:if(r(this,J))return[2];switch(r(this,ce).call(this),null===(a=r(this,Q))||void 0===a||a.setRoomStatus(t.live_status),t.live_status){case m.RoomStatus.Preparing:r(this,pe).call(this,e),this.updateRoomStatus(m.RoomStatus.Preparing);break;case m.RoomStatus.Live:this.updateRoomStatus(m.RoomStatus.Live),l(this,x,r(this,re).call(this,t,r(this,V)));break;case m.RoomStatus.Round:this.updateRoomStatus(m.RoomStatus.Round),l(this,x,r(this,ae).call(this))}return this.emit(d.ExternalEventType.WebPlayerCreated),null!=r(this,x)&&(r(this,me).call(this),r(this,j).push(h.pause10SecBlockStream(r(this,x),this))),r(this,j).push(r(this,le).call(this,r(this,V))),l(this,n,void 0),[3,5];case 4:return l(this,$,!1),d.logger.info("room player is reload"),[7];case 5:return[2]}})})},ae.set(this,function(){var e,t,n=r(Te,s),a=new v.RoundPlayer(Te.container,{roomId:n,userId:r(Te,i),enableCtrlUI:null===(t=null===(e=Te.opts.UI)||void 0===e?void 0:e.enableCtrlUI)||void 0===t||t});return a.on("failed",function(e,t,i){void 0===i&&(i=y.default.ErrorCode.RoomRoundUnknow),e===v.NonRoundStatus.Preround?r(Te,j).push(b.default(Te.container,Te.reload,t)):e===v.NonRoundStatus.Nonenabled?r(Te,pe).call(Te,n,"系统维护中,轮播暂时不可用"):(y.default.error(i,""+e),r(Te,j).push(S.createErrorPanel(Te.container,i)))}),a.on(v.VideoEventType.FirstFrame,function(){var e,t=a.getVideoEl();null!=t&&(r(Te,q).danmakuStateHandler.updateVideoEl(t),!0===(null===(e=Te.opts.UI)||void 0===e?void 0:e.enableMaskDanmaku)&&r(Te,q).danmakuStateHandler.maskSwitch(!0))}),d.EventBus.forwardEvent(a,Te,[d.ExternalEventType.StartPlayRound,d.ExternalEventType.Reload,v.VideoEventType.MutePlay,v.VideoEventType.NotAutoPlay,d.ExternalEventType.LiveStateChange,[v.VideoEventType.FirstFrame,d.ExternalEventType.FirstFrame],[v.VideoEventType.Play,d.ExternalEventType.Playing],[v.VideoEventType.Pause,d.ExternalEventType.Paused]]),r(Te,j).push(R(r(Te,q),a.ctrl,r(Te,i)),_(a.ctrl,Te)),a}),oe.set(this,function(){P.default.exitFullscreen().then(function(){Te.emit(d.ExternalEventType.FeedBackClick)}).catch(function(e){d.logger.warn(e)})}),re.set(this,function(e,t){var n,a,o,l,u,c=Te.opts,f=c.rnd,p=c.UI,g=new v.LivePlayer(Te.container,{roomId:r(Te,s),roomInfo:e,userId:r(Te,i),rnd:f,enableCtrlUI:null===(n=null==p?void 0:p.enableCtrlUI)||void 0===n||n},t);r(Te,X).push(h.dmVisualVibrate(g,r(Te,q))),v.isBwpSupported()&&g.showHEVCQuality(!0);var E=g.ctrl.getCtrlUI();return!0===(null===(a=Te.opts.UI)||void 0===a?void 0:a.showMirror)&&(E.ctrlItemVisibility.mirror=!0),null!=(null===(o=Te.opts.UI)||void 0===o?void 0:o.pip)&&(E.ctrlItemVisibility.pip=null===(l=Te.opts.UI)||void 0===l?void 0:l.pip),!1===(null===(u=Te.opts.UI)||void 0===u?void 0:u.webFullScreen)&&(E.ctrlItemVisibility.webFullScreen=!1),null!=r(Te,Y)&&g.setAutoSyncCfg(r(Te,Y)),g.on(v.LivePlayerEvent.Failed,function(e,t){y.default.error(e,null!=t?t:""),r(Te,j).push(S.createErrorPanel(Te.container,e,t)),g.destroy()}),g.on(v.LivePlayerEvent.LiveStatusChange,function(e){Te.updateRoomStatus(m.RoomStatus.Preparing),r(Te,ye).call(Te),e===m.RoomStatus.Round?r(Te,j).push(b.default(Te.container,Te.reload)):r(Te,pe).call(Te,r(Te,s))}),g.on(v.VideoEventType.FirstFrame,function(){var e,t=g.getVideoEl();if(null!=t){r(Te,q).danmakuStateHandler.updateVideoEl(t);var n=!0===(null===(e=Te.opts.UI)||void 0===e?void 0:e.enableMaskDanmaku);r(Te,q).danmakuStateHandler.maskSwitch(n),A({dmBiz:r(Te,q),dmSwitch:g.ctrl.getCtrlUI().danmaku.display})}}),d.EventBus.forwardEvent(g,Te,[d.ExternalEventType.SwitchLine,d.ExternalEventType.SwitchQuality,d.ExternalEventType.SwitchQualityNotLogin,d.ExternalEventType.Reload,d.ExternalEventType.SEIParseData,v.VideoEventType.MutePlay,v.VideoEventType.NotAutoPlay,d.ExternalEventType.LiveStateChange,[v.VideoEventType.FirstFrame,d.ExternalEventType.FirstFrame],[v.VideoEventType.Play,d.ExternalEventType.Playing],[v.VideoEventType.Pause,d.ExternalEventType.Paused]]),r(Te,j).push(R(r(Te,q),g.ctrl,r(Te,i)),_(g.ctrl,Te),D(r(Te,B),g)),g}),le.set(this,function(e){d.logger.info("room player listen socket message");var t=function(e){d.logger.warn("refresh by socket "+e),Te.reload().catch(function(e){d.logger.error(e)})},n=r(Te,s),i=e.on("message",function(e){if(!e.cmd.startsWith("DANMU_MSG")){switch(e.cmd){case f.SocketMsgType.Live:if(r(Te,x)instanceof v.LivePlayer)break;r(Te,j).push(d.disperseAction(1e4,function(){t(e.cmd)}));break;case f.SocketMsgType.Round:if(r(Te,x)instanceof v.RoundPlayer)break;t(e.cmd);break;case f.SocketMsgType.Preparing:r(Te,ye).call(Te),1===e.round?r(Te,j).push(b.default(Te.container,Te.reload)):r(Te,pe).call(Te,n),Te.updateRoomStatus(m.RoomStatus.Preparing);break;case f.SocketMsgType.End:case f.SocketMsgType.Close:case f.SocketMsgType.Block:r(Te,pe).call(Te,n),Te.updateRoomStatus(m.RoomStatus.Preparing);break;case f.SocketMsgType.Refresh:t(e.cmd);break;case f.SocketMsgType.AreaBlock:break;case f.SocketMsgType.HotRoomNotify:if(!Array.isArray(e.data.random_delay_req_v2))break;i=performance.now()+1e3*Number(e.data.ttl),isNaN(i)?d.logger.error("HotRoomNotify ttl error: "+String(e.data.ttl)):(d.logger.debug("HotRoomNotify msg: "+JSON.stringify(e.data.random_delay_req_v2)),e.data.random_delay_req_v2.forEach(function(e){var t=e.path,n=e.delay;d.ajax.disperse(t,{scope:n,expiresTime:i})}))}var i;Te.emit(d.ExternalEventType.ReceiveMessage,e)}}),a=e.on("heartbeat",function(e){Te.emit(d.ExternalEventType.ReceiveOnlineCount,e.count)});return function(){i(),a()}}),ue.set(this,function(e,t){var n;if(r(Te,x)instanceof v.LivePlayer){var i=null===(n=r(Te,x))||void 0===n?void 0:n.getVideoEl();"danmaku"===e&&r(Te,q).changeMaskState(i,t.enableMask),"playStatus"===e&&!0!==t&&(clearTimeout(r(Te,Z)),r(Te,q).changeMaskState(i,!1,!0))}}),se.set(this,function(e,t){return a(Te,void 0,Promise,function(){var n,i,a,l,u,c,v=this;return o(this,function(o){switch(o.label){case 0:switch(e){case"report":return[3,1];case"shield":return[3,3];case"addBlackList":return[3,4]}return[3,5];case 1:return[4,r(this,ee).show({uid:t.uid,roomid:r(this,s),uname:t.uname,msg:t.text,checkInfo:t.checkInfo,type:t.dmType,file_id:null!==(l=null!==(i=null===(n=t.voiceConfig)||void 0===n?void 0:n.file_id)&&void 0!==i?i:null===(a=t.emoticonOptions)||void 0===a?void 0:a.emoticon_unique)&&void 0!==l?l:"",img_url:null!==(c=null===(u=t.emoticonOptions)||void 0===u?void 0:u.url)&&void 0!==c?c:""})];case 2:return o.sent(),[3,5];case 3:return p.roomBlockAdapter({component:"block",action:"addShieldUser",data:{uid:t.uid,uname:t.uname}},r(this,q),r(this,s),function(e,t){v.emit(d.ExternalEventType.Set,{component:"block",action:e,data:t})}),[3,5];case 4:return this.emit(d.ExternalEventType.Set,{component:"block",action:"addBlackList",data:t.uname}),[3,5];case 5:return[2]}})})}),ce.set(this,function(){r(Te,j).forEach(function(e){return e()}),l(Te,j,[])}),de.set(this,function(){var t=e(e({NAME:"BILIBILI HTML5 LIVE PLAYER",VERSION:h.ENV.VERSION},"development"===h.ENV.NODE_ENV?{socket:r(Te,V)}:{}),{play:function(){var e;null===(e=r(Te,x))||void 0===e||e.play()},pause:function(){var e;null===(e=r(Te,x))||void 0===e||e.pause()},volume:function(t){var n;d.userSetting.setVolume(e(e({},d.userSetting.getVolume()),{value:t})),null===(n=r(Te,x))||void 0===n||n.volume(t/100)},setDanmaku:function(){},reload:Te.reload,destroy:Te.destroy,getOperableElements:Te.getOperableElements,freeze:function(){var e;null===(e=r(Te,x))||void 0===e||e.blockStream()},refresh:function(){Te.reload().catch(function(e){d.logger.error(e)})},set:function(e){"block"===e.component&&p.roomBlockAdapter(e,r(Te,q),r(Te,s),function(e,t){Te.emit(d.ExternalEventType.Set,{component:"block",action:e,data:t})})},setFullscreenDanmaku:function(e){null!=r(Te,x)&&F(e,r(Te,x))},sendDanmaku:function(e){return a(Te,void 0,void 0,function(){var t=this;return o(this,function(n){switch(n.label){case 0:return[4,r(this,q).userSendDanmaku(e).then(function(n){var i={uniqueID:e.uniqueID,response:n};return t.emit(d.ExternalEventType.SendDanmaku,i),i})];case 1:return[2,n.sent()]}})})},toast:function(e){d.toast(e,Te.container)},notifyInOperation:function(e){Te.getOperableElements().mainElement.style.zIndex=""+(e?9:-1)},notifyAnnouncement:Te.notifyAnnouncement,injectInitAPIData:Te.injectInitAPIData,getVideoEl:function(){var e,t;return null!==(t=null===(e=r(Te,x))||void 0===e?void 0:e.getVideoEl())&&void 0!==t?t:null},supportMaskDanmaku:function(){return r(Te,q).supportMaskDanmaku()},changeUIStatus:function(t){var n,i,a,o,u,s=null===(n=r(Te,x))||void 0===n?void 0:n.getVideoEl();if(null!==(a=null===(i=JSON.stringify(Te.opts.roomInitDataV2))||void 0===i?void 0:i.includes("全景"))&&void 0!==a&&a&&null!=t.showMirror&&(t.showMirror=!1),null!=s&&(!0===t.enableMaskDanmaku?(r(Te,q).bodyMaskDetectorStatus=!0,r(Te,q).danmakuStateHandler.maskSwitch(!0)):!1===t.enableMaskDanmaku&&(r(Te,q).bodyMaskDetectorStatus=!1,r(Te,q).danmakuStateHandler.maskSwitch(!1))),!1===t.feedback?null===(o=r(Te,G))||void 0===o||o.call(Te):!0===t.feedback&&null==r(Te,G)&&l(Te,G,k.default(Te.container,r(Te,oe))),!1===t.logo?null===(u=r(Te,Q))||void 0===u||u.destroy():!0===t.logo&&null==r(Te,Q)&&l(Te,Q,E.default(Te.container)),!1===t.recommend&&r(Te,ie).call(Te),Te.opts.UI=Object.assign({},Te.opts.UI,t),null!=r(Te,x)){var c=r(Te,x).ctrl.getCtrlUI();null!=t.showMirror&&(c.ctrlItemVisibility.mirror=t.showMirror),!1===t.webFullScreen&&(c.ctrlItemVisibility.webFullScreen=!1),null!=t.pip&&(c.ctrlItemVisibility.pip=t.pip),null!=t.showDanmakuSetting&&(c.ctrlItemVisibility=e(e({},c.ctrlItemVisibility),{danmakuPanel:t.showDanmakuSetting}))}},changeDanmakuExtraConfig:function(e){r(Te,q).updateDanmakuExtraConfig(e)},changeCtrlVisible:function(e){var t,n;e?null===(t=r(Te,x))||void 0===t||t.ctrl.show():null===(n=r(Te,x))||void 0===n||n.ctrl.hide()},capturePic:function(e,t){var n,i;return null!==(i=null===(n=r(Te,x))||void 0===n?void 0:n.capturePic(e,t))&&void 0!==i?i:null},on:function(t,i){var a;if(t===d.ExternalEventType.Initialized)return i({type:"html5"}),void d.logger.info("room player emit external event: Initialized");if(t===d.ExternalEventType.InitDanmaku){var o=r(Te,q).getDanmakuConfig();return d.logger.info("room player emit external event: InitDanmaku, data: "+JSON.stringify(o)),void i(e(e({},o),{room_shield:null===(a=r(Te,n))||void 0===a?void 0:a.room_shield}))}return Te.on(t,i)},once:function(e,t){return Te.once(e,t)},addLoadingPicture:function(e){var t;null===(t=r(Te,x))||void 0===t||t.setTitlePageImg(e)},stopPlayback:function(e){var t;null!=r(Te,x)&&(r(Te,x).destroy(),r(Te,ce).call(Te),d.coverImg(null!==(t=null==e?void 0:e.url)&&void 0!==t?t:"//s1.hdslb.com/bfs/static/player/live/html5/images/error@1x.png",Te.container),r(Te,j).push(function(){d.coverImg(null,Te.container)}))},getPlayerInfo:function(){var t,n,i=r(Te,x),a={type:1,version:h.ENV.VERSION,playerType:"HTML5",liveStatus:m.RoomStatus.Preparing,playerStatus:0,playingStatus:!1,playurl:"",guid:"",quality:"0",qualityCandidates:[]};if(null==i)return a;var o=i.getPlayerInfo(),l=null!==(t=i.ctrl.getCtrlUI().webFullScreenStatus)&&void 0!==t&&t?1:null!==(n=i.ctrl.getCtrlUI().fullScreenStatus)&&void 0!==n&&n?2:0;return e(e({},a),{liveStatus:i instanceof v.LivePlayer?1:0,playerStatus:l,playingStatus:o.playingStatus,playurl:o.playSrc,guid:o.guid,quality:o.quality,qualityCandidates:o.qualityCandidates.map(function(e){var t=e.label;return{qn:e.value,desc:t}}),volume:i.ctrl.getCtrlUI().volume,danmaku:d.userSetting.getDanmaku()})},switchQuality:function(e){r(Te,x)instanceof v.LivePlayer&&r(Te,x).switchQuality(e)},updateDMSetting:function(t){null!=r(Te,q)&&(d.userSetting.setDanmaku(e(e({},d.userSetting.getDanmaku()),t)),h.updateDanmakuSetting(t,r(Te,q)))},init:function(e,t){if("config"===e&&(null==t?void 0:t.isAdmin))r(Te,B).setAdmin();else if("autoSync"===e){var n=t;for(var i in t)n[i]=Number(t[i]);l(Te,Y,n),r(Te,x)instanceof v.LivePlayer&&r(Te,x).setAutoSyncCfg(n)}},remainBufferLength:function(){return r(Te,x)instanceof v.LivePlayer?r(Te,x).remainBufferLength():0},discardFrame:function(e){if(r(Te,x)instanceof v.LivePlayer){if(!r(Te,x).getPlayerInfo().playingStatus)return;r(Te,x).discardFrame(e)}},sendGift:function(){},resize:function(){var e;r(Te,q).resize(),null===(e=r(Te,x))||void 0===e||e.ctrl.setMiniMode(Te.container.clientWidth<=500)},noticeGift:function(){},setChasingFrameThreshold:function(){},loadVideo:function(){},changeCtrlIconVisible:function(e){r(Te,ve).call(Te,e)},userFeedback:d.debounce(function(t){return a(Te,void 0,void 0,function(){return o(this,function(n){switch(n.label){case 0:return y.default.custom(y.default.CustomCode.UserFeedBack,t),[4,U(e(e({},t),{mid:r(this,i),buvid:r(this,te)}))];case 1:return n.sent(),[2]}})})},400)}),u=function(e){var n=e;if("function"==typeof t[n]){if(["getPlayerInfo","notifyAnnouncement","notifyInOperation","on","set","getOperableElements","remainBufferLength","receiveOnlineCount"].includes(n))return"continue";var i=t[n];t[n]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return d.logger.debug("external call player api: "+n+", args: "+JSON.stringify(e)),i.apply(void 0,e)}}};for(var c in t)u(c);return t}),ve.set(this,function(t){var n,i;if(null!=r(Te,x)){var a=r(Te,x).ctrl.getCtrlUI();a.ctrlItemVisibility=e(e({},a.ctrlItemVisibility),{playStatus:t.play,volume:t.volume,time:t.time,refresh:t.reload,quality:t.quality,rightSetting:t.setting,danmaku:t.danmaku,fullScreen:t.fullscreen,webFullScreen:t.webFullscreen}),t.danmaku?r(Te,q).fetchBlockRules():r(Te,q).destroy(),t.feedback||null===(n=r(Te,G))||void 0===n||n.call(Te),t.logo||null===(i=r(Te,Q))||void 0===i||i.destroy(),null!=t.el&&a.appendCtrlItem(t.el)}}),fe.set(this,function(e){var t,n;if(r(Te,x)instanceof v.LivePlayer){var i=r(Te,x).ctrl.getCtrlUI().danmaku,a=null===(t=r(Te,x))||void 0===t?void 0:t.getVideoEl();if(null!=i&&null!=a){var o=null===(n=r(Te,x))||void 0===n?void 0:n.ctrl.getCtrlUI().playStatus;d.ua.isChrome()?(r(Te,q).onSei(e),i.enableMask&&(clearTimeout(r(Te,Z)),l(Te,Z,window.setTimeout(function(){o||(i.showMaskOption=!1,r(Te,q).changeMaskState(a,!1))},1e4))),i.showMaskOption=!0,!r(Te,q).maskState&&o&&r(Te,q).changeMaskState(a,i.enableMask)):(i.showMaskOption=!1,i.enableMask=!1,r(Te,q).changeMaskState(a,!1))}}}),this.notifyAnnouncement=(be=!1,function(e,t){void 0===e&&(e=!0),void 0===t&&(t=100),be!==e&&(be=e,r(Te,q).set({offsetTop:be?t:0}))}),this.updateRoomStatus=(we=m.RoomStatus.Preparing,function(e){var t;r(Te,q).danmakuStateHandler.maskSwitch(!1),null===(t=r(Te,x))||void 0===t||t.destroy(),l(Te,x,null),we!==e&&(we=e,Te.emit(d.ExternalEventType.LiveStateChange,we),r(Te,he).call(Te).resetHeight())}),this.injectInitAPIData=function(e){r(Te,q).initDanmakuConfig(e)},this.on=function(e,t){return r(Te,K).on(e,t)},this.once=function(e,t){return r(Te,K).once(e,t)},this.emit=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];[d.ExternalEventType.ReceiveMessage,d.ExternalEventType.ReceiveOnlineCount].includes(e)||d.logger.info("room player emit external event: "+e+", data: "+JSON.stringify(n)),(t=r(Te,K)).emit.apply(t,u([e],n))},pe.set(this,function(e,t){var n,i,a;void 0===t&&(t=""),null===(n=r(Te,ne))||void 0===n||n.remove(),l(Te,ne,document.createElement("div")),Te.container.appendChild(r(Te,ne)),l(Te,ie,g.endRecommendPanel(Te.container,r(Te,ne),{roomId:e,rnd:Te.opts.rnd,showRecommend:null===(a=null===(i=Te.opts.UI)||void 0===i?void 0:i.recommend)||void 0===a||a},function(e,t){"info"===e&&Te.emit(d.ExternalEventType.Recommend,t),"redirect"===e&&Te.emit(d.ExternalEventType.UserRedirect,t.data)},t))}),this.destroy=function(){var e,t,n,i;r(Te,J)||(l(Te,J,!0),null===(e=r(Te,ne))||void 0===e||e.remove(),l(Te,ne,null),r(Te,X).forEach(function(e){return e()}),l(Te,X,[]),d.logger.info("room player destroyed"),null===(t=r(Te,x))||void 0===t||t.destroy(),r(Te,V).destroy(),r(Te,q).destroy(),r(Te,H).destroy(),r(Te,z).destroy(),r(Te,B).destroy(),r(Te,ce).call(Te),r(Te,K).destroy(),null===(n=r(Te,G))||void 0===n||n.call(Te),null===(i=r(Te,Q))||void 0===i||i.destroy())},this.getOperableElements=function(){var e=r(Te,he).call(Te),t=e.el;return(0,e.resetHeight)(),{mainElement:t}},he.set(this,function(){var e="web-player-inject-wrap",t=Te.container.querySelector("."+e);return null==t&&((t=document.createElement("div")).classList.add(e),t.style.cssText="\n        position: absolute;\n        top: 0;\n        bottom: 0;\n        left: 0;\n        right: 0;\n        z-index: -1;\n      ",Te.container.appendChild(t)),{el:t,resetHeight:function(){null!=t&&(t.style.height=null==r(Te,x)?"100px":"auto")}}}),me.set(this,function(){var e,t=r(Te,x);if(null!=t){var n=0,i="",a=d.seiKeyComparator(d.SEIType.BILIMASK__SVGBIN);r(Te,j).push(N(t,Te.container,null===(e=Te.opts.UI)||void 0===e?void 0:e.enableAutoPlayTips),t.on(v.VideoEventType.Destroyed,function(){if(r(Te,q).danmakuStateHandler.maskSwitch(!1),t instanceof v.LivePlayer){var e=t.getVideoEl();r(Te,q).changeMaskState(e,!1),r(Te,q).clearMask()}}),t.ctrl.onChange(function(e,t){"volume"===e&&Te.emit(d.ExternalEventType.VolumeChange,t),r(Te,ue).call(Te,e,t),"show"===e&&Te.emit(d.ExternalEventType.CtrlVisibleChange,t)}),t.on(v.VideoEventType.SEIData,function(e){a(e[2])&&r(Te,fe).call(Te,e)}),t.on(v.VideoEventType.VideoInfo,function(e){r(Te,H).updateVideoTemplate(e),n=e.mediaInfo.videoDataRate;var t=e.mediaInfo,a=t.height>t.width?"vertical":"horizontal";a!==i&&(Te.emit(d.ExternalEventType.VideoDirectionChange,a),i=a)}),t.on(v.VideoEventType.LoadStart,d.runOnlyOnce("VideoEventType.LoadStart",function(){Te.emit(d.ExternalEventType.FirstLoadStart)})),t.on(v.VideoEventType.MetaData,d.runOnlyOnce("VideoEventType.MetaData",function(){Te.emit(d.ExternalEventType.FirstLoadedMetaData)})),t.on(v.VideoEventType.Play,d.runOnlyOnce("VideoEventType.Play",function(){Te.emit(d.ExternalEventType.FirstPlaying)})),t.on(v.VideoEventType.WaitStart,function(){var e,t,i=navigator.connection;d.logger.warn("connect downlink is: "+(null!==(e=null==i?void 0:i.downlink)&&void 0!==e?e:-1)+"Mbps,connect rtt is: "+(null!==(t=null==i?void 0:i.rtt)&&void 0!==t?t:-1)+"ms,video bitRate is: "+(n/1024).toFixed(2)+"Mbps")}))}}),ye.set(this,function(){P.default.exitFullscreen().catch(function(){d.logger.error("exit fullscreen error")}),Te.emit(d.ExternalEventType.WebFullscreen,!1,c.Other)}),ge.set(this,function(e){Te.emit(d.ExternalEventType.UserRedirect,e)});var Ie=this.opts,Me=Ie.cid,Pe=Ie.roomInitDataV2,Ce=Ie.rnd,xe=!0===Ee.isActivity?h.PlayerEnv.Activity:h.PlayerEnv.Room,Ve=h.initPlayer(Me,xe),Re=Ve.userId,De=Ve.uvid;return r(this,X).push(d.ajax.watch(h.ajaxWatcher)),l(this,i,Re),l(this,te,De),y.default.event(y.default.EventCode.RoomPlayerInit,null,{sampleRate:.5}),null!=Pe&&Pe.code>=0&&l(this,n,Pe.data),l(this,s,Me),l(this,V,new f.default({roomId:Me,userId:Re})),l(this,q,new p.DanmakuBiz(this.container,{userId:Re,rnd:Ce,roomId:Me})),r(this,q).connectSocket(r(this,V),function(e){Te.emit(d.ExternalEventType.ReceiveMessage,e)}),C.logStorageConfig({roomId:Me,socket:r(this,V)}),l(this,H,new T.default(this.container)),l(this,z,new M.default(this.container)),l(this,ee,new I.default(t)),l(this,B,new w.default(this.container,{uid:Re,version:h.ENV.VERSION,click:e({handleEvent:r(this,ge),handleDanmu:r(this,se)},h.createContextmenuHandler(r(this,z),r(this,H)))})),r(this,X).push(L(r(this,q),r(this,B)),h.pressToOpenVideoInfoListener(this.container)),!1!==(null===(ke=Ee.UI)||void 0===ke?void 0:ke.feedback)&&l(this,G,k.default(t,r(this,oe))),!1!==(null===(Se=Ee.UI)||void 0===Se?void 0:Se.logo)&&l(this,Q,E.default(this.container)),this.reload().catch(function(e){d.logger.error(e)}),r(this,X).push(O(),W()),r(this,de).call(this)}var n,i,s,x,V,q,B,H,z,j,G,Q,J,K,Y,X,Z,$,ee,te,ne,ie,ae,oe,re,le,ue,se,ce,de,ve,fe,pe,he,me,ye,ge;return n=new WeakMap,i=new WeakMap,s=new WeakMap,x=new WeakMap,V=new WeakMap,q=new WeakMap,B=new WeakMap,H=new WeakMap,z=new WeakMap,j=new WeakMap,G=new WeakMap,Q=new WeakMap,J=new WeakMap,K=new WeakMap,Y=new WeakMap,X=new WeakMap,Z=new WeakMap,$=new WeakMap,ee=new WeakMap,te=new WeakMap,ne=new WeakMap,ie=new WeakMap,ae=new WeakMap,oe=new WeakMap,re=new WeakMap,le=new WeakMap,ue=new WeakMap,se=new WeakMap,ce=new WeakMap,de=new WeakMap,ve=new WeakMap,fe=new WeakMap,pe=new WeakMap,he=new WeakMap,me=new WeakMap,ye=new WeakMap,ge=new WeakMap,t.isSupported=h.isSupported,t}();function R(t,n,i){var a=n.getCtrlUI();a.danmaku=d.userSetting.getDanmaku(),a.danmaku.showMaskOption=!1;var o=0,r=n.onChange(function(i,r){if("webFullScreenStatus"===i)return clearTimeout(o),o=window.setTimeout(function(){t.resize()},10),void n.hide();"danmaku"===i&&(d.userSetting.setDanmaku(e(e({},a.danmaku),r)),h.updateDanmakuSetting(r,t)),"volume"===i&&d.userSetting.setVolume(e(e({},a.volume),r))}),l=P.default.onChange(function(){clearTimeout(o),o=window.setTimeout(function(){t.resize()},300)});return function(){r(),l(),clearTimeout(o)}}function D(e,t){var n,i,a=t.ctrl.getCtrlUI().line,o=a.list;"number"==typeof a.value&&e.setLines(o,a.value,t.switchLine.bind(t));var r=null===(n=t.replay)||void 0===n?void 0:n.on("timeShiftChange",function(n){"number"==typeof a.value&&n>0&&e.setLines([],a.value,t.switchLine.bind(t))}),l=null===(i=t.replay)||void 0===i?void 0:i.on("backLive",function(){"number"==typeof a.value&&e.setLines(o,a.value,t.switchLine.bind(t))}),u=t.on(d.ExternalEventType.SwitchLine,function(t){e.changeLine(t)});return function(){null==r||r(),null==l||l(),u()}}function L(e,t){return e.onSelect(function(e){return t.updateDanmuInfo(e)}),function(){e.offSelect()}}function _(e,t){var n=this,i=!1,r=e.onChange(function(r,l){return a(n,void 0,void 0,function(){var n;return o(this,function(a){switch(a.label){case 0:return n=e.getCtrlUI(),"fullScreenStatus"!==r?[3,2]:(!1===l&&(i=!0),!0===n.webFullScreenStatus&&y.default.operation(y.default.OperationCode.WebFullScreenWay,0),n.webFullScreenStatus=!1,t.emit(d.ExternalEventType.WebFullscreen,!1,c.Other),n.fullScreenStatus=l,[4,P.default.toggleFullScreen(t.container)]);case 1:return a.sent(),[3,4];case 2:return"webFullScreenStatus"!==r?[3,4]:[4,P.default.exitFullscreen()];case 3:a.sent(),n.fullScreenStatus=!1,t.emit(d.ExternalEventType.WebFullscreen,l,c.Click),a.label=4;case 4:return[2]}})})}),l=P.default.onChange(function(){var n=t.container===P.default.getFullscreenElement();n||i||(e.getCtrlUI().fullScreenStatus=!1),t.emit(d.ExternalEventType.FullscreenChange,n,i?c.Click:c.Esc),i=!1});return function(){l(),r()}}function F(e,t){e.on("danmuInputBlur",function(){t.ctrl.setDmSendIsFocus(!1)}),e.on("danmuInputFocus",function(){t.ctrl.setDmSendIsFocus(!0)})}function O(){var e=function e(){return window.setTimeout(function(){y.default.custom(y.default.CustomCode.HangUp,{time:Math.floor(performance.now()/1e3),visible:"visible"===document.visibilityState?1:0}),clearTimeout(t),t=e()},18e5)},t=e(),n=function(){clearTimeout(t),t=e()};return window.addEventListener("mousemove",n),function(){window.removeEventListener("mousemove",n),clearTimeout(t)}}function W(){var e=setInterval(function(){var e,t,n=navigator.connection;y.default.custom(y.default.CustomCode.NetSpeed,{downlink:null!==(e=null==n?void 0:n.downlink)&&void 0!==e?e:-1,rtt:null!==(t=null==n?void 0:n.rtt)&&void 0!==t?t:-1},{sampleRate:.1})},18e4);return function(){clearInterval(e)}}function U(e){return a(this,void 0,Promise,function(){var t,n;return o(this,function(i){switch(i.label){case 0:if(!["其他问题或建议","黑屏","播放卡顿"].includes(e.type))return[2];t=5,n=36e5,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,C.goldMiner.report({startTime:Date.now()-n,endTime:Date.now(),latestCount:t,source:"player-report["+e.type+"]"})];case 2:return i.sent(),[3,4];case 3:return i.sent(),y.default.error(y.default.ErrorCode.ApiBiz,"LogReportFail"),[3,4];case 4:return[2]}})})}exports.RoomPlayer=V;var N=function(e,t,n){var i=null==n||n,a=[];return a.push(e.on(v.VideoEventType.MutePlay,function(){if(i){var n=x.createMutePlayTip(t,function(){var t=e.getVideoEl();null!=t&&(t.muted=!1)});e.ctrl.getCtrlUI().show?n.change(!0):n.change(!1),a.push(e.on(v.VideoEventType.Destroyed,n.destroy),e.ctrl.onRefresh(n.destroy),e.on(d.ExternalEventType.SwitchLine,n.destroy),e.on(d.ExternalEventType.SwitchQuality,n.destroy),n.destroy,e.ctrl.onChange(function(e,t){if("show"===e&&(!0===t?n.change(!0):n.change(!1)),"volume"===e){var i=t,a=i.disabled,o=i.value;(!a||o>0)&&n.destroy()}}))}})),a.push(e.on(v.VideoEventType.NotAutoPlay,function(){if(i){var n=x.createNotAutoPlayTip(t,function(){var t=e.getVideoEl();null!=t&&(t.muted=!1,t.play().catch(function(e){d.logger.error("click btn to play failed")}))});a.push(e.on(v.VideoEventType.Destroyed,function(){n()}))}})),function(){a.forEach(function(e){e()})}},q=!1;function A(t){if(!(q||(q=!0,Math.random()>.01))){var n=0,i=d.monitorFPS({type:"avg"},function(e){n=e});window.setTimeout(function(){var o;i(),y.default.perf(y.default.PerfCode.DevicePerf,n,{params:e(e({cpuCnt:navigator.hardwareConcurrency,mem:null!==(o=navigator.deviceMemory)&&void 0!==o?o:-1},a()),{dmSwitch:t.dmSwitch,maskDM:t.dmBiz.bodyMaskDetectorStatus}),extFields:[]})},1e4)}function a(){var e=document.createElement("canvas").getContext("experimental-webgl"),t={renderer:"",vendor:""};if(null==e)return t;var n=e.getExtension("WEBGL_debug_renderer_info");return null!=n&&(t.renderer=e.getParameter(n.UNMASKED_RENDERER_WEBGL),t.vendor=e.getParameter(n.UNMASKED_VENDOR_WEBGL)),t}}window.Player=V;
},{"@bilibili-live/web-player-common":"KGHo","@bilibili-live/web-player":"DfF7","@bilibili-live/web-player-socket":"MWvE","./danmaku-biz":"ZWNU","./biz-common":"YQ89","./biz-interface":"Rr2x","@bilibili-live/web-player-track":"ESUf","./ui-components/end-recommend-panel":"vDPq","./ui-components/video-logo":"vS7T","./ui-components/feedback":"EORf","./ui-components/error-panel":"E90K","./ui-components/preround-conuter":"weyG","@bilibili-live/web-player-contextmenu":"YNoa","@bilibili-live/web-player-video-info":"SR9Z","@bilibili-live/web-player-danmaku-report":"wafJ","./ui-components/log-panel":"MY3w","./browser-fullscreen":"PTXm","./log-storage":"hY1T","./ui-components/not-auto-play":"QivA"}]},{},["nuNG"], null)